Jedox.studio.files.importFile=function(arr,parentImNode){var onBeforeDestroyDialog=function(panel){importForm.items.each(function(f){f.purgeListeners();Ext.destroy(f)});importForm.purgeListeners();importForm.destroy()};var doUploadFile=function(){for(var i=0;i<arr.data.items.length;i++){var item=arr.data.items[i].data;var newFileName=fileUpload.getValue().split(".")[0];if(newFileName==item.text&&item.type=="Workbook"){Jedox.studio.app.showMessageERROR("Error".localize(),"upload_err_file_exists".localize());return false}}var frameID="studioImportFrame";var frame=Ext.get("studioImportFrame");if(!frame){frame=document.createElement("iframe");frame.id=frameID;frame.name=frameID;frame.className="x-hidden";if(Ext.isIE){frame.src=Ext.SSL_SECURE_URL}document.body.appendChild(frame);if(Ext.isIE){document.frames[frameID].name=frameID}}var form=Ext.getDom(importForm.getForm().getEl());form.target=frameID;form.method="POST";form.action="/spreadsheet/root/cc/studio/import.php";form.enctype=form.encoding="multipart/form-data";var fileName=fileUpload.value.split(".")[0];try{form.submit();dialogWindow.close()}catch(e){Jedox.studio.app.showMessageERROR("Application Error".localize(),e.message.localize());return false}};var fileUpload=new Ext.ux.FileUploadField({fieldLabel:"File to Import".localize(),emptyText:"Please choose file".localize(),buttonText:"Browse".localize().concat("..."),defaultAutoCreate:{tag:"input",type:"text",size:"65",autocomplete:"off"},width:420,id:"filepath",name:"import_file"});var importForm=new Ext.FormPanel({baseCls:"x-plain",labelWidth:50,labelAlign:"top",frame:true,bodyStyle:"padding:5px 5px 0",width:450,defaults:{width:410},defaultType:"textfield",buttonAlign:"right",header:false,headerAsText:false,monitorValid:true,title:null,items:[fileUpload,new Ext.form.Hidden({name:"MAX_FILE_SIZE",value:"30000"}),new Ext.form.Hidden({name:"importParentNode",value:parentImNode})]});var dialogWindow=new Ext.Window({id:"importDlg",title:"Import".localize(),cls:"wssdialog",layout:"fit",width:450,height:150,closeable:true,closeAction:"close",autoDestroy:true,plain:true,constrain:true,modal:true,items:[new Ext.Panel({baseCls:"x-title-f",labelWidth:100,labelAlign:"left",layout:"form",bodyStyle:"padding: 10px; color: #000000; font-size: 9pt; background-color: transparent;",frame:false,header:false,monitorValid:true,autoHeight:true,autoWidth:true,items:[importForm]})],buttons:[{text:"Upload".localize(),id:"import-upload-btn",handler:doUploadFile,formBind:true},{text:"Close".localize(),handler:function(){Jedox.studio.app.inputMode=Jedox.studio.app.lastInputMode;dialogWindow.destroy()}}]});dialogWindow.on("beforedestroy",onBeforeDestroyDialog);dialogWindow.on("show",function(){var f=Ext.get("filepath");f.focus.defer(100,f)});Jedox.studio.app.lastInputMode=Jedox.studio.app.inputMode;Jedox.studio.app.inputMode=Jedox.studio.app.inputMode_studio_DEFAULT;dialogWindow.show(this)};Jedox.studio.files.processImport=function(res){if(!res){Jedox.studio.app.showMessageALERT("Error".localize(),"error_importerror".localize())}else{Ext.getCmp("wt-panel").importHandleFnc()}};
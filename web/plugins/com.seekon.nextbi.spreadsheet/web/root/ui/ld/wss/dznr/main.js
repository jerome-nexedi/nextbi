window.undefined=window.undefined;Ext={version:"3.0.3"};Ext.apply=function(d,e,b){if(b){Ext.apply(d,b)}if(d&&e&&typeof e=="object"){for(var a in e){d[a]=e[a]}}return d};(function(){var g=0,s=Object.prototype.toString,t=navigator.userAgent.toLowerCase(),y=function(e){return e.test(t)},i=document,l=i.compatMode=="CSS1Compat",A=y(/opera/),h=y(/chrome/),u=y(/webkit/),x=!h&&y(/safari/),f=x&&y(/applewebkit\/4/),b=x&&y(/version\/3/),B=x&&y(/version\/4/),r=!A&&y(/msie/),p=r&&y(/msie 7/),o=r&&y(/msie 8/),q=r&&!p&&!o,n=!u&&y(/gecko/),d=n&&y(/rv:1\.8/),a=n&&y(/rv:1\.9/),v=r&&!l,z=y(/windows|win32/),k=y(/macintosh|mac os x/),j=y(/adobeair/),m=y(/linux/),c=/^https/i.test(window.location.protocol);if(q){try{i.execCommand("BackgroundImageCache",false,true)}catch(w){}}Ext.apply(Ext,{SSL_SECURE_URL:c&&r?'javascript:""':"about:blank",isStrict:l,isSecure:c,isReady:false,enableGarbageCollector:true,enableListenerCollection:false,USE_NATIVE_JSON:false,applyIf:function(C,D){if(C){for(var e in D){if(!Ext.isDefined(C[e])){C[e]=D[e]}}}return C},id:function(e,C){return(e=Ext.getDom(e)||{}).id=e.id||(C||"ext-gen")+(++g)},extend:function(){var C=function(E){for(var D in E){this[D]=E[D]}};var e=Object.prototype.constructor;return function(J,G,I){if(Ext.isObject(G)){I=G;G=J;J=I.constructor!=e?I.constructor:function(){G.apply(this,arguments)}}var E=function(){},H,D=G.prototype;E.prototype=D;H=J.prototype=new E();H.constructor=J;J.superclass=D;if(D.constructor==e){D.constructor=G}J.override=function(F){Ext.override(J,F)};H.superclass=H.supr=(function(){return D});H.override=C;Ext.override(J,I);J.extend=function(F){return Ext.extend(J,F)};return J}}(),override:function(e,D){if(D){var C=e.prototype;Ext.apply(C,D);if(Ext.isIE&&D.toString!=e.toString){C.toString=D.toString}}},namespace:function(){var C,e;Ext.each(arguments,function(D){e=D.split(".");C=window[e[0]]=window[e[0]]||{};Ext.each(e.slice(1),function(E){C=C[E]=C[E]||{}})});return C},urlEncode:function(G,F){var D,C=[],E=encodeURIComponent;Ext.iterate(G,function(e,H){D=Ext.isEmpty(H);Ext.each(D?e:H,function(I){C.push("&",E(e),"=",(!Ext.isEmpty(I)&&(I!=e||!D))?(Ext.isDate(I)?Ext.encode(I).replace(/"/g,""):E(I)):"")})});if(!F){C.shift();F=""}return F+C.join("")},urlDecode:function(D,C){if(Ext.isEmpty(D)){return{}}var G={},F=D.split("&"),H=decodeURIComponent,e,E;Ext.each(F,function(I){I=I.split("=");e=H(I[0]);E=H(I[1]);G[e]=C||!G[e]?E:[].concat(G[e]).concat(E)});return G},urlAppend:function(e,C){if(!Ext.isEmpty(C)){return e+(e.indexOf("?")===-1?"?":"&")+C}return e},toArray:function(){return r?function(e,E,C,D){D=[];Ext.each(e,function(F){D.push(F)});return D.slice(E||0,C||D.length)}:function(e,D,C){return Array.prototype.slice.call(e,D||0,C||e.length)}}(),isIterable:function(e){if(Ext.isArray(e)||e.callee){return true}if(/NodeList|HTMLCollection/.test(s.call(e))){return true}return((e.nextNode||e.item)&&Ext.isNumber(e.length))},each:function(F,E,D){if(Ext.isEmpty(F,true)){return}if(!Ext.isIterable(F)||Ext.isPrimitive(F)){F=[F]}for(var C=0,e=F.length;C<e;C++){if(E.call(D||F[C],F[C],C,F)===false){return C}}},iterate:function(D,C,e){if(Ext.isEmpty(D)){return}if(Ext.isIterable(D)){Ext.each(D,C,e);return}else{if(Ext.isObject(D)){for(var E in D){if(D.hasOwnProperty(E)){if(C.call(e||D,E,D[E])===false){return}}}}}},getDom:function(e){if(!e||!i){return null}return e.dom?e.dom:(Ext.isString(e)?i.getElementById(e):e)},getBody:function(){return Ext.get(i.body||i.documentElement)},removeNode:r?function(){var e;return function(C){if(C&&C.tagName!="BODY"){e=e||i.createElement("div");e.appendChild(C);e.innerHTML=""}}}():function(e){if(e&&e.parentNode&&e.tagName!="BODY"){e.parentNode.removeChild(e)}},isEmpty:function(C,e){return C===null||C===undefined||((Ext.isArray(C)&&!C.length))||(!e?C==="":false)},isArray:function(e){return s.apply(e)==="[object Array]"},isDate:function(e){return s.apply(e)==="[object Date]"},isObject:function(e){return e&&typeof e=="object"},isPrimitive:function(e){return Ext.isString(e)||Ext.isNumber(e)||Ext.isBoolean(e)},isFunction:function(e){return s.apply(e)==="[object Function]"},isNumber:function(e){return typeof e==="number"&&isFinite(e)},isString:function(e){return typeof e==="string"},isBoolean:function(e){return typeof e==="boolean"},isDefined:function(e){return typeof e!=="undefined"},isOpera:A,isWebKit:u,isChrome:h,isSafari:x,isSafari3:b,isSafari4:B,isSafari2:f,isIE:r,isIE6:q,isIE7:p,isIE8:o,isGecko:n,isGecko2:d,isGecko3:a,isBorderBox:v,isLinux:m,isWindows:z,isMac:k,isAir:j});Ext.ns=Ext.namespace})();Ext.ns("Ext","Ext.util","Ext.lib","Ext.data");Ext.apply(Function.prototype,{createInterceptor:function(b,a){var c=this;return !Ext.isFunction(b)?this:function(){var e=this,d=arguments;b.target=e;b.method=c;return(b.apply(a||e||window,d)!==false)?c.apply(e||window,d):null}},createCallback:function(){var a=arguments,b=this;return function(){return b.apply(window,a)}},createDelegate:function(c,b,a){var d=this;return function(){var f=b||arguments;if(a===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(b)}else{if(Ext.isNumber(a)){f=Array.prototype.slice.call(arguments,0);var e=[a,0].concat(b);Array.prototype.splice.apply(f,e)}}return d.apply(c||window,f)}},defer:function(c,e,b,a){var d=this.createDelegate(e,b,a);if(c>0){return setTimeout(d,c)}d();return 0}});Ext.applyIf(String,{format:function(b){var a=Ext.toArray(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}});Ext.applyIf(Array.prototype,{indexOf:function(b,c){var a=this.length;c=c||0;c+=(c<0)?a:0;for(;c<a;++c){if(this[c]===b){return c}}return -1},remove:function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}return this}});Ext.ns("Ext.grid","Ext.dd","Ext.tree","Ext.form","Ext.menu","Ext.state","Ext.layout","Ext.app","Ext.ux","Ext.chart","Ext.direct");Ext.apply(Ext,function(){var c=Ext,a=0,b=null;return{emptyFn:function(){},BLANK_IMAGE_URL:Ext.isIE6||Ext.isIE7||Ext.isAir?"/spreadsheet/root/ui/lib/ext/resources/images/default/s.gif":"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",extendX:function(d,e){return Ext.extend(d,e(d.prototype))},getDoc:function(){return Ext.get(document)},num:function(e,d){e=Number(Ext.isEmpty(e)||Ext.isBoolean(e)?NaN:e);return isNaN(e)?d:e},value:function(f,d,e){return Ext.isEmpty(f,e)?d:f},escapeRe:function(d){return d.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},sequence:function(g,d,f,e){g[d]=g[d].createSequence(f,e)},addBehaviors:function(h){if(!Ext.isReady){Ext.onReady(function(){Ext.addBehaviors(h)})}else{var e={},g,d,f;for(d in h){if((g=d.split("@"))[1]){f=g[0];if(!e[f]){e[f]=Ext.select(f)}e[f].on(g[1],h[d])}}e=null}},getScrollBarWidth:function(f){if(!Ext.isReady){return 0}if(f===true||b===null){var h=Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),g=h.child("div",true);var e=g.offsetWidth;h.setStyle("overflow",(Ext.isWebKit||Ext.isGecko)?"auto":"scroll");var d=g.offsetWidth;h.remove();b=e-d+2}return b},combine:function(){var f=arguments,e=f.length,h=[];for(var g=0;g<e;g++){var d=f[g];if(Ext.isArray(d)){h=h.concat(d)}else{if(d.length!==undefined&&!d.substr){h=h.concat(Array.prototype.slice.call(d,0))}else{h.push(d)}}}return h},copyTo:function(d,e,f){if(Ext.isString(f)){f=f.split(/[,;\s]/)}Ext.each(f,function(g){if(e.hasOwnProperty(g)){d[g]=e[g]}},this);return d},destroy:function(){Ext.each(arguments,function(d){if(d){if(Ext.isArray(d)){this.destroy.apply(this,d)}else{if(Ext.isFunction(d.destroy)){d.destroy()}else{if(d.dom){d.remove()}}}}},this)},destroyMembers:function(k,h,f,g){for(var j=1,e=arguments,d=e.length;j<d;j++){Ext.destroy(k[e[j]]);delete k[e[j]]}},clean:function(d){var e=[];Ext.each(d,function(f){if(!!f){e.push(f)}});return e},unique:function(d){var e=[],f={};Ext.each(d,function(g){if(!f[g]){e.push(g)}f[g]=true});return e},flatten:function(d){var f=[];function e(g){Ext.each(g,function(h){if(Ext.isArray(h)){e(h)}else{f.push(h)}});return f}return e(d)},min:function(d,e){var f=d[0];e=e||function(h,g){return h<g?-1:1};Ext.each(d,function(g){f=e(f,g)==-1?f:g});return f},max:function(d,e){var f=d[0];e=e||function(h,g){return h>g?1:-1};Ext.each(d,function(g){f=e(f,g)==1?f:g});return f},mean:function(d){return Ext.sum(d)/d.length},sum:function(d){var e=0;Ext.each(d,function(f){e+=f});return e},partition:function(d,e){var f=[[],[]];Ext.each(d,function(h,j,g){f[(e&&e(h,j,g))||(!e&&h)?0:1].push(h)});return f},invoke:function(d,e){var g=[],f=Array.prototype.slice.call(arguments,2);Ext.each(d,function(h,j){if(h&&Ext.isFunction(h[e])){g.push(h[e].apply(h,f))}else{g.push(undefined)}});return g},pluck:function(d,f){var e=[];Ext.each(d,function(g){e.push(g[f])});return e},zip:function(){var m=Ext.partition(arguments,function(i){return !Ext.isFunction(i)}),h=m[0],l=m[1][0],d=Ext.max(Ext.pluck(h,"length")),g=[];for(var k=0;k<d;k++){g[k]=[];if(l){g[k]=l.apply(l,Ext.pluck(h,k))}else{for(var f=0,e=h.length;f<e;f++){g[k].push(h[f][k])}}}return g},getCmp:function(d){return Ext.ComponentMgr.get(d)},useShims:c.isIE6||(c.isMac&&c.isGecko2),type:function(e){if(e===undefined||e===null){return false}if(e.htmlElement){return"element"}var d=typeof e;if(d=="object"&&e.nodeName){switch(e.nodeType){case 1:return"element";case 3:return(/\S/).test(e.nodeValue)?"textnode":"whitespace"}}if(d=="object"||d=="function"){switch(e.constructor){case Array:return"array";case RegExp:return"regexp";case Date:return"date"}if(Ext.isNumber(e.length)&&Ext.isFunction(e.item)){return"nodelist"}}return d},intercept:function(g,d,f,e){g[d]=g[d].createInterceptor(f,e)},callback:function(d,g,f,e){if(Ext.isFunction(d)){if(e){d.defer(e,g,f||[])}else{d.apply(g,f||[])}}}}}());Ext.apply(Function.prototype,{createSequence:function(b,a){var c=this;return !Ext.isFunction(b)?this:function(){var d=c.apply(this||window,arguments);b.apply(a||this||window,arguments);return d}}});Ext.applyIf(String,{escape:function(a){return a.replace(/('|\\)/g,"\\$1")},leftPad:function(d,b,c){var a=String(d);if(!c){c=" "}while(a.length<b){a=c+a}return a}});String.prototype.toggle=function(b,a){return this==b?a:b};String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return this.replace(a,"")}}();Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())};Ext.applyIf(Number.prototype,{constrain:function(b,a){return Math.min(Math.max(this,b),a)}});Ext.util.TaskRunner=function(e){e=e||10;var f=[],a=[],b=0,g=false,d=function(){g=false;clearInterval(b);b=0},h=function(){if(!g){g=true;b=setInterval(i,e)}},c=function(j){a.push(j);if(j.onStop){j.onStop.apply(j.scope||j)}},i=function(){var l=a.length,n=new Date().getTime();if(l>0){for(var p=0;p<l;p++){f.remove(a[p])}a=[];if(f.length<1){d();return}}for(var p=0,o,k,m,j=f.length;p<j;++p){o=f[p];k=n-o.taskRunTime;if(o.interval<=k){m=o.run.apply(o.scope||o,o.args||[++o.taskRunCount]);o.taskRunTime=n;if(m===false||o.taskRunCount===o.repeat){c(o);return}}if(o.duration&&o.duration<=(n-o.taskStartTime)){c(o)}}};this.start=function(j){f.push(j);j.taskStartTime=new Date().getTime();j.taskRunTime=0;j.taskRunCount=0;h();return j};this.stop=function(j){c(j);return j};this.stopAll=function(){d();for(var k=0,j=f.length;k<j;k++){if(f[k].onStop){f[k].onStop()}}f=[];a=[]}};Ext.TaskMgr=new Ext.util.TaskRunner();(function(){var b;function c(d){if(!b){b=new Ext.Element.Flyweight()}b.dom=d;return b}(function(){var g=document,e=g.compatMode=="CSS1Compat",f=Math.max,d=Math.round,h=parseInt;Ext.lib.Dom={isAncestor:function(j,k){var i=false;j=Ext.getDom(j);k=Ext.getDom(k);if(j&&k){if(j.contains){return j.contains(k)}else{if(j.compareDocumentPosition){return !!(j.compareDocumentPosition(k)&16)}else{while(k=k.parentNode){i=k==j||i}}}}return i},getViewWidth:function(i){return i?this.getDocumentWidth():this.getViewportWidth()},getViewHeight:function(i){return i?this.getDocumentHeight():this.getViewportHeight()},getDocumentHeight:function(){return f(!e?g.body.scrollHeight:g.documentElement.scrollHeight,this.getViewportHeight())},getDocumentWidth:function(){return f(!e?g.body.scrollWidth:g.documentElement.scrollWidth,this.getViewportWidth())},getViewportHeight:function(){return Ext.isIE?(Ext.isStrict?g.documentElement.clientHeight:g.body.clientHeight):self.innerHeight},getViewportWidth:function(){return !Ext.isStrict&&!Ext.isOpera?g.body.clientWidth:Ext.isIE?g.documentElement.clientWidth:self.innerWidth},getY:function(i){return this.getXY(i)[1]},getX:function(i){return this.getXY(i)[0]},getXY:function(k){var j,q,s,v,l,m,u=0,r=0,t,i,n=(g.body||g.documentElement),o=[0,0];k=Ext.getDom(k);if(k!=n){if(k.getBoundingClientRect){s=k.getBoundingClientRect();t=c(document).getScroll();o=[d(s.left+t.left),d(s.top+t.top)]}else{j=k;i=c(k).isStyle("position","absolute");while(j){q=c(j);u+=j.offsetLeft;r+=j.offsetTop;i=i||q.isStyle("position","absolute");if(Ext.isGecko){r+=v=h(q.getStyle("borderTopWidth"),10)||0;u+=l=h(q.getStyle("borderLeftWidth"),10)||0;if(j!=k&&!q.isStyle("overflow","visible")){u+=l;r+=v}}j=j.offsetParent}if(Ext.isSafari&&i){u-=n.offsetLeft;r-=n.offsetTop}if(Ext.isGecko&&!i){m=c(n);u+=h(m.getStyle("borderLeftWidth"),10)||0;r+=h(m.getStyle("borderTopWidth"),10)||0}j=k.parentNode;while(j&&j!=n){if(!Ext.isOpera||(j.tagName!="TR"&&!c(j).isStyle("display","inline"))){u-=j.scrollLeft;r-=j.scrollTop}j=j.parentNode}o=[u,r]}}return o},setXY:function(j,k){(j=Ext.fly(j,"_setXY")).position();var l=j.translatePoints(k),i=j.dom.style,m;for(m in l){if(!isNaN(l[m])){i[m]=l[m]+"px"}}},setX:function(j,i){this.setXY(j,[i,false])},setY:function(i,j){this.setXY(i,[false,j])}}})();Ext.lib.Dom.getRegion=function(d){return Ext.lib.Region.getRegion(d)};Ext.lib.Event=function(){var x=false,v=[],g=[],C=0,p=[],d,E=false,k=window,I=document,l=200,s=20,D=0,r=1,i=2,m=3,t=3,y=4,u="scrollLeft",q="scrollTop",f="unload",A="mouseover",H="mouseout",e=function(){var J;if(k.addEventListener){J=function(N,L,M,K){if(L=="mouseenter"){M=M.createInterceptor(o);N.addEventListener(A,M,(K))}else{if(L=="mouseleave"){M=M.createInterceptor(o);N.addEventListener(H,M,(K))}else{N.addEventListener(L,M,(K))}}return M}}else{if(k.attachEvent){J=function(N,L,M,K){N.attachEvent("on"+L,M);return M}}else{J=function(){}}}return J}(),h=function(){var J;if(k.removeEventListener){J=function(N,L,M,K){if(L=="mouseenter"){L=A}else{if(L=="mouseleave"){L=H}}N.removeEventListener(L,M,(K))}}else{if(k.detachEvent){J=function(M,K,L){M.detachEvent("on"+K,L)}}else{J=function(){}}}return J}();function o(J){return !w(J.currentTarget,z.getRelatedTarget(J))}function w(J,K){if(J&&J.firstChild){while(K){if(K===J){return true}K=K.parentNode;if(K&&(K.nodeType!=1)){K=null}}}return false}function B(P,L,O){for(var K,M=-1,J=v.length,N=J-1;N>=0;--N){K=v[N];if(K&&K[i]==O&&K[D]==P&&K[r]==L){M=N;break}}return M}function F(){var J=false,M=[],K,L=!x||(C>0);if(!E){E=true;Ext.each(p,function(O,P,N){if(O&&(K=I.getElementById(O.id))){if(!O.checkReady||x||K.nextSibling||(I&&I.body)){K=O.override?(O.override===true?O.obj:O.override):K;O.fn.call(K,O.obj);p[P]=null}else{M.push(O)}}});C=(M.length===0)?0:C-1;if(L){n()}else{clearInterval(d);d=null}J=!(E=false)}return J}function n(){if(!d){var J=function(){F()};d=setInterval(J,s)}}function G(){var J=I.documentElement,K=I.body;if(J&&(J[q]||J[u])){return[J[u],J[q]]}else{if(K){return[K[u],K[q]]}else{return[0,0]}}}function j(J,K){J=J.browserEvent||J;var L=J["page"+K];if(!L&&L!==0){L=J["client"+K]||0;if(Ext.isIE){L+=G()[K=="X"?0:1]}}return L}var z={onAvailable:function(L,J,M,K){p.push({id:L,fn:J,obj:M,override:K,checkReady:false});C=l;n()},addListener:function(M,J,L){var K;M=Ext.getDom(M);if(M&&L){if(f==J){K=!!(g[g.length]=[M,J,L])}else{v.push([M,J,L,K=e(M,J,L,false)])}}return !!K},removeListener:function(O,K,N){var M=false,L,J;O=Ext.getDom(O);if(!N){M=this.purgeElement(O,false,K)}else{if(f==K){Ext.each(g,function(Q,R,P){if(Q&&Q[0]==O&&Q[1]==K&&Q[2]==N){g.splice(R,1);M=true}})}else{L=arguments[3]||B(O,K,N);J=v[L];if(O&&J){h(O,K,J[m],false);J[m]=J[i]=null;v.splice(L,1);M=true}}}return M},getTarget:function(J){J=J.browserEvent||J;return this.resolveTextNode(J.target||J.srcElement)},resolveTextNode:Ext.isGecko?function(K){if(!K){return}var J=HTMLElement.prototype.toString.call(K);if(J=="[xpconnect wrapped native prototype]"||J=="[object XULElement]"){return}return K.nodeType==3?K.parentNode:K}:function(J){return J&&J.nodeType==3?J.parentNode:J},getRelatedTarget:function(J){J=J.browserEvent||J;return this.resolveTextNode(J.relatedTarget||(J.type==H?J.toElement:J.type==A?J.fromElement:null))},getPageX:function(J){return j(J,"X")},getPageY:function(J){return j(J,"Y")},getXY:function(J){return[this.getPageX(J),this.getPageY(J)]},stopEvent:function(J){this.stopPropagation(J);this.preventDefault(J)},stopPropagation:function(J){J=J.browserEvent||J;if(J.stopPropagation){J.stopPropagation()}else{J.cancelBubble=true}},preventDefault:function(J){J=J.browserEvent||J;if(J.preventDefault){J.preventDefault()}else{J.returnValue=false}},getEvent:function(J){J=J||k.event;if(!J){var K=this.getEvent.caller;while(K){J=K.arguments[0];if(J&&Event==J.constructor){break}K=K.caller}}return J},getCharCode:function(J){J=J.browserEvent||J;return J.charCode||J.keyCode||0},_load:function(K){x=true;var J=Ext.lib.Event;if(Ext.isIE&&K!==true){h(k,"load",arguments.callee)}},purgeElement:function(K,M,J){var L=this;Ext.each(L.getListeners(K,J),function(N){if(N){L.removeListener(K,N.type,N.fn,N.index)}});if(M&&K&&K.childNodes){Ext.each(K.childNodes,function(N){L.purgeElement(N,M,J)})}},getListeners:function(M,K){var N=this,L=[],J;if(K){J=K==f?g:v}else{J=v.concat(g)}Ext.each(J,function(O,P){if(O&&O[D]==M&&(!K||K==O[r])){L.push({type:O[r],fn:O[i],obj:O[t],adjust:O[y],index:P})}});return L.length?L:null},_unload:function(Q){var P=Ext.lib.Event,N,M,K,J,L,O;Ext.each(g,function(R){if(R){try{O=R[y]?(R[y]===true?R[t]:R[y]):k;R[i].call(O,P.getEvent(Q),R[t])}catch(S){}}});g=null;if(v&&(M=v.length)){while(M){if((K=v[L=--M])){P.removeListener(K[D],K[r],K[i],L)}}}h(k,f,P._unload)}};z.on=z.addListener;z.un=z.removeListener;if(I&&I.body){z._load(true)}else{e(k,"load",z._load)}e(k,f,z._unload);F();return z}();Ext.lib.Ajax=function(){var g=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],d="Content-Type";function h(s){var r=s.conn,t;function q(u,v){for(t in v){if(v.hasOwnProperty(t)){u.setRequestHeader(t,v[t])}}}if(k.defaultHeaders){q(r,k.defaultHeaders)}if(k.headers){q(r,k.headers);delete k.headers}}function e(t,s,r,q){return{tId:t,status:r?-1:0,statusText:r?"transaction aborted":"communication failure",isAbort:r,isTimeout:q,argument:s}}function j(q,r){(k.headers=k.headers||{})[q]=r}function o(z,x){var r={},v,w=z.conn,q,u;try{v=z.conn.getAllResponseHeaders();Ext.each(v.replace(/\r\n/g,"\n").split("\n"),function(s){q=s.indexOf(":");if(q>=0){u=s.substr(0,q).toLowerCase();if(s.charAt(q+1)==" "){++q}r[u]=s.substr(q+1)}})}catch(y){}return{tId:z.tId,status:w.status,statusText:w.statusText,getResponseHeader:function(s){return r[s.toLowerCase()]},getAllResponseHeaders:function(){return v},responseText:w.responseText,responseXML:w.responseXML,argument:x}}function n(q){q.conn=null;q=null}function f(v,w,r,q){if(!w){n(v);return}var t,s;try{if(v.conn.status!==undefined&&v.conn.status!=0){t=v.conn.status}else{t=13030}}catch(u){t=13030}if((t>=200&&t<300)||(Ext.isIE&&t==1223)){s=o(v,w.argument);if(w.success){if(!w.scope){w.success(s)}else{w.success.apply(w.scope,[s])}}}else{switch(t){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:s=e(v.tId,w.argument,(r?r:false),q);if(w.failure){if(!w.scope){w.failure(s)}else{w.failure.apply(w.scope,[s])}}break;default:s=o(v,w.argument);if(w.failure){if(!w.scope){w.failure(s)}else{w.failure.apply(w.scope,[s])}}}}n(v);s=null}function m(s,v){v=v||{};var q=s.conn,u=s.tId,r=k.poll,t=v.timeout||null;if(t){k.timeout[u]=setTimeout(function(){k.abort(s,v,true)},t)}r[u]=setInterval(function(){if(q&&q.readyState==4){clearInterval(r[u]);r[u]=null;if(t){clearTimeout(k.timeout[u]);k.timeout[u]=null}f(s,v)}},k.pollInterval)}function i(u,r,t,q){var s=l()||null;if(s){s.conn.open(u,r,true);if(k.useDefaultXhrHeader){j("X-Requested-With",k.defaultXhrHeader)}if(q&&k.useDefaultHeader&&(!k.headers||!k.headers[d])){j(d,k.defaultPostHeader)}if(k.defaultHeaders||k.headers){h(s)}m(s,t);s.conn.send(q||null)}return s}function l(){var r;try{if(r=p(k.transactionId)){k.transactionId++}}catch(q){}finally{return r}}function p(t){var q;try{q=new XMLHttpRequest()}catch(s){for(var r=0;r<g.length;++r){try{q=new ActiveXObject(g[r]);break}catch(s){}}}finally{return{conn:q,tId:t}}}var k={request:function(q,s,t,u,y){if(y){var v=this,r=y.xmlData,w=y.jsonData,x;Ext.applyIf(v,y);if(r||w){x=v.headers;if(!x||!x[d]){j(d,r?"text/xml":"application/json")}u=r||(Ext.isObject(w)?Ext.encode(w):w)}}return i(q||y.method||"POST",s,t,u)},serializeForm:function(r){var s=r.elements||(document.forms[r]||Ext.getDom(r)).elements,y=false,x=encodeURIComponent,v,z,q,t,u="",w;Ext.each(s,function(A){q=A.name;w=A.type;if(!A.disabled&&q){if(/select-(one|multiple)/i.test(w)){Ext.each(A.options,function(B){if(B.selected){u+=String.format("{0}={1}&",x(q),x((B.hasAttribute?B.hasAttribute("value"):B.getAttribute("value")!==null)?B.value:B.text))}})}else{if(!/file|undefined|reset|button/i.test(w)){if(!(/radio|checkbox/i.test(w)&&!A.checked)&&!(w=="submit"&&y)){u+=x(q)+"="+x(A.value)+"&";y=/submit/i.test(w)}}}}});return u.substr(0,u.length-1)},useDefaultHeader:true,defaultPostHeader:"application/x-www-form-urlencoded; charset=UTF-8",useDefaultXhrHeader:true,defaultXhrHeader:"XMLHttpRequest",poll:{},timeout:{},pollInterval:50,transactionId:0,abort:function(t,v,q){var s=this,u=t.tId,r=false;if(s.isCallInProgress(t)){t.conn.abort();clearInterval(s.poll[u]);s.poll[u]=null;if(q){s.timeout[u]=null}f(t,v,(r=true),q)}return r},isCallInProgress:function(q){return q.conn&&!{0:true,4:true}[q.conn.readyState]}};return k}();Ext.lib.Region=function(f,h,d,e){var g=this;g.top=f;g[1]=f;g.right=h;g.bottom=d;g.left=e;g[0]=e};Ext.lib.Region.prototype={contains:function(e){var d=this;return(e.left>=d.left&&e.right<=d.right&&e.top>=d.top&&e.bottom<=d.bottom)},getArea:function(){var d=this;return((d.bottom-d.top)*(d.right-d.left))},intersect:function(i){var h=this,f=Math.max(h.top,i.top),g=Math.min(h.right,i.right),d=Math.min(h.bottom,i.bottom),e=Math.max(h.left,i.left);if(d>=f&&g>=e){return new Ext.lib.Region(f,g,d,e)}},union:function(i){var h=this,f=Math.min(h.top,i.top),g=Math.max(h.right,i.right),d=Math.max(h.bottom,i.bottom),e=Math.min(h.left,i.left);return new Ext.lib.Region(f,g,d,e)},constrainTo:function(e){var d=this;d.top=d.top.constrain(e.top,e.bottom);d.bottom=d.bottom.constrain(e.top,e.bottom);d.left=d.left.constrain(e.left,e.right);d.right=d.right.constrain(e.left,e.right);return d},adjust:function(f,e,d,h){var g=this;g.top+=f;g.left+=e;g.right+=h;g.bottom+=d;return g}};Ext.lib.Region.getRegion=function(g){var i=Ext.lib.Dom.getXY(g),f=i[1],h=i[0]+g.offsetWidth,d=i[1]+g.offsetHeight,e=i[0];return new Ext.lib.Region(f,h,d,e)};Ext.lib.Point=function(d,f){if(Ext.isArray(d)){f=d[1];d=d[0]}var e=this;e.x=e.right=e.left=e[0]=d;e.y=e.top=e.bottom=e[1]=f};Ext.lib.Point.prototype=new Ext.lib.Region();(function(){var g=Ext.lib,i=/width|height|opacity|padding/i,f=/^((width|height)|(top|left))$/,d=/width|height|top$|bottom$|left$|right$/i,h=/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i,j=function(k){return typeof k!=="undefined"},e=function(){return new Date()};g.Anim={motion:function(n,l,o,p,k,m){return this.run(n,l,o,p,k,m,Ext.lib.Motion)},run:function(o,l,q,r,k,n,m){m=m||Ext.lib.AnimBase;if(typeof r=="string"){r=Ext.lib.Easing[r]}var p=new m(o,l,q,r);p.animateX(function(){if(Ext.isFunction(k)){k.call(n)}});return p}};g.AnimBase=function(l,k,m,n){if(l){this.init(l,k,m,n)}};g.AnimBase.prototype={doMethod:function(k,n,l){var m=this;return m.method(m.curFrame,n,l-n,m.totalFrames)},setAttr:function(k,m,l){if(i.test(k)&&m<0){m=0}Ext.fly(this.el,"_anim").setStyle(k,m+l)},getAttr:function(k){var m=Ext.fly(this.el),n=m.getStyle(k),l=f.exec(k)||[];if(n!=="auto"&&!h.test(n)){return parseFloat(n)}return(!!(l[2])||(m.getStyle("position")=="absolute"&&!!(l[3])))?m.dom["offset"+l[0].charAt(0).toUpperCase()+l[0].substr(1)]:0},getDefaultUnit:function(k){return d.test(k)?"px":""},animateX:function(n,k){var l=this,m=function(){l.onComplete.removeListener(m);if(Ext.isFunction(n)){n.call(k||l,l)}};l.onComplete.addListener(m,l);l.animate()},setRunAttr:function(n){var p=this,q=this.attributes[n],r=q.to,o=q.by,s=q.from,t=q.unit,l=(this.runAttrs[n]={}),m;if(!j(r)&&!j(o)){return false}var k=j(s)?s:p.getAttr(n);if(j(r)){m=r}else{if(j(o)){if(Ext.isArray(k)){m=[];Ext.each(k,function(u,w){m[w]=u+o[w]})}else{m=k+o}}}Ext.apply(l,{start:k,end:m,unit:j(t)?t:p.getDefaultUnit(n)})},init:function(l,p,o,k){var r=this,n=0,s=g.AnimMgr;Ext.apply(r,{isAnimated:false,startTime:null,el:Ext.getDom(l),attributes:p||{},duration:o||1,method:k||g.Easing.easeNone,useSec:true,curFrame:0,totalFrames:s.fps,runAttrs:{},animate:function(){var u=this,v=u.duration;if(u.isAnimated){return false}u.curFrame=0;u.totalFrames=u.useSec?Math.ceil(s.fps*v):v;s.registerElement(u)},stop:function(u){var v=this;if(u){v.curFrame=v.totalFrames;v._onTween.fire()}s.stop(v)}});var t=function(){var v=this,u;v.onStart.fire();v.runAttrs={};for(u in this.attributes){this.setRunAttr(u)}v.isAnimated=true;v.startTime=e();n=0};var q=function(){var v=this;v.onTween.fire({duration:e()-v.startTime,curFrame:v.curFrame});var w=v.runAttrs;for(var u in w){this.setAttr(u,v.doMethod(u,w[u].start,w[u].end),w[u].unit)}++n};var m=function(){var u=this,w=(e()-u.startTime)/1000,v={duration:w,frames:n,fps:n/w};u.isAnimated=false;n=0;u.onComplete.fire(v)};r.onStart=new Ext.util.Event(r);r.onTween=new Ext.util.Event(r);r.onComplete=new Ext.util.Event(r);(r._onStart=new Ext.util.Event(r)).addListener(t);(r._onTween=new Ext.util.Event(r)).addListener(q);(r._onComplete=new Ext.util.Event(r)).addListener(m)}};Ext.lib.AnimMgr=new function(){var o=this,m=null,l=[],k=0;Ext.apply(o,{fps:1000,delay:1,registerElement:function(q){l.push(q);++k;q._onStart.fire();o.start()},unRegister:function(r,q){r._onComplete.fire();q=q||p(r);if(q!=-1){l.splice(q,1)}if(--k<=0){o.stop()}},start:function(){if(m===null){m=setInterval(o.run,o.delay)}},stop:function(s){if(!s){clearInterval(m);for(var r=0,q=l.length;r<q;++r){if(l[0].isAnimated){o.unRegister(l[0],0)}}l=[];m=null;k=0}else{o.unRegister(s)}},run:function(){var q;Ext.each(l,function(r){if(r&&r.isAnimated){q=r.totalFrames;if(r.curFrame<q||q===null){++r.curFrame;if(r.useSec){n(r)}r._onTween.fire()}else{o.stop(r)}}},o)}});var p=function(r){var q=-1;Ext.each(l,function(t,s){if(t==r){q=s;return false}});return q};var n=function(r){var v=r.totalFrames,u=r.curFrame,t=r.duration,s=(u*t*1000/v),q=(e()-r.startTime),w=0;if(q<t*1000){w=Math.round((q/s-1)*u)}else{w=v-(u+1)}if(w>0&&isFinite(w)){if(r.curFrame+w>=v){w=v-(u+1)}r.curFrame+=w}}};g.Bezier=new function(){this.getPosition=function(p,o){var r=p.length,m=[],q=1-o,l,k;for(l=0;l<r;++l){m[l]=[p[l][0],p[l][1]]}for(k=1;k<r;++k){for(l=0;l<r-k;++l){m[l][0]=q*m[l][0]+o*m[parseInt(l+1,10)][0];m[l][1]=q*m[l][1]+o*m[parseInt(l+1,10)][1]}}return[m[0][0],m[0][1]]}};g.Easing={easeNone:function(l,k,n,m){return n*l/m+k},easeIn:function(l,k,n,m){return n*(l/=m)*l+k},easeOut:function(l,k,n,m){return -n*(l/=m)*(l-2)+k}};(function(){g.Motion=function(p,o,q,r){if(p){g.Motion.superclass.constructor.call(this,p,o,q,r)}};Ext.extend(g.Motion,Ext.lib.AnimBase);var n=g.Motion.superclass,m=g.Motion.prototype,l=/^points$/i;Ext.apply(g.Motion.prototype,{setAttr:function(o,s,r){var q=this,p=n.setAttr;if(l.test(o)){r=r||"px";p.call(q,"left",s[0],r);p.call(q,"top",s[1],r)}else{p.call(q,o,s,r)}},getAttr:function(o){var q=this,p=n.getAttr;return l.test(o)?[p.call(q,"left"),p.call(q,"top")]:p.call(q,o)},doMethod:function(o,r,p){var q=this;return l.test(o)?g.Bezier.getPosition(q.runAttrs[o],q.method(q.curFrame,0,100,q.totalFrames)/100):n.doMethod.call(q,o,r,p)},setRunAttr:function(v){if(l.test(v)){var x=this,q=this.el,A=this.attributes.points,t=A.control||[],y=A.from,z=A.to,w=A.by,B=g.Dom,p,s,r,u,o;if(t.length>0&&!Ext.isArray(t[0])){t=[t]}else{}Ext.fly(q,"_anim").position();B.setXY(q,j(y)?y:B.getXY(q));p=x.getAttr("points");if(j(z)){r=k.call(x,z,p);for(s=0,u=t.length;s<u;++s){t[s]=k.call(x,t[s],p)}}else{if(j(w)){r=[p[0]+w[0],p[1]+w[1]];for(s=0,u=t.length;s<u;++s){t[s]=[p[0]+t[s][0],p[1]+t[s][1]]}}}o=this.runAttrs[v]=[p];if(t.length>0){o=o.concat(t)}o[o.length]=r}else{n.setRunAttr.call(this,v)}}});var k=function(o,q){var p=g.Dom.getXY(this.el);return[o[0]-p[0]+q[0],o[1]-p[1]+q[1]]}})()})();(function(){var d=Math.abs,i=Math.PI,h=Math.asin,g=Math.pow,e=Math.sin,f=Ext.lib;Ext.apply(f.Easing,{easeBoth:function(k,j,m,l){return((k/=l/2)<1)?m/2*k*k+j:-m/2*((--k)*(k-2)-1)+j},easeInStrong:function(k,j,m,l){return m*(k/=l)*k*k*k+j},easeOutStrong:function(k,j,m,l){return -m*((k=k/l-1)*k*k*k-1)+j},easeBothStrong:function(k,j,m,l){return((k/=l/2)<1)?m/2*k*k*k*k+j:-m/2*((k-=2)*k*k*k-2)+j},elasticIn:function(l,j,q,o,k,n){if(l==0||(l/=o)==1){return l==0?j:j+q}n=n||(o*0.3);var m;if(k>=d(q)){m=n/(2*i)*h(q/k)}else{k=q;m=n/4}return -(k*g(2,10*(l-=1))*e((l*o-m)*(2*i)/n))+j},elasticOut:function(l,j,q,o,k,n){if(l==0||(l/=o)==1){return l==0?j:j+q}n=n||(o*0.3);var m;if(k>=d(q)){m=n/(2*i)*h(q/k)}else{k=q;m=n/4}return k*g(2,-10*l)*e((l*o-m)*(2*i)/n)+q+j},elasticBoth:function(l,j,q,o,k,n){if(l==0||(l/=o/2)==2){return l==0?j:j+q}n=n||(o*(0.3*1.5));var m;if(k>=d(q)){m=n/(2*i)*h(q/k)}else{k=q;m=n/4}return l<1?-0.5*(k*g(2,10*(l-=1))*e((l*o-m)*(2*i)/n))+j:k*g(2,-10*(l-=1))*e((l*o-m)*(2*i)/n)*0.5+q+j},backIn:function(k,j,n,m,l){l=l||1.70158;return n*(k/=m)*k*((l+1)*k-l)+j},backOut:function(k,j,n,m,l){if(!l){l=1.70158}return n*((k=k/m-1)*k*((l+1)*k+l)+1)+j},backBoth:function(k,j,n,m,l){l=l||1.70158;return((k/=m/2)<1)?n/2*(k*k*(((l*=(1.525))+1)*k-l))+j:n/2*((k-=2)*k*(((l*=(1.525))+1)*k+l)+2)+j},bounceIn:function(k,j,m,l){return m-f.Easing.bounceOut(l-k,0,m,l)+j},bounceOut:function(k,j,m,l){if((k/=l)<(1/2.75)){return m*(7.5625*k*k)+j}else{if(k<(2/2.75)){return m*(7.5625*(k-=(1.5/2.75))*k+0.75)+j}else{if(k<(2.5/2.75)){return m*(7.5625*(k-=(2.25/2.75))*k+0.9375)+j}}}return m*(7.5625*(k-=(2.625/2.75))*k+0.984375)+j},bounceBoth:function(k,j,m,l){return(k<l/2)?f.Easing.bounceIn(k*2,0,m,l)*0.5+j:f.Easing.bounceOut(k*2-l,0,m,l)*0.5+m*0.5+j}})})();(function(){var h=Ext.lib;h.Anim.color=function(p,n,q,r,m,o){return h.Anim.run(p,n,q,r,m,o,h.ColorAnim)};h.ColorAnim=function(n,m,o,p){h.ColorAnim.superclass.constructor.call(this,n,m,o,p)};Ext.extend(h.ColorAnim,h.AnimBase);var j=h.ColorAnim.superclass,i=/color$/i,f=/^transparent|rgba\(0, 0, 0, 0\)$/,l=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,d=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,e=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,g=function(m){return typeof m!=="undefined"};function k(n){var p=parseInt,o,m=null,q;if(n.length==3){return n}Ext.each([d,l,e],function(s,r){o=(r%2==0)?16:10;q=s.exec(n);if(q&&q.length==4){m=[p(q[1],o),p(q[2],o),p(q[3],o)];return false}});return m}Ext.apply(h.ColorAnim.prototype,{getAttr:function(m){var o=this,n=o.el,p;if(i.test(m)){while(n&&f.test(p=Ext.fly(n).getStyle(m))){n=n.parentNode;p="fff"}}else{p=j.getAttr.call(o,m)}return p},doMethod:function(m,r,n){var p=this,q,o=Math.floor;if(i.test(m)){q=[];Ext.each(r,function(s,t){q[t]=j.doMethod.call(p,m,s,n[t])});q="rgb("+o(q[0])+","+o(q[1])+","+o(q[2])+")"}else{q=j.doMethod.call(p,m,r,n)}return q},setRunAttr:function(m){var p=this,o=p.attributes[m],t=o.to,q=o.by,r;j.setRunAttr.call(p,m);r=p.runAttrs[m];if(i.test(m)){var s=k(r.start),n=k(r.end);if(!g(t)&&g(q)){n=k(q);Ext.each(s,function(v,u){n[u]=v+n[u]})}r.start=s;r.end=n}}})})();(function(){var d=Ext.lib;d.Anim.scroll=function(j,h,k,l,g,i){return d.Anim.run(j,h,k,l,g,i,d.Scroll)};d.Scroll=function(h,g,i,j){if(h){d.Scroll.superclass.constructor.call(this,h,g,i,j)}};Ext.extend(d.Scroll,d.ColorAnim);var f=d.Scroll.superclass,e="scroll";Ext.apply(d.Scroll.prototype,{doMethod:function(g,m,h){var k,j=this,l=j.curFrame,i=j.totalFrames;if(g==e){k=[j.method(l,m[0],h[0]-m[0],i),j.method(l,m[1],h[1]-m[1],i)]}else{k=f.doMethod.call(j,g,m,h)}return k},getAttr:function(g){var h=this;if(g==e){return[h.el.scrollLeft,h.el.scrollTop]}else{return f.getAttr.call(h,g)}},setAttr:function(g,j,i){var h=this;if(g==e){h.el.scrollLeft=j[0];h.el.scrollTop=j[1]}else{f.setAttr.call(h,g,j,i)}}})})();if(Ext.isIE){function a(){var d=Function.prototype;delete d.createSequence;delete d.defer;delete d.createDelegate;delete d.createCallback;delete d.createInterceptor;window.detachEvent("onunload",a)}window.attachEvent("onunload",a)}})();
/*
 * Ext JS Library 3.0.3
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.DomHelper=function(){var tempTableEl=null,emptyTags=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,tableRe=/^table|tbody|tr|td$/i,pub,afterbegin="afterbegin",afterend="afterend",beforebegin="beforebegin",beforeend="beforeend",ts="<table>",te="</table>",tbs=ts+"<tbody>",tbe="</tbody>"+te,trs=tbs+"<tr>",tre="</tr>"+tbe;function doInsert(el,o,returnElement,pos,sibling,append){var newNode=pub.insertHtml(pos,Ext.getDom(el),createHtml(o));return returnElement?Ext.get(newNode,true):newNode}function createHtml(o){var b="",attr,val,key,keyVal,cn;if(Ext.isString(o)){b=o}else{if(Ext.isArray(o)){Ext.each(o,function(v){b+=createHtml(v)})}else{b+="<"+(o.tag=o.tag||"div");Ext.iterate(o,function(attr,val){if(!/tag|children|cn|html$/i.test(attr)){if(Ext.isObject(val)){b+=" "+attr+'="';Ext.iterate(val,function(key,keyVal){b+=key+":"+keyVal+";"});b+='"'}else{b+=" "+({cls:"class",htmlFor:"for"}[attr]||attr)+'="'+val+'"'}}});if(emptyTags.test(o.tag)){b+="/>"}else{b+=">";if((cn=o.children||o.cn)){b+=createHtml(cn)}else{if(o.html){b+=o.html}}b+="</"+o.tag+">"}}}return b}function ieTable(depth,s,h,e){tempTableEl.innerHTML=[s,h,e].join("");var i=-1,el=tempTableEl,ns;while(++i<depth){el=el.firstChild}if(ns=el.nextSibling){var df=document.createDocumentFragment();while(el){ns=el.nextSibling;df.appendChild(el);el=ns}el=df}return el}function insertIntoTable(tag,where,el,html){var node,before;tempTableEl=tempTableEl||document.createElement("div");if(tag=="td"&&(where==afterbegin||where==beforeend)||!/td|tr|tbody/i.test(tag)&&(where==beforebegin||where==afterend)){return}before=where==beforebegin?el:where==afterend?el.nextSibling:where==afterbegin?el.firstChild:null;if(where==beforebegin||where==afterend){el=el.parentNode}if(tag=="td"||(tag=="tr"&&(where==beforeend||where==afterbegin))){node=ieTable(4,trs,html,tre)}else{if((tag=="tbody"&&(where==beforeend||where==afterbegin))||(tag=="tr"&&(where==beforebegin||where==afterend))){node=ieTable(3,tbs,html,tbe)}else{node=ieTable(2,ts,html,te)}}el.insertBefore(node,before);return node}pub={markup:function(o){return createHtml(o)},applyStyles:function(el,styles){if(styles){var i=0,len,style;el=Ext.fly(el);if(Ext.isFunction(styles)){styles=styles.call()}if(Ext.isString(styles)){styles=styles.trim().split(/\s*(?::|;)\s*/);for(len=styles.length;i<len;){el.setStyle(styles[i++],styles[i++])}}else{if(Ext.isObject(styles)){el.setStyle(styles)}}}},insertHtml:function(where,el,html){var hash={},hashVal,setStart,range,frag,rangeEl,rs;where=where.toLowerCase();hash[beforebegin]=["BeforeBegin","previousSibling"];hash[afterend]=["AfterEnd","nextSibling"];if(el.insertAdjacentHTML){if(tableRe.test(el.tagName)&&(rs=insertIntoTable(el.tagName.toLowerCase(),where,el,html))){return rs}hash[afterbegin]=["AfterBegin","firstChild"];hash[beforeend]=["BeforeEnd","lastChild"];if((hashVal=hash[where])){el.insertAdjacentHTML(hashVal[0],html);return el[hashVal[1]]}}else{range=el.ownerDocument.createRange();setStart="setStart"+(/end/i.test(where)?"After":"Before");if(hash[where]){range[setStart](el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,where==beforebegin?el:el.nextSibling);return el[(where==beforebegin?"previous":"next")+"Sibling"]}else{rangeEl=(where==afterbegin?"first":"last")+"Child";if(el.firstChild){range[setStart](el[rangeEl]);frag=range.createContextualFragment(html);if(where==afterbegin){el.insertBefore(frag,el.firstChild)}else{el.appendChild(frag)}}else{el.innerHTML=html}return el[rangeEl]}}throw'Illegal insertion point -> "'+where+'"'},insertBefore:function(el,o,returnElement){return doInsert(el,o,returnElement,beforebegin)},insertAfter:function(el,o,returnElement){return doInsert(el,o,returnElement,afterend,"nextSibling")},insertFirst:function(el,o,returnElement){return doInsert(el,o,returnElement,afterbegin,"firstChild")},append:function(el,o,returnElement){return doInsert(el,o,returnElement,beforeend,"",true)},overwrite:function(el,o,returnElement){el=Ext.getDom(el);el.innerHTML=createHtml(o);return returnElement?Ext.get(el.firstChild):el.firstChild},createHtml:createHtml};return pub}();Ext.apply(Ext.DomHelper,function(){var pub,afterbegin="afterbegin",afterend="afterend",beforebegin="beforebegin",beforeend="beforeend";function doInsert(el,o,returnElement,pos,sibling,append){el=Ext.getDom(el);var newNode;if(pub.useDom){newNode=createDom(o,null);if(append){el.appendChild(newNode)}else{(sibling=="firstChild"?el:el.parentNode).insertBefore(newNode,el[sibling]||el)}}else{newNode=Ext.DomHelper.insertHtml(pos,el,Ext.DomHelper.createHtml(o))}return returnElement?Ext.get(newNode,true):newNode}function createDom(o,parentNode){var el,doc=document,useSet,attr,val,cn;if(Ext.isArray(o)){el=doc.createDocumentFragment();Ext.each(o,function(v){createDom(v,el)})}else{if(Ext.isString(o)){el=doc.createTextNode(o)}else{el=doc.createElement(o.tag||"div");useSet=!!el.setAttribute;Ext.iterate(o,function(attr,val){if(!/tag|children|cn|html|style/.test(attr)){if(attr=="cls"){el.className=val}else{if(useSet){el.setAttribute(attr,val)}else{el[attr]=val}}}});Ext.DomHelper.applyStyles(el,o.style);if((cn=o.children||o.cn)){createDom(cn,el)}else{if(o.html){el.innerHTML=o.html}}}}if(parentNode){parentNode.appendChild(el)}return el}pub={createTemplate:function(o){var html=Ext.DomHelper.createHtml(o);return new Ext.Template(html)},useDom:false,insertBefore:function(el,o,returnElement){return doInsert(el,o,returnElement,beforebegin)},insertAfter:function(el,o,returnElement){return doInsert(el,o,returnElement,afterend,"nextSibling")},insertFirst:function(el,o,returnElement){return doInsert(el,o,returnElement,afterbegin,"firstChild")},append:function(el,o,returnElement){return doInsert(el,o,returnElement,beforeend,"",true)},createDom:createDom};return pub}());Ext.Template=function(html){var me=this,a=arguments,buf=[];if(Ext.isArray(html)){html=html.join("")}else{if(a.length>1){Ext.each(a,function(v){if(Ext.isObject(v)){Ext.apply(me,v)}else{buf.push(v)}});html=buf.join("")}}me.html=html;if(me.compiled){me.compile()}};Ext.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(values){var me=this;return me.compiled?me.compiled(values):me.html.replace(me.re,function(m,name){return values[name]!==undefined?values[name]:""})},set:function(html,compile){var me=this;me.html=html;me.compiled=null;return compile?me.compile():me},compile:function(){var me=this,sep=Ext.isGecko?"+":",";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}eval("this.compiled = function(values){ return "+(Ext.isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(Ext.isGecko?"';};":"'].join('');};"));return me},insertFirst:function(el,values,returnElement){return this.doInsert("afterBegin",el,values,returnElement)},insertBefore:function(el,values,returnElement){return this.doInsert("beforeBegin",el,values,returnElement)},insertAfter:function(el,values,returnElement){return this.doInsert("afterEnd",el,values,returnElement)},append:function(el,values,returnElement){return this.doInsert("beforeEnd",el,values,returnElement)},doInsert:function(where,el,values,returnEl){el=Ext.getDom(el);var newNode=Ext.DomHelper.insertHtml(where,el,this.applyTemplate(values));return returnEl?Ext.get(newNode,true):newNode},overwrite:function(el,values,returnElement){el=Ext.getDom(el);el.innerHTML=this.applyTemplate(values);return returnElement?Ext.get(el.firstChild,true):el.firstChild}};Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;Ext.Template.from=function(el,config){el=Ext.getDom(el);return new Ext.Template(el.value||el.innerHTML,config||"")};Ext.apply(Ext.Template.prototype,{disableFormats:false,re:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,applyTemplate:function(values){var me=this,useF=me.disableFormats!==true,fm=Ext.util.Format,tpl=me;if(me.compiled){return me.compiled(values)}function fn(m,name,format,args){if(format&&useF){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=/^\s*['"](.*)["']\s*$/;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}}return me.html.replace(me.re,fn)},compile:function(){var me=this,fm=Ext.util.Format,useF=me.disableFormats!==true,sep=Ext.isGecko?"+":",",body;function fn(m,name,format,args){if(format&&useF){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"}if(Ext.isGecko){body="this.compiled = function(values){ return '"+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn));body.push("'].join('');};");body=body.join("")}eval(body);return me},call:function(fnName,value,allValues){return this[fnName](value,allValues)}});Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;Ext.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/>+~]\s?|\s|$)/,tagTokenRe=/^(#)?([\w-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,isOpera=Ext.isOpera,key=30803;eval("var batch = 30803;");function child(p,index){var i=0,n=p.firstChild;while(n){if(n.nodeType==1){if(++i==index){return n}}n=n.nextSibling}return null}function next(n){while((n=n.nextSibling)&&n.nodeType!=1){}return n}function prev(n){while((n=n.previousSibling)&&n.nodeType!=1){}return n}function children(d){var n=d.firstChild,ni=-1,nx;while(n){nx=n.nextSibling;if(n.nodeType==3&&!nonSpace.test(n.nodeValue)){d.removeChild(n)}else{n.nodeIndex=++ni}n=nx}return this}function byClassName(c,a,v){if(!v){return c}var r=[],ri=-1,cn;for(var i=0,ci;ci=c[i];i++){if((" "+ci.className+" ").indexOf(v)!=-1){r[++ri]=ci}}return r}function attrValue(n,attr){if(!n.tagName&&typeof n.length!="undefined"){n=n[0]}if(!n){return null}if(attr=="for"){return n.htmlFor}if(attr=="class"||attr=="className"){return n.className}return n.getAttribute(attr)||n[attr]}function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;if(!ns){return result}tagName=tagName||"*";if(typeof ns.getElementsByTagName!="undefined"){ns=[ns]}if(!mode){for(var i=0,ni;ni=ns[i];i++){cs=ni.getElementsByTagName(tagName);for(var j=0,ci;ci=cs[j];j++){result[++ri]=ci}}}else{if(mode=="/"||mode==">"){var utag=tagName.toUpperCase();for(var i=0,ni,cn;ni=ns[i];i++){cn=isOpera?ni.childNodes:(ni.children||ni.childNodes);for(var j=0,cj;cj=cn[j];j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName=="*"){result[++ri]=cj}}}}else{if(mode=="+"){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(n&&(n.nodeName==utag||n.nodeName==tagName||tagName=="*")){result[++ri]=n}}}else{if(mode=="~"){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName=="*"){result[++ri]=n}}}}}}}return result}function concat(a,b){if(b.slice){return a.concat(b)}for(var i=0,l=b.length;i<l;i++){a[a.length]=b[i]}return a}function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs]}if(!tagName){return cs}var r=[],ri=-1;tagName=tagName.toLowerCase();for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType==1&&ci.tagName.toLowerCase()==tagName){r[++ri]=ci}}return r}function byId(cs,attr,id){if(cs.tagName||cs==document){cs=[cs]}if(!id){return cs}var r=[],ri=-1;for(var i=0,ci;ci=cs[i];i++){if(ci&&ci.id==id){r[++ri]=ci;return r}}return r}function byAttribute(cs,attr,value,op,custom){var r=[],ri=-1,st=custom=="{",f=Ext.DomQuery.operators[op];for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType!=1){continue}var a;if(st){a=Ext.DomQuery.getStyle(ci,attr)}else{if(attr=="class"||attr=="className"){a=ci.className}else{if(attr=="for"){a=ci.htmlFor}else{if(attr=="href"){a=ci.getAttribute("href",2)}else{a=ci.getAttribute(attr)}}}}if((f&&f(a,value))||(!f&&a)){r[++ri]=ci}}return r}function byPseudo(cs,name,value){return Ext.DomQuery.pseudos[name](cs,value)}function nodupIEXml(cs){var d=++key,r;cs[0].setAttribute("_nodup",d);r=[cs[0]];for(var i=1,len=cs.length;i<len;i++){var c=cs[i];if(!c.getAttribute("_nodup")!=d){c.setAttribute("_nodup",d);r[r.length]=c}}for(var i=0,len=cs.length;i<len;i++){cs[i].removeAttribute("_nodup")}return r}function nodup(cs){if(!cs){return[]}var len=cs.length,c,i,r=cs,cj,ri=-1;if(!len||typeof cs.nodeType!="undefined"||len==1){return cs}if(isIE&&typeof cs[0].selectSingleNode!="undefined"){return nodupIEXml(cs)}var d=++key;cs[0]._nodup=d;for(i=1;c=cs[i];i++){if(c._nodup!=d){c._nodup=d}else{r=[];for(var j=0;j<i;j++){r[++ri]=cs[j]}for(j=i+1;cj=cs[j];j++){if(cj._nodup!=d){cj._nodup=d;r[++ri]=cj}}return r}}return r}function quickDiffIEXml(c1,c2){var d=++key,r=[];for(var i=0,len=c1.length;i<len;i++){c1[i].setAttribute("_qdiff",d)}for(var i=0,len=c2.length;i<len;i++){if(c2[i].getAttribute("_qdiff")!=d){r[r.length]=c2[i]}}for(var i=0,len=c1.length;i<len;i++){c1[i].removeAttribute("_qdiff")}return r}function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];if(!len1){return c2}if(isIE&&c1[0].selectSingleNode){return quickDiffIEXml(c1,c2)}for(var i=0;i<len1;i++){c1[i]._qdiff=d}for(var i=0,len=c2.length;i<len;i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i]}}return r}function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;return d.getElementById(id)}ns=getNodes(ns,mode,"*");return byId(ns,null,id)}return{getStyle:function(el,name){return Ext.fly(el).getStyle(name)},compile:function(path,type){type=type||"select";var fn=["var f = function(root){\n var mode; ++batch; var n = root || document;\n"],q=path,mode,lq,tk=Ext.DomQuery.matchers,tklen=tk.length,mm,lmode=q.match(modeRe);if(lmode&&lmode[1]){fn[fn.length]='mode="'+lmode[1].replace(trimRe,"")+'";';q=q.replace(lmode[1],"")}while(path.substr(0,1)=="/"){path=path.substr(1)}while(q&&lq!=q){lq=q;var tm=q.match(tagTokenRe);if(type=="select"){if(tm){if(tm[1]=="#"){fn[fn.length]='n = quickId(n, mode, root, "'+tm[2]+'");'}else{fn[fn.length]='n = getNodes(n, mode, "'+tm[2]+'");'}q=q.replace(tm[0],"")}else{if(q.substr(0,1)!="@"){fn[fn.length]='n = getNodes(n, mode, "*");'}}}else{if(tm){if(tm[1]=="#"){fn[fn.length]='n = byId(n, null, "'+tm[2]+'");'}else{fn[fn.length]='n = byTag(n, "'+tm[2]+'");'}q=q.replace(tm[0],"")}}while(!(mm=q.match(modeRe))){var matched=false;for(var j=0;j<tklen;j++){var t=tk[j];var m=q.match(t.re);if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i]});q=q.replace(m[0],"");matched=true;break}}if(!matched){throw'Error parsing selector, parsing failed at "'+q+'"'}}if(mm[1]){fn[fn.length]='mode="'+mm[1].replace(trimRe,"")+'";';q=q.replace(mm[1],"")}}fn[fn.length]="return nodup(n);\n}";eval(fn.join(""));return f},select:function(path,root,type){if(!root||root==document){root=document}if(typeof root=="string"){root=document.getElementById(root)}var paths=path.split(","),results=[];for(var i=0,len=paths.length;i<len;i++){var p=paths[i].replace(trimRe,"");if(!cache[p]){cache[p]=Ext.DomQuery.compile(p);if(!cache[p]){throw p+" is not a valid selector"}}var result=cache[p](root);if(result&&result!=document){results=results.concat(result)}}if(paths.length>1){return nodup(results)}return results},selectNode:function(path,root){return Ext.DomQuery.select(path,root)[0]},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,"");if(!valueCache[path]){valueCache[path]=Ext.DomQuery.compile(path,"select")}var n=valueCache[path](root),v;n=n[0]?n[0]:n;v=(n&&n.firstChild?n.firstChild.nodeValue:null);return((v===null||v===undefined||v==="")?defaultValue:v)},selectNumber:function(path,root,defaultValue){var v=Ext.DomQuery.selectValue(path,root,defaultValue||0);return parseFloat(v)},is:function(el,ss){if(typeof el=="string"){el=document.getElementById(el)}var isArray=Ext.isArray(el),result=Ext.DomQuery.filter(isArray?el:[el],ss);return isArray?(result.length==el.length):(result.length>0)},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,"");if(!simpleCache[ss]){simpleCache[ss]=Ext.DomQuery.compile(ss,"simple")}var result=simpleCache[ss](els);return nonMatches?quickDiff(result,els):result},matchers:[{re:/^\.([\w-]+)/,select:'n = byClassName(n, null, " {1} ");'},{re:/^\:([\w-]+)(?:\(((?:[^\s>\/]*|.*?))\))?/,select:'n = byPseudo(n, "{1}", "{2}");'},{re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]\}])/,select:'n = byAttribute(n, "{2}", "{4}", "{3}", "{1}");'},{re:/^#([\w-]+)/,select:'n = byId(n, null, "{1}");'},{re:/^@([\w-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, "{1}")}};'}],operators:{"=":function(a,v){return a==v},"!=":function(a,v){return a!=v},"^=":function(a,v){return a&&a.substr(0,v.length)==v},"$=":function(a,v){return a&&a.substr(a.length-v.length)==v},"*=":function(a,v){return a&&a.indexOf(v)!==-1},"%=":function(a,v){return(a%v)==0},"|=":function(a,v){return a&&(a==v||a.substr(0,v.length+1)==v+"-")},"~=":function(a,v){return a&&(" "+a+" ").indexOf(" "+v+" ")!=-1}},pseudos:{"first-child":function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.previousSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci}}return r},"last-child":function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci}}return r},"nth-child":function(c,a){var r=[],ri=-1,m=nthRe.exec(a=="even"&&"2n"||a=="odd"&&"2n+1"||!nthRe2.test(a)&&"n+"+a||a),f=(m[1]||1)-0,l=m[2]-0;for(var i=0,n;n=c[i];i++){var pn=n.parentNode;if(batch!=pn._batch){var j=0;for(var cn=pn.firstChild;cn;cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j}}pn._batch=batch}if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n}}else{if((n.nodeIndex+l)%f==0){r[++ri]=n}}}return r},"only-child":function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(!prev(ci)&&!next(ci)){r[++ri]=ci}}return r},empty:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var cns=ci.childNodes,j=0,cn,empty=true;while(cn=cns[j]){++j;if(cn.nodeType==1||cn.nodeType==3){empty=false;break}}if(empty){r[++ri]=ci}}return r},contains:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if((ci.textContent||ci.innerText||"").indexOf(v)!=-1){r[++ri]=ci}}return r},nodeValue:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.firstChild&&ci.firstChild.nodeValue==v){r[++ri]=ci}}return r},checked:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.checked==true){r[++ri]=ci}}return r},not:function(c,ss){return Ext.DomQuery.filter(c,ss,true)},any:function(c,selectors){var ss=selectors.split("|"),r=[],ri=-1,s;for(var i=0,ci;ci=c[i];i++){for(var j=0;s=ss[j];j++){if(Ext.DomQuery.is(ci,s)){r[++ri]=ci;break}}}return r},odd:function(c){return this["nth-child"](c,"odd")},even:function(c){return this["nth-child"](c,"even")},nth:function(c,a){return c[a-1]||[]},first:function(c){return c[0]||[]},last:function(c){return c[c.length-1]||[]},has:function(c,ss){var s=Ext.DomQuery.select,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(s(ss,ci).length>0){r[++ri]=ci}}return r},next:function(c,ss){var is=Ext.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=next(ci);if(n&&is(n,ss)){r[++ri]=ci}}return r},prev:function(c,ss){var is=Ext.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=prev(ci);if(n&&is(n,ss)){r[++ri]=ci}}return r}}}}();Ext.query=Ext.DomQuery.select;(function(){var EXTUTIL=Ext.util,TOARRAY=Ext.toArray,EACH=Ext.each,ISOBJECT=Ext.isObject,TRUE=true,FALSE=false;EXTUTIL.Observable=function(){var me=this,e=me.events;if(me.listeners){me.on(me.listeners);delete me.listeners}me.events=e||{}};EXTUTIL.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var a=TOARRAY(arguments),ename=a[0].toLowerCase(),me=this,ret=TRUE,ce=me.events[ename],q,c;if(me.eventsSuspended===TRUE){if(q=me.eventQueue){q.push(a)}}else{if(ISOBJECT(ce)&&ce.bubble){if(ce.fire.apply(ce,a.slice(1))===FALSE){return FALSE}c=me.getBubbleTarget&&me.getBubbleTarget();if(c&&c.enableBubble){if(!c.events[ename]||!Ext.isObject(c.events[ename])||!c.events[ename].bubble){c.enableBubble(ename)}return c.fireEvent.apply(c,a)}}else{if(ISOBJECT(ce)){a.shift();ret=ce.fire.apply(ce,a)}}}return ret},addListener:function(eventName,fn,scope,o){var me=this,e,oe,isF,ce;if(ISOBJECT(eventName)){o=eventName;for(e in o){oe=o[e];if(!me.filterOptRe.test(e)){me.addListener(e,oe.fn||oe,oe.scope||o.scope,oe.fn?oe:o)}}}else{eventName=eventName.toLowerCase();ce=me.events[eventName]||TRUE;if(Ext.isBoolean(ce)){me.events[eventName]=ce=new EXTUTIL.Event(me,eventName)}ce.addListener(fn,scope,ISOBJECT(o)?o:{})}},removeListener:function(eventName,fn,scope){var ce=this.events[eventName.toLowerCase()];if(ISOBJECT(ce)){ce.removeListener(fn,scope)}},purgeListeners:function(){var events=this.events,evt,key;for(key in events){evt=events[key];if(ISOBJECT(evt)){evt.clearListeners()}}},addEvents:function(o){var me=this;me.events=me.events||{};if(Ext.isString(o)){EACH(arguments,function(a){me.events[a]=me.events[a]||TRUE})}else{Ext.applyIf(me.events,o)}},hasListener:function(eventName){var e=this.events[eventName];return ISOBJECT(e)&&e.listeners.length>0},suspendEvents:function(queueSuspended){this.eventsSuspended=TRUE;if(queueSuspended&&!this.eventQueue){this.eventQueue=[]}},resumeEvents:function(){var me=this,queued=me.eventQueue||[];me.eventsSuspended=FALSE;delete me.eventQueue;EACH(queued,function(e){me.fireEvent.apply(me,e)})}};var OBSERVABLE=EXTUTIL.Observable.prototype;OBSERVABLE.on=OBSERVABLE.addListener;OBSERVABLE.un=OBSERVABLE.removeListener;EXTUTIL.Observable.releaseCapture=function(o){o.fireEvent=OBSERVABLE.fireEvent};function createTargeted(h,o,scope){return function(){if(o.target==arguments[0]){h.apply(scope,TOARRAY(arguments))}}}function createBuffered(h,o,scope){var task=new EXTUTIL.DelayedTask();return function(){task.delay(o.buffer,h,scope,TOARRAY(arguments))}}function createSingle(h,e,fn,scope){return function(){e.removeListener(fn,scope);return h.apply(scope,arguments)}}function createDelayed(h,o,scope){return function(){var args=TOARRAY(arguments);(function(){h.apply(scope,args)}).defer(o.delay||10)}}EXTUTIL.Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[]};EXTUTIL.Event.prototype={addListener:function(fn,scope,options){var me=this,l;scope=scope||me.obj;if(!me.isListening(fn,scope)){l=me.createListener(fn,scope,options);if(me.firing){me.listeners=me.listeners.slice(0)}me.listeners.push(l)}},createListener:function(fn,scope,o){o=o||{},scope=scope||this.obj;var l={fn:fn,scope:scope,options:o},h=fn;if(o.target){h=createTargeted(h,o,scope)}if(o.delay){h=createDelayed(h,o,scope)}if(o.single){h=createSingle(h,this,fn,scope)}if(o.buffer){h=createBuffered(h,o,scope)}l.fireFn=h;return l},findListener:function(fn,scope){var s,ret=-1;EACH(this.listeners,function(l,i){s=l.scope;if(l.fn==fn&&(s==scope||s==this.obj)){ret=i;return FALSE}},this);return ret},isListening:function(fn,scope){return this.findListener(fn,scope)!=-1},removeListener:function(fn,scope){var index,me=this,ret=FALSE;if((index=me.findListener(fn,scope))!=-1){if(me.firing){me.listeners=me.listeners.slice(0)}me.listeners.splice(index,1);ret=TRUE}return ret},clearListeners:function(){this.listeners=[]},fire:function(){var me=this,args=TOARRAY(arguments),ret=TRUE;EACH(me.listeners,function(l){me.firing=TRUE;if(l.fireFn.apply(l.scope||me.obj||window,args)===FALSE){return ret=me.firing=FALSE}});me.firing=FALSE;return ret}}})();Ext.apply(Ext.util.Observable.prototype,function(){function getMethodEvent(method){var e=(this.methodEvents=this.methodEvents||{})[method],returnValue,v,cancel,obj=this;if(!e){this.methodEvents[method]=e={};e.originalFn=this[method];e.methodName=method;e.before=[];e.after=[];var makeCall=function(fn,scope,args){if(!Ext.isEmpty(v=fn.apply(scope||obj,args))){if(Ext.isObject(v)){returnValue=!Ext.isEmpty(v.returnValue)?v.returnValue:v;cancel=!!v.cancel}else{if(v===false){cancel=true}else{returnValue=v}}}};this[method]=function(){var args=Ext.toArray(arguments);returnValue=v=undefined;cancel=false;Ext.each(e.before,function(b){makeCall(b.fn,b.scope,args);if(cancel){return returnValue}});if(!Ext.isEmpty(v=e.originalFn.apply(obj,args))){returnValue=v}Ext.each(e.after,function(a){makeCall(a.fn,a.scope,args);if(cancel){return returnValue}});return returnValue}}return e}return{beforeMethod:function(method,fn,scope){getMethodEvent.call(this,method).before.push({fn:fn,scope:scope})},afterMethod:function(method,fn,scope){getMethodEvent.call(this,method).after.push({fn:fn,scope:scope})},removeMethodListener:function(method,fn,scope){var e=getMethodEvent.call(this,method),found=false;Ext.each(e.before,function(b,i,arr){if(b.fn==fn&&b.scope==scope){arr.splice(i,1);found=true;return false}});if(!found){Ext.each(e.after,function(a,i,arr){if(a.fn==fn&&a.scope==scope){arr.splice(i,1);return false}})}},relayEvents:function(o,events){var me=this;function createHandler(ename){return function(){return me.fireEvent.apply(me,[ename].concat(Ext.toArray(arguments)))}}Ext.each(events,function(ename){me.events[ename]=me.events[ename]||true;o.on(ename,createHandler(ename),me)})},enableBubble:function(events){var me=this;if(!Ext.isEmpty(events)){events=Ext.isArray(events)?events:Ext.toArray(arguments);Ext.each(events,function(ename){ename=ename.toLowerCase();var ce=me.events[ename]||true;if(Ext.isBoolean(ce)){ce=new Ext.util.Event(me,ename);me.events[ename]=ce}ce.bubble=true})}}}}());Ext.util.Observable.capture=function(o,fn,scope){o.fireEvent=o.fireEvent.createInterceptor(fn,scope)};Ext.util.Observable.observeClass=function(c){Ext.apply(c,new Ext.util.Observable());c.prototype.fireEvent=function(){return(c.fireEvent.apply(c,arguments)!==false)&&(Ext.util.Observable.prototype.fireEvent.apply(this,arguments)!==false)}};Ext.EventManager=function(){var docReadyEvent,docReadyProcId,docReadyState=false,E=Ext.lib.Event,D=Ext.lib.Dom,DOC=document,WINDOW=window,IEDEFERED="ie-deferred-loader",DOMCONTENTLOADED="DOMContentLoaded",elHash={},propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;function addListener(el,ename,fn,wrap,scope){var id=Ext.id(el),es=elHash[id]=elHash[id]||{};(es[ename]=es[ename]||[]).push([fn,wrap,scope]);E.on(el,ename,wrap);if(ename=="mousewheel"&&el.addEventListener){var args=["DOMMouseScroll",wrap,false];el.addEventListener.apply(el,args);E.on(window,"unload",function(){el.removeEventListener.apply(el,args)})}if(ename=="mousedown"&&el==document){Ext.EventManager.stoppedMouseDownEvent.addListener(wrap)}}function fireDocReady(){if(!docReadyState){Ext.isReady=docReadyState=true;if(docReadyProcId){clearInterval(docReadyProcId)}if(Ext.isGecko||Ext.isOpera){DOC.removeEventListener(DOMCONTENTLOADED,fireDocReady,false)}if(Ext.isIE){var defer=DOC.getElementById(IEDEFERED);if(defer){defer.onreadystatechange=null;defer.parentNode.removeChild(defer)}}if(docReadyEvent){docReadyEvent.fire();docReadyEvent.clearListeners()}}}function initDocReady(){var COMPLETE="complete";docReadyEvent=new Ext.util.Event();if(Ext.isGecko||Ext.isOpera){DOC.addEventListener(DOMCONTENTLOADED,fireDocReady,false)}else{if(Ext.isIE){DOC.write("<script id="+IEDEFERED+' defer="defer" src="//:"><\/script>');DOC.getElementById(IEDEFERED).onreadystatechange=function(){if(this.readyState==COMPLETE){fireDocReady()}}}else{if(Ext.isWebKit){docReadyProcId=setInterval(function(){if(DOC.readyState==COMPLETE){fireDocReady()}},10)}}}E.on(WINDOW,"load",fireDocReady)}function createTargeted(h,o){return function(){var args=Ext.toArray(arguments);if(o.target==Ext.EventObject.setEvent(args[0]).target){h.apply(this,args)}}}function createBuffered(h,o){var task=new Ext.util.DelayedTask(h);return function(e){task.delay(o.buffer,h,null,[new Ext.EventObjectImpl(e)])}}function createSingle(h,el,ename,fn,scope){return function(e){Ext.EventManager.removeListener(el,ename,fn,scope);h(e)}}function createDelayed(h,o){return function(e){e=new Ext.EventObjectImpl(e);setTimeout(function(){h(e)},o.delay||10)}}function listen(element,ename,opt,fn,scope){var o=!Ext.isObject(opt)?{}:opt,el=Ext.getDom(element);fn=fn||o.fn;scope=scope||o.scope;if(!el){throw'Error listening for "'+ename+'". Element "'+element+"\" doesn't exist."}function h(e){if(!Ext){return}e=Ext.EventObject.setEvent(e);var t;if(o.delegate){if(!(t=e.getTarget(o.delegate,el))){return}}else{t=e.target}if(o.stopEvent){e.stopEvent()}if(o.preventDefault){e.preventDefault()}if(o.stopPropagation){e.stopPropagation()}if(o.normalized){e=e.browserEvent}fn.call(scope||el,e,t,o)}if(o.target){h=createTargeted(h,o)}if(o.delay){h=createDelayed(h,o)}if(o.single){h=createSingle(h,el,ename,fn,scope)}if(o.buffer){h=createBuffered(h,o)}addListener(el,ename,fn,h,scope);return h}var pub={addListener:function(element,eventName,fn,scope,options){if(Ext.isObject(eventName)){var o=eventName,e,val;for(e in o){val=o[e];if(!propRe.test(e)){if(Ext.isFunction(val)){listen(element,e,o,val,o.scope)}else{listen(element,e,val)}}}}else{listen(element,eventName,options,fn,scope)}},removeListener:function(element,eventName,fn,scope){var el=Ext.getDom(element),id=Ext.id(el),wrap;Ext.each((elHash[id]||{})[eventName],function(v,i,a){if(Ext.isArray(v)&&v[0]==fn&&(!scope||v[2]==scope)){E.un(el,eventName,wrap=v[1]);a.splice(i,1);return false}});if(eventName=="mousewheel"&&el.addEventListener&&wrap){el.removeEventListener("DOMMouseScroll",wrap,false)}if(eventName=="mousedown"&&el==DOC&&wrap){Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap)}},removeAll:function(el){var id=Ext.id(el=Ext.getDom(el)),es=elHash[id],ename;for(ename in es){if(es.hasOwnProperty(ename)){Ext.each(es[ename],function(v){E.un(el,ename,v.wrap)})}}elHash[id]=null},onDocumentReady:function(fn,scope,options){if(docReadyState){docReadyEvent.addListener(fn,scope,options);docReadyEvent.fire();docReadyEvent.clearListeners()}else{if(!docReadyEvent){initDocReady()}options=options||{};options.delay=options.delay||1;docReadyEvent.addListener(fn,scope,options)}},elHash:elHash};pub.on=pub.addListener;pub.un=pub.removeListener;pub.stoppedMouseDownEvent=new Ext.util.Event();return pub}();Ext.onReady=Ext.EventManager.onDocumentReady;(function(){var initExtCss=function(){var bd=document.body||document.getElementsByTagName("body")[0];if(!bd){return false}var cls=[" ",Ext.isIE?"ext-ie "+(Ext.isIE6?"ext-ie6":(Ext.isIE7?"ext-ie7":"ext-ie8")):Ext.isGecko?"ext-gecko "+(Ext.isGecko2?"ext-gecko2":"ext-gecko3"):Ext.isOpera?"ext-opera":Ext.isWebKit?"ext-webkit":""];if(Ext.isSafari){cls.push("ext-safari "+(Ext.isSafari2?"ext-safari2":(Ext.isSafari3?"ext-safari3":"ext-safari4")))}else{if(Ext.isChrome){cls.push("ext-chrome")}}if(Ext.isMac){cls.push("ext-mac")}if(Ext.isLinux){cls.push("ext-linux")}if(Ext.isStrict||Ext.isBorderBox){var p=bd.parentNode;if(p){p.className+=Ext.isStrict?" ext-strict":" ext-border-box"}}bd.className+=cls.join(" ");return true};if(!initExtCss()){Ext.onReady(initExtCss)}})();Ext.EventObject=function(){var E=Ext.lib.Event,safariKeys={3:13,63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},btnMap=Ext.isIE?{1:0,4:1,2:2}:(Ext.isWebKit?{1:0,2:1,3:2}:{0:0,1:1,2:2});Ext.EventObjectImpl=function(e){if(e){this.setEvent(e.browserEvent||e)}};Ext.EventObjectImpl.prototype={setEvent:function(e){var me=this;if(e==me||(e&&e.browserEvent)){return e}me.browserEvent=e;if(e){me.button=e.button?btnMap[e.button]:(e.which?e.which-1:-1);if(e.type=="click"&&me.button==-1){me.button=0}me.type=e.type;me.shiftKey=e.shiftKey;me.ctrlKey=e.ctrlKey||e.metaKey||false;me.altKey=e.altKey;me.keyCode=e.keyCode;me.charCode=e.charCode;me.target=E.getTarget(e);me.xy=E.getXY(e)}else{me.button=-1;me.shiftKey=false;me.ctrlKey=false;me.altKey=false;me.keyCode=0;me.charCode=0;me.target=null;me.xy=[0,0]}return me},stopEvent:function(){var me=this;if(me.browserEvent){if(me.browserEvent.type=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.fire(me)}E.stopEvent(me.browserEvent)}},preventDefault:function(){if(this.browserEvent){E.preventDefault(this.browserEvent)}},stopPropagation:function(){var me=this;if(me.browserEvent){if(me.browserEvent.type=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.fire(me)}E.stopPropagation(me.browserEvent)}},getCharCode:function(){return this.charCode||this.keyCode},getKey:function(){return this.normalizeKey(this.keyCode||this.charCode)},normalizeKey:function(k){return Ext.isSafari?(safariKeys[k]||k):k},getPageX:function(){return this.xy[0]},getPageY:function(){return this.xy[1]},getXY:function(){return this.xy},getTarget:function(selector,maxDepth,returnEl){return selector?Ext.fly(this.target).findParent(selector,maxDepth,returnEl):(returnEl?Ext.get(this.target):this.target)},getRelatedTarget:function(){return this.browserEvent?E.getRelatedTarget(this.browserEvent):null},getWheelDelta:function(){var e=this.browserEvent;var delta=0;if(e.wheelDelta){delta=e.wheelDelta/120}else{if(e.detail){delta=-e.detail/3}}return delta},within:function(el,related,allowEl){if(el){var t=this[related?"getRelatedTarget":"getTarget"]();return t&&((allowEl?(t==Ext.getDom(el)):false)||Ext.fly(el).contains(t))}return false}};return new Ext.EventObjectImpl()}();Ext.apply(Ext.EventManager,function(){var resizeEvent,resizeTask,textEvent,textSize,D=Ext.lib.Dom,E=Ext.lib.Event,propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,curWidth=0,curHeight=0,useKeydown=Ext.isWebKit?Ext.num(navigator.userAgent.match(/AppleWebKit\/(\d+)/)[1])>=525:!((Ext.isGecko&&!Ext.isWindows)||Ext.isOpera);return{doResizeEvent:function(){var h=D.getViewHeight(),w=D.getViewWidth();if(curHeight!=h||curWidth!=w){resizeEvent.fire(curWidth=w,curHeight=h)}},onWindowResize:function(fn,scope,options){if(!resizeEvent){resizeEvent=new Ext.util.Event();resizeTask=new Ext.util.DelayedTask(this.doResizeEvent);E.on(window,"resize",this.fireWindowResize,this)}resizeEvent.addListener(fn,scope,options)},fireWindowResize:function(){if(resizeEvent){if((Ext.isIE||Ext.isAir)&&resizeTask){resizeTask.delay(50)}else{resizeEvent.fire(D.getViewWidth(),D.getViewHeight())}}},onTextResize:function(fn,scope,options){if(!textEvent){textEvent=new Ext.util.Event();var textEl=new Ext.Element(document.createElement("div"));textEl.dom.className="x-text-resize";textEl.dom.innerHTML="X";textEl.appendTo(document.body);textSize=textEl.dom.offsetHeight;setInterval(function(){if(textEl.dom.offsetHeight!=textSize){textEvent.fire(textSize,textSize=textEl.dom.offsetHeight)}},this.textResizeInterval)}textEvent.addListener(fn,scope,options)},removeResizeListener:function(fn,scope){if(resizeEvent){resizeEvent.removeListener(fn,scope)}},fireResize:function(){if(resizeEvent){resizeEvent.fire(D.getViewWidth(),D.getViewHeight())}},textResizeInterval:50,ieDeferSrc:false,useKeydown:useKeydown}}());Ext.EventManager.on=Ext.EventManager.addListener;Ext.apply(Ext.EventObjectImpl.prototype,{BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGEUP:33,PAGE_DOWN:34,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,isNavKeyPress:function(){var me=this,k=this.normalizeKey(me.keyCode);return(k>=33&&k<=40)||k==me.RETURN||k==me.TAB||k==me.ESC},isSpecialKey:function(){var k=this.normalizeKey(this.keyCode);return(this.type=="keypress"&&this.ctrlKey)||this.isNavKeyPress()||(k==this.BACKSPACE)||(k>=16&&k<=20)||(k>=44&&k<=45)},getPoint:function(){return new Ext.lib.Point(this.xy[0],this.xy[1])},hasModifier:function(){return((this.ctrlKey||this.altKey)||this.shiftKey)}});(function(){var DOC=document;Ext.Element=function(element,forceNew){var dom=typeof element=="string"?DOC.getElementById(element):element,id;if(!dom){return null}id=dom.id;if(!forceNew&&id&&Ext.Element.cache[id]){return Ext.Element.cache[id]}this.dom=dom;this.id=id||Ext.id(dom)};var D=Ext.lib.Dom,DH=Ext.DomHelper,E=Ext.lib.Event,A=Ext.lib.Anim,El=Ext.Element;El.prototype={set:function(o,useSet){var el=this.dom,attr,val;for(attr in o){val=o[attr];if(attr!="style"&&!Ext.isFunction(val)){if(attr=="cls"){el.className=val}else{if(o.hasOwnProperty(attr)){if(useSet||!!el.setAttribute){el.setAttribute(attr,val)}else{el[attr]=val}}}}}if(o.style){DH.applyStyles(el,o.style)}return this},defaultUnit:"px",is:function(simpleSelector){return Ext.DomQuery.is(this.dom,simpleSelector)},focus:function(defer,dom){var me=this,dom=dom||me.dom;try{if(Number(defer)){me.focus.defer(defer,null,[null,dom])}else{dom.focus()}}catch(e){}return me},blur:function(){try{this.dom.blur()}catch(e){}return this},getValue:function(asNumber){var val=this.dom.value;return asNumber?parseInt(val,10):val},addListener:function(eventName,fn,scope,options){Ext.EventManager.on(this.dom,eventName,fn,scope||this,options);return this},removeListener:function(eventName,fn,scope){Ext.EventManager.removeListener(this.dom,eventName,fn,scope||this);return this},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);return this},addUnits:function(size){if(size===""||size=="auto"||size===undefined){size=size||""}else{if(!isNaN(size)||!unitPattern.test(size)){size=size+(this.defaultUnit||"px")}}return size},load:function(url,params,cb){Ext.Ajax.request(Ext.apply({params:params,url:url.url||url,callback:cb,el:this.dom,indicatorText:url.indicatorText||""},Ext.isObject(url)?url:{}));return this},isBorderBox:function(){return noBoxAdjust[(this.dom.tagName||"").toLowerCase()]||Ext.isBorderBox},remove:function(){var me=this,dom=me.dom;me.removeAllListeners();if(dom){delete me.dom;delete El.cache[dom.id];delete El.dataCache[dom.id];Ext.removeNode(dom)}},hover:function(overFn,outFn,scope,options){var me=this;me.on("mouseenter",overFn,scope||me.dom,options);me.on("mouseleave",outFn,scope||me.dom,options);return me},contains:function(el){return !el?false:Ext.lib.Dom.isAncestor(this.dom,el.dom?el.dom:el)},getAttributeNS:function(ns,name){return this.getAttribute(name,ns)},getAttribute:Ext.isIE?function(name,ns){var d=this.dom,type=typeof d[ns+":"+name];if(["undefined","unknown"].indexOf(type)==-1){return d[ns+":"+name]}return d[name]}:function(name,ns){var d=this.dom;return d.getAttributeNS(ns,name)||d.getAttribute(ns+":"+name)||d.getAttribute(name)||d[name]},update:function(html){if(this.dom){this.dom.innerHTML=html}return this}};var ep=El.prototype;El.addMethods=function(o){Ext.apply(ep,o)};ep.on=ep.addListener;ep.un=ep.removeListener;ep.autoBoxAdjust=true;var unitPattern=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,docEl;El.cache={};El.dataCache={};El.get=function(el){var ex,elm,id;if(!el){return null}if(typeof el=="string"){if(!(elm=DOC.getElementById(el))){return null}if(ex=El.cache[el]){ex.dom=elm}else{ex=El.cache[el]=new El(elm)}return ex}else{if(el.tagName){if(!(id=el.id)){id=Ext.id(el)}if(ex=El.cache[id]){ex.dom=el}else{ex=El.cache[id]=new El(el)}return ex}else{if(el instanceof El){if(el!=docEl){el.dom=DOC.getElementById(el.id)||el.dom;El.cache[el.id]=el}return el}else{if(el.isComposite){return el}else{if(Ext.isArray(el)){return El.select(el)}else{if(el==DOC){if(!docEl){var f=function(){};f.prototype=El.prototype;docEl=new f();docEl.dom=DOC}return docEl}}}}}}return null};El.data=function(el,key,value){var c=El.dataCache[el.id];if(!c){c=El.dataCache[el.id]={}}if(arguments.length==2){return c[key]}else{return(c[key]=value)}};function garbageCollect(){if(!Ext.enableGarbageCollector){clearInterval(El.collectorThread)}else{var eid,el,d;for(eid in El.cache){el=El.cache[eid];d=el.dom;if(!d||!d.parentNode||(!d.offsetParent&&!DOC.getElementById(eid))){delete El.cache[eid];if(d&&Ext.enableListenerCollection){Ext.EventManager.removeAll(d)}}}}}El.collectorThreadId=setInterval(garbageCollect,30000);var flyFn=function(){};flyFn.prototype=El.prototype;El.Flyweight=function(dom){this.dom=dom};El.Flyweight.prototype=new flyFn();El.Flyweight.prototype.isFlyweight=true;El._flyweights={};El.fly=function(el,named){var ret=null;named=named||"_global";if(el=Ext.getDom(el)){(El._flyweights[named]=El._flyweights[named]||new El.Flyweight()).dom=el;ret=El._flyweights[named]}return ret};Ext.get=El.get;Ext.fly=El.fly;var noBoxAdjust=Ext.isStrict?{select:1}:{input:1,select:1,textarea:1};if(Ext.isIE||Ext.isGecko){noBoxAdjust.button=1}Ext.EventManager.on(window,"unload",function(){delete El.cache;delete El.dataCache;delete El._flyweights})})();Ext.Element.addMethods({swallowEvent:function(eventName,preventDefault){var me=this;function fn(e){e.stopPropagation();if(preventDefault){e.preventDefault()}}if(Ext.isArray(eventName)){Ext.each(eventName,function(e){me.on(e,fn)});return me}me.on(eventName,fn);return me},relayEvent:function(eventName,observable){this.on(eventName,function(e){observable.fireEvent(eventName,e)})},clean:function(forceReclean){var me=this,dom=me.dom,n=dom.firstChild,ni=-1;if(Ext.Element.data(dom,"isCleaned")&&forceReclean!==true){return me}while(n){var nx=n.nextSibling;if(n.nodeType==3&&!/\S/.test(n.nodeValue)){dom.removeChild(n)}else{n.nodeIndex=++ni}n=nx}Ext.Element.data(dom,"isCleaned",true);return me},load:function(){var um=this.getUpdater();um.update.apply(um,arguments);return this},getUpdater:function(){return this.updateManager||(this.updateManager=new Ext.Updater(this))},update:function(html,loadScripts,callback){html=html||"";if(loadScripts!==true){this.dom.innerHTML=html;if(Ext.isFunction(callback)){callback()}return this}var id=Ext.id(),dom=this.dom;html+='<span id="'+id+'"></span>';Ext.lib.Event.onAvailable(id,function(){var DOC=document,hd=DOC.getElementsByTagName("head")[0],re=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig,srcRe=/\ssrc=([\'\"])(.*?)\1/i,typeRe=/\stype=([\'\"])(.*?)\1/i,match,attrs,srcMatch,typeMatch,el,s;while((match=re.exec(html))){attrs=match[1];srcMatch=attrs?attrs.match(srcRe):false;if(srcMatch&&srcMatch[2]){s=DOC.createElement("script");s.src=srcMatch[2];typeMatch=attrs.match(typeRe);if(typeMatch&&typeMatch[2]){s.type=typeMatch[2]}hd.appendChild(s)}else{if(match[2]&&match[2].length>0){if(window.execScript){window.execScript(match[2])}else{window.eval(match[2])}}}}el=DOC.getElementById(id);if(el){Ext.removeNode(el)}if(Ext.isFunction(callback)){callback()}});dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"");return this},createProxy:function(config,renderTo,matchBox){config=Ext.isObject(config)?config:{tag:"div",cls:config};var me=this,proxy=renderTo?Ext.DomHelper.append(renderTo,config,true):Ext.DomHelper.insertBefore(me.dom,config,true);if(matchBox&&me.setBox&&me.getBox){proxy.setBox(me.getBox())}return proxy}});Ext.Element.prototype.getUpdateManager=Ext.Element.prototype.getUpdater;Ext.Element.uncache=function(el){for(var i=0,a=arguments,len=a.length;i<len;i++){if(a[i]){delete Ext.Element.cache[a[i].id||a[i]]}}};Ext.Element.addMethods({getAnchorXY:function(anchor,local,s){anchor=(anchor||"tl").toLowerCase();s=s||{};var me=this,vp=me.dom==document.body||me.dom==document,w=s.width||vp?Ext.lib.Dom.getViewWidth():me.getWidth(),h=s.height||vp?Ext.lib.Dom.getViewHeight():me.getHeight(),xy,r=Math.round,o=me.getXY(),scroll=me.getScroll(),extraX=vp?scroll.left:!local?o[0]:0,extraY=vp?scroll.top:!local?o[1]:0,hash={c:[r(w*0.5),r(h*0.5)],t:[r(w*0.5),0],l:[0,r(h*0.5)],r:[w,r(h*0.5)],b:[r(w*0.5),h],tl:[0,0],bl:[0,h],br:[w,h],tr:[w,0]};xy=hash[anchor];return[xy[0]+extraX,xy[1]+extraY]},anchorTo:function(el,alignment,offsets,animate,monitorScroll,callback){var me=this,dom=me.dom;function action(){Ext.fly(dom).alignTo(el,alignment,offsets,animate);Ext.callback(callback,Ext.fly(dom))}Ext.EventManager.onWindowResize(action,me);if(!Ext.isEmpty(monitorScroll)){Ext.EventManager.on(window,"scroll",action,me,{buffer:!isNaN(monitorScroll)?monitorScroll:50})}action.call(me);return me},getAlignToXY:function(el,p,o){el=Ext.get(el);if(!el||!el.dom){throw"Element.alignToXY with an element that doesn't exist"}o=o||[0,0];p=(p=="?"?"tl-bl?":(!/-/.test(p)&&p!==""?"tl-"+p:p||"tl-bl")).toLowerCase();var me=this,d=me.dom,a1,a2,x,y,w,h,r,dw=Ext.lib.Dom.getViewWidth()-10,dh=Ext.lib.Dom.getViewHeight()-10,p1y,p1x,p2y,p2x,swapY,swapX,doc=document,docElement=doc.documentElement,docBody=doc.body,scrollX=(docElement.scrollLeft||docBody.scrollLeft||0)+5,scrollY=(docElement.scrollTop||docBody.scrollTop||0)+5,c=false,p1="",p2="",m=p.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){throw"Element.alignTo with an invalid alignment "+p}p1=m[1];p2=m[2];c=!!m[3];a1=me.getAnchorXY(p1,true);a2=el.getAnchorXY(p2,false);x=a2[0]-a1[0]+o[0];y=a2[1]-a1[1]+o[1];if(c){w=me.getWidth();h=me.getHeight();r=el.getRegion();p1y=p1.charAt(0);p1x=p1.charAt(p1.length-1);p2y=p2.charAt(0);p2x=p2.charAt(p2.length-1);swapY=((p1y=="t"&&p2y=="b")||(p1y=="b"&&p2y=="t"));swapX=((p1x=="r"&&p2x=="l")||(p1x=="l"&&p2x=="r"));if(x+w>dw+scrollX){x=swapX?r.left-w:dw+scrollX-w}if(x<scrollX){x=swapX?r.right:scrollX}if(y+h>dh+scrollY){y=swapY?r.top-h:dh+scrollY-h}if(y<scrollY){y=swapY?r.bottom:scrollY}}return[x,y]},alignTo:function(element,position,offsets,animate){var me=this;return me.setXY(me.getAlignToXY(element,position,offsets),me.preanim&&!!animate?me.preanim(arguments,3):false)},adjustForConstraints:function(xy,parent,offsets){return this.getConstrainToXY(parent||document,false,offsets,xy)||xy},getConstrainToXY:function(el,local,offsets,proposedXY){var os={top:0,left:0,bottom:0,right:0};return function(el,local,offsets,proposedXY){el=Ext.get(el);offsets=offsets?Ext.applyIf(offsets,os):os;var vw,vh,vx=0,vy=0;if(el.dom==document.body||el.dom==document){vw=Ext.lib.Dom.getViewWidth();vh=Ext.lib.Dom.getViewHeight()}else{vw=el.dom.clientWidth;vh=el.dom.clientHeight;if(!local){var vxy=el.getXY();vx=vxy[0];vy=vxy[1]}}var s=el.getScroll();vx+=offsets.left+s.left;vy+=offsets.top+s.top;vw-=offsets.right;vh-=offsets.bottom;var vr=vx+vw;var vb=vy+vh;var xy=proposedXY||(!local?this.getXY():[this.getLeft(true),this.getTop(true)]);var x=xy[0],y=xy[1];var w=this.dom.offsetWidth,h=this.dom.offsetHeight;var moved=false;if((x+w)>vr){x=vr-w;moved=true}if((y+h)>vb){y=vb-h;moved=true}if(x<vx){x=vx;moved=true}if(y<vy){y=vy;moved=true}return moved?[x,y]:false}}(),getCenterXY:function(){return this.getAlignToXY(document,"c-c")},center:function(centerIn){return this.alignTo(centerIn||document,"c-c")}});Ext.Element.addMethods(function(){var PARENTNODE="parentNode",NEXTSIBLING="nextSibling",PREVIOUSSIBLING="previousSibling",DQ=Ext.DomQuery,GET=Ext.get;return{findParent:function(simpleSelector,maxDepth,returnEl){var p=this.dom,b=document.body,depth=0,stopEl;if(Ext.isGecko&&Object.prototype.toString.call(p)=="[object XULElement]"){return null}maxDepth=maxDepth||50;if(isNaN(maxDepth)){stopEl=Ext.getDom(maxDepth);maxDepth=Number.MAX_VALUE}while(p&&p.nodeType==1&&depth<maxDepth&&p!=b&&p!=stopEl){if(DQ.is(p,simpleSelector)){return returnEl?GET(p):p}depth++;p=p.parentNode}return null},findParentNode:function(simpleSelector,maxDepth,returnEl){var p=Ext.fly(this.dom.parentNode,"_internal");return p?p.findParent(simpleSelector,maxDepth,returnEl):null},up:function(simpleSelector,maxDepth){return this.findParentNode(simpleSelector,maxDepth,true)},select:function(selector,unique){return Ext.Element.select(selector,unique,this.dom)},query:function(selector,unique){return DQ.select(selector,this.dom)},child:function(selector,returnDom){var n=DQ.selectNode(selector,this.dom);return returnDom?n:GET(n)},down:function(selector,returnDom){var n=DQ.selectNode(" > "+selector,this.dom);return returnDom?n:GET(n)},parent:function(selector,returnDom){return this.matchNode(PARENTNODE,PARENTNODE,selector,returnDom)},next:function(selector,returnDom){return this.matchNode(NEXTSIBLING,NEXTSIBLING,selector,returnDom)},prev:function(selector,returnDom){return this.matchNode(PREVIOUSSIBLING,PREVIOUSSIBLING,selector,returnDom)},first:function(selector,returnDom){return this.matchNode(NEXTSIBLING,"firstChild",selector,returnDom)},last:function(selector,returnDom){return this.matchNode(PREVIOUSSIBLING,"lastChild",selector,returnDom)},matchNode:function(dir,start,selector,returnDom){var n=this.dom[start];while(n){if(n.nodeType==1&&(!selector||DQ.is(n,selector))){return !returnDom?GET(n):n}n=n[dir]}return null}}}());Ext.Element.addMethods(function(){var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;return{appendChild:function(el){return GET(el).appendTo(this)},appendTo:function(el){GETDOM(el).appendChild(this.dom);return this},insertBefore:function(el){(el=GETDOM(el)).parentNode.insertBefore(this.dom,el);return this},insertAfter:function(el){(el=GETDOM(el)).parentNode.insertBefore(this.dom,el.nextSibling);return this},insertFirst:function(el,returnDom){el=el||{};if(el.nodeType||el.dom||typeof el=="string"){el=GETDOM(el);this.dom.insertBefore(el,this.dom.firstChild);return !returnDom?GET(el):el}else{return this.createChild(el,this.dom.firstChild,returnDom)}},replace:function(el){el=GET(el);this.insertBefore(el);el.remove();return this},replaceWith:function(el){var me=this,Element=Ext.Element;if(el.nodeType||el.dom||typeof el=="string"){el=GETDOM(el);me.dom.parentNode.insertBefore(el,me.dom)}else{el=DH.insertBefore(me.dom,el)}delete Element.cache[me.id];Ext.removeNode(me.dom);me.id=Ext.id(me.dom=el);return Element.cache[me.id]=me},createChild:function(config,insertBefore,returnDom){config=config||{tag:"div"};return insertBefore?DH.insertBefore(insertBefore,config,returnDom!==true):DH[!this.dom.firstChild?"overwrite":"append"](this.dom,config,returnDom!==true)},wrap:function(config,returnDom){var newEl=DH.insertBefore(this.dom,config||{tag:"div"},!returnDom);newEl.dom?newEl.dom.appendChild(this.dom):newEl.appendChild(this.dom);return newEl},insertHtml:function(where,html,returnEl){var el=DH.insertHtml(where,this.dom,html);return returnEl?Ext.get(el):el}}}());Ext.apply(Ext.Element.prototype,function(){var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;return{insertSibling:function(el,where,returnDom){var me=this,rt;if(Ext.isArray(el)){Ext.each(el,function(e){rt=me.insertSibling(e,where,returnDom)});return rt}where=(where||"before").toLowerCase();el=el||{};if(el.nodeType||el.dom){rt=me.dom.parentNode.insertBefore(GETDOM(el),where=="before"?me.dom:me.dom.nextSibling);if(!returnDom){rt=GET(rt)}}else{if(where=="after"&&!me.dom.nextSibling){rt=DH.append(me.dom.parentNode,el,!returnDom)}else{rt=DH[where=="after"?"insertAfter":"insertBefore"](me.dom,el,!returnDom)}}return rt}}}());Ext.Element.addMethods(function(){var propCache={},camelRe=/(-[a-z])/gi,classReCache={},view=document.defaultView,propFloat=Ext.isIE?"styleFloat":"cssFloat",opacityRe=/alpha\(opacity=(.*)\)/i,trimRe=/^\s+|\s+$/g,EL=Ext.Element,PADDING="padding",MARGIN="margin",BORDER="border",LEFT="-left",RIGHT="-right",TOP="-top",BOTTOM="-bottom",WIDTH="-width",MATH=Math,HIDDEN="hidden",ISCLIPPED="isClipped",OVERFLOW="overflow",OVERFLOWX="overflow-x",OVERFLOWY="overflow-y",ORIGINALCLIP="originalClip",borders={l:BORDER+LEFT+WIDTH,r:BORDER+RIGHT+WIDTH,t:BORDER+TOP+WIDTH,b:BORDER+BOTTOM+WIDTH},paddings={l:PADDING+LEFT,r:PADDING+RIGHT,t:PADDING+TOP,b:PADDING+BOTTOM},margins={l:MARGIN+LEFT,r:MARGIN+RIGHT,t:MARGIN+TOP,b:MARGIN+BOTTOM},data=Ext.Element.data;function camelFn(m,a){return a.charAt(1).toUpperCase()}function chkCache(prop){return propCache[prop]||(propCache[prop]=prop=="float"?propFloat:prop.replace(camelRe,camelFn))}return{adjustWidth:function(width){var me=this;var isNum=Ext.isNumber(width);if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){width-=(me.getBorderWidth("lr")+me.getPadding("lr"))}return(isNum&&width<0)?0:width},adjustHeight:function(height){var me=this;var isNum=Ext.isNumber(height);if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){height-=(me.getBorderWidth("tb")+me.getPadding("tb"))}return(isNum&&height<0)?0:height},addClass:function(className){var me=this;Ext.each(className,function(v){me.dom.className+=(!me.hasClass(v)&&v?" "+v:"")});return me},radioClass:function(className){Ext.each(this.dom.parentNode.childNodes,function(v){if(v.nodeType==1){Ext.fly(v,"_internal").removeClass(className)}});return this.addClass(className)},removeClass:function(className){var me=this;if(me.dom&&me.dom.className){Ext.each(className,function(v){me.dom.className=me.dom.className.replace(classReCache[v]=classReCache[v]||new RegExp("(?:^|\\s+)"+v+"(?:\\s+|$)","g")," ")})}return me},toggleClass:function(className){return this.hasClass(className)?this.removeClass(className):this.addClass(className)},hasClass:function(className){return className&&(" "+this.dom.className+" ").indexOf(" "+className+" ")!=-1},replaceClass:function(oldClassName,newClassName){return this.removeClass(oldClassName).addClass(newClassName)},isStyle:function(style,val){return this.getStyle(style)==val},getStyle:function(){return view&&view.getComputedStyle?function(prop){var el=this.dom,v,cs,out;if(el==document){return null}prop=chkCache(prop);out=(v=el.style[prop])?v:(cs=view.getComputedStyle(el,""))?cs[prop]:null;if(Ext.isWebKit&&out=="rgba(0, 0, 0, 0)"){out="transparent"}return out}:function(prop){var el=this.dom,m,cs;if(el==document){return null}if(prop=="opacity"){if(el.style.filter.match){if(m=el.style.filter.match(opacityRe)){var fv=parseFloat(m[1]);if(!isNaN(fv)){return fv?fv/100:0}}}return 1}prop=chkCache(prop);return el.style[prop]||((cs=el.currentStyle)?cs[prop]:null)}}(),getColor:function(attr,defaultValue,prefix){var v=this.getStyle(attr),color=Ext.isDefined(prefix)?prefix:"#",h;if(!v||/transparent|inherit/.test(v)){return defaultValue}if(/^r/.test(v)){Ext.each(v.slice(4,v.length-1).split(","),function(s){h=parseInt(s,10);color+=(h<16?"0":"")+h.toString(16)})}else{v=v.replace("#","");color+=v.length==3?v.replace(/^(\w)(\w)(\w)$/,"$1$1$2$2$3$3"):v}return(color.length>5?color.toLowerCase():defaultValue)},setStyle:function(prop,value){var tmp,style,camel;if(!Ext.isObject(prop)){tmp={};tmp[prop]=value;prop=tmp}for(style in prop){value=prop[style];style=="opacity"?this.setOpacity(value):this.dom.style[chkCache(style)]=value}return this},setOpacity:function(opacity,animate){var me=this,s=me.dom.style;if(!animate||!me.anim){if(Ext.isIE){var opac=opacity<1?"alpha(opacity="+opacity*100+")":"",val=s.filter.replace(opacityRe,"").replace(trimRe,"");s.zoom=1;s.filter=val+(val.length>0?" ":"")+opac}else{s.opacity=opacity}}else{me.anim({opacity:{to:opacity}},me.preanim(arguments,1),null,0.35,"easeIn")}return me},clearOpacity:function(){var style=this.dom.style;if(Ext.isIE){if(!Ext.isEmpty(style.filter)){style.filter=style.filter.replace(opacityRe,"").replace(trimRe,"")}}else{style.opacity=style["-moz-opacity"]=style["-khtml-opacity"]=""}return this},getHeight:function(contentHeight){var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle("display","none"),h=MATH.max(dom.offsetHeight,hidden?0:dom.clientHeight)||0;h=!contentHeight?h:h-me.getBorderWidth("tb")-me.getPadding("tb");return h<0?0:h},getWidth:function(contentWidth){var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle("display","none"),w=MATH.max(dom.offsetWidth,hidden?0:dom.clientWidth)||0;w=!contentWidth?w:w-me.getBorderWidth("lr")-me.getPadding("lr");return w<0?0:w},setWidth:function(width,animate){var me=this;width=me.adjustWidth(width);!animate||!me.anim?me.dom.style.width=me.addUnits(width):me.anim({width:{to:width}},me.preanim(arguments,1));return me},setHeight:function(height,animate){var me=this;height=me.adjustHeight(height);!animate||!me.anim?me.dom.style.height=me.addUnits(height):me.anim({height:{to:height}},me.preanim(arguments,1));return me},getBorderWidth:function(side){return this.addStyles(side,borders)},getPadding:function(side){return this.addStyles(side,paddings)},clip:function(){var me=this,dom=me.dom;if(!data(dom,ISCLIPPED)){data(dom,ISCLIPPED,true);data(dom,ORIGINALCLIP,{o:me.getStyle(OVERFLOW),x:me.getStyle(OVERFLOWX),y:me.getStyle(OVERFLOWY)});me.setStyle(OVERFLOW,HIDDEN);me.setStyle(OVERFLOWX,HIDDEN);me.setStyle(OVERFLOWY,HIDDEN)}return me},unclip:function(){var me=this,dom=me.dom;if(data(dom,ISCLIPPED)){data(dom,ISCLIPPED,false);var o=data(dom,ORIGINALCLIP);if(o.o){me.setStyle(OVERFLOW,o.o)}if(o.x){me.setStyle(OVERFLOWX,o.x)}if(o.y){me.setStyle(OVERFLOWY,o.y)}}return me},addStyles:function(sides,styles){var val=0;Ext.each(sides.match(/\w/g),function(s){if(s=parseInt(this.getStyle(styles[s]),10)){val+=MATH.abs(s)}},this);return val},margins:margins}}());Ext.Element.boxMarkup='<div class="{0}-tl"><div class="{0}-tr"><div class="{0}-tc"></div></div></div><div class="{0}-ml"><div class="{0}-mr"><div class="{0}-mc"></div></div></div><div class="{0}-bl"><div class="{0}-br"><div class="{0}-bc"></div></div></div>';Ext.Element.addMethods(function(){var INTERNAL="_internal";return{applyStyles:function(style){Ext.DomHelper.applyStyles(this.dom,style);return this},getStyles:function(){var ret={};Ext.each(arguments,function(v){ret[v]=this.getStyle(v)},this);return ret},getStyleSize:function(){var me=this,w,h,d=this.dom,s=d.style;if(s.width&&s.width!="auto"){w=parseInt(s.width,10);if(me.isBorderBox()){w-=me.getFrameWidth("lr")}}if(s.height&&s.height!="auto"){h=parseInt(s.height,10);if(me.isBorderBox()){h-=me.getFrameWidth("tb")}}return{width:w||me.getWidth(true),height:h||me.getHeight(true)}},setOverflow:function(v){var dom=this.dom;if(v=="auto"&&Ext.isMac&&Ext.isGecko2){dom.style.overflow="hidden";(function(){dom.style.overflow="auto"}).defer(1)}else{dom.style.overflow=v}},boxWrap:function(cls){cls=cls||"x-box";var el=Ext.get(this.insertHtml("beforeBegin","<div class='"+cls+"'>"+String.format(Ext.Element.boxMarkup,cls)+"</div>"));Ext.DomQuery.selectNode("."+cls+"-mc",el.dom).appendChild(this.dom);return el},setSize:function(width,height,animate){var me=this;if(Ext.isObject(width)){height=width.height;width=width.width}width=me.adjustWidth(width);height=me.adjustHeight(height);if(!animate||!me.anim){me.dom.style.width=me.addUnits(width);me.dom.style.height=me.addUnits(height)}else{me.anim({width:{to:width},height:{to:height}},me.preanim(arguments,2))}return me},getComputedHeight:function(){var me=this,h=Math.max(me.dom.offsetHeight,me.dom.clientHeight);if(!h){h=parseInt(me.getStyle("height"),10)||0;if(!me.isBorderBox()){h+=me.getFrameWidth("tb")}}return h},getComputedWidth:function(){var w=Math.max(this.dom.offsetWidth,this.dom.clientWidth);if(!w){w=parseInt(this.getStyle("width"),10)||0;if(!this.isBorderBox()){w+=this.getFrameWidth("lr")}}return w},getFrameWidth:function(sides,onlyContentBox){return onlyContentBox&&this.isBorderBox()?0:(this.getPadding(sides)+this.getBorderWidth(sides))},addClassOnOver:function(className){this.hover(function(){Ext.fly(this,INTERNAL).addClass(className)},function(){Ext.fly(this,INTERNAL).removeClass(className)});return this},addClassOnFocus:function(className){this.on("focus",function(){Ext.fly(this,INTERNAL).addClass(className)},this.dom);this.on("blur",function(){Ext.fly(this,INTERNAL).removeClass(className)},this.dom);return this},addClassOnClick:function(className){var dom=this.dom;this.on("mousedown",function(){Ext.fly(dom,INTERNAL).addClass(className);var d=Ext.getDoc(),fn=function(){Ext.fly(dom,INTERNAL).removeClass(className);d.removeListener("mouseup",fn)};d.on("mouseup",fn)});return this},getViewSize:function(){var doc=document,d=this.dom,extdom=Ext.lib.Dom,isDoc=(d==doc||d==doc.body);return{width:(isDoc?extdom.getViewWidth():d.clientWidth),height:(isDoc?extdom.getViewHeight():d.clientHeight)}},getSize:function(contentSize){return{width:this.getWidth(contentSize),height:this.getHeight(contentSize)}},repaint:function(){var dom=this.dom;this.addClass("x-repaint");setTimeout(function(){Ext.fly(dom).removeClass("x-repaint")},1);return this},unselectable:function(){this.dom.unselectable="on";return this.swallowEvent("selectstart",true).applyStyles("-moz-user-select:none;-khtml-user-select:none;").addClass("x-unselectable")},getMargins:function(side){var me=this,key,hash={t:"top",l:"left",r:"right",b:"bottom"},o={};if(!side){for(key in me.margins){o[hash[key]]=parseInt(me.getStyle(me.margins[key]),10)||0}return o}else{return me.addStyles.call(me,side,me.margins)}}}}());(function(){var D=Ext.lib.Dom,LEFT="left",RIGHT="right",TOP="top",BOTTOM="bottom",POSITION="position",STATIC="static",RELATIVE="relative",AUTO="auto",ZINDEX="z-index";Ext.Element.addMethods({getX:function(){return D.getX(this.dom)},getY:function(){return D.getY(this.dom)},getXY:function(){return D.getXY(this.dom)},getOffsetsTo:function(el){var o=this.getXY(),e=Ext.fly(el,"_internal").getXY();return[o[0]-e[0],o[1]-e[1]]},setX:function(x,animate){return this.setXY([x,this.getY()],this.animTest(arguments,animate,1))},setY:function(y,animate){return this.setXY([this.getX(),y],this.animTest(arguments,animate,1))},setLeft:function(left){this.setStyle(LEFT,this.addUnits(left));return this},setTop:function(top){this.setStyle(TOP,this.addUnits(top));return this},setRight:function(right){this.setStyle(RIGHT,this.addUnits(right));return this},setBottom:function(bottom){this.setStyle(BOTTOM,this.addUnits(bottom));return this},setXY:function(pos,animate){var me=this;if(!animate||!me.anim){D.setXY(me.dom,pos)}else{me.anim({points:{to:pos}},me.preanim(arguments,1),"motion")}return me},setLocation:function(x,y,animate){return this.setXY([x,y],this.animTest(arguments,animate,2))},moveTo:function(x,y,animate){return this.setXY([x,y],this.animTest(arguments,animate,2))},getLeft:function(local){return !local?this.getX():parseInt(this.getStyle(LEFT),10)||0},getRight:function(local){var me=this;return !local?me.getX()+me.getWidth():(me.getLeft(true)+me.getWidth())||0},getTop:function(local){return !local?this.getY():parseInt(this.getStyle(TOP),10)||0},getBottom:function(local){var me=this;return !local?me.getY()+me.getHeight():(me.getTop(true)+me.getHeight())||0},position:function(pos,zIndex,x,y){var me=this;if(!pos&&me.isStyle(POSITION,STATIC)){me.setStyle(POSITION,RELATIVE)}else{if(pos){me.setStyle(POSITION,pos)}}if(zIndex){me.setStyle(ZINDEX,zIndex)}if(x||y){me.setXY([x||false,y||false])}},clearPositioning:function(value){value=value||"";this.setStyle({left:value,right:value,top:value,bottom:value,"z-index":"",position:STATIC});return this},getPositioning:function(){var l=this.getStyle(LEFT);var t=this.getStyle(TOP);return{position:this.getStyle(POSITION),left:l,right:l?"":this.getStyle(RIGHT),top:t,bottom:t?"":this.getStyle(BOTTOM),"z-index":this.getStyle(ZINDEX)}},setPositioning:function(pc){var me=this,style=me.dom.style;me.setStyle(pc);if(pc.right==AUTO){style.right=""}if(pc.bottom==AUTO){style.bottom=""}return me},translatePoints:function(x,y){y=isNaN(x[1])?y:x[1];x=isNaN(x[0])?x:x[0];var me=this,relative=me.isStyle(POSITION,RELATIVE),o=me.getXY(),l=parseInt(me.getStyle(LEFT),10),t=parseInt(me.getStyle(TOP),10);l=!isNaN(l)?l:(relative?0:me.dom.offsetLeft);t=!isNaN(t)?t:(relative?0:me.dom.offsetTop);return{left:(x-o[0]+l),top:(y-o[1]+t)}},animTest:function(args,animate,i){return !!animate&&this.preanim?this.preanim(args,i):false}})})();Ext.Element.addMethods({setBox:function(box,adjust,animate){var me=this,w=box.width,h=box.height;if((adjust&&!me.autoBoxAdjust)&&!me.isBorderBox()){w-=(me.getBorderWidth("lr")+me.getPadding("lr"));h-=(me.getBorderWidth("tb")+me.getPadding("tb"))}me.setBounds(box.x,box.y,w,h,me.animTest.call(me,arguments,animate,2));return me},getBox:function(contentBox,local){var me=this,xy,left,top,getBorderWidth=me.getBorderWidth,getPadding=me.getPadding,l,r,t,b;if(!local){xy=me.getXY()}else{left=parseInt(me.getStyle("left"),10)||0;top=parseInt(me.getStyle("top"),10)||0;xy=[left,top]}var el=me.dom,w=el.offsetWidth,h=el.offsetHeight,bx;if(!contentBox){bx={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:w,height:h}}else{l=getBorderWidth.call(me,"l")+getPadding.call(me,"l");r=getBorderWidth.call(me,"r")+getPadding.call(me,"r");t=getBorderWidth.call(me,"t")+getPadding.call(me,"t");b=getBorderWidth.call(me,"b")+getPadding.call(me,"b");bx={x:xy[0]+l,y:xy[1]+t,0:xy[0]+l,1:xy[1]+t,width:w-(l+r),height:h-(t+b)}}bx.right=bx.x+bx.width;bx.bottom=bx.y+bx.height;return bx},move:function(direction,distance,animate){var me=this,xy=me.getXY(),x=xy[0],y=xy[1],left=[x-distance,y],right=[x+distance,y],top=[x,y-distance],bottom=[x,y+distance],hash={l:left,left:left,r:right,right:right,t:top,top:top,up:top,b:bottom,bottom:bottom,down:bottom};direction=direction.toLowerCase();me.moveTo(hash[direction][0],hash[direction][1],me.animTest.call(me,arguments,animate,2))},setLeftTop:function(left,top){var me=this,style=me.dom.style;style.left=me.addUnits(left);style.top=me.addUnits(top);return me},getRegion:function(){return Ext.lib.Dom.getRegion(this.dom)},setBounds:function(x,y,width,height,animate){var me=this;if(!animate||!me.anim){me.setSize(width,height);me.setLocation(x,y)}else{me.anim({points:{to:[x,y]},width:{to:me.adjustWidth(width)},height:{to:me.adjustHeight(height)}},me.preanim(arguments,4),"motion")}return me},setRegion:function(region,animate){return this.setBounds(region.left,region.top,region.right-region.left,region.bottom-region.top,this.animTest.call(this,arguments,animate,1))}});Ext.Element.addMethods({isScrollable:function(){var dom=this.dom;return dom.scrollHeight>dom.clientHeight||dom.scrollWidth>dom.clientWidth},scrollTo:function(side,value){this.dom["scroll"+(/top/i.test(side)?"Top":"Left")]=value;return this},getScroll:function(){var d=this.dom,doc=document,body=doc.body,docElement=doc.documentElement,l,t,ret;if(d==doc||d==body){if(Ext.isIE&&Ext.isStrict){l=docElement.scrollLeft;t=docElement.scrollTop}else{l=window.pageXOffset;t=window.pageYOffset}ret={left:l||(body?body.scrollLeft:0),top:t||(body?body.scrollTop:0)}}else{ret={left:d.scrollLeft,top:d.scrollTop}}return ret}});Ext.Element.addMethods({scrollTo:function(side,value,animate){var top=/top/i.test(side),prop="scroll"+(top?"Left":"Top"),me=this,dom=me.dom;if(!animate||!me.anim){dom[prop]=value}else{me.anim({scroll:{to:top?[dom[prop],value]:[value,dom[prop]]}},me.preanim(arguments,2),"scroll")}return me},scrollIntoView:function(container,hscroll){var c=Ext.getDom(container)||Ext.getBody().dom,el=this.dom,o=this.getOffsetsTo(c),l=o[0]+c.scrollLeft,t=o[1]+c.scrollTop,b=t+el.offsetHeight,r=l+el.offsetWidth,ch=c.clientHeight,ct=parseInt(c.scrollTop,10),cl=parseInt(c.scrollLeft,10),cb=ct+ch,cr=cl+c.clientWidth;if(el.offsetHeight>ch||t<ct){c.scrollTop=t}else{if(b>cb){c.scrollTop=b-ch}}c.scrollTop=c.scrollTop;if(hscroll!==false){if(el.offsetWidth>c.clientWidth||l<cl){c.scrollLeft=l}else{if(r>cr){c.scrollLeft=r-c.clientWidth}}c.scrollLeft=c.scrollLeft}return this},scrollChildIntoView:function(child,hscroll){Ext.fly(child,"_scrollChildIntoView").scrollIntoView(this,hscroll)},scroll:function(direction,distance,animate){if(!this.isScrollable()){return}var el=this.dom,l=el.scrollLeft,t=el.scrollTop,w=el.scrollWidth,h=el.scrollHeight,cw=el.clientWidth,ch=el.clientHeight,scrolled=false,v,hash={l:Math.min(l+distance,w-cw),r:v=Math.max(l-distance,0),t:Math.max(t-distance,0),b:Math.min(t+distance,h-ch)};hash.d=hash.b;hash.u=hash.t;direction=direction.substr(0,1);if((v=hash[direction])>-1){scrolled=true;this.scrollTo(direction=="l"||direction=="r"?"left":"top",v,this.preanim(arguments,2))}return scrolled}});Ext.Element.VISIBILITY=1;Ext.Element.DISPLAY=2;Ext.Element.addMethods(function(){var VISIBILITY="visibility",DISPLAY="display",HIDDEN="hidden",NONE="none",ORIGINALDISPLAY="originalDisplay",VISMODE="visibilityMode",ELDISPLAY=Ext.Element.DISPLAY,data=Ext.Element.data,getDisplay=function(dom){var d=data(dom,ORIGINALDISPLAY);if(d===undefined){data(dom,ORIGINALDISPLAY,d="")}return d},getVisMode=function(dom){var m=data(dom,VISMODE);if(m===undefined){data(dom,VISMODE,m=1)}return m};return{originalDisplay:"",visibilityMode:1,setVisibilityMode:function(visMode){data(this.dom,VISMODE,visMode);return this},animate:function(args,duration,onComplete,easing,animType){this.anim(args,{duration:duration,callback:onComplete,easing:easing},animType);return this},anim:function(args,opt,animType,defaultDur,defaultEase,cb){animType=animType||"run";opt=opt||{};var me=this,anim=Ext.lib.Anim[animType](me.dom,args,(opt.duration||defaultDur)||0.35,(opt.easing||defaultEase)||"easeOut",function(){if(cb){cb.call(me)}if(opt.callback){opt.callback.call(opt.scope||me,me,opt)}},me);opt.anim=anim;return anim},preanim:function(a,i){return !a[i]?false:(Ext.isObject(a[i])?a[i]:{duration:a[i+1],callback:a[i+2],easing:a[i+3]})},isVisible:function(){return !this.isStyle(VISIBILITY,HIDDEN)&&!this.isStyle(DISPLAY,NONE)},setVisible:function(visible,animate){var me=this,dom=me.dom,isDisplay=getVisMode(this.dom)==ELDISPLAY;if(!animate||!me.anim){if(isDisplay){me.setDisplayed(visible)}else{me.fixDisplay();dom.style.visibility=visible?"visible":HIDDEN}}else{if(visible){me.setOpacity(0.01);me.setVisible(true)}me.anim({opacity:{to:(visible?1:0)}},me.preanim(arguments,1),null,0.35,"easeIn",function(){if(!visible){dom.style[isDisplay?DISPLAY:VISIBILITY]=(isDisplay)?NONE:HIDDEN;Ext.fly(dom).setOpacity(1)}})}return me},toggle:function(animate){var me=this;me.setVisible(!me.isVisible(),me.preanim(arguments,0));return me},setDisplayed:function(value){if(typeof value=="boolean"){value=value?getDisplay(this.dom):NONE}this.setStyle(DISPLAY,value);return this},fixDisplay:function(){var me=this;if(me.isStyle(DISPLAY,NONE)){me.setStyle(VISIBILITY,HIDDEN);me.setStyle(DISPLAY,getDisplay(this.dom));if(me.isStyle(DISPLAY,NONE)){me.setStyle(DISPLAY,"block")}}},hide:function(animate){this.setVisible(false,this.preanim(arguments,0));return this},show:function(animate){this.setVisible(true,this.preanim(arguments,0));return this}}}());Ext.Element.addMethods(function(){var VISIBILITY="visibility",DISPLAY="display",HIDDEN="hidden",NONE="none",XMASKED="x-masked",XMASKEDRELATIVE="x-masked-relative",data=Ext.Element.data;return{isVisible:function(deep){var vis=!this.isStyle(VISIBILITY,HIDDEN)&&!this.isStyle(DISPLAY,NONE),p=this.dom.parentNode;if(deep!==true||!vis){return vis}while(p&&!/body/i.test(p.tagName)){if(!Ext.fly(p,"_isVisible").isVisible()){return false}p=p.parentNode}return true},isDisplayed:function(){return !this.isStyle(DISPLAY,NONE)},enableDisplayMode:function(display){this.setVisibilityMode(Ext.Element.DISPLAY);if(!Ext.isEmpty(display)){data(this.dom,"originalDisplay",display)}return this},mask:function(msg,msgCls){var me=this,dom=me.dom,dh=Ext.DomHelper,EXTELMASKMSG="ext-el-mask-msg",el,mask;if(me.getStyle("position")=="static"){me.addClass(XMASKEDRELATIVE)}if((el=data(dom,"maskMsg"))){el.remove()}if((el=data(dom,"mask"))){el.remove()}mask=dh.append(dom,{cls:"ext-el-mask"},true);data(dom,"mask",mask);me.addClass(XMASKED);mask.setDisplayed(true);if(typeof msg=="string"){var mm=dh.append(dom,{cls:EXTELMASKMSG,cn:{tag:"div"}},true);data(dom,"maskMsg",mm);mm.dom.className=msgCls?EXTELMASKMSG+" "+msgCls:EXTELMASKMSG;mm.dom.firstChild.innerHTML=msg;mm.setDisplayed(true);mm.center(me)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&me.getStyle("height")=="auto"){mask.setSize(undefined,me.getHeight())}return mask},unmask:function(){var me=this,dom=me.dom,mask=data(dom,"mask"),maskMsg=data(dom,"maskMsg");if(mask){if(maskMsg){maskMsg.remove();data(dom,"maskMsg",undefined)}mask.remove();data(dom,"mask",undefined)}me.removeClass([XMASKED,XMASKEDRELATIVE])},isMasked:function(){var m=data(this.dom,"mask");return m&&m.isVisible()},createShim:function(){var el=document.createElement("iframe"),shim;el.frameBorder="0";el.className="ext-shim";el.src=Ext.SSL_SECURE_URL;shim=Ext.get(this.dom.parentNode.insertBefore(el,this.dom));shim.autoBoxAdjust=false;return shim}}}());Ext.Element.addMethods({addKeyListener:function(key,fn,scope){var config;if(!Ext.isObject(key)||Ext.isArray(key)){config={key:key,fn:fn,scope:scope}}else{config={key:key.key,shift:key.shift,ctrl:key.ctrl,alt:key.alt,fn:fn,scope:scope}}return new Ext.KeyMap(this,config)},addKeyMap:function(config){return new Ext.KeyMap(this,config)}});(function(){var NULL=null,UNDEFINED=undefined,TRUE=true,FALSE=false,SETX="setX",SETY="setY",SETXY="setXY",LEFT="left",BOTTOM="bottom",TOP="top",RIGHT="right",HEIGHT="height",WIDTH="width",POINTS="points",HIDDEN="hidden",ABSOLUTE="absolute",VISIBLE="visible",MOTION="motion",POSITION="position",EASEOUT="easeOut",flyEl=new Ext.Element.Flyweight(),queues={},getObject=function(o){return o||{}},fly=function(dom){flyEl.dom=dom;flyEl.id=Ext.id(dom);return flyEl},getQueue=function(id){if(!queues[id]){queues[id]=[]}return queues[id]},setQueue=function(id,value){queues[id]=value};Ext.enableFx=TRUE;Ext.Fx={switchStatements:function(key,fn,argHash){return fn.apply(this,argHash[key])},slideIn:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,xy,r,b,wrap,after,st,args,pt,bw,bh;anchor=anchor||"t";me.queueFx(o,function(){xy=fly(dom).getXY();fly(dom).fixDisplay();r=fly(dom).getFxRestore();b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight};b.right=b.x+b.width;b.bottom=b.y+b.height;fly(dom).setWidth(b.width).setHeight(b.height);wrap=fly(dom).fxWrap(r.pos,o,HIDDEN);st.visibility=VISIBLE;st.position=ABSOLUTE;function after(){fly(dom).fxUnwrap(wrap,r.pos,o);st.width=r.width;st.height=r.height;fly(dom).afterFx(o)}pt={to:[b.x,b.y]};bw={to:b.width};bh={to:b.height};function argCalc(wrap,style,ww,wh,sXY,sXYval,s1,s2,w,h,p){var ret={};fly(wrap).setWidth(ww).setHeight(wh);if(fly(wrap)[sXY]){fly(wrap)[sXY](sXYval)}style[s1]=style[s2]="0";if(w){ret.width=w}if(h){ret.height=h}if(p){ret.points=p}return ret}args=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{t:[wrap,st,b.width,0,NULL,NULL,LEFT,BOTTOM,NULL,bh,NULL],l:[wrap,st,0,b.height,NULL,NULL,RIGHT,TOP,bw,NULL,NULL],r:[wrap,st,b.width,b.height,SETX,b.right,LEFT,TOP,NULL,NULL,pt],b:[wrap,st,b.width,b.height,SETY,b.bottom,LEFT,TOP,NULL,bh,pt],tl:[wrap,st,0,0,NULL,NULL,RIGHT,BOTTOM,bw,bh,pt],bl:[wrap,st,0,0,SETY,b.y+b.height,RIGHT,TOP,bw,bh,pt],br:[wrap,st,0,0,SETXY,[b.right,b.bottom],LEFT,TOP,bw,bh,pt],tr:[wrap,st,0,0,SETX,b.x+b.width,LEFT,BOTTOM,bw,bh,pt]});st.visibility=VISIBLE;fly(wrap).show();arguments.callee.anim=fly(wrap).fxanim(args,o,MOTION,0.5,EASEOUT,after)});return me},slideOut:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,xy=me.getXY(),wrap,r,b,a,zero={to:0};anchor=anchor||"t";me.queueFx(o,function(){r=fly(dom).getFxRestore();b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight};b.right=b.x+b.width;b.bottom=b.y+b.height;fly(dom).setWidth(b.width).setHeight(b.height);wrap=fly(dom).fxWrap(r.pos,o,VISIBLE);st.visibility=VISIBLE;st.position=ABSOLUTE;fly(wrap).setWidth(b.width).setHeight(b.height);function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).fxUnwrap(wrap,r.pos,o);st.width=r.width;st.height=r.height;fly(dom).afterFx(o)}function argCalc(style,s1,s2,p1,v1,p2,v2,p3,v3){var ret={};style[s1]=style[s2]="0";ret[p1]=v1;if(p2){ret[p2]=v2}if(p3){ret[p3]=v3}return ret}a=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{t:[st,LEFT,BOTTOM,HEIGHT,zero],l:[st,RIGHT,TOP,WIDTH,zero],r:[st,LEFT,TOP,WIDTH,zero,POINTS,{to:[b.right,b.y]}],b:[st,LEFT,TOP,HEIGHT,zero,POINTS,{to:[b.x,b.bottom]}],tl:[st,RIGHT,BOTTOM,WIDTH,zero,HEIGHT,zero],bl:[st,RIGHT,TOP,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.x,b.bottom]}],br:[st,LEFT,TOP,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.x+b.width,b.bottom]}],tr:[st,LEFT,BOTTOM,WIDTH,zero,HEIGHT,zero,POINTS,{to:[b.right,b.y]}]});arguments.callee.anim=fly(wrap).fxanim(a,o,MOTION,0.5,EASEOUT,after)});return me},puff:function(o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,width,height,r;me.queueFx(o,function(){width=fly(dom).getWidth();height=fly(dom).getHeight();fly(dom).clearOpacity();fly(dom).show();r=fly(dom).getFxRestore();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;st.fontSize="";fly(dom).afterFx(o)}arguments.callee.anim=fly(dom).fxanim({width:{to:fly(dom).adjustWidth(width*2)},height:{to:fly(dom).adjustHeight(height*2)},points:{by:[-width*0.5,-height*0.5]},opacity:{to:0},fontSize:{to:200,unit:"%"}},o,MOTION,0.5,EASEOUT,after)});return me},switchOff:function(o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,r;me.queueFx(o,function(){fly(dom).clearOpacity();fly(dom).clip();r=fly(dom).getFxRestore();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;fly(dom).afterFx(o)}fly(dom).fxanim({opacity:{to:0.3}},NULL,NULL,0.1,NULL,function(){fly(dom).clearOpacity();(function(){fly(dom).fxanim({height:{to:1},points:{by:[0,fly(dom).getHeight()*0.5]}},o,MOTION,0.3,"easeIn",after)}).defer(100)})});return me},highlight:function(color,o){o=getObject(o);var me=this,dom=me.dom,attr=o.attr||"backgroundColor",a={},restore;me.queueFx(o,function(){fly(dom).clearOpacity();fly(dom).show();function after(){dom.style[attr]=restore;fly(dom).afterFx(o)}restore=dom.style[attr];a[attr]={from:color||"ffff9c",to:o.endColor||fly(dom).getColor(attr)||"ffffff"};arguments.callee.anim=fly(dom).fxanim(a,o,"color",1,"easeIn",after)});return me},frame:function(color,count,o){o=getObject(o);var me=this,dom=me.dom,proxy,active;me.queueFx(o,function(){color=color||"#C3DAF9";if(color.length==6){color="#"+color}count=count||1;fly(dom).show();var xy=fly(dom).getXY(),b={x:xy[0],y:xy[1],0:xy[0],1:xy[1],width:dom.offsetWidth,height:dom.offsetHeight},queue=function(){proxy=fly(document.body||document.documentElement).createChild({style:{position:ABSOLUTE,"z-index":35000,border:"0px solid "+color}});return proxy.queueFx({},animFn)};arguments.callee.anim={isAnimated:true,stop:function(){count=0;proxy.stopFx()}};function animFn(){var scale=Ext.isBorderBox?2:1;active=proxy.anim({top:{from:b.y,to:b.y-20},left:{from:b.x,to:b.x-20},borderWidth:{from:0,to:10},opacity:{from:1,to:0},height:{from:b.height,to:b.height+20*scale},width:{from:b.width,to:b.width+20*scale}},{duration:o.duration||1,callback:function(){proxy.remove();--count>0?queue():fly(dom).afterFx(o)}});arguments.callee.anim={isAnimated:true,stop:function(){active.stop()}}}queue()});return me},pause:function(seconds){var dom=this.dom,t;this.queueFx({},function(){t=setTimeout(function(){fly(dom).afterFx({})},seconds*1000);arguments.callee.anim={isAnimated:true,stop:function(){clearTimeout(t);fly(dom).afterFx({})}}});return this},fadeIn:function(o){o=getObject(o);var me=this,dom=me.dom,to=o.endOpacity||1;me.queueFx(o,function(){fly(dom).setOpacity(0);fly(dom).fixDisplay();dom.style.visibility=VISIBLE;arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,0.5,EASEOUT,function(){if(to==1){fly(dom).clearOpacity()}fly(dom).afterFx(o)})});return me},fadeOut:function(o){o=getObject(o);var me=this,dom=me.dom,style=dom.style,to=o.endOpacity||0;me.queueFx(o,function(){arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,0.5,EASEOUT,function(){if(to==0){Ext.Element.data(dom,"visibilityMode")==Ext.Element.DISPLAY||o.useDisplay?style.display="none":style.visibility=HIDDEN;fly(dom).clearOpacity()}fly(dom).afterFx(o)})});return me},scale:function(w,h,o){this.shift(Ext.apply({},o,{width:w,height:h}));return this},shift:function(o){o=getObject(o);var dom=this.dom,a={};this.queueFx(o,function(){for(var prop in o){if(o[prop]!=UNDEFINED){a[prop]={to:o[prop]}}}a.width?a.width.to=fly(dom).adjustWidth(o.width):a;a.height?a.height.to=fly(dom).adjustWidth(o.height):a;if(a.x||a.y||a.xy){a.points=a.xy||{to:[a.x?a.x.to:fly(dom).getX(),a.y?a.y.to:fly(dom).getY()]}}arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,0.35,EASEOUT,function(){fly(dom).afterFx(o)})});return this},ghost:function(anchor,o){o=getObject(o);var me=this,dom=me.dom,st=dom.style,a={opacity:{to:0},points:{}},pt=a.points,r,w,h;anchor=anchor||"b";me.queueFx(o,function(){r=fly(dom).getFxRestore();w=fly(dom).getWidth();h=fly(dom).getHeight();function after(){o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();fly(dom).clearOpacity();fly(dom).setPositioning(r.pos);st.width=r.width;st.height=r.height;fly(dom).afterFx(o)}pt.by=fly(dom).switchStatements(anchor.toLowerCase(),function(v1,v2){return[v1,v2]},{t:[0,-h],l:[-w,0],r:[w,0],b:[0,h],tl:[-w,-h],bl:[-w,h],br:[w,h],tr:[w,-h]});arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,0.5,EASEOUT,after)});return me},syncFx:function(){var me=this;me.fxDefaults=Ext.apply(me.fxDefaults||{},{block:FALSE,concurrent:TRUE,stopFx:FALSE});return me},sequenceFx:function(){var me=this;me.fxDefaults=Ext.apply(me.fxDefaults||{},{block:FALSE,concurrent:FALSE,stopFx:FALSE});return me},nextFx:function(){var ef=getQueue(this.dom.id)[0];if(ef){ef.call(this)}},hasActiveFx:function(){return getQueue(this.dom.id)[0]},stopFx:function(finish){var me=this,id=me.dom.id;if(me.hasActiveFx()){var cur=getQueue(id)[0];if(cur&&cur.anim){if(cur.anim.isAnimated){setQueue(id,[cur]);cur.anim.stop(finish!==undefined?finish:TRUE)}else{setQueue(id,[])}}}return me},beforeFx:function(o){if(this.hasActiveFx()&&!o.concurrent){if(o.stopFx){this.stopFx();return TRUE}return FALSE}return TRUE},hasFxBlock:function(){var q=getQueue(this.dom.id);return q&&q[0]&&q[0].block},queueFx:function(o,fn){var me=fly(this.dom);if(!me.hasFxBlock()){Ext.applyIf(o,me.fxDefaults);if(!o.concurrent){var run=me.beforeFx(o);fn.block=o.block;getQueue(me.dom.id).push(fn);if(run){me.nextFx()}}else{fn.call(me)}}return me},fxWrap:function(pos,o,vis){var dom=this.dom,wrap,wrapXY;if(!o.wrap||!(wrap=Ext.getDom(o.wrap))){if(o.fixPosition){wrapXY=fly(dom).getXY()}var div=document.createElement("div");div.style.visibility=vis;wrap=dom.parentNode.insertBefore(div,dom);fly(wrap).setPositioning(pos);if(fly(wrap).isStyle(POSITION,"static")){fly(wrap).position("relative")}fly(dom).clearPositioning("auto");fly(wrap).clip();wrap.appendChild(dom);if(wrapXY){fly(wrap).setXY(wrapXY)}}return wrap},fxUnwrap:function(wrap,pos,o){var dom=this.dom;fly(dom).clearPositioning();fly(dom).setPositioning(pos);if(!o.wrap){var pn=fly(wrap).dom.parentNode;pn.insertBefore(dom,wrap);fly(wrap).remove()}},getFxRestore:function(){var st=this.dom.style;return{pos:this.getPositioning(),width:st.width,height:st.height}},afterFx:function(o){var dom=this.dom,id=dom.id;if(o.afterStyle){fly(dom).setStyle(o.afterStyle)}if(o.afterCls){fly(dom).addClass(o.afterCls)}if(o.remove==TRUE){fly(dom).remove()}if(o.callback){o.callback.call(o.scope,fly(dom))}if(!o.concurrent){getQueue(id).shift();fly(dom).nextFx()}},fxanim:function(args,opt,animType,defaultDur,defaultEase,cb){animType=animType||"run";opt=opt||{};var anim=Ext.lib.Anim[animType](this.dom,args,(opt.duration||defaultDur)||0.35,(opt.easing||defaultEase)||EASEOUT,cb,this);opt.anim=anim;return anim}};Ext.Fx.resize=Ext.Fx.scale;Ext.Element.addMethods(Ext.Fx)})();Ext.CompositeElementLite=function(els,root){this.elements=[];this.add(els,root);this.el=new Ext.Element.Flyweight()};Ext.CompositeElementLite.prototype={isComposite:true,getCount:function(){return this.elements.length},add:function(els){if(els){if(Ext.isArray(els)){this.elements=this.elements.concat(els)}else{var yels=this.elements;Ext.each(els,function(e){yels.push(e)})}}return this},invoke:function(fn,args){var els=this.elements,el=this.el;Ext.each(els,function(e){el.dom=e;Ext.Element.prototype[fn].apply(el,args)});return this},item:function(index){var me=this;if(!me.elements[index]){return null}me.el.dom=me.elements[index];return me.el},addListener:function(eventName,handler,scope,opt){Ext.each(this.elements,function(e){Ext.EventManager.on(e,eventName,handler,scope||e,opt)});return this},each:function(fn,scope){var me=this,el=me.el;Ext.each(me.elements,function(e,i){el.dom=e;return fn.call(scope||el,el,me,i)});return me},fill:function(els){var me=this;me.elements=[];me.add(els);return me},filter:function(selector){var els=[],me=this,fn=Ext.isFunction(selector)?selector:function(el){return el.is(selector)};me.each(function(el,self,i){if(fn(el,i)!==false){els[els.length]=el.dom}});me.fill(els);return me},indexOf:function(el){return this.elements.indexOf(Ext.getDom(el))},replaceElement:function(el,replacement,domReplace){var index=!isNaN(el)?el:this.indexOf(el),d;if(index>-1){replacement=Ext.getDom(replacement);if(domReplace){d=this.elements[index];d.parentNode.insertBefore(replacement,d);Ext.removeNode(d)}this.elements.splice(index,1,replacement)}return this},clear:function(){this.elements=[]}};Ext.CompositeElementLite.prototype.on=Ext.CompositeElementLite.prototype.addListener;(function(){var fnName,ElProto=Ext.Element.prototype,CelProto=Ext.CompositeElementLite.prototype;for(fnName in ElProto){if(Ext.isFunction(ElProto[fnName])){(function(fnName){CelProto[fnName]=CelProto[fnName]||function(){return this.invoke(fnName,arguments)}}).call(CelProto,fnName)}}})();if(Ext.DomQuery){Ext.Element.selectorFunction=Ext.DomQuery.select}Ext.Element.select=function(selector,unique,root){var els;if(typeof selector=="string"){els=Ext.Element.selectorFunction(selector,root)}else{if(selector.length!==undefined){els=selector}else{throw"Invalid selector"}}return new Ext.CompositeElementLite(els)};Ext.select=Ext.Element.select;Ext.apply(Ext.CompositeElementLite.prototype,{addElements:function(els,root){if(!els){return this}if(typeof els=="string"){els=Ext.Element.selectorFunction(els,root)}var yels=this.elements;Ext.each(els,function(e){yels.push(Ext.get(e))});return this},first:function(){return this.item(0)},last:function(){return this.item(this.getCount()-1)},contains:function(el){return this.indexOf(el)!=-1},removeElement:function(keys,removeDom){var me=this,els=this.elements,el;Ext.each(keys,function(val){if((el=(els[val]||els[val=me.indexOf(val)]))){if(removeDom){if(el.dom){el.remove()}else{Ext.removeNode(el)}}els.splice(val,1)}});return this}});Ext.CompositeElement=function(els,root){this.elements=[];this.add(els,root)};Ext.extend(Ext.CompositeElement,Ext.CompositeElementLite,{invoke:function(fn,args){Ext.each(this.elements,function(e){Ext.Element.prototype[fn].apply(e,args)});return this},add:function(els,root){if(!els){return this}if(typeof els=="string"){els=Ext.Element.selectorFunction(els,root)}var yels=this.elements;Ext.each(els,function(e){yels.push(Ext.get(e))});return this},item:function(index){return this.elements[index]||null},indexOf:function(el){return this.elements.indexOf(Ext.get(el))},filter:function(selector){var me=this,out=[];Ext.each(me.elements,function(el){if(el.is(selector)){out.push(Ext.get(el))}});me.elements=out;return me},each:function(fn,scope){Ext.each(this.elements,function(e,i){return fn.call(scope||e,e,this,i)},this);return this}});Ext.Element.select=function(selector,unique,root){var els;if(typeof selector=="string"){els=Ext.Element.selectorFunction(selector,root)}else{if(selector.length!==undefined){els=selector}else{throw"Invalid selector"}}return(unique===true)?new Ext.CompositeElement(els):new Ext.CompositeElementLite(els)};Ext.select=Ext.Element.select;(function(){var BEFOREREQUEST="beforerequest",REQUESTCOMPLETE="requestcomplete",REQUESTEXCEPTION="requestexception",UNDEFINED=undefined,LOAD="load",POST="POST",GET="GET",WINDOW=window;Ext.data.Connection=function(config){Ext.apply(this,config);this.addEvents(BEFOREREQUEST,REQUESTCOMPLETE,REQUESTEXCEPTION);Ext.data.Connection.superclass.constructor.call(this)};Ext.extend(Ext.data.Connection,Ext.util.Observable,{timeout:30000,autoAbort:false,disableCaching:true,disableCachingParam:"_dc",request:function(o){var me=this;if(me.fireEvent(BEFOREREQUEST,me,o)){if(o.el){if(!Ext.isEmpty(o.indicatorText)){me.indicatorText='<div class="loading-indicator">'+o.indicatorText+"</div>"}if(me.indicatorText){Ext.getDom(o.el).innerHTML=me.indicatorText}o.success=(Ext.isFunction(o.success)?o.success:function(){}).createInterceptor(function(response){Ext.getDom(o.el).innerHTML=response.responseText})}var p=o.params,url=o.url||me.url,method,cb={success:me.handleResponse,failure:me.handleFailure,scope:me,argument:{options:o},timeout:o.timeout||me.timeout},form,serForm;if(Ext.isFunction(p)){p=p.call(o.scope||WINDOW,o)}p=Ext.urlEncode(me.extraParams,Ext.isObject(p)?Ext.urlEncode(p):p);if(Ext.isFunction(url)){url=url.call(o.scope||WINDOW,o)}if((form=Ext.getDom(o.form))){url=url||form.action;if(o.isUpload||/multipart\/form-data/i.test(form.getAttribute("enctype"))){return me.doFormUpload.call(me,o,p,url)}serForm=Ext.lib.Ajax.serializeForm(form);p=p?(p+"&"+serForm):serForm}method=o.method||me.method||((p||o.xmlData||o.jsonData)?POST:GET);if(method===GET&&(me.disableCaching&&o.disableCaching!==false)||o.disableCaching===true){var dcp=o.disableCachingParam||me.disableCachingParam;url=Ext.urlAppend(url,dcp+"="+(new Date().getTime()))}o.headers=Ext.apply(o.headers||{},me.defaultHeaders||{});if(o.autoAbort===true||me.autoAbort){me.abort()}if((method==GET||o.xmlData||o.jsonData)&&p){url=Ext.urlAppend(url,p);p=""}return(me.transId=Ext.lib.Ajax.request(method,url,cb,p,o))}else{return o.callback?o.callback.apply(o.scope,[o,UNDEFINED,UNDEFINED]):null}},isLoading:function(transId){return transId?Ext.lib.Ajax.isCallInProgress(transId):!!this.transId},abort:function(transId){if(transId||this.isLoading()){Ext.lib.Ajax.abort(transId||this.transId)}},handleResponse:function(response){this.transId=false;var options=response.argument.options;response.argument=options?options.argument:null;this.fireEvent(REQUESTCOMPLETE,this,response,options);if(options.success){options.success.call(options.scope,response,options)}if(options.callback){options.callback.call(options.scope,options,true,response)}},handleFailure:function(response,e){this.transId=false;var options=response.argument.options;response.argument=options?options.argument:null;this.fireEvent(REQUESTEXCEPTION,this,response,options,e);if(options.failure){options.failure.call(options.scope,response,options)}if(options.callback){options.callback.call(options.scope,options,false,response)}},doFormUpload:function(o,ps,url){var id=Ext.id(),doc=document,frame=doc.createElement("iframe"),form=Ext.getDom(o.form),hiddens=[],hd,encoding="multipart/form-data",buf={target:form.target,method:form.method,encoding:form.encoding,enctype:form.enctype,action:form.action};Ext.fly(frame).set({id:id,name:id,cls:"x-hidden",src:Ext.SSL_SECURE_URL});doc.body.appendChild(frame);if(Ext.isIE){document.frames[id].name=id}Ext.fly(form).set({target:id,method:POST,enctype:encoding,encoding:encoding,action:url||buf.action});Ext.iterate(Ext.urlDecode(ps,false),function(k,v){hd=doc.createElement("input");Ext.fly(hd).set({type:"hidden",value:v,name:k});form.appendChild(hd);hiddens.push(hd)});function cb(){var me=this,r={responseText:"",responseXML:null,argument:o.argument},doc,firstChild;try{doc=frame.contentWindow.document||frame.contentDocument||WINDOW.frames[id].document;if(doc){if(doc.body){if(/textarea/i.test((firstChild=doc.body.firstChild||{}).tagName)){r.responseText=firstChild.value}else{r.responseText=doc.body.innerHTML}}r.responseXML=doc.XMLDocument||doc}}catch(e){}Ext.EventManager.removeListener(frame,LOAD,cb,me);me.fireEvent(REQUESTCOMPLETE,me,r,o);function runCallback(fn,scope,args){if(Ext.isFunction(fn)){fn.apply(scope,args)}}runCallback(o.success,o.scope,[r,o]);runCallback(o.callback,o.scope,[o,true,r]);if(!me.debugUploads){setTimeout(function(){Ext.removeNode(frame)},100)}}Ext.EventManager.on(frame,LOAD,cb,this);form.submit();Ext.fly(form).set(buf);Ext.each(hiddens,function(h){Ext.removeNode(h)})}})})();Ext.Ajax=new Ext.data.Connection({autoAbort:false,serializeForm:function(form){return Ext.lib.Ajax.serializeForm(form)}});Ext.UpdateManager=Ext.Updater=Ext.extend(Ext.util.Observable,function(){var BEFOREUPDATE="beforeupdate",UPDATE="update",FAILURE="failure";function processSuccess(response){var me=this;me.transaction=null;if(response.argument.form&&response.argument.reset){try{response.argument.form.reset()}catch(e){}}if(me.loadScripts){me.renderer.render(me.el,response,me,updateComplete.createDelegate(me,[response]))}else{me.renderer.render(me.el,response,me);updateComplete.call(me,response)}}function updateComplete(response,type,success){this.fireEvent(type||UPDATE,this.el,response);if(Ext.isFunction(response.argument.callback)){response.argument.callback.call(response.argument.scope,this.el,Ext.isEmpty(success)?true:false,response,response.argument.options)}}function processFailure(response){updateComplete.call(this,response,FAILURE,!!(this.transaction=null))}return{constructor:function(el,forceNew){var me=this;el=Ext.get(el);if(!forceNew&&el.updateManager){return el.updateManager}me.el=el;me.defaultUrl=null;me.addEvents(BEFOREUPDATE,UPDATE,FAILURE);Ext.apply(me,Ext.Updater.defaults);me.transaction=null;me.refreshDelegate=me.refresh.createDelegate(me);me.updateDelegate=me.update.createDelegate(me);me.formUpdateDelegate=(me.formUpdate||function(){}).createDelegate(me);me.renderer=me.renderer||me.getDefaultRenderer();Ext.Updater.superclass.constructor.call(me)},setRenderer:function(renderer){this.renderer=renderer},getRenderer:function(){return this.renderer},getDefaultRenderer:function(){return new Ext.Updater.BasicRenderer()},setDefaultUrl:function(defaultUrl){this.defaultUrl=defaultUrl},getEl:function(){return this.el},update:function(url,params,callback,discardUrl){var me=this,cfg,callerScope;if(me.fireEvent(BEFOREUPDATE,me.el,url,params)!==false){if(Ext.isObject(url)){cfg=url;url=cfg.url;params=params||cfg.params;callback=callback||cfg.callback;discardUrl=discardUrl||cfg.discardUrl;callerScope=cfg.scope;if(!Ext.isEmpty(cfg.nocache)){me.disableCaching=cfg.nocache}if(!Ext.isEmpty(cfg.text)){me.indicatorText='<div class="loading-indicator">'+cfg.text+"</div>"}if(!Ext.isEmpty(cfg.scripts)){me.loadScripts=cfg.scripts}if(!Ext.isEmpty(cfg.timeout)){me.timeout=cfg.timeout}}me.showLoading();if(!discardUrl){me.defaultUrl=url}if(Ext.isFunction(url)){url=url.call(me)}var o=Ext.apply({},{url:url,params:(Ext.isFunction(params)&&callerScope)?params.createDelegate(callerScope):params,success:processSuccess,failure:processFailure,scope:me,callback:undefined,timeout:(me.timeout*1000),disableCaching:me.disableCaching,argument:{options:cfg,url:url,form:null,callback:callback,scope:callerScope||window,params:params}},cfg);me.transaction=Ext.Ajax.request(o)}},formUpdate:function(form,url,reset,callback){var me=this;if(me.fireEvent(BEFOREUPDATE,me.el,form,url)!==false){if(Ext.isFunction(url)){url=url.call(me)}form=Ext.getDom(form);me.transaction=Ext.Ajax.request({form:form,url:url,success:processSuccess,failure:processFailure,scope:me,timeout:(me.timeout*1000),argument:{url:url,form:form,callback:callback,reset:reset}});me.showLoading.defer(1,me)}},startAutoRefresh:function(interval,url,params,callback,refreshNow){var me=this;if(refreshNow){me.update(url||me.defaultUrl,params,callback,true)}if(me.autoRefreshProcId){clearInterval(me.autoRefreshProcId)}me.autoRefreshProcId=setInterval(me.update.createDelegate(me,[url||me.defaultUrl,params,callback,true]),interval*1000)},stopAutoRefresh:function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId);delete this.autoRefreshProcId}},isAutoRefreshing:function(){return !!this.autoRefreshProcId},showLoading:function(){if(this.showLoadIndicator){this.el.dom.innerHTML=this.indicatorText}},abort:function(){if(this.transaction){Ext.Ajax.abort(this.transaction)}},isUpdating:function(){return this.transaction?Ext.Ajax.isLoading(this.transaction):false},refresh:function(callback){if(this.defaultUrl){this.update(this.defaultUrl,null,callback,true)}}}}());Ext.Updater.defaults={timeout:30,disableCaching:false,showLoadIndicator:true,indicatorText:'<div class="loading-indicator">Loading...</div>',loadScripts:false,sslBlankUrl:Ext.SSL_SECURE_URL};Ext.Updater.updateElement=function(el,url,params,options){var um=Ext.get(el).getUpdater();Ext.apply(um,options);um.update(url,params,options?options.callback:null)};Ext.Updater.BasicRenderer=function(){};Ext.Updater.BasicRenderer.prototype={render:function(el,response,updateManager,callback){el.update(response.responseText,updateManager.loadScripts,callback)}};(function(){Date.useStrict=false;function xf(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i]})}Date.formatCodeToRegex=function(character,currentGroup){var p=Date.parseCodes[character];if(p){p=typeof p=="function"?p():p;Date.parseCodes[character]=p}return p?Ext.applyIf({c:p.c?xf(p.c,currentGroup||"{0}"):p.c},p):{g:0,c:null,s:Ext.escapeRe(character)}};var $f=Date.formatCodeToRegex;Ext.apply(Date,{parseFunctions:{"M$":function(input,strict){var re=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/");var r=(input||"").match(re);return r?new Date(((r[1]||"")+r[2])*1):null}},parseRegexes:[],formatFunctions:{"M$":function(){return"\\/Date("+this.getTime()+")\\/"}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},getShortMonthName:function(month){return Date.monthNames[month].substring(0,3)},getShortDayName:function(day){return Date.dayNames[day].substring(0,3)},getMonthNumber:function(name){return Date.monthNumbers[name.substring(0,1).toUpperCase()+name.substring(1,3).toLowerCase()]},formatCodes:{d:"String.leftPad(this.getDate(), 2, '0')",D:"Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"this.getSuffix()",w:"this.getDay()",z:"this.getDayOfYear()",W:"String.leftPad(this.getWeekOfYear(), 2, '0')",F:"Date.monthNames[this.getMonth()]",m:"String.leftPad(this.getMonth() + 1, 2, '0')",M:"Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"this.getFullYear()",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"String.leftPad(this.getHours(), 2, '0')",i:"String.leftPad(this.getMinutes(), 2, '0')",s:"String.leftPad(this.getSeconds(), 2, '0')",u:"String.leftPad(this.getMilliseconds(), 3, '0')",O:"this.getGMTOffset()",P:"this.getGMTOffset(true)",T:"this.getTimezone()",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var c="Y-m-dTH:i:sP",code=[],i=0,l=c.length;i<l;++i){var e=c.charAt(i);code.push(e=="T"?"'T'":Date.getFormatCode(e))}return code.join(" + ")},U:"Math.round(this.getTime() / 1000)"},isValid:function(y,m,d,h,i,s,ms){h=h||0;i=i||0;s=s||0;ms=ms||0;var dt=new Date(y,m-1,d,h,i,s,ms);return y==dt.getFullYear()&&m==dt.getMonth()+1&&d==dt.getDate()&&h==dt.getHours()&&i==dt.getMinutes()&&s==dt.getSeconds()&&ms==dt.getMilliseconds()},parseDate:function(input,format,strict){var p=Date.parseFunctions;if(p[format]==null){Date.createParser(format)}return p[format](input,Ext.isDefined(strict)?strict:Date.useStrict)},getFormatCode:function(character){var f=Date.formatCodes[character];if(f){f=typeof f=="function"?f():f;Date.formatCodes[character]=f}return f||("'"+String.escape(character)+"'")},createFormat:function(format){var code=[],special=false,ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;code.push("'"+String.escape(ch)+"'")}else{code.push(Date.getFormatCode(ch))}}}Date.formatFunctions[format]=new Function("return "+code.join("+"))},createParser:function(){var code=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Date.defaults,","results = String(input).match(Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = (new Date()).clearTime();","y = y >= 0? y : Ext.num(def.y, dt.getFullYear());","m = m >= 0? m : Ext.num(def.m - 1, dt.getMonth());","d = d >= 0? d : Ext.num(def.d, dt.getDate());","h  = h || Ext.num(def.h, dt.getHours());","i  = i || Ext.num(def.i, dt.getMinutes());","s  = s || Ext.num(def.s, dt.getSeconds());","ms = ms || Ext.num(def.ms, dt.getMilliseconds());","if(z >= 0 && y >= 0){","v = new Date(y, 0, 1, h, i, s, ms);","v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);","}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = new Date(y, m, d, h, i, s, ms);","}","}","}","if(v){","if(zz != null){","v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");return function(format){var regexNum=Date.parseRegexes.length,currentGroup=1,calc=[],regex=[],special=false,ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;regex.push(String.escape(ch))}else{var obj=$f(ch,currentGroup);currentGroup+=obj.g;regex.push(obj.s);if(obj.g&&obj.c){calc.push(obj.c)}}}}Date.parseRegexes[regexNum]=new RegExp("^"+regex.join("")+"$","i");Date.parseFunctions[format]=new Function("input","strict",xf(code,regexNum,calc.join("")))}}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var a=[],i=0;i<7;a.push(Date.getShortDayName(i)),++i){}return{g:0,c:null,s:"(?:"+a.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n",s:"("+Date.monthNames.join("|")+")"}},M:function(){for(var a=[],i=0;i<12;a.push(Date.getShortMonthName(i)),++i){}return Ext.applyIf({s:"("+a.join("|")+")"},$f("F"))},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return $f("Y")},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (results[{0}] == 'am') {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm)"},A:{g:1,c:"if (results[{0}] == 'AM') {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM)"},g:function(){return $f("G")},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return $f("H")},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var calc=[],arr=[$f("Y",1),$f("m",2),$f("d",3),$f("h",4),$f("i",5),$f("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",$f("P",8).c,"}else{",$f("O",8).c,"}","}"].join("\n")}];for(var i=0,l=arr.length;i<l;++i){calc.push(arr[i].c)}return{g:1,c:calc.join(""),s:[arr[0].s,"(?:","-",arr[1].s,"(?:","-",arr[2].s,"(?:","(?:T| )?",arr[3].s,":",arr[4].s,"(?::",arr[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}}})}());Ext.apply(Date.prototype,{dateFormat:function(format){if(Date.formatFunctions[format]==null){Date.createFormat(format)}return Date.formatFunctions[format].call(this)},getTimezone:function(){return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")},getGMTOffset:function(colon){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+(colon?":":"")+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0")},getDayOfYear:function(){var num=0,d=this.clone(),m=this.getMonth(),i;for(i=0,d.setDate(1),d.setMonth(0);i<m;d.setMonth(++i)){num+=d.getDaysInMonth()}return num+this.getDate()-1},getWeekOfYear:function(){var ms1d=86400000,ms7d=7*ms1d;return function(){var DC3=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/ms1d,AWN=Math.floor(DC3/7),Wyr=new Date(AWN*ms7d).getUTCFullYear();return AWN-Math.floor(Date.UTC(Wyr,0,7)/ms7d)+1}}(),isLeapYear:function(){var year=this.getFullYear();return !!((year&3)==0&&(year%100||(year%400==0&&year)))},getFirstDayOfMonth:function(){var day=(this.getDay()-(this.getDate()-1))%7;return(day<0)?(day+7):day},getLastDayOfMonth:function(){return this.getLastDateOfMonth().getDay()},getFirstDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1)},getLastDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())},getDaysInMonth:function(){var daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];return function(){var m=this.getMonth();return m==1&&this.isLeapYear()?29:daysInMonth[m]}}(),getSuffix:function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},clone:function(){return new Date(this.getTime())},isDST:function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()},clearTime:function(clone){if(clone){return this.clone().clearTime()}var d=this.getDate();this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);if(this.getDate()!=d){for(var hr=1,c=this.add(Date.HOUR,hr);c.getDate()!=d;hr++,c=this.add(Date.HOUR,hr)){}this.setDate(d);this.setHours(c.getHours())}return this},add:function(interval,value){var d=this.clone();if(!interval||value===0){return d}switch(interval.toLowerCase()){case Date.MILLI:d.setMilliseconds(this.getMilliseconds()+value);break;case Date.SECOND:d.setSeconds(this.getSeconds()+value);break;case Date.MINUTE:d.setMinutes(this.getMinutes()+value);break;case Date.HOUR:d.setHours(this.getHours()+value);break;case Date.DAY:d.setDate(this.getDate()+value);break;case Date.MONTH:var day=this.getDate();if(day>28){day=Math.min(day,this.getFirstDateOfMonth().add("mo",value).getLastDateOfMonth().getDate())}d.setDate(day);d.setMonth(this.getMonth()+value);break;case Date.YEAR:d.setFullYear(this.getFullYear()+value);break}return d},between:function(start,end){var t=this.getTime();return start.getTime()<=t&&t<=end.getTime()}});Date.prototype.format=Date.prototype.dateFormat;if(Ext.isSafari&&(navigator.userAgent.match(/WebKit\/(\d+)/)[1]||NaN)<420){Ext.apply(Date.prototype,{_xMonth:Date.prototype.setMonth,_xDate:Date.prototype.setDate,setMonth:function(num){if(num<=-1){var n=Math.ceil(-num),back_year=Math.ceil(n/12),month=(n%12)?12-n%12:0;this.setFullYear(this.getFullYear()-back_year);return this._xMonth(month)}else{return this._xMonth(num)}},setDate:function(d){return this.setTime(this.getTime()-(this.getDate()-d)*86400000)}})}Ext.util.DelayedTask=function(fn,scope,args){var me=this,id,call=function(){clearInterval(id);id=null;fn.apply(scope,args||[])};me.delay=function(delay,newFn,newScope,newArgs){me.cancel();fn=newFn||fn;scope=newScope||scope;args=newArgs||args;id=setInterval(call,delay)};me.cancel=function(){if(id){clearInterval(id);id=null}}};Ext.util.MixedCollection=function(allowFunctions,keyFn){this.items=[];this.map={};this.keys=[];this.length=0;this.addEvents("clear","add","replace","remove","sort");this.allowFunctions=allowFunctions===true;if(keyFn){this.getKey=keyFn}Ext.util.MixedCollection.superclass.constructor.call(this)};Ext.extend(Ext.util.MixedCollection,Ext.util.Observable,{allowFunctions:false,add:function(key,o){if(arguments.length==1){o=arguments[0];key=this.getKey(o)}if(typeof key!="undefined"&&key!==null){var old=this.map[key];if(typeof old!="undefined"){return this.replace(key,o)}this.map[key]=o}this.length++;this.items.push(o);this.keys.push(key);this.fireEvent("add",this.length-1,o,key);return o},getKey:function(o){return o.id},replace:function(key,o){if(arguments.length==1){o=arguments[0];key=this.getKey(o)}var old=this.map[key];if(typeof key=="undefined"||key===null||typeof old=="undefined"){return this.add(key,o)}var index=this.indexOfKey(key);this.items[index]=o;this.map[key]=o;this.fireEvent("replace",key,old,o);return o},addAll:function(objs){if(arguments.length>1||Ext.isArray(objs)){var args=arguments.length>1?arguments:objs;for(var i=0,len=args.length;i<len;i++){this.add(args[i])}}else{for(var key in objs){if(this.allowFunctions||typeof objs[key]!="function"){this.add(key,objs[key])}}}},each:function(fn,scope){var items=[].concat(this.items);for(var i=0,len=items.length;i<len;i++){if(fn.call(scope||items[i],items[i],i,len)===false){break}}},eachKey:function(fn,scope){for(var i=0,len=this.keys.length;i<len;i++){fn.call(scope||window,this.keys[i],this.items[i],i,len)}},find:function(fn,scope){for(var i=0,len=this.items.length;i<len;i++){if(fn.call(scope||window,this.items[i],this.keys[i])){return this.items[i]}}return null},insert:function(index,key,o){if(arguments.length==2){o=arguments[1];key=this.getKey(o)}if(this.containsKey(key)){this.suspendEvents();this.removeKey(key);this.resumeEvents()}if(index>=this.length){return this.add(key,o)}this.length++;this.items.splice(index,0,o);if(typeof key!="undefined"&&key!==null){this.map[key]=o}this.keys.splice(index,0,key);this.fireEvent("add",index,o,key);return o},remove:function(o){return this.removeAt(this.indexOf(o))},removeAt:function(index){if(index<this.length&&index>=0){this.length--;var o=this.items[index];this.items.splice(index,1);var key=this.keys[index];if(typeof key!="undefined"){delete this.map[key]}this.keys.splice(index,1);this.fireEvent("remove",o,key);return o}return false},removeKey:function(key){return this.removeAt(this.indexOfKey(key))},getCount:function(){return this.length},indexOf:function(o){return this.items.indexOf(o)},indexOfKey:function(key){return this.keys.indexOf(key)},item:function(key){var mk=this.map[key],item=mk!==undefined?mk:(typeof key=="number")?this.items[key]:undefined;return !Ext.isFunction(item)||this.allowFunctions?item:null},itemAt:function(index){return this.items[index]},key:function(key){return this.map[key]},contains:function(o){return this.indexOf(o)!=-1},containsKey:function(key){return typeof this.map[key]!="undefined"},clear:function(){this.length=0;this.items=[];this.keys=[];this.map={};this.fireEvent("clear")},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},_sort:function(property,dir,fn){var i,len,dsc=String(dir).toUpperCase()=="DESC"?-1:1,c=[],k=this.keys,items=this.items;fn=fn||function(a,b){return a-b};for(i=0,len=items.length;i<len;i++){c[c.length]={key:k[i],value:items[i],index:i}}c.sort(function(a,b){var v=fn(a[property],b[property])*dsc;if(v===0){v=(a.index<b.index?-1:1)}return v});for(i=0,len=c.length;i<len;i++){items[i]=c[i].value;k[i]=c[i].key}this.fireEvent("sort",this)},sort:function(dir,fn){this._sort("value",dir,fn)},keySort:function(dir,fn){this._sort("key",dir,fn||function(a,b){var v1=String(a).toUpperCase(),v2=String(b).toUpperCase();return v1>v2?1:(v1<v2?-1:0)})},getRange:function(start,end){var items=this.items;if(items.length<1){return[]}start=start||0;end=Math.min(typeof end=="undefined"?this.length-1:end,this.length-1);var i,r=[];if(start<=end){for(i=start;i<=end;i++){r[r.length]=items[i]}}else{for(i=start;i>=end;i--){r[r.length]=items[i]}}return r},filter:function(property,value,anyMatch,caseSensitive){if(Ext.isEmpty(value,false)){return this.clone()}value=this.createValueMatcher(value,anyMatch,caseSensitive);return this.filterBy(function(o){return o&&value.test(o[property])})},filterBy:function(fn,scope){var r=new Ext.util.MixedCollection();r.getKey=this.getKey;var k=this.keys,it=this.items;for(var i=0,len=it.length;i<len;i++){if(fn.call(scope||this,it[i],k[i])){r.add(k[i],it[i])}}return r},findIndex:function(property,value,start,anyMatch,caseSensitive){if(Ext.isEmpty(value,false)){return -1}value=this.createValueMatcher(value,anyMatch,caseSensitive);return this.findIndexBy(function(o){return o&&value.test(o[property])},null,start)},findIndexBy:function(fn,scope,start){var k=this.keys,it=this.items;for(var i=(start||0),len=it.length;i<len;i++){if(fn.call(scope||this,it[i],k[i])){return i}}return -1},createValueMatcher:function(value,anyMatch,caseSensitive){if(!value.exec){value=String(value);value=new RegExp((anyMatch===true?"":"^")+Ext.escapeRe(value),caseSensitive?"":"i")}return value},clone:function(){var r=new Ext.util.MixedCollection();var k=this.keys,it=this.items;for(var i=0,len=it.length;i<len;i++){r.add(k[i],it[i])}r.getKey=this.getKey;return r}});Ext.util.MixedCollection.prototype.get=Ext.util.MixedCollection.prototype.item;Ext.util.JSON=new (function(){var useHasOwn=!!{}.hasOwnProperty,isNative=function(){var useNative=null;return function(){if(useNative===null){useNative=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"}return useNative}}(),pad=function(n){return n<10?"0"+n:n},doDecode=function(json){return eval("("+json+")")},doEncode=function(o){if(!Ext.isDefined(o)||o===null){return"null"}else{if(Ext.isArray(o)){return encodeArray(o)}else{if(Ext.isDate(o)){return Ext.util.JSON.encodeDate(o)}else{if(Ext.isString(o)){return encodeString(o)}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(Ext.isBoolean(o)){return String(o)}else{var a=["{"],b,i,v;for(i in o){if(!o.getElementsByTagName){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(doEncode(i),":",v===null?"null":doEncode(v));b=true}}}}a.push("}");return a.join("")}}}}}}},m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+s+'"'},encodeArray=function(o){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i+=1){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(v===null?"null":Ext.util.JSON.encode(v));b=true}}a.push("]");return a.join("")};this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'};this.encode=function(){var ec;return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode}return ec(o)}}();this.decode=function(){var dc;return function(json){if(!dc){dc=isNative()?JSON.parse:doDecode}return dc(json)}}()})();Ext.encode=Ext.util.JSON.encode;Ext.decode=Ext.util.JSON.decode;Ext.util.Format=function(){var trimRe=/^\s+|\s+$/g;return{ellipsis:function(value,len,word){if(value&&value.length>len){if(word){var vs=value.substr(0,len-2);var index=Math.max(vs.lastIndexOf(" "),vs.lastIndexOf("."),vs.lastIndexOf("!"),vs.lastIndexOf("?"));if(index==-1||index<(len-15)){return value.substr(0,len-3)+"..."}else{return vs.substr(0,index)+"..."}}else{return value.substr(0,len-3)+"..."}}return value},undef:function(value){return value!==undefined?value:""},defaultValue:function(value,defaultValue){return value!==undefined&&value!==""?value:defaultValue},htmlEncode:function(value){return !value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(value){return !value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},trim:function(value){return String(value).replace(trimRe,"")},substr:function(value,start,length){return String(value).substr(start,length)},lowercase:function(value){return String(value).toLowerCase()},uppercase:function(value){return String(value).toUpperCase()},capitalize:function(value){return !value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase()},call:function(value,fn){if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);args.unshift(value);return eval(fn).apply(window,args)}else{return eval(fn).call(window,value)}},usMoney:function(v){v=(Math.round((v-0)*100))/100;v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);v=String(v);var ps=v.split(".");var whole=ps[0];var sub=ps[1]?"."+ps[1]:".00";var r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,"$1,$2")}v=whole+sub;if(v.charAt(0)=="-"){return"-$"+v.substr(1)}return"$"+v},date:function(v,format){if(!v){return""}if(!Ext.isDate(v)){v=new Date(Date.parse(v))}return v.dateFormat(format||"m/d/Y")},dateRenderer:function(format){return function(v){return Ext.util.Format.date(v,format)}},stripTagsRE:/<\/?[^>]+>/gi,stripTags:function(v){return !v?v:String(v).replace(this.stripTagsRE,"")},stripScriptsRe:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,stripScripts:function(v){return !v?v:String(v).replace(this.stripScriptsRe,"")},fileSize:function(size){if(size<1024){return size+" bytes"}else{if(size<1048576){return(Math.round(((size*10)/1024))/10)+" KB"}else{return(Math.round(((size*10)/1048576))/10)+" MB"}}},math:function(){var fns={};return function(v,a){if(!fns[a]){fns[a]=new Function("v","return v "+a+";")}return fns[a](v)}}(),round:function(value,precision){var result=Number(value);if(typeof precision=="number"){precision=Math.pow(10,precision);result=Math.round(value*precision)/precision}return result},number:function(v,format){if(!format){return v}v=Ext.num(v,NaN);if(isNaN(v)){return""}var comma=",",dec=".",i18n=false,neg=v<0;v=Math.abs(v);if(format.substr(format.length-2)=="/i"){format=format.substr(0,format.length-2);i18n=true;comma=".";dec=","}var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,""):format.replace(/[^\d\.]/g,"")).split(dec);if(1<psplit.length){v=v.toFixed(psplit[1].length)}else{if(2<psplit.length){throw ("NumberFormatException: invalid format, formats should have no more than 1 period: "+format)}else{v=v.toFixed(0)}}var fnum=v.toString();if(hasComma){psplit=fnum.split(".");var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3;for(var i=0;i<j;i+=n){if(i!=0){n=3}parr[parr.length]=cnum.substr(i,n);m-=1}fnum=parr.join(comma);if(psplit[1]){fnum+=dec+psplit[1]}}return(neg?"-":"")+format.replace(/[\d,?\.?]+/,fnum)},numberRenderer:function(format){return function(v){return Ext.util.Format.number(v,format)}},plural:function(v,s,p){return v+" "+(v==1?s:(p?p:s+"s"))},nl2br:function(v){return v===undefined||v===null?"":v.replace(/\n/g,"<br/>")}}}();Ext.XTemplate=function(){Ext.XTemplate.superclass.constructor.apply(this,arguments);var me=this,s=me.html,re=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,nameRe=/^<tpl\b[^>]*?for="(.*?)"/,ifRe=/^<tpl\b[^>]*?if="(.*?)"/,execRe=/^<tpl\b[^>]*?exec="(.*?)"/,m,id=0,tpls=[],VALUES="values",PARENT="parent",XINDEX="xindex",XCOUNT="xcount",RETURN="return ",WITHVALUES="with(values){ ";s=["<tpl>",s,"</tpl>"].join("");while((m=s.match(re))){var m2=m[0].match(nameRe),m3=m[0].match(ifRe),m4=m[0].match(execRe),exp=null,fn=null,exec=null,name=m2&&m2[1]?m2[1]:"";if(m3){exp=m3&&m3[1]?m3[1]:null;if(exp){fn=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+RETURN+(Ext.util.Format.htmlDecode(exp))+"; }")}}if(m4){exp=m4&&m4[1]?m4[1]:null;if(exp){exec=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+(Ext.util.Format.htmlDecode(exp))+"; }")}}if(name){switch(name){case".":name=new Function(VALUES,PARENT,WITHVALUES+RETURN+VALUES+"; }");break;case"..":name=new Function(VALUES,PARENT,WITHVALUES+RETURN+PARENT+"; }");break;default:name=new Function(VALUES,PARENT,WITHVALUES+RETURN+name+"; }")}}tpls.push({id:id,target:name,exec:exec,test:fn,body:m[1]||""});s=s.replace(m[0],"{xtpl"+id+"}");++id}Ext.each(tpls,function(t){me.compileTpl(t)});me.master=tpls[tpls.length-1];me.tpls=tpls};Ext.extend(Ext.XTemplate,Ext.Template,{re:/\{([\w-\.\#]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,applySubTemplate:function(id,values,parent,xindex,xcount){var me=this,len,t=me.tpls[id],vs,buf=[];if((t.test&&!t.test.call(me,values,parent,xindex,xcount))||(t.exec&&t.exec.call(me,values,parent,xindex,xcount))){return""}vs=t.target?t.target.call(me,values,parent):values;len=vs.length;parent=t.target?values:parent;if(t.target&&Ext.isArray(vs)){Ext.each(vs,function(v,i){buf[buf.length]=t.compiled.call(me,v,parent,i+1,len)});return buf.join("")}return t.compiled.call(me,vs,parent,xindex,xcount)},compileTpl:function(tpl){var fm=Ext.util.Format,useF=this.disableFormats!==true,sep=Ext.isGecko?"+":",",body;function fn(m,name,format,args,math){if(name.substr(0,4)=="xtpl"){return"'"+sep+"this.applySubTemplate("+name.substr(4)+", values, parent, xindex, xcount)"+sep+"'"}var v;if(name==="."){v="values"}else{if(name==="#"){v="xindex"}else{if(name.indexOf(".")!=-1){v=name}else{v="values['"+name+"']"}}}if(math){v="("+v+math+")"}if(format&&useF){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="("+v+" === undefined ? '' : "}return"'"+sep+format+v+args+")"+sep+"'"}function codeFn(m,code){return"'"+sep+"("+code.replace(/\\'/g,"'")+")"+sep+"'"}if(Ext.isGecko){body="tpl.compiled = function(values, parent, xindex, xcount){ return '"+tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn)+"';};"}else{body=["tpl.compiled = function(values, parent, xindex, xcount){ return ['"];body.push(tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn));body.push("'].join('');};");body=body.join("")}eval(body);return this},applyTemplate:function(values){return this.master.compiled.call(this,values,{},1,1)},compile:function(){return this}});Ext.XTemplate.prototype.apply=Ext.XTemplate.prototype.applyTemplate;Ext.XTemplate.from=function(el){el=Ext.getDom(el);return new Ext.XTemplate(el.value||el.innerHTML)};Ext.util.CSS=function(){var rules=null;var doc=document;var camelRe=/(-[a-z])/gi;var camelFn=function(m,a){return a.charAt(1).toUpperCase()};return{createStyleSheet:function(cssText,id){var ss;var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id)}if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss){if(!rules){rules={}}try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){rules[ssRules[j].selectorText.toLowerCase()]=ssRules[j]}}catch(e){}},getRules:function(refreshCache){if(rules===null||refreshCache){rules={};var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}return rules},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector.toLowerCase()]}for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i].toLowerCase()]}}return null},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return true}}}return false}}}();Ext.util.ClickRepeater=function(el,config){this.el=Ext.get(el);this.el.unselectable();Ext.apply(this,config);this.addEvents("mousedown","click","mouseup");if(!this.disabled){this.disabled=true;this.enable()}if(this.handler){this.on("click",this.handler,this.scope||this)}Ext.util.ClickRepeater.superclass.constructor.call(this)};Ext.extend(Ext.util.ClickRepeater,Ext.util.Observable,{interval:20,delay:250,preventDefault:true,stopDefault:false,timer:0,enable:function(){if(this.disabled){this.el.on("mousedown",this.handleMouseDown,this);if(this.preventDefault||this.stopDefault){this.el.on("click",this.eventOptions,this)}}this.disabled=false},disable:function(force){if(force||!this.disabled){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass)}Ext.getDoc().un("mouseup",this.handleMouseUp,this);this.el.removeAllListeners()}this.disabled=true},setDisabled:function(disabled){this[disabled?"disable":"enable"]()},eventOptions:function(e){if(this.preventDefault){e.preventDefault()}if(this.stopDefault){e.stopEvent()}},destroy:function(){this.disable(true);Ext.destroy(this.el);this.purgeListeners()},handleMouseDown:function(){clearTimeout(this.timer);this.el.blur();if(this.pressClass){this.el.addClass(this.pressClass)}this.mousedownTime=new Date();Ext.getDoc().on("mouseup",this.handleMouseUp,this);this.el.on("mouseout",this.handleMouseOut,this);this.fireEvent("mousedown",this);this.fireEvent("click",this);if(this.accelerate){this.delay=400}this.timer=this.click.defer(this.delay||this.interval,this)},click:function(){this.fireEvent("click",this);this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12000):this.interval,this)},easeOutExpo:function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},handleMouseOut:function(){clearTimeout(this.timer);if(this.pressClass){this.el.removeClass(this.pressClass)}this.el.on("mouseover",this.handleMouseReturn,this)},handleMouseReturn:function(){this.el.un("mouseover",this.handleMouseReturn,this);if(this.pressClass){this.el.addClass(this.pressClass)}this.click()},handleMouseUp:function(){clearTimeout(this.timer);this.el.un("mouseover",this.handleMouseReturn,this);this.el.un("mouseout",this.handleMouseOut,this);Ext.getDoc().un("mouseup",this.handleMouseUp,this);this.el.removeClass(this.pressClass);this.fireEvent("mouseup",this)}});Ext.KeyNav=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(!this.disabled){this.disabled=true;this.enable()}};Ext.KeyNav.prototype={disabled:false,defaultEventAction:"stopEvent",forceKeyDown:false,relay:function(e){var k=e.getKey();var h=this.keyToHandler[k];if(h&&this[h]){if(this.doRelay(e,this[h],h)!==true){e[this.defaultEventAction]()}}},doRelay:function(e,h,hname){return h.call(this.scope||this,e)},enter:false,left:false,right:false,up:false,down:false,tab:false,esc:false,pageUp:false,pageDown:false,del:false,home:false,end:false,keyToHandler:{37:"left",39:"right",38:"up",40:"down",33:"pageUp",34:"pageDown",46:"del",36:"home",35:"end",13:"enter",27:"esc",9:"tab"},stopKeyUp:function(e){var k=e.getKey();if(k>=37&&k<=40){e.stopEvent()}},enable:function(){if(this.disabled){if(Ext.isSafari2){this.el.on("keyup",this.stopKeyUp,this)}this.el.on(this.isKeydown()?"keydown":"keypress",this.relay,this);this.disabled=false}},disable:function(){if(!this.disabled){if(Ext.isSafari2){this.el.un("keyup",this.stopKeyUp,this)}this.el.un(this.isKeydown()?"keydown":"keypress",this.relay,this);this.disabled=true}},setDisabled:function(disabled){this[disabled?"disable":"enable"]()},isKeydown:function(){return this.forceKeyDown||Ext.EventManager.useKeydown}};Ext.KeyMap=function(el,config,eventName){this.el=Ext.get(el);this.eventName=eventName||"keydown";this.bindings=[];if(config){this.addBinding(config)}this.enable()};Ext.KeyMap.prototype={stopEvent:false,addBinding:function(config){if(Ext.isArray(config)){Ext.each(config,function(c){this.addBinding(c)},this);return}var keyCode=config.key,fn=config.fn||config.handler,scope=config.scope;if(config.stopEvent){this.stopEvent=config.stopEvent}if(typeof keyCode=="string"){var ks=[];var keyString=keyCode.toUpperCase();for(var j=0,len=keyString.length;j<len;j++){ks.push(keyString.charCodeAt(j))}keyCode=ks}var keyArray=Ext.isArray(keyCode);var handler=function(e){if(this.checkModifiers(config,e)){var k=e.getKey();if(keyArray){for(var i=0,len=keyCode.length;i<len;i++){if(keyCode[i]==k){if(this.stopEvent){e.stopEvent()}fn.call(scope||window,k,e);return}}}else{if(k==keyCode){if(this.stopEvent){e.stopEvent()}fn.call(scope||window,k,e)}}}};this.bindings.push(handler)},checkModifiers:function(config,e){var val,key,keys=["shift","ctrl","alt"];for(var i=0,len=keys.length;i<len;++i){key=keys[i];val=config[key];if(!(val===undefined||(val===e[key+"Key"]))){return false}}return true},on:function(key,fn,scope){var keyCode,shift,ctrl,alt;if(typeof key=="object"&&!Ext.isArray(key)){keyCode=key.key;shift=key.shift;ctrl=key.ctrl;alt=key.alt}else{keyCode=key}this.addBinding({key:keyCode,shift:shift,ctrl:ctrl,alt:alt,fn:fn,scope:scope})},handleKeyDown:function(e){if(this.enabled){var b=this.bindings;for(var i=0,len=b.length;i<len;i++){b[i].call(this,e)}}},isEnabled:function(){return this.enabled},enable:function(){if(!this.enabled){this.el.on(this.eventName,this.handleKeyDown,this);this.enabled=true}},disable:function(){if(this.enabled){this.el.removeListener(this.eventName,this.handleKeyDown,this);this.enabled=false}},setDisabled:function(disabled){this[disabled?"disable":"enable"]()}};Ext.util.TextMetrics=function(){var shared;return{measure:function(el,text,fixedWidth){if(!shared){shared=Ext.util.TextMetrics.Instance(el,fixedWidth)}shared.bind(el);shared.setFixedWidth(fixedWidth||"auto");return shared.getSize(text)},createInstance:function(el,fixedWidth){return Ext.util.TextMetrics.Instance(el,fixedWidth)}}}();Ext.util.TextMetrics.Instance=function(bindTo,fixedWidth){var ml=new Ext.Element(document.createElement("div"));document.body.appendChild(ml.dom);ml.position("absolute");ml.setLeftTop(-1000,-1000);ml.hide();if(fixedWidth){ml.setWidth(fixedWidth)}var instance={getSize:function(text){ml.update(text);var s=ml.getSize();ml.update("");return s},bind:function(el){ml.setStyle(Ext.fly(el).getStyles("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"))},setFixedWidth:function(width){ml.setWidth(width)},getWidth:function(text){ml.dom.style.width="auto";return this.getSize(text).width},getHeight:function(text){return this.getSize(text).height}};instance.bind(bindTo);return instance};Ext.Element.addMethods({getTextWidth:function(text,min,max){return(Ext.util.TextMetrics.measure(this.dom,Ext.value(text,this.dom.innerHTML,true)).width).constrain(min||0,max||1000000)}});Ext.util.Cookies={set:function(name,value){var argv=arguments;var argc=arguments.length;var expires=(argc>2)?argv[2]:null;var path=(argc>3)?argv[3]:"/";var domain=(argc>4)?argv[4]:null;var secure=(argc>5)?argv[5]:false;document.cookie=name+"="+escape(value)+((expires===null)?"":("; expires="+expires.toGMTString()))+((path===null)?"":("; path="+path))+((domain===null)?"":("; domain="+domain))+((secure===true)?"; secure":"")},get:function(name){var arg=name+"=";var alen=arg.length;var clen=document.cookie.length;var i=0;var j=0;while(i<clen){j=i+alen;if(document.cookie.substring(i,j)==arg){return Ext.util.Cookies.getCookieVal(j)}i=document.cookie.indexOf(" ",i)+1;if(i===0){break}}return null},clear:function(name){if(Ext.util.Cookies.get(name)){document.cookie=name+"=; expires=Thu, 01-Jan-70 00:00:01 GMT"}},getCookieVal:function(offset){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1){endstr=document.cookie.length}return unescape(document.cookie.substring(offset,endstr))}};Ext.handleError=function(e){throw e};Ext.Error=function(message){this.message=(this.lang[message])?this.lang[message]:message};Ext.Error.prototype=new Error();Ext.apply(Ext.Error.prototype,{lang:{},name:"Ext.Error",getName:function(){return this.name},getMessage:function(){return this.message},toJson:function(){return Ext.encode(this)}});Ext.ComponentMgr=function(){var all=new Ext.util.MixedCollection();var types={};var ptypes={};return{register:function(c){all.add(c)},unregister:function(c){all.remove(c)},get:function(id){return all.get(id)},onAvailable:function(id,fn,scope){all.on("add",function(index,o){if(o.id==id){fn.call(scope||o,o);all.un("add",fn,scope)}})},all:all,isRegistered:function(xtype){return types[xtype]!==undefined},registerType:function(xtype,cls){types[xtype]=cls;cls.xtype=xtype},create:function(config,defaultType){return config.render?config:new types[config.xtype||defaultType](config)},registerPlugin:function(ptype,cls){ptypes[ptype]=cls;cls.ptype=ptype},createPlugin:function(config,defaultType){return new ptypes[config.ptype||defaultType](config)}}}();Ext.reg=Ext.ComponentMgr.registerType;Ext.preg=Ext.ComponentMgr.registerPlugin;Ext.create=Ext.ComponentMgr.create;Ext.Component=function(config){config=config||{};if(config.initialConfig){if(config.isAction){this.baseAction=config}config=config.initialConfig}else{if(config.tagName||config.dom||Ext.isString(config)){config={applyTo:config,id:config.id||config}}}this.initialConfig=config;Ext.apply(this,config);this.addEvents("disable","enable","beforeshow","show","beforehide","hide","beforerender","render","afterrender","beforedestroy","destroy","beforestaterestore","staterestore","beforestatesave","statesave");this.getId();Ext.ComponentMgr.register(this);Ext.Component.superclass.constructor.call(this);if(this.baseAction){this.baseAction.addComponent(this)}this.initComponent();if(this.plugins){if(Ext.isArray(this.plugins)){for(var i=0,len=this.plugins.length;i<len;i++){this.plugins[i]=this.initPlugin(this.plugins[i])}}else{this.plugins=this.initPlugin(this.plugins)}}if(this.stateful!==false){this.initState(config)}if(this.applyTo){this.applyToMarkup(this.applyTo);delete this.applyTo}else{if(this.renderTo){this.render(this.renderTo);delete this.renderTo}}};Ext.Component.AUTO_ID=1000;Ext.extend(Ext.Component,Ext.util.Observable,{disabled:false,hidden:false,autoEl:"div",disabledClass:"x-item-disabled",allowDomMove:true,autoShow:false,hideMode:"display",hideParent:false,rendered:false,ctype:"Ext.Component",actionMode:"el",getActionEl:function(){return this[this.actionMode]},initPlugin:function(p){if(p.ptype&&!Ext.isFunction(p.init)){p=Ext.ComponentMgr.createPlugin(p)}else{if(Ext.isString(p)){p=Ext.ComponentMgr.createPlugin({ptype:p})}}p.init(this);return p},initComponent:Ext.emptyFn,render:function(container,position){if(!this.rendered&&this.fireEvent("beforerender",this)!==false){if(!container&&this.el){this.el=Ext.get(this.el);container=this.el.dom.parentNode;this.allowDomMove=false}this.container=Ext.get(container);if(this.ctCls){this.container.addClass(this.ctCls)}this.rendered=true;if(position!==undefined){if(Ext.isNumber(position)){position=this.container.dom.childNodes[position]}else{position=Ext.getDom(position)}}this.onRender(this.container,position||null);if(this.autoShow){this.el.removeClass(["x-hidden","x-hide-"+this.hideMode])}if(this.cls){this.el.addClass(this.cls);delete this.cls}if(this.style){this.el.applyStyles(this.style);delete this.style}if(this.overCls){this.el.addClassOnOver(this.overCls)}this.fireEvent("render",this);this.afterRender(this.container);if(this.hidden){this.doHide()}if(this.disabled){this.disable(true)}if(this.stateful!==false){this.initStateEvents()}this.initRef();this.fireEvent("afterrender",this)}return this},initRef:function(){if(this.ref){var levels=this.ref.split("/");var last=levels.length,i=0;var t=this;while(i<last){if(t.ownerCt){t=t.ownerCt}i++}t[levels[--i]]=this}},initState:function(config){if(Ext.state.Manager){var id=this.getStateId();if(id){var state=Ext.state.Manager.get(id);if(state){if(this.fireEvent("beforestaterestore",this,state)!==false){this.applyState(state);this.fireEvent("staterestore",this,state)}}}}},getStateId:function(){return this.stateId||((this.id.indexOf("ext-comp-")==0||this.id.indexOf("ext-gen")==0)?null:this.id)},initStateEvents:function(){if(this.stateEvents){for(var i=0,e;e=this.stateEvents[i];i++){this.on(e,this.saveState,this,{delay:100})}}},applyState:function(state){if(state){Ext.apply(this,state)}},getState:function(){return null},saveState:function(){if(Ext.state.Manager&&this.stateful!==false){var id=this.getStateId();if(id){var state=this.getState();if(this.fireEvent("beforestatesave",this,state)!==false){Ext.state.Manager.set(id,state);this.fireEvent("statesave",this,state)}}}},applyToMarkup:function(el){this.allowDomMove=false;this.el=Ext.get(el);this.render(this.el.dom.parentNode)},addClass:function(cls){if(this.el){this.el.addClass(cls)}else{this.cls=this.cls?this.cls+" "+cls:cls}return this},removeClass:function(cls){if(this.el){this.el.removeClass(cls)}else{if(this.cls){this.cls=this.cls.split(" ").remove(cls).join(" ")}}return this},onRender:function(ct,position){if(!this.el&&this.autoEl){if(Ext.isString(this.autoEl)){this.el=document.createElement(this.autoEl)}else{var div=document.createElement("div");Ext.DomHelper.overwrite(div,this.autoEl);this.el=div.firstChild}if(!this.el.id){this.el.id=this.getId()}}if(this.el){this.el=Ext.get(this.el);if(this.allowDomMove!==false){ct.dom.insertBefore(this.el.dom,position)}}},getAutoCreate:function(){var cfg=Ext.isObject(this.autoCreate)?this.autoCreate:Ext.apply({},this.defaultAutoCreate);if(this.id&&!cfg.id){cfg.id=this.id}return cfg},afterRender:Ext.emptyFn,destroy:function(){if(!this.isDestroyed){if(this.fireEvent("beforedestroy",this)!==false){this.beforeDestroy();if(this.rendered){this.el.removeAllListeners();this.el.remove();if(this.actionMode=="container"||this.removeMode=="container"){this.container.remove()}}this.onDestroy();Ext.ComponentMgr.unregister(this);this.fireEvent("destroy",this);this.purgeListeners();this.isDestroyed=true}}},beforeDestroy:Ext.emptyFn,onDestroy:Ext.emptyFn,getEl:function(){return this.el},getId:function(){return this.id||(this.id="ext-comp-"+(++Ext.Component.AUTO_ID))},getItemId:function(){return this.itemId||this.getId()},focus:function(selectText,delay){if(delay){this.focus.defer(Ext.isNumber(delay)?delay:10,this,[selectText,false]);return}if(this.rendered){this.el.focus();if(selectText===true){this.el.dom.select()}}return this},blur:function(){if(this.rendered){this.el.blur()}return this},disable:function(silent){if(this.rendered){this.onDisable()}this.disabled=true;if(silent!==true){this.fireEvent("disable",this)}return this},onDisable:function(){this.getActionEl().addClass(this.disabledClass);this.el.dom.disabled=true},enable:function(){if(this.rendered){this.onEnable()}this.disabled=false;this.fireEvent("enable",this);return this},onEnable:function(){this.getActionEl().removeClass(this.disabledClass);this.el.dom.disabled=false},setDisabled:function(disabled){return this[disabled?"disable":"enable"]()},show:function(){if(this.fireEvent("beforeshow",this)!==false){this.hidden=false;if(this.autoRender){this.render(Ext.isBoolean(this.autoRender)?Ext.getBody():this.autoRender)}if(this.rendered){this.onShow()}this.fireEvent("show",this)}return this},onShow:function(){this.getVisibilityEl().removeClass("x-hide-"+this.hideMode)},hide:function(){if(this.fireEvent("beforehide",this)!==false){this.doHide();this.fireEvent("hide",this)}return this},doHide:function(){this.hidden=true;if(this.rendered){this.onHide()}},onHide:function(){this.getVisibilityEl().addClass("x-hide-"+this.hideMode)},getVisibilityEl:function(){return this.hideParent?this.container:this.getActionEl()},setVisible:function(visible){return this[visible?"show":"hide"]()},isVisible:function(){return this.rendered&&this.getVisibilityEl().isVisible()},cloneConfig:function(overrides){overrides=overrides||{};var id=overrides.id||Ext.id();var cfg=Ext.applyIf(overrides,this.initialConfig);cfg.id=id;return new this.constructor(cfg)},getXType:function(){return this.constructor.xtype},isXType:function(xtype,shallow){if(Ext.isFunction(xtype)){xtype=xtype.xtype}else{if(Ext.isObject(xtype)){xtype=xtype.constructor.xtype}}return !shallow?("/"+this.getXTypes()+"/").indexOf("/"+xtype+"/")!=-1:this.constructor.xtype==xtype},getXTypes:function(){var tc=this.constructor;if(!tc.xtypes){var c=[],sc=this;while(sc&&sc.constructor.xtype){c.unshift(sc.constructor.xtype);sc=sc.constructor.superclass}tc.xtypeChain=c;tc.xtypes=c.join("/")}return tc.xtypes},findParentBy:function(fn){for(var p=this.ownerCt;(p!=null)&&!fn(p,this);p=p.ownerCt){}return p||null},findParentByType:function(xtype){return Ext.isFunction(xtype)?this.findParentBy(function(p){return p.constructor===xtype}):this.findParentBy(function(p){return p.constructor.xtype===xtype})},getDomPositionEl:function(){return this.getPositionEl?this.getPositionEl():this.getEl()},purgeListeners:function(){Ext.Component.superclass.purgeListeners.call(this);if(this.mons){this.on("beforedestroy",this.clearMons,this,{single:true})}},clearMons:function(){Ext.each(this.mons,function(m){m.item.un(m.ename,m.fn,m.scope)},this);this.mons=[]},createMons:function(){if(!this.mons){this.mons=[];this.on("beforedestroy",this.clearMons,this,{single:true})}},mon:function(item,ename,fn,scope,opt){this.createMons();if(Ext.isObject(ename)){var propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;var o=ename;for(var e in o){if(propRe.test(e)){continue}if(Ext.isFunction(o[e])){this.mons.push({item:item,ename:e,fn:o[e],scope:o.scope});item.on(e,o[e],o.scope,o)}else{this.mons.push({item:item,ename:e,fn:o[e],scope:o.scope});item.on(e,o[e])}}return}this.mons.push({item:item,ename:ename,fn:fn,scope:scope});item.on(ename,fn,scope,opt)},mun:function(item,ename,fn,scope){var found,mon;this.createMons();for(var i=0,len=this.mons.length;i<len;++i){mon=this.mons[i];if(item===mon.item&&ename==mon.ename&&fn===mon.fn&&scope===mon.scope){this.mons.splice(i,1);item.un(ename,fn,scope);found=true;break}}return found},nextSibling:function(){if(this.ownerCt){var index=this.ownerCt.items.indexOf(this);if(index!=-1&&index+1<this.ownerCt.items.getCount()){return this.ownerCt.items.itemAt(index+1)}}return null},previousSibling:function(){if(this.ownerCt){var index=this.ownerCt.items.indexOf(this);if(index>0){return this.ownerCt.items.itemAt(index-1)}}return null},getBubbleTarget:function(){return this.ownerCt}});Ext.reg("component",Ext.Component);Ext.Action=function(config){this.initialConfig=config;this.itemId=config.itemId=(config.itemId||config.id||Ext.id());this.items=[]};Ext.Action.prototype={isAction:true,setText:function(text){this.initialConfig.text=text;this.callEach("setText",[text])},getText:function(){return this.initialConfig.text},setIconClass:function(cls){this.initialConfig.iconCls=cls;this.callEach("setIconClass",[cls])},getIconClass:function(){return this.initialConfig.iconCls},setDisabled:function(v){this.initialConfig.disabled=v;this.callEach("setDisabled",[v])},enable:function(){this.setDisabled(false)},disable:function(){this.setDisabled(true)},isDisabled:function(){return this.initialConfig.disabled},setHidden:function(v){this.initialConfig.hidden=v;this.callEach("setVisible",[!v])},show:function(){this.setHidden(false)},hide:function(){this.setHidden(true)},isHidden:function(){return this.initialConfig.hidden},setHandler:function(fn,scope){this.initialConfig.handler=fn;this.initialConfig.scope=scope;this.callEach("setHandler",[fn,scope])},each:function(fn,scope){Ext.each(this.items,fn,scope)},callEach:function(fnName,args){var cs=this.items;for(var i=0,len=cs.length;i<len;i++){cs[i][fnName].apply(cs[i],args)}},addComponent:function(comp){this.items.push(comp);comp.on("destroy",this.removeComponent,this)},removeComponent:function(comp){this.items.remove(comp)},execute:function(){this.initialConfig.handler.apply(this.initialConfig.scope||window,arguments)}};(function(){Ext.Layer=function(config,existingEl){config=config||{};var dh=Ext.DomHelper;var cp=config.parentEl,pel=cp?Ext.getDom(cp):document.body;if(existingEl){this.dom=Ext.getDom(existingEl)}if(!this.dom){var o=config.dh||{tag:"div",cls:"x-layer"};this.dom=dh.append(pel,o)}if(config.cls){this.addClass(config.cls)}this.constrain=config.constrain!==false;this.setVisibilityMode(Ext.Element.VISIBILITY);if(config.id){this.id=this.dom.id=config.id}else{this.id=Ext.id(this.dom)}this.zindex=config.zindex||this.getZIndex();this.position("absolute",this.zindex);if(config.shadow){this.shadowOffset=config.shadowOffset||4;this.shadow=new Ext.Shadow({offset:this.shadowOffset,mode:config.shadow})}else{this.shadowOffset=0}this.useShim=config.shim!==false&&Ext.useShims;this.useDisplay=config.useDisplay;this.hide()};var supr=Ext.Element.prototype;var shims=[];Ext.extend(Ext.Layer,Ext.Element,{getZIndex:function(){return this.zindex||parseInt((this.getShim()||this).getStyle("z-index"),10)||11000},getShim:function(){if(!this.useShim){return null}if(this.shim){return this.shim}var shim=shims.shift();if(!shim){shim=this.createShim();shim.enableDisplayMode("block");shim.dom.style.display="none";shim.dom.style.visibility="visible"}var pn=this.dom.parentNode;if(shim.dom.parentNode!=pn){pn.insertBefore(shim.dom,this.dom)}shim.setStyle("z-index",this.getZIndex()-2);this.shim=shim;return shim},hideShim:function(){if(this.shim){this.shim.setDisplayed(false);shims.push(this.shim);delete this.shim}},disableShadow:function(){if(this.shadow){this.shadowDisabled=true;this.shadow.hide();this.lastShadowOffset=this.shadowOffset;this.shadowOffset=0}},enableShadow:function(show){if(this.shadow){this.shadowDisabled=false;this.shadowOffset=this.lastShadowOffset;delete this.lastShadowOffset;if(show){this.sync(true)}}},sync:function(doShow){var sw=this.shadow;if(!this.updating&&this.isVisible()&&(sw||this.useShim)){var sh=this.getShim();var w=this.getWidth(),h=this.getHeight();var l=this.getLeft(true),t=this.getTop(true);if(sw&&!this.shadowDisabled){if(doShow&&!sw.isVisible()){sw.show(this)}else{sw.realign(l,t,w,h)}if(sh){if(doShow){sh.show()}var a=sw.adjusts,s=sh.dom.style;s.left=(Math.min(l,l+a.l))+"px";s.top=(Math.min(t,t+a.t))+"px";s.width=(w+a.w)+"px";s.height=(h+a.h)+"px"}}else{if(sh){if(doShow){sh.show()}sh.setSize(w,h);sh.setLeftTop(l,t)}}}},destroy:function(){this.hideShim();if(this.shadow){this.shadow.hide()}this.removeAllListeners();Ext.removeNode(this.dom);Ext.Element.uncache(this.id)},remove:function(){this.destroy()},beginUpdate:function(){this.updating=true},endUpdate:function(){this.updating=false;this.sync(true)},hideUnders:function(negOffset){if(this.shadow){this.shadow.hide()}this.hideShim()},constrainXY:function(){if(this.constrain){var vw=Ext.lib.Dom.getViewWidth(),vh=Ext.lib.Dom.getViewHeight();var s=Ext.getDoc().getScroll();var xy=this.getXY();var x=xy[0],y=xy[1];var so=this.shadowOffset;var w=this.dom.offsetWidth+so,h=this.dom.offsetHeight+so;var moved=false;if((x+w)>vw+s.left){x=vw-w-so;moved=true}if((y+h)>vh+s.top){y=vh-h-so;moved=true}if(x<s.left){x=s.left;moved=true}if(y<s.top){y=s.top;moved=true}if(moved){if(this.avoidY){var ay=this.avoidY;if(y<=ay&&(y+h)>=ay){y=ay-h-5}}xy=[x,y];this.storeXY(xy);supr.setXY.call(this,xy);this.sync()}}return this},isVisible:function(){return this.visible},showAction:function(){this.visible=true;if(this.useDisplay===true){this.setDisplayed("")}else{if(this.lastXY){supr.setXY.call(this,this.lastXY)}else{if(this.lastLT){supr.setLeftTop.call(this,this.lastLT[0],this.lastLT[1])}}}},hideAction:function(){this.visible=false;if(this.useDisplay===true){this.setDisplayed(false)}else{this.setLeftTop(-10000,-10000)}},setVisible:function(v,a,d,c,e){if(v){this.showAction()}if(a&&v){var cb=function(){this.sync(true);if(c){c()}}.createDelegate(this);supr.setVisible.call(this,true,true,d,cb,e)}else{if(!v){this.hideUnders(true)}var cb=c;if(a){cb=function(){this.hideAction();if(c){c()}}.createDelegate(this)}supr.setVisible.call(this,v,a,d,cb,e);if(v){this.sync(true)}else{if(!a){this.hideAction()}}}return this},storeXY:function(xy){delete this.lastLT;this.lastXY=xy},storeLeftTop:function(left,top){delete this.lastXY;this.lastLT=[left,top]},beforeFx:function(){this.beforeAction();return Ext.Layer.superclass.beforeFx.apply(this,arguments)},afterFx:function(){Ext.Layer.superclass.afterFx.apply(this,arguments);this.sync(this.isVisible())},beforeAction:function(){if(!this.updating&&this.shadow){this.shadow.hide()}},setLeft:function(left){this.storeLeftTop(left,this.getTop(true));supr.setLeft.apply(this,arguments);this.sync();return this},setTop:function(top){this.storeLeftTop(this.getLeft(true),top);supr.setTop.apply(this,arguments);this.sync();return this},setLeftTop:function(left,top){this.storeLeftTop(left,top);supr.setLeftTop.apply(this,arguments);this.sync();return this},setXY:function(xy,a,d,c,e){this.fixDisplay();this.beforeAction();this.storeXY(xy);var cb=this.createCB(c);supr.setXY.call(this,xy,a,d,cb,e);if(!a){cb()}return this},createCB:function(c){var el=this;return function(){el.constrainXY();el.sync(true);if(c){c()}}},setX:function(x,a,d,c,e){this.setXY([x,this.getY()],a,d,c,e);return this},setY:function(y,a,d,c,e){this.setXY([this.getX(),y],a,d,c,e);return this},setSize:function(w,h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setSize.call(this,w,h,a,d,cb,e);if(!a){cb()}return this},setWidth:function(w,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setWidth.call(this,w,a,d,cb,e);if(!a){cb()}return this},setHeight:function(h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);supr.setHeight.call(this,h,a,d,cb,e);if(!a){cb()}return this},setBounds:function(x,y,w,h,a,d,c,e){this.beforeAction();var cb=this.createCB(c);if(!a){this.storeXY([x,y]);supr.setXY.call(this,[x,y]);supr.setSize.call(this,w,h,a,d,cb,e);cb()}else{supr.setBounds.call(this,x,y,w,h,a,d,cb,e)}return this},setZIndex:function(zindex){this.zindex=zindex;this.setStyle("z-index",zindex+2);if(this.shadow){this.shadow.setZIndex(zindex+1)}if(this.shim){this.shim.setStyle("z-index",zindex)}return this}})})();Ext.Shadow=function(config){Ext.apply(this,config);if(typeof this.mode!="string"){this.mode=this.defaultMode}var o=this.offset,a={h:0};var rad=Math.floor(this.offset/2);switch(this.mode.toLowerCase()){case"drop":a.w=0;a.l=a.t=o;a.t-=1;if(Ext.isIE){a.l-=this.offset+rad;a.t-=this.offset+rad;a.w-=rad;a.h-=rad;a.t+=1}break;case"sides":a.w=(o*2);a.l=-o;a.t=o-1;if(Ext.isIE){a.l-=(this.offset-rad);a.t-=this.offset+rad;a.l+=1;a.w-=(this.offset-rad)*2;a.w-=rad+1;a.h-=1}break;case"frame":a.w=a.h=(o*2);a.l=a.t=-o;a.t+=1;a.h-=2;if(Ext.isIE){a.l-=(this.offset-rad);a.t-=(this.offset-rad);a.l+=1;a.w-=(this.offset+rad+1);a.h-=(this.offset+rad);a.h+=1}break}this.adjusts=a};Ext.Shadow.prototype={offset:4,defaultMode:"drop",show:function(target){target=Ext.get(target);if(!this.el){this.el=Ext.Shadow.Pool.pull();if(this.el.dom.nextSibling!=target.dom){this.el.insertBefore(target)}}this.el.setStyle("z-index",this.zIndex||parseInt(target.getStyle("z-index"),10)-1);if(Ext.isIE){this.el.dom.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius="+(this.offset)+")"}this.realign(target.getLeft(true),target.getTop(true),target.getWidth(),target.getHeight());this.el.dom.style.display="block"},isVisible:function(){return this.el?true:false},realign:function(l,t,w,h){if(!this.el){return}var a=this.adjusts,d=this.el.dom,s=d.style;var iea=0;s.left=(l+a.l)+"px";s.top=(t+a.t)+"px";var sw=(w+a.w),sh=(h+a.h),sws=sw+"px",shs=sh+"px";if(s.width!=sws||s.height!=shs){s.width=sws;s.height=shs;if(!Ext.isIE){var cn=d.childNodes;var sww=Math.max(0,(sw-12))+"px";cn[0].childNodes[1].style.width=sww;cn[1].childNodes[1].style.width=sww;cn[2].childNodes[1].style.width=sww;cn[1].style.height=Math.max(0,(sh-12))+"px"}}},hide:function(){if(this.el){this.el.dom.style.display="none";Ext.Shadow.Pool.push(this.el);delete this.el}},setZIndex:function(z){this.zIndex=z;if(this.el){this.el.setStyle("z-index",z)}}};Ext.Shadow.Pool=function(){var p=[];var markup=Ext.isIE?'<div class="x-ie-shadow"></div>':'<div class="x-shadow"><div class="xst"><div class="xstl"></div><div class="xstc"></div><div class="xstr"></div></div><div class="xsc"><div class="xsml"></div><div class="xsmc"></div><div class="xsmr"></div></div><div class="xsb"><div class="xsbl"></div><div class="xsbc"></div><div class="xsbr"></div></div></div>';return{pull:function(){var sh=p.shift();if(!sh){sh=Ext.get(Ext.DomHelper.insertHtml("beforeBegin",document.body.firstChild,markup));sh.autoBoxAdjust=false}return sh},push:function(sh){p.push(sh)}}}();Ext.BoxComponent=Ext.extend(Ext.Component,{initComponent:function(){Ext.BoxComponent.superclass.initComponent.call(this);this.addEvents("resize","move")},boxReady:false,deferHeight:false,setSize:function(w,h){if(typeof w=="object"){h=w.height;w=w.width}if(!this.boxReady){this.width=w;this.height=h;return this}if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==w&&this.lastSize.height==h){return this}this.lastSize={width:w,height:h};var adj=this.adjustSize(w,h);var aw=adj.width,ah=adj.height;if(aw!==undefined||ah!==undefined){var rz=this.getResizeEl();if(!this.deferHeight&&aw!==undefined&&ah!==undefined){rz.setSize(aw,ah)}else{if(!this.deferHeight&&ah!==undefined){rz.setHeight(ah)}else{if(aw!==undefined){rz.setWidth(aw)}}}this.onResize(aw,ah,w,h);this.fireEvent("resize",this,aw,ah,w,h)}return this},setWidth:function(width){return this.setSize(width)},setHeight:function(height){return this.setSize(undefined,height)},getSize:function(){return this.getResizeEl().getSize()},getWidth:function(){return this.getResizeEl().getWidth()},getHeight:function(){return this.getResizeEl().getHeight()},getOuterSize:function(){var el=this.getResizeEl();return{width:el.getWidth()+el.getMargins("lr"),height:el.getHeight()+el.getMargins("tb")}},getPosition:function(local){var el=this.getPositionEl();if(local===true){return[el.getLeft(true),el.getTop(true)]}return this.xy||el.getXY()},getBox:function(local){var pos=this.getPosition(local);var s=this.getSize();s.x=pos[0];s.y=pos[1];return s},updateBox:function(box){this.setSize(box.width,box.height);this.setPagePosition(box.x,box.y);return this},getResizeEl:function(){return this.resizeEl||this.el},getPositionEl:function(){return this.positionEl||this.el},setPosition:function(x,y){if(x&&typeof x[1]=="number"){y=x[1];x=x[0]}this.x=x;this.y=y;if(!this.boxReady){return this}var adj=this.adjustPosition(x,y);var ax=adj.x,ay=adj.y;var el=this.getPositionEl();if(ax!==undefined||ay!==undefined){if(ax!==undefined&&ay!==undefined){el.setLeftTop(ax,ay)}else{if(ax!==undefined){el.setLeft(ax)}else{if(ay!==undefined){el.setTop(ay)}}}this.onPosition(ax,ay);this.fireEvent("move",this,ax,ay)}return this},setPagePosition:function(x,y){if(x&&typeof x[1]=="number"){y=x[1];x=x[0]}this.pageX=x;this.pageY=y;if(!this.boxReady){return}if(x===undefined||y===undefined){return}var p=this.getPositionEl().translatePoints(x,y);this.setPosition(p.left,p.top);return this},afterRender:function(){Ext.BoxComponent.superclass.afterRender.call(this);if(this.resizeEl){this.resizeEl=Ext.get(this.resizeEl)}if(this.positionEl){this.positionEl=Ext.get(this.positionEl)}this.boxReady=true;this.setSize(this.width,this.height);if(this.x||this.y){this.setPosition(this.x,this.y)}else{if(this.pageX||this.pageY){this.setPagePosition(this.pageX,this.pageY)}}},syncSize:function(){delete this.lastSize;this.setSize(this.autoWidth?undefined:this.getResizeEl().getWidth(),this.autoHeight?undefined:this.getResizeEl().getHeight());return this},onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){},onPosition:function(x,y){},adjustSize:function(w,h){if(this.autoWidth){w="auto"}if(this.autoHeight){h="auto"}return{width:w,height:h}},adjustPosition:function(x,y){return{x:x,y:y}}});Ext.reg("box",Ext.BoxComponent);Ext.Spacer=Ext.extend(Ext.BoxComponent,{autoEl:"div"});Ext.reg("spacer",Ext.Spacer);Ext.SplitBar=function(dragElement,resizingElement,orientation,placement,existingProxy){this.el=Ext.get(dragElement,true);this.el.dom.unselectable="on";this.resizingEl=Ext.get(resizingElement,true);this.orientation=orientation||Ext.SplitBar.HORIZONTAL;this.minSize=0;this.maxSize=2000;this.animate=false;this.useShim=false;this.shim=null;if(!existingProxy){this.proxy=Ext.SplitBar.createProxy(this.orientation)}else{this.proxy=Ext.get(existingProxy).dom}this.dd=new Ext.dd.DDProxy(this.el.dom.id,"XSplitBars",{dragElId:this.proxy.id});this.dd.b4StartDrag=this.onStartProxyDrag.createDelegate(this);this.dd.endDrag=this.onEndProxyDrag.createDelegate(this);this.dragSpecs={};this.adapter=new Ext.SplitBar.BasicLayoutAdapter();this.adapter.init(this);if(this.orientation==Ext.SplitBar.HORIZONTAL){this.placement=placement||(this.el.getX()>this.resizingEl.getX()?Ext.SplitBar.LEFT:Ext.SplitBar.RIGHT);this.el.addClass("x-splitbar-h")}else{this.placement=placement||(this.el.getY()>this.resizingEl.getY()?Ext.SplitBar.TOP:Ext.SplitBar.BOTTOM);this.el.addClass("x-splitbar-v")}this.addEvents("resize","moved","beforeresize","beforeapply");Ext.SplitBar.superclass.constructor.call(this)};Ext.extend(Ext.SplitBar,Ext.util.Observable,{onStartProxyDrag:function(x,y){this.fireEvent("beforeresize",this);this.overlay=Ext.DomHelper.append(document.body,{cls:"x-drag-overlay",html:"&#160;"},true);this.overlay.unselectable();this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.overlay.show();Ext.get(this.proxy).setDisplayed("block");var size=this.adapter.getElementSize(this);this.activeMinSize=this.getMinimumSize();this.activeMaxSize=this.getMaximumSize();var c1=size-this.activeMinSize;var c2=Math.max(this.activeMaxSize-size,0);if(this.orientation==Ext.SplitBar.HORIZONTAL){this.dd.resetConstraints();this.dd.setXConstraint(this.placement==Ext.SplitBar.LEFT?c1:c2,this.placement==Ext.SplitBar.LEFT?c2:c1,this.tickSize);this.dd.setYConstraint(0,0)}else{this.dd.resetConstraints();this.dd.setXConstraint(0,0);this.dd.setYConstraint(this.placement==Ext.SplitBar.TOP?c1:c2,this.placement==Ext.SplitBar.TOP?c2:c1,this.tickSize)}this.dragSpecs.startSize=size;this.dragSpecs.startPoint=[x,y];Ext.dd.DDProxy.prototype.b4StartDrag.call(this.dd,x,y)},onEndProxyDrag:function(e){Ext.get(this.proxy).setDisplayed(false);var endPoint=Ext.lib.Event.getXY(e);if(this.overlay){Ext.destroy(this.overlay);delete this.overlay}var newSize;if(this.orientation==Ext.SplitBar.HORIZONTAL){newSize=this.dragSpecs.startSize+(this.placement==Ext.SplitBar.LEFT?endPoint[0]-this.dragSpecs.startPoint[0]:this.dragSpecs.startPoint[0]-endPoint[0])}else{newSize=this.dragSpecs.startSize+(this.placement==Ext.SplitBar.TOP?endPoint[1]-this.dragSpecs.startPoint[1]:this.dragSpecs.startPoint[1]-endPoint[1])}newSize=Math.min(Math.max(newSize,this.activeMinSize),this.activeMaxSize);if(newSize!=this.dragSpecs.startSize){if(this.fireEvent("beforeapply",this,newSize)!==false){this.adapter.setElementSize(this,newSize);this.fireEvent("moved",this,newSize);this.fireEvent("resize",this,newSize)}}},getAdapter:function(){return this.adapter},setAdapter:function(adapter){this.adapter=adapter;this.adapter.init(this)},getMinimumSize:function(){return this.minSize},setMinimumSize:function(minSize){this.minSize=minSize},getMaximumSize:function(){return this.maxSize},setMaximumSize:function(maxSize){this.maxSize=maxSize},setCurrentSize:function(size){var oldAnimate=this.animate;this.animate=false;this.adapter.setElementSize(this,size);this.animate=oldAnimate},destroy:function(removeEl){Ext.destroy(this.shim,Ext.get(this.proxy));this.dd.unreg();if(removeEl){this.el.remove()}this.purgeListeners()}});Ext.SplitBar.createProxy=function(dir){var proxy=new Ext.Element(document.createElement("div"));proxy.unselectable();var cls="x-splitbar-proxy";proxy.addClass(cls+" "+(dir==Ext.SplitBar.HORIZONTAL?cls+"-h":cls+"-v"));document.body.appendChild(proxy.dom);return proxy.dom};Ext.SplitBar.BasicLayoutAdapter=function(){};Ext.SplitBar.BasicLayoutAdapter.prototype={init:function(s){},getElementSize:function(s){if(s.orientation==Ext.SplitBar.HORIZONTAL){return s.resizingEl.getWidth()}else{return s.resizingEl.getHeight()}},setElementSize:function(s,newSize,onComplete){if(s.orientation==Ext.SplitBar.HORIZONTAL){if(!s.animate){s.resizingEl.setWidth(newSize);if(onComplete){onComplete(s,newSize)}}else{s.resizingEl.setWidth(newSize,true,0.1,onComplete,"easeOut")}}else{if(!s.animate){s.resizingEl.setHeight(newSize);if(onComplete){onComplete(s,newSize)}}else{s.resizingEl.setHeight(newSize,true,0.1,onComplete,"easeOut")}}}};Ext.SplitBar.AbsoluteLayoutAdapter=function(container){this.basic=new Ext.SplitBar.BasicLayoutAdapter();this.container=Ext.get(container)};Ext.SplitBar.AbsoluteLayoutAdapter.prototype={init:function(s){this.basic.init(s)},getElementSize:function(s){return this.basic.getElementSize(s)},setElementSize:function(s,newSize,onComplete){this.basic.setElementSize(s,newSize,this.moveSplitter.createDelegate(this,[s]))},moveSplitter:function(s){var yes=Ext.SplitBar;switch(s.placement){case yes.LEFT:s.el.setX(s.resizingEl.getRight());break;case yes.RIGHT:s.el.setStyle("right",(this.container.getWidth()-s.resizingEl.getLeft())+"px");break;case yes.TOP:s.el.setY(s.resizingEl.getBottom());break;case yes.BOTTOM:s.el.setY(s.resizingEl.getTop()-s.el.getHeight());break}}};Ext.SplitBar.VERTICAL=1;Ext.SplitBar.HORIZONTAL=2;Ext.SplitBar.LEFT=1;Ext.SplitBar.RIGHT=2;Ext.SplitBar.TOP=3;Ext.SplitBar.BOTTOM=4;Ext.Container=Ext.extend(Ext.BoxComponent,{bufferResize:50,autoDestroy:true,forceLayout:false,defaultType:"panel",resizeEvent:"resize",bubbleEvents:["add","remove"],initComponent:function(){Ext.Container.superclass.initComponent.call(this);this.addEvents("afterlayout","beforeadd","beforeremove","add","remove");this.enableBubble(this.bubbleEvents);var items=this.items;if(items){delete this.items;this.add(items)}},initItems:function(){if(!this.items){this.items=new Ext.util.MixedCollection(false,this.getComponentId);this.getLayout()}},setLayout:function(layout){if(this.layout&&this.layout!=layout){this.layout.setContainer(null)}this.initItems();this.layout=layout;layout.setContainer(this)},afterRender:function(){Ext.Container.superclass.afterRender.call(this);if(!this.layout){this.layout="auto"}if(Ext.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;this.layout=this.layoutConfig.type}if(Ext.isString(this.layout)){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)}this.setLayout(this.layout);if(this.activeItem!==undefined){var item=this.activeItem;delete this.activeItem;this.layout.setActiveItem(item)}if(!this.ownerCt){this.doLayout(false,true)}if(this.monitorResize===true){Ext.EventManager.onWindowResize(this.doLayout,this,[false])}},getLayoutTarget:function(){return this.el},getComponentId:function(comp){return comp.getItemId()},add:function(comp){this.initItems();var args=arguments.length>1;if(args||Ext.isArray(comp)){Ext.each(args?arguments:comp,function(c){this.add(c)},this);return}var c=this.lookupComponent(this.applyDefaults(comp));var pos=this.items.length;if(this.fireEvent("beforeadd",this,c,pos)!==false&&this.onBeforeAdd(c)!==false){this.items.add(c);c.ownerCt=this;this.onAdd(c);this.fireEvent("add",this,c,pos)}return c},onAdd:function(c){},insert:function(index,comp){this.initItems();var a=arguments,len=a.length;if(len>2){for(var i=len-1;i>=1;--i){this.insert(index,a[i])}return}var c=this.lookupComponent(this.applyDefaults(comp));index=Math.min(index,this.items.length);if(this.fireEvent("beforeadd",this,c,index)!==false&&this.onBeforeAdd(c)!==false){if(c.ownerCt==this){this.items.remove(c)}this.items.insert(index,c);c.ownerCt=this;this.onAdd(c);this.fireEvent("add",this,c,index)}return c},applyDefaults:function(c){if(this.defaults){if(Ext.isString(c)){c=Ext.ComponentMgr.get(c);Ext.apply(c,this.defaults)}else{if(!c.events){Ext.applyIf(c,this.defaults)}else{Ext.apply(c,this.defaults)}}}return c},onBeforeAdd:function(item){if(item.ownerCt){item.ownerCt.remove(item,false)}if(this.hideBorders===true){item.border=(item.border===true)}},remove:function(comp,autoDestroy){this.initItems();var c=this.getComponent(comp);if(c&&this.fireEvent("beforeremove",this,c)!==false){delete c.ownerCt;if(this.layout&&this.rendered){this.layout.onRemove(c)}this.onRemove(c);this.items.remove(c);if(autoDestroy===true||(autoDestroy!==false&&this.autoDestroy)){c.destroy()}this.fireEvent("remove",this,c)}return c},onRemove:function(c){},removeAll:function(autoDestroy){this.initItems();var item,rem=[],items=[];this.items.each(function(i){rem.push(i)});for(var i=0,len=rem.length;i<len;++i){item=rem[i];this.remove(item,autoDestroy);if(item.ownerCt!==this){items.push(item)}}return items},getComponent:function(comp){if(Ext.isObject(comp)){comp=comp.getItemId()}return this.items.get(comp)},lookupComponent:function(comp){if(Ext.isString(comp)){return Ext.ComponentMgr.get(comp)}else{if(!comp.events){return this.createComponent(comp)}}return comp},createComponent:function(config){return Ext.create(config,this.defaultType)},canLayout:function(){var el=this.getVisibilityEl();return el&&!el.isStyle("display","none")},doLayout:function(shallow,force){var rendered=this.rendered;forceLayout=force||this.forceLayout;if(!this.canLayout()||this.collapsed){this.deferLayout=this.deferLayout||!shallow;if(!forceLayout){return}shallow=shallow&&!this.deferLayout}else{delete this.deferLayout}if(rendered&&this.layout){this.layout.layout()}if(shallow!==true&&this.items){var cs=this.items.items;for(var i=0,len=cs.length;i<len;i++){var c=cs[i];if(c.doLayout){c.doLayout(false,forceLayout)}}}if(rendered){this.onLayout(shallow,forceLayout)}this.hasLayout=true;delete this.forceLayout},onLayout:Ext.emptyFn,shouldBufferLayout:function(){var hl=this.hasLayout;if(this.ownerCt){return hl?!this.hasLayoutPending():false}return hl},hasLayoutPending:function(){var pending=false;this.ownerCt.bubble(function(c){if(c.layoutPending){pending=true;return false}});return pending},onShow:function(){Ext.Container.superclass.onShow.call(this);if(this.deferLayout!==undefined){this.doLayout(true)}},getLayout:function(){if(!this.layout){var layout=new Ext.layout.ContainerLayout(this.layoutConfig);this.setLayout(layout)}return this.layout},beforeDestroy:function(){if(this.items){Ext.destroy.apply(Ext,this.items.items)}if(this.monitorResize){Ext.EventManager.removeResizeListener(this.doLayout,this)}Ext.destroy(this.layout);Ext.Container.superclass.beforeDestroy.call(this)},bubble:function(fn,scope,args){var p=this;while(p){if(fn.apply(scope||p,args||[p])===false){break}p=p.ownerCt}return this},cascade:function(fn,scope,args){if(fn.apply(scope||this,args||[this])!==false){if(this.items){var cs=this.items.items;for(var i=0,len=cs.length;i<len;i++){if(cs[i].cascade){cs[i].cascade(fn,scope,args)}else{fn.apply(scope||cs[i],args||[cs[i]])}}}}return this},findById:function(id){var m,ct=this;this.cascade(function(c){if(ct!=c&&c.id===id){m=c;return false}});return m||null},findByType:function(xtype,shallow){return this.findBy(function(c){return c.isXType(xtype,shallow)})},find:function(prop,value){return this.findBy(function(c){return c[prop]===value})},findBy:function(fn,scope){var m=[],ct=this;this.cascade(function(c){if(ct!=c&&fn.call(scope||c,c,ct)===true){m.push(c)}});return m},get:function(key){return this.items.get(key)}});Ext.Container.LAYOUTS={};Ext.reg("container",Ext.Container);Ext.layout.ContainerLayout=function(config){Ext.apply(this,config)};Ext.layout.ContainerLayout.prototype={monitorResize:false,activeItem:null,layout:function(){var target=this.container.getLayoutTarget();this.onLayout(this.container,target);this.container.fireEvent("afterlayout",this.container,this)},onLayout:function(ct,target){this.renderAll(ct,target)},isValidParent:function(c,target){return target&&c.getDomPositionEl().dom.parentNode==(target.dom||target)},renderAll:function(ct,target){var items=ct.items.items;for(var i=0,len=items.length;i<len;i++){var c=items[i];if(c&&(!c.rendered||!this.isValidParent(c,target))){this.renderItem(c,i,target)}}},renderItem:function(c,position,target){if(c&&!c.rendered){c.render(target,position);this.configureItem(c,position)}else{if(c&&!this.isValidParent(c,target)){if(Ext.isNumber(position)){position=target.dom.childNodes[position]}target.dom.insertBefore(c.getDomPositionEl().dom,position||null);c.container=target;this.configureItem(c,position)}}},configureItem:function(c,position){if(this.extraCls){var t=c.getPositionEl?c.getPositionEl():c;t.addClass(this.extraCls)}if(this.renderHidden&&c!=this.activeItem){c.hide()}if(c.doLayout&&this.forceLayout){c.doLayout(false,true)}},onRemove:function(c){if(this.activeItem==c){delete this.activeItem}if(c.rendered&&this.extraCls){var t=c.getPositionEl?c.getPositionEl():c;t.removeClass(this.extraCls)}},onResize:function(){var ct=this.container,b;if(ct.collapsed){return}if(b=ct.bufferResize){if(ct.shouldBufferLayout()){if(!this.resizeTask){this.resizeTask=new Ext.util.DelayedTask(this.runLayout,this);this.resizeBuffer=Ext.isNumber(b)?b:50}ct.layoutPending=true;this.resizeTask.delay(this.resizeBuffer)}}else{ct.doLayout()}},runLayout:function(){var ct=this.container;ct.doLayout();delete ct.layoutPending},setContainer:function(ct){if(this.monitorResize&&ct!=this.container){var old=this.container;if(old){old.un(old.resizeEvent,this.onResize,this)}if(ct){ct.on(ct.resizeEvent,this.onResize,this)}}this.container=ct},parseMargins:function(v){if(Ext.isNumber(v)){v=v.toString()}var ms=v.split(" ");var len=ms.length;if(len==1){ms[1]=ms[0];ms[2]=ms[0];ms[3]=ms[0]}if(len==2){ms[2]=ms[0];ms[3]=ms[1]}if(len==3){ms[3]=ms[1]}return{top:parseInt(ms[0],10)||0,right:parseInt(ms[1],10)||0,bottom:parseInt(ms[2],10)||0,left:parseInt(ms[3],10)||0}},fieldTpl:(function(){var t=new Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>',"</div>");t.disableFormats=true;return t.compile()})(),destroy:Ext.emptyFn};Ext.Container.LAYOUTS.auto=Ext.layout.ContainerLayout;Ext.layout.FitLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,onLayout:function(ct,target){Ext.layout.FitLayout.superclass.onLayout.call(this,ct,target);if(!this.container.collapsed){var sz=(Ext.isIE6&&Ext.isStrict&&target.dom==document.body)?target.getViewSize():target.getStyleSize();this.setItemSize(this.activeItem||ct.items.itemAt(0),sz)}},setItemSize:function(item,size){if(item&&size.height>0){item.setSize(size)}}});Ext.Container.LAYOUTS.fit=Ext.layout.FitLayout;Ext.layout.CardLayout=Ext.extend(Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,constructor:function(config){Ext.layout.CardLayout.superclass.constructor.call(this,config);this.forceLayout=(this.deferredRender===false)},setActiveItem:function(item){item=this.container.getComponent(item);if(this.activeItem!=item){if(this.activeItem){this.activeItem.hide()}var layout=item.doLayout&&(this.layoutOnCardChange||!item.rendered);this.activeItem=item;item.show();this.layout();if(layout){item.doLayout()}}},renderAll:function(ct,target){if(this.deferredRender){this.renderItem(this.activeItem,undefined,target)}else{Ext.layout.CardLayout.superclass.renderAll.call(this,ct,target)}}});Ext.Container.LAYOUTS.card=Ext.layout.CardLayout;Ext.layout.AnchorLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,getAnchorViewSize:function(ct,target){return target.dom==document.body?target.getViewSize():target.getStyleSize()},onLayout:function(ct,target){Ext.layout.AnchorLayout.superclass.onLayout.call(this,ct,target);var size=this.getAnchorViewSize(ct,target);var w=size.width,h=size.height;if(w<20&&h<20){return}var aw,ah;if(ct.anchorSize){if(typeof ct.anchorSize=="number"){aw=ct.anchorSize}else{aw=ct.anchorSize.width;ah=ct.anchorSize.height}}else{aw=ct.initialConfig.width;ah=ct.initialConfig.height}var cs=ct.items.items,len=cs.length,i,c,a,cw,ch;for(i=0;i<len;i++){c=cs[i];if(c.anchor){a=c.anchorSpec;if(!a){var vs=c.anchor.split(" ");c.anchorSpec=a={right:this.parseAnchor(vs[0],c.initialConfig.width,aw),bottom:this.parseAnchor(vs[1],c.initialConfig.height,ah)}}cw=a.right?this.adjustWidthAnchor(a.right(w),c):undefined;ch=a.bottom?this.adjustHeightAnchor(a.bottom(h),c):undefined;if(cw||ch){c.setSize(cw||undefined,ch||undefined)}}}},parseAnchor:function(a,start,cstart){if(a&&a!="none"){var last;if(/^(r|right|b|bottom)$/i.test(a)){var diff=cstart-start;return function(v){if(v!==last){last=v;return v-diff}}}else{if(a.indexOf("%")!=-1){var ratio=parseFloat(a.replace("%",""))*0.01;return function(v){if(v!==last){last=v;return Math.floor(v*ratio)}}}else{a=parseInt(a,10);if(!isNaN(a)){return function(v){if(v!==last){last=v;return v+a}}}}}}return false},adjustWidthAnchor:function(value,comp){return value},adjustHeightAnchor:function(value,comp){return value}});Ext.Container.LAYOUTS.anchor=Ext.layout.AnchorLayout;Ext.layout.ColumnLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,extraCls:"x-column",scrollOffset:0,isValidParent:function(c,target){return(c.getPositionEl?c.getPositionEl():c.getEl()).dom.parentNode==this.innerCt.dom},onLayout:function(ct,target){var cs=ct.items.items,len=cs.length,c,i;if(!this.innerCt){target.addClass("x-column-layout-ct");this.innerCt=target.createChild({cls:"x-column-inner"});this.innerCt.createChild({cls:"x-clear"})}this.renderAll(ct,this.innerCt);var size=Ext.isIE&&target.dom!=Ext.getBody().dom?target.getStyleSize():target.getViewSize();if(size.width<1&&size.height<1){return}var w=size.width-target.getPadding("lr")-this.scrollOffset,h=size.height-target.getPadding("tb"),pw=w;this.innerCt.setWidth(w);for(i=0;i<len;i++){c=cs[i];if(!c.columnWidth){pw-=(c.getSize().width+c.getEl().getMargins("lr"))}}pw=pw<0?0:pw;for(i=0;i<len;i++){c=cs[i];if(c.columnWidth){c.setSize(Math.floor(c.columnWidth*pw)-c.getEl().getMargins("lr"))}}}});Ext.Container.LAYOUTS.column=Ext.layout.ColumnLayout;Ext.layout.BorderLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,rendered:false,onLayout:function(ct,target){var collapsed;if(!this.rendered){target.addClass("x-border-layout-ct");var items=ct.items.items;collapsed=[];for(var i=0,len=items.length;i<len;i++){var c=items[i];var pos=c.region;if(c.collapsed){collapsed.push(c)}c.collapsed=false;if(!c.rendered){c.render(target,i);c.getDomPositionEl().addClass("x-border-panel")}this[pos]=pos!="center"&&c.split?new Ext.layout.BorderLayout.SplitRegion(this,c.initialConfig,pos):new Ext.layout.BorderLayout.Region(this,c.initialConfig,pos);this[pos].render(target,c)}this.rendered=true}var size=target.getViewSize();if(size.width<20||size.height<20){if(collapsed){this.restoreCollapsed=collapsed}return}else{if(this.restoreCollapsed){collapsed=this.restoreCollapsed;delete this.restoreCollapsed}}var w=size.width,h=size.height;var centerW=w,centerH=h,centerY=0,centerX=0;var n=this.north,s=this.south,west=this.west,e=this.east,c=this.center;if(!c&&Ext.layout.BorderLayout.WARN!==false){throw"No center region defined in BorderLayout "+ct.id}if(n&&n.isVisible()){var b=n.getSize();var m=n.getMargins();b.width=w-(m.left+m.right);b.x=m.left;b.y=m.top;centerY=b.height+b.y+m.bottom;centerH-=centerY;n.applyLayout(b)}if(s&&s.isVisible()){var b=s.getSize();var m=s.getMargins();b.width=w-(m.left+m.right);b.x=m.left;var totalHeight=(b.height+m.top+m.bottom);b.y=h-totalHeight+m.top;centerH-=totalHeight;s.applyLayout(b)}if(west&&west.isVisible()){var b=west.getSize();var m=west.getMargins();b.height=centerH-(m.top+m.bottom);b.x=m.left;b.y=centerY+m.top;var totalWidth=(b.width+m.left+m.right);centerX+=totalWidth;centerW-=totalWidth;west.applyLayout(b)}if(e&&e.isVisible()){var b=e.getSize();var m=e.getMargins();b.height=centerH-(m.top+m.bottom);var totalWidth=(b.width+m.left+m.right);b.x=w-totalWidth+m.left;b.y=centerY+m.top;centerW-=totalWidth;e.applyLayout(b)}if(c){var m=c.getMargins();var centerBox={x:centerX+m.left,y:centerY+m.top,width:centerW-(m.left+m.right),height:centerH-(m.top+m.bottom)};c.applyLayout(centerBox)}if(collapsed){for(var i=0,len=collapsed.length;i<len;i++){collapsed[i].collapse(false)}}if(Ext.isIE&&Ext.isStrict){target.repaint()}},destroy:function(){var r=["north","south","east","west"];for(var i=0;i<r.length;i++){var region=this[r[i]];if(region){if(region.destroy){region.destroy()}else{if(region.split){region.split.destroy(true)}}}}Ext.layout.BorderLayout.superclass.destroy.call(this)}});Ext.layout.BorderLayout.Region=function(layout,config,pos){Ext.apply(this,config);this.layout=layout;this.position=pos;this.state={};if(typeof this.margins=="string"){this.margins=this.layout.parseMargins(this.margins)}this.margins=Ext.applyIf(this.margins||{},this.defaultMargins);if(this.collapsible){if(typeof this.cmargins=="string"){this.cmargins=this.layout.parseMargins(this.cmargins)}if(this.collapseMode=="mini"&&!this.cmargins){this.cmargins={left:0,top:0,right:0,bottom:0}}else{this.cmargins=Ext.applyIf(this.cmargins||{},pos=="north"||pos=="south"?this.defaultNSCMargins:this.defaultEWCMargins)}}};Ext.layout.BorderLayout.Region.prototype={collapsible:false,split:false,floatable:true,minWidth:50,minHeight:50,defaultMargins:{left:0,top:0,right:0,bottom:0},defaultNSCMargins:{left:5,top:5,right:5,bottom:5},defaultEWCMargins:{left:5,top:0,right:5,bottom:0},floatingZIndex:100,isCollapsed:false,render:function(ct,p){this.panel=p;p.el.enableDisplayMode();this.targetEl=ct;this.el=p.el;var gs=p.getState,ps=this.position;p.getState=function(){return Ext.apply(gs.call(p)||{},this.state)}.createDelegate(this);if(ps!="center"){p.allowQueuedExpand=false;p.on({beforecollapse:this.beforeCollapse,collapse:this.onCollapse,beforeexpand:this.beforeExpand,expand:this.onExpand,hide:this.onHide,show:this.onShow,scope:this});if(this.collapsible||this.floatable){p.collapseEl="el";p.slideAnchor=this.getSlideAnchor()}if(p.tools&&p.tools.toggle){p.tools.toggle.addClass("x-tool-collapse-"+ps);p.tools.toggle.addClassOnOver("x-tool-collapse-"+ps+"-over")}}},getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');tt.disableFormats=true;tt.compile();Ext.layout.BorderLayout.Region.prototype.toolTemplate=tt}this.collapsedEl=this.targetEl.createChild({cls:"x-layout-collapsed x-layout-collapsed-"+this.position,id:this.panel.id+"-xcollapsed"});this.collapsedEl.enableDisplayMode("block");if(this.collapseMode=="mini"){this.collapsedEl.addClass("x-layout-cmini-"+this.position);this.miniCollapsedEl=this.collapsedEl.createChild({cls:"x-layout-mini x-layout-mini-"+this.position,html:"&#160;"});this.miniCollapsedEl.addClassOnOver("x-layout-mini-over");this.collapsedEl.addClassOnOver("x-layout-collapsed-over");this.collapsedEl.on("click",this.onExpandClick,this,{stopEvent:true})}else{if(this.collapsible!==false&&!this.hideCollapseTool){var t=this.toolTemplate.append(this.collapsedEl.dom,{id:"expand-"+this.position},true);t.addClassOnOver("x-tool-expand-"+this.position+"-over");t.on("click",this.onExpandClick,this,{stopEvent:true})}if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver("x-layout-collapsed-over");this.collapsedEl.on("click",this[this.floatable?"collapseClick":"onExpandClick"],this)}}}return this.collapsedEl},onExpandClick:function(e){if(this.isSlid){this.afterSlideIn();this.panel.expand(false)}else{this.panel.expand()}},onCollapseClick:function(e){this.panel.collapse()},beforeCollapse:function(p,animate){this.lastAnim=animate;if(this.splitEl){this.splitEl.hide()}this.getCollapsedEl().show();this.panel.el.setStyle("z-index",100);this.isCollapsed=true;this.layout.layout()},onCollapse:function(animate){this.panel.el.setStyle("z-index",1);if(this.lastAnim===false||this.panel.animCollapse===false){this.getCollapsedEl().dom.style.visibility="visible"}else{this.getCollapsedEl().slideIn(this.panel.slideAnchor,{duration:0.2})}this.state.collapsed=true;this.panel.saveState()},beforeExpand:function(animate){var c=this.getCollapsedEl();this.el.show();if(this.position=="east"||this.position=="west"){this.panel.setSize(undefined,c.getHeight())}else{this.panel.setSize(c.getWidth(),undefined)}c.hide();c.dom.style.visibility="hidden";this.panel.el.setStyle("z-index",this.floatingZIndex)},onExpand:function(){this.isCollapsed=false;if(this.splitEl){this.splitEl.show()}this.layout.layout();this.panel.el.setStyle("z-index",1);this.state.collapsed=false;this.panel.saveState()},collapseClick:function(e){if(this.isSlid){e.stopPropagation();this.slideIn()}else{e.stopPropagation();this.slideOut()}},onHide:function(){if(this.isCollapsed){this.getCollapsedEl().hide()}else{if(this.splitEl){this.splitEl.hide()}}},onShow:function(){if(this.isCollapsed){this.getCollapsedEl().show()}else{if(this.splitEl){this.splitEl.show()}}},isVisible:function(){return !this.panel.hidden},getMargins:function(){return this.isCollapsed&&this.cmargins?this.cmargins:this.margins},getSize:function(){return this.isCollapsed?this.getCollapsedEl().getSize():this.panel.getSize()},setPanel:function(panel){this.panel=panel},getMinWidth:function(){return this.minWidth},getMinHeight:function(){return this.minHeight},applyLayoutCollapsed:function(box){var ce=this.getCollapsedEl();ce.setLeftTop(box.x,box.y);ce.setSize(box.width,box.height)},applyLayout:function(box){if(this.isCollapsed){this.applyLayoutCollapsed(box)}else{this.panel.setPosition(box.x,box.y);this.panel.setSize(box.width,box.height)}},beforeSlide:function(){this.panel.beforeEffect()},afterSlide:function(){this.panel.afterEffect()},initAutoHide:function(){if(this.autoHide!==false){if(!this.autoHideHd){var st=new Ext.util.DelayedTask(this.slideIn,this);this.autoHideHd={mouseout:function(e){if(!e.within(this.el,true)){st.delay(500)}},mouseover:function(e){st.cancel()},scope:this}}this.el.on(this.autoHideHd)}},clearAutoHide:function(){if(this.autoHide!==false){this.el.un("mouseout",this.autoHideHd.mouseout);this.el.un("mouseover",this.autoHideHd.mouseover)}},clearMonitor:function(){Ext.getDoc().un("click",this.slideInIf,this)},slideOut:function(){if(this.isSlid||this.el.hasActiveFx()){return}this.isSlid=true;var ts=this.panel.tools;if(ts&&ts.toggle){ts.toggle.hide()}this.el.show();if(this.position=="east"||this.position=="west"){this.panel.setSize(undefined,this.collapsedEl.getHeight())}else{this.panel.setSize(this.collapsedEl.getWidth(),undefined)}this.restoreLT=[this.el.dom.style.left,this.el.dom.style.top];this.el.alignTo(this.collapsedEl,this.getCollapseAnchor());this.el.setStyle("z-index",this.floatingZIndex+2);this.panel.el.replaceClass("x-panel-collapsed","x-panel-floating");if(this.animFloat!==false){this.beforeSlide();this.el.slideIn(this.getSlideAnchor(),{callback:function(){this.afterSlide();this.initAutoHide();Ext.getDoc().on("click",this.slideInIf,this)},scope:this,block:true})}else{this.initAutoHide();Ext.getDoc().on("click",this.slideInIf,this)}},afterSlideIn:function(){this.clearAutoHide();this.isSlid=false;this.clearMonitor();this.el.setStyle("z-index","");this.panel.el.replaceClass("x-panel-floating","x-panel-collapsed");this.el.dom.style.left=this.restoreLT[0];this.el.dom.style.top=this.restoreLT[1];var ts=this.panel.tools;if(ts&&ts.toggle){ts.toggle.show()}},slideIn:function(cb){if(!this.isSlid||this.el.hasActiveFx()){Ext.callback(cb);return}this.isSlid=false;if(this.animFloat!==false){this.beforeSlide();this.el.slideOut(this.getSlideAnchor(),{callback:function(){this.el.hide();this.afterSlide();this.afterSlideIn();Ext.callback(cb)},scope:this,block:true})}else{this.el.hide();this.afterSlideIn()}},slideInIf:function(e){if(!e.within(this.el)){this.slideIn()}},anchors:{west:"left",east:"right",north:"top",south:"bottom"},sanchors:{west:"l",east:"r",north:"t",south:"b"},canchors:{west:"tl-tr",east:"tr-tl",north:"tl-bl",south:"bl-tl"},getAnchor:function(){return this.anchors[this.position]},getCollapseAnchor:function(){return this.canchors[this.position]},getSlideAnchor:function(){return this.sanchors[this.position]},getAlignAdj:function(){var cm=this.cmargins;switch(this.position){case"west":return[0,0];break;case"east":return[0,0];break;case"north":return[0,0];break;case"south":return[0,0];break}},getExpandAdj:function(){var c=this.collapsedEl,cm=this.cmargins;switch(this.position){case"west":return[-(cm.right+c.getWidth()+cm.left),0];break;case"east":return[cm.right+c.getWidth()+cm.left,0];break;case"north":return[0,-(cm.top+cm.bottom+c.getHeight())];break;case"south":return[0,cm.top+cm.bottom+c.getHeight()];break}}};Ext.layout.BorderLayout.SplitRegion=function(layout,config,pos){Ext.layout.BorderLayout.SplitRegion.superclass.constructor.call(this,layout,config,pos);this.applyLayout=this.applyFns[pos]};Ext.extend(Ext.layout.BorderLayout.SplitRegion,Ext.layout.BorderLayout.Region,{splitTip:"Drag to resize.",collapsibleSplitTip:"Drag to resize. Double click to hide.",useSplitTips:false,splitSettings:{north:{orientation:Ext.SplitBar.VERTICAL,placement:Ext.SplitBar.TOP,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},south:{orientation:Ext.SplitBar.VERTICAL,placement:Ext.SplitBar.BOTTOM,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},east:{orientation:Ext.SplitBar.HORIZONTAL,placement:Ext.SplitBar.RIGHT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"},west:{orientation:Ext.SplitBar.HORIZONTAL,placement:Ext.SplitBar.LEFT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"}},applyFns:{west:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box)}var sd=this.splitEl.dom,s=sd.style;this.panel.setPosition(box.x,box.y);var sw=sd.offsetWidth;s.left=(box.x+box.width-sw)+"px";s.top=(box.y)+"px";s.height=Math.max(0,box.height)+"px";this.panel.setSize(box.width-sw,box.height)},east:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box)}var sd=this.splitEl.dom,s=sd.style;var sw=sd.offsetWidth;this.panel.setPosition(box.x+sw,box.y);s.left=(box.x)+"px";s.top=(box.y)+"px";s.height=Math.max(0,box.height)+"px";this.panel.setSize(box.width-sw,box.height)},north:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box)}var sd=this.splitEl.dom,s=sd.style;var sh=sd.offsetHeight;this.panel.setPosition(box.x,box.y);s.left=(box.x)+"px";s.top=(box.y+box.height-sh)+"px";s.width=Math.max(0,box.width)+"px";this.panel.setSize(box.width,box.height-sh)},south:function(box){if(this.isCollapsed){return this.applyLayoutCollapsed(box)}var sd=this.splitEl.dom,s=sd.style;var sh=sd.offsetHeight;this.panel.setPosition(box.x,box.y+sh);s.left=(box.x)+"px";s.top=(box.y)+"px";s.width=Math.max(0,box.width)+"px";this.panel.setSize(box.width,box.height-sh)}},render:function(ct,p){Ext.layout.BorderLayout.SplitRegion.superclass.render.call(this,ct,p);var ps=this.position;this.splitEl=ct.createChild({cls:"x-layout-split x-layout-split-"+ps,html:"&#160;",id:this.panel.id+"-xsplit"});if(this.collapseMode=="mini"){this.miniSplitEl=this.splitEl.createChild({cls:"x-layout-mini x-layout-mini-"+ps,html:"&#160;"});this.miniSplitEl.addClassOnOver("x-layout-mini-over");this.miniSplitEl.on("click",this.onCollapseClick,this,{stopEvent:true})}var s=this.splitSettings[ps];this.split=new Ext.SplitBar(this.splitEl.dom,p.el,s.orientation);this.split.tickSize=this.tickSize;this.split.placement=s.placement;this.split.getMaximumSize=this[s.maxFn].createDelegate(this);this.split.minSize=this.minSize||this[s.minProp];this.split.on("beforeapply",this.onSplitMove,this);this.split.useShim=this.useShim===true;this.maxSize=this.maxSize||this[s.maxProp];if(p.hidden){this.splitEl.hide()}if(this.useSplitTips){this.splitEl.dom.title=this.collapsible?this.collapsibleSplitTip:this.splitTip}if(this.collapsible){this.splitEl.on("dblclick",this.onCollapseClick,this)}},getSize:function(){if(this.isCollapsed){return this.collapsedEl.getSize()}var s=this.panel.getSize();if(this.position=="north"||this.position=="south"){s.height+=this.splitEl.dom.offsetHeight}else{s.width+=this.splitEl.dom.offsetWidth}return s},getHMaxSize:function(){var cmax=this.maxSize||10000;var center=this.layout.center;return Math.min(cmax,(this.el.getWidth()+center.el.getWidth())-center.getMinWidth())},getVMaxSize:function(){var cmax=this.maxSize||10000;var center=this.layout.center;return Math.min(cmax,(this.el.getHeight()+center.el.getHeight())-center.getMinHeight())},onSplitMove:function(split,newSize){var s=this.panel.getSize();this.lastSplitSize=newSize;if(this.position=="north"||this.position=="south"){this.panel.setSize(s.width,newSize);this.state.height=newSize}else{this.panel.setSize(newSize,s.height);this.state.width=newSize}this.layout.layout();this.panel.saveState();return false},getSplitBar:function(){return this.split},destroy:function(){Ext.destroy(this.miniSplitEl,this.split,this.splitEl)}});Ext.Container.LAYOUTS.border=Ext.layout.BorderLayout;Ext.layout.FormLayout=Ext.extend(Ext.layout.AnchorLayout,{labelSeparator:":",trackLabels:false,onRemove:function(c){Ext.layout.FormLayout.superclass.onRemove.call(this,c);if(this.trackLabels&&!this.isHide(c)){c.un("show",this.onFieldShow,this);c.un("hide",this.onFieldHide,this)}var el=c.getPositionEl(),ct=c.getItemCt&&c.getItemCt();if(c.rendered&&ct){el.insertAfter(ct);Ext.destroy(ct);Ext.destroyMembers(c,"label","itemCt");if(c.customItemCt){Ext.destroyMembers(c,"getItemCt","customItemCt")}}},setContainer:function(ct){Ext.layout.FormLayout.superclass.setContainer.call(this,ct);if(ct.labelAlign){ct.addClass("x-form-label-"+ct.labelAlign)}if(ct.hideLabels){Ext.apply(this,{labelStyle:"display:none",elementStyle:"padding-left:0;",labelAdjust:0})}else{this.labelSeparator=ct.labelSeparator||this.labelSeparator;ct.labelWidth=ct.labelWidth||100;if(Ext.isNumber(ct.labelWidth)){var pad=Ext.isNumber(ct.labelPad)?ct.labelPad:5;Ext.apply(this,{labelAdjust:ct.labelWidth+pad,labelStyle:"width:"+ct.labelWidth+"px;",elementStyle:"padding-left:"+(ct.labelWidth+pad)+"px"})}if(ct.labelAlign=="top"){Ext.apply(this,{labelStyle:"width:auto;",labelAdjust:0,elementStyle:"padding-left:0;"})}}},isHide:function(c){return c.hideLabel||this.container.hideLabels},onFieldShow:function(c){c.getItemCt().removeClass("x-hide-"+c.hideMode)},onFieldHide:function(c){c.getItemCt().addClass("x-hide-"+c.hideMode)},getLabelStyle:function(s){var ls="",items=[this.labelStyle,s];for(var i=0,len=items.length;i<len;++i){if(items[i]){ls+=items[i];if(ls.substr(-1,1)!=";"){ls+=";"}}}return ls},renderItem:function(c,position,target){if(c&&(c.isFormField||c.fieldLabel)&&c.inputType!="hidden"){var args=this.getTemplateArgs(c);if(Ext.isNumber(position)){position=target.dom.childNodes[position]||null}if(position){c.itemCt=this.fieldTpl.insertBefore(position,args,true)}else{c.itemCt=this.fieldTpl.append(target,args,true)}if(!c.rendered){c.render("x-form-el-"+c.id)}else{if(!this.isValidParent(c,target)){Ext.fly("x-form-el-"+c.id).appendChild(c.getPositionEl())}}if(!c.getItemCt){Ext.apply(c,{getItemCt:function(){return c.itemCt},customItemCt:true})}c.label=c.getItemCt().child("label.x-form-item-label");if(this.trackLabels&&!this.isHide(c)){if(c.hidden){this.onFieldHide(c)}c.on({scope:this,show:this.onFieldShow,hide:this.onFieldHide})}this.configureItem(c)}else{Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)}},getTemplateArgs:function(field){var noLabelSep=!field.fieldLabel||field.hideLabel;return{id:field.id,label:field.fieldLabel,labelStyle:this.getLabelStyle(field.labelStyle),elementStyle:this.elementStyle||"",labelSeparator:noLabelSep?"":(Ext.isDefined(field.labelSeparator)?field.labelSeparator:this.labelSeparator),itemCls:(field.itemCls||this.container.itemCls||"")+(field.hideLabel?" x-hide-label":""),clearCls:field.clearCls||"x-form-clear-left"}},adjustWidthAnchor:function(value,c){if(c.label&&!this.isHide(c)&&(this.container.labelAlign!="top")){var adjust=Ext.isIE6||(Ext.isIE&&!Ext.isStrict);return value-this.labelAdjust+(adjust?-3:0)}return value},adjustHeightAnchor:function(value,c){if(c.label&&!this.isHide(c)&&(this.container.labelAlign=="top")){return value-c.label.getHeight()}return value},isValidParent:function(c,target){return target&&this.container.getEl().contains(c.getDomPositionEl())}});Ext.Container.LAYOUTS.form=Ext.layout.FormLayout;Ext.layout.AccordionLayout=Ext.extend(Ext.layout.FitLayout,{fill:true,autoWidth:true,titleCollapse:true,hideCollapseTool:false,collapseFirst:false,animate:false,sequence:false,activeOnTop:false,renderItem:function(c){if(this.animate===false){c.animCollapse=false}c.collapsible=true;if(this.autoWidth){c.autoWidth=true}if(this.titleCollapse){c.titleCollapse=true}if(this.hideCollapseTool){c.hideCollapseTool=true}if(this.collapseFirst!==undefined){c.collapseFirst=this.collapseFirst}if(!this.activeItem&&!c.collapsed){this.activeItem=c}else{if(this.activeItem&&this.activeItem!=c){c.collapsed=true}}Ext.layout.AccordionLayout.superclass.renderItem.apply(this,arguments);c.header.addClass("x-accordion-hd");c.on("beforeexpand",this.beforeExpand,this)},onRemove:function(c){Ext.layout.AccordionLayout.superclass.onRemove.call(this,c);if(c.rendered){c.header.removeClass("x-accordion-hd")}c.un("beforeexpand",this.beforeExpand,this)},beforeExpand:function(p,anim){var ai=this.activeItem;if(ai){if(this.sequence){delete this.activeItem;if(!ai.collapsed){ai.collapse({callback:function(){p.expand(anim||true)},scope:this});return false}}else{ai.collapse(this.animate)}}this.activeItem=p;if(this.activeOnTop){p.el.dom.parentNode.insertBefore(p.el.dom,p.el.dom.parentNode.firstChild)}this.layout()},setItemSize:function(item,size){if(this.fill&&item){var hh=0;this.container.items.each(function(p){if(p!=item){hh+=p.header.getHeight()}});size.height-=hh;item.setSize(size)}},setActiveItem:function(item){item=this.container.getComponent(item);if(this.activeItem!=item){if(item.rendered&&item.collapsed){item.expand()}else{this.activeItem=item}}}});Ext.Container.LAYOUTS.accordion=Ext.layout.AccordionLayout;Ext.layout.Accordion=Ext.layout.AccordionLayout;Ext.layout.TableLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:false,tableAttrs:null,setContainer:function(ct){Ext.layout.TableLayout.superclass.setContainer.call(this,ct);this.currentRow=0;this.currentColumn=0;this.cells=[]},onLayout:function(ct,target){var cs=ct.items.items,len=cs.length,c,i;if(!this.table){target.addClass("x-table-layout-ct");this.table=target.createChild(Ext.apply({tag:"table",cls:"x-table-layout",cellspacing:0,cn:{tag:"tbody"}},this.tableAttrs),null,true)}this.renderAll(ct,target)},getRow:function(index){var row=this.table.tBodies[0].childNodes[index];if(!row){row=document.createElement("tr");this.table.tBodies[0].appendChild(row)}return row},getNextCell:function(c){var cell=this.getNextNonSpan(this.currentColumn,this.currentRow);var curCol=this.currentColumn=cell[0],curRow=this.currentRow=cell[1];for(var rowIndex=curRow;rowIndex<curRow+(c.rowspan||1);rowIndex++){if(!this.cells[rowIndex]){this.cells[rowIndex]=[]}for(var colIndex=curCol;colIndex<curCol+(c.colspan||1);colIndex++){this.cells[rowIndex][colIndex]=true}}var td=document.createElement("td");if(c.cellId){td.id=c.cellId}var cls="x-table-layout-cell";if(c.cellCls){cls+=" "+c.cellCls}td.className=cls;if(c.colspan){td.colSpan=c.colspan}if(c.rowspan){td.rowSpan=c.rowspan}this.getRow(curRow).appendChild(td);return td},getNextNonSpan:function(colIndex,rowIndex){var cols=this.columns;while((cols&&colIndex>=cols)||(this.cells[rowIndex]&&this.cells[rowIndex][colIndex])){if(cols&&colIndex>=cols){rowIndex++;colIndex=0}else{colIndex++}}return[colIndex,rowIndex]},renderItem:function(c,position,target){if(c&&!c.rendered){c.render(this.getNextCell(c));this.configureItem(c,position)}else{if(c&&!this.isValidParent(c,target)){var container=this.getNextCell(c);container.insertBefore(c.getDomPositionEl().dom,null);c.container=Ext.get(container);this.configureItem(c,position)}}},isValidParent:function(c,target){return c.getDomPositionEl().up("table",5).dom.parentNode===(target.dom||target)}});Ext.Container.LAYOUTS.table=Ext.layout.TableLayout;Ext.layout.AbsoluteLayout=Ext.extend(Ext.layout.AnchorLayout,{extraCls:"x-abs-layout-item",onLayout:function(ct,target){target.position();this.paddingLeft=target.getPadding("l");this.paddingTop=target.getPadding("t");Ext.layout.AbsoluteLayout.superclass.onLayout.call(this,ct,target)},adjustWidthAnchor:function(value,comp){return value?value-comp.getPosition(true)[0]+this.paddingLeft:value},adjustHeightAnchor:function(value,comp){return value?value-comp.getPosition(true)[1]+this.paddingTop:value}});Ext.Container.LAYOUTS.absolute=Ext.layout.AbsoluteLayout;Ext.layout.BoxLayout=Ext.extend(Ext.layout.ContainerLayout,{defaultMargins:{left:0,top:0,right:0,bottom:0},padding:"0",pack:"start",monitorResize:true,scrollOffset:0,extraCls:"x-box-item",ctCls:"x-box-layout-ct",innerCls:"x-box-inner",constructor:function(config){Ext.layout.BoxLayout.superclass.constructor.call(this,config);if(Ext.isString(this.defaultMargins)){this.defaultMargins=this.parseMargins(this.defaultMargins)}},isValidParent:function(c,target){return c.getEl().dom.parentNode==this.innerCt.dom},onLayout:function(ct,target){var cs=ct.items.items,len=cs.length,c,i,last=len-1,cm;if(!this.innerCt){target.addClass(this.ctCls);this.innerCt=target.createChild({cls:this.innerCls});this.padding=this.parseMargins(this.padding)}this.renderAll(ct,this.innerCt)},renderItem:function(c){if(Ext.isString(c.margins)){c.margins=this.parseMargins(c.margins)}else{if(!c.margins){c.margins=this.defaultMargins}}Ext.layout.BoxLayout.superclass.renderItem.apply(this,arguments)},getTargetSize:function(target){return(Ext.isIE6&&Ext.isStrict&&target.dom==document.body)?target.getStyleSize():target.getViewSize()},getItems:function(ct){var items=[];ct.items.each(function(c){if(c.isVisible()){items.push(c)}});return items}});Ext.layout.VBoxLayout=Ext.extend(Ext.layout.BoxLayout,{align:"left",onLayout:function(ct,target){Ext.layout.VBoxLayout.superclass.onLayout.call(this,ct,target);var cs=this.getItems(ct),cm,ch,margin,size=this.getTargetSize(target),w=size.width-target.getPadding("lr"),h=size.height-target.getPadding("tb")-this.scrollOffset,l=this.padding.left,t=this.padding.top,isStart=this.pack=="start",isRestore=["stretch","stretchmax"].indexOf(this.align)==-1,stretchWidth=w-(this.padding.left+this.padding.right),extraHeight=0,maxWidth=0,totalFlex=0,flexHeight=0,usedHeight=0;Ext.each(cs,function(c){cm=c.margins;totalFlex+=c.flex||0;ch=c.getHeight();margin=cm.top+cm.bottom;extraHeight+=ch+margin;flexHeight+=margin+(c.flex?0:ch);maxWidth=Math.max(maxWidth,c.getWidth()+cm.left+cm.right)});extraHeight=h-extraHeight-this.padding.top-this.padding.bottom;var innerCtWidth=maxWidth+this.padding.left+this.padding.right;switch(this.align){case"stretch":this.innerCt.setSize(w,h);break;case"stretchmax":case"left":this.innerCt.setSize(innerCtWidth,h);break;case"center":this.innerCt.setSize(w=Math.max(w,innerCtWidth),h);break}var availHeight=Math.max(0,h-this.padding.top-this.padding.bottom-flexHeight),leftOver=availHeight,heights=[],restore=[],idx=0,availableWidth=Math.max(0,w-this.padding.left-this.padding.right);Ext.each(cs,function(c){if(isStart&&c.flex){ch=Math.floor(availHeight*(c.flex/totalFlex));leftOver-=ch;heights.push(ch)}});if(this.pack=="center"){t+=extraHeight?extraHeight/2:0}else{if(this.pack=="end"){t+=extraHeight}}Ext.each(cs,function(c){cm=c.margins;t+=cm.top;c.setPosition(l+cm.left,t);if(isStart&&c.flex){ch=Math.max(0,heights[idx++]+(leftOver-->0?1:0));if(isRestore){restore.push(c.getWidth())}c.setSize(availableWidth,ch)}else{ch=c.getHeight()}t+=ch+cm.bottom});idx=0;Ext.each(cs,function(c){cm=c.margins;if(this.align=="stretch"){c.setWidth((stretchWidth-(cm.left+cm.right)).constrain(c.minWidth||0,c.maxWidth||1000000))}else{if(this.align=="stretchmax"){c.setWidth((maxWidth-(cm.left+cm.right)).constrain(c.minWidth||0,c.maxWidth||1000000))}else{if(this.align=="center"){var diff=availableWidth-(c.getWidth()+cm.left+cm.right);if(diff>0){c.setPosition(l+cm.left+(diff/2),c.y)}}if(isStart&&c.flex){c.setWidth(restore[idx++])}}}},this)}});Ext.Container.LAYOUTS.vbox=Ext.layout.VBoxLayout;Ext.layout.HBoxLayout=Ext.extend(Ext.layout.BoxLayout,{align:"top",onLayout:function(ct,target){Ext.layout.HBoxLayout.superclass.onLayout.call(this,ct,target);var cs=this.getItems(ct),cm,cw,margin,size=this.getTargetSize(target),w=size.width-target.getPadding("lr")-this.scrollOffset,h=size.height-target.getPadding("tb"),l=this.padding.left,t=this.padding.top,isStart=this.pack=="start",isRestore=["stretch","stretchmax"].indexOf(this.align)==-1,stretchHeight=h-(this.padding.top+this.padding.bottom),extraWidth=0,maxHeight=0,totalFlex=0,flexWidth=0,usedWidth=0;Ext.each(cs,function(c){cm=c.margins;totalFlex+=c.flex||0;cw=c.getWidth();margin=cm.left+cm.right;extraWidth+=cw+margin;flexWidth+=margin+(c.flex?0:cw);maxHeight=Math.max(maxHeight,c.getHeight()+cm.top+cm.bottom)});extraWidth=w-extraWidth-this.padding.left-this.padding.right;var innerCtHeight=maxHeight+this.padding.top+this.padding.bottom;switch(this.align){case"stretch":this.innerCt.setSize(w,h);break;case"stretchmax":case"top":this.innerCt.setSize(w,innerCtHeight);break;case"middle":this.innerCt.setSize(w,h=Math.max(h,innerCtHeight));break}var availWidth=Math.max(0,w-this.padding.left-this.padding.right-flexWidth),leftOver=availWidth,widths=[],restore=[],idx=0,availableHeight=Math.max(0,h-this.padding.top-this.padding.bottom);Ext.each(cs,function(c){if(isStart&&c.flex){cw=Math.floor(availWidth*(c.flex/totalFlex));leftOver-=cw;widths.push(cw)}});if(this.pack=="center"){l+=extraWidth?extraWidth/2:0}else{if(this.pack=="end"){l+=extraWidth}}Ext.each(cs,function(c){cm=c.margins;l+=cm.left;c.setPosition(l,t+cm.top);if(isStart&&c.flex){cw=Math.max(0,widths[idx++]+(leftOver-->0?1:0));if(isRestore){restore.push(c.getHeight())}c.setSize(cw,availableHeight)}else{cw=c.getWidth()}l+=cw+cm.right});idx=0;Ext.each(cs,function(c){var cm=c.margins;if(this.align=="stretch"){c.setHeight((stretchHeight-(cm.top+cm.bottom)).constrain(c.minHeight||0,c.maxHeight||1000000))}else{if(this.align=="stretchmax"){c.setHeight((maxHeight-(cm.top+cm.bottom)).constrain(c.minHeight||0,c.maxHeight||1000000))}else{if(this.align=="middle"){var diff=availableHeight-(c.getHeight()+cm.top+cm.bottom);if(diff>0){c.setPosition(c.x,t+cm.top+(diff/2))}}if(isStart&&c.flex){c.setHeight(restore[idx++])}}}},this)}});Ext.Container.LAYOUTS.hbox=Ext.layout.HBoxLayout;Ext.Viewport=Ext.extend(Ext.Container,{initComponent:function(){Ext.Viewport.superclass.initComponent.call(this);document.getElementsByTagName("html")[0].className+=" x-viewport";this.el=Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.dom.scroll="no";this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el},fireResize:function(w,h){this.fireEvent("resize",this,w,h,w,h)}});Ext.reg("viewport",Ext.Viewport);Ext.Panel=Ext.extend(Ext.Container,{baseCls:"x-panel",collapsedCls:"x-panel-collapsed",maskDisabled:true,animCollapse:Ext.enableFx,headerAsText:true,buttonAlign:"right",collapsed:false,collapseFirst:true,minButtonWidth:75,elements:"body",preventBodyReset:false,resizeEvent:"bodyresize",toolTarget:"header",collapseEl:"bwrap",slideAnchor:"t",disabledClass:"",deferHeight:true,expandDefaults:{duration:0.25},collapseDefaults:{duration:0.25},initComponent:function(){Ext.Panel.superclass.initComponent.call(this);this.addEvents("bodyresize","titlechange","iconchange","collapse","expand","beforecollapse","beforeexpand","beforeclose","close","activate","deactivate");if(this.unstyled){this.baseCls="x-plain"}if(this.tbar){this.elements+=",tbar";if(Ext.isObject(this.tbar)){this.topToolbar=this.tbar}delete this.tbar}if(this.bbar){this.elements+=",bbar";if(Ext.isObject(this.bbar)){this.bottomToolbar=this.bbar}delete this.bbar}if(this.header===true){this.elements+=",header";delete this.header}else{if(this.headerCfg||(this.title&&this.header!==false)){this.elements+=",header"}}if(this.footerCfg||this.footer===true){this.elements+=",footer";delete this.footer}if(this.buttons){this.elements+=",footer";var btns=this.buttons;this.buttons=[];Ext.each(btns,function(btn){if(btn.render){this.buttons.push(btn)}else{if(btn.xtype){this.buttons.push(Ext.create(btn,"button"))}else{this.addButton(btn)}}},this)}if(this.fbar){this.elements+=",footer"}if(this.autoLoad){this.on("render",this.doAutoLoad,this,{delay:10})}},createElement:function(name,pnode){if(this[name]){pnode.appendChild(this[name].dom);return}if(name==="bwrap"||this.elements.indexOf(name)!=-1){if(this[name+"Cfg"]){this[name]=Ext.fly(pnode).createChild(this[name+"Cfg"])}else{var el=document.createElement("div");el.className=this[name+"Cls"];this[name]=Ext.get(pnode.appendChild(el))}if(this[name+"CssClass"]){this[name].addClass(this[name+"CssClass"])}if(this[name+"Style"]){this[name].applyStyles(this[name+"Style"])}}},onRender:function(ct,position){Ext.Panel.superclass.onRender.call(this,ct,position);this.createClasses();var el=this.el,d=el.dom,bw,ts;if(this.collapsible&&!this.hideCollapseTool){this.tools=this.tools?this.tools.slice(0):[];this.tools[this.collapseFirst?"unshift":"push"]({id:"toggle",handler:this.toggleCollapse,scope:this})}if(this.tools){ts=this.tools;this.elements+=(this.header!==false)?",header":""}this.tools={};el.addClass(this.baseCls);if(d.firstChild){this.header=el.down("."+this.headerCls);this.bwrap=el.down("."+this.bwrapCls);var cp=this.bwrap?this.bwrap:el;this.tbar=cp.down("."+this.tbarCls);this.body=cp.down("."+this.bodyCls);this.bbar=cp.down("."+this.bbarCls);this.footer=cp.down("."+this.footerCls);this.fromMarkup=true}if(this.preventBodyReset===true){el.addClass("x-panel-reset")}if(this.cls){el.addClass(this.cls)}if(this.buttons){this.elements+=",footer"}if(this.frame){el.insertHtml("afterBegin",String.format(Ext.Element.boxMarkup,this.baseCls));this.createElement("header",d.firstChild.firstChild.firstChild);this.createElement("bwrap",d);bw=this.bwrap.dom;var ml=d.childNodes[1],bl=d.childNodes[2];bw.appendChild(ml);bw.appendChild(bl);var mc=bw.firstChild.firstChild.firstChild;this.createElement("tbar",mc);this.createElement("body",mc);this.createElement("bbar",mc);this.createElement("footer",bw.lastChild.firstChild.firstChild);if(!this.footer){this.bwrap.dom.lastChild.className+=" x-panel-nofooter"}this.ft=Ext.get(this.bwrap.dom.lastChild);this.mc=Ext.get(this.bwrap.dom.firstChild.firstChild.firstChild)}else{this.createElement("header",d);this.createElement("bwrap",d);bw=this.bwrap.dom;this.createElement("tbar",bw);this.createElement("body",bw);this.createElement("bbar",bw);this.createElement("footer",bw);if(!this.header){this.body.addClass(this.bodyCls+"-noheader");if(this.tbar){this.tbar.addClass(this.tbarCls+"-noheader")}}}if(Ext.isDefined(this.padding)){this.body.setStyle("padding",this.body.addUnits(this.padding))}if(this.border===false){this.el.addClass(this.baseCls+"-noborder");this.body.addClass(this.bodyCls+"-noborder");if(this.header){this.header.addClass(this.headerCls+"-noborder")}if(this.footer){this.footer.addClass(this.footerCls+"-noborder")}if(this.tbar){this.tbar.addClass(this.tbarCls+"-noborder")}if(this.bbar){this.bbar.addClass(this.bbarCls+"-noborder")}}if(this.bodyBorder===false){this.body.addClass(this.bodyCls+"-noborder")}this.bwrap.enableDisplayMode("block");if(this.header){this.header.unselectable();if(this.headerAsText){this.header.dom.innerHTML='<span class="'+this.headerTextCls+'">'+this.header.dom.innerHTML+"</span>";if(this.iconCls){this.setIconClass(this.iconCls)}}}if(this.floating){this.makeFloating(this.floating)}if(this.collapsible&&this.titleCollapse&&this.header){this.mon(this.header,"click",this.toggleCollapse,this);this.header.setStyle("cursor","pointer")}if(ts){this.addTool.apply(this,ts)}if(this.buttons&&this.buttons.length>0){this.fbar=new Ext.Toolbar({items:this.buttons,toolbarCls:"x-panel-fbar"})}this.toolbars=[];if(this.fbar){this.fbar=Ext.create(this.fbar,"toolbar");this.fbar.enableOverflow=false;if(this.fbar.items){this.fbar.items.each(function(c){c.minWidth=c.minWidth||this.minButtonWidth},this)}this.fbar.toolbarCls="x-panel-fbar";var bct=this.footer.createChild({cls:"x-panel-btns x-panel-btns-"+this.buttonAlign});this.fbar.ownerCt=this;this.fbar.render(bct);bct.createChild({cls:"x-clear"});this.toolbars.push(this.fbar)}if(this.tbar&&this.topToolbar){if(Ext.isArray(this.topToolbar)){this.topToolbar=new Ext.Toolbar(this.topToolbar)}else{if(!this.topToolbar.events){this.topToolbar=Ext.create(this.topToolbar,"toolbar")}}this.topToolbar.ownerCt=this;this.topToolbar.render(this.tbar);this.toolbars.push(this.topToolbar)}if(this.bbar&&this.bottomToolbar){if(Ext.isArray(this.bottomToolbar)){this.bottomToolbar=new Ext.Toolbar(this.bottomToolbar)}else{if(!this.bottomToolbar.events){this.bottomToolbar=Ext.create(this.bottomToolbar,"toolbar")}}this.bottomToolbar.ownerCt=this;this.bottomToolbar.render(this.bbar);this.toolbars.push(this.bottomToolbar)}},setIconClass:function(cls){var old=this.iconCls;this.iconCls=cls;if(this.rendered&&this.header){if(this.frame){this.header.addClass("x-panel-icon");this.header.replaceClass(old,this.iconCls)}else{var hd=this.header,img=hd.child("img.x-panel-inline-icon");if(img){Ext.fly(img).replaceClass(old,this.iconCls)}else{Ext.DomHelper.insertBefore(hd.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.iconCls})}}}this.fireEvent("iconchange",this,cls,old)},makeFloating:function(cfg){this.floating=true;this.el=new Ext.Layer(Ext.isObject(cfg)?cfg:{shadow:Ext.isDefined(this.shadow)?this.shadow:"sides",shadowOffset:this.shadowOffset,constrain:false,shim:this.shim===false?false:undefined},this.el)},getTopToolbar:function(){return this.topToolbar},getBottomToolbar:function(){return this.bottomToolbar},addButton:function(config,handler,scope){var bc={handler:handler,scope:scope,minWidth:this.minButtonWidth,hideParent:true};if(Ext.isString(config)){bc.text=config}else{Ext.apply(bc,config)}var btn=new Ext.Button(bc);if(!this.buttons){this.buttons=[]}this.buttons.push(btn);return btn},addTool:function(){if(!this.rendered){if(!this.tools){this.tools=[]}Ext.each(arguments,function(arg){this.tools.push(arg)},this);return}if(!this[this.toolTarget]){return}if(!this.toolTemplate){var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');tt.disableFormats=true;tt.compile();Ext.Panel.prototype.toolTemplate=tt}for(var i=0,a=arguments,len=a.length;i<len;i++){var tc=a[i];if(!this.tools[tc.id]){var overCls="x-tool-"+tc.id+"-over";var t=this.toolTemplate.insertFirst((tc.align!=="left")?this[this.toolTarget]:this[this.toolTarget].child("span"),tc,true);this.tools[tc.id]=t;t.enableDisplayMode("block");this.mon(t,"click",this.createToolHandler(t,tc,overCls,this));if(tc.on){this.mon(t,tc.on)}if(tc.hidden){t.hide()}if(tc.qtip){if(Ext.isObject(tc.qtip)){Ext.QuickTips.register(Ext.apply({target:t.id},tc.qtip))}else{t.dom.qtip=tc.qtip}}t.addClassOnOver(overCls)}}},onLayout:function(shallow,force){if(this.hasLayout&&this.toolbars.length>0){Ext.each(this.toolbars,function(tb){tb.doLayout(undefined,force)});this.syncHeight()}},syncHeight:function(){var h=this.toolbarHeight,bd=this.body,lsh=this.lastSize.height;if(this.autoHeight||!Ext.isDefined(lsh)||lsh=="auto"){return}if(h!=this.getToolbarHeight()){h=Math.max(0,this.adjustBodyHeight(lsh-this.getFrameHeight()));bd.setHeight(h);sz=bd.getSize();this.toolbarHeight=this.getToolbarHeight();this.onBodyResize(sz.width,sz.height)}},onShow:function(){if(this.floating){return this.el.show()}Ext.Panel.superclass.onShow.call(this)},onHide:function(){if(this.floating){return this.el.hide()}Ext.Panel.superclass.onHide.call(this)},createToolHandler:function(t,tc,overCls,panel){return function(e){t.removeClass(overCls);if(tc.stopEvent!==false){e.stopEvent()}if(tc.handler){tc.handler.call(tc.scope||t,e,t,panel,tc)}}},afterRender:function(){if(this.floating&&!this.hidden){this.el.show()}if(this.title){this.setTitle(this.title)}this.setAutoScroll();if(this.html){this.body.update(Ext.isObject(this.html)?Ext.DomHelper.markup(this.html):this.html);delete this.html}if(this.contentEl){var ce=Ext.getDom(this.contentEl);Ext.fly(ce).removeClass(["x-hidden","x-hide-display"]);this.body.dom.appendChild(ce)}if(this.collapsed){this.collapsed=false;this.collapse(false)}Ext.Panel.superclass.afterRender.call(this);this.initEvents()},setAutoScroll:function(){if(this.rendered&&this.autoScroll){var el=this.body||this.el;if(el){el.setOverflow("auto")}}},getKeyMap:function(){if(!this.keyMap){this.keyMap=new Ext.KeyMap(this.el,this.keys)}return this.keyMap},initEvents:function(){if(this.keys){this.getKeyMap()}if(this.draggable){this.initDraggable()}if(this.toolbars.length>0){Ext.each(this.toolbars,function(tb){tb.doLayout();tb.on({scope:this,afterlayout:this.syncHeight,remove:this.syncHeight})},this);if(!this.ownerCt){this.syncHeight()}}},initDraggable:function(){this.dd=new Ext.Panel.DD(this,Ext.isBoolean(this.draggable)?null:this.draggable)},beforeEffect:function(anim){if(this.floating){this.el.beforeAction()}if(anim!==false){this.el.addClass("x-panel-animated")}},afterEffect:function(anim){this.syncShadow();if(anim!==false){this.el.removeClass("x-panel-animated")}},createEffect:function(a,cb,scope){var o={scope:scope,block:true};if(a===true){o.callback=cb;return o}else{if(!a.callback){o.callback=cb}else{o.callback=function(){cb.call(scope);Ext.callback(a.callback,a.scope)}}}return Ext.applyIf(o,a)},collapse:function(animate){if(this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforecollapse",this,animate)===false){return}var doAnim=animate===true||(animate!==false&&this.animCollapse);this.beforeEffect(doAnim);this.onCollapse(doAnim,animate);return this},onCollapse:function(doAnim,animArg){if(doAnim){this[this.collapseEl].slideOut(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterCollapse,this),this.collapseDefaults))}else{this[this.collapseEl].hide();this.afterCollapse(false)}},afterCollapse:function(anim){this.collapsed=true;this.el.addClass(this.collapsedCls);this.afterEffect(anim);this.fireEvent("collapse",this)},expand:function(animate){if(!this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforeexpand",this,animate)===false){return}var doAnim=animate===true||(animate!==false&&this.animCollapse);this.el.removeClass(this.collapsedCls);this.beforeEffect(doAnim);this.onExpand(doAnim,animate);return this},onExpand:function(doAnim,animArg){if(doAnim){this[this.collapseEl].slideIn(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterExpand,this),this.expandDefaults))}else{this[this.collapseEl].show();this.afterExpand(false)}},afterExpand:function(anim){this.collapsed=false;this.afterEffect(anim);if(Ext.isDefined(this.deferLayout)){this.doLayout(true)}this.fireEvent("expand",this)},toggleCollapse:function(animate){this[this.collapsed?"expand":"collapse"](animate);return this},onDisable:function(){if(this.rendered&&this.maskDisabled){this.el.mask()}Ext.Panel.superclass.onDisable.call(this)},onEnable:function(){if(this.rendered&&this.maskDisabled){this.el.unmask()}Ext.Panel.superclass.onEnable.call(this)},onResize:function(w,h){if(Ext.isDefined(w)||Ext.isDefined(h)){if(!this.collapsed){if(Ext.isNumber(w)){w=this.adjustBodyWidth(w-this.getFrameWidth());if(this.tbar){this.tbar.setWidth(w);if(this.topToolbar){this.topToolbar.setSize(w)}}if(this.bbar){this.bbar.setWidth(w);if(this.bottomToolbar){this.bottomToolbar.setSize(w)}}if(this.fbar){var f=this.fbar,fWidth=1,strict=Ext.isStrict;if(this.buttonAlign=="left"){fWidth=w-f.container.getFrameWidth("lr")}else{if(Ext.isIE||Ext.isWebKit){if(!(this.buttonAlign=="center"&&Ext.isWebKit)&&(!strict||(!Ext.isIE8&&strict))){(function(){f.setWidth(f.getEl().child(".x-toolbar-ct").getWidth())}).defer(1)}else{fWidth="auto"}}else{fWidth="auto"}}f.setWidth(fWidth)}this.body.setWidth(w)}else{if(w=="auto"){this.body.setWidth(w)}}if(Ext.isNumber(h)){h=Math.max(0,this.adjustBodyHeight(h-this.getFrameHeight()));this.body.setHeight(h)}else{if(h=="auto"){this.body.setHeight(h)}}if(this.disabled&&this.el._mask){this.el._mask.setSize(this.el.dom.clientWidth,this.el.getHeight())}}else{this.queuedBodySize={width:w,height:h};if(!this.queuedExpand&&this.allowQueuedExpand!==false){this.queuedExpand=true;this.on("expand",function(){delete this.queuedExpand;this.onResize(this.queuedBodySize.width,this.queuedBodySize.height);this.doLayout()},this,{single:true})}}this.onBodyResize(w,h)}this.syncShadow()},onBodyResize:function(w,h){this.fireEvent("bodyresize",this,w,h)},getToolbarHeight:function(){var h=0;if(this.rendered){Ext.each(this.toolbars,function(tb){h+=tb.getHeight()},this)}return h},adjustBodyHeight:function(h){return h},adjustBodyWidth:function(w){return w},onPosition:function(){this.syncShadow()},getFrameWidth:function(){var w=this.el.getFrameWidth("lr")+this.bwrap.getFrameWidth("lr");if(this.frame){var l=this.bwrap.dom.firstChild;w+=(Ext.fly(l).getFrameWidth("l")+Ext.fly(l.firstChild).getFrameWidth("r"));w+=this.mc.getFrameWidth("lr")}return w},getFrameHeight:function(){var h=this.el.getFrameWidth("tb")+this.bwrap.getFrameWidth("tb");h+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);if(this.frame){h+=this.el.dom.firstChild.offsetHeight+this.ft.dom.offsetHeight+this.mc.getFrameWidth("tb")}else{h+=(this.header?this.header.getHeight():0)+(this.footer?this.footer.getHeight():0)}return h},getInnerWidth:function(){return this.getSize().width-this.getFrameWidth()},getInnerHeight:function(){return this.getSize().height-this.getFrameHeight()},syncShadow:function(){if(this.floating){this.el.sync(true)}},getLayoutTarget:function(){return this.body},setTitle:function(title,iconCls){this.title=title;if(this.header&&this.headerAsText){this.header.child("span").update(title)}if(iconCls){this.setIconClass(iconCls)}this.fireEvent("titlechange",this,title);return this},getUpdater:function(){return this.body.getUpdater()},load:function(){var um=this.body.getUpdater();um.update.apply(um,arguments);return this},beforeDestroy:function(){if(this.header){this.header.removeAllListeners();if(this.headerAsText){Ext.Element.uncache(this.header.child("span"))}}Ext.Element.uncache(this.ft,this.mc,this.header,this.tbar,this.bbar,this.footer,this.body,this.bwrap);if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k])}}if(this.buttons){for(var b in this.buttons){Ext.destroy(this.buttons[b])}}if(this.rendered){Ext.destroy(this.toolbars)}else{Ext.destroy(this.topToolbar,this.bottomToolbar)}Ext.Panel.superclass.beforeDestroy.call(this)},createClasses:function(){this.headerCls=this.baseCls+"-header";this.headerTextCls=this.baseCls+"-header-text";this.bwrapCls=this.baseCls+"-bwrap";this.tbarCls=this.baseCls+"-tbar";this.bodyCls=this.baseCls+"-body";this.bbarCls=this.baseCls+"-bbar";this.footerCls=this.baseCls+"-footer"},createGhost:function(cls,useShim,appendTo){var el=document.createElement("div");el.className="x-panel-ghost "+(cls?cls:"");if(this.header){el.appendChild(this.el.dom.firstChild.cloneNode(true))}Ext.fly(el.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight());el.style.width=this.el.dom.offsetWidth+"px";if(!appendTo){this.container.dom.appendChild(el)}else{Ext.getDom(appendTo).appendChild(el)}if(useShim!==false&&this.el.useShim!==false){var layer=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},el);layer.show();return layer}else{return new Ext.Element(el)}},doAutoLoad:function(){var u=this.body.getUpdater();if(this.renderer){u.setRenderer(this.renderer)}u.update(Ext.isObject(this.autoLoad)?this.autoLoad:{url:this.autoLoad})},getTool:function(id){return this.tools[id]}});Ext.reg("panel",Ext.Panel);Ext.Editor=function(field,config){if(field.field){this.field=Ext.create(field.field,"textfield");config=Ext.apply({},field);delete config.field}else{this.field=field}Ext.Editor.superclass.constructor.call(this,config)};Ext.extend(Ext.Editor,Ext.Component,{value:"",alignment:"c-c?",shadow:"frame",constrain:false,swallowKeys:true,completeOnEnter:true,cancelOnEsc:true,updateEl:false,initComponent:function(){Ext.Editor.superclass.initComponent.call(this);this.addEvents("beforestartedit","startedit","beforecomplete","complete","canceledit","specialkey")},onRender:function(ct,position){this.el=new Ext.Layer({shadow:this.shadow,cls:"x-editor",parentEl:ct,shim:this.shim,shadowOffset:this.shadowOffset||4,id:this.id,constrain:this.constrain});if(this.zIndex){this.el.setZIndex(this.zIndex)}this.el.setStyle("overflow",Ext.isGecko?"auto":"hidden");if(this.field.msgTarget!="title"){this.field.msgTarget="qtip"}this.field.inEditor=true;this.mon(this.field,{scope:this,blur:this.onBlur,specialkey:this.onSpecialKey});if(this.field.grow){this.mon(this.field,"autosize",this.el.sync,this.el,{delay:1})}this.field.render(this.el).show();this.field.getEl().dom.name="";if(this.swallowKeys){this.field.el.swallowEvent(["keypress","keydown"])}},onSpecialKey:function(field,e){var key=e.getKey(),complete=this.completeOnEnter&&key==e.ENTER,cancel=this.cancelOnEsc&&key==e.ESC;if(complete||cancel){e.stopEvent();if(complete){this.completeEdit()}else{this.cancelEdit()}if(field.triggerBlur){field.triggerBlur()}}this.fireEvent("specialkey",field,e)},startEdit:function(el,value){if(this.editing){this.completeEdit()}this.boundEl=Ext.get(el);var v=value!==undefined?value:this.boundEl.dom.innerHTML;if(!this.rendered){this.render(this.parentEl||document.body)}if(this.fireEvent("beforestartedit",this,this.boundEl,v)!==false){this.startValue=v;this.field.setValue(v);this.doAutoSize();this.el.alignTo(this.boundEl,this.alignment);this.editing=true;this.show()}},doAutoSize:function(){if(this.autoSize){var sz=this.boundEl.getSize(),fs=this.field.getSize();switch(this.autoSize){case"width":this.setSize(sz.width,fs.height);break;case"height":this.setSize(fs.width,sz.height);break;case"none":this.setSize(fs.width,fs.height);break;default:this.setSize(sz.width,sz.height)}}},setSize:function(w,h){delete this.field.lastSize;this.field.setSize(w,h);if(this.el){if(Ext.isGecko2||Ext.isOpera){this.el.setSize(w,h)}this.el.sync()}},realign:function(){this.el.alignTo(this.boundEl,this.alignment)},completeEdit:function(remainVisible){if(!this.editing){return}var v=this.getValue();if(!this.field.isValid()){if(this.revertInvalid!==false){this.cancelEdit(remainVisible)}return}if(String(v)===String(this.startValue)&&this.ignoreNoChange){this.hideEdit(remainVisible);return}if(this.fireEvent("beforecomplete",this,v,this.startValue)!==false){v=this.getValue();if(this.updateEl&&this.boundEl){this.boundEl.update(v)}this.hideEdit(remainVisible);this.fireEvent("complete",this,v,this.startValue)}},onShow:function(){this.el.show();if(this.hideEl!==false){this.boundEl.hide()}this.field.show().focus(false,true);this.fireEvent("startedit",this.boundEl,this.startValue)},cancelEdit:function(remainVisible){if(this.editing){var v=this.getValue();this.setValue(this.startValue);this.hideEdit(remainVisible);this.fireEvent("canceledit",this,v,this.startValue)}},hideEdit:function(remainVisible){if(remainVisible!==true){this.editing=false;this.hide()}},onBlur:function(){if(this.allowBlur!==true&&this.editing){this.completeEdit()}},onHide:function(){if(this.editing){this.completeEdit();return}this.field.blur();if(this.field.collapse){this.field.collapse()}this.el.hide();if(this.hideEl!==false){this.boundEl.show()}},setValue:function(v){this.field.setValue(v)},getValue:function(){return this.field.getValue()},beforeDestroy:function(){Ext.destroy(this.field);this.field=null}});Ext.reg("editor",Ext.Editor);Ext.ColorPalette=function(config){Ext.ColorPalette.superclass.constructor.call(this,config);this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope,true)}};Ext.extend(Ext.ColorPalette,Ext.Component,{itemCls:"x-color-palette",value:null,clickEvent:"click",ctype:"Ext.ColorPalette",allowReselect:false,colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","969696","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"],onRender:function(container,position){var t=this.tpl||new Ext.XTemplate('<tpl for="."><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>');var el=document.createElement("div");el.id=this.getId();el.className=this.itemCls;t.overwrite(el,this.colors);container.dom.insertBefore(el,position);this.el=Ext.get(el);this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:"a"});if(this.clickEvent!="click"){this.mon(this.el,"click",Ext.emptyFn,this,{delegate:"a",preventDefault:true})}},afterRender:function(){Ext.ColorPalette.superclass.afterRender.call(this);if(this.value){var s=this.value;this.value=null;this.select(s)}},handleClick:function(e,t){e.preventDefault();if(!this.disabled){var c=t.className.match(/(?:^|\s)color-(.{6})(?:\s|$)/)[1];this.select(c.toUpperCase())}},select:function(color){color=color.replace("#","");if(color!=this.value||this.allowReselect){var el=this.el;if(this.value){el.child("a.color-"+this.value).removeClass("x-color-palette-sel")}el.child("a.color-"+color).addClass("x-color-palette-sel");this.value=color;this.fireEvent("select",this,color)}}});Ext.reg("colorpalette",Ext.ColorPalette);Ext.DatePicker=Ext.extend(Ext.BoxComponent,{todayText:"Today",okText:"&#160;OK&#160;",cancelText:"Cancel",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/d/y",disabledDaysText:"Disabled",disabledDatesText:"Disabled",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",startDay:0,showToday:true,initComponent:function(){Ext.DatePicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime(true):new Date().clearTime();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}this.initDisabledDays()},initDisabledDays:function(){if(!this.disabledDatesRE&&this.disabledDates){var dd=this.disabledDates,len=dd.length-1,re="(?:";Ext.each(dd,function(d,i){re+=Ext.isDate(d)?"^"+Ext.escapeRe(d.dateFormat(this.format))+"$":dd[i];if(i!=len){re+="|"}},this);this.disabledDatesRE=new RegExp(re+")")}},setDisabledDates:function(dd){if(Ext.isArray(dd)){this.disabledDates=dd;this.disabledDatesRE=null}else{this.disabledDatesRE=dd}this.initDisabledDays();this.update(this.value,true)},setDisabledDays:function(dd){this.disabledDays=dd;this.update(this.value,true)},setMinDate:function(dt){this.minDate=dt;this.update(this.value,true)},setMaxDate:function(dt){this.maxDate=dt;this.update(this.value,true)},setValue:function(value){this.value=value.clearTime(true);this.update(this.value)},getValue:function(){return this.value},focus:function(){this.update(this.activeDate)},onEnable:function(initial){Ext.DatePicker.superclass.onEnable.call(this);this.doDisabled(false);this.update(initial?this.value:this.activeDate);if(Ext.isIE){this.el.repaint()}},onDisable:function(){Ext.DatePicker.superclass.onDisable.call(this);this.doDisabled(true);if(Ext.isIE&&!Ext.isIE8){Ext.each([].concat(this.textNodes,this.el.query("th span")),function(el){Ext.fly(el).repaint()})}},doDisabled:function(disabled){this.keyNav.setDisabled(disabled);this.prevRepeater.setDisabled(disabled);this.nextRepeater.setDisabled(disabled);if(this.showToday){this.todayKeyListener.setDisabled(disabled);this.todayBtn.setDisabled(disabled)}},onRender:function(container,position){var m=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],dn=this.dayNames,i;for(i=0;i<7;i++){var d=this.startDay+i;if(d>6){d=d-7}m.push("<th><span>",dn[d].substr(0,1),"</span></th>")}m[m.length]="</tr></thead><tbody><tr>";for(i=0;i<42;i++){if(i%7===0&&i!==0){m[m.length]="</tr><tr>"}m[m.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'}m.push("</tr></tbody></table></td></tr>",this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':"",'</table><div class="x-date-mp"></div>');var el=document.createElement("div");el.className="x-date-picker";el.innerHTML=m.join("");container.dom.insertBefore(el,position);this.el=Ext.get(el);this.eventEl=Ext.get(el.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(e){if(e.ctrlKey){this.showPrevMonth()}else{this.update(this.activeDate.add("d",-1))}},right:function(e){if(e.ctrlKey){this.showNextMonth()}else{this.update(this.activeDate.add("d",1))}},up:function(e){if(e.ctrlKey){this.showNextYear()}else{this.update(this.activeDate.add("d",-7))}},down:function(e){if(e.ctrlKey){this.showPrevYear()}else{this.update(this.activeDate.add("d",7))}},pageUp:function(e){this.showNextMonth()},pageDown:function(e){this.showPrevMonth()},enter:function(e){e.stopPropagation();return true},scope:this});this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});this.mbtn.el.child("em").addClass("x-btn-arrow");if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var today=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,today),tooltip:String.format(this.todayTip,today),handler:this.selectToday,scope:this})}this.mon(this.eventEl,"mousewheel",this.handleMouseWheel,this);this.mon(this.eventEl,"click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.mon(this.mbtn,"click",this.showMonthPicker,this);this.onEnable(true)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var buf=['<table border="0" cellspacing="0">'];for(var i=0;i<6;i++){buf.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(i),"</a></td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(i+6),"</a></td>",i===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')}buf.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");this.monthPicker.update(buf.join(""));this.mon(this.monthPicker,"click",this.onMonthClick,this);this.mon(this.monthPicker,"dblclick",this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(m,a,i){i+=1;if((i%2)===0){m.dom.xmonth=5+Math.round(i*0.5)}else{m.dom.xmonth=Math.round((i-1)*0.5)}})}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();var size=this.el.getSize();this.monthPicker.setSize(size);this.monthPicker.child("table").setSize(size);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn("t",{duration:0.2})}},updateMPYear:function(y){this.mpyear=y;var ys=this.mpYears.elements;for(var i=1;i<=10;i++){var td=ys[i-1],y2;if((i%2)===0){y2=y+Math.round(i*0.5);td.firstChild.innerHTML=y2;td.xyear=y2}else{y2=y-(5-Math.round(i*0.5));td.firstChild.innerHTML=y2;td.xyear=y2}this.mpYears.item(i-1)[y2==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")}},updateMPMonth:function(sm){this.mpMonths.each(function(m,a,i){m[m.dom.xmonth==sm?"addClass":"removeClass"]("x-date-mp-sel")})},selectMPMonth:function(m){},onMonthClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if(el.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(el.is("button.x-date-mp-ok")){var d=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());if(d.getMonth()!=this.mpSelMonth){d=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(d);this.hideMonthPicker()}else{if((pn=el.up("td.x-date-mp-month",2))){this.mpMonths.removeClass("x-date-mp-sel");pn.addClass("x-date-mp-sel");this.mpSelMonth=pn.dom.xmonth}else{if((pn=el.up("td.x-date-mp-year",2))){this.mpYears.removeClass("x-date-mp-sel");pn.addClass("x-date-mp-sel");this.mpSelYear=pn.dom.xyear}else{if(el.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(el.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if((pn=el.up("td.x-date-mp-month",2))){this.update(new Date(this.mpSelYear,pn.dom.xmonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}else{if((pn=el.up("td.x-date-mp-year",2))){this.update(new Date(pn.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}}},hideMonthPicker:function(disableAnim){if(this.monthPicker){if(disableAnim===true){this.monthPicker.hide()}else{this.monthPicker.slideOut("t",{duration:0.2})}}},showPrevMonth:function(e){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(e){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},handleMouseWheel:function(e){e.stopEvent();if(!this.disabled){var delta=e.getWheelDelta();if(delta>0){this.showPrevMonth()}else{if(delta<0){this.showNextMonth()}}}},handleDateClick:function(e,t){e.stopEvent();if(!this.disabled&&t.dateValue&&!Ext.fly(t.parentNode).hasClass("x-date-disabled")){this.setValue(new Date(t.dateValue));this.fireEvent("select",this,this.value)}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date().clearTime());this.fireEvent("select",this,this.value)}},update:function(date,forceRefresh){if(this.rendered){var vd=this.activeDate,vis=this.isVisible();this.activeDate=date;if(!forceRefresh&&vd&&this.el){var t=date.getTime();if(vd.getMonth()==date.getMonth()&&vd.getFullYear()==date.getFullYear()){this.cells.removeClass("x-date-selected");this.cells.each(function(c){if(c.dom.firstChild.dateValue==t){c.addClass("x-date-selected");if(vis){Ext.fly(c.dom.firstChild).focus(50)}return false}});return}}var days=date.getDaysInMonth(),firstOfMonth=date.getFirstDateOfMonth(),startingPos=firstOfMonth.getDay()-this.startDay;if(startingPos<0){startingPos+=7}days+=startingPos;var pm=date.add("mo",-1),prevStart=pm.getDaysInMonth()-startingPos,cells=this.cells.elements,textEls=this.textNodes,day=86400000,d=(new Date(pm.getFullYear(),pm.getMonth(),prevStart)).clearTime(),today=new Date().clearTime().getTime(),sel=date.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(""):false,ddaysText=this.disabledDaysText,format=this.format;if(this.showToday){var td=new Date().clearTime(),disable=(td<min||td>max||(ddMatch&&format&&ddMatch.test(td.dateFormat(format)))||(ddays&&ddays.indexOf(td.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(disable);this.todayKeyListener[disable?"disable":"enable"]()}}var setCellClass=function(cal,cell){cell.title="";var t=d.getTime();cell.firstChild.dateValue=t;if(t==today){cell.className+=" x-date-today";cell.title=cal.todayText}if(t==sel){cell.className+=" x-date-selected";if(vis){Ext.fly(cell.firstChild).focus(50)}}if(t<min){cell.className=" x-date-disabled";cell.title=cal.minText;return}if(t>max){cell.className=" x-date-disabled";cell.title=cal.maxText;return}if(ddays){if(ddays.indexOf(d.getDay())!=-1){cell.title=ddaysText;cell.className=" x-date-disabled"}}if(ddMatch&&format){var fvalue=d.dateFormat(format);if(ddMatch.test(fvalue)){cell.title=ddText.replace("%0",fvalue);cell.className=" x-date-disabled"}}};var i=0;for(;i<startingPos;i++){textEls[i].innerHTML=(++prevStart);d.setDate(d.getDate()+1);cells[i].className="x-date-prevday";setCellClass(this,cells[i])}for(;i<days;i++){var intDay=i-startingPos+1;textEls[i].innerHTML=(intDay);d.setDate(d.getDate()+1);cells[i].className="x-date-active";setCellClass(this,cells[i])}var extraDays=0;for(;i<42;i++){textEls[i].innerHTML=(++extraDays);d.setDate(d.getDate()+1);cells[i].className="x-date-nextday";setCellClass(this,cells[i])}this.mbtn.setText(this.monthNames[date.getMonth()]+" "+date.getFullYear());if(!this.internalRender){var main=this.el.dom.firstChild,w=main.offsetWidth;this.el.setWidth(w+this.el.getBorderWidth("lr"));Ext.fly(main).setWidth(w);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){main.rows[0].cells[1].style.width=(w-(main.rows[0].cells[0].offsetWidth+main.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[date])}}}},beforeDestroy:function(){if(this.rendered){this.keyNav.disable();this.keyNav=null;Ext.destroy(this.leftClickRpt,this.rightClickRpt,this.monthPicker,this.eventEl,this.mbtn,this.todayBtn)}}});Ext.reg("datepicker",Ext.DatePicker);Ext.LoadMask=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(this.store){this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",this.onLoad,this);this.store.on("exception",this.onLoad,this);this.removeMask=Ext.value(this.removeMask,false)}else{var um=this.el.getUpdater();um.showLoadIndicator=false;um.on("beforeupdate",this.onBeforeLoad,this);um.on("update",this.onLoad,this);um.on("failure",this.onLoad,this);this.removeMask=Ext.value(this.removeMask,true)}};Ext.LoadMask.prototype={msg:"Loading...",msgCls:"x-mask-loading",disabled:false,disable:function(){this.disabled=true},enable:function(){this.disabled=false},onLoad:function(){this.el.unmask(this.removeMask)},onBeforeLoad:function(){if(!this.disabled){this.el.mask(this.msg,this.msgCls)}},show:function(){this.onBeforeLoad()},hide:function(){this.onLoad()},destroy:function(){if(this.store){this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("exception",this.onLoad,this)}else{var um=this.el.getUpdater();um.un("beforeupdate",this.onBeforeLoad,this);um.un("update",this.onLoad,this);um.un("failure",this.onLoad,this)}}};Ext.Slider=Ext.extend(Ext.BoxComponent,{vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,initComponent:function(){if(!Ext.isDefined(this.value)){this.value=this.minValue}Ext.Slider.superclass.initComponent.call(this);this.keyIncrement=Math.max(this.increment,this.keyIncrement);this.addEvents("beforechange","change","changecomplete","dragstart","drag","dragend");if(this.vertical){Ext.apply(this,Ext.Slider.Vertical)}},onRender:function(){this.autoEl={cls:"x-slider "+(this.vertical?"x-slider-vert":"x-slider-horz"),cn:{cls:"x-slider-end",cn:{cls:"x-slider-inner",cn:[{cls:"x-slider-thumb"},{tag:"a",cls:"x-slider-focus",href:"#",tabIndex:"-1",hidefocus:"on"}]}}};Ext.Slider.superclass.onRender.apply(this,arguments);this.endEl=this.el.first();this.innerEl=this.endEl.first();this.thumb=this.innerEl.first();this.halfThumb=(this.vertical?this.thumb.getHeight():this.thumb.getWidth())/2;this.focusEl=this.thumb.next();this.initEvents()},initEvents:function(){this.thumb.addClassOnOver("x-slider-thumb-over");this.mon(this.el,{scope:this,mousedown:this.onMouseDown,keydown:this.onKeyDown});this.focusEl.swallowEvent("click",true);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeDragStart.createDelegate(this),onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(this.thumb);this.on("beforedestroy",this.tracker.destroy,this.tracker)},onMouseDown:function(e){if(this.disabled){return}if(this.clickToChange&&e.target!=this.thumb.dom){var local=this.innerEl.translatePoints(e.getXY());this.onClickChange(local)}this.focus()},onClickChange:function(local){if(local.top>this.clickRange[0]&&local.top<this.clickRange[1]){this.setValue(Ext.util.Format.round(this.reverseValue(local.left),this.decimalPrecision),undefined,true)}},onKeyDown:function(e){if(this.disabled){e.preventDefault();return}var k=e.getKey();switch(k){case e.UP:case e.RIGHT:e.stopEvent();if(e.ctrlKey){this.setValue(this.maxValue,undefined,true)}else{this.setValue(this.value+this.keyIncrement,undefined,true)}break;case e.DOWN:case e.LEFT:e.stopEvent();if(e.ctrlKey){this.setValue(this.minValue,undefined,true)}else{this.setValue(this.value-this.keyIncrement,undefined,true)}break;default:e.preventDefault()}},doSnap:function(value){if(!this.increment||this.increment==1||!value){return value}var newValue=value,inc=this.increment;var m=value%inc;if(m!=0){newValue-=m;if(m*2>inc){newValue+=inc}else{if(m*2<-inc){newValue-=inc}}}return newValue.constrain(this.minValue,this.maxValue)},afterRender:function(){Ext.Slider.superclass.afterRender.apply(this,arguments);if(this.value!==undefined){var v=this.normalizeValue(this.value);if(v!==this.value){delete this.value;this.setValue(v,false)}else{this.moveThumb(this.translateValue(v),false)}}},getRatio:function(){var w=this.innerEl.getWidth();var v=this.maxValue-this.minValue;return v==0?w:(w/v)},normalizeValue:function(v){v=this.doSnap(v);v=Ext.util.Format.round(v,this.decimalPrecision);v=v.constrain(this.minValue,this.maxValue);return v},setValue:function(v,animate,changeComplete){v=this.normalizeValue(v);if(v!==this.value&&this.fireEvent("beforechange",this,v,this.value)!==false){this.value=v;this.moveThumb(this.translateValue(v),animate!==false);this.fireEvent("change",this,v);if(changeComplete){this.fireEvent("changecomplete",this,v)}}},translateValue:function(v){var ratio=this.getRatio();return(v*ratio)-(this.minValue*ratio)-this.halfThumb},reverseValue:function(pos){var ratio=this.getRatio();return(pos+this.halfThumb+(this.minValue*ratio))/ratio},moveThumb:function(v,animate){if(!animate||this.animate===false){this.thumb.setLeft(v)}else{this.thumb.shift({left:v,stopFx:true,duration:0.35})}},focus:function(){this.focusEl.focus(10)},onBeforeDragStart:function(e){return !this.disabled},onDragStart:function(e){this.thumb.addClass("x-slider-thumb-drag");this.dragging=true;this.dragStartValue=this.value;this.fireEvent("dragstart",this,e)},onDrag:function(e){var pos=this.innerEl.translatePoints(this.tracker.getXY());this.setValue(Ext.util.Format.round(this.reverseValue(pos.left),this.decimalPrecision),false);this.fireEvent("drag",this,e)},onDragEnd:function(e){this.thumb.removeClass("x-slider-thumb-drag");this.dragging=false;this.fireEvent("dragend",this,e);if(this.dragStartValue!=this.value){this.fireEvent("changecomplete",this,this.value)}},onResize:function(w,h){this.innerEl.setWidth(w-(this.el.getPadding("l")+this.endEl.getPadding("r")));this.syncThumb()},onDisable:function(){Ext.Slider.superclass.onDisable.call(this);this.thumb.addClass(this.disabledClass);if(Ext.isIE){var xy=this.thumb.getXY();this.thumb.hide();this.innerEl.addClass(this.disabledClass).dom.disabled=true;if(!this.thumbHolder){this.thumbHolder=this.endEl.createChild({cls:"x-slider-thumb "+this.disabledClass})}this.thumbHolder.show().setXY(xy)}},onEnable:function(){Ext.Slider.superclass.onEnable.call(this);this.thumb.removeClass(this.disabledClass);if(Ext.isIE){this.innerEl.removeClass(this.disabledClass).dom.disabled=false;if(this.thumbHolder){this.thumbHolder.hide()}this.thumb.show();this.syncThumb()}},syncThumb:function(){if(this.rendered){this.moveThumb(this.translateValue(this.value))}},getValue:function(){return this.value}});Ext.reg("slider",Ext.Slider);Ext.Slider.Vertical={onResize:function(w,h){this.innerEl.setHeight(h-(this.el.getPadding("t")+this.endEl.getPadding("b")));this.syncThumb()},getRatio:function(){var h=this.innerEl.getHeight();var v=this.maxValue-this.minValue;return h/v},moveThumb:function(v,animate){if(!animate||this.animate===false){this.thumb.setBottom(v)}else{this.thumb.shift({bottom:v,stopFx:true,duration:0.35})}},onDrag:function(e){var pos=this.innerEl.translatePoints(this.tracker.getXY());var bottom=this.innerEl.getHeight()-pos.top;this.setValue(this.minValue+Ext.util.Format.round(bottom/this.getRatio(),this.decimalPrecision),false);this.fireEvent("drag",this,e)},onClickChange:function(local){if(local.left>this.clickRange[0]&&local.left<this.clickRange[1]){var bottom=this.innerEl.getHeight()-local.top;this.setValue(this.minValue+Ext.util.Format.round(bottom/this.getRatio(),this.decimalPrecision),undefined,true)}}};Ext.ProgressBar=Ext.extend(Ext.BoxComponent,{baseCls:"x-progress",animate:false,waitTimer:null,initComponent:function(){Ext.ProgressBar.superclass.initComponent.call(this);this.addEvents("update")},onRender:function(ct,position){var tpl=new Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">',"<div>&#160;</div>","</div>","</div>",'<div class="{cls}-text {cls}-text-back">',"<div>&#160;</div>","</div>","</div>","</div>");this.el=position?tpl.insertBefore(position,{cls:this.baseCls},true):tpl.append(ct,{cls:this.baseCls},true);if(this.id){this.el.dom.id=this.id}var inner=this.el.dom.firstChild;this.progressBar=Ext.get(inner.firstChild);if(this.textEl){this.textEl=Ext.get(this.textEl);delete this.textTopEl}else{this.textTopEl=Ext.get(this.progressBar.dom.firstChild);var textBackEl=Ext.get(inner.childNodes[1]);this.textTopEl.setStyle("z-index",99).addClass("x-hidden");this.textEl=new Ext.CompositeElement([this.textTopEl.dom.firstChild,textBackEl.dom.firstChild]);this.textEl.setWidth(inner.offsetWidth)}this.progressBar.setHeight(inner.offsetHeight)},afterRender:function(){Ext.ProgressBar.superclass.afterRender.call(this);if(this.value){this.updateProgress(this.value,this.text)}else{this.updateText(this.text)}},updateProgress:function(value,text,animate){this.value=value||0;if(text){this.updateText(text)}if(this.rendered){var w=Math.floor(value*this.el.dom.firstChild.offsetWidth);this.progressBar.setWidth(w,animate===true||(animate!==false&&this.animate));if(this.textTopEl){this.textTopEl.removeClass("x-hidden").setWidth(w)}}this.fireEvent("update",this,value,text);return this},wait:function(o){if(!this.waitTimer){var scope=this;o=o||{};this.updateText(o.text);this.waitTimer=Ext.TaskMgr.start({run:function(i){var inc=o.increment||10;i-=1;this.updateProgress(((((i+inc)%inc)+1)*(100/inc))*0.01,null,o.animate)},interval:o.interval||1000,duration:o.duration,onStop:function(){if(o.fn){o.fn.apply(o.scope||this)}this.reset()},scope:scope})}return this},isWaiting:function(){return this.waitTimer!==null},updateText:function(text){this.text=text||"&#160;";if(this.rendered){this.textEl.update(this.text)}return this},syncProgressBar:function(){if(this.value){this.updateProgress(this.value,this.text)}return this},setSize:function(w,h){Ext.ProgressBar.superclass.setSize.call(this,w,h);if(this.textTopEl){var inner=this.el.dom.firstChild;this.textEl.setSize(inner.offsetWidth,inner.offsetHeight)}this.syncProgressBar();return this},reset:function(hide){this.updateProgress(0);if(this.textTopEl){this.textTopEl.addClass("x-hidden")}if(this.waitTimer){this.waitTimer.onStop=null;Ext.TaskMgr.stop(this.waitTimer);this.waitTimer=null}if(hide===true){this.hide()}return this}});Ext.reg("progress",Ext.ProgressBar);(function(){var Event=Ext.EventManager;var Dom=Ext.lib.Dom;Ext.dd.DragDrop=function(id,sGroup,config){if(id){this.init(id,sGroup,config)}};Ext.dd.DragDrop.prototype={id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true},moveOnly:false,unlock:function(){this.locked=false},isTarget:true,padding:null,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,b4StartDrag:function(x,y){},startDrag:function(x,y){},b4Drag:function(e){},onDrag:function(e){},onDragEnter:function(e,id){},b4DragOver:function(e){},onDragOver:function(e,id){},b4DragOut:function(e){},onDragOut:function(e,id){},b4DragDrop:function(e){},onDragDrop:function(e,id){},onInvalidDrop:function(e){},b4EndDrag:function(e){},endDrag:function(e){},b4MouseDown:function(e){},onMouseDown:function(e){},onMouseUp:function(e){},onAvailable:function(){},defaultPadding:{left:0,right:0,top:0,bottom:0},constrainTo:function(constrainTo,pad,inContent){if(typeof pad=="number"){pad={left:pad,right:pad,top:pad,bottom:pad}}pad=pad||this.defaultPadding;var b=Ext.get(this.getEl()).getBox();var ce=Ext.get(constrainTo);var s=ce.getScroll();var c,cd=ce.dom;if(cd==document.body){c={x:s.left,y:s.top,width:Ext.lib.Dom.getViewWidth(),height:Ext.lib.Dom.getViewHeight()}}else{var xy=ce.getXY();c={x:xy[0],y:xy[1],width:cd.clientWidth,height:cd.clientHeight}}var topSpace=b.y-c.y;var leftSpace=b.x-c.x;this.resetConstraints();this.setXConstraint(leftSpace-(pad.left||0),c.width-leftSpace-b.width-(pad.right||0),this.xTickSize);this.setYConstraint(topSpace-(pad.top||0),c.height-topSpace-b.height-(pad.bottom||0),this.yTickSize)},getEl:function(){if(!this._domRef){this._domRef=Ext.getDom(this.id)}return this._domRef},getDragEl:function(){return Ext.getDom(this.dragElId)},init:function(id,sGroup,config){this.initTarget(id,sGroup,config);Event.on(this.id,"mousedown",this.handleMouseDown,this)},initTarget:function(id,sGroup,config){this.config=config||{};this.DDM=Ext.dd.DDM;this.groups={};if(typeof id!=="string"){id=Ext.id(id)}this.id=id;this.addToGroup((sGroup)?sGroup:"default");this.handleElId=id;this.setDragElId(id);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();this.handleOnAvailable()},applyConfig:function(){this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false)},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable()},setPadding:function(iTop,iRight,iBot,iLeft){if(!iRight&&0!==iRight){this.padding=[iTop,iTop,iTop,iTop]}else{if(!iBot&&0!==iBot){this.padding=[iTop,iRight,iTop,iRight]}else{this.padding=[iTop,iRight,iBot,iLeft]}}},setInitPosition:function(diffX,diffY){var el=this.getEl();if(!this.DDM.verifyEl(el)){return}var dx=diffX||0;var dy=diffY||0;var p=Dom.getXY(el);this.initPageX=p[0]-dx;this.initPageY=p[1]-dy;this.lastPageX=p[0];this.lastPageY=p[1];this.setStartPosition(p)},setStartPosition:function(pos){var p=pos||Dom.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=p[0];this.startPageY=p[1]},addToGroup:function(sGroup){this.groups[sGroup]=true;this.DDM.regDragDrop(this,sGroup)},removeFromGroup:function(sGroup){if(this.groups[sGroup]){delete this.groups[sGroup]}this.DDM.removeDDFromGroup(this,sGroup)},setDragElId:function(id){this.dragElId=id},setHandleElId:function(id){if(typeof id!=="string"){id=Ext.id(id)}this.handleElId=id;this.DDM.regHandle(this.id,id)},setOuterHandleElId:function(id){if(typeof id!=="string"){id=Ext.id(id)}Event.on(id,"mousedown",this.handleMouseDown,this);this.setHandleElId(id);this.hasOuterHandles=true},unreg:function(){Event.un(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this)},destroy:function(){this.unreg()},isLocked:function(){return(this.DDM.isLocked()||this.locked)},handleMouseDown:function(e,oDD){if(this.primaryButtonOnly&&e.button!=0){return}if(this.isLocked()){return}this.DDM.refreshCache(this.groups);var pt=new Ext.lib.Point(Ext.lib.Event.getPageX(e),Ext.lib.Event.getPageY(e));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(pt,this)){}else{if(this.clickValidator(e)){this.setStartPosition();this.b4MouseDown(e);this.onMouseDown(e);this.DDM.handleMouseDown(e,this);this.DDM.stopEvent(e)}else{}}},clickValidator:function(e){var target=e.getTarget();return(this.isValidHandleChild(target)&&(this.id==this.handleElId||this.DDM.handleWasClicked(target,this.id)))},addInvalidHandleType:function(tagName){var type=tagName.toUpperCase();this.invalidHandleTypes[type]=type},addInvalidHandleId:function(id){if(typeof id!=="string"){id=Ext.id(id)}this.invalidHandleIds[id]=id},addInvalidHandleClass:function(cssClass){this.invalidHandleClasses.push(cssClass)},removeInvalidHandleType:function(tagName){var type=tagName.toUpperCase();delete this.invalidHandleTypes[type]},removeInvalidHandleId:function(id){if(typeof id!=="string"){id=Ext.id(id)}delete this.invalidHandleIds[id]},removeInvalidHandleClass:function(cssClass){for(var i=0,len=this.invalidHandleClasses.length;i<len;++i){if(this.invalidHandleClasses[i]==cssClass){delete this.invalidHandleClasses[i]}}},isValidHandleChild:function(node){var valid=true;var nodeName;try{nodeName=node.nodeName.toUpperCase()}catch(e){nodeName=node.nodeName}valid=valid&&!this.invalidHandleTypes[nodeName];valid=valid&&!this.invalidHandleIds[node.id];for(var i=0,len=this.invalidHandleClasses.length;valid&&i<len;++i){valid=!Ext.fly(node).hasClass(this.invalidHandleClasses[i])}return valid},setXTicks:function(iStartX,iTickSize){this.xTicks=[];this.xTickSize=iTickSize;var tickMap={};for(var i=this.initPageX;i>=this.minX;i=i-iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true}}for(i=this.initPageX;i<=this.maxX;i=i+iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true}}this.xTicks.sort(this.DDM.numericSort)},setYTicks:function(iStartY,iTickSize){this.yTicks=[];this.yTickSize=iTickSize;var tickMap={};for(var i=this.initPageY;i>=this.minY;i=i-iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true}}for(i=this.initPageY;i<=this.maxY;i=i+iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true}}this.yTicks.sort(this.DDM.numericSort)},setXConstraint:function(iLeft,iRight,iTickSize){this.leftConstraint=iLeft;this.rightConstraint=iRight;this.minX=this.initPageX-iLeft;this.maxX=this.initPageX+iRight;if(iTickSize){this.setXTicks(this.initPageX,iTickSize)}this.constrainX=true},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks()},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0},setYConstraint:function(iUp,iDown,iTickSize){this.topConstraint=iUp;this.bottomConstraint=iDown;this.minY=this.initPageY-iUp;this.maxY=this.initPageY+iDown;if(iTickSize){this.setYTicks(this.initPageY,iTickSize)}this.constrainY=true},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var dx=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var dy=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(dx,dy)}else{this.setInitPosition()}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize)}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)}},getTick:function(val,tickArray){if(!tickArray){return val}else{if(tickArray[0]>=val){return tickArray[0]}else{for(var i=0,len=tickArray.length;i<len;++i){var next=i+1;if(tickArray[next]&&tickArray[next]>=val){var diff1=val-tickArray[i];var diff2=tickArray[next]-val;return(diff2>diff1)?tickArray[i]:tickArray[next]}}return tickArray[tickArray.length-1]}}},toString:function(){return("DragDrop "+this.id)}}})();if(!Ext.dd.DragDropMgr){Ext.dd.DragDropMgr=function(){var Event=Ext.EventManager;return{ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,init:function(){this.initialized=true},POINT:0,INTERSECT:1,mode:0,_execOnAll:function(sMethod,args){for(var i in this.ids){for(var j in this.ids[i]){var oDD=this.ids[i][j];if(!this.isTypeOfDD(oDD)){continue}oDD[sMethod].apply(oDD,args)}}},_onLoad:function(){this.init();Event.on(document,"mouseup",this.handleMouseUp,this,true);Event.on(document,"mousemove",this.handleMouseMove,this,true);Event.on(window,"unload",this._onUnload,this,true);Event.on(window,"resize",this._onResize,this,true)},_onResize:function(e){this._execOnAll("resetConstraints",[])},lock:function(){this.locked=true},unlock:function(){this.locked=false},isLocked:function(){return this.locked},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:350,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,regDragDrop:function(oDD,sGroup){if(!this.initialized){this.init()}if(!this.ids[sGroup]){this.ids[sGroup]={}}this.ids[sGroup][oDD.id]=oDD},removeDDFromGroup:function(oDD,sGroup){if(!this.ids[sGroup]){this.ids[sGroup]={}}var obj=this.ids[sGroup];if(obj&&obj[oDD.id]){delete obj[oDD.id]}},_remove:function(oDD){for(var g in oDD.groups){if(g&&this.ids[g]&&this.ids[g][oDD.id]){delete this.ids[g][oDD.id]}}delete this.handleIds[oDD.id]},regHandle:function(sDDId,sHandleId){if(!this.handleIds[sDDId]){this.handleIds[sDDId]={}}this.handleIds[sDDId][sHandleId]=sHandleId},isDragDrop:function(id){return(this.getDDById(id))?true:false},getRelated:function(p_oDD,bTargetsOnly){var oDDs=[];for(var i in p_oDD.groups){for(var j in this.ids[i]){var dd=this.ids[i][j];if(!this.isTypeOfDD(dd)){continue}if(!bTargetsOnly||dd.isTarget){oDDs[oDDs.length]=dd}}}return oDDs},isLegalTarget:function(oDD,oTargetDD){var targets=this.getRelated(oDD,true);for(var i=0,len=targets.length;i<len;++i){if(targets[i].id==oTargetDD.id){return true}}return false},isTypeOfDD:function(oDD){return(oDD&&oDD.__ygDragDrop)},isHandle:function(sDDId,sHandleId){return(this.handleIds[sDDId]&&this.handleIds[sDDId][sHandleId])},getDDById:function(id){for(var i in this.ids){if(this.ids[i][id]){return this.ids[i][id]}}return null},handleMouseDown:function(e,oDD){if(Ext.QuickTips){Ext.QuickTips.disable()}if(this.dragCurrent){this.handleMouseUp(e)}this.currentTarget=e.getTarget();this.dragCurrent=oDD;var el=oDD.getEl();this.startX=e.getPageX();this.startY=e.getPageY();this.deltaX=this.startX-el.offsetLeft;this.deltaY=this.startY-el.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var DDM=Ext.dd.DDM;DDM.startDrag(DDM.startX,DDM.startY)},this.clickTimeThresh)},startDrag:function(x,y){clearTimeout(this.clickTimeout);if(this.dragCurrent){this.dragCurrent.b4StartDrag(x,y);this.dragCurrent.startDrag(x,y)}this.dragThreshMet=true},handleMouseUp:function(e){if(Ext.QuickTips){Ext.QuickTips.enable()}if(!this.dragCurrent){return}clearTimeout(this.clickTimeout);if(this.dragThreshMet){this.fireEvents(e,true)}else{}this.stopDrag(e);this.stopEvent(e)},stopEvent:function(e){if(this.stopPropagation){e.stopPropagation()}if(this.preventDefault){e.preventDefault()}},stopDrag:function(e){if(this.dragCurrent){if(this.dragThreshMet){this.dragCurrent.b4EndDrag(e);this.dragCurrent.endDrag(e)}this.dragCurrent.onMouseUp(e)}this.dragCurrent=null;this.dragOvers={}},handleMouseMove:function(e){if(!this.dragCurrent){return true}if(Ext.isIE&&(e.button!==0&&e.button!==1&&e.button!==2)){this.stopEvent(e);return this.handleMouseUp(e)}if(!this.dragThreshMet){var diffX=Math.abs(this.startX-e.getPageX());var diffY=Math.abs(this.startY-e.getPageY());if(diffX>this.clickPixelThresh||diffY>this.clickPixelThresh){this.startDrag(this.startX,this.startY)}}if(this.dragThreshMet){this.dragCurrent.b4Drag(e);this.dragCurrent.onDrag(e);if(!this.dragCurrent.moveOnly){this.fireEvents(e,false)}}this.stopEvent(e);return true},fireEvents:function(e,isDrop){var dc=this.dragCurrent;if(!dc||dc.isLocked()){return}var pt=e.getPoint();var oldOvers=[];var outEvts=[];var overEvts=[];var dropEvts=[];var enterEvts=[];for(var i in this.dragOvers){var ddo=this.dragOvers[i];if(!this.isTypeOfDD(ddo)){continue}if(!this.isOverTarget(pt,ddo,this.mode)){outEvts.push(ddo)}oldOvers[i]=true;delete this.dragOvers[i]}for(var sGroup in dc.groups){if("string"!=typeof sGroup){continue}for(i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(!this.isTypeOfDD(oDD)){continue}if(oDD.isTarget&&!oDD.isLocked()&&((oDD!=dc)||(dc.ignoreSelf===false))){if(this.isOverTarget(pt,oDD,this.mode)){if(isDrop){dropEvts.push(oDD)}else{if(!oldOvers[oDD.id]){enterEvts.push(oDD)}else{overEvts.push(oDD)}this.dragOvers[oDD.id]=oDD}}}}}if(this.mode){if(outEvts.length){dc.b4DragOut(e,outEvts);dc.onDragOut(e,outEvts)}if(enterEvts.length){dc.onDragEnter(e,enterEvts)}if(overEvts.length){dc.b4DragOver(e,overEvts);dc.onDragOver(e,overEvts)}if(dropEvts.length){dc.b4DragDrop(e,dropEvts);dc.onDragDrop(e,dropEvts)}}else{var len=0;for(i=0,len=outEvts.length;i<len;++i){dc.b4DragOut(e,outEvts[i].id);dc.onDragOut(e,outEvts[i].id)}for(i=0,len=enterEvts.length;i<len;++i){dc.onDragEnter(e,enterEvts[i].id)}for(i=0,len=overEvts.length;i<len;++i){dc.b4DragOver(e,overEvts[i].id);dc.onDragOver(e,overEvts[i].id)}for(i=0,len=dropEvts.length;i<len;++i){dc.b4DragDrop(e,dropEvts[i].id);dc.onDragDrop(e,dropEvts[i].id)}}if(isDrop&&!dropEvts.length){dc.onInvalidDrop(e)}},getBestMatch:function(dds){var winner=null;var len=dds.length;if(len==1){winner=dds[0]}else{for(var i=0;i<len;++i){var dd=dds[i];if(dd.cursorIsOver){winner=dd;break}else{if(!winner||winner.overlap.getArea()<dd.overlap.getArea()){winner=dd}}}}return winner},refreshCache:function(groups){for(var sGroup in groups){if("string"!=typeof sGroup){continue}for(var i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(this.isTypeOfDD(oDD)){var loc=this.getLocation(oDD);if(loc){this.locationCache[oDD.id]=loc}else{delete this.locationCache[oDD.id]}}}}},verifyEl:function(el){if(el){var parent;if(Ext.isIE){try{parent=el.offsetParent}catch(e){}}else{parent=el.offsetParent}if(parent){return true}}return false},getLocation:function(oDD){if(!this.isTypeOfDD(oDD)){return null}var el=oDD.getEl(),pos,x1,x2,y1,y2,t,r,b,l;try{pos=Ext.lib.Dom.getXY(el)}catch(e){}if(!pos){return null}x1=pos[0];x2=x1+el.offsetWidth;y1=pos[1];y2=y1+el.offsetHeight;t=y1-oDD.padding[0];r=x2+oDD.padding[1];b=y2+oDD.padding[2];l=x1-oDD.padding[3];return new Ext.lib.Region(t,r,b,l)},isOverTarget:function(pt,oTarget,intersect){var loc=this.locationCache[oTarget.id];if(!loc||!this.useCache){loc=this.getLocation(oTarget);this.locationCache[oTarget.id]=loc}if(!loc){return false}oTarget.cursorIsOver=loc.contains(pt);var dc=this.dragCurrent;if(!dc||!dc.getTargetCoord||(!intersect&&!dc.constrainX&&!dc.constrainY)){return oTarget.cursorIsOver}oTarget.overlap=null;var pos=dc.getTargetCoord(pt.x,pt.y);var el=dc.getDragEl();var curRegion=new Ext.lib.Region(pos.y,pos.x+el.offsetWidth,pos.y+el.offsetHeight,pos.x);var overlap=curRegion.intersect(loc);if(overlap){oTarget.overlap=overlap;return(intersect)?true:oTarget.cursorIsOver}else{return false}},_onUnload:function(e,me){Ext.dd.DragDropMgr.unregAll()},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null}this._execOnAll("unreg",[]);for(var i in this.elementCache){delete this.elementCache[i]}this.elementCache={};this.ids={}},elementCache:{},getElWrapper:function(id){var oWrapper=this.elementCache[id];if(!oWrapper||!oWrapper.el){oWrapper=this.elementCache[id]=new this.ElementWrapper(Ext.getDom(id))}return oWrapper},getElement:function(id){return Ext.getDom(id)},getCss:function(id){var el=Ext.getDom(id);return(el)?el.style:null},ElementWrapper:function(el){this.el=el||null;this.id=this.el&&el.id;this.css=this.el&&el.style},getPosX:function(el){return Ext.lib.Dom.getX(el)},getPosY:function(el){return Ext.lib.Dom.getY(el)},swapNode:function(n1,n2){if(n1.swapNode){n1.swapNode(n2)}else{var p=n2.parentNode;var s=n2.nextSibling;if(s==n1){p.insertBefore(n1,n2)}else{if(n2==n1.nextSibling){p.insertBefore(n2,n1)}else{n1.parentNode.replaceChild(n2,n1);p.insertBefore(n1,s)}}}},getScroll:function(){var t,l,dde=document.documentElement,db=document.body;if(dde&&(dde.scrollTop||dde.scrollLeft)){t=dde.scrollTop;l=dde.scrollLeft}else{if(db){t=db.scrollTop;l=db.scrollLeft}else{}}return{top:t,left:l}},getStyle:function(el,styleProp){return Ext.fly(el).getStyle(styleProp)},getScrollTop:function(){return this.getScroll().top},getScrollLeft:function(){return this.getScroll().left},moveToEl:function(moveEl,targetEl){var aCoord=Ext.lib.Dom.getXY(targetEl);Ext.lib.Dom.setXY(moveEl,aCoord)},numericSort:function(a,b){return(a-b)},_timeoutCount:0,_addListeners:function(){var DDM=Ext.dd.DDM;if(Ext.lib.Event&&document){DDM._onLoad()}else{if(DDM._timeoutCount>2000){}else{setTimeout(DDM._addListeners,10);if(document&&document.body){DDM._timeoutCount+=1}}}},handleWasClicked:function(node,id){if(this.isHandle(id,node.id)){return true}else{var p=node.parentNode;while(p){if(this.isHandle(id,p.id)){return true}else{p=p.parentNode}}}return false}}}();Ext.dd.DDM=Ext.dd.DragDropMgr;Ext.dd.DDM._addListeners()}Ext.dd.DD=function(id,sGroup,config){if(id){this.init(id,sGroup,config)}};Ext.extend(Ext.dd.DD,Ext.dd.DragDrop,{scroll:true,autoOffset:function(iPageX,iPageY){var x=iPageX-this.startPageX;var y=iPageY-this.startPageY;this.setDelta(x,y)},setDelta:function(iDeltaX,iDeltaY){this.deltaX=iDeltaX;this.deltaY=iDeltaY},setDragElPos:function(iPageX,iPageY){var el=this.getDragEl();this.alignElWithMouse(el,iPageX,iPageY)},alignElWithMouse:function(el,iPageX,iPageY){var oCoord=this.getTargetCoord(iPageX,iPageY);var fly=el.dom?el:Ext.fly(el,"_dd");if(!this.deltaSetXY){var aCoord=[oCoord.x,oCoord.y];fly.setXY(aCoord);var newLeft=fly.getLeft(true);var newTop=fly.getTop(true);this.deltaSetXY=[newLeft-oCoord.x,newTop-oCoord.y]}else{fly.setLeftTop(oCoord.x+this.deltaSetXY[0],oCoord.y+this.deltaSetXY[1])}this.cachePosition(oCoord.x,oCoord.y);this.autoScroll(oCoord.x,oCoord.y,el.offsetHeight,el.offsetWidth);return oCoord},cachePosition:function(iPageX,iPageY){if(iPageX){this.lastPageX=iPageX;this.lastPageY=iPageY}else{var aCoord=Ext.lib.Dom.getXY(this.getEl());this.lastPageX=aCoord[0];this.lastPageY=aCoord[1]}},autoScroll:function(x,y,h,w){if(this.scroll){var clientH=Ext.lib.Dom.getViewHeight();var clientW=Ext.lib.Dom.getViewWidth();var st=this.DDM.getScrollTop();var sl=this.DDM.getScrollLeft();var bot=h+y;var right=w+x;var toBot=(clientH+st-y-this.deltaY);var toRight=(clientW+sl-x-this.deltaX);var thresh=40;var scrAmt=(document.all)?80:30;if(bot>clientH&&toBot<thresh){window.scrollTo(sl,st+scrAmt)}if(y<st&&st>0&&y-st<thresh){window.scrollTo(sl,st-scrAmt)}if(right>clientW&&toRight<thresh){window.scrollTo(sl+scrAmt,st)}if(x<sl&&sl>0&&x-sl<thresh){window.scrollTo(sl-scrAmt,st)}}},getTargetCoord:function(iPageX,iPageY){var x=iPageX-this.deltaX;var y=iPageY-this.deltaY;if(this.constrainX){if(x<this.minX){x=this.minX}if(x>this.maxX){x=this.maxX}}if(this.constrainY){if(y<this.minY){y=this.minY}if(y>this.maxY){y=this.maxY}}x=this.getTick(x,this.xTicks);y=this.getTick(y,this.yTicks);return{x:x,y:y}},applyConfig:function(){Ext.dd.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false)},b4MouseDown:function(e){this.autoOffset(e.getPageX(),e.getPageY())},b4Drag:function(e){this.setDragElPos(e.getPageX(),e.getPageY())},toString:function(){return("DD "+this.id)}});Ext.dd.DDProxy=function(id,sGroup,config){if(id){this.init(id,sGroup,config);this.initFrame()}};Ext.dd.DDProxy.dragElId="ygddfdiv";Ext.extend(Ext.dd.DDProxy,Ext.dd.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var self=this;var body=document.body;if(!body||!body.firstChild){setTimeout(function(){self.createFrame()},50);return}var div=this.getDragEl();if(!div){div=document.createElement("div");div.id=this.dragElId;var s=div.style;s.position="absolute";s.visibility="hidden";s.cursor="move";s.border="2px solid #aaa";s.zIndex=999;body.insertBefore(div,body.firstChild)}},initFrame:function(){this.createFrame()},applyConfig:function(){Ext.dd.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||Ext.dd.DDProxy.dragElId)},showFrame:function(iPageX,iPageY){var el=this.getEl();var dragEl=this.getDragEl();var s=dragEl.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(s.width,10)/2),Math.round(parseInt(s.height,10)/2))}this.setDragElPos(iPageX,iPageY);Ext.fly(dragEl).show()},_resizeProxy:function(){if(this.resizeFrame){var el=this.getEl();Ext.fly(this.getDragEl()).setSize(el.offsetWidth,el.offsetHeight)}},b4MouseDown:function(e){var x=e.getPageX();var y=e.getPageY();this.autoOffset(x,y);this.setDragElPos(x,y)},b4StartDrag:function(x,y){this.showFrame(x,y)},b4EndDrag:function(e){Ext.fly(this.getDragEl()).hide()},endDrag:function(e){var lel=this.getEl();var del=this.getDragEl();del.style.visibility="";this.beforeMove();lel.style.visibility="hidden";Ext.dd.DDM.moveToEl(lel,del);del.style.visibility="hidden";lel.style.visibility="";this.afterDrag()},beforeMove:function(){},afterDrag:function(){},toString:function(){return("DDProxy "+this.id)}});Ext.dd.DDTarget=function(id,sGroup,config){if(id){this.initTarget(id,sGroup,config)}};Ext.extend(Ext.dd.DDTarget,Ext.dd.DragDrop,{toString:function(){return("DDTarget "+this.id)}});Ext.dd.DragTracker=function(config){Ext.apply(this,config);this.addEvents("mousedown","mouseup","mousemove","dragstart","dragend","drag");this.dragRegion=new Ext.lib.Region(0,0,0,0);if(this.el){this.initEl(this.el)}};Ext.extend(Ext.dd.DragTracker,Ext.util.Observable,{active:false,tolerance:5,autoStart:false,initEl:function(el){this.el=Ext.get(el);el.on("mousedown",this.onMouseDown,this,this.delegate?{delegate:this.delegate}:undefined)},destroy:function(){this.el.un("mousedown",this.onMouseDown,this)},onMouseDown:function(e,target){if(this.fireEvent("mousedown",this,e)!==false&&this.onBeforeStart(e)!==false){this.startXY=this.lastXY=e.getXY();this.dragTarget=this.delegate?target:this.el.dom;if(this.preventDefault!==false){e.preventDefault()}var doc=Ext.getDoc();doc.on("mouseup",this.onMouseUp,this);doc.on("mousemove",this.onMouseMove,this);doc.on("selectstart",this.stopSelect,this);if(this.autoStart){this.timer=this.triggerStart.defer(this.autoStart===true?1000:this.autoStart,this)}}},onMouseMove:function(e,target){if(this.active&&Ext.isIE&&!e.browserEvent.button){e.preventDefault();this.onMouseUp(e);return}e.preventDefault();var xy=e.getXY(),s=this.startXY;this.lastXY=xy;if(!this.active){if(Math.abs(s[0]-xy[0])>this.tolerance||Math.abs(s[1]-xy[1])>this.tolerance){this.triggerStart()}else{return}}this.fireEvent("mousemove",this,e);this.onDrag(e);this.fireEvent("drag",this,e)},onMouseUp:function(e){var doc=Ext.getDoc();doc.un("mousemove",this.onMouseMove,this);doc.un("mouseup",this.onMouseUp,this);doc.un("selectstart",this.stopSelect,this);e.preventDefault();this.clearStart();var wasActive=this.active;this.active=false;delete this.elRegion;this.fireEvent("mouseup",this,e);if(wasActive){this.onEnd(e);this.fireEvent("dragend",this,e)}},triggerStart:function(isTimer){this.clearStart();this.active=true;this.onStart(this.startXY);this.fireEvent("dragstart",this,this.startXY)},clearStart:function(){if(this.timer){clearTimeout(this.timer);delete this.timer}},stopSelect:function(e){e.stopEvent();return false},onBeforeStart:function(e){},onStart:function(xy){},onDrag:function(e){},onEnd:function(e){},getDragTarget:function(){return this.dragTarget},getDragCt:function(){return this.el},getXY:function(constrain){return constrain?this.constrainModes[constrain].call(this,this.lastXY):this.lastXY},getOffset:function(constrain){var xy=this.getXY(constrain);var s=this.startXY;return[s[0]-xy[0],s[1]-xy[1]]},constrainModes:{point:function(xy){if(!this.elRegion){this.elRegion=this.getDragCt().getRegion()}var dr=this.dragRegion;dr.left=xy[0];dr.top=xy[1];dr.right=xy[0];dr.bottom=xy[1];dr.constrainTo(this.elRegion);return[dr.left,dr.top]}}});Ext.dd.ScrollManager=function(){var ddm=Ext.dd.DragDropMgr;var els={};var dragEl=null;var proc={};var onStop=function(e){dragEl=null;clearProc()};var triggerRefresh=function(){if(ddm.dragCurrent){ddm.refreshCache(ddm.dragCurrent.groups)}};var doScroll=function(){if(ddm.dragCurrent){var dds=Ext.dd.ScrollManager;var inc=proc.el.ddScrollConfig?proc.el.ddScrollConfig.increment:dds.increment;if(!dds.animate){if(proc.el.scroll(proc.dir,inc)){triggerRefresh()}}else{proc.el.scroll(proc.dir,inc,true,dds.animDuration,triggerRefresh)}}};var clearProc=function(){if(proc.id){clearInterval(proc.id)}proc.id=0;proc.el=null;proc.dir=""};var startProc=function(el,dir){clearProc();proc.el=el;proc.dir=dir;var freq=(el.ddScrollConfig&&el.ddScrollConfig.frequency)?el.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency;proc.id=setInterval(doScroll,freq)};var onFire=function(e,isDrop){if(isDrop||!ddm.dragCurrent){return}var dds=Ext.dd.ScrollManager;if(!dragEl||dragEl!=ddm.dragCurrent){dragEl=ddm.dragCurrent;dds.refreshCache()}var xy=Ext.lib.Event.getXY(e);var pt=new Ext.lib.Point(xy[0],xy[1]);for(var id in els){var el=els[id],r=el._region;var c=el.ddScrollConfig?el.ddScrollConfig:dds;if(r&&r.contains(pt)&&el.isScrollable()){if(r.bottom-pt.y<=c.vthresh){if(proc.el!=el){startProc(el,"down")}return}else{if(r.right-pt.x<=c.hthresh){if(proc.el!=el){startProc(el,"left")}return}else{if(pt.y-r.top<=c.vthresh){if(proc.el!=el){startProc(el,"up")}return}else{if(pt.x-r.left<=c.hthresh){if(proc.el!=el){startProc(el,"right")}return}}}}}}clearProc()};ddm.fireEvents=ddm.fireEvents.createSequence(onFire,ddm);ddm.stopDrag=ddm.stopDrag.createSequence(onStop,ddm);return{register:function(el){if(Ext.isArray(el)){for(var i=0,len=el.length;i<len;i++){this.register(el[i])}}else{el=Ext.get(el);els[el.id]=el}},unregister:function(el){if(Ext.isArray(el)){for(var i=0,len=el.length;i<len;i++){this.unregister(el[i])}}else{el=Ext.get(el);delete els[el.id]}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){for(var id in els){if(typeof els[id]=="object"){els[id]._region=els[id].getRegion()}}}}}();Ext.dd.Registry=function(){var elements={};var handles={};var autoIdSeed=0;var getId=function(el,autogen){if(typeof el=="string"){return el}var id=el.id;if(!id&&autogen!==false){id="extdd-"+(++autoIdSeed);el.id=id}return id};return{register:function(el,data){data=data||{};if(typeof el=="string"){el=document.getElementById(el)}data.ddel=el;elements[getId(el)]=data;if(data.isHandle!==false){handles[data.ddel.id]=data}if(data.handles){var hs=data.handles;for(var i=0,len=hs.length;i<len;i++){handles[getId(hs[i])]=data}}},unregister:function(el){var id=getId(el,false);var data=elements[id];if(data){delete elements[id];if(data.handles){var hs=data.handles;for(var i=0,len=hs.length;i<len;i++){delete handles[getId(hs[i],false)]}}}},getHandle:function(id){if(typeof id!="string"){id=id.id}return handles[id]},getHandleFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);return t?handles[t.id]:null},getTarget:function(id){if(typeof id!="string"){id=id.id}return elements[id]},getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);return t?elements[t.id]||handles[t.id]:null}}}();Ext.dd.StatusProxy=function(config){Ext.apply(this,config);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,tag:"div",cls:"x-dd-drag-proxy "+this.dropNotAllowed,children:[{tag:"div",cls:"x-dd-drop-icon"},{tag:"div",cls:"x-dd-drag-ghost"}]},shadow:!config||config.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1]);this.dropStatus=this.dropNotAllowed};Ext.dd.StatusProxy.prototype={dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",setStatus:function(cssClass){cssClass=cssClass||this.dropNotAllowed;if(this.dropStatus!=cssClass){this.el.replaceClass(this.dropStatus,cssClass);this.dropStatus=cssClass}},reset:function(clearGhost){this.el.dom.className="x-dd-drag-proxy "+this.dropNotAllowed;this.dropStatus=this.dropNotAllowed;if(clearGhost){this.ghost.update("")}},update:function(html){if(typeof html=="string"){this.ghost.update(html)}else{this.ghost.update("");html.style.margin="0";this.ghost.dom.appendChild(html)}var el=this.ghost.dom.firstChild;if(el){Ext.fly(el).setStyle("float","none")}},getEl:function(){return this.el},getGhost:function(){return this.ghost},hide:function(clear){this.el.hide();if(clear){this.reset(true)}},stop:function(){if(this.anim&&this.anim.isAnimated&&this.anim.isAnimated()){this.anim.stop()}},show:function(){this.el.show()},sync:function(){this.el.sync()},repair:function(xy,callback,scope){this.callback=callback;this.scope=scope;if(xy&&this.animRepair!==false){this.el.addClass("x-dd-drag-repair");this.el.hideUnders(true);this.anim=this.el.shift({duration:this.repairDuration||0.5,easing:"easeOut",xy:xy,stopFx:true,callback:this.afterRepair,scope:this})}else{this.afterRepair()}},afterRepair:function(){this.hide(true);if(typeof this.callback=="function"){this.callback.call(this.scope||this)}this.callback=null;this.scope=null}};Ext.dd.DragSource=function(el,config){this.el=Ext.get(el);if(!this.dragData){this.dragData={}}Ext.apply(this,config);if(!this.proxy){this.proxy=new Ext.dd.StatusProxy()}Ext.dd.DragSource.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{dragElId:this.proxy.id,resizeFrame:false,isTarget:false,scroll:this.scroll===true});this.dragging=false};Ext.extend(Ext.dd.DragSource,Ext.dd.DDProxy,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",getDragData:function(e){return this.dragData},onDragEnter:function(e,id){var target=Ext.dd.DragDropMgr.getDDById(id);this.cachedTarget=target;if(this.beforeDragEnter(target,e,id)!==false){if(target.isNotifyTarget){var status=target.notifyEnter(this,e,this.dragData);this.proxy.setStatus(status)}else{this.proxy.setStatus(this.dropAllowed)}if(this.afterDragEnter){this.afterDragEnter(target,e,id)}}},beforeDragEnter:function(target,e,id){return true},alignElWithMouse:function(){Ext.dd.DragSource.superclass.alignElWithMouse.apply(this,arguments);this.proxy.sync()},onDragOver:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragOver(target,e,id)!==false){if(target.isNotifyTarget){var status=target.notifyOver(this,e,this.dragData);this.proxy.setStatus(status)}if(this.afterDragOver){this.afterDragOver(target,e,id)}}},beforeDragOver:function(target,e,id){return true},onDragOut:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragOut(target,e,id)!==false){if(target.isNotifyTarget){target.notifyOut(this,e,this.dragData)}this.proxy.reset();if(this.afterDragOut){this.afterDragOut(target,e,id)}}this.cachedTarget=null},beforeDragOut:function(target,e,id){return true},onDragDrop:function(e,id){var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);if(this.beforeDragDrop(target,e,id)!==false){if(target.isNotifyTarget){if(target.notifyDrop(this,e,this.dragData)){this.onValidDrop(target,e,id)}else{this.onInvalidDrop(target,e,id)}}else{this.onValidDrop(target,e,id)}if(this.afterDragDrop){this.afterDragDrop(target,e,id)}}delete this.cachedTarget},beforeDragDrop:function(target,e,id){return true},onValidDrop:function(target,e,id){this.hideProxy();if(this.afterValidDrop){this.afterValidDrop(target,e,id)}},getRepairXY:function(e,data){return this.el.getXY()},onInvalidDrop:function(target,e,id){this.beforeInvalidDrop(target,e,id);if(this.cachedTarget){if(this.cachedTarget.isNotifyTarget){this.cachedTarget.notifyOut(this,e,this.dragData)}this.cacheTarget=null}this.proxy.repair(this.getRepairXY(e,this.dragData),this.afterRepair,this);if(this.afterInvalidDrop){this.afterInvalidDrop(e,id)}},afterRepair:function(){if(Ext.enableFx){this.el.highlight(this.hlColor||"c3daf9")}this.dragging=false},beforeInvalidDrop:function(target,e,id){return true},handleMouseDown:function(e){if(this.dragging){return}var data=this.getDragData(e);if(data&&this.onBeforeDrag(data,e)!==false){this.dragData=data;this.proxy.stop();Ext.dd.DragSource.superclass.handleMouseDown.apply(this,arguments)}},onBeforeDrag:function(data,e){return true},onStartDrag:Ext.emptyFn,startDrag:function(x,y){this.proxy.reset();this.dragging=true;this.proxy.update("");this.onInitDrag(x,y);this.proxy.show()},onInitDrag:function(x,y){var clone=this.el.dom.cloneNode(true);clone.id=Ext.id();this.proxy.update(clone);this.onStartDrag(x,y);return true},getProxy:function(){return this.proxy},hideProxy:function(){this.proxy.hide();this.proxy.reset(true);this.dragging=false},triggerCacheRefresh:function(){Ext.dd.DDM.refreshCache(this.groups)},b4EndDrag:function(e){},endDrag:function(e){this.onEndDrag(this.dragData,e)},onEndDrag:function(data,e){},autoOffset:function(x,y){this.setDelta(-12,-20)}});Ext.dd.DropTarget=function(el,config){this.el=Ext.get(el);Ext.apply(this,config);if(this.containerScroll){Ext.dd.ScrollManager.register(this.el)}Ext.dd.DropTarget.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{isTarget:true})};Ext.extend(Ext.dd.DropTarget,Ext.dd.DDTarget,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",isTarget:true,isNotifyTarget:true,notifyEnter:function(dd,e,data){if(this.overClass){this.el.addClass(this.overClass)}return this.dropAllowed},notifyOver:function(dd,e,data){return this.dropAllowed},notifyOut:function(dd,e,data){if(this.overClass){this.el.removeClass(this.overClass)}},notifyDrop:function(dd,e,data){return false}});Ext.dd.DragZone=function(el,config){Ext.dd.DragZone.superclass.constructor.call(this,el,config);if(this.containerScroll){Ext.dd.ScrollManager.register(this.el)}};Ext.extend(Ext.dd.DragZone,Ext.dd.DragSource,{getDragData:function(e){return Ext.dd.Registry.getHandleFromEvent(e)},onInitDrag:function(x,y){this.proxy.update(this.dragData.ddel.cloneNode(true));this.onStartDrag(x,y);return true},afterRepair:function(){if(Ext.enableFx){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")}this.dragging=false},getRepairXY:function(e){return Ext.Element.fly(this.dragData.ddel).getXY()}});Ext.dd.DropZone=function(el,config){Ext.dd.DropZone.superclass.constructor.call(this,el,config)};Ext.extend(Ext.dd.DropZone,Ext.dd.DropTarget,{getTargetFromEvent:function(e){return Ext.dd.Registry.getTargetFromEvent(e)},onNodeEnter:function(n,dd,e,data){},onNodeOver:function(n,dd,e,data){return this.dropAllowed},onNodeOut:function(n,dd,e,data){},onNodeDrop:function(n,dd,e,data){return false},onContainerOver:function(dd,e,data){return this.dropNotAllowed},onContainerDrop:function(dd,e,data){return false},notifyEnter:function(dd,e,data){return this.dropNotAllowed},notifyOver:function(dd,e,data){var n=this.getTargetFromEvent(e);if(!n){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null}return this.onContainerOver(dd,e,data)}if(this.lastOverNode!=n){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data)}this.onNodeEnter(n,dd,e,data);this.lastOverNode=n}return this.onNodeOver(n,dd,e,data)},notifyOut:function(dd,e,data){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null}},notifyDrop:function(dd,e,data){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,dd,e,data);this.lastOverNode=null}var n=this.getTargetFromEvent(e);return n?this.onNodeDrop(n,dd,e,data):this.onContainerDrop(dd,e,data)},triggerCacheRefresh:function(){Ext.dd.DDM.refreshCache(this.groups)}});Ext.Element.addMethods({initDD:function(group,config,overrides){var dd=new Ext.dd.DD(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides)},initDDProxy:function(group,config,overrides){var dd=new Ext.dd.DDProxy(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides)},initDDTarget:function(group,config,overrides){var dd=new Ext.dd.DDTarget(Ext.id(this.dom),group,config);return Ext.apply(dd,overrides)}});Ext.data.Api=(function(){var validActions={};return{actions:{create:"create",read:"read",update:"update",destroy:"destroy"},restActions:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},isAction:function(action){return(Ext.data.Api.actions[action])?true:false},getVerb:function(name){if(validActions[name]){return validActions[name]}for(var verb in this.actions){if(this.actions[verb]===name){validActions[name]=verb;break}}return(validActions[name]!==undefined)?validActions[name]:null},isValid:function(api){var invalid=[];var crud=this.actions;for(var action in api){if(!(action in crud)){invalid.push(action)}}return(!invalid.length)?true:invalid},hasUniqueUrl:function(proxy,verb){var url=(proxy.api[verb])?proxy.api[verb].url:null;var unique=true;for(var action in proxy.api){if((unique=(action===verb)?true:(proxy.api[action].url!=url)?true:false)===false){break}}return unique},prepare:function(proxy){if(!proxy.api){proxy.api={}}for(var verb in this.actions){var action=this.actions[verb];proxy.api[action]=proxy.api[action]||proxy.url||proxy.directFn;if(typeof(proxy.api[action])=="string"){proxy.api[action]={url:proxy.api[action]}}}},restify:function(proxy){proxy.restful=true;for(var verb in this.restActions){proxy.api[this.actions[verb]].method=this.restActions[verb]}proxy.onWrite=proxy.onWrite.createInterceptor(function(action,o,response,rs){var reader=o.reader;var res=new Ext.data.Response({action:action,raw:response});switch(response.status){case 200:return true;break;case 201:res.success=true;break;case 204:res.success=true;res.data=null;break;default:return true;break}if(res.success===true){this.fireEvent("write",this,action,res.data,res,rs,o.request.arg)}else{this.fireEvent("exception",this,"remote",action,o,res,rs)}o.request.callback.call(o.request.scope,res.data,res,res.success);return false},proxy)}}})();Ext.data.Response=function(params,response){Ext.apply(this,params,{raw:response})};Ext.data.Response.prototype={message:null,success:false,status:null,root:null,raw:null,getMessage:function(){return this.message},getSuccess:function(){return this.success},getStatus:function(){return this.status},getRoot:function(){return this.root},getRawResponse:function(){return this.raw}};Ext.data.Api.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.data.Api"});Ext.apply(Ext.data.Api.Error.prototype,{lang:{"action-url-undefined":"No fallback url defined for this action.  When defining a DataProxy api, please be sure to define an url for each CRUD action in Ext.data.Api.actions or define a default url in addition to your api-configuration.",invalid:"received an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions defined in Ext.data.Api.actions","invalid-url":"Invalid url.  Please review your proxy configuration.",execute:'Attempted to execute an unknown action.  Valid API actions are defined in Ext.data.Api.actions"'}});Ext.data.SortTypes={none:function(s){return s},stripTagsRE:/<\/?[^>]+>/gi,asText:function(s){return String(s).replace(this.stripTagsRE,"")},asUCText:function(s){return String(s).toUpperCase().replace(this.stripTagsRE,"")},asUCString:function(s){return String(s).toUpperCase()},asDate:function(s){if(!s){return 0}if(Ext.isDate(s)){return s.getTime()}return Date.parse(String(s))},asFloat:function(s){var val=parseFloat(String(s).replace(/,/g,""));return isNaN(val)?0:val},asInt:function(s){var val=parseInt(String(s).replace(/,/g,""),10);return isNaN(val)?0:val}};Ext.data.Record=function(data,id){this.id=(id||id===0)?id:Ext.data.Record.id(this);this.data=data||{}};Ext.data.Record.create=function(o){var f=Ext.extend(Ext.data.Record,{});var p=f.prototype;p.fields=new Ext.util.MixedCollection(false,function(field){return field.name});for(var i=0,len=o.length;i<len;i++){p.fields.add(new Ext.data.Field(o[i]))}f.getField=function(name){return p.fields.get(name)};return f};Ext.data.Record.PREFIX="ext-record";Ext.data.Record.AUTO_ID=1;Ext.data.Record.EDIT="edit";Ext.data.Record.REJECT="reject";Ext.data.Record.COMMIT="commit";Ext.data.Record.id=function(rec){rec.phantom=true;return[Ext.data.Record.PREFIX,"-",Ext.data.Record.AUTO_ID++].join("")};Ext.data.Record.prototype={dirty:false,editing:false,error:null,modified:null,phantom:false,join:function(store){this.store=store},set:function(name,value){var isObj=(typeof value==="object");if(!isObj&&String(this.data[name])===String(value)){return}else{if(isObj&&Ext.encode(this.data[name])===Ext.encode(value)){return}}this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[name]=="undefined"){this.modified[name]=this.data[name]}this.data[name]=value;if(!this.editing){this.afterEdit()}},afterEdit:function(){if(this.store){this.store.afterEdit(this)}},afterReject:function(){if(this.store){this.store.afterReject(this)}},afterCommit:function(){if(this.store){this.store.afterCommit(this)}},get:function(name){return this.data[name]},beginEdit:function(){this.editing=true;this.modified=this.modified||{}},cancelEdit:function(){this.editing=false;delete this.modified},endEdit:function(){this.editing=false;if(this.dirty){this.afterEdit()}},reject:function(silent){var m=this.modified;for(var n in m){if(typeof m[n]!="function"){this.data[n]=m[n]}}this.dirty=false;delete this.modified;this.editing=false;if(silent!==true){this.afterReject()}},commit:function(silent){this.dirty=false;delete this.modified;this.editing=false;if(silent!==true){this.afterCommit()}},getChanges:function(){var m=this.modified,cs={};for(var n in m){if(m.hasOwnProperty(n)){cs[n]=this.data[n]}}return cs},hasError:function(){return this.error!==null},clearError:function(){this.error=null},copy:function(newId){return new this.constructor(Ext.apply({},this.data),newId||this.id)},isModified:function(fieldName){return !!(this.modified&&this.modified.hasOwnProperty(fieldName))},isValid:function(){return this.fields.find(function(f){return(f.allowBlank===false&&Ext.isEmpty(this.data[f.name]))?true:false},this)?false:true},markDirty:function(){this.dirty=true;if(!this.modified){this.modified={}}this.fields.each(function(f){this.modified[f.name]=this.data[f.name]},this)}};Ext.StoreMgr=Ext.apply(new Ext.util.MixedCollection(),{register:function(){for(var i=0,s;(s=arguments[i]);i++){this.add(s)}},unregister:function(){for(var i=0,s;(s=arguments[i]);i++){this.remove(this.lookup(s))}},lookup:function(id){if(Ext.isArray(id)){var fields=["field1"],expand=!Ext.isArray(id[0]);if(!expand){for(var i=2,len=id[0].length;i<=len;++i){fields.push("field"+i)}}return new Ext.data.ArrayStore({fields:fields,data:id,expandData:expand,autoDestroy:true,autoCreated:true})}return Ext.isObject(id)?(id.events?id:Ext.create(id,"store")):this.get(id)},getKey:function(o){return o.storeId}});Ext.data.Store=function(config){this.data=new Ext.util.MixedCollection(false);this.data.getKey=function(o){return o.id};this.baseParams={};this.removed=[];if(config&&config.data){this.inlineData=config.data;delete config.data}Ext.apply(this,config);this.paramNames=Ext.applyIf(this.paramNames||{},this.defaultParamNames);if(this.url&&!this.proxy){this.proxy=new Ext.data.HttpProxy({url:this.url})}if(this.restful===true&&this.proxy){this.batch=false;Ext.data.Api.restify(this.proxy)}if(this.reader){if(!this.recordType){this.recordType=this.reader.recordType}if(this.reader.onMetaChange){this.reader.onMetaChange=this.reader.onMetaChange.createSequence(this.onMetaChange,this)}if(this.writer){this.writer.meta=this.reader.meta;this.pruneModifiedRecords=true}}if(this.recordType){this.fields=this.recordType.prototype.fields}this.modified=[];this.addEvents("datachanged","metachange","add","remove","update","clear","exception","beforeload","load","loadexception","beforewrite","write");if(this.proxy){this.relayEvents(this.proxy,["loadexception","exception"])}if(this.writer){this.on({scope:this,add:this.createRecords,remove:this.destroyRecord,update:this.updateRecord,clear:this.onClear})}this.sortToggle={};if(this.sortField){this.setDefaultSort(this.sortField,this.sortDir)}else{if(this.sortInfo){this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction)}}Ext.data.Store.superclass.constructor.call(this);if(this.id){this.storeId=this.id;delete this.id}if(this.storeId){Ext.StoreMgr.register(this)}if(this.inlineData){this.loadData(this.inlineData);delete this.inlineData}else{if(this.autoLoad){this.load.defer(10,this,[typeof this.autoLoad=="object"?this.autoLoad:undefined])}}};Ext.extend(Ext.data.Store,Ext.util.Observable,{writer:undefined,remoteSort:false,autoDestroy:false,pruneModifiedRecords:false,lastOptions:null,autoSave:true,batch:true,restful:false,paramNames:undefined,defaultParamNames:{start:"start",limit:"limit",sort:"sort",dir:"dir"},destroy:function(){if(!this.isDestroyed){if(this.storeId){Ext.StoreMgr.unregister(this)}this.clearData();this.data=null;Ext.destroy(this.proxy);this.reader=this.writer=null;this.purgeListeners();this.isDestroyed=true}},add:function(records){records=[].concat(records);if(records.length<1){return}for(var i=0,len=records.length;i<len;i++){records[i].join(this)}var index=this.data.length;this.data.addAll(records);if(this.snapshot){this.snapshot.addAll(records)}this.fireEvent("add",this,records,index)},addSorted:function(record){var index=this.findInsertIndex(record);this.insert(index,record)},remove:function(record){var index=this.data.indexOf(record);if(index>-1){record.join(null);this.data.removeAt(index);if(this.pruneModifiedRecords){this.modified.remove(record)}if(this.snapshot){this.snapshot.remove(record)}this.fireEvent("remove",this,record,index)}},removeAt:function(index){this.remove(this.getAt(index))},removeAll:function(){var items=[];this.each(function(rec){items.push(rec)});this.clearData();if(this.snapshot){this.snapshot.clear()}if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent("clear",this,items)},onClear:function(store,records){Ext.each(records,function(rec,index){this.destroyRecord(this,rec,index)},this)},insert:function(index,records){records=[].concat(records);for(var i=0,len=records.length;i<len;i++){this.data.insert(index,records[i]);records[i].join(this)}this.fireEvent("add",this,records,index)},indexOf:function(record){return this.data.indexOf(record)},indexOfId:function(id){return this.data.indexOfKey(id)},getById:function(id){return this.data.key(id)},getAt:function(index){return this.data.itemAt(index)},getRange:function(start,end){return this.data.getRange(start,end)},storeOptions:function(o){o=Ext.apply({},o);delete o.callback;delete o.scope;this.lastOptions=o},clearData:function(){this.data.each(function(rec){rec.join(null)});this.data.clear()},load:function(options){options=options||{};this.storeOptions(options);if(this.sortInfo&&this.remoteSort){var pn=this.paramNames;options.params=options.params||{};options.params[pn.sort]=this.sortInfo.field;options.params[pn.dir]=this.sortInfo.direction}try{return this.execute("read",null,options)}catch(e){this.handleException(e);return false}},updateRecord:function(store,record,action){if(action==Ext.data.Record.EDIT&&this.autoSave===true&&(!record.phantom||(record.phantom&&record.isValid))){this.save()}},createRecords:function(store,rs,index){for(var i=0,len=rs.length;i<len;i++){if(rs[i].phantom&&rs[i].isValid()){rs[i].markDirty();this.modified.push(rs[i])}}if(this.autoSave===true){this.save()}},destroyRecord:function(store,record,index){if(this.modified.indexOf(record)!=-1){this.modified.remove(record)}if(!record.phantom){this.removed.push(record);record.lastIndex=index;if(this.autoSave===true){this.save()}}},execute:function(action,rs,options){if(!Ext.data.Api.isAction(action)){throw new Ext.data.Api.Error("execute",action)}options=Ext.applyIf(options||{},{params:{}});var doRequest=true;if(action==="read"){Ext.applyIf(options.params,this.baseParams);doRequest=this.fireEvent("beforeload",this,options)}else{if(this.writer.listful===true&&this.restful!==true){rs=(Ext.isArray(rs))?rs:[rs]}else{if(Ext.isArray(rs)&&rs.length==1){rs=rs.shift()}}if((doRequest=this.fireEvent("beforewrite",this,action,rs,options))!==false){this.writer.write(action,options.params,rs)}}if(doRequest!==false){var params=Ext.apply({},options.params,this.baseParams);if(this.writer&&this.proxy.url&&!this.proxy.restful&&!Ext.data.Api.hasUniqueUrl(this.proxy,action)){params.xaction=action}this.proxy.request(Ext.data.Api.actions[action],rs,params,this.reader,this.createCallback(action,rs),this,options)}return doRequest},save:function(){if(!this.writer){throw new Ext.data.Store.Error("writer-undefined")}if(this.removed.length){this.doTransaction("destroy",this.removed)}var rs=[].concat(this.getModifiedRecords());if(!rs.length){return true}var phantoms=[];for(var i=rs.length-1;i>=0;i--){if(rs[i].phantom===true){var rec=rs.splice(i,1).shift();if(rec.isValid()){phantoms.push(rec)}}else{if(!rs[i].isValid()){rs.splice(i,1)}}}if(phantoms.length){this.doTransaction("create",phantoms)}if(rs.length){this.doTransaction("update",rs)}return true},doTransaction:function(action,rs){function transaction(records){try{this.execute(action,records)}catch(e){this.handleException(e)}}if(this.batch===false){for(var i=0,len=rs.length;i<len;i++){transaction.call(this,rs[i])}}else{transaction.call(this,rs)}},createCallback:function(action,rs){var actions=Ext.data.Api.actions;return(action=="read")?this.loadRecords:function(data,response,success){this["on"+Ext.util.Format.capitalize(action)+"Records"](success,rs,[].concat(data));if(success===true){this.fireEvent("write",this,action,data,response,rs)}}},clearModified:function(rs){if(Ext.isArray(rs)){for(var n=rs.length-1;n>=0;n--){this.modified.splice(this.modified.indexOf(rs[n]),1)}}else{this.modified.splice(this.modified.indexOf(rs),1)}},reMap:function(record){if(Ext.isArray(record)){for(var i=0,len=record.length;i<len;i++){this.reMap(record[i])}}else{delete this.data.map[record._phid];this.data.map[record.id]=record;var index=this.data.keys.indexOf(record._phid);this.data.keys.splice(index,1,record.id);delete record._phid}},onCreateRecords:function(success,rs,data){if(success===true){try{this.reader.realize(rs,data);this.reMap(rs)}catch(e){this.handleException(e);if(Ext.isArray(rs)){this.onCreateRecords(success,rs,data)}}}},onUpdateRecords:function(success,rs,data){if(success===true){try{this.reader.update(rs,data)}catch(e){this.handleException(e);if(Ext.isArray(rs)){this.onUpdateRecords(success,rs,data)}}}},onDestroyRecords:function(success,rs,data){rs=(rs instanceof Ext.data.Record)?[rs]:[].concat(rs);for(var i=0,len=rs.length;i<len;i++){this.removed.splice(this.removed.indexOf(rs[i]),1)}if(success===false){for(i=rs.length-1;i>=0;i--){this.insert(rs[i].lastIndex,rs[i])}}},handleException:function(e){Ext.handleError(e)},reload:function(options){this.load(Ext.applyIf(options||{},this.lastOptions))},loadRecords:function(o,options,success){if(!o||success===false){if(success!==false){this.fireEvent("load",this,[],options)}if(options.callback){options.callback.call(options.scope||this,[],options,false,o)}return}var r=o.records,t=o.totalRecords||r.length;if(!options||options.add!==true){if(this.pruneModifiedRecords){this.modified=[]}for(var i=0,len=r.length;i<len;i++){r[i].join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.clearData();this.data.addAll(r);this.totalLength=t;this.applySort();this.fireEvent("datachanged",this)}else{this.totalLength=Math.max(t,this.data.length+r.length);this.add(r)}this.fireEvent("load",this,r,options);if(options.callback){options.callback.call(options.scope||this,r,options,true)}},loadData:function(o,append){var r=this.reader.readRecords(o);this.loadRecords(r,{add:append},true)},getCount:function(){return this.data.length||0},getTotalCount:function(){return this.totalLength||0},getSortState:function(){return this.sortInfo},applySort:function(){if(this.sortInfo&&!this.remoteSort){var s=this.sortInfo,f=s.field;this.sortData(f,s.direction)}},sortData:function(f,direction){direction=direction||"ASC";var st=this.fields.get(f).sortType;var fn=function(r1,r2){var v1=st(r1.data[f]),v2=st(r2.data[f]);return v1>v2?1:(v1<v2?-1:0)};this.data.sort(direction,fn);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(direction,fn)}},setDefaultSort:function(field,dir){dir=dir?dir.toUpperCase():"ASC";this.sortInfo={field:field,direction:dir};this.sortToggle[field]=dir},sort:function(fieldName,dir){var f=this.fields.get(fieldName);if(!f){return false}if(!dir){if(this.sortInfo&&this.sortInfo.field==f.name){dir=(this.sortToggle[f.name]||"ASC").toggle("ASC","DESC")}else{dir=f.sortDir}}var st=(this.sortToggle)?this.sortToggle[f.name]:null;var si=(this.sortInfo)?this.sortInfo:null;this.sortToggle[f.name]=dir;this.sortInfo={field:f.name,direction:dir};if(!this.remoteSort){this.applySort();this.fireEvent("datachanged",this)}else{if(!this.load(this.lastOptions)){if(st){this.sortToggle[f.name]=st}if(si){this.sortInfo=si}}}},each:function(fn,scope){this.data.each(fn,scope)},getModifiedRecords:function(){return this.modified},createFilterFn:function(property,value,anyMatch,caseSensitive){if(Ext.isEmpty(value,false)){return false}value=this.data.createValueMatcher(value,anyMatch,caseSensitive);return function(r){return value.test(r.data[property])}},sum:function(property,start,end){var rs=this.data.items,v=0;start=start||0;end=(end||end===0)?end:rs.length-1;for(var i=start;i<=end;i++){v+=(rs[i].data[property]||0)}return v},filter:function(property,value,anyMatch,caseSensitive){var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);return fn?this.filterBy(fn):this.clearFilter()},filterBy:function(fn,scope){this.snapshot=this.snapshot||this.data;this.data=this.queryBy(fn,scope||this);this.fireEvent("datachanged",this)},query:function(property,value,anyMatch,caseSensitive){var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);return fn?this.queryBy(fn):this.data.clone()},queryBy:function(fn,scope){var data=this.snapshot||this.data;return data.filterBy(fn,scope||this)},find:function(property,value,start,anyMatch,caseSensitive){var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);return fn?this.data.findIndexBy(fn,null,start):-1},findExact:function(property,value,start){return this.data.findIndexBy(function(rec){return rec.get(property)===value},this,start)},findBy:function(fn,scope,start){return this.data.findIndexBy(fn,scope,start)},collect:function(dataIndex,allowNull,bypassFilter){var d=(bypassFilter===true&&this.snapshot)?this.snapshot.items:this.data.items;var v,sv,r=[],l={};for(var i=0,len=d.length;i<len;i++){v=d[i].data[dataIndex];sv=String(v);if((allowNull||!Ext.isEmpty(v))&&!l[sv]){l[sv]=true;r[r.length]=v}}return r},clearFilter:function(suppressEvent){if(this.isFiltered()){this.data=this.snapshot;delete this.snapshot;if(suppressEvent!==true){this.fireEvent("datachanged",this)}}},isFiltered:function(){return this.snapshot&&this.snapshot!=this.data},afterEdit:function(record){if(this.modified.indexOf(record)==-1){this.modified.push(record)}this.fireEvent("update",this,record,Ext.data.Record.EDIT)},afterReject:function(record){this.modified.remove(record);this.fireEvent("update",this,record,Ext.data.Record.REJECT)},afterCommit:function(record){this.modified.remove(record);this.fireEvent("update",this,record,Ext.data.Record.COMMIT)},commitChanges:function(){var m=this.modified.slice(0);this.modified=[];for(var i=0,len=m.length;i<len;i++){m[i].commit()}},rejectChanges:function(){var m=this.modified.slice(0);this.modified=[];for(var i=0,len=m.length;i<len;i++){m[i].reject()}var m=this.removed.slice(0).reverse();this.removed=[];for(var i=0,len=m.length;i<len;i++){this.insert(m[i].lastIndex||0,m[i]);m[i].reject()}},onMetaChange:function(meta){this.recordType=this.reader.recordType;this.fields=this.recordType.prototype.fields;delete this.snapshot;if(this.reader.meta.sortInfo){this.sortInfo=this.reader.meta.sortInfo}else{if(this.sortInfo&&!this.fields.get(this.sortInfo.field)){delete this.sortInfo}}if(this.writer){this.writer.meta=this.reader.meta}this.modified=[];this.fireEvent("metachange",this,this.reader.meta)},findInsertIndex:function(record){this.suspendEvents();var data=this.data.clone();this.data.add(record);this.applySort();var index=this.data.indexOf(record);this.data=data;this.resumeEvents();return index},setBaseParam:function(name,value){this.baseParams=this.baseParams||{};this.baseParams[name]=value}});Ext.reg("store",Ext.data.Store);Ext.data.Store.Error=Ext.extend(Ext.Error,{name:"Ext.data.Store"});Ext.apply(Ext.data.Store.Error.prototype,{lang:{"writer-undefined":"Attempted to execute a write-action without a DataWriter installed."}});Ext.data.Field=function(config){if(typeof config=="string"){config={name:config}}Ext.apply(this,config);if(!this.type){this.type="auto"}var st=Ext.data.SortTypes;if(typeof this.sortType=="string"){this.sortType=st[this.sortType]}if(!this.sortType){switch(this.type){case"string":this.sortType=st.asUCString;break;case"date":this.sortType=st.asDate;break;default:this.sortType=st.none}}var stripRe=/[\$,%]/g;if(!this.convert){var cv,dateFormat=this.dateFormat;switch(this.type){case"":case"auto":case undefined:cv=function(v){return v};break;case"string":cv=function(v){return(v===undefined||v===null)?"":String(v)};break;case"int":cv=function(v){return v!==undefined&&v!==null&&v!==""?parseInt(String(v).replace(stripRe,""),10):""};break;case"float":cv=function(v){return v!==undefined&&v!==null&&v!==""?parseFloat(String(v).replace(stripRe,""),10):""};break;case"bool":case"boolean":cv=function(v){return v===true||v==="true"||v==1};break;case"date":cv=function(v){if(!v){return""}if(Ext.isDate(v)){return v}if(dateFormat){if(dateFormat=="timestamp"){return new Date(v*1000)}if(dateFormat=="time"){return new Date(parseInt(v,10))}return Date.parseDate(v,dateFormat)}var parsed=Date.parse(v);return parsed?new Date(parsed):null};break}this.convert=cv}};Ext.data.Field.prototype={dateFormat:null,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true};Ext.data.DataReader=function(meta,recordType){this.meta=meta;this.recordType=Ext.isArray(recordType)?Ext.data.Record.create(recordType):recordType;if(this.recordType){this.buildExtractors()}};Ext.data.DataReader.prototype={getTotal:Ext.emptyFn,getRoot:Ext.emptyFn,getMessage:Ext.emptyFn,getSuccess:Ext.emptyFn,getId:Ext.emptyFn,buildExtractors:Ext.emptyFn,extractData:Ext.emptyFn,extractValues:Ext.emptyFn,realize:function(rs,data){if(Ext.isArray(rs)){for(var i=rs.length-1;i>=0;i--){if(Ext.isArray(data)){this.realize(rs.splice(i,1).shift(),data.splice(i,1).shift())}else{this.realize(rs.splice(i,1).shift(),data)}}}else{if(Ext.isArray(data)&&data.length==1){data=data.shift()}if(!this.isData(data)){throw new Ext.data.DataReader.Error("realize",rs)}rs.phantom=false;rs._phid=rs.id;rs.id=this.getId(data);rs.data=data;rs.commit()}},update:function(rs,data){if(Ext.isArray(rs)){for(var i=rs.length-1;i>=0;i--){if(Ext.isArray(data)){this.update(rs.splice(i,1).shift(),data.splice(i,1).shift())}else{this.update(rs.splice(i,1).shift(),data)}}}else{if(Ext.isArray(data)&&data.length==1){data=data.shift()}if(this.isData(data)){rs.data=Ext.apply(rs.data,data)}rs.commit()}},isData:function(data){return(data&&Ext.isObject(data)&&!Ext.isEmpty(this.getId(data)))?true:false},onMetaChange:function(meta){delete this.ef;this.meta=meta;this.recordType=Ext.data.Record.create(meta.fields);this.buildExtractors()}};Ext.data.DataReader.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.data.DataReader"});Ext.apply(Ext.data.DataReader.Error.prototype,{lang:{update:"#update received invalid data from server.  Please see docs for DataReader#update and review your DataReader configuration.",realize:"#realize was called with invalid remote-data.  Please see the docs for DataReader#realize and review your DataReader configuration.","invalid-response":"#readResponse received an invalid response from the server."}});Ext.data.Response=function(params){Ext.apply(this,params)};Ext.data.Response.prototype={action:undefined,success:undefined,message:undefined,data:undefined,raw:undefined,records:undefined};Ext.data.DataWriter=function(config){Ext.apply(this,config)};Ext.data.DataWriter.prototype={writeAllFields:false,listful:false,write:function(action,params,rs){var data=[],renderer=action+"Record";if(Ext.isArray(rs)){Ext.each(rs,function(rec){data.push(this[renderer](rec))},this)}else{if(rs instanceof Ext.data.Record){data=this[renderer](rs)}}this.render(action,rs,params,data)},render:Ext.emptyFn,updateRecord:Ext.emptyFn,createRecord:Ext.emptyFn,destroyRecord:Ext.emptyFn,toHash:function(rec){var map=rec.fields.map,data={},raw=(this.writeAllFields===false&&rec.phantom===false)?rec.getChanges():rec.data,m;Ext.iterate(raw,function(prop,value){if((m=map[prop])){data[m.mapping?m.mapping:m.name]=value}});if(rec.phantom){if(rec.fields.containsKey(this.meta.idProperty)&&Ext.isEmpty(rec.data[this.meta.idProperty])){delete data[this.meta.idProperty]}}else{data[this.meta.idProperty]=rec.id}return data}};Ext.data.DataProxy=function(conn){conn=conn||{};this.api=conn.api;this.url=conn.url;this.restful=conn.restful;this.listeners=conn.listeners;this.prettyUrls=conn.prettyUrls;this.addEvents("exception","beforeload","load","loadexception","beforewrite","write");Ext.data.DataProxy.superclass.constructor.call(this);try{Ext.data.Api.prepare(this)}catch(e){if(e instanceof Ext.data.Api.Error){e.toConsole()}}Ext.data.DataProxy.relayEvents(this,["beforewrite","write","exception"])};Ext.extend(Ext.data.DataProxy,Ext.util.Observable,{restful:false,setApi:function(){if(arguments.length==1){var valid=Ext.data.Api.isValid(arguments[0]);if(valid===true){this.api=arguments[0]}else{throw new Ext.data.Api.Error("invalid",valid)}}else{if(arguments.length==2){if(!Ext.data.Api.isAction(arguments[0])){throw new Ext.data.Api.Error("invalid",arguments[0])}this.api[arguments[0]]=arguments[1]}}Ext.data.Api.prepare(this)},isApiAction:function(action){return(this.api[action])?true:false},request:function(action,rs,params,reader,callback,scope,options){if(!this.api[action]&&!this.load){throw new Ext.data.DataProxy.Error("action-undefined",action)}params=params||{};if((action===Ext.data.Api.actions.read)?this.fireEvent("beforeload",this,params):this.fireEvent("beforewrite",this,action,rs,params)!==false){this.doRequest.apply(this,arguments)}else{callback.call(scope||this,null,options,false)}},load:null,doRequest:function(action,rs,params,reader,callback,scope,options){this.load(params,reader,callback,scope,options)},buildUrl:function(action,record){record=record||null;var url=(this.api[action])?this.api[action].url:this.url;if(!url){throw new Ext.data.Api.Error("invalid-url",action)}var format=null;var m=url.match(/(.*)(\.json|\.xml|\.html)$/);if(m){format=m[2];url=m[1]}if((this.prettyUrls===true||this.restful===true)&&record instanceof Ext.data.Record&&!record.phantom){url+="/"+record.id}if(format){url+=format}return url},destroy:function(){this.purgeListeners()}});Ext.apply(Ext.data.DataProxy,Ext.util.Observable.prototype);Ext.util.Observable.call(Ext.data.DataProxy);Ext.data.DataProxy.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.data.DataProxy"});Ext.apply(Ext.data.DataProxy.Error.prototype,{lang:{"action-undefined":"DataProxy attempted to execute an API-action but found an undefined url / function.  Please review your Proxy url/api-configuration.","api-invalid":"Recieved an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions from Ext.data.Api.actions."}});Ext.data.ScriptTagProxy=function(config){Ext.apply(this,config);Ext.data.ScriptTagProxy.superclass.constructor.call(this,config);this.head=document.getElementsByTagName("head")[0]};Ext.data.ScriptTagProxy.TRANS_ID=1000;Ext.extend(Ext.data.ScriptTagProxy,Ext.data.DataProxy,{timeout:30000,callbackParam:"callback",nocache:true,doRequest:function(action,rs,params,reader,callback,scope,arg){var p=Ext.urlEncode(Ext.apply(params,this.extraParams));var url=this.buildUrl(action,rs);if(!url){throw new Ext.data.Api.Error("invalid-url",url)}url=Ext.urlAppend(url,p);if(this.nocache){url=Ext.urlAppend(url,"_dc="+(new Date().getTime()))}var transId=++Ext.data.ScriptTagProxy.TRANS_ID;var trans={id:transId,action:action,cb:"stcCallback"+transId,scriptId:"stcScript"+transId,params:params,arg:arg,url:url,callback:callback,scope:scope,reader:reader};window[trans.cb]=this.createCallback(action,rs,trans);url+=String.format("&{0}={1}",this.callbackParam,trans.cb);if(this.autoAbort!==false){this.abort()}trans.timeoutId=this.handleFailure.defer(this.timeout,this,[trans]);var script=document.createElement("script");script.setAttribute("src",url);script.setAttribute("type","text/javascript");script.setAttribute("id",trans.scriptId);this.head.appendChild(script);this.trans=trans},createCallback:function(action,rs,trans){var self=this;return function(res){self.trans=false;self.destroyTrans(trans,true);if(action===Ext.data.Api.actions.read){self.onRead.call(self,action,trans,res)}else{self.onWrite.call(self,action,trans,res,rs)}}},onRead:function(action,trans,res){var result;try{result=trans.reader.readRecords(res)}catch(e){this.fireEvent("loadexception",this,trans,res,e);this.fireEvent("exception",this,"response",action,trans,res,e);trans.callback.call(trans.scope||window,null,trans.arg,false);return}if(result.success===false){this.fireEvent("loadexception",this,trans,res);this.fireEvent("exception",this,"remote",action,trans,res,null)}else{this.fireEvent("load",this,res,trans.arg)}trans.callback.call(trans.scope||window,result,trans.arg,result.success)},onWrite:function(action,trans,response,rs){var reader=trans.reader;try{var res=reader.readResponse(action,response)}catch(e){this.fireEvent("exception",this,"response",action,trans,res,e);trans.callback.call(trans.scope||window,null,res,false);return}if(!res.success===true){this.fireEvent("exception",this,"remote",action,trans,res,rs);trans.callback.call(trans.scope||window,null,res,false);return}this.fireEvent("write",this,action,res.data,res,rs,trans.arg);trans.callback.call(trans.scope||window,res.data,res,true)},isLoading:function(){return this.trans?true:false},abort:function(){if(this.isLoading()){this.destroyTrans(this.trans)}},destroyTrans:function(trans,isLoaded){this.head.removeChild(document.getElementById(trans.scriptId));clearTimeout(trans.timeoutId);if(isLoaded){window[trans.cb]=undefined;try{delete window[trans.cb]}catch(e){}}else{window[trans.cb]=function(){window[trans.cb]=undefined;try{delete window[trans.cb]}catch(e){}}}},handleFailure:function(trans){this.trans=false;this.destroyTrans(trans,false);if(trans.action===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,null,trans.arg)}this.fireEvent("exception",this,"response",trans.action,{response:null,options:trans.arg});trans.callback.call(trans.scope||window,null,trans.arg,false)},destroy:function(){this.abort();Ext.data.ScriptTagProxy.superclass.destroy.call(this)}});Ext.data.HttpProxy=function(conn){Ext.data.HttpProxy.superclass.constructor.call(this,conn);this.conn=conn;this.conn.url=null;this.useAjax=!conn||!conn.events;var actions=Ext.data.Api.actions;this.activeRequest={};for(var verb in actions){this.activeRequest[actions[verb]]=undefined}};Ext.extend(Ext.data.HttpProxy,Ext.data.DataProxy,{getConnection:function(){return this.useAjax?Ext.Ajax:this.conn},setUrl:function(url,makePermanent){this.conn.url=url;if(makePermanent===true){this.url=url;this.api=null;Ext.data.Api.prepare(this)}},doRequest:function(action,rs,params,reader,cb,scope,arg){var o={method:(this.api[action])?this.api[action]["method"]:undefined,request:{callback:cb,scope:scope,arg:arg},reader:reader,callback:this.createCallback(action,rs),scope:this};if(params.jsonData){o.jsonData=params.jsonData}else{if(params.xmlData){o.xmlData=params.xmlData}else{o.params=params||{}}}if(this.conn.url===null){this.conn.url=this.buildUrl(action,rs)}else{if(this.restful===true&&rs instanceof Ext.data.Record&&!rs.phantom){this.conn.url+="/"+rs.id}}if(this.useAjax){Ext.applyIf(o,this.conn);if(this.activeRequest[action]){}this.activeRequest[action]=Ext.Ajax.request(o)}else{this.conn.request(o)}this.conn.url=null},createCallback:function(action,rs){return function(o,success,response){this.activeRequest[action]=undefined;if(!success){if(action===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,o,response)}this.fireEvent("exception",this,"response",action,o,response);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}if(action===Ext.data.Api.actions.read){this.onRead(action,o,response)}else{this.onWrite(action,o,response,rs)}}},onRead:function(action,o,response){var result;try{result=o.reader.read(response)}catch(e){this.fireEvent("loadexception",this,o,response,e);this.fireEvent("exception",this,"response",action,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}if(result.success===false){this.fireEvent("loadexception",this,o,response);var res=o.reader.readResponse(action,response);this.fireEvent("exception",this,"remote",action,o,res,null)}else{this.fireEvent("load",this,o,o.request.arg)}o.request.callback.call(o.request.scope,result,o.request.arg,result.success)},onWrite:function(action,o,response,rs){var reader=o.reader;var res;try{res=reader.readResponse(action,response)}catch(e){this.fireEvent("exception",this,"response",action,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}if(res.success===false){this.fireEvent("exception",this,"remote",action,o,res,rs)}else{this.fireEvent("write",this,action,res.data,res,rs,o.request.arg)}o.request.callback.call(o.request.scope,res.data,res,res.success)},destroy:function(){if(!this.useAjax){this.conn.abort()}else{if(this.activeRequest){var actions=Ext.data.Api.actions;for(var verb in actions){if(this.activeRequest[actions[verb]]){Ext.Ajax.abort(this.activeRequest[actions[verb]])}}}}Ext.data.HttpProxy.superclass.destroy.call(this)}});Ext.data.MemoryProxy=function(data){var api={};api[Ext.data.Api.actions.read]=true;Ext.data.MemoryProxy.superclass.constructor.call(this,{api:api});this.data=data};Ext.extend(Ext.data.MemoryProxy,Ext.data.DataProxy,{doRequest:function(action,rs,params,reader,callback,scope,arg){params=params||{};var result;try{result=reader.readRecords(this.data)}catch(e){this.fireEvent("loadexception",this,null,arg,e);this.fireEvent("exception",this,"response",action,arg,null,e);callback.call(scope,null,arg,false);return}callback.call(scope,result,arg,true)}});Ext.data.JsonWriter=function(config){Ext.data.JsonWriter.superclass.constructor.call(this,config);if(this.returnJson!=undefined){this.encode=this.returnJson}};Ext.extend(Ext.data.JsonWriter,Ext.data.DataWriter,{returnJson:undefined,encode:true,render:function(action,rs,params,data){if(this.encode===true){params[this.meta.root]=Ext.encode(data)}else{params.jsonData={};params.jsonData[this.meta.root]=data}},createRecord:function(rec){return this.toHash(rec)},updateRecord:function(rec){return this.toHash(rec)},destroyRecord:function(rec){return rec.id}});Ext.data.JsonReader=function(meta,recordType){meta=meta||{};Ext.applyIf(meta,{idProperty:"id",successProperty:"success",totalProperty:"total"});Ext.data.JsonReader.superclass.constructor.call(this,meta,recordType||meta.fields)};Ext.extend(Ext.data.JsonReader,Ext.data.DataReader,{read:function(response){var json=response.responseText;var o=Ext.decode(json);if(!o){throw {message:"JsonReader.read: Json object not found"}}return this.readRecords(o)},readResponse:function(action,response){var o=(response.responseText!==undefined)?Ext.decode(response.responseText):response;if(!o){throw new Ext.data.JsonReader.Error("response")}var root=this.getRoot(o);if(action===Ext.data.Api.actions.create){var def=Ext.isDefined(root);if(def&&Ext.isEmpty(root)){throw new Ext.data.JsonReader.Error("root-empty",this.meta.root)}else{if(!def){throw new Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)}}}var res=new Ext.data.Response({action:action,success:this.getSuccess(o),data:this.extractData(root),message:this.getMessage(o),raw:o});if(Ext.isEmpty(res.success)){throw new Ext.data.JsonReader.Error("successProperty-response",this.meta.successProperty)}return res},readRecords:function(o){this.jsonData=o;if(o.metaData){this.onMetaChange(o.metaData)}var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length,v;var root=this.getRoot(o),c=root.length,totalRecords=c,success=true;if(s.totalProperty){v=parseInt(this.getTotal(o),10);if(!isNaN(v)){totalRecords=v}}if(s.successProperty){v=this.getSuccess(o);if(v===false||v==="false"){success=false}}return{success:success,records:this.extractData(root,true),totalRecords:totalRecords}},buildExtractors:function(){if(this.ef){return}var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(s.totalProperty){this.getTotal=this.createAccessor(s.totalProperty)}if(s.successProperty){this.getSuccess=this.createAccessor(s.successProperty)}if(s.messageProperty){this.getMessage=this.createAccessor(s.messageProperty)}this.getRoot=s.root?this.createAccessor(s.root):function(p){return p};if(s.id||s.idProperty){var g=this.createAccessor(s.id||s.idProperty);this.getId=function(rec){var r=g(rec);return(r===undefined||r==="")?null:r}}else{this.getId=function(){return null}}var ef=[];for(var i=0;i<fl;i++){f=fi[i];var map=(f.mapping!==undefined&&f.mapping!==null)?f.mapping:f.name;ef.push(this.createAccessor(map))}this.ef=ef},simpleAccess:function(obj,subsc){return obj[subsc]},createAccessor:function(){var re=/[\[\.]/;return function(expr){try{return(re.test(expr))?new Function("obj","return obj."+expr):function(obj){return obj[expr]}}catch(e){}return Ext.emptyFn}}(),extractData:function(root,returnRecords){var rs=undefined;if(this.isData(root)){root=[root]}if(Ext.isArray(root)){var f=this.recordType.prototype.fields,fi=f.items,fl=f.length,rs=[];if(returnRecords===true){var Record=this.recordType;for(var i=0;i<root.length;i++){var n=root[i];var record=new Record(this.extractValues(n,fi,fl),this.getId(n));record.json=n;rs.push(record)}}else{for(var i=0;i<root.length;i++){rs.push(this.extractValues(root[i],fi,fl))}}}return rs},extractValues:function(data,items,len){var f,values={};for(var j=0;j<len;j++){f=items[j];var v=this.ef[j](data);values[f.name]=f.convert((v!==undefined)?v:f.defaultValue,data)}return values}});Ext.data.JsonReader.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.data.JsonReader"});Ext.apply(Ext.data.JsonReader.Error.prototype,{lang:{response:"An error occurred while json-decoding your server response","successProperty-response":'Could not locate your "successProperty" in your server response.  Please review your JsonReader config to ensure the config-property "successProperty" matches the property in your server-response.  See the JsonReader docs.',"root-undefined-config":'Your JsonReader was configured without a "root" property.  Please review your JsonReader config and make sure to define the root property.  See the JsonReader docs.',"idProperty-undefined":'Your JsonReader was configured without an "idProperty"  Please review your JsonReader configuration and ensure the "idProperty" is set (e.g.: "id").  See the JsonReader docs.',"root-empty":'Data was expected to be returned by the server in the "root" property of the response.  Please review your JsonReader configuration to ensure the "root" property matches that returned in the server-response.  See JsonReader docs.'}});Ext.data.ArrayReader=Ext.extend(Ext.data.JsonReader,{readRecords:function(o){this.arrayData=o;var s=this.meta,sid=s?Ext.num(s.idIndex,s.id):null,recordType=this.recordType,fields=recordType.prototype.fields,records=[],v;if(!this.getRoot){this.getRoot=s.root?this.getJsonAccessor(s.root):function(p){return p};if(s.totalProperty){this.getTotal=this.getJsonAccessor(s.totalProperty)}}var root=this.getRoot(o);for(var i=0,len=root.length;i<len;i++){var n=root[i],values={},id=((sid||sid===0)&&n[sid]!==undefined&&n[sid]!==""?n[sid]:null);for(var j=0,jlen=fields.length;j<jlen;j++){var f=fields.items[j],k=f.mapping!==undefined&&f.mapping!==null?f.mapping:j;v=n[k]!==undefined?n[k]:f.defaultValue;v=f.convert(v,n);values[f.name]=v}var record=new recordType(values,id);record.json=n;records[records.length]=record}var totalRecords=records.length;if(s.totalProperty){v=parseInt(this.getTotal(o),10);if(!isNaN(v)){totalRecords=v}}return{records:records,totalRecords:totalRecords}}});Ext.data.ArrayStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.ArrayStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.ArrayReader(config)}))},loadData:function(data,append){if(this.expandData===true){var r=[];for(var i=0,len=data.length;i<len;i++){r[r.length]=[data[i]]}data=r}Ext.data.ArrayStore.superclass.loadData.call(this,data,append)}});Ext.reg("arraystore",Ext.data.ArrayStore);Ext.data.SimpleStore=Ext.data.ArrayStore;Ext.reg("simplestore",Ext.data.SimpleStore);Ext.data.JsonStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.JsonStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.JsonReader(config)}))}});Ext.reg("jsonstore",Ext.data.JsonStore);Ext.data.XmlWriter=function(params){Ext.data.XmlWriter.superclass.constructor.apply(this,arguments);this.tpl=new Ext.XTemplate(this.tpl).compile()};Ext.extend(Ext.data.XmlWriter,Ext.data.DataWriter,{root:"records",xmlVersion:"1.0",xmlEncoding:"ISO-8859-15",tpl:'<tpl for="."><?xml version="{version}" encoding="{encoding}"?><tpl if="documentRoot"><{documentRoot}><tpl for="baseParams"><tpl for="."><{name}>{value}</{name}</tpl></tpl></tpl><tpl if="records.length&gt;1"><{root}></tpl><tpl for="records"><{parent.record}><tpl for="."><{name}>{value}</{name}></tpl></{parent.record}></tpl><tpl if="records.length&gt;1"></{root}></tpl><tpl if="documentRoot"></{documentRoot}></tpl></tpl>',render:function(action,rs,params,data){params.xmlData=this.tpl.applyTemplate({version:this.xmlVersion,encoding:this.xmlEncoding,record:this.meta.record,root:this.root,records:(Ext.isArray(rs))?data:[data]})},toXml:function(data){var fields=[];Ext.iterate(data,function(k,v){fields.push({name:k,value:v})},this);return{fields:fields}},createRecord:function(rec){return this.toXml(this.toHash(rec))},updateRecord:function(rec){return this.toXml(this.toHash(rec))},destroyRecord:function(rec){var data={};data[this.meta.idProperty]=rec.id;return this.toXml(data)}});Ext.data.XmlReader=function(meta,recordType){meta=meta||{};meta.idProperty=meta.idProperty||meta.idPath;Ext.data.XmlReader.superclass.constructor.call(this,meta,recordType||meta.fields)};Ext.extend(Ext.data.XmlReader,Ext.data.DataReader,{read:function(response){var doc=response.responseXML;if(!doc){throw {message:"XmlReader.read: XML Document not available"}}return this.readRecords(doc)},readRecords:function(doc){this.xmlData=doc;var root=doc.documentElement||doc,q=Ext.DomQuery,totalRecords=0,success=true;if(this.meta.totalProperty){totalRecords=this.getTotal(root,0)}if(this.meta.successProperty){success=this.getSuccess(root)}var records=this.extractData(q.select(this.meta.record,root),true);return{success:success,records:records,totalRecords:totalRecords||records.length}},readResponse:function(action,response){var q=Ext.DomQuery,doc=response.responseXML;var res=new Ext.data.Response({action:action,success:this.getSuccess(doc),message:this.getMessage(doc),data:this.extractData(q.select(this.meta.record,doc)||q.select(this.meta.root,doc)),raw:doc});if(Ext.isEmpty(res.success)){throw new Ext.data.DataReader.Error("successProperty-response",this.meta.successProperty)}if(action===Ext.data.Api.actions.create){var def=Ext.isDefined(res.data);if(def&&Ext.isEmpty(res.data)){throw new Ext.data.JsonReader.Error("root-empty",this.meta.root)}else{if(!def){throw new Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)}}}return res},getSuccess:function(){return true},buildExtractors:function(){if(this.ef){return}var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(s.totalProperty){this.getTotal=this.createAccessor(s.totalProperty)}if(s.successProperty){this.getSuccess=this.createAccessor(s.successProperty)}if(s.messageProperty){this.getMessage=this.createAccessor(s.messageProperty)}this.getRoot=function(res){return(!Ext.isEmpty(res[this.meta.record]))?res[this.meta.record]:res[this.meta.root]};if(s.idPath||s.idProperty){var g=this.createAccessor(s.idPath||s.idProperty);this.getId=function(rec){var id=g(rec)||rec.id;return(id===undefined||id==="")?null:id}}else{this.getId=function(){return null}}var ef=[];for(var i=0;i<fl;i++){f=fi[i];var map=(f.mapping!==undefined&&f.mapping!==null)?f.mapping:f.name;ef.push(this.createAccessor(map))}this.ef=ef},createAccessor:function(){var q=Ext.DomQuery;return function(key){switch(key){case this.meta.totalProperty:return function(root,def){return q.selectNumber(key,root,def)};break;case this.meta.successProperty:return function(root,def){var sv=q.selectValue(key,root,true);var success=sv!==false&&sv!=="false";return success};break;default:return function(root,def){return q.selectValue(key,root,def)};break}}}(),extractData:function(root,returnRecords){var Record=this.recordType,records=[],f=Record.prototype.fields,fi=f.items,fl=f.length;if(returnRecords===true){for(var i=0,len=root.length;i<len;i++){var data=root[i],record=new Record(this.extractValues(data,fi,fl),this.getId(data));record.node=data;records.push(record)}}else{for(var i=0,len=root.length;i<len;i++){records.push(this.extractValues(root[i],fi,fl))}}return records},extractValues:function(data,items,len){var f,values={};for(var j=0;j<len;j++){f=items[j];var v=this.ef[j](data);values[f.name]=f.convert((v!==undefined)?v:f.defaultValue,data)}return values}});Ext.data.XmlStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.XmlStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.XmlReader(config)}))}});Ext.reg("xmlstore",Ext.data.XmlStore);Ext.data.GroupingStore=Ext.extend(Ext.data.Store,{constructor:function(config){Ext.data.GroupingStore.superclass.constructor.call(this,config);this.applyGroupField()},remoteGroup:false,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy}var lo=this.lastOptions;if(lo&&lo.params){delete lo.params.groupBy}this.reload()}else{this.applySort();this.fireEvent("datachanged",this)}},groupBy:function(field,forceRegroup,direction){direction=direction?(String(direction).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;if(this.groupField==field&&this.groupDir==direction&&!forceRegroup){return}this.groupField=field;this.groupDir=direction;this.applyGroupField();if(this.groupOnSort){this.sort(field,direction);return}if(this.remoteGroup){this.reload()}else{var si=this.sortInfo||{};if(si.field!=field||si.direction!=direction){this.applySort()}else{this.sortData(field,direction)}this.fireEvent("datachanged",this)}},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}}this.baseParams.groupBy=this.groupField;this.baseParams.groupDir=this.groupDir}},applySort:function(){Ext.data.GroupingStore.superclass.applySort.call(this);if(!this.groupOnSort&&!this.remoteGroup){var gs=this.getGroupState();if(gs&&(gs!=this.sortInfo.field||this.groupDir!=this.sortInfo.direction)){this.sortData(this.groupField,this.groupDir)}}},applyGrouping:function(alwaysFireChange){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);return true}else{if(alwaysFireChange===true){this.fireEvent("datachanged",this)}return false}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField}});Ext.reg("groupingstore",Ext.data.GroupingStore);Ext.data.DirectProxy=function(config){Ext.apply(this,config);if(typeof this.paramOrder=="string"){this.paramOrder=this.paramOrder.split(/[\s,|]/)}Ext.data.DirectProxy.superclass.constructor.call(this,config)};Ext.extend(Ext.data.DirectProxy,Ext.data.DataProxy,{paramOrder:undefined,paramsAsHash:true,directFn:undefined,doRequest:function(action,rs,params,reader,callback,scope,options){var args=[];var directFn=this.api[action]||this.directFn;switch(action){case Ext.data.Api.actions.create:args.push(params.jsonData[reader.meta.root]);break;case Ext.data.Api.actions.read:if(directFn.directCfg.method.len>0){if(this.paramOrder){for(var i=0,len=this.paramOrder.length;i<len;i++){args.push(params[this.paramOrder[i]])}}else{if(this.paramsAsHash){args.push(params)}}}break;case Ext.data.Api.actions.update:args.push(params.jsonData[reader.meta.root]);break;case Ext.data.Api.actions.destroy:args.push(params.jsonData[reader.meta.root]);break}var trans={params:params||{},request:{callback:callback,scope:scope,arg:options},reader:reader};args.push(this.createCallback(action,rs,trans),this);directFn.apply(window,args)},createCallback:function(action,rs,trans){return function(result,res){if(!res.status){if(action===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,trans,res,null)}this.fireEvent("exception",this,"remote",action,trans,res,null);trans.request.callback.call(trans.request.scope,null,trans.request.arg,false);return}if(action===Ext.data.Api.actions.read){this.onRead(action,trans,result,res)}else{this.onWrite(action,trans,result,res,rs)}}},onRead:function(action,trans,result,res){var records;try{records=trans.reader.readRecords(result)}catch(ex){this.fireEvent("loadexception",this,trans,res,ex);this.fireEvent("exception",this,"response",action,trans,res,ex);trans.request.callback.call(trans.request.scope,null,trans.request.arg,false);return}this.fireEvent("load",this,res,trans.request.arg);trans.request.callback.call(trans.request.scope,records,trans.request.arg,true)},onWrite:function(action,trans,result,res,rs){var data=trans.reader.extractData(result);this.fireEvent("write",this,action,data,res,rs,trans.request.arg);trans.request.callback.call(trans.request.scope,data,res,true)}});Ext.data.DirectStore=function(c){c.batchTransactions=false;Ext.data.DirectStore.superclass.constructor.call(this,Ext.apply(c,{proxy:(typeof(c.proxy)=="undefined")?new Ext.data.DirectProxy(Ext.copyTo({},c,"paramOrder,paramsAsHash,directFn,api")):c.proxy,reader:(typeof(c.reader)=="undefined"&&typeof(c.fields)=="object")?new Ext.data.JsonReader(Ext.copyTo({},c,"totalProperty,root,idProperty"),c.fields):c.reader}))};Ext.extend(Ext.data.DirectStore,Ext.data.Store,{});Ext.reg("directstore",Ext.data.DirectStore);Ext.Direct=Ext.extend(Ext.util.Observable,{exceptions:{TRANSPORT:"xhr",PARSE:"parse",LOGIN:"login",SERVER:"exception"},constructor:function(){this.addEvents("event","exception");this.transactions={};this.providers={}},addProvider:function(provider){var a=arguments;if(a.length>1){for(var i=0,len=a.length;i<len;i++){this.addProvider(a[i])}return}if(!provider.events){provider=new Ext.Direct.PROVIDERS[provider.type](provider)}provider.id=provider.id||Ext.id();this.providers[provider.id]=provider;provider.on("data",this.onProviderData,this);provider.on("exception",this.onProviderException,this);if(!provider.isConnected()){provider.connect()}return provider},getProvider:function(id){return this.providers[id]},removeProvider:function(id){var provider=id.id?id:this.providers[id.id];provider.un("data",this.onProviderData,this);provider.un("exception",this.onProviderException,this);delete this.providers[provider.id];return provider},addTransaction:function(t){this.transactions[t.tid]=t;return t},removeTransaction:function(t){delete this.transactions[t.tid||t];return t},getTransaction:function(tid){return this.transactions[tid.tid||tid]},onProviderData:function(provider,e){if(Ext.isArray(e)){for(var i=0,len=e.length;i<len;i++){this.onProviderData(provider,e[i])}return}if(e.name&&e.name!="event"&&e.name!="exception"){this.fireEvent(e.name,e)}else{if(e.type=="exception"){this.fireEvent("exception",e)}}this.fireEvent("event",e,provider)},createEvent:function(response,extraProps){return new Ext.Direct.eventTypes[response.type](Ext.apply(response,extraProps))}});Ext.Direct=new Ext.Direct();Ext.Direct.TID=1;Ext.Direct.PROVIDERS={};Ext.Direct.Transaction=function(config){Ext.apply(this,config);this.tid=++Ext.Direct.TID;this.retryCount=0};Ext.Direct.Transaction.prototype={send:function(){this.provider.queueTransaction(this)},retry:function(){this.retryCount++;this.send()},getProvider:function(){return this.provider}};Ext.Direct.Event=function(config){Ext.apply(this,config)};Ext.Direct.Event.prototype={status:true,getData:function(){return this.data}};Ext.Direct.RemotingEvent=Ext.extend(Ext.Direct.Event,{type:"rpc",getTransaction:function(){return this.transaction||Ext.Direct.getTransaction(this.tid)}});Ext.Direct.ExceptionEvent=Ext.extend(Ext.Direct.RemotingEvent,{status:false,type:"exception"});Ext.Direct.eventTypes={rpc:Ext.Direct.RemotingEvent,event:Ext.Direct.Event,exception:Ext.Direct.ExceptionEvent};Ext.direct.Provider=Ext.extend(Ext.util.Observable,{priority:1,constructor:function(config){Ext.apply(this,config);this.addEvents("connect","disconnect","data","exception");Ext.direct.Provider.superclass.constructor.call(this,config)},isConnected:function(){return false},connect:Ext.emptyFn,disconnect:Ext.emptyFn});Ext.direct.JsonProvider=Ext.extend(Ext.direct.Provider,{parseResponse:function(xhr){if(!Ext.isEmpty(xhr.responseText)){if(typeof xhr.responseText=="object"){return xhr.responseText}return Ext.decode(xhr.responseText)}return null},getEvents:function(xhr){var data=null;try{data=this.parseResponse(xhr)}catch(e){var event=new Ext.Direct.ExceptionEvent({data:e,xhr:xhr,code:Ext.Direct.exceptions.PARSE,message:"Error parsing json response: \n\n "+data});return[event]}var events=[];if(Ext.isArray(data)){for(var i=0,len=data.length;i<len;i++){events.push(Ext.Direct.createEvent(data[i]))}}else{events.push(Ext.Direct.createEvent(data))}return events}});Ext.direct.PollingProvider=Ext.extend(Ext.direct.JsonProvider,{priority:3,interval:3000,constructor:function(config){Ext.direct.PollingProvider.superclass.constructor.call(this,config);this.addEvents("beforepoll","poll")},isConnected:function(){return !!this.pollTask},connect:function(){if(this.url&&!this.pollTask){this.pollTask=Ext.TaskMgr.start({run:function(){if(this.fireEvent("beforepoll",this)!==false){if(typeof this.url=="function"){this.url(this.baseParams)}else{Ext.Ajax.request({url:this.url,callback:this.onData,scope:this,params:this.baseParams})}}},interval:this.interval,scope:this});this.fireEvent("connect",this)}else{if(!this.url){throw"Error initializing PollingProvider, no url configured."}}},disconnect:function(){if(this.pollTask){Ext.TaskMgr.stop(this.pollTask);delete this.pollTask;this.fireEvent("disconnect",this)}},onData:function(opt,success,xhr){if(success){var events=this.getEvents(xhr);for(var i=0,len=events.length;i<len;i++){var e=events[i];this.fireEvent("data",this,e)}}else{var e=new Ext.Direct.ExceptionEvent({data:e,code:Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:xhr});this.fireEvent("data",this,e)}}});Ext.Direct.PROVIDERS.polling=Ext.direct.PollingProvider;Ext.direct.RemotingProvider=Ext.extend(Ext.direct.JsonProvider,{enableBuffer:10,maxRetries:1,timeout:undefined,constructor:function(config){Ext.direct.RemotingProvider.superclass.constructor.call(this,config);this.addEvents("beforecall","call");this.namespace=(Ext.isString(this.namespace))?Ext.ns(this.namespace):this.namespace||window;this.transactions={};this.callBuffer=[]},initAPI:function(){var o=this.actions;for(var c in o){var cls=this.namespace[c]||(this.namespace[c]={}),ms=o[c];for(var i=0,len=ms.length;i<len;i++){var m=ms[i];cls[m.name]=this.createMethod(c,m)}}},isConnected:function(){return !!this.connected},connect:function(){if(this.url){this.initAPI();this.connected=true;this.fireEvent("connect",this)}else{if(!this.url){throw"Error initializing RemotingProvider, no url configured."}}},disconnect:function(){if(this.connected){this.connected=false;this.fireEvent("disconnect",this)}},onData:function(opt,success,xhr){if(success){var events=this.getEvents(xhr);for(var i=0,len=events.length;i<len;i++){var e=events[i],t=this.getTransaction(e);this.fireEvent("data",this,e);if(t){this.doCallback(t,e,true);Ext.Direct.removeTransaction(t)}}}else{var ts=[].concat(opt.ts);for(var i=0,len=ts.length;i<len;i++){var t=this.getTransaction(ts[i]);if(t&&t.retryCount<this.maxRetries){t.retry()}else{var e=new Ext.Direct.ExceptionEvent({data:e,transaction:t,code:Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:xhr});this.fireEvent("data",this,e);if(t){this.doCallback(t,e,false);Ext.Direct.removeTransaction(t)}}}}},getCallData:function(t){return{action:t.action,method:t.method,data:t.data,type:"rpc",tid:t.tid}},doSend:function(data){var o={url:this.url,callback:this.onData,scope:this,ts:data,timeout:this.timeout},callData;if(Ext.isArray(data)){callData=[];for(var i=0,len=data.length;i<len;i++){callData.push(this.getCallData(data[i]))}}else{callData=this.getCallData(data)}if(this.enableUrlEncode){var params={};params[Ext.isString(this.enableUrlEncode)?this.enableUrlEncode:"data"]=Ext.encode(callData);o.params=params}else{o.jsonData=callData}Ext.Ajax.request(o)},combineAndSend:function(){var len=this.callBuffer.length;if(len>0){this.doSend(len==1?this.callBuffer[0]:this.callBuffer);this.callBuffer=[]}},queueTransaction:function(t){if(t.form){this.processForm(t);return}this.callBuffer.push(t);if(this.enableBuffer){if(!this.callTask){this.callTask=new Ext.util.DelayedTask(this.combineAndSend,this)}this.callTask.delay(Ext.isNumber(this.enableBuffer)?this.enableBuffer:10)}else{this.combineAndSend()}},doCall:function(c,m,args){var data=null,hs=args[m.len],scope=args[m.len+1];if(m.len!==0){data=args.slice(0,m.len)}var t=new Ext.Direct.Transaction({provider:this,args:args,action:c,method:m.name,data:data,cb:scope&&Ext.isFunction(hs)?hs.createDelegate(scope):hs});if(this.fireEvent("beforecall",this,t)!==false){Ext.Direct.addTransaction(t);this.queueTransaction(t);this.fireEvent("call",this,t)}},doForm:function(c,m,form,callback,scope){var t=new Ext.Direct.Transaction({provider:this,action:c,method:m.name,args:[form,callback,scope],cb:scope&&Ext.isFunction(callback)?callback.createDelegate(scope):callback,isForm:true});if(this.fireEvent("beforecall",this,t)!==false){Ext.Direct.addTransaction(t);var isUpload=String(form.getAttribute("enctype")).toLowerCase()=="multipart/form-data",params={extTID:t.tid,extAction:c,extMethod:m.name,extType:"rpc",extUpload:String(isUpload)};Ext.apply(t,{form:Ext.getDom(form),isUpload:isUpload,params:callback&&Ext.isObject(callback.params)?Ext.apply(params,callback.params):params});this.fireEvent("call",this,t);this.processForm(t)}},processForm:function(t){Ext.Ajax.request({url:this.url,params:t.params,callback:this.onData,scope:this,form:t.form,isUpload:t.isUpload,ts:t})},createMethod:function(c,m){var f;if(!m.formHandler){f=function(){this.doCall(c,m,Array.prototype.slice.call(arguments,0))}.createDelegate(this)}else{f=function(form,callback,scope){this.doForm(c,m,form,callback,scope)}.createDelegate(this)}f.directCfg={action:c,method:m};return f},getTransaction:function(opt){return opt&&opt.tid?Ext.Direct.getTransaction(opt.tid):null},doCallback:function(t,e){var fn=e.status?"success":"failure";if(t&&t.cb){var hs=t.cb,result=Ext.isDefined(e.result)?e.result:e.data;if(Ext.isFunction(hs)){hs(result,e)}else{Ext.callback(hs[fn],hs.scope,[result,e]);Ext.callback(hs.callback,hs.scope,[result,e])}}}});Ext.Direct.PROVIDERS.remoting=Ext.direct.RemotingProvider;Ext.Resizable=function(el,config){this.el=Ext.get(el);if(config&&config.wrap){config.resizeChild=this.el;this.el=this.el.wrap(typeof config.wrap=="object"?config.wrap:{cls:"xresizable-wrap"});this.el.id=this.el.dom.id=config.resizeChild.id+"-rzwrap";this.el.setStyle("overflow","hidden");this.el.setPositioning(config.resizeChild.getPositioning());config.resizeChild.clearPositioning();if(!config.width||!config.height){var csize=config.resizeChild.getSize();this.el.setSize(csize.width,csize.height)}if(config.pinned&&!config.adjustments){config.adjustments="auto"}}this.proxy=this.el.createProxy({tag:"div",cls:"x-resizable-proxy",id:this.el.id+"-rzproxy"},Ext.getBody());this.proxy.unselectable();this.proxy.enableDisplayMode("block");Ext.apply(this,config);if(this.pinned){this.disableTrackOver=true;this.el.addClass("x-resizable-pinned")}var position=this.el.getStyle("position");if(position!="absolute"&&position!="fixed"){this.el.setStyle("position","relative")}if(!this.handles){this.handles="s,e,se";if(this.multiDirectional){this.handles+=",n,w"}}if(this.handles=="all"){this.handles="n s e w ne nw se sw"}var hs=this.handles.split(/\s*?[,;]\s*?| /);var ps=Ext.Resizable.positions;for(var i=0,len=hs.length;i<len;i++){if(hs[i]&&ps[hs[i]]){var pos=ps[hs[i]];this[pos]=new Ext.Resizable.Handle(this,pos,this.disableTrackOver,this.transparent)}}this.corner=this.southeast;if(this.handles.indexOf("n")!=-1||this.handles.indexOf("w")!=-1){this.updateBox=true}this.activeHandle=null;if(this.resizeChild){if(typeof this.resizeChild=="boolean"){this.resizeChild=Ext.get(this.el.dom.firstChild,true)}else{this.resizeChild=Ext.get(this.resizeChild,true)}}if(this.adjustments=="auto"){var rc=this.resizeChild;var hw=this.west,he=this.east,hn=this.north,hs=this.south;if(rc&&(hw||hn)){rc.position("relative");rc.setLeft(hw?hw.el.getWidth():0);rc.setTop(hn?hn.el.getHeight():0)}this.adjustments=[(he?-he.el.getWidth():0)+(hw?-hw.el.getWidth():0),(hn?-hn.el.getHeight():0)+(hs?-hs.el.getHeight():0)-1]}if(this.draggable){this.dd=this.dynamic?this.el.initDD(null):this.el.initDDProxy(null,{dragElId:this.proxy.id});this.dd.setHandleElId(this.resizeChild?this.resizeChild.id:this.el.id)}this.addEvents("beforeresize","resize");if(this.width!==null&&this.height!==null){this.resizeTo(this.width,this.height)}else{this.updateChildSize()}if(Ext.isIE){this.el.dom.style.zoom=1}Ext.Resizable.superclass.constructor.call(this)};Ext.extend(Ext.Resizable,Ext.util.Observable,{adjustments:[0,0],animate:false,disableTrackOver:false,draggable:false,duration:0.35,dynamic:false,easing:"easeOutStrong",enabled:true,handles:false,multiDirectional:false,height:null,width:null,heightIncrement:0,widthIncrement:0,minHeight:5,minWidth:5,maxHeight:10000,maxWidth:10000,minX:0,minY:0,pinned:false,preserveRatio:false,resizeChild:false,transparent:false,allowMove:false,resizeTo:function(width,height){this.el.setSize(width,height);this.updateChildSize();this.fireEvent("resize",this,width,height,null)},startSizing:function(e,handle){this.fireEvent("beforeresize",this,e);if(this.enabled){if(!this.overlay){this.overlay=this.el.createProxy({tag:"div",cls:"x-resizable-overlay",html:"&#160;"},Ext.getBody());this.overlay.unselectable();this.overlay.enableDisplayMode("block");this.overlay.on({scope:this,mousemove:this.onMouseMove,mouseup:this.onMouseUp})}this.overlay.setStyle("cursor",handle.el.getStyle("cursor"));this.resizing=true;this.startBox=this.el.getBox();this.startPoint=e.getXY();this.offsets=[(this.startBox.x+this.startBox.width)-this.startPoint[0],(this.startBox.y+this.startBox.height)-this.startPoint[1]];this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.overlay.show();if(this.constrainTo){var ct=Ext.get(this.constrainTo);this.resizeRegion=ct.getRegion().adjust(ct.getFrameWidth("t"),ct.getFrameWidth("l"),-ct.getFrameWidth("b"),-ct.getFrameWidth("r"))}this.proxy.setStyle("visibility","hidden");this.proxy.show();this.proxy.setBox(this.startBox);if(!this.dynamic){this.proxy.setStyle("visibility","visible")}}},onMouseDown:function(handle,e){this._allowMove=true;if(this.enabled){e.stopEvent();this.activeHandle=handle;this.startSizing(e,handle)}},onMouseUp:function(e){this._allowMove=false;this.activeHandle=null;var size=this.resizeElement();this.resizing=false;this.handleOut();this.overlay.hide();this.proxy.hide();this.fireEvent("resize",this,size.width,size.height,e)},updateChildSize:function(){if(this.resizeChild){var el=this.el;var child=this.resizeChild;var adj=this.adjustments;if(el.dom.offsetWidth){var b=el.getSize(true);child.setSize(b.width+adj[0],b.height+adj[1])}if(Ext.isIE){setTimeout(function(){if(el.dom.offsetWidth){var b=el.getSize(true);child.setSize(b.width+adj[0],b.height+adj[1])}},10)}}},snap:function(value,inc,min){if(!inc||!value){return value}var newValue=value;var m=value%inc;if(m>0){if(m>(inc/2)){newValue=value+(inc-m)}else{newValue=value-m}}return Math.max(min,newValue)},resizeElement:function(){var box=this.proxy.getBox();if(this.updateBox){this.el.setBox(box,false,this.animate,this.duration,null,this.easing)}else{this.el.setSize(box.width,box.height,this.animate,this.duration,null,this.easing)}this.updateChildSize();if(!this.dynamic){this.proxy.hide()}return box},constrain:function(v,diff,m,mx){if(v-diff<m){diff=v-m}else{if(v-diff>mx){diff=v-mx}}return diff},onMouseMove:function(e){if(this.enabled&&this.activeHandle&&this._allowMove){try{if(this.resizeRegion&&!this.resizeRegion.contains(e.getPoint())){return}var curSize=this.curSize||this.startBox,x=this.startBox.x,y=this.startBox.y,ox=x,oy=y,w=curSize.width,h=curSize.height,ow=w,oh=h,mw=this.minWidth,mh=this.minHeight,mxw=this.maxWidth,mxh=this.maxHeight,wi=this.widthIncrement,hi=this.heightIncrement,eventXY=e.getXY(),diffX=-(this.startPoint[0]-Math.max(this.minX,eventXY[0])),diffY=-(this.startPoint[1]-Math.max(this.minY,eventXY[1])),pos=this.activeHandle.position,tw,th;switch(pos){case"east":w+=diffX;w=Math.min(Math.max(mw,w),mxw);break;case"south":h+=diffY;h=Math.min(Math.max(mh,h),mxh);break;case"southeast":w+=diffX;h+=diffY;w=Math.min(Math.max(mw,w),mxw);h=Math.min(Math.max(mh,h),mxh);break;case"north":diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;break;case"west":diffX=this.constrain(w,diffX,mw,mxw);x+=diffX;w-=diffX;break;case"northeast":w+=diffX;w=Math.min(Math.max(mw,w),mxw);diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;break;case"northwest":diffX=this.constrain(w,diffX,mw,mxw);diffY=this.constrain(h,diffY,mh,mxh);y+=diffY;h-=diffY;x+=diffX;w-=diffX;break;case"southwest":diffX=this.constrain(w,diffX,mw,mxw);h+=diffY;h=Math.min(Math.max(mh,h),mxh);x+=diffX;w-=diffX;break}var sw=this.snap(w,wi,mw);var sh=this.snap(h,hi,mh);if(sw!=w||sh!=h){switch(pos){case"northeast":y-=sh-h;break;case"north":y-=sh-h;break;case"southwest":x-=sw-w;break;case"west":x-=sw-w;break;case"northwest":x-=sw-w;y-=sh-h;break}w=sw;h=sh}if(this.preserveRatio){switch(pos){case"southeast":case"east":h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);w=ow*(h/oh);break;case"south":w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);break;case"northeast":w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);break;case"north":tw=w;w=ow*(h/oh);w=Math.min(Math.max(mw,w),mxw);h=oh*(w/ow);x+=(tw-w)/2;break;case"southwest":h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);tw=w;w=ow*(h/oh);x+=tw-w;break;case"west":th=h;h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);y+=(th-h)/2;tw=w;w=ow*(h/oh);x+=tw-w;break;case"northwest":tw=w;th=h;h=oh*(w/ow);h=Math.min(Math.max(mh,h),mxh);w=ow*(h/oh);y+=th-h;x+=tw-w;break}}this.proxy.setBounds(x,y,w,h);if(this.dynamic){this.resizeElement()}}catch(ex){}}},handleOver:function(){if(this.enabled){this.el.addClass("x-resizable-over")}},handleOut:function(){if(!this.resizing){this.el.removeClass("x-resizable-over")}},getEl:function(){return this.el},getResizeChild:function(){return this.resizeChild},destroy:function(removeEl){Ext.destroy(this.dd,this.overlay,this.proxy);this.overlay=null;this.proxy=null;var ps=Ext.Resizable.positions;for(var k in ps){if(typeof ps[k]!="function"&&this[ps[k]]){this[ps[k]].destroy()}}if(removeEl){this.el.update("");Ext.destroy(this.el);this.el=null}this.purgeListeners()},syncHandleHeight:function(){var h=this.el.getHeight(true);if(this.west){this.west.el.setHeight(h)}if(this.east){this.east.el.setHeight(h)}}});Ext.Resizable.positions={n:"north",s:"south",e:"east",w:"west",se:"southeast",sw:"southwest",nw:"northwest",ne:"northeast"};Ext.Resizable.Handle=function(rz,pos,disableTrackOver,transparent){if(!this.tpl){var tpl=Ext.DomHelper.createTemplate({tag:"div",cls:"x-resizable-handle x-resizable-handle-{0}"});tpl.compile();Ext.Resizable.Handle.prototype.tpl=tpl}this.position=pos;this.rz=rz;this.el=this.tpl.append(rz.el.dom,[this.position],true);this.el.unselectable();if(transparent){this.el.setOpacity(0)}this.el.on("mousedown",this.onMouseDown,this);if(!disableTrackOver){this.el.on({scope:this,mouseover:this.onMouseOver,mouseout:this.onMouseOut})}};Ext.Resizable.Handle.prototype={afterResize:function(rz){},onMouseDown:function(e){this.rz.onMouseDown(this,e)},onMouseOver:function(e){this.rz.handleOver(this,e)},onMouseOut:function(e){this.rz.handleOut(this,e)},destroy:function(){Ext.destroy(this.el);this.el=null}};Ext.Window=Ext.extend(Ext.Panel,{baseCls:"x-window",resizable:true,draggable:true,closable:true,closeAction:"close",constrain:false,constrainHeader:false,plain:false,minimizable:false,maximizable:false,minHeight:100,minWidth:200,expandOnShow:true,collapsible:false,initHidden:undefined,hidden:true,monitorResize:true,elements:"header,body",frame:true,floating:true,initComponent:function(){this.initTools();Ext.Window.superclass.initComponent.call(this);this.addEvents("resize","maximize","minimize","restore");if(Ext.isDefined(this.initHidden)){this.hidden=this.initHidden}if(this.hidden===false){this.hidden=true;this.show()}},getState:function(){return Ext.apply(Ext.Window.superclass.getState.call(this)||{},this.getBox(true))},onRender:function(ct,position){Ext.Window.superclass.onRender.call(this,ct,position);if(this.plain){this.el.addClass("x-window-plain")}this.focusEl=this.el.createChild({tag:"a",href:"#",cls:"x-dlg-focus",tabIndex:"-1",html:"&#160;"});this.focusEl.swallowEvent("click",true);this.proxy=this.el.createProxy("x-window-proxy");this.proxy.enableDisplayMode("block");if(this.modal){this.mask=this.container.createChild({cls:"ext-el-mask"},this.el.dom);this.mask.enableDisplayMode("block");this.mask.hide();this.mon(this.mask,"click",this.focus,this)}if(this.maximizable){this.mon(this.header,"dblclick",this.toggleMaximize,this)}},initEvents:function(){Ext.Window.superclass.initEvents.call(this);if(this.animateTarget){this.setAnimateTarget(this.animateTarget)}if(this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||"all",pinned:true,resizeElement:this.resizerAction});this.resizer.window=this;this.mon(this.resizer,"beforeresize",this.beforeResize,this)}if(this.draggable){this.header.addClass("x-window-draggable")}this.mon(this.el,"mousedown",this.toFront,this);this.manager=this.manager||Ext.WindowMgr;this.manager.register(this);if(this.maximized){this.maximized=false;this.maximize()}if(this.closable){var km=this.getKeyMap();km.on(27,this.onEsc,this);km.disable()}},initDraggable:function(){this.dd=new Ext.Window.DD(this)},onEsc:function(){this[this.closeAction]()},beforeDestroy:function(){if(this.rendered){this.hide();if(this.doAnchor){Ext.EventManager.removeResizeListener(this.doAnchor,this);Ext.EventManager.un(window,"scroll",this.doAnchor,this)}Ext.destroy(this.focusEl,this.resizer,this.dd,this.proxy,this.mask)}Ext.Window.superclass.beforeDestroy.call(this)},onDestroy:function(){if(this.manager){this.manager.unregister(this)}Ext.Window.superclass.onDestroy.call(this)},initTools:function(){if(this.minimizable){this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])})}if(this.maximizable){this.addTool({id:"maximize",handler:this.maximize.createDelegate(this,[])});this.addTool({id:"restore",handler:this.restore.createDelegate(this,[]),hidden:true})}if(this.closable){this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})}},resizerAction:function(){var box=this.proxy.getBox();this.proxy.hide();this.window.handleResize(box);return box},beforeResize:function(){this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);this.resizeBox=this.el.getBox()},updateHandles:function(){if(Ext.isIE&&this.resizer){this.resizer.syncHandleHeight();this.el.repaint()}},handleResize:function(box){var rz=this.resizeBox;if(rz.x!=box.x||rz.y!=box.y){this.updateBox(box)}else{this.setSize(box)}this.focus();this.updateHandles();this.saveState();this.doLayout()},focus:function(){var f=this.focusEl,db=this.defaultButton,t=typeof db;if(Ext.isDefined(db)){if(Ext.isNumber(db)&&this.fbar){f=this.fbar.items.get(db)}else{if(Ext.isString(db)){f=Ext.getCmp(db)}else{f=db}}}f=f||this.focusEl;f.focus.defer(10,f)},setAnimateTarget:function(el){el=Ext.get(el);this.animateTarget=el},beforeShow:function(){delete this.el.lastXY;delete this.el.lastLT;if(this.x===undefined||this.y===undefined){var xy=this.el.getAlignToXY(this.container,"c-c");var pos=this.el.translatePoints(xy[0],xy[1]);this.x=this.x===undefined?pos.left:this.x;this.y=this.y===undefined?pos.top:this.y}this.el.setLeftTop(this.x,this.y);if(this.expandOnShow){this.expand(false)}if(this.modal){Ext.getBody().addClass("x-body-masked");this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));this.mask.show()}},show:function(animateTarget,cb,scope){if(!this.rendered){this.render(Ext.getBody())}if(this.hidden===false){this.toFront();return this}if(this.fireEvent("beforeshow",this)===false){return this}if(cb){this.on("show",cb,scope,{single:true})}this.hidden=false;if(Ext.isDefined(animateTarget)){this.setAnimateTarget(animateTarget)}this.beforeShow();if(this.animateTarget){this.animShow()}else{this.afterShow()}return this},afterShow:function(isAnim){this.proxy.hide();this.el.setStyle("display","block");this.el.show();if(this.maximized){this.fitContainer()}if(Ext.isMac&&Ext.isGecko){this.cascade(this.setAutoScroll)}if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){Ext.EventManager.onWindowResize(this.onWindowResize,this)}this.doConstrain();this.doLayout();if(this.keyMap){this.keyMap.enable()}this.toFront();this.updateHandles();if(isAnim&&(Ext.isIE||Ext.isWebKit)){var sz=this.getSize();this.onResize(sz.width,sz.height)}this.fireEvent("show",this)},animShow:function(){this.proxy.show();this.proxy.setBox(this.animateTarget.getBox());this.proxy.setOpacity(0);var b=this.getBox();this.el.setStyle("display","none");this.proxy.shift(Ext.apply(b,{callback:this.afterShow.createDelegate(this,[true],false),scope:this,easing:"easeNone",duration:0.25,opacity:0.5}))},hide:function(animateTarget,cb,scope){if(this.hidden||this.fireEvent("beforehide",this)===false){return this}if(cb){this.on("hide",cb,scope,{single:true})}this.hidden=true;if(animateTarget!==undefined){this.setAnimateTarget(animateTarget)}if(this.modal){this.mask.hide();Ext.getBody().removeClass("x-body-masked")}if(this.animateTarget){this.animHide()}else{this.el.hide();this.afterHide()}return this},afterHide:function(){this.proxy.hide();if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){Ext.EventManager.removeResizeListener(this.onWindowResize,this)}if(this.keyMap){this.keyMap.disable()}this.fireEvent("hide",this)},animHide:function(){this.proxy.setOpacity(0.5);this.proxy.show();var tb=this.getBox(false);this.proxy.setBox(tb);this.el.hide();this.proxy.shift(Ext.apply(this.animateTarget.getBox(),{callback:this.afterHide,scope:this,duration:0.25,easing:"easeNone",opacity:0}))},onWindowResize:function(){if(this.maximized){this.fitContainer()}if(this.modal){this.mask.setSize("100%","100%");var force=this.mask.dom.offsetHeight;this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true))}this.doConstrain()},doConstrain:function(){if(this.constrain||this.constrainHeader){var offsets;if(this.constrain){offsets={right:this.el.shadowOffset,left:this.el.shadowOffset,bottom:this.el.shadowOffset}}else{var s=this.getSize();offsets={right:-(s.width-100),bottom:-(s.height-25)}}var xy=this.el.getConstrainToXY(this.container,true,offsets);if(xy){this.setPosition(xy[0],xy[1])}}},ghost:function(cls){var ghost=this.createGhost(cls);var box=this.getBox(true);ghost.setLeftTop(box.x,box.y);ghost.setWidth(box.width);this.el.hide();this.activeGhost=ghost;return ghost},unghost:function(show,matchPosition){if(!this.activeGhost){return}if(show!==false){this.el.show();this.focus();if(Ext.isMac&&Ext.isGecko){this.cascade(this.setAutoScroll)}}if(matchPosition!==false){this.setPosition(this.activeGhost.getLeft(true),this.activeGhost.getTop(true))}this.activeGhost.hide();this.activeGhost.remove();delete this.activeGhost},minimize:function(){this.fireEvent("minimize",this);return this},close:function(){if(this.fireEvent("beforeclose",this)!==false){if(this.hidden){this.doClose()}else{this.hide(null,this.doClose,this)}}},doClose:function(){this.fireEvent("close",this);this.destroy()},maximize:function(){if(!this.maximized){this.expand(false);this.restoreSize=this.getSize();this.restorePos=this.getPosition(true);if(this.maximizable){this.tools.maximize.hide();this.tools.restore.show()}this.maximized=true;this.el.disableShadow();if(this.dd){this.dd.lock()}if(this.collapsible){this.tools.toggle.hide()}this.el.addClass("x-window-maximized");this.container.addClass("x-window-maximized-ct");this.setPosition(0,0);this.fitContainer();this.fireEvent("maximize",this)}return this},restore:function(){if(this.maximized){this.el.removeClass("x-window-maximized");this.tools.restore.hide();this.tools.maximize.show();this.setPosition(this.restorePos[0],this.restorePos[1]);this.setSize(this.restoreSize.width,this.restoreSize.height);delete this.restorePos;delete this.restoreSize;this.maximized=false;this.el.enableShadow(true);if(this.dd){this.dd.unlock()}if(this.collapsible){this.tools.toggle.show()}this.container.removeClass("x-window-maximized-ct");this.doConstrain();this.fireEvent("restore",this)}return this},toggleMaximize:function(){return this[this.maximized?"restore":"maximize"]()},fitContainer:function(){var vs=this.container.getViewSize();this.setSize(vs.width,vs.height)},setZIndex:function(index){if(this.modal){this.mask.setStyle("z-index",index)}this.el.setZIndex(++index);index+=5;if(this.resizer){this.resizer.proxy.setStyle("z-index",++index)}this.lastZIndex=index},alignTo:function(element,position,offsets){var xy=this.el.getAlignToXY(element,position,offsets);this.setPagePosition(xy[0],xy[1]);return this},anchorTo:function(el,alignment,offsets,monitorScroll){if(this.doAnchor){Ext.EventManager.removeResizeListener(this.doAnchor,this);Ext.EventManager.un(window,"scroll",this.doAnchor,this)}this.doAnchor=function(){this.alignTo(el,alignment,offsets)};Ext.EventManager.onWindowResize(this.doAnchor,this);var tm=typeof monitorScroll;if(tm!="undefined"){Ext.EventManager.on(window,"scroll",this.doAnchor,this,{buffer:tm=="number"?monitorScroll:50})}this.doAnchor();return this},toFront:function(e){if(this.manager.bringToFront(this)){if(!e||!e.getTarget().focus){this.focus()}}return this},setActive:function(active){if(active){if(!this.maximized){this.el.enableShadow(true)}this.fireEvent("activate",this)}else{this.el.disableShadow();this.fireEvent("deactivate",this)}},toBack:function(){this.manager.sendToBack(this);return this},center:function(){var xy=this.el.getAlignToXY(this.container,"c-c");this.setPagePosition(xy[0],xy[1]);return this}});Ext.reg("window",Ext.Window);Ext.Window.DD=function(win){this.win=win;Ext.Window.DD.superclass.constructor.call(this,win.el.id,"WindowDD-"+win.id);this.setHandleElId(win.header.id);this.scroll=false};Ext.extend(Ext.Window.DD,Ext.dd.DD,{moveOnly:true,headerOffsets:[100,25],startDrag:function(){var w=this.win;this.proxy=w.ghost();if(w.constrain!==false){var so=w.el.shadowOffset;this.constrainTo(w.container,{right:so,left:so,bottom:so})}else{if(w.constrainHeader!==false){var s=this.proxy.getSize();this.constrainTo(w.container,{right:-(s.width-this.headerOffsets[0]),bottom:-(s.height-this.headerOffsets[1])})}}},b4Drag:Ext.emptyFn,onDrag:function(e){this.alignElWithMouse(this.proxy,e.getPageX(),e.getPageY())},endDrag:function(e){this.win.unghost();this.win.saveState()}});Ext.WindowGroup=function(){var list={};var accessList=[];var front=null;var sortWindows=function(d1,d2){return(!d1.alwaysOnTop&&(d2.alwaysOnTop||!d1._lastAccess||d1._lastAccess<d2._lastAccess))?-1:1};var orderWindows=function(){var a=accessList,len=a.length;if(len>0){a.sort(sortWindows);var seed=a[0].manager.zseed;for(var i=0;i<len;i++){var win=a[i];if(win&&!win.hidden){win.setZIndex(seed+(i*10))}}}activateLast()};var setActiveWin=function(win){if(win!=front){if(front){front.setActive(false)}front=win;if(win){win.setActive(true)}}};var activateLast=function(){for(var i=accessList.length-1;i>=0;--i){if(!accessList[i].hidden){setActiveWin(accessList[i]);return}}setActiveWin(null)};return{zseed:9000,register:function(win){list[win.id]=win;accessList.push(win);win.on("hide",activateLast)},unregister:function(win){delete list[win.id];win.un("hide",activateLast);accessList.remove(win)},get:function(id){return typeof id=="object"?id:list[id]},bringToFront:function(win){win=this.get(win);if(win!=front){win._lastAccess=new Date().getTime();orderWindows();return true}return false},sendToBack:function(win){win=this.get(win);win._lastAccess=-(new Date().getTime());orderWindows();return win},hideAll:function(){for(var id in list){if(list[id]&&typeof list[id]!="function"&&list[id].isVisible()){list[id].hide()}}},getActive:function(){return front},getBy:function(fn,scope){var r=[];for(var i=accessList.length-1;i>=0;--i){var win=accessList[i];if(fn.call(scope||win,win)!==false){r.push(win)}}return r},each:function(fn,scope){for(var id in list){if(list[id]&&typeof list[id]!="function"){if(fn.call(scope||list[id],list[id])===false){return}}}}}};Ext.WindowMgr=new Ext.WindowGroup();Ext.MessageBox=function(){var dlg,opt,mask,waitTimer,bodyEl,msgEl,textboxEl,textareaEl,progressBar,pp,iconEl,spacerEl,buttons,activeTextEl,bwidth,bufferIcon="",iconCls="";var handleButton=function(button){if(dlg.isVisible()){dlg.hide();handleHide();Ext.callback(opt.fn,opt.scope||window,[button,activeTextEl.dom.value,opt],1)}};var handleHide=function(){if(opt&&opt.cls){dlg.el.removeClass(opt.cls)}progressBar.reset()};var handleEsc=function(d,k,e){if(opt&&opt.closable!==false){dlg.hide();handleHide()}if(e){e.stopEvent()}};var updateButtons=function(b){var width=0;if(!b){buttons.ok.hide();buttons.cancel.hide();buttons.yes.hide();buttons.no.hide();return width}dlg.footer.dom.style.display="";for(var k in buttons){if(!Ext.isFunction(buttons[k])){if(b[k]){buttons[k].show();buttons[k].setText(Ext.isString(b[k])?b[k]:Ext.MessageBox.buttonText[k]);width+=buttons[k].el.getWidth()+15}else{buttons[k].hide()}}}return width};return{getDialog:function(titleText){if(!dlg){dlg=new Ext.Window({autoCreate:true,title:titleText,resizable:false,constrain:true,constrainHeader:true,minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:400,height:100,minHeight:80,plain:true,footer:true,closable:true,close:function(){if(opt&&opt.buttons&&opt.buttons.no&&!opt.buttons.cancel){handleButton("no")}else{handleButton("cancel")}}});buttons={};var bt=this.buttonText;buttons.ok=dlg.addButton(bt.ok,handleButton.createCallback("ok"));buttons.yes=dlg.addButton(bt.yes,handleButton.createCallback("yes"));buttons.no=dlg.addButton(bt.no,handleButton.createCallback("no"));buttons.cancel=dlg.addButton(bt.cancel,handleButton.createCallback("cancel"));buttons.ok.hideMode=buttons.yes.hideMode=buttons.no.hideMode=buttons.cancel.hideMode="offsets";dlg.render(document.body);dlg.getEl().addClass("x-window-dlg");mask=dlg.mask;bodyEl=dlg.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});iconEl=Ext.get(bodyEl.dom.firstChild);var contentEl=bodyEl.dom.childNodes[1];msgEl=Ext.get(contentEl.firstChild);textboxEl=Ext.get(contentEl.childNodes[2].firstChild);textboxEl.enableDisplayMode();textboxEl.addKeyListener([10,13],function(){if(dlg.isVisible()&&opt&&opt.buttons){if(opt.buttons.ok){handleButton("ok")}else{if(opt.buttons.yes){handleButton("yes")}}}});textareaEl=Ext.get(contentEl.childNodes[2].childNodes[1]);textareaEl.enableDisplayMode();progressBar=new Ext.ProgressBar({renderTo:bodyEl});bodyEl.createChild({cls:"x-clear"})}return dlg},updateText:function(text){if(!dlg.isVisible()&&!opt.width){dlg.setSize(this.maxWidth,100)}msgEl.update(text||"&#160;");var iw=iconCls!=""?(iconEl.getWidth()+iconEl.getMargins("lr")):0;var mw=msgEl.getWidth()+msgEl.getMargins("lr");var fw=dlg.getFrameWidth("lr");var bw=dlg.body.getFrameWidth("lr");if(Ext.isIE&&iw>0){iw+=3}var w=Math.max(Math.min(opt.width||iw+mw+fw+bw,this.maxWidth),Math.max(opt.minWidth||this.minWidth,bwidth||0));if(opt.prompt===true){activeTextEl.setWidth(w-iw-fw-bw)}if(opt.progress===true||opt.wait===true){progressBar.setSize(w-iw-fw-bw)}if(Ext.isIE&&w==bwidth){w+=4}dlg.setSize(w,"auto").center();return this},updateProgress:function(value,progressText,msg){progressBar.updateProgress(value,progressText);if(msg){this.updateText(msg)}return this},isVisible:function(){return dlg&&dlg.isVisible()},hide:function(){var proxy=dlg?dlg.activeGhost:null;if(this.isVisible()||proxy){dlg.hide();handleHide();if(proxy){dlg.unghost(false,false)}}return this},show:function(options){if(this.isVisible()){this.hide()}opt=options;var d=this.getDialog(opt.title||"&#160;");d.setTitle(opt.title||"&#160;");var allowClose=(opt.closable!==false&&opt.progress!==true&&opt.wait!==true);d.tools.close.setDisplayed(allowClose);activeTextEl=textboxEl;opt.prompt=opt.prompt||(opt.multiline?true:false);if(opt.prompt){if(opt.multiline){textboxEl.hide();textareaEl.show();textareaEl.setHeight(Ext.isNumber(opt.multiline)?opt.multiline:this.defaultTextHeight);activeTextEl=textareaEl}else{textboxEl.show();textareaEl.hide()}}else{textboxEl.hide();textareaEl.hide()}activeTextEl.dom.value=opt.value||"";if(opt.prompt){d.focusEl=activeTextEl}else{var bs=opt.buttons;var db=null;if(bs&&bs.ok){db=buttons.ok}else{if(bs&&bs.yes){db=buttons.yes}}if(db){d.focusEl=db}}if(opt.iconCls){d.setIconClass(opt.iconCls)}this.setIcon(Ext.isDefined(opt.icon)?opt.icon:bufferIcon);bwidth=updateButtons(opt.buttons);progressBar.setVisible(opt.progress===true||opt.wait===true);this.updateProgress(0,opt.progressText);this.updateText(opt.msg);if(opt.cls){d.el.addClass(opt.cls)}d.proxyDrag=opt.proxyDrag===true;d.modal=opt.modal!==false;d.mask=opt.modal!==false?mask:false;if(!d.isVisible()){document.body.appendChild(dlg.el.dom);d.setAnimateTarget(opt.animEl);d.show(opt.animEl)}d.on("show",function(){if(allowClose===true){d.keyMap.enable()}else{d.keyMap.disable()}},this,{single:true});if(opt.wait===true){progressBar.wait(opt.waitConfig)}return this},setIcon:function(icon){if(!dlg){bufferIcon=icon;return}bufferIcon=undefined;if(icon&&icon!=""){iconEl.removeClass("x-hidden");iconEl.replaceClass(iconCls,icon);bodyEl.addClass("x-dlg-icon");iconCls=icon}else{iconEl.replaceClass(iconCls,"x-hidden");bodyEl.removeClass("x-dlg-icon");iconCls=""}return this},progress:function(title,msg,progressText){this.show({title:title,msg:msg,buttons:false,progress:true,closable:false,minWidth:this.minProgressWidth,progressText:progressText});return this},wait:function(msg,title,config){this.show({title:title,msg:msg,buttons:false,closable:false,wait:true,modal:true,minWidth:this.minProgressWidth,waitConfig:config});return this},alert:function(title,msg,fn,scope){this.show({title:title,msg:msg,buttons:this.OK,fn:fn,scope:scope});return this},confirm:function(title,msg,fn,scope){this.show({title:title,msg:msg,buttons:this.YESNO,fn:fn,scope:scope,icon:this.QUESTION});return this},prompt:function(title,msg,fn,scope,multiline,value){this.show({title:title,msg:msg,buttons:this.OKCANCEL,fn:fn,minWidth:250,scope:scope,prompt:true,multiline:multiline,value:value});return this},OK:{ok:true},CANCEL:{cancel:true},OKCANCEL:{ok:true,cancel:true},YESNO:{yes:true,no:true},YESNOCANCEL:{yes:true,no:true,cancel:true},INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",defaultTextHeight:75,maxWidth:600,minWidth:100,minProgressWidth:250,buttonText:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}}}();Ext.Msg=Ext.MessageBox;Ext.dd.PanelProxy=function(panel,config){this.panel=panel;this.id=this.panel.id+"-ddproxy";Ext.apply(this,config)};Ext.dd.PanelProxy.prototype={insertProxy:true,setStatus:Ext.emptyFn,reset:Ext.emptyFn,update:Ext.emptyFn,stop:Ext.emptyFn,sync:Ext.emptyFn,getEl:function(){return this.ghost},getGhost:function(){return this.ghost},getProxy:function(){return this.proxy},hide:function(){if(this.ghost){if(this.proxy){this.proxy.remove();delete this.proxy}if(this.panel.el.dom){this.panel.el.dom.style.display=""}this.ghost.remove();delete this.ghost}},show:function(){if(!this.ghost){this.ghost=this.panel.createGhost(undefined,undefined,Ext.getBody());this.ghost.setXY(this.panel.el.getXY());if(this.insertProxy){this.proxy=this.panel.el.insertSibling({cls:"x-panel-dd-spacer"});this.proxy.setSize(this.panel.getSize())}this.panel.el.dom.style.display="none"}},repair:function(xy,callback,scope){this.hide();if(typeof callback=="function"){callback.call(scope||this)}},moveProxy:function(parentNode,before){if(this.proxy){parentNode.insertBefore(this.proxy.dom,before)}}};Ext.Panel.DD=function(panel,cfg){this.panel=panel;this.dragData={panel:panel};this.proxy=new Ext.dd.PanelProxy(panel,cfg);Ext.Panel.DD.superclass.constructor.call(this,panel.el,cfg);var h=panel.header;if(h){this.setHandleElId(h.id)}(h?h:this.panel.body).setStyle("cursor","move");this.scroll=false};Ext.extend(Ext.Panel.DD,Ext.dd.DragSource,{showFrame:Ext.emptyFn,startDrag:Ext.emptyFn,b4StartDrag:function(x,y){this.proxy.show()},b4MouseDown:function(e){var x=e.getPageX();var y=e.getPageY();this.autoOffset(x,y)},onInitDrag:function(x,y){this.onStartDrag(x,y);return true},createFrame:Ext.emptyFn,getDragEl:function(e){return this.proxy.ghost.dom},endDrag:function(e){this.proxy.hide();this.panel.saveState()},autoOffset:function(x,y){x-=this.startPageX;y-=this.startPageY;this.setDelta(x,y)}});Ext.state.Provider=function(){this.addEvents("statechange");this.state={};Ext.state.Provider.superclass.constructor.call(this)};Ext.extend(Ext.state.Provider,Ext.util.Observable,{get:function(name,defaultValue){return typeof this.state[name]=="undefined"?defaultValue:this.state[name]},clear:function(name){delete this.state[name];this.fireEvent("statechange",this,name,null)},set:function(name,value){this.state[name]=value;this.fireEvent("statechange",this,name,value)},decodeValue:function(cookie){var re=/^(a|n|d|b|s|o)\:(.*)$/;var matches=re.exec(unescape(cookie));if(!matches||!matches[1]){return}var type=matches[1];var v=matches[2];switch(type){case"n":return parseFloat(v);case"d":return new Date(Date.parse(v));case"b":return(v=="1");case"a":var all=[];if(v!=""){Ext.each(v.split("^"),function(val){all.push(this.decodeValue(val))},this)}return all;case"o":var all={};if(v!=""){Ext.each(v.split("^"),function(val){var kv=val.split("=");all[kv[0]]=this.decodeValue(kv[1])},this)}return all;default:return v}},encodeValue:function(v){var enc;if(typeof v=="number"){enc="n:"+v}else{if(typeof v=="boolean"){enc="b:"+(v?"1":"0")}else{if(Ext.isDate(v)){enc="d:"+v.toGMTString()}else{if(Ext.isArray(v)){var flat="";for(var i=0,len=v.length;i<len;i++){flat+=this.encodeValue(v[i]);if(i!=len-1){flat+="^"}}enc="a:"+flat}else{if(typeof v=="object"){var flat="";for(var key in v){if(typeof v[key]!="function"&&v[key]!==undefined){flat+=key+"="+this.encodeValue(v[key])+"^"}}enc="o:"+flat.substring(0,flat.length-1)}else{enc="s:"+v}}}}}return escape(enc)}});Ext.state.Manager=function(){var provider=new Ext.state.Provider();return{setProvider:function(stateProvider){provider=stateProvider},get:function(key,defaultValue){return provider.get(key,defaultValue)},set:function(key,value){provider.set(key,value)},clear:function(key){provider.clear(key)},getProvider:function(){return provider}}}();Ext.state.CookieProvider=function(config){Ext.state.CookieProvider.superclass.constructor.call(this);this.path="/";this.expires=new Date(new Date().getTime()+(1000*60*60*24*7));this.domain=null;this.secure=false;Ext.apply(this,config);this.state=this.readCookies()};Ext.extend(Ext.state.CookieProvider,Ext.state.Provider,{set:function(name,value){if(typeof value=="undefined"||value===null){this.clear(name);return}this.setCookie(name,value);Ext.state.CookieProvider.superclass.set.call(this,name,value)},clear:function(name){this.clearCookie(name);Ext.state.CookieProvider.superclass.clear.call(this,name)},readCookies:function(){var cookies={};var c=document.cookie+";";var re=/\s?(.*?)=(.*?);/g;var matches;while((matches=re.exec(c))!=null){var name=matches[1];var value=matches[2];if(name&&name.substring(0,3)=="ys-"){cookies[name.substr(3)]=this.decodeValue(value)}}return cookies},setCookie:function(name,value){document.cookie="ys-"+name+"="+this.encodeValue(value)+((this.expires==null)?"":("; expires="+this.expires.toGMTString()))+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")},clearCookie:function(name){document.cookie="ys-"+name+"=null; expires=Thu, 01-Jan-70 00:00:01 GMT"+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")}});Ext.DataView=Ext.extend(Ext.BoxComponent,{selectedClass:"x-view-selected",emptyText:"",deferEmptyText:true,trackOver:false,last:false,initComponent:function(){Ext.DataView.superclass.initComponent.call(this);if(Ext.isString(this.tpl)||Ext.isArray(this.tpl)){this.tpl=new Ext.XTemplate(this.tpl)}this.addEvents("beforeclick","click","mouseenter","mouseleave","containerclick","dblclick","contextmenu","containercontextmenu","selectionchange","beforeselect");this.store=Ext.StoreMgr.lookup(this.store);this.all=new Ext.CompositeElementLite();this.selected=new Ext.CompositeElementLite()},afterRender:function(){Ext.DataView.superclass.afterRender.call(this);this.mon(this.getTemplateTarget(),{click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu,scope:this});if(this.overClass||this.trackOver){this.mon(this.getTemplateTarget(),{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this})}if(this.store){this.bindStore(this.store,true)}},refresh:function(){this.clearSelections(false,true);var el=this.getTemplateTarget();el.update("");var records=this.store.getRange();if(records.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){el.update(this.emptyText)}this.all.clear()}else{this.tpl.overwrite(el,this.collectData(records,0));this.all.fill(Ext.query(this.itemSelector,el.dom));this.updateIndexes(0)}this.hasSkippedEmptyText=true},getTemplateTarget:function(){return this.el},prepareData:function(data){return data},collectData:function(records,startIndex){var r=[];for(var i=0,len=records.length;i<len;i++){r[r.length]=this.prepareData(records[i].data,startIndex+i,records[i])}return r},bufferRender:function(records){var div=document.createElement("div");this.tpl.overwrite(div,this.collectData(records));return Ext.query(this.itemSelector,div)},onUpdate:function(ds,record){var index=this.store.indexOf(record);if(index>-1){var sel=this.isSelected(index);var original=this.all.elements[index];var node=this.bufferRender([record],index)[0];this.all.replaceElement(index,node,true);if(sel){this.selected.replaceElement(original,node);this.all.item(index).addClass(this.selectedClass)}this.updateIndexes(index,index)}},onAdd:function(ds,records,index){if(this.all.getCount()===0){this.refresh();return}var nodes=this.bufferRender(records,index),n,a=this.all.elements;if(index<this.all.getCount()){n=this.all.item(index).insertSibling(nodes,"before",true);a.splice.apply(a,[index,0].concat(nodes))}else{n=this.all.last().insertSibling(nodes,"after",true);a.push.apply(a,nodes)}this.updateIndexes(index)},onRemove:function(ds,record,index){this.deselect(index);this.all.removeElement(index,true);this.updateIndexes(index);if(this.store.getCount()===0){this.refresh()}},refreshNode:function(index){this.onUpdate(this.store,this.store.getAt(index))},updateIndexes:function(startIndex,endIndex){var ns=this.all.elements;startIndex=startIndex||0;endIndex=endIndex||((endIndex===0)?0:(ns.length-1));for(var i=startIndex;i<=endIndex;i++){ns[i].viewIndex=i}},getStore:function(){return this.store},bindStore:function(store,initial){if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("datachanged",this.refresh,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(!store){this.store=null}}if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,beforeload:this.onBeforeLoad,datachanged:this.refresh,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh})}this.store=store;if(store){this.refresh()}},findItemFromChild:function(node){return Ext.fly(node).findParent(this.itemSelector,this.getTemplateTarget())},onClick:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){var index=this.indexOf(item);if(this.onItemClick(item,index,e)!==false){this.fireEvent("click",this,index,item,e)}}else{if(this.fireEvent("containerclick",this,e)!==false){this.onContainerClick(e)}}},onContainerClick:function(e){this.clearSelections()},onContextMenu:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){this.fireEvent("contextmenu",this,this.indexOf(item),item,e)}else{this.fireEvent("containercontextmenu",this,e)}},onDblClick:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item){this.fireEvent("dblclick",this,this.indexOf(item),item,e)}},onMouseOver:function(e){var item=e.getTarget(this.itemSelector,this.getTemplateTarget());if(item&&item!==this.lastItem){this.lastItem=item;Ext.fly(item).addClass(this.overClass);this.fireEvent("mouseenter",this,this.indexOf(item),item,e)}},onMouseOut:function(e){if(this.lastItem){if(!e.within(this.lastItem,true,true)){Ext.fly(this.lastItem).removeClass(this.overClass);this.fireEvent("mouseleave",this,this.indexOf(this.lastItem),this.lastItem,e);delete this.lastItem}}},onItemClick:function(item,index,e){if(this.fireEvent("beforeclick",this,index,item,e)===false){return false}if(this.multiSelect){this.doMultiSelection(item,index,e);e.preventDefault()}else{if(this.singleSelect){this.doSingleSelection(item,index,e);e.preventDefault()}}return true},doSingleSelection:function(item,index,e){if(e.ctrlKey&&this.isSelected(index)){this.deselect(index)}else{this.select(index,false)}},doMultiSelection:function(item,index,e){if(e.shiftKey&&this.last!==false){var last=this.last;this.selectRange(last,index,e.ctrlKey);this.last=last}else{if((e.ctrlKey||this.simpleSelect)&&this.isSelected(index)){this.deselect(index)}else{this.select(index,e.ctrlKey||e.shiftKey||this.simpleSelect)}}},getSelectionCount:function(){return this.selected.getCount()},getSelectedNodes:function(){return this.selected.elements},getSelectedIndexes:function(){var indexes=[],s=this.selected.elements;for(var i=0,len=s.length;i<len;i++){indexes.push(s[i].viewIndex)}return indexes},getSelectedRecords:function(){var r=[],s=this.selected.elements;for(var i=0,len=s.length;i<len;i++){r[r.length]=this.store.getAt(s[i].viewIndex)}return r},getRecords:function(nodes){var r=[],s=nodes;for(var i=0,len=s.length;i<len;i++){r[r.length]=this.store.getAt(s[i].viewIndex)}return r},getRecord:function(node){return this.store.getAt(node.viewIndex)},clearSelections:function(suppressEvent,skipUpdate){if((this.multiSelect||this.singleSelect)&&this.selected.getCount()>0){if(!skipUpdate){this.selected.removeClass(this.selectedClass)}this.selected.clear();this.last=false;if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements)}}},isSelected:function(node){return this.selected.contains(this.getNode(node))},deselect:function(node){if(this.isSelected(node)){node=this.getNode(node);this.selected.removeElement(node);if(this.last==node.viewIndex){this.last=false}Ext.fly(node).removeClass(this.selectedClass);this.fireEvent("selectionchange",this,this.selected.elements)}},select:function(nodeInfo,keepExisting,suppressEvent){if(Ext.isArray(nodeInfo)){if(!keepExisting){this.clearSelections(true)}for(var i=0,len=nodeInfo.length;i<len;i++){this.select(nodeInfo[i],true,true)}if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements)}}else{var node=this.getNode(nodeInfo);if(!keepExisting){this.clearSelections(true)}if(node&&!this.isSelected(node)){if(this.fireEvent("beforeselect",this,node,this.selected.elements)!==false){Ext.fly(node).addClass(this.selectedClass);this.selected.add(node);this.last=node.viewIndex;if(!suppressEvent){this.fireEvent("selectionchange",this,this.selected.elements)}}}}},selectRange:function(start,end,keepExisting){if(!keepExisting){this.clearSelections(true)}this.select(this.getNodes(start,end),true)},getNode:function(nodeInfo){if(Ext.isString(nodeInfo)){return document.getElementById(nodeInfo)}else{if(Ext.isNumber(nodeInfo)){return this.all.elements[nodeInfo]}}return nodeInfo},getNodes:function(start,end){var ns=this.all.elements;start=start||0;end=!Ext.isDefined(end)?Math.max(ns.length-1,0):end;var nodes=[],i;if(start<=end){for(i=start;i<=end&&ns[i];i++){nodes.push(ns[i])}}else{for(i=start;i>=end&&ns[i];i--){nodes.push(ns[i])}}return nodes},indexOf:function(node){node=this.getNode(node);if(Ext.isNumber(node.viewIndex)){return node.viewIndex}return this.all.indexOf(node)},onBeforeLoad:function(){if(this.loadingText){this.clearSelections(false,true);this.getTemplateTarget().update('<div class="loading-indicator">'+this.loadingText+"</div>");this.all.clear()}},onDestroy:function(){Ext.DataView.superclass.onDestroy.call(this);this.bindStore(null)}});Ext.DataView.prototype.setStore=Ext.DataView.prototype.bindStore;Ext.reg("dataview",Ext.DataView);Ext.ListView=Ext.extend(Ext.DataView,{itemSelector:"dl",selectedClass:"x-list-selected",overClass:"x-list-over",scrollOffset:undefined,columnResize:true,columnSort:true,maxWidth:Ext.isIE?99:100,initComponent:function(){if(this.columnResize){this.colResizer=new Ext.ListView.ColumnResizer(this.colResizer);this.colResizer.init(this)}if(this.columnSort){this.colSorter=new Ext.ListView.Sorter(this.columnSort);this.colSorter.init(this)}if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{width}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">',"{header}","</em></div>","</tpl>",'<div class="x-clear"></div>',"</div></div>",'<div class="x-list-body"><div class="x-list-body-inner">',"</div></div>")}if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="rows">',"<dl>",'<tpl for="parent.columns">','<dt style="width:{width}%;text-align:{align};"><em unselectable="on">',"{[values.tpl.apply(parent)]}","</em></dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>")}var cs=this.columns,allocatedWidth=0,colsWithWidth=0,len=cs.length,columns=[];for(var i=0;i<len;i++){var c=Ext.apply({},cs[i]);if(!c.tpl){c.tpl=new Ext.XTemplate("{"+c.dataIndex+"}")}else{if(Ext.isString(c.tpl)){c.tpl=new Ext.XTemplate(c.tpl)}}c.align=c.align||"left";if(Ext.isNumber(c.width)){c.width*=100;allocatedWidth+=c.width;colsWithWidth++}columns.push(c)}cs=this.columns=columns;if(colsWithWidth<len){var remaining=len-colsWithWidth;if(allocatedWidth<this.maxWidth){var perCol=((this.maxWidth-allocatedWidth)/remaining);for(var j=0;j<len;j++){var c=cs[j];if(!Ext.isNumber(c.width)){c.width=perCol}}}}Ext.ListView.superclass.initComponent.call(this)},onRender:function(){this.autoEl={cls:"x-list-wrap"};Ext.ListView.superclass.onRender.apply(this,arguments);this.internalTpl.overwrite(this.el,{columns:this.columns});this.innerBody=Ext.get(this.el.dom.childNodes[1].firstChild);this.innerHd=Ext.get(this.el.dom.firstChild.firstChild);if(this.hideHeaders){this.el.dom.firstChild.style.display="none"}},getTemplateTarget:function(){return this.innerBody},collectData:function(){var rs=Ext.ListView.superclass.collectData.apply(this,arguments);return{columns:this.columns,rows:rs}},verifyInternalSize:function(){if(this.lastSize){this.onResize(this.lastSize.width,this.lastSize.height)}},onResize:function(w,h){var bd=this.innerBody.dom;var hd=this.innerHd.dom;if(!bd){return}var bdp=bd.parentNode;if(Ext.isNumber(w)){var sw=w-Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((bdp.offsetWidth-bdp.clientWidth)>10)){bd.style.width=sw+"px";hd.style.width=sw+"px"}else{bd.style.width=w+"px";hd.style.width=w+"px";setTimeout(function(){if((bdp.offsetWidth-bdp.clientWidth)>10){bd.style.width=sw+"px";hd.style.width=sw+"px"}},10)}}if(Ext.isNumber(h)){bdp.style.height=(h-hd.parentNode.offsetHeight)+"px"}},updateIndexes:function(){Ext.ListView.superclass.updateIndexes.apply(this,arguments);this.verifyInternalSize()},findHeaderIndex:function(hd){hd=hd.dom||hd;var pn=hd.parentNode,cs=pn.parentNode.childNodes;for(var i=0,c;c=cs[i];i++){if(c==pn){return i}}return -1},setHdWidths:function(){var els=this.innerHd.dom.getElementsByTagName("div");for(var i=0,cs=this.columns,len=cs.length;i<len;i++){els[i].style.width=cs[i].width+"%"}}});Ext.reg("listview",Ext.ListView);Ext.ListView.ColumnResizer=Ext.extend(Ext.util.Observable,{minPct:0.05,constructor:function(config){Ext.apply(this,config);Ext.ListView.ColumnResizer.superclass.constructor.call(this)},init:function(listView){this.view=listView;listView.on("render",this.initEvents,this)},initEvents:function(view){view.mon(view.innerHd,"mousemove",this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(view.innerHd);view.on("beforedestroy",this.tracker.destroy,this.tracker)},handleHdMove:function(e,t){var hw=5,x=e.getPageX(),hd=e.getTarget("em",3,true);if(hd){var r=hd.getRegion(),ss=hd.dom.style,pn=hd.dom.parentNode;if(x-r.left<=hw&&pn!=pn.parentNode.firstChild){this.activeHd=Ext.get(pn.previousSibling.firstChild);ss.cursor=Ext.isWebKit?"e-resize":"col-resize"}else{if(r.right-x<=hw&&pn!=pn.parentNode.lastChild.previousSibling){this.activeHd=hd;ss.cursor=Ext.isWebKit?"w-resize":"col-resize"}else{delete this.activeHd;ss.cursor=""}}}},onBeforeStart:function(e){this.dragHd=this.activeHd;return !!this.dragHd},onStart:function(e){this.view.disableHeaders=true;this.proxy=this.view.el.createChild({cls:"x-list-resizer"});this.proxy.setHeight(this.view.el.getHeight());var x=this.tracker.getXY()[0],w=this.view.innerHd.getWidth();this.hdX=this.dragHd.getX();this.hdIndex=this.view.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(x-this.hdX);this.minWidth=w*this.minPct;this.maxWidth=w-(this.minWidth*(this.view.columns.length-1-this.hdIndex))},onDrag:function(e){var cursorX=this.tracker.getXY()[0];this.proxy.setWidth((cursorX-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(e){var nw=this.proxy.getWidth();this.proxy.remove();var index=this.hdIndex,vw=this.view,cs=vw.columns,len=cs.length,w=this.view.innerHd.getWidth(),minPct=this.minPct*100;pct=Math.ceil((nw*vw.maxWidth)/w),diff=cs[index].width-pct,each=Math.floor(diff/(len-1-index)),mod=diff-(each*(len-1-index));for(var i=index+1;i<len;i++){var cw=cs[i].width+each,ncw=Math.max(minPct,cw);if(cw!=ncw){mod+=cw-ncw}cs[i].width=ncw}cs[index].width=pct;cs[index+1].width+=mod;delete this.dragHd;vw.setHdWidths();vw.refresh();setTimeout(function(){vw.disableHeaders=false},100)}});Ext.ListView.Sorter=Ext.extend(Ext.util.Observable,{sortClasses:["sort-asc","sort-desc"],constructor:function(config){Ext.apply(this,config);Ext.ListView.Sorter.superclass.constructor.call(this)},init:function(listView){this.view=listView;listView.on("render",this.initEvents,this)},initEvents:function(view){view.mon(view.innerHd,"click",this.onHdClick,this);view.innerHd.setStyle("cursor","pointer");view.mon(view.store,"datachanged",this.updateSortState,this);this.updateSortState.defer(10,this,[view.store])},updateSortState:function(store){var state=store.getSortState();if(!state){return}this.sortState=state;var cs=this.view.columns,sortColumn=-1;for(var i=0,len=cs.length;i<len;i++){if(cs[i].dataIndex==state.field){sortColumn=i;break}}if(sortColumn!=-1){var sortDir=state.direction;this.updateSortIcon(sortColumn,sortDir)}},updateSortIcon:function(col,dir){var sc=this.sortClasses;var hds=this.view.innerHd.select("em").removeClass(sc);hds.item(col).addClass(sc[dir=="DESC"?1:0])},onHdClick:function(e){var hd=e.getTarget("em",3);if(hd&&!this.view.disableHeaders){var index=this.view.findHeaderIndex(hd);this.view.store.sort(this.view.columns[index].dataIndex)}}});Ext.TabPanel=Ext.extend(Ext.Panel,{monitorResize:true,deferredRender:true,tabWidth:120,minTabWidth:30,resizeTabs:false,enableTabScroll:false,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,tabPosition:"top",baseCls:"x-tab-panel",autoTabs:false,autoTabSelector:"div.x-tab",activeTab:null,tabMargin:2,plain:false,wheelIncrement:20,idDelimiter:"__",itemCls:"x-tab-item",elements:"body",headerAsText:false,frame:false,hideBorders:true,initComponent:function(){this.frame=false;Ext.TabPanel.superclass.initComponent.call(this);this.addEvents("beforetabchange","tabchange","contextmenu");this.setLayout(new Ext.layout.CardLayout(Ext.apply({layoutOnCardChange:this.layoutOnTabChange,deferredRender:this.deferredRender},this.layoutConfig)));if(this.tabPosition=="top"){this.elements+=",header";this.stripTarget="header"}else{this.elements+=",footer";this.stripTarget="footer"}if(!this.stack){this.stack=Ext.TabPanel.AccessStack()}this.initItems()},onRender:function(ct,position){Ext.TabPanel.superclass.onRender.call(this,ct,position);if(this.plain){var pos=this.tabPosition=="top"?"header":"footer";this[pos].addClass("x-tab-panel-"+pos+"-plain")}var st=this[this.stripTarget];this.stripWrap=st.createChild({cls:"x-tab-strip-wrap",cn:{tag:"ul",cls:"x-tab-strip x-tab-strip-"+this.tabPosition}});var beforeEl=(this.tabPosition=="bottom"?this.stripWrap:null);this.stripSpacer=st.createChild({cls:"x-tab-strip-spacer"},beforeEl);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"x-tab-edge"});this.strip.createChild({cls:"x-clear"});this.body.addClass("x-tab-panel-body-"+this.tabPosition);if(!this.itemTpl){var tt=new Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close" onclick="return false;"></a>','<a class="x-tab-right" href="#" onclick="return false;"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',"</em></a></li>");tt.disableFormats=true;tt.compile();Ext.TabPanel.prototype.itemTpl=tt}this.items.each(this.initTab,this)},afterRender:function(){Ext.TabPanel.superclass.afterRender.call(this);if(this.autoTabs){this.readTabs(false)}if(this.activeTab!==undefined){var item=Ext.isObject(this.activeTab)?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(item)}},initEvents:function(){Ext.TabPanel.superclass.initEvents.call(this);this.mon(this.strip,{scope:this,mousedown:this.onStripMouseDown,contextmenu:this.onStripContextMenu});if(this.enableTabScroll){this.mon(this.strip,"mousewheel",this.onWheel,this)}},findTargets:function(e){var item=null;var itemEl=e.getTarget("li",this.strip);if(itemEl){item=this.getComponent(itemEl.id.split(this.idDelimiter)[1]);if(item.disabled){return{close:null,item:null,el:null}}}return{close:e.getTarget(".x-tab-strip-close",this.strip),item:item,el:itemEl}},onStripMouseDown:function(e){if(e.button!==0){return}e.preventDefault();var t=this.findTargets(e);if(t.close){if(t.item.fireEvent("beforeclose",t.item)!==false){t.item.fireEvent("close",t.item);delete t.item.tabEl;this.remove(t.item)}return}if(t.item&&t.item!=this.activeTab){this.setActiveTab(t.item)}},onStripContextMenu:function(e){e.preventDefault();var t=this.findTargets(e);if(t.item){this.fireEvent("contextmenu",this,t.item,e)}},readTabs:function(removeExisting){if(removeExisting===true){this.items.each(function(item){this.remove(item)},this)}var tabs=this.el.query(this.autoTabSelector);for(var i=0,len=tabs.length;i<len;i++){var tab=tabs[i];var title=tab.getAttribute("title");tab.removeAttribute("title");this.add({title:title,contentEl:tab})}},initTab:function(item,index){var before=this.strip.dom.childNodes[index];var p=this.getTemplateArgs(item);var el=before?this.itemTpl.insertBefore(before,p):this.itemTpl.append(this.strip,p);Ext.fly(el).addClassOnOver("x-tab-strip-over");if(item.tabTip){Ext.fly(el).child("span.x-tab-strip-text",true).qtip=item.tabTip}item.tabEl=el;item.on("disable",this.onItemDisabled,this);item.on("enable",this.onItemEnabled,this);item.on("titlechange",this.onItemTitleChanged,this);item.on("iconchange",this.onItemIconChanged,this);item.on("beforeshow",this.onBeforeShowItem,this)},getTemplateArgs:function(item){var cls=item.closable?"x-tab-strip-closable":"";if(item.disabled){cls+=" x-item-disabled"}if(item.iconCls){cls+=" x-tab-with-icon"}if(item.tabCls){cls+=" "+item.tabCls}return{id:this.id+this.idDelimiter+item.getItemId(),text:item.title,cls:cls,iconCls:item.iconCls||""}},onAdd:function(c){Ext.TabPanel.superclass.onAdd.call(this,c);if(this.rendered){var items=this.items;this.initTab(c,items.indexOf(c));if(items.getCount()==1){this.syncSize()}this.delegateUpdates()}},onBeforeAdd:function(item){var existing=item.events?(this.items.containsKey(item.getItemId())?item:null):this.items.get(item);if(existing){this.setActiveTab(item);return false}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var es=item.elements;item.elements=es?es.replace(",header",""):es;item.border=(item.border===true)},onRemove:function(c){Ext.TabPanel.superclass.onRemove.call(this,c);Ext.destroy(Ext.get(this.getTabEl(c)));this.stack.remove(c);c.un("disable",this.onItemDisabled,this);c.un("enable",this.onItemEnabled,this);c.un("titlechange",this.onItemTitleChanged,this);c.un("iconchange",this.onItemIconChanged,this);c.un("beforeshow",this.onBeforeShowItem,this);if(c==this.activeTab){var next=this.stack.next();if(next){this.setActiveTab(next)}else{if(this.items.getCount()>0){this.setActiveTab(0)}else{this.activeTab=null}}}this.delegateUpdates()},onBeforeShowItem:function(item){if(item!=this.activeTab){this.setActiveTab(item);return false}},onItemDisabled:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).addClass("x-item-disabled")}this.stack.remove(item)},onItemEnabled:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).removeClass("x-item-disabled")}},onItemTitleChanged:function(item){var el=this.getTabEl(item);if(el){Ext.fly(el).child("span.x-tab-strip-text",true).innerHTML=item.title}},onItemIconChanged:function(item,iconCls,oldCls){var el=this.getTabEl(item);if(el){el=Ext.get(el);el.child("span.x-tab-strip-text").replaceClass(oldCls,iconCls);el[Ext.isEmpty(iconCls)?"removeClass":"addClass"]("x-tab-with-icon")}},getTabEl:function(item){return document.getElementById(this.id+this.idDelimiter+this.getComponent(item).getItemId())},onResize:function(){Ext.TabPanel.superclass.onResize.apply(this,arguments);this.delegateUpdates()},beginUpdate:function(){this.suspendUpdates=true},endUpdate:function(){this.suspendUpdates=false;this.delegateUpdates()},hideTabStripItem:function(item){item=this.getComponent(item);var el=this.getTabEl(item);if(el){el.style.display="none";this.delegateUpdates()}this.stack.remove(item)},unhideTabStripItem:function(item){item=this.getComponent(item);var el=this.getTabEl(item);if(el){el.style.display="";this.delegateUpdates()}},delegateUpdates:function(){if(this.suspendUpdates){return}if(this.resizeTabs&&this.rendered){this.autoSizeTabs()}if(this.enableTabScroll&&this.rendered){this.autoScrollTabs()}},autoSizeTabs:function(){var count=this.items.length;var ce=this.tabPosition!="bottom"?"header":"footer";var ow=this[ce].dom.offsetWidth;var aw=this[ce].dom.clientWidth;if(!this.resizeTabs||count<1||!aw){return}var each=Math.max(Math.min(Math.floor((aw-4)/count)-this.tabMargin,this.tabWidth),this.minTabWidth);this.lastTabWidth=each;var lis=this.strip.query("li:not([className^=x-tab-edge])");for(var i=0,len=lis.length;i<len;i++){var li=lis[i];var inner=Ext.fly(li).child(".x-tab-strip-inner",true);var tw=li.offsetWidth;var iw=inner.offsetWidth;inner.style.width=(each-(tw-iw))+"px"}},adjustBodyWidth:function(w){if(this.header){this.header.setWidth(w)}if(this.footer){this.footer.setWidth(w)}return w},setActiveTab:function(item){item=this.getComponent(item);if(!item||this.fireEvent("beforetabchange",this,item,this.activeTab)===false){return}if(!this.rendered){this.activeTab=item;return}if(this.activeTab!=item){if(this.activeTab){var oldEl=this.getTabEl(this.activeTab);if(oldEl){Ext.fly(oldEl).removeClass("x-tab-strip-active")}this.activeTab.fireEvent("deactivate",this.activeTab)}var el=this.getTabEl(item);Ext.fly(el).addClass("x-tab-strip-active");this.activeTab=item;this.stack.add(item);this.layout.setActiveItem(item);if(this.scrolling){this.scrollToTab(item,this.animScroll)}item.fireEvent("activate",item);this.fireEvent("tabchange",this,item)}},getActiveTab:function(){return this.activeTab||null},getItem:function(item){return this.getComponent(item)},autoScrollTabs:function(){this.pos=this.tabPosition=="bottom"?this.footer:this.header;var count=this.items.length;var ow=(this.tabPosition=="bottom"?this.footer:this.header).dom.offsetWidth;var tw=(this.tabPosition=="bottom"?this.footer:this.header).dom.clientWidth;var wrap=this.stripWrap;var wd=wrap.dom;var cw=wd.offsetWidth;var pos=this.getScrollPos();var l=this.edge.getOffsetsTo(this.stripWrap)[0]+pos;if(!this.enableTabScroll||count<1||cw<20){return}if(l<=tw){wd.scrollLeft=0;wrap.setWidth(tw);if(this.scrolling){this.scrolling=false;(this.tabPosition=="bottom"?this.footer:this.header).removeClass("x-tab-scrolling");this.scrollLeft.hide();this.scrollRight.hide();if(Ext.isAir||Ext.isWebKit){wd.style.marginLeft="";wd.style.marginRight=""}}}else{if(!this.scrolling){(this.tabPosition=="bottom"?this.footer:this.header).addClass("x-tab-scrolling");if(Ext.isAir||Ext.isWebKit){wd.style.marginLeft="18px";wd.style.marginRight="18px"}}tw-=wrap.getMargins("lr");wrap.setWidth(tw>20?tw:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()}else{this.scrollLeft.show();this.scrollRight.show()}}this.scrolling=true;if(pos>(l-tw)){wd.scrollLeft=l-tw}else{this.scrollToTab(this.activeTab,false)}this.updateScrollButtons()}},createScrollers:function(){this.pos.addClass("x-tab-scrolling-"+this.tabPosition);var h=this.stripWrap.dom.offsetHeight;var sl=(this.tabPosition=="bottom"?this.footer:this.header).insertFirst({cls:"x-tab-scroller-left"});sl.setHeight(h);sl.addClassOnOver("x-tab-scroller-left-over");this.leftRepeater=new Ext.util.ClickRepeater(sl,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=sl;var sr=(this.tabPosition=="bottom"?this.footer:this.header).insertFirst({cls:"x-tab-scroller-right"});sr.setHeight(h);sr.addClassOnOver("x-tab-scroller-right-over");this.rightRepeater=new Ext.util.ClickRepeater(sr,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=sr},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100)},scrollToTab:function(item,animate){if(!item){return}var el=this.getTabEl(item);var pos=this.getScrollPos(),area=this.getScrollArea();var left=Ext.fly(el).getOffsetsTo(this.stripWrap)[0]+pos;var right=left+el.offsetWidth;if(left<pos){this.scrollTo(left,animate)}else{if(right>(pos+area)){this.scrollTo(right-area,animate)}}},scrollTo:function(pos,animate){this.stripWrap.scrollTo("left",pos,animate?this.getScrollAnim():false);if(!animate){this.updateScrollButtons()}},onWheel:function(e){var d=e.getWheelDelta()*this.wheelIncrement*-1;e.stopEvent();var pos=this.getScrollPos();var newpos=pos+d;var sw=this.getScrollWidth()-this.getScrollArea();var s=Math.max(0,Math.min(sw,newpos));if(s!=pos){this.scrollTo(s,false)}},onScrollRight:function(){var sw=this.getScrollWidth()-this.getScrollArea();var pos=this.getScrollPos();var s=Math.min(sw,pos+this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll)}},onScrollLeft:function(){var pos=this.getScrollPos();var s=Math.max(0,pos-this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll)}},updateScrollButtons:function(){var pos=this.getScrollPos();this.scrollLeft[pos===0?"addClass":"removeClass"]("x-tab-scroller-left-disabled");this.scrollRight[pos>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("x-tab-scroller-right-disabled")},beforeDestroy:function(){if(this.items){this.items.each(function(item){if(item&&item.tabEl){Ext.get(item.tabEl).removeAllListeners();item.tabEl=null}},this)}if(this.strip){this.strip.removeAllListeners()}Ext.TabPanel.superclass.beforeDestroy.apply(this)}});Ext.reg("tabpanel",Ext.TabPanel);Ext.TabPanel.prototype.activate=Ext.TabPanel.prototype.setActiveTab;Ext.TabPanel.AccessStack=function(){var items=[];return{add:function(item){items.push(item);if(items.length>10){items.shift()}},remove:function(item){var s=[];for(var i=0,len=items.length;i<len;i++){if(items[i]!=item){s.push(items[i])}}items=s},next:function(){return items.pop()}}};Ext.Button=Ext.extend(Ext.BoxComponent,{hidden:false,disabled:false,pressed:false,enableToggle:false,menuAlign:"tl-bl?",type:"button",menuClassTarget:"tr:nth(2)",clickEvent:"click",handleMouseEvents:true,tooltipType:"qtip",buttonSelector:"button:first-child",scale:"small",iconAlign:"left",arrowAlign:"right",initComponent:function(){Ext.Button.superclass.initComponent.call(this);this.addEvents("click","toggle","mouseover","mouseout","menushow","menuhide","menutriggerover","menutriggerout");if(this.menu){this.menu=Ext.menu.MenuMgr.get(this.menu)}if(Ext.isString(this.toggleGroup)){this.enableToggle=true}},getTemplateArgs:function(){var cls=(this.cls||"");cls+=(this.iconCls||this.icon)?(this.text?" x-btn-text-icon":" x-btn-icon"):" x-btn-noicon";if(this.pressed){cls+=" x-btn-pressed"}return[this.text||"&#160;",this.type,this.iconCls||"",cls,"x-btn-"+this.scale+" x-btn-icon-"+this.scale+"-"+this.iconAlign,this.getMenuClass()]},getMenuClass:function(){return this.menu?(this.arrowAlign!="bottom"?"x-btn-arrow":"x-btn-arrow-bottom"):""},onRender:function(ct,position){if(!this.template){if(!Ext.Button.buttonTemplate){Ext.Button.buttonTemplate=new Ext.Template('<table cellspacing="0" class="x-btn {3}"><tbody class="{4}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em class="{5}" unselectable="on"><button class="x-btn-text {2}" type="{1}">{0}</button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>");Ext.Button.buttonTemplate.compile()}this.template=Ext.Button.buttonTemplate}var btn,targs=this.getTemplateArgs();if(position){btn=this.template.insertBefore(position,targs,true)}else{btn=this.template.append(ct,targs,true)}this.btnEl=btn.child(this.buttonSelector);this.mon(this.btnEl,{scope:this,focus:this.onFocus,blur:this.onBlur});this.initButtonEl(btn,this.btnEl);Ext.ButtonToggleMgr.register(this)},initButtonEl:function(btn,btnEl){this.el=btn;if(this.id){var d=this.el.dom,c=Ext.Element.cache;delete c[d.id];d.id=this.el.id=this.id;c[d.id]=this.el}if(this.icon){btnEl.setStyle("background-image","url("+this.icon+")")}if(this.tabIndex!==undefined){btnEl.dom.tabIndex=this.tabIndex}if(this.tooltip){this.setTooltip(this.tooltip,true)}if(this.handleMouseEvents){this.mon(btn,{scope:this,mouseover:this.onMouseOver,mousedown:this.onMouseDown})}if(this.menu){this.mon(this.menu,{scope:this,show:this.onMenuShow,hide:this.onMenuHide})}if(this.repeat){var repeater=new Ext.util.ClickRepeater(btn,Ext.isObject(this.repeat)?this.repeat:{});this.mon(repeater,"click",this.onClick,this)}this.mon(btn,this.clickEvent,this.onClick,this)},afterRender:function(){Ext.Button.superclass.afterRender.call(this);this.doAutoWidth()},setIconClass:function(cls){if(this.el){this.btnEl.replaceClass(this.iconCls,cls)}this.iconCls=cls;return this},setTooltip:function(tooltip,initial){if(this.rendered){if(!initial){this.clearTip()}if(Ext.isObject(tooltip)){Ext.QuickTips.register(Ext.apply({target:this.btnEl.id},tooltip));this.tooltip=tooltip}else{this.btnEl.dom[this.tooltipType]=tooltip}}else{this.tooltip=tooltip}return this},clearTip:function(){if(Ext.isObject(this.tooltip)){Ext.QuickTips.unregister(this.btnEl)}},beforeDestroy:function(){if(this.rendered){this.clearTip()}Ext.destroy(this.menu,this.repeater)},onDestroy:function(){var doc=Ext.getDoc();doc.un("mouseover",this.monitorMouseOver,this);doc.un("mouseup",this.onMouseUp,this);if(this.rendered){Ext.ButtonToggleMgr.unregister(this)}},doAutoWidth:function(){if(this.el&&this.text&&this.width===undefined){this.el.setWidth("auto");if(Ext.isIE7&&Ext.isStrict){var ib=this.btnEl;if(ib&&ib.getWidth()>20){ib.clip();ib.setWidth(Ext.util.TextMetrics.measure(ib,this.text).width+ib.getFrameWidth("lr"))}}if(this.minWidth){if(this.el.getWidth()<this.minWidth){this.el.setWidth(this.minWidth)}}}},setHandler:function(handler,scope){this.handler=handler;this.scope=scope;return this},setText:function(text){this.text=text;if(this.el){this.el.child("td.x-btn-mc "+this.buttonSelector).update(text)}this.doAutoWidth();return this},getText:function(){return this.text},toggle:function(state,suppressEvent){state=state===undefined?!this.pressed:!!state;if(state!=this.pressed){if(this.rendered){this.el[state?"addClass":"removeClass"]("x-btn-pressed")}this.pressed=state;if(!suppressEvent){this.fireEvent("toggle",this,state);if(this.toggleHandler){this.toggleHandler.call(this.scope||this,this,state)}}}return this},focus:function(){this.btnEl.focus()},onDisable:function(){this.onDisableChange(true)},onEnable:function(){this.onDisableChange(false)},onDisableChange:function(disabled){if(this.el){if(!Ext.isIE6||!this.text){this.el[disabled?"addClass":"removeClass"](this.disabledClass)}this.el.dom.disabled=disabled}this.disabled=disabled},showMenu:function(){if(this.rendered&&this.menu){if(this.tooltip){Ext.QuickTips.getQuickTip().cancelShow(this.btnEl)}this.menu.show(this.el,this.menuAlign)}return this},hideMenu:function(){if(this.menu){this.menu.hide()}return this},hasVisibleMenu:function(){return this.menu&&this.menu.isVisible()},onClick:function(e){if(e){e.preventDefault()}if(e.button!==0){return}if(!this.disabled){if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){this.toggle()}if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu()}this.fireEvent("click",this,e);if(this.handler){this.handler.call(this.scope||this,this,e)}}},isMenuTriggerOver:function(e,internal){return this.menu&&!internal},isMenuTriggerOut:function(e,internal){return this.menu&&!internal},onMouseOver:function(e){if(!this.disabled){var internal=e.within(this.el,true);if(!internal){this.el.addClass("x-btn-over");if(!this.monitoringMouseOver){Ext.getDoc().on("mouseover",this.monitorMouseOver,this);this.monitoringMouseOver=true}this.fireEvent("mouseover",this,e)}if(this.isMenuTriggerOver(e,internal)){this.fireEvent("menutriggerover",this,this.menu,e)}}},monitorMouseOver:function(e){if(e.target!=this.el.dom&&!e.within(this.el)){if(this.monitoringMouseOver){Ext.getDoc().un("mouseover",this.monitorMouseOver,this);this.monitoringMouseOver=false}this.onMouseOut(e)}},onMouseOut:function(e){var internal=e.within(this.el)&&e.target!=this.el.dom;this.el.removeClass("x-btn-over");this.fireEvent("mouseout",this,e);if(this.isMenuTriggerOut(e,internal)){this.fireEvent("menutriggerout",this,this.menu,e)}},onFocus:function(e){if(!this.disabled){this.el.addClass("x-btn-focus")}},onBlur:function(e){this.el.removeClass("x-btn-focus")},getClickEl:function(e,isUp){return this.el},onMouseDown:function(e){if(!this.disabled&&e.button===0){this.getClickEl(e).addClass("x-btn-click");Ext.getDoc().on("mouseup",this.onMouseUp,this)}},onMouseUp:function(e){if(e.button===0){this.getClickEl(e,true).removeClass("x-btn-click");Ext.getDoc().un("mouseup",this.onMouseUp,this)}},onMenuShow:function(e){this.ignoreNextClick=0;this.el.addClass("x-btn-menu-active");this.fireEvent("menushow",this,this.menu)},onMenuHide:function(e){this.el.removeClass("x-btn-menu-active");this.ignoreNextClick=this.restoreClick.defer(250,this);this.fireEvent("menuhide",this,this.menu)},restoreClick:function(){this.ignoreNextClick=0}});Ext.reg("button",Ext.Button);Ext.ButtonToggleMgr=function(){var groups={};function toggleGroup(btn,state){if(state){var g=groups[btn.toggleGroup];for(var i=0,l=g.length;i<l;i++){if(g[i]!=btn){g[i].toggle(false)}}}}return{register:function(btn){if(!btn.toggleGroup){return}var g=groups[btn.toggleGroup];if(!g){g=groups[btn.toggleGroup]=[]}g.push(btn);btn.on("toggle",toggleGroup)},unregister:function(btn){if(!btn.toggleGroup){return}var g=groups[btn.toggleGroup];if(g){g.remove(btn);btn.un("toggle",toggleGroup)}},getPressed:function(group){var g=groups[group];if(g){for(var i=0,len=g.length;i<len;i++){if(g[i].pressed===true){return g[i]}}}return null}}}();Ext.SplitButton=Ext.extend(Ext.Button,{arrowSelector:"em",split:true,initComponent:function(){Ext.SplitButton.superclass.initComponent.call(this);this.addEvents("arrowclick")},onRender:function(){Ext.SplitButton.superclass.onRender.apply(this,arguments);if(this.arrowTooltip){this.el.child(this.arrowSelector).dom[this.tooltipType]=this.arrowTooltip}},setArrowHandler:function(handler,scope){this.arrowHandler=handler;this.scope=scope},getMenuClass:function(){return"x-btn-split"+(this.arrowAlign=="bottom"?"-bottom":"")},isClickOnArrow:function(e){return this.arrowAlign!="bottom"?e.getPageX()>this.el.child(this.buttonSelector).getRegion().right:e.getPageY()>this.el.child(this.buttonSelector).getRegion().bottom},onClick:function(e,t){e.preventDefault();if(!this.disabled){if(this.isClickOnArrow(e)){if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu()}this.fireEvent("arrowclick",this,e);if(this.arrowHandler){this.arrowHandler.call(this.scope||this,this,e)}}else{if(this.enableToggle){this.toggle()}this.fireEvent("click",this,e);if(this.handler){this.handler.call(this.scope||this,this,e)}}}},isMenuTriggerOver:function(e){return this.menu&&e.target.tagName=="em"},isMenuTriggerOut:function(e,internal){return this.menu&&e.target.tagName!="em"}});Ext.reg("splitbutton",Ext.SplitButton);Ext.CycleButton=Ext.extend(Ext.SplitButton,{getItemText:function(item){if(item&&this.showText===true){var text="";if(this.prependText){text+=this.prependText}text+=item.text;return text}return undefined},setActiveItem:function(item,suppressEvent){if(!Ext.isObject(item)){item=this.menu.getComponent(item)}if(item){if(!this.rendered){this.text=this.getItemText(item);this.iconCls=item.iconCls}else{var t=this.getItemText(item);if(t){this.setText(t)}this.setIconClass(item.iconCls)}this.activeItem=item;if(!item.checked){item.setChecked(true,true)}if(this.forceIcon){this.setIconClass(this.forceIcon)}if(!suppressEvent){this.fireEvent("change",this,item)}}},getActiveItem:function(){return this.activeItem},initComponent:function(){this.addEvents("change");if(this.changeHandler){this.on("change",this.changeHandler,this.scope||this);delete this.changeHandler}this.itemCount=this.items.length;this.menu={cls:"x-cycle-menu",items:[]};var checked;Ext.each(this.items,function(item,i){Ext.apply(item,{group:item.group||this.id,itemIndex:i,checkHandler:this.checkHandler,scope:this,checked:item.checked||false});this.menu.items.push(item);if(item.checked){checked=item}},this);this.setActiveItem(checked,true);Ext.CycleButton.superclass.initComponent.call(this);this.on("click",this.toggleSelected,this)},checkHandler:function(item,pressed){if(pressed){this.setActiveItem(item)}},toggleSelected:function(){var m=this.menu;m.render();if(!m.hasLayout){m.doLayout()}var nextIdx,checkItem;for(var i=1;i<this.itemCount;i++){nextIdx=(this.activeItem.itemIndex+i)%this.itemCount;checkItem=m.items.itemAt(nextIdx);if(!checkItem.disabled){checkItem.setChecked(true);break}}}});Ext.reg("cycle",Ext.CycleButton);Ext.layout.ToolbarLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,triggerWidth:18,lastOverflow:false,noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',onLayout:function(ct,target){if(!this.leftTr){target.addClass("x-toolbar-layout-ct");target.insertHtml("beforeEnd",'<table cellspacing="0" class="x-toolbar-ct"><tbody><tr><td class="x-toolbar-left" align="left"><table cellspacing="0"><tbody><tr class="x-toolbar-left-row"></tr></tbody></table></td><td class="x-toolbar-right" align="right"><table cellspacing="0" class="x-toolbar-right-ct"><tbody><tr><td><table cellspacing="0"><tbody><tr class="x-toolbar-right-row"></tr></tbody></table></td><td><table cellspacing="0"><tbody><tr class="x-toolbar-extras-row"></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table>');this.leftTr=target.child("tr.x-toolbar-left-row",true);this.rightTr=target.child("tr.x-toolbar-right-row",true);this.extrasTr=target.child("tr.x-toolbar-extras-row",true)}var side=this.leftTr;var pos=0;var items=ct.items.items;for(var i=0,len=items.length,c;i<len;i++,pos++){c=items[i];if(c.isFill){side=this.rightTr;pos=-1}else{if(!c.rendered){c.render(this.insertCell(c,side,pos))}else{if(!c.xtbHidden&&!this.isValidParent(c,side.childNodes[pos])){var td=this.insertCell(c,side,pos);td.appendChild(c.getDomPositionEl().dom);c.container=Ext.get(td)}}}}this.cleanup(this.leftTr);this.cleanup(this.rightTr);this.cleanup(this.extrasTr);this.fitToSize(target)},cleanup:function(row){var cn=row.childNodes;for(var i=cn.length-1,c;i>=0&&(c=cn[i]);i--){if(!c.firstChild){row.removeChild(c)}}},insertCell:function(c,side,pos){var td=document.createElement("td");td.className="x-toolbar-cell";side.insertBefore(td,side.childNodes[pos]||null);return td},hideItem:function(item){var h=(this.hiddens=this.hiddens||[]);h.push(item);item.xtbHidden=true;item.xtbWidth=item.getDomPositionEl().dom.parentNode.offsetWidth;item.hide()},unhideItem:function(item){item.show();item.xtbHidden=false;this.hiddens.remove(item);if(this.hiddens.length<1){delete this.hiddens}},getItemWidth:function(c){return c.hidden?(c.xtbWidth||0):c.getDomPositionEl().dom.parentNode.offsetWidth},fitToSize:function(t){if(this.container.enableOverflow===false){return}var w=t.dom.clientWidth;var lw=this.lastWidth||0;this.lastWidth=w;var iw=t.dom.firstChild.offsetWidth;var clipWidth=w-this.triggerWidth;var hideIndex=-1;if(iw>w||(this.hiddens&&w>=lw)){var i,items=this.container.items.items,len=items.length,c;var loopWidth=0;for(i=0;i<len;i++){c=items[i];if(!c.isFill){loopWidth+=this.getItemWidth(c);if(loopWidth>clipWidth){if(!c.xtbHidden){this.hideItem(c)}}else{if(c.xtbHidden){this.unhideItem(c)}}}}}if(this.hiddens){this.initMore();if(!this.lastOverflow){this.container.fireEvent("overflowchange",this.container,true);this.lastOverflow=true}}else{if(this.more){this.clearMenu();this.more.destroy();delete this.more;if(this.lastOverflow){this.container.fireEvent("overflowchange",this.container,false);this.lastOverflow=false}}}},createMenuConfig:function(c,hideOnClick){var cfg=Ext.apply({},c.initialConfig),group=c.toggleGroup;Ext.apply(cfg,{text:c.overflowText||c.text,iconCls:c.iconCls,icon:c.icon,itemId:c.itemId,disabled:c.disabled,handler:c.handler,scope:c.scope,menu:c.menu,hideOnClick:hideOnClick});if(group||c.enableToggle){Ext.apply(cfg,{group:group,checked:c.pressed,listeners:{checkchange:function(item,checked){c.toggle(checked)}}})}delete cfg.xtype;delete cfg.id;return cfg},addComponentToMenu:function(m,c){if(c instanceof Ext.Toolbar.Separator){m.add("-")}else{if(Ext.isFunction(c.isXType)){if(c.isXType("splitbutton")){m.add(this.createMenuConfig(c,true))}else{if(c.isXType("button")){m.add(this.createMenuConfig(c,!c.menu))}else{if(c.isXType("buttongroup")){c.items.each(function(item){this.addComponentToMenu(m,item)},this)}}}}}},clearMenu:function(){var m=this.moreMenu;if(m&&m.items){m.items.each(function(item){delete item.menu})}},beforeMoreShow:function(m){var h=this.container.items.items,len=h.length,c,prev,needsSep=function(group,item){return group.isXType("buttongroup")&&!(item instanceof Ext.Toolbar.Separator)};this.clearMenu();m.removeAll();for(var i=0;i<len;i++){c=h[i];if(c.xtbHidden){if(prev&&(needsSep(c,prev)||needsSep(prev,c))){m.add("-")}this.addComponentToMenu(m,c);prev=c}}if(m.items.length<1){m.add(this.noItemsMenuText)}},initMore:function(){if(!this.more){this.moreMenu=new Ext.menu.Menu({listeners:{beforeshow:this.beforeMoreShow,scope:this}});this.moreMenu.ownerCt=this.container;this.more=new Ext.Button({iconCls:"x-toolbar-more-icon",cls:"x-toolbar-more",menu:this.moreMenu});var td=this.insertCell(this.more,this.extrasTr,100);this.more.render(td)}},destroy:function(){Ext.destroy(this.more,this.moreMenu);Ext.layout.ToolbarLayout.superclass.destroy.call(this)}});Ext.Container.LAYOUTS.toolbar=Ext.layout.ToolbarLayout;Ext.Toolbar=function(config){if(Ext.isArray(config)){config={items:config,layout:"toolbar"}}else{config=Ext.apply({layout:"toolbar"},config);if(config.buttons){config.items=config.buttons}}Ext.Toolbar.superclass.constructor.call(this,config)};(function(){var T=Ext.Toolbar;Ext.extend(T,Ext.Container,{defaultType:"button",trackMenus:true,internalDefaults:{removeMode:"container",hideParent:true},toolbarCls:"x-toolbar",initComponent:function(){T.superclass.initComponent.call(this);this.addEvents("overflowchange")},onRender:function(ct,position){if(!this.el){if(!this.autoCreate){this.autoCreate={cls:this.toolbarCls+" x-small-editor"}}this.el=ct.createChild(Ext.apply({id:this.id},this.autoCreate),position);Ext.Toolbar.superclass.onRender.apply(this,arguments)}},lookupComponent:function(c){if(Ext.isString(c)){if(c=="-"){c=new T.Separator()}else{if(c==" "){c=new T.Spacer()}else{if(c=="->"){c=new T.Fill()}else{c=new T.TextItem(c)}}}this.applyDefaults(c)}else{if(c.isFormField||c.render){c=this.constructItem(c)}else{if(c.tag){c=new T.Item({autoEl:c})}else{if(c.tagName){c=new T.Item({el:c})}else{if(Ext.isObject(c)){c=c.xtype?this.constructItem(c):this.constructButton(c)}}}}}return c},applyDefaults:function(c){if(!Ext.isString(c)){c=Ext.Toolbar.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d)}else{Ext.applyIf(c,d)}}return c},constructItem:function(item,type){return Ext.create(item,type||this.defaultType)},addSeparator:function(){return this.add(new T.Separator())},addSpacer:function(){return this.add(new T.Spacer())},addFill:function(){this.add(new T.Fill())},addElement:function(el){return this.addItem(new T.Item({el:el}))},addItem:function(item){return this.add.apply(this,arguments)},addButton:function(config){if(Ext.isArray(config)){var buttons=[];for(var i=0,len=config.length;i<len;i++){buttons.push(this.addButton(config[i]))}return buttons}return this.add(this.constructButton(config))},addText:function(text){return this.addItem(new T.TextItem(text))},addDom:function(config){return this.add(new T.Item({autoEl:config}))},addField:function(field){return this.add(field)},insertButton:function(index,item){if(Ext.isArray(item)){var buttons=[];for(var i=0,len=item.length;i<len;i++){buttons.push(this.insertButton(index+i,item[i]))}return buttons}return Ext.Toolbar.superclass.insert.call(this,index,item)},initMenuTracking:function(item){if(this.trackMenus&&item.menu){this.mon(item,{menutriggerover:this.onButtonTriggerOver,menushow:this.onButtonMenuShow,menuhide:this.onButtonMenuHide,scope:this})}},constructButton:function(item){var b=item.events?item:this.constructItem(item,item.split?"splitbutton":this.defaultType);this.initMenuTracking(b);return b},onDisable:function(){this.items.each(function(item){if(item.disable){item.disable()}})},onEnable:function(){this.items.each(function(item){if(item.enable){item.enable()}})},onButtonTriggerOver:function(btn){if(this.activeMenuBtn&&this.activeMenuBtn!=btn){this.activeMenuBtn.hideMenu();btn.showMenu();this.activeMenuBtn=btn}},onButtonMenuShow:function(btn){this.activeMenuBtn=btn},onButtonMenuHide:function(btn){delete this.activeMenuBtn}});Ext.reg("toolbar",Ext.Toolbar);T.Item=Ext.extend(Ext.BoxComponent,{hideParent:true,enable:Ext.emptyFn,disable:Ext.emptyFn,focus:Ext.emptyFn});Ext.reg("tbitem",T.Item);T.Separator=Ext.extend(T.Item,{onRender:function(ct,position){this.el=ct.createChild({tag:"span",cls:"xtb-sep"},position)}});Ext.reg("tbseparator",T.Separator);T.Spacer=Ext.extend(T.Item,{onRender:function(ct,position){this.el=ct.createChild({tag:"div",cls:"xtb-spacer",style:this.width?"width:"+this.width+"px":""},position)}});Ext.reg("tbspacer",T.Spacer);T.Fill=Ext.extend(T.Item,{render:Ext.emptyFn,isFill:true});Ext.reg("tbfill",T.Fill);T.TextItem=Ext.extend(T.Item,{constructor:function(config){T.TextItem.superclass.constructor.call(this,Ext.isString(config)?{text:config}:config)},onRender:function(ct,position){this.autoEl={cls:"xtb-text",html:this.text||""};T.TextItem.superclass.onRender.call(this,ct,position)},setText:function(t){if(this.rendered){this.el.update(t)}else{this.text=t}}});Ext.reg("tbtext",T.TextItem);T.Button=Ext.extend(Ext.Button,{});T.SplitButton=Ext.extend(Ext.SplitButton,{});Ext.reg("tbbutton",T.Button);Ext.reg("tbsplit",T.SplitButton)})();Ext.ButtonGroup=Ext.extend(Ext.Panel,{baseCls:"x-btn-group",layout:"table",defaultType:"button",frame:true,internalDefaults:{removeMode:"container",hideParent:true},initComponent:function(){this.layoutConfig=this.layoutConfig||{};Ext.applyIf(this.layoutConfig,{columns:this.columns});if(!this.title){this.addClass("x-btn-group-notitle")}this.on("afterlayout",this.onAfterLayout,this);Ext.ButtonGroup.superclass.initComponent.call(this)},applyDefaults:function(c){c=Ext.ButtonGroup.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d)}else{Ext.applyIf(c,d)}return c},onAfterLayout:function(){var bodyWidth=this.body.getFrameWidth("lr")+this.body.dom.firstChild.offsetWidth;this.body.setWidth(bodyWidth);this.el.setWidth(bodyWidth+this.getFrameWidth())}});Ext.reg("buttongroup",Ext.ButtonGroup);(function(){var T=Ext.Toolbar;Ext.PagingToolbar=Ext.extend(Ext.Toolbar,{pageSize:20,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",initComponent:function(){var pagingItems=[this.first=new T.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new T.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new T.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new T.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new T.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-",this.refresh=new T.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this})];var userItems=this.items||this.buttons||[];if(this.prependButtons){this.items=userItems.concat(pagingItems)}else{this.items=pagingItems.concat(userItems)}delete this.buttons;if(this.displayInfo){this.items.push("->");this.items.push(this.displayItem=new T.TextItem({}))}Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents("change","beforechange");this.on("afterlayout",this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)},onFirstLayout:function(){if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}},updateInfo:function(){if(this.displayItem){var count=this.store.getCount();var msg=count==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+count,this.store.getTotalCount());this.displayItem.setText(msg)}},onLoad:function(store,r,o){if(!this.rendered){this.dsLoaded=[store,r,o];return}var p=this.getParams();this.cursor=(o.params&&o.params[p.start])?o.params[p.start]:0;var d=this.getPageData(),ap=d.activePage,ps=d.pages;this.afterTextItem.setText(String.format(this.afterPageText,d.pages));this.inputItem.setValue(ap);this.first.setDisabled(ap==1);this.prev.setDisabled(ap==1);this.next.setDisabled(ap==ps);this.last.setDisabled(ap==ps);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,d)},getPageData:function(){var total=this.store.getTotalCount();return{total:total,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:total<this.pageSize?1:Math.ceil(total/this.pageSize)}},changePage:function(page){this.doLoad(((page-1)*this.pageSize).constrain(0,this.store.getTotalCount()))},onLoadError:function(){if(!this.rendered){return}this.refresh.enable()},readPage:function(d){var v=this.inputItem.getValue(),pageNum;if(!v||isNaN(pageNum=parseInt(v,10))){this.inputItem.setValue(d.activePage);return false}return pageNum},onPagingFocus:function(){this.inputItem.select()},onPagingBlur:function(e){this.inputItem.setValue(this.getPageData().activePage)},onPagingKeyDown:function(field,e){var k=e.getKey(),d=this.getPageData(),pageNum;if(k==e.RETURN){e.stopEvent();pageNum=this.readPage(d);if(pageNum!==false){pageNum=Math.min(Math.max(1,pageNum),d.pages)-1;this.doLoad(pageNum*this.pageSize)}}else{if(k==e.HOME||k==e.END){e.stopEvent();pageNum=k==e.HOME?1:d.pages;field.setValue(pageNum)}else{if(k==e.UP||k==e.PAGEUP||k==e.DOWN||k==e.PAGEDOWN){e.stopEvent();if((pageNum=this.readPage(d))){var increment=e.shiftKey?10:1;if(k==e.DOWN||k==e.PAGEDOWN){increment*=-1}pageNum+=increment;if(pageNum>=1&pageNum<=d.pages){field.setValue(pageNum)}}}}}},getParams:function(){return this.paramNames||this.store.paramNames},getParams:function(){return this.paramNames||this.store.paramNames},beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable()}},doLoad:function(start){var o={},pn=this.getParams();o[pn.start]=start;o[pn.limit]=this.pageSize;if(this.fireEvent("beforechange",this,o)!==false){this.store.load({params:o})}},moveFirst:function(){this.doLoad(0)},movePrevious:function(){this.doLoad(Math.max(0,this.cursor-this.pageSize))},moveNext:function(){this.doLoad(this.cursor+this.pageSize)},moveLast:function(){var total=this.store.getTotalCount(),extra=total%this.pageSize;this.doLoad(extra?(total-extra):total-this.pageSize)},doRefresh:function(){this.doLoad(this.cursor)},bindStore:function(store,initial){var doLoad;if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("beforeload",this.beforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("exception",this.onLoadError,this)}if(!store){this.store=null}}if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError});doLoad=true}this.store=store;if(doLoad){this.onLoad(store,null,{})}},unbind:function(store){this.bindStore(null)},bind:function(store){this.bindStore(store)},onDestroy:function(){this.bindStore(null);Ext.PagingToolbar.superclass.onDestroy.call(this)}})})();Ext.reg("paging",Ext.PagingToolbar);Ext.History=(function(){var iframe,hiddenField;var ready=false;var currentToken;function getHash(){var href=top.location.href,i=href.indexOf("#");return i>=0?href.substr(i+1):null}function doSave(){hiddenField.value=currentToken}function handleStateChange(token){currentToken=token;Ext.History.fireEvent("change",token)}function updateIFrame(token){var html=['<html><body><div id="state">',token,"</div></body></html>"].join("");try{var doc=iframe.contentWindow.document;doc.open();doc.write(html);doc.close();return true}catch(e){return false}}function checkIFrame(){if(!iframe.contentWindow||!iframe.contentWindow.document){setTimeout(checkIFrame,10);return}var doc=iframe.contentWindow.document;var elem=doc.getElementById("state");var token=elem?elem.innerText:null;var hash=getHash();setInterval(function(){doc=iframe.contentWindow.document;elem=doc.getElementById("state");var newtoken=elem?elem.innerText:null;var newHash=getHash();if(newtoken!==token){token=newtoken;handleStateChange(token);top.location.hash=token;hash=token;doSave()}else{if(newHash!==hash){hash=newHash;updateIFrame(newHash)}}},50);ready=true;Ext.History.fireEvent("ready",Ext.History)}function startUp(){currentToken=hiddenField.value?hiddenField.value:getHash();if(Ext.isIE){checkIFrame()}else{var hash=getHash();setInterval(function(){var newHash=getHash();if(newHash!==hash){hash=newHash;handleStateChange(hash);doSave()}},50);ready=true;Ext.History.fireEvent("ready",Ext.History)}}return{fieldId:"x-history-field",iframeId:"x-history-frame",events:{},init:function(onReady,scope){if(ready){Ext.callback(onReady,scope,[this]);return}if(!Ext.isReady){Ext.onReady(function(){Ext.History.init(onReady,scope)});return}hiddenField=Ext.getDom(Ext.History.fieldId);if(Ext.isIE){iframe=Ext.getDom(Ext.History.iframeId)}this.addEvents("ready","change");if(onReady){this.on("ready",onReady,scope,{single:true})}startUp()},add:function(token,preventDup){if(preventDup!==false){if(this.getToken()==token){return true}}if(Ext.isIE){return updateIFrame(token)}else{top.location.hash=token;return true}},back:function(){history.go(-1)},forward:function(){history.go(1)},getToken:function(){return ready?currentToken:getHash()}}})();Ext.apply(Ext.History,new Ext.util.Observable());Ext.Tip=Ext.extend(Ext.Panel,{minWidth:40,maxWidth:300,shadow:"sides",defaultAlign:"tl-bl?",autoRender:true,quickShowInterval:250,frame:true,hidden:true,baseCls:"x-tip",floating:{shadow:true,shim:true,useDisplay:true,constrain:false},autoHeight:true,closeAction:"hide",initComponent:function(){Ext.Tip.superclass.initComponent.call(this);if(this.closable&&!this.title){this.elements+=",header"}},afterRender:function(){Ext.Tip.superclass.afterRender.call(this);if(this.closable){this.addTool({id:"close",handler:this[this.closeAction],scope:this})}},showAt:function(xy){Ext.Tip.superclass.show.call(this);if(this.measureWidth!==false&&(!this.initialConfig||typeof this.initialConfig.width!="number")){this.doAutoWidth()}if(this.constrainPosition){xy=this.el.adjustForConstraints(xy)}this.setPagePosition(xy[0],xy[1])},doAutoWidth:function(){var bw=this.body.getTextWidth();if(this.title){bw=Math.max(bw,this.header.child("span").getTextWidth(this.title))}bw+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding("lr");this.setWidth(bw.constrain(this.minWidth,this.maxWidth));if(Ext.isIE7&&!this.repainted){this.el.repaint();this.repainted=true}},showBy:function(el,pos){if(!this.rendered){this.render(Ext.getBody())}this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign))},initDraggable:function(){this.dd=new Ext.Tip.DD(this,typeof this.draggable=="boolean"?null:this.draggable);this.header.addClass("x-tip-draggable")}});Ext.reg("tip",Ext.Tip);Ext.Tip.DD=function(tip,config){Ext.apply(this,config);this.tip=tip;Ext.Tip.DD.superclass.constructor.call(this,tip.el.id,"WindowDD-"+tip.id);this.setHandleElId(tip.header.id);this.scroll=false};Ext.extend(Ext.Tip.DD,Ext.dd.DD,{moveOnly:true,scroll:false,headerOffsets:[100,25],startDrag:function(){this.tip.el.disableShadow()},endDrag:function(e){this.tip.el.enableShadow(true)}});Ext.ToolTip=Ext.extend(Ext.Tip,{showDelay:500,hideDelay:200,dismissDelay:5000,trackMouse:false,anchorToTarget:true,anchorOffset:0,targetCounter:0,constrainPosition:false,initComponent:function(){Ext.ToolTip.superclass.initComponent.call(this);this.lastActive=new Date();this.initTarget(this.target);this.origAnchor=this.anchor},onRender:function(ct,position){Ext.ToolTip.superclass.onRender.call(this,ct,position);this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();this.anchorEl=this.el.createChild({cls:"x-tip-anchor "+this.anchorCls})},afterRender:function(){Ext.ToolTip.superclass.afterRender.call(this);this.anchorEl.setStyle("z-index",this.el.getZIndex()+1)},initTarget:function(target){var t;if((t=Ext.get(target))){if(this.target){var tg=Ext.get(this.target);this.mun(tg,"mouseover",this.onTargetOver,this);this.mun(tg,"mouseout",this.onTargetOut,this);this.mun(tg,"mousemove",this.onMouseMove,this)}this.mon(t,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove,scope:this});this.target=t}if(this.anchor){this.anchorTarget=this.target}},onMouseMove:function(e){var t=this.delegate?e.getTarget(this.delegate):this.triggerElement=true;if(t){this.targetXY=e.getXY();if(t===this.triggerElement){if(!this.hidden&&this.trackMouse){this.setPagePosition(this.getTargetXY())}}else{this.hide();this.lastActive=new Date(0);this.onTargetOver(e)}}else{if(!this.closable&&this.isVisible()){this.hide()}}},getTargetXY:function(){if(this.delegate){this.anchorTarget=this.triggerElement}if(this.anchor){this.targetCounter++;var offsets=this.getOffsets();var xy=(this.anchorToTarget&&!this.trackMouse)?this.el.getAlignToXY(this.anchorTarget,this.getAnchorAlign()):this.targetXY;var dw=Ext.lib.Dom.getViewWidth()-5;var dh=Ext.lib.Dom.getViewHeight()-5;var scrollX=(document.documentElement.scrollLeft||document.body.scrollLeft||0)+5;var scrollY=(document.documentElement.scrollTop||document.body.scrollTop||0)+5;var axy=[xy[0]+offsets[0],xy[1]+offsets[1]];var sz=this.getSize();this.anchorEl.removeClass(this.anchorCls);if(this.targetCounter<2){if(axy[0]<scrollX){if(this.anchorToTarget){this.defaultAlign="l-r";if(this.mouseOffset){this.mouseOffset[0]*=-1}}this.anchor="left";return this.getTargetXY()}if(axy[0]+sz.width>dw){if(this.anchorToTarget){this.defaultAlign="r-l";if(this.mouseOffset){this.mouseOffset[0]*=-1}}this.anchor="right";return this.getTargetXY()}if(axy[1]<scrollY){if(this.anchorToTarget){this.defaultAlign="t-b";if(this.mouseOffset){this.mouseOffset[1]*=-1}}this.anchor="top";return this.getTargetXY()}if(axy[1]+sz.height>dh){if(this.anchorToTarget){this.defaultAlign="b-t";if(this.mouseOffset){this.mouseOffset[1]*=-1}}this.anchor="bottom";return this.getTargetXY()}}this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();this.anchorEl.addClass(this.anchorCls);this.targetCounter=0;return axy}else{var mouseOffset=this.getMouseOffset();return[this.targetXY[0]+mouseOffset[0],this.targetXY[1]+mouseOffset[1]]}},getMouseOffset:function(){var offset=this.anchor?[0,0]:[15,18];if(this.mouseOffset){offset[0]+=this.mouseOffset[0];offset[1]+=this.mouseOffset[1]}return offset},getAnchorPosition:function(){if(this.anchor){this.tipAnchor=this.anchor.charAt(0)}else{var m=this.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){throw"AnchorTip.defaultAlign is invalid"}this.tipAnchor=m[1].charAt(0)}switch(this.tipAnchor){case"t":return"top";case"b":return"bottom";case"r":return"right"}return"left"},getAnchorAlign:function(){switch(this.anchor){case"top":return"tl-bl";case"left":return"tl-tr";case"right":return"tr-tl";default:return"bl-tl"}},getOffsets:function(){var offsets,ap=this.getAnchorPosition().charAt(0);if(this.anchorToTarget&&!this.trackMouse){switch(ap){case"t":offsets=[0,9];break;case"b":offsets=[0,-13];break;case"r":offsets=[-13,0];break;default:offsets=[9,0];break}}else{switch(ap){case"t":offsets=[-15-this.anchorOffset,30];break;case"b":offsets=[-19-this.anchorOffset,-13-this.el.dom.offsetHeight];break;case"r":offsets=[-15-this.el.dom.offsetWidth,-13-this.anchorOffset];break;default:offsets=[25,-13-this.anchorOffset];break}}var mouseOffset=this.getMouseOffset();offsets[0]+=mouseOffset[0];offsets[1]+=mouseOffset[1];return offsets},onTargetOver:function(e){if(this.disabled||e.within(this.target.dom,true)){return}var t=e.getTarget(this.delegate);if(t){this.triggerElement=t;this.clearTimer("hide");this.targetXY=e.getXY();this.delayShow()}},delayShow:function(){if(this.hidden&&!this.showTimer){if(this.lastActive.getElapsed()<this.quickShowInterval){this.show()}else{this.showTimer=this.show.defer(this.showDelay,this)}}else{if(!this.hidden&&this.autoHide!==false){this.show()}}},onTargetOut:function(e){if(this.disabled||e.within(this.target.dom,true)){return}this.clearTimer("show");if(this.autoHide!==false){this.delayHide()}},delayHide:function(){if(!this.hidden&&!this.hideTimer){this.hideTimer=this.hide.defer(this.hideDelay,this)}},hide:function(){this.clearTimer("dismiss");this.lastActive=new Date();if(this.anchorEl){this.anchorEl.hide()}Ext.ToolTip.superclass.hide.call(this);delete this.triggerElement},show:function(){if(this.anchor){this.showAt([-1000,-1000]);this.origConstrainPosition=this.constrainPosition;this.constrainPosition=false;this.anchor=this.origAnchor}this.showAt(this.getTargetXY());if(this.anchor){this.syncAnchor();this.anchorEl.show();this.constrainPosition=this.origConstrainPosition}else{this.anchorEl.hide()}},showAt:function(xy){this.lastActive=new Date();this.clearTimers();Ext.ToolTip.superclass.showAt.call(this,xy);if(this.dismissDelay&&this.autoHide!==false){this.dismissTimer=this.hide.defer(this.dismissDelay,this)}if(this.anchor&&!this.anchorEl.isVisible()){this.syncAnchor();this.anchorEl.show()}},syncAnchor:function(){var anchorPos,targetPos,offset;switch(this.tipAnchor.charAt(0)){case"t":anchorPos="b";targetPos="tl";offset=[20+this.anchorOffset,2];break;case"r":anchorPos="l";targetPos="tr";offset=[-2,11+this.anchorOffset];break;case"b":anchorPos="t";targetPos="bl";offset=[20+this.anchorOffset,-2];break;default:anchorPos="r";targetPos="tl";offset=[2,11+this.anchorOffset];break}this.anchorEl.alignTo(this.el,anchorPos+"-"+targetPos,offset)},setPagePosition:function(x,y){Ext.ToolTip.superclass.setPagePosition.call(this,x,y);if(this.anchor){this.syncAnchor()}},clearTimer:function(name){name=name+"Timer";clearTimeout(this[name]);delete this[name]},clearTimers:function(){this.clearTimer("show");this.clearTimer("dismiss");this.clearTimer("hide")},onShow:function(){Ext.ToolTip.superclass.onShow.call(this);Ext.getDoc().on("mousedown",this.onDocMouseDown,this)},onHide:function(){Ext.ToolTip.superclass.onHide.call(this);Ext.getDoc().un("mousedown",this.onDocMouseDown,this)},onDocMouseDown:function(e){if(this.autoHide!==true&&!this.closable&&!e.within(this.el.dom)){this.disable();this.enable.defer(100,this)}},onDisable:function(){this.clearTimers();this.hide()},adjustPosition:function(x,y){if(this.contstrainPosition){var ay=this.targetXY[1],h=this.getSize().height;if(y<=ay&&(y+h)>=ay){y=ay-h-5}}return{x:x,y:y}},onDestroy:function(){Ext.getDoc().un("mousedown",this.onDocMouseDown,this);Ext.ToolTip.superclass.onDestroy.call(this)}});Ext.reg("tooltip",Ext.ToolTip);Ext.QuickTip=Ext.extend(Ext.ToolTip,{interceptTitles:false,tagConfig:{namespace:"ext",attribute:"qtip",width:"qwidth",target:"target",title:"qtitle",hide:"hide",cls:"qclass",align:"qalign",anchor:"anchor"},initComponent:function(){this.target=this.target||Ext.getDoc();this.targets=this.targets||{};Ext.QuickTip.superclass.initComponent.call(this)},register:function(config){var cs=Ext.isArray(config)?config:arguments;for(var i=0,len=cs.length;i<len;i++){var c=cs[i];var target=c.target;if(target){if(Ext.isArray(target)){for(var j=0,jlen=target.length;j<jlen;j++){this.targets[Ext.id(target[j])]=c}}else{this.targets[Ext.id(target)]=c}}}},unregister:function(el){delete this.targets[Ext.id(el)]},cancelShow:function(el){var at=this.activeTarget;el=Ext.get(el).dom;if(this.isVisible()){if(at&&at.el==el){this.hide()}}else{if(at&&at.el==el){this.clearTimer("show")}}},getTipCfg:function(e){var t=e.getTarget(),ttp,cfg;if(this.interceptTitles&&t.title){ttp=t.title;t.qtip=ttp;t.removeAttribute("title");e.preventDefault()}else{cfg=this.tagConfig;ttp=t.qtip||Ext.fly(t).getAttribute(cfg.attribute,cfg.namespace)}return ttp},onTargetOver:function(e){if(this.disabled){return}this.targetXY=e.getXY();var t=e.getTarget();if(!t||t.nodeType!==1||t==document||t==document.body){return}if(this.activeTarget&&((t==this.activeTarget.el)||Ext.fly(this.activeTarget.el).contains(t))){this.clearTimer("hide");this.show();return}if(t&&this.targets[t.id]){this.activeTarget=this.targets[t.id];this.activeTarget.el=t;this.anchor=this.activeTarget.anchor;if(this.anchor){this.anchorTarget=t}this.delayShow();return}var ttp,et=Ext.fly(t),cfg=this.tagConfig,ns=cfg.namespace;if(ttp=this.getTipCfg(e)){var autoHide=et.getAttribute(cfg.hide,ns);this.activeTarget={el:t,text:ttp,width:et.getAttribute(cfg.width,ns),autoHide:autoHide!="user"&&autoHide!=="false",title:et.getAttribute(cfg.title,ns),cls:et.getAttribute(cfg.cls,ns),align:et.getAttribute(cfg.align,ns)};this.anchor=et.getAttribute(cfg.anchor,ns);if(this.anchor){this.anchorTarget=t}this.delayShow()}},onTargetOut:function(e){if(this.activeTarget&&e.within(this.activeTarget.el)&&!this.getTipCfg(e)){return}this.clearTimer("show");if(this.autoHide!==false){this.delayHide()}},showAt:function(xy){var t=this.activeTarget;if(t){if(!this.rendered){this.render(Ext.getBody());this.activeTarget=t}if(t.width){this.setWidth(t.width);this.body.setWidth(this.adjustBodyWidth(t.width-this.getFrameWidth()));this.measureWidth=false}else{this.measureWidth=true}this.setTitle(t.title||"");this.body.update(t.text);this.autoHide=t.autoHide;this.dismissDelay=t.dismissDelay||this.dismissDelay;if(this.lastCls){this.el.removeClass(this.lastCls);delete this.lastCls}if(t.cls){this.el.addClass(t.cls);this.lastCls=t.cls}if(this.anchor){this.constrainPosition=false}else{if(t.align){xy=this.el.getAlignToXY(t.el,t.align);this.constrainPosition=false}else{this.constrainPosition=true}}}Ext.QuickTip.superclass.showAt.call(this,xy)},hide:function(){delete this.activeTarget;Ext.QuickTip.superclass.hide.call(this)}});Ext.reg("quicktip",Ext.QuickTip);Ext.QuickTips=function(){var tip,locks=[];return{init:function(autoRender){if(!tip){tip=new Ext.QuickTip({elements:"header,body"});if(autoRender!==false){tip.render(Ext.getBody())}}},enable:function(){if(tip){locks.pop();if(locks.length<1){tip.enable()}}},disable:function(){if(tip){tip.disable()}locks.push(1)},isEnabled:function(){return tip!==undefined&&!tip.disabled},getQuickTip:function(){return tip},register:function(){tip.register.apply(tip,arguments)},unregister:function(){tip.unregister.apply(tip,arguments)},tips:function(){tip.register.apply(tip,arguments)}}}();Ext.tree.TreePanel=Ext.extend(Ext.Panel,{rootVisible:true,animate:Ext.enableFx,lines:true,enableDD:false,hlDrop:Ext.enableFx,pathSeparator:"/",bubbleEvents:[],initComponent:function(){Ext.tree.TreePanel.superclass.initComponent.call(this);if(!this.eventModel){this.eventModel=new Ext.tree.TreeEventModel(this)}var l=this.loader;if(!l){l=new Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod})}else{if(typeof l=="object"&&!l.load){l=new Ext.tree.TreeLoader(l)}}this.loader=l;this.nodeHash={};if(this.root){var r=this.root;delete this.root;this.setRootNode(r)}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","checkchange","beforedblclick","dblclick","contextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover");if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)}},proxyNodeEvent:function(ename,a1,a2,a3,a4,a5,a6){if(ename=="collapse"||ename=="expand"||ename=="beforecollapse"||ename=="beforeexpand"||ename=="move"||ename=="beforemove"){ename=ename+"node"}return this.fireEvent(ename,a1,a2,a3,a4,a5,a6)},getRootNode:function(){return this.root},setRootNode:function(node){Ext.destroy(this.root);if(!node.render){node=this.loader.createNode(node)}this.root=node;node.ownerTree=this;node.isRoot=true;this.registerNode(node);if(!this.rootVisible){var uiP=node.attributes.uiProvider;node.ui=uiP?new uiP(node):new Ext.tree.RootTreeNodeUI(node)}if(this.innerCt){this.innerCt.update("");this.afterRender()}return node},getNodeById:function(id){return this.nodeHash[id]},registerNode:function(node){this.nodeHash[node.id]=node},unregisterNode:function(node){delete this.nodeHash[node.id]},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"},restrictExpand:function(node){var p=node.parentNode;if(p){if(p.expandedChild&&p.expandedChild.parentNode==p){p.expandedChild.collapse()}p.expandedChild=node}},getChecked:function(a,startNode){startNode=startNode||this.root;var r=[];var f=function(){if(this.attributes.checked){r.push(!a?this:(a=="id"?this.id:this.attributes[a]))}};startNode.cascade(f);return r},getEl:function(){return this.el},getLoader:function(){return this.loader},expandAll:function(){this.root.expand(true)},collapseAll:function(){this.root.collapse(true)},getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.tree.DefaultSelectionModel()}return this.selModel},expandPath:function(path,attr,callback){attr=attr||"id";var keys=path.split(this.pathSeparator);var curNode=this.root;if(curNode.attributes[attr]!=keys[1]){if(callback){callback(false,null)}return}var index=1;var f=function(){if(++index==keys.length){if(callback){callback(true,curNode)}return}var c=curNode.findChild(attr,keys[index]);if(!c){if(callback){callback(false,curNode)}return}curNode=c;c.expand(false,false,f)};curNode.expand(false,false,f)},selectPath:function(path,attr,callback){attr=attr||"id";var keys=path.split(this.pathSeparator),v=keys.pop();if(keys.length>1){var f=function(success,node){if(success&&node){var n=node.findChild(attr,v);if(n){n.select();if(callback){callback(true,n)}}else{if(callback){callback(false,n)}}}else{if(callback){callback(false,n)}}};this.expandPath(keys.join(this.pathSeparator),attr,f)}else{this.root.select();if(callback){callback(true,this.root)}}},getTreeEl:function(){return this.body},onRender:function(ct,position){Ext.tree.TreePanel.superclass.onRender.call(this,ct,position);this.el.addClass("x-tree");this.innerCt=this.body.createChild({tag:"ul",cls:"x-tree-root-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")})},initEvents:function(){Ext.tree.TreePanel.superclass.initEvents.call(this);if(this.containerScroll){Ext.dd.ScrollManager.register(this.body)}if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new Ext.tree.TreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.ddAppendOnly===true})}if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new Ext.tree.TreeDragZone(this,this.dragConfig||{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})}this.getSelectionModel().init(this)},afterRender:function(){Ext.tree.TreePanel.superclass.afterRender.call(this);this.root.render();if(!this.rootVisible){this.root.renderChildren()}},onDestroy:function(){if(this.rendered){this.body.removeAllListeners();Ext.dd.ScrollManager.unregister(this.body);if(this.dropZone){this.dropZone.unreg()}if(this.dragZone){this.dragZone.unreg()}}this.root.destroy();this.nodeHash=null;Ext.tree.TreePanel.superclass.onDestroy.call(this)}});Ext.tree.TreePanel.nodeTypes={};Ext.reg("treepanel",Ext.tree.TreePanel);Ext.tree.TreeEventModel=function(tree){this.tree=tree;this.tree.on("render",this.initEvents,this)};Ext.tree.TreeEventModel.prototype={initEvents:function(){var t=this.tree;if(t.trackMouseOver!==false){t.mon(t.innerCt,{scope:this,mouseover:this.delegateOver,mouseout:this.delegateOut})}t.mon(t.getTreeEl(),{scope:this,click:this.delegateClick,dblclick:this.delegateDblClick,contextmenu:this.delegateContextMenu})},getNode:function(e){var t;if(t=e.getTarget(".x-tree-node-el",10)){var id=Ext.fly(t,"_treeEvents").getAttribute("tree-node-id","ext");if(id){return this.tree.getNodeById(id)}}return null},getNodeTarget:function(e){var t=e.getTarget(".x-tree-node-icon",1);if(!t){t=e.getTarget(".x-tree-node-el",6)}return t},delegateOut:function(e,t){if(!this.beforeEvent(e)){return}if(e.getTarget(".x-tree-ec-icon",1)){var n=this.getNode(e);this.onIconOut(e,n);if(n==this.lastEcOver){delete this.lastEcOver}}if((t=this.getNodeTarget(e))&&!e.within(t,true)){this.onNodeOut(e,this.getNode(e))}},delegateOver:function(e,t){if(!this.beforeEvent(e)){return}if(Ext.isGecko&&!this.trackingDoc){Ext.getBody().on("mouseover",this.trackExit,this);this.trackingDoc=true}if(this.lastEcOver){this.onIconOut(e,this.lastEcOver);delete this.lastEcOver}if(e.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(e);this.onIconOver(e,this.lastEcOver)}if(t=this.getNodeTarget(e)){this.onNodeOver(e,this.getNode(e))}},trackExit:function(e){if(this.lastOverNode&&!e.within(this.lastOverNode.ui.getEl())){this.onNodeOut(e,this.lastOverNode);delete this.lastOverNode;Ext.getBody().un("mouseover",this.trackExit,this);this.trackingDoc=false}},delegateClick:function(e,t){if(!this.beforeEvent(e)){return}if(e.getTarget("input[type=checkbox]",1)){this.onCheckboxClick(e,this.getNode(e))}else{if(e.getTarget(".x-tree-ec-icon",1)){this.onIconClick(e,this.getNode(e))}else{if(this.getNodeTarget(e)){this.onNodeClick(e,this.getNode(e))}}}},delegateDblClick:function(e,t){if(this.beforeEvent(e)&&this.getNodeTarget(e)){this.onNodeDblClick(e,this.getNode(e))}},delegateContextMenu:function(e,t){if(this.beforeEvent(e)&&this.getNodeTarget(e)){this.onNodeContextMenu(e,this.getNode(e))}},onNodeClick:function(e,node){node.ui.onClick(e)},onNodeOver:function(e,node){this.lastOverNode=node;node.ui.onOver(e)},onNodeOut:function(e,node){node.ui.onOut(e)},onIconOver:function(e,node){node.ui.addClass("x-tree-ec-over")},onIconOut:function(e,node){node.ui.removeClass("x-tree-ec-over")},onIconClick:function(e,node){node.ui.ecClick(e)},onCheckboxClick:function(e,node){node.ui.onCheckChange(e)},onNodeDblClick:function(e,node){node.ui.onDblClick(e)},onNodeContextMenu:function(e,node){node.ui.onContextMenu(e)},beforeEvent:function(e){if(this.disabled){e.stopEvent();return false}return true},disable:function(){this.disabled=true},enable:function(){this.disabled=false}};Ext.tree.DefaultSelectionModel=function(config){this.selNode=null;this.addEvents("selectionchange","beforeselect");Ext.apply(this,config);Ext.tree.DefaultSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.tree.DefaultSelectionModel,Ext.util.Observable,{init:function(tree){this.tree=tree;tree.mon(tree.getTreeEl(),"keydown",this.onKeyDown,this);tree.on("click",this.onNodeClick,this)},onNodeClick:function(node,e){this.select(node)},select:function(node,selectNextNode){if(!Ext.fly(node.ui.wrap).isVisible()&&selectNextNode){return selectNextNode.call(this,node)}var last=this.selNode;if(node==last){node.ui.onSelectedChange(true)}else{if(this.fireEvent("beforeselect",this,node,last)!==false){if(last){last.ui.onSelectedChange(false)}this.selNode=node;node.ui.onSelectedChange(true);this.fireEvent("selectionchange",this,node,last)}}return node},unselect:function(node){if(this.selNode==node){this.clearSelections()}},clearSelections:function(){var n=this.selNode;if(n){n.ui.onSelectedChange(false);this.selNode=null;this.fireEvent("selectionchange",this,null)}return n},getSelectedNode:function(){return this.selNode},isSelected:function(node){return this.selNode==node},selectPrevious:function(s){if(!(s=s||this.selNode||this.lastSelNode)){return null}var ps=s.previousSibling;if(ps){if(!ps.isExpanded()||ps.childNodes.length<1){return this.select(ps,this.selectPrevious)}else{var lc=ps.lastChild;while(lc&&lc.isExpanded()&&Ext.fly(lc.ui.wrap).isVisible()&&lc.childNodes.length>0){lc=lc.lastChild}return this.select(lc,this.selectPrevious)}}else{if(s.parentNode&&(this.tree.rootVisible||!s.parentNode.isRoot)){return this.select(s.parentNode,this.selectPrevious)}}return null},selectNext:function(s){if(!(s=s||this.selNode||this.lastSelNode)){return null}if(s.firstChild&&s.isExpanded()&&Ext.fly(s.ui.wrap).isVisible()){return this.select(s.firstChild,this.selectNext)}else{if(s.nextSibling){return this.select(s.nextSibling,this.selectNext)}else{if(s.parentNode){var newS=null;s.parentNode.bubble(function(){if(this.nextSibling){newS=this.getOwnerTree().selModel.select(this.nextSibling,this.selectNext);return false}});return newS}}}return null},onKeyDown:function(e){var s=this.selNode||this.lastSelNode;var sm=this;if(!s){return}var k=e.getKey();switch(k){case e.DOWN:e.stopEvent();this.selectNext();break;case e.UP:e.stopEvent();this.selectPrevious();break;case e.RIGHT:e.preventDefault();if(s.hasChildNodes()){if(!s.isExpanded()){s.expand()}else{if(s.firstChild){this.select(s.firstChild,e)}}}break;case e.LEFT:e.preventDefault();if(s.hasChildNodes()&&s.isExpanded()){s.collapse()}else{if(s.parentNode&&(this.tree.rootVisible||s.parentNode!=this.tree.getRootNode())){this.select(s.parentNode,e)}}break}}});Ext.tree.MultiSelectionModel=function(config){this.selNodes=[];this.selMap={};this.addEvents("selectionchange");Ext.apply(this,config);Ext.tree.MultiSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.tree.MultiSelectionModel,Ext.util.Observable,{init:function(tree){this.tree=tree;tree.mon(tree.getTreeEl(),"keydown",this.onKeyDown,this);tree.on("click",this.onNodeClick,this)},onNodeClick:function(node,e){if(e.ctrlKey&&this.isSelected(node)){this.unselect(node)}else{this.select(node,e,e.ctrlKey)}},select:function(node,e,keepExisting){if(keepExisting!==true){this.clearSelections(true)}if(this.isSelected(node)){this.lastSelNode=node;return node}this.selNodes.push(node);this.selMap[node.id]=node;this.lastSelNode=node;node.ui.onSelectedChange(true);this.fireEvent("selectionchange",this,this.selNodes);return node},unselect:function(node){if(this.selMap[node.id]){node.ui.onSelectedChange(false);var sn=this.selNodes;var index=sn.indexOf(node);if(index!=-1){this.selNodes.splice(index,1)}delete this.selMap[node.id];this.fireEvent("selectionchange",this,this.selNodes)}},clearSelections:function(suppressEvent){var sn=this.selNodes;if(sn.length>0){for(var i=0,len=sn.length;i<len;i++){sn[i].ui.onSelectedChange(false)}this.selNodes=[];this.selMap={};if(suppressEvent!==true){this.fireEvent("selectionchange",this,this.selNodes)}}},isSelected:function(node){return this.selMap[node.id]?true:false},getSelectedNodes:function(){return this.selNodes},onKeyDown:Ext.tree.DefaultSelectionModel.prototype.onKeyDown,selectNext:Ext.tree.DefaultSelectionModel.prototype.selectNext,selectPrevious:Ext.tree.DefaultSelectionModel.prototype.selectPrevious});Ext.data.Tree=function(root){this.nodeHash={};this.root=null;if(root){this.setRootNode(root)}this.addEvents("append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert");Ext.data.Tree.superclass.constructor.call(this)};Ext.extend(Ext.data.Tree,Ext.util.Observable,{pathSeparator:"/",proxyNodeEvent:function(){return this.fireEvent.apply(this,arguments)},getRootNode:function(){return this.root},setRootNode:function(node){this.root=node;node.ownerTree=this;node.isRoot=true;this.registerNode(node);return node},getNodeById:function(id){return this.nodeHash[id]},registerNode:function(node){this.nodeHash[node.id]=node},unregisterNode:function(node){delete this.nodeHash[node.id]},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"}});Ext.data.Node=function(attributes){this.attributes=attributes||{};this.leaf=this.attributes.leaf;this.id=this.attributes.id;if(!this.id){this.id=Ext.id(null,"xnode-");this.attributes.id=this.id}this.childNodes=[];if(!this.childNodes.indexOf){this.childNodes.indexOf=function(o){for(var i=0,len=this.length;i<len;i++){if(this[i]==o){return i}}return -1}}this.parentNode=null;this.firstChild=null;this.lastChild=null;this.previousSibling=null;this.nextSibling=null;this.addEvents({append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true});this.listeners=this.attributes.listeners;Ext.data.Node.superclass.constructor.call(this)};Ext.extend(Ext.data.Node,Ext.util.Observable,{fireEvent:function(evtName){if(Ext.data.Node.superclass.fireEvent.apply(this,arguments)===false){return false}var ot=this.getOwnerTree();if(ot){if(ot.proxyNodeEvent.apply(ot,arguments)===false){return false}}return true},isLeaf:function(){return this.leaf===true},setFirstChild:function(node){this.firstChild=node},setLastChild:function(node){this.lastChild=node},isLast:function(){return(!this.parentNode?true:this.parentNode.lastChild==this)},isFirst:function(){return(!this.parentNode?true:this.parentNode.firstChild==this)},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){return this.attributes.expandable||this.hasChildNodes()},appendChild:function(node){var multi=false;if(Ext.isArray(node)){multi=node}else{if(arguments.length>1){multi=arguments}}if(multi){for(var i=0,len=multi.length;i<len;i++){this.appendChild(multi[i])}}else{if(this.fireEvent("beforeappend",this.ownerTree,this,node)===false){return false}var index=this.childNodes.length;var oldParent=node.parentNode;if(oldParent){if(node.fireEvent("beforemove",node.getOwnerTree(),node,oldParent,this,index)===false){return false}oldParent.removeChild(node)}index=this.childNodes.length;if(index===0){this.setFirstChild(node)}this.childNodes.push(node);node.parentNode=this;var ps=this.childNodes[index-1];if(ps){node.previousSibling=ps;ps.nextSibling=node}else{node.previousSibling=null}node.nextSibling=null;this.setLastChild(node);node.setOwnerTree(this.getOwnerTree());this.fireEvent("append",this.ownerTree,this,node,index);if(oldParent){node.fireEvent("move",this.ownerTree,node,oldParent,this,index)}return node}},removeChild:function(node){var index=this.childNodes.indexOf(node);if(index==-1){return false}if(this.fireEvent("beforeremove",this.ownerTree,this,node)===false){return false}this.childNodes.splice(index,1);if(node.previousSibling){node.previousSibling.nextSibling=node.nextSibling}if(node.nextSibling){node.nextSibling.previousSibling=node.previousSibling}if(this.firstChild==node){this.setFirstChild(node.nextSibling)}if(this.lastChild==node){this.setLastChild(node.previousSibling)}node.setOwnerTree(null);node.parentNode=null;node.previousSibling=null;node.nextSibling=null;this.fireEvent("remove",this.ownerTree,this,node);return node},insertBefore:function(node,refNode){if(!refNode){return this.appendChild(node)}if(node==refNode){return false}if(this.fireEvent("beforeinsert",this.ownerTree,this,node,refNode)===false){return false}var index=this.childNodes.indexOf(refNode);var oldParent=node.parentNode;var refIndex=index;if(oldParent==this&&this.childNodes.indexOf(node)<index){refIndex--}if(oldParent){if(node.fireEvent("beforemove",node.getOwnerTree(),node,oldParent,this,index,refNode)===false){return false}oldParent.removeChild(node)}if(refIndex===0){this.setFirstChild(node)}this.childNodes.splice(refIndex,0,node);node.parentNode=this;var ps=this.childNodes[refIndex-1];if(ps){node.previousSibling=ps;ps.nextSibling=node}else{node.previousSibling=null}node.nextSibling=refNode;refNode.previousSibling=node;node.setOwnerTree(this.getOwnerTree());this.fireEvent("insert",this.ownerTree,this,node,refNode);if(oldParent){node.fireEvent("move",this.ownerTree,node,oldParent,this,refIndex,refNode)}return node},remove:function(){this.parentNode.removeChild(this);return this},item:function(index){return this.childNodes[index]},replaceChild:function(newChild,oldChild){var s=oldChild?oldChild.nextSibling:null;this.removeChild(oldChild);this.insertBefore(newChild,s);return oldChild},indexOf:function(child){return this.childNodes.indexOf(child)},getOwnerTree:function(){if(!this.ownerTree){var p=this;while(p){if(p.ownerTree){this.ownerTree=p.ownerTree;break}p=p.parentNode}}return this.ownerTree},getDepth:function(){var depth=0;var p=this;while(p.parentNode){++depth;p=p.parentNode}return depth},setOwnerTree:function(tree){if(tree!=this.ownerTree){if(this.ownerTree){this.ownerTree.unregisterNode(this)}this.ownerTree=tree;var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].setOwnerTree(tree)}if(tree){tree.registerNode(this)}}},setId:function(id){if(id!==this.id){var t=this.ownerTree;if(t){t.unregisterNode(this)}this.id=this.attributes.id=id;if(t){t.registerNode(this)}this.onIdChange(id)}},onIdChange:Ext.emptyFn,getPath:function(attr){attr=attr||"id";var p=this.parentNode;var b=[this.attributes[attr]];while(p){b.unshift(p.attributes[attr]);p=p.parentNode}var sep=this.getOwnerTree().pathSeparator;return sep+b.join(sep)},bubble:function(fn,scope,args){var p=this;while(p){if(fn.apply(scope||p,args||[p])===false){break}p=p.parentNode}},cascade:function(fn,scope,args){if(fn.apply(scope||this,args||[this])!==false){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].cascade(fn,scope,args)}}},eachChild:function(fn,scope,args){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){if(fn.apply(scope||this,args||[cs[i]])===false){break}}},findChild:function(attribute,value){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){if(cs[i].attributes[attribute]==value){return cs[i]}}return null},findChildBy:function(fn,scope){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){if(fn.call(scope||cs[i],cs[i])===true){return cs[i]}}return null},sort:function(fn,scope){var cs=this.childNodes;var len=cs.length;if(len>0){var sortFn=scope?function(){fn.apply(scope,arguments)}:fn;cs.sort(sortFn);for(var i=0;i<len;i++){var n=cs[i];n.previousSibling=cs[i-1];n.nextSibling=cs[i+1];if(i===0){this.setFirstChild(n)}if(i==len-1){this.setLastChild(n)}}}},contains:function(node){return node.isAncestor(this)},isAncestor:function(node){var p=this.parentNode;while(p){if(p==node){return true}p=p.parentNode}return false},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]"}});Ext.tree.TreeNode=function(attributes){attributes=attributes||{};if(typeof attributes=="string"){attributes={text:attributes}}this.childrenRendered=false;this.rendered=false;Ext.tree.TreeNode.superclass.constructor.call(this,attributes);this.expanded=attributes.expanded===true;this.isTarget=attributes.isTarget!==false;this.draggable=attributes.draggable!==false&&attributes.allowDrag!==false;this.allowChildren=attributes.allowChildren!==false&&attributes.allowDrop!==false;this.text=attributes.text;this.disabled=attributes.disabled===true;this.hidden=attributes.hidden===true;this.addEvents("textchange","beforeexpand","beforecollapse","expand","disabledchange","collapse","beforeclick","click","checkchange","beforedblclick","dblclick","contextmenu","beforechildrenrendered");var uiClass=this.attributes.uiProvider||this.defaultUI||Ext.tree.TreeNodeUI;this.ui=new uiClass(this)};Ext.extend(Ext.tree.TreeNode,Ext.data.Node,{preventHScroll:true,isExpanded:function(){return this.expanded},getUI:function(){return this.ui},getLoader:function(){var owner;return this.loader||((owner=this.getOwnerTree())&&owner.loader?owner.loader:new Ext.tree.TreeLoader())},setFirstChild:function(node){var of=this.firstChild;Ext.tree.TreeNode.superclass.setFirstChild.call(this,node);if(this.childrenRendered&&of&&node!=of){of.renderIndent(true,true)}if(this.rendered){this.renderIndent(true,true)}},setLastChild:function(node){var ol=this.lastChild;Ext.tree.TreeNode.superclass.setLastChild.call(this,node);if(this.childrenRendered&&ol&&node!=ol){ol.renderIndent(true,true)}if(this.rendered){this.renderIndent(true,true)}},appendChild:function(n){if(!n.render&&!Ext.isArray(n)){n=this.getLoader().createNode(n)}var node=Ext.tree.TreeNode.superclass.appendChild.call(this,n);if(node&&this.childrenRendered){node.render()}this.ui.updateExpandIcon();return node},removeChild:function(node){this.ownerTree.getSelectionModel().unselect(node);Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);if(this.childrenRendered){node.ui.remove()}if(this.childNodes.length<1){this.collapse(false,false)}else{this.ui.updateExpandIcon()}if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false}return node},insertBefore:function(node,refNode){if(!node.render){node=this.getLoader().createNode(node)}var newNode=Ext.tree.TreeNode.superclass.insertBefore.call(this,node,refNode);if(newNode&&refNode&&this.childrenRendered){node.render()}this.ui.updateExpandIcon();return newNode},setText:function(text){var oldText=this.text;this.text=text;this.attributes.text=text;if(this.rendered){this.ui.onTextChange(this,text,oldText)}this.fireEvent("textchange",this,text,oldText)},select:function(){this.getOwnerTree().getSelectionModel().select(this)},unselect:function(){this.getOwnerTree().getSelectionModel().unselect(this)},isSelected:function(){return this.getOwnerTree().getSelectionModel().isSelected(this)},expand:function(deep,anim,callback,scope){if(!this.expanded){if(this.fireEvent("beforeexpand",this,deep,anim)===false){return}if(!this.childrenRendered){this.renderChildren()}this.expanded=true;if(!this.isHiddenRoot()&&(this.getOwnerTree().animate&&anim!==false)||anim){this.ui.animExpand(function(){this.fireEvent("expand",this);this.runCallback(callback,scope||this,[this]);if(deep===true){this.expandChildNodes(true)}}.createDelegate(this));return}else{this.ui.expand();this.fireEvent("expand",this);this.runCallback(callback,scope||this,[this])}}else{this.runCallback(callback,scope||this,[this])}if(deep===true){this.expandChildNodes(true)}},runCallback:function(cb,scope,args){if(Ext.isFunction(cb)){cb.apply(scope,args)}},isHiddenRoot:function(){return this.isRoot&&!this.getOwnerTree().rootVisible},collapse:function(deep,anim,callback,scope){if(this.expanded&&!this.isHiddenRoot()){if(this.fireEvent("beforecollapse",this,deep,anim)===false){return}this.expanded=false;if((this.getOwnerTree().animate&&anim!==false)||anim){this.ui.animCollapse(function(){this.fireEvent("collapse",this);this.runCallback(callback,scope||this,[this]);if(deep===true){this.collapseChildNodes(true)}}.createDelegate(this));return}else{this.ui.collapse();this.fireEvent("collapse",this);this.runCallback(callback,scope||this,[this])}}else{if(!this.expanded){this.runCallback(callback,scope||this,[this])}}if(deep===true){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].collapse(true,false)}}},delayedExpand:function(delay){if(!this.expandProcId){this.expandProcId=this.expand.defer(delay,this)}},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId)}this.expandProcId=false},toggle:function(){if(this.expanded){this.collapse()}else{this.expand()}},ensureVisible:function(callback,scope){var tree=this.getOwnerTree();tree.expandPath(this.parentNode?this.parentNode.getPath():this.getPath(),false,function(){var node=tree.getNodeById(this.id);tree.getTreeEl().scrollChildIntoView(node.ui.anchor);this.runCallback(callback,scope||this,[this])}.createDelegate(this))},expandChildNodes:function(deep){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].expand(deep)}},collapseChildNodes:function(deep){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].collapse(deep)}},disable:function(){this.disabled=true;this.unselect();if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,true)}this.fireEvent("disabledchange",this,true)},enable:function(){this.disabled=false;if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,false)}this.fireEvent("disabledchange",this,false)},renderChildren:function(suppressEvent){if(suppressEvent!==false){this.fireEvent("beforechildrenrendered",this)}var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].render(true)}this.childrenRendered=true},sort:function(fn,scope){Ext.tree.TreeNode.superclass.sort.apply(this,arguments);if(this.childrenRendered){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].render(true)}}},render:function(bulkRender){this.ui.render(bulkRender);if(!this.rendered){this.getOwnerTree().registerNode(this);this.rendered=true;if(this.expanded){this.expanded=false;this.expand(false,false)}}},renderIndent:function(deep,refresh){if(refresh){this.ui.childIndent=null}this.ui.renderIndent();if(deep===true&&this.childrenRendered){var cs=this.childNodes;for(var i=0,len=cs.length;i<len;i++){cs[i].renderIndent(true,refresh)}}},beginUpdate:function(){this.childrenRendered=false},endUpdate:function(){if(this.expanded&&this.rendered){this.renderChildren()}},destroy:function(){if(this.childNodes){for(var i=0,l=this.childNodes.length;i<l;i++){this.childNodes[i].destroy()}this.childNodes=null}if(this.ui.destroy){this.ui.destroy()}},onIdChange:function(id){this.ui.onIdChange(id)}});Ext.tree.TreePanel.nodeTypes.node=Ext.tree.TreeNode;Ext.tree.AsyncTreeNode=function(config){this.loaded=config&&config.loaded===true;this.loading=false;Ext.tree.AsyncTreeNode.superclass.constructor.apply(this,arguments);this.addEvents("beforeload","load")};Ext.extend(Ext.tree.AsyncTreeNode,Ext.tree.TreeNode,{expand:function(deep,anim,callback,scope){if(this.loading){var timer;var f=function(){if(!this.loading){clearInterval(timer);this.expand(deep,anim,callback,scope)}}.createDelegate(this);timer=setInterval(f,200);return}if(!this.loaded){if(this.fireEvent("beforeload",this)===false){return}this.loading=true;this.ui.beforeLoad(this);var loader=this.loader||this.attributes.loader||this.getOwnerTree().getLoader();if(loader){loader.load(this,this.loadComplete.createDelegate(this,[deep,anim,callback,scope]),this);return}}Ext.tree.AsyncTreeNode.superclass.expand.call(this,deep,anim,callback,scope)},isLoading:function(){return this.loading},loadComplete:function(deep,anim,callback,scope){this.loading=false;this.loaded=true;this.ui.afterLoad(this);this.fireEvent("load",this);this.expand(deep,anim,callback,scope)},isLoaded:function(){return this.loaded},hasChildNodes:function(){if(!this.isLeaf()&&!this.loaded){return true}else{return Ext.tree.AsyncTreeNode.superclass.hasChildNodes.call(this)}},reload:function(callback,scope){this.collapse(false,false);while(this.firstChild){this.removeChild(this.firstChild).destroy()}this.childrenRendered=false;this.loaded=false;if(this.isHiddenRoot()){this.expanded=false}this.expand(false,false,callback,scope)}});Ext.tree.TreePanel.nodeTypes.async=Ext.tree.AsyncTreeNode;Ext.tree.TreeNodeUI=function(node){this.node=node;this.rendered=false;this.animating=false;this.wasLeaf=true;this.ecc="x-tree-ec-icon x-tree-elbow";this.emptyIcon=Ext.BLANK_IMAGE_URL};Ext.tree.TreeNodeUI.prototype={removeChild:function(node){if(this.rendered){this.ctNode.removeChild(node.ui.getEl())}},beforeLoad:function(){this.addClass("x-tree-node-loading")},afterLoad:function(){this.removeClass("x-tree-node-loading")},onTextChange:function(node,text,oldText){if(this.rendered){this.textNode.innerHTML=text}},onDisableChange:function(node,state){this.disabled=state;if(this.checkbox){this.checkbox.disabled=state}if(state){this.addClass("x-tree-node-disabled")}else{this.removeClass("x-tree-node-disabled")}},onSelectedChange:function(state){if(state){this.focus();this.addClass("x-tree-selected")}else{this.removeClass("x-tree-selected")}},onMove:function(tree,node,oldParent,newParent,index,refNode){this.childIndent=null;if(this.rendered){var targetNode=newParent.ui.getContainer();if(!targetNode){this.holder=document.createElement("div");this.holder.appendChild(this.wrap);return}var insertBefore=refNode?refNode.ui.getEl():null;if(insertBefore){targetNode.insertBefore(this.wrap,insertBefore)}else{targetNode.appendChild(this.wrap)}this.node.renderIndent(true,oldParent!=newParent)}},addClass:function(cls){if(this.elNode){Ext.fly(this.elNode).addClass(cls)}},removeClass:function(cls){if(this.elNode){Ext.fly(this.elNode).removeClass(cls)}},remove:function(){if(this.rendered){this.holder=document.createElement("div");this.holder.appendChild(this.wrap)}},fireEvent:function(){return this.node.fireEvent.apply(this.node,arguments)},initEvents:function(){this.node.on("move",this.onMove,this);if(this.node.disabled){this.onDisableChange(this.node,true)}if(this.node.hidden){this.hide()}var ot=this.node.getOwnerTree();var dd=ot.enableDD||ot.enableDrag||ot.enableDrop;if(dd&&(!this.node.isRoot||ot.rootVisible)){Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false})}},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode]},hide:function(){this.node.hidden=true;if(this.wrap){this.wrap.style.display="none"}},show:function(){this.node.hidden=false;if(this.wrap){this.wrap.style.display=""}},onContextMenu:function(e){if(this.node.hasListener("contextmenu")||this.node.getOwnerTree().hasListener("contextmenu")){e.preventDefault();this.focus();this.fireEvent("contextmenu",this.node,e)}},onClick:function(e){if(this.dropping){e.stopEvent();return}if(this.fireEvent("beforeclick",this.node,e)!==false){var a=e.getTarget("a");if(!this.disabled&&this.node.attributes.href&&a){this.fireEvent("click",this.node,e);return}else{if(a&&e.ctrlKey){e.stopEvent()}}e.preventDefault();if(this.disabled){return}if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){this.node.toggle()}this.fireEvent("click",this.node,e)}else{e.stopEvent()}},onDblClick:function(e){e.preventDefault();if(this.disabled){return}if(this.fireEvent("beforedblclick",this.node,e)!==false){if(this.checkbox){this.toggleCheck()}if(!this.animating&&this.node.isExpandable()){this.node.toggle()}this.fireEvent("dblclick",this.node,e)}},onOver:function(e){this.addClass("x-tree-node-over")},onOut:function(e){this.removeClass("x-tree-node-over")},onCheckChange:function(){var checked=this.checkbox.checked;this.checkbox.defaultChecked=checked;this.node.attributes.checked=checked;this.fireEvent("checkchange",this.node,checked)},ecClick:function(e){if(!this.animating&&this.node.isExpandable()){this.node.toggle()}},startDrop:function(){this.dropping=true},endDrop:function(){setTimeout(function(){this.dropping=false}.createDelegate(this),50)},expand:function(){this.updateExpandIcon();this.ctNode.style.display=""},focus:function(){if(!this.node.preventHScroll){try{this.anchor.focus()}catch(e){}}else{try{var noscroll=this.node.getOwnerTree().getTreeEl().dom;var l=noscroll.scrollLeft;this.anchor.focus();noscroll.scrollLeft=l}catch(e){}}},toggleCheck:function(value){var cb=this.checkbox;if(cb){cb.checked=(value===undefined?!cb.checked:value);this.onCheckChange()}},blur:function(){try{this.anchor.blur()}catch(e){}},animExpand:function(callback){var ct=Ext.get(this.ctNode);ct.stopFx();if(!this.node.isExpandable()){this.updateExpandIcon();this.ctNode.style.display="";Ext.callback(callback);return}this.animating=true;this.updateExpandIcon();ct.slideIn("t",{callback:function(){this.animating=false;Ext.callback(callback)},scope:this,duration:this.node.ownerTree.duration||0.25})},highlight:function(){var tree=this.node.getOwnerTree();Ext.fly(this.wrap).highlight(tree.hlColor||"C3DAF9",{endColor:tree.hlBaseColor})},collapse:function(){this.updateExpandIcon();this.ctNode.style.display="none"},animCollapse:function(callback){var ct=Ext.get(this.ctNode);ct.enableDisplayMode("block");ct.stopFx();this.animating=true;this.updateExpandIcon();ct.slideOut("t",{callback:function(){this.animating=false;Ext.callback(callback)},scope:this,duration:this.node.ownerTree.duration||0.25})},getContainer:function(){return this.ctNode},getEl:function(){return this.wrap},appendDDGhost:function(ghostNode){ghostNode.appendChild(this.elNode.cloneNode(true))},getDDRepairXY:function(){return Ext.lib.Dom.getXY(this.iconNode)},onRender:function(){this.render()},render:function(bulkRender){var n=this.node,a=n.attributes;var targetNode=n.parentNode?n.parentNode.ui.getContainer():n.ownerTree.innerCt.dom;if(!this.rendered){this.rendered=true;this.renderElements(n,a,targetNode,bulkRender);if(a.qtip){if(this.textNode.setAttributeNS){this.textNode.setAttributeNS("ext","qtip",a.qtip);if(a.qtipTitle){this.textNode.setAttributeNS("ext","qtitle",a.qtipTitle)}}else{this.textNode.setAttribute("ext:qtip",a.qtip);if(a.qtipTitle){this.textNode.setAttribute("ext:qtitle",a.qtipTitle)}}}else{if(a.qtipCfg){a.qtipCfg.target=Ext.id(this.textNode);Ext.QuickTips.register(a.qtipCfg)}}this.initEvents();if(!this.node.expanded){this.updateExpandIcon(true)}}else{if(bulkRender===true){targetNode.appendChild(this.wrap)}}},renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():"";var cb=typeof a.checked=="boolean";var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',a.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" />',cb?('<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",'><span unselectable="on">',n.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var nel;if(bulkRender!==true&&n.nextSibling&&(nel=n.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",nel,buf)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[3];this.checkbox.defaultChecked=this.checkbox.checked;index++}this.anchor=cs[index];this.textNode=cs[index].firstChild},getAnchor:function(){return this.anchor},getTextEl:function(){return this.textNode},getIconEl:function(){return this.iconNode},isChecked:function(){return this.checkbox?this.checkbox.checked:false},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2;var cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow";var hasChild=n.hasChildNodes();if(hasChild||n.attributes.expandable){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded"}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed"}if(this.wasLeaf){this.removeClass("x-tree-node-leaf");this.wasLeaf=false}if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2}}else{if(!this.wasLeaf){Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-leaf");delete this.c1;delete this.c2;this.wasLeaf=true}}var ecc="x-tree-ec-icon "+cls;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc}}},onIdChange:function(id){if(this.rendered){this.elNode.setAttribute("ext:tree-node-id",id)}},getChildIndent:function(){if(!this.childIndent){var buf=[];var p=this.node;while(p){if(!p.isRoot||(p.isRoot&&p.ownerTree.rootVisible)){if(!p.isLast()){buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')}else{buf.unshift('<img src="'+this.emptyIcon+'" class="x-tree-icon" />')}}p=p.parentNode}this.childIndent=buf.join("")}return this.childIndent},renderIndent:function(){if(this.rendered){var indent="";var p=this.node.parentNode;if(p){indent=p.ui.getChildIndent()}if(this.indentMarkup!=indent){this.indentNode.innerHTML=indent;this.indentMarkup=indent}this.updateExpandIcon()}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id)}delete this.elNode;delete this.ctNode;delete this.indentNode;delete this.ecNode;delete this.iconNode;delete this.checkbox;delete this.anchor;delete this.textNode;if(this.holder){delete this.wrap;Ext.removeNode(this.holder);delete this.holder}else{Ext.removeNode(this.wrap);delete this.wrap}}};Ext.tree.RootTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{render:function(){if(!this.rendered){var targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild}},collapse:Ext.emptyFn,expand:Ext.emptyFn});Ext.tree.TreeLoader=function(config){this.baseParams={};Ext.apply(this,config);this.addEvents("beforeload","load","loadexception");Ext.tree.TreeLoader.superclass.constructor.call(this);if(typeof this.paramOrder=="string"){this.paramOrder=this.paramOrder.split(/[\s,|]/)}};Ext.extend(Ext.tree.TreeLoader,Ext.util.Observable,{uiProviders:{},clearOnLoad:true,paramOrder:undefined,paramsAsHash:false,directFn:undefined,load:function(node,callback,scope){if(this.clearOnLoad){while(node.firstChild){node.removeChild(node.firstChild)}}if(this.doPreload(node)){this.runCallback(callback,scope||node,[node])}else{if(this.directFn||this.dataUrl||this.url){this.requestData(node,callback,scope||node)}}},doPreload:function(node){if(node.attributes.children){if(node.childNodes.length<1){var cs=node.attributes.children;node.beginUpdate();for(var i=0,len=cs.length;i<len;i++){var cn=node.appendChild(this.createNode(cs[i]));if(this.preloadChildren){this.doPreload(cn)}}node.endUpdate()}return true}return false},getParams:function(node){var buf=[],bp=this.baseParams;if(this.directFn){buf.push(node.id);if(bp){if(this.paramOrder){for(var i=0,len=this.paramOrder.length;i<len;i++){buf.push(bp[this.paramOrder[i]])}}else{if(this.paramsAsHash){buf.push(bp)}}}return buf}else{for(var key in bp){if(!Ext.isFunction(bp[key])){buf.push(encodeURIComponent(key),"=",encodeURIComponent(bp[key]),"&")}}buf.push("node=",encodeURIComponent(node.id));return buf.join("")}},requestData:function(node,callback,scope){if(this.fireEvent("beforeload",this,node,callback)!==false){if(this.directFn){var args=this.getParams(node);args.push(this.processDirectResponse.createDelegate(this,[{callback:callback,node:node,scope:scope}],true));this.directFn.apply(window,args)}else{this.transId=Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:callback,node:node,scope:scope},params:this.getParams(node)})}}else{this.runCallback(callback,scope||node,[])}},processDirectResponse:function(result,response,args){if(response.status){this.handleResponse({responseData:Ext.isArray(result)?result:null,responseText:result,argument:args})}else{this.handleFailure({argument:args})}},runCallback:function(cb,scope,args){if(Ext.isFunction(cb)){cb.apply(scope,args)}},isLoading:function(){return !!this.transId},abort:function(){if(this.isLoading()){Ext.Ajax.abort(this.transId)}},createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false&&!attr.loader){attr.loader=this}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}},processResponse:function(response,node,callback,scope){var json=response.responseText;try{var o=response.responseData||Ext.decode(json);node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate();this.runCallback(callback,scope||node,[node])}catch(e){this.handleFailure(response)}},handleResponse:function(response){this.transId=false;var a=response.argument;this.processResponse(response,a.node,a.callback,a.scope);this.fireEvent("load",this,a.node,response)},handleFailure:function(response){this.transId=false;var a=response.argument;this.fireEvent("loadexception",this,a.node,response);this.runCallback(a.callback,a.scope||a.node,[a.node])}});Ext.tree.TreeFilter=function(tree,config){this.tree=tree;this.filtered={};Ext.apply(this,config)};Ext.tree.TreeFilter.prototype={clearBlank:false,reverse:false,autoClear:false,remove:false,filter:function(value,attr,startNode){attr=attr||"text";var f;if(typeof value=="string"){var vlen=value.length;if(vlen==0&&this.clearBlank){this.clear();return}value=value.toLowerCase();f=function(n){return n.attributes[attr].substr(0,vlen).toLowerCase()==value}}else{if(value.exec){f=function(n){return value.test(n.attributes[attr])}}else{throw"Illegal filter type, must be string or regex"}}this.filterBy(f,null,startNode)},filterBy:function(fn,scope,startNode){startNode=startNode||this.tree.root;if(this.autoClear){this.clear()}var af=this.filtered,rv=this.reverse;var f=function(n){if(n==startNode){return true}if(af[n.id]){return false}var m=fn.call(scope||n,n);if(!m||rv){af[n.id]=n;n.ui.hide();return false}return true};startNode.cascade(f);if(this.remove){for(var id in af){if(typeof id!="function"){var n=af[id];if(n&&n.parentNode){n.parentNode.removeChild(n)}}}}},clear:function(){var t=this.tree;var af=this.filtered;for(var id in af){if(typeof id!="function"){var n=af[id];if(n){n.ui.show()}}}this.filtered={}}};Ext.tree.TreeSorter=function(tree,config){Ext.apply(this,config);tree.on("beforechildrenrendered",this.doSort,this);tree.on("append",this.updateSort,this);tree.on("insert",this.updateSort,this);tree.on("textchange",this.updateSortParent,this);var dsc=this.dir&&this.dir.toLowerCase()=="desc";var p=this.property||"text";var sortType=this.sortType;var fs=this.folderSort;var cs=this.caseSensitive===true;var leafAttr=this.leafAttr||"leaf";this.sortFn=function(n1,n2){if(fs){if(n1.attributes[leafAttr]&&!n2.attributes[leafAttr]){return 1}if(!n1.attributes[leafAttr]&&n2.attributes[leafAttr]){return -1}}var v1=sortType?sortType(n1):(cs?n1.attributes[p]:n1.attributes[p].toUpperCase());var v2=sortType?sortType(n2):(cs?n2.attributes[p]:n2.attributes[p].toUpperCase());if(v1<v2){return dsc?+1:-1}else{if(v1>v2){return dsc?-1:+1}else{return 0}}}};Ext.tree.TreeSorter.prototype={doSort:function(node){node.sort(this.sortFn)},compareNodes:function(n1,n2){return(n1.text.toUpperCase()>n2.text.toUpperCase()?1:-1)},updateSort:function(tree,node){if(node.childrenRendered){this.doSort.defer(1,this,[node])}},updateSortParent:function(node){var p=node.parentNode;if(p&&p.childrenRendered){this.doSort.defer(1,this,[p])}}};if(Ext.dd.DropZone){Ext.tree.TreeDropZone=function(tree,config){this.allowParentInsert=config.allowParentInsert||false;this.allowContainerDrop=config.allowContainerDrop||false;this.appendOnly=config.appendOnly||false;Ext.tree.TreeDropZone.superclass.constructor.call(this,tree.getTreeEl(),config);this.tree=tree;this.dragOverData={};this.lastInsertClass="x-tree-no-status"};Ext.extend(Ext.tree.TreeDropZone,Ext.dd.DropZone,{ddGroup:"TreeDD",expandDelay:1000,expandNode:function(node){if(node.hasChildNodes()&&!node.isExpanded()){node.expand(false,null,this.triggerCacheRefresh.createDelegate(this))}},queueExpand:function(node){this.expandProcId=this.expandNode.defer(this.expandDelay,this,[node])},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId);this.expandProcId=false}},isValidDropPoint:function(n,pt,dd,e,data){if(!n||!data){return false}var targetNode=n.node;var dropNode=data.node;if(!(targetNode&&targetNode.isTarget&&pt)){return false}if(pt=="append"&&targetNode.allowChildren===false){return false}if((pt=="above"||pt=="below")&&(targetNode.parentNode&&targetNode.parentNode.allowChildren===false)){return false}if(dropNode&&(targetNode==dropNode||dropNode.contains(targetNode))){return false}var overEvent=this.dragOverData;overEvent.tree=this.tree;overEvent.target=targetNode;overEvent.data=data;overEvent.point=pt;overEvent.source=dd;overEvent.rawEvent=e;overEvent.dropNode=dropNode;overEvent.cancel=false;var result=this.tree.fireEvent("nodedragover",overEvent);return overEvent.cancel===false&&result!==false},getDropPoint:function(e,n,dd){var tn=n.node;if(tn.isRoot){return tn.allowChildren!==false?"append":false}var dragEl=n.ddel;var t=Ext.lib.Dom.getY(dragEl),b=t+dragEl.offsetHeight;var y=Ext.lib.Event.getPageY(e);var noAppend=tn.allowChildren===false||tn.isLeaf();if(this.appendOnly||tn.parentNode.allowChildren===false){return noAppend?false:"append"}var noBelow=false;if(!this.allowParentInsert){noBelow=tn.hasChildNodes()&&tn.isExpanded()}var q=(b-t)/(noAppend?2:3);if(y>=t&&y<(t+q)){return"above"}else{if(!noBelow&&(noAppend||y>=b-q&&y<=b)){return"below"}else{return"append"}}},onNodeEnter:function(n,dd,e,data){this.cancelExpand()},onContainerOver:function(dd,e,data){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",dd,e,data)){return this.dropAllowed}return this.dropNotAllowed},onNodeOver:function(n,dd,e,data){var pt=this.getDropPoint(e,n,dd);var node=n.node;if(!this.expandProcId&&pt=="append"&&node.hasChildNodes()&&!n.node.isExpanded()){this.queueExpand(node)}else{if(pt!="append"){this.cancelExpand()}}var returnCls=this.dropNotAllowed;if(this.isValidDropPoint(n,pt,dd,e,data)){if(pt){var el=n.ddel;var cls;if(pt=="above"){returnCls=n.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";cls="x-tree-drag-insert-above"}else{if(pt=="below"){returnCls=n.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";cls="x-tree-drag-insert-below"}else{returnCls="x-tree-drop-ok-append";cls="x-tree-drag-append"}}if(this.lastInsertClass!=cls){Ext.fly(el).replaceClass(this.lastInsertClass,cls);this.lastInsertClass=cls}}}return returnCls},onNodeOut:function(n,dd,e,data){this.cancelExpand();this.removeDropIndicators(n)},onNodeDrop:function(n,dd,e,data){var point=this.getDropPoint(e,n,dd);var targetNode=n.node;targetNode.ui.startDrop();if(!this.isValidDropPoint(n,point,dd,e,data)){targetNode.ui.endDrop();return false}var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,point,e):null);return this.processDrop(targetNode,data,point,dd,e,dropNode)},onContainerDrop:function(dd,e,data){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",dd,e,data)){var targetNode=this.tree.getRootNode();targetNode.ui.startDrop();var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,"append",e):null);return this.processDrop(targetNode,data,"append",dd,e,dropNode)}return false},processDrop:function(target,data,point,dd,e,dropNode){var dropEvent={tree:this.tree,target:target,data:data,point:point,source:dd,rawEvent:e,dropNode:dropNode,cancel:!dropNode,dropStatus:false};var retval=this.tree.fireEvent("beforenodedrop",dropEvent);if(retval===false||dropEvent.cancel===true||!dropEvent.dropNode){target.ui.endDrop();return dropEvent.dropStatus}target=dropEvent.target;if(point=="append"&&!target.isExpanded()){target.expand(false,null,function(){this.completeDrop(dropEvent)}.createDelegate(this))}else{this.completeDrop(dropEvent)}return true},completeDrop:function(de){var ns=de.dropNode,p=de.point,t=de.target;if(!Ext.isArray(ns)){ns=[ns]}var n;for(var i=0,len=ns.length;i<len;i++){n=ns[i];if(p=="above"){t.parentNode.insertBefore(n,t)}else{if(p=="below"){t.parentNode.insertBefore(n,t.nextSibling)}else{t.appendChild(n)}}}n.ui.focus();if(Ext.enableFx&&this.tree.hlDrop){n.ui.highlight()}t.ui.endDrop();this.tree.fireEvent("nodedrop",de)},afterNodeMoved:function(dd,data,e,targetNode,dropNode){if(Ext.enableFx&&this.tree.hlDrop){dropNode.ui.focus();dropNode.ui.highlight()}this.tree.fireEvent("nodedrop",this.tree,targetNode,data,dd,e)},getTree:function(){return this.tree},removeDropIndicators:function(n){if(n&&n.ddel){var el=n.ddel;Ext.fly(el).removeClass(["x-tree-drag-insert-above","x-tree-drag-insert-below","x-tree-drag-append"]);this.lastInsertClass="_noclass"}},beforeDragDrop:function(target,e,id){this.cancelExpand();return true},afterRepair:function(data){if(data&&Ext.enableFx){data.node.ui.highlight()}this.hideProxy()}})}if(Ext.dd.DragZone){Ext.tree.TreeDragZone=function(tree,config){Ext.tree.TreeDragZone.superclass.constructor.call(this,tree.innerCt,config);this.tree=tree};Ext.extend(Ext.tree.TreeDragZone,Ext.dd.DragZone,{ddGroup:"TreeDD",onBeforeDrag:function(data,e){var n=data.node;return n&&n.draggable&&!n.disabled},onInitDrag:function(e){var data=this.dragData;this.tree.getSelectionModel().select(data.node);this.tree.eventModel.disable();this.proxy.update("");data.node.ui.appendDDGhost(this.proxy.ghost.dom);this.tree.fireEvent("startdrag",this.tree,data.node,e)},getRepairXY:function(e,data){return data.node.ui.getDDRepairXY()},onEndDrag:function(data,e){this.tree.eventModel.enable.defer(100,this.tree.eventModel);this.tree.fireEvent("enddrag",this.tree,data.node,e)},onValidDrop:function(dd,e,id){this.tree.fireEvent("dragdrop",this.tree,this.dragData.node,dd,e);this.hideProxy()},beforeInvalidDrop:function(e,id){var sm=this.tree.getSelectionModel();sm.clearSelections();sm.select(this.dragData.node)},afterRepair:function(){if(Ext.enableFx&&this.tree.hlDrop){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")}this.dragging=false}})}Ext.tree.TreeEditor=function(tree,fc,config){fc=fc||{};var field=fc.events?fc:new Ext.form.TextField(fc);Ext.tree.TreeEditor.superclass.constructor.call(this,field,config);this.tree=tree;if(!tree.rendered){tree.on("render",this.initEditor,this)}else{this.initEditor(tree)}};Ext.extend(Ext.tree.TreeEditor,Ext.Editor,{alignment:"l-l",autoSize:false,hideEl:false,cls:"x-small-editor x-tree-editor",shim:false,shadow:"frame",maxWidth:250,editDelay:350,initEditor:function(tree){tree.on("beforeclick",this.beforeNodeClick,this);tree.on("dblclick",this.onNodeDblClick,this);this.on("complete",this.updateNode,this);this.on("beforestartedit",this.fitToTree,this);this.on("startedit",this.bindScroll,this,{delay:10});this.on("specialkey",this.onSpecialKey,this)},fitToTree:function(ed,el){var td=this.tree.getTreeEl().dom,nd=el.dom;if(td.scrollLeft>nd.offsetLeft){td.scrollLeft=nd.offsetLeft}var w=Math.min(this.maxWidth,(td.clientWidth>20?td.clientWidth:td.offsetWidth)-Math.max(0,nd.offsetLeft-td.scrollLeft)-5);this.setSize(w,"")},triggerEdit:function(node,defer){this.completeEdit();if(node.attributes.editable!==false){this.editNode=node;if(this.tree.autoScroll){Ext.fly(node.ui.getEl()).scrollIntoView(this.tree.body)}var value=node.text||"";if(!Ext.isGecko&&Ext.isEmpty(node.text)){node.setText("&#160;")}this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[node.ui.textNode,value]);return false}},bindScroll:function(){this.tree.getTreeEl().on("scroll",this.cancelEdit,this)},beforeNodeClick:function(node,e){clearTimeout(this.autoEditTimer);if(this.tree.getSelectionModel().isSelected(node)){e.stopEvent();return this.triggerEdit(node)}},onNodeDblClick:function(node,e){clearTimeout(this.autoEditTimer)},updateNode:function(ed,value){this.tree.getTreeEl().un("scroll",this.cancelEdit,this);this.editNode.setText(value)},onHide:function(){Ext.tree.TreeEditor.superclass.onHide.call(this);if(this.editNode){this.editNode.ui.focus.defer(50,this.editNode.ui)}},onSpecialKey:function(field,e){var k=e.getKey();if(k==e.ESC){e.stopEvent();this.cancelEdit()}else{if(k==e.ENTER&&!e.hasModifier()){e.stopEvent();this.completeEdit()}}}});
/* SWFObject v2.2 <http://code.google.com/p/swfobject/> 
    is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}}catch(e){}}}return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}(),onDomLoad=function(){if(!ua.w3){return}if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions()}if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false)}if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions()}});if(win==top){(function(){if(isDomLoaded){return}try{doc.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})()}}if(ua.wk){(function(){if(isDomLoaded){return}if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})()}addLoadEvent(callDomLoadFunctions)}}();function callDomLoadFunctions(){if(isDomLoaded){return}try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]()}}function addDomLoadEvent(fn){if(isDomLoaded){fn()}else{domLoadFnArr[domLoadFnArr.length]=fn}}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false)}else{if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false)}else{if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn)}else{if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn()}}else{win.onload=fn}}}}}function main(){if(plugin){testPlayerVersion()}else{matchVersions()}}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}else{if(counter<10){counter++;setTimeout(arguments.callee,10);return}}b.removeChild(o);t=null;matchVersions()})()}else{matchVersions()}}function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj)}}else{if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class")}if(obj.getAttribute("align")){att.align=obj.getAttribute("align")}var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value")}}showExpressInstall(att,par,id,cb)}else{displayAltContent(obj);if(cb){cb(cbObj)}}}}}else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o}cb(cbObj)}}}}}function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o}else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n}}}return r}function canExpressInstall(){return !isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null}else{storedAltContent=obj;storedAltContentId=replaceElemIdStr}att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310"}if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137"}doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv}else{par.flashvars=fv}if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj)}else{setTimeout(arguments.callee,10)}})()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj)}else{setTimeout(arguments.callee,10)}})()}else{obj.parentNode.replaceChild(abstractAltContent(obj),obj)}}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML}else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true))}}}}}return ac}function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r}if(el){if(typeof attObj.id==UNDEF){attObj.id=id}if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i]}else{if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"'}else{if(i.toLowerCase()!="classid"){att+=" "+i+'="'+attObj[i]+'"'}}}}}var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />'}}el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>";objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m])}else{if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m])}}}}for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n])}}el.parentNode.replaceChild(o,el);r=o}}return r}function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id)}else{setTimeout(arguments.callee,10)}})()}else{obj.parentNode.removeChild(obj)}}}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null}}obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false}function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return}var h=doc.getElementsByTagName("head")[0];if(!h){return}var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null}if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1]}dynamicStylesheetMedia=m}if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl)}}else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}}}function setVisibility(id,isVisible){if(!autoHideShow){return}var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v}else{createCSS("#"+id,"visibility:"+v)}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2])}var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j])}for(var k in ua){ua[k]=null}ua=null;for(var l in swfobject){swfobject[l]=null}swfobject=null})}}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false)}else{if(callbackFn){callbackFn({success:false,id:objectIdStr})}}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr)}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i]}}att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j]}}if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k]}else{par.flashvars=k+"="+flashvarsObj[k]}}}if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true)}callbackObj.success=true;callbackObj.ref=obj}else{if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return}else{setVisibility(replaceElemIdStr,true)}}if(callbackFn){callbackFn(callbackObj)}})}else{if(callbackFn){callbackFn(callbackObj)}}},switchOffAutoHideShow:function(){autoHideShow=false},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr)}else{return undefined}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn)}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr)}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean)}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1]}if(param==null){return urlEncodeIfNecessary(q)}var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block"}}if(storedCallbackFn){storedCallbackFn(storedCallbackObj)}}isExpressInstallActive=false}}}}();Ext.FlashComponent=Ext.extend(Ext.BoxComponent,{flashVersion:"9.0.45",backgroundColor:"#ffffff",wmode:"opaque",flashVars:undefined,flashParams:undefined,url:undefined,swfId:undefined,swfWidth:"100%",swfHeight:"100%",expressInstall:false,initComponent:function(){Ext.FlashComponent.superclass.initComponent.call(this);this.addEvents("initialize")},onRender:function(){Ext.FlashComponent.superclass.onRender.apply(this,arguments);var params=Ext.apply({allowScriptAccess:"always",bgcolor:this.backgroundColor,wmode:this.wmode},this.flashParams),vars=Ext.apply({allowedDomain:document.location.hostname,elementID:this.getId(),eventHandler:"Ext.FlashEventProxy.onEvent"},this.flashVars);new swfobject.embedSWF(this.url,this.id,this.swfWidth,this.swfHeight,this.flashVersion,this.expressInstall?Ext.FlashComponent.EXPRESS_INSTALL_URL:undefined,vars,params);this.swf=Ext.getDom(this.id);this.el=Ext.get(this.swf)},getSwfId:function(){return this.swfId||(this.swfId="extswf"+(++Ext.Component.AUTO_ID))},getId:function(){return this.id||(this.id="extflashcmp"+(++Ext.Component.AUTO_ID))},onFlashEvent:function(e){switch(e.type){case"swfReady":this.initSwf();return;case"log":return}e.component=this;this.fireEvent(e.type.toLowerCase().replace(/event$/,""),e)},initSwf:function(){this.onSwfReady(!!this.isInitialized);this.isInitialized=true;this.fireEvent("initialize",this)},beforeDestroy:function(){if(this.rendered){swfobject.removeSWF(this.swf.id)}Ext.FlashComponent.superclass.beforeDestroy.call(this)},onSwfReady:Ext.emptyFn});Ext.FlashComponent.EXPRESS_INSTALL_URL="http://swfobject.googlecode.com/svn/trunk/swfobject/expressInstall.swf";Ext.reg("flash",Ext.FlashComponent);Ext.FlashEventProxy={onEvent:function(id,e){var fp=Ext.getCmp(id);if(fp){fp.onFlashEvent(e)}else{arguments.callee.defer(10,this,[id,e])}}};Ext.chart.Chart=Ext.extend(Ext.FlashComponent,{refreshBuffer:100,chartStyle:{padding:10,animationEnabled:true,font:{name:"Tahoma",color:4473924,size:11},dataTip:{padding:5,border:{color:10075112,size:1},background:{color:14346230,alpha:0.9},font:{name:"Tahoma",color:1393291,size:10,bold:true}}},extraStyle:null,disableCaching:Ext.isIE||Ext.isOpera,disableCacheParam:"_dc",initComponent:function(){Ext.chart.Chart.superclass.initComponent.call(this);if(!this.url){this.url=Ext.chart.Chart.CHART_URL}if(this.disableCaching){this.url=Ext.urlAppend(this.url,String.format("{0}={1}",this.disableCacheParam,new Date().getTime()))}this.addEvents("itemmouseover","itemmouseout","itemclick","itemdoubleclick","itemdragstart","itemdrag","itemdragend");this.store=Ext.StoreMgr.lookup(this.store)},setStyle:function(name,value){this.swf.setStyle(name,Ext.encode(value))},setStyles:function(styles){this.swf.setStyles(Ext.encode(styles))},setSeriesStyles:function(styles){var s=[];Ext.each(styles,function(style){s.push(Ext.encode(style))});this.swf.setSeriesStyles(s)},setCategoryNames:function(names){this.swf.setCategoryNames(names)},setTipRenderer:function(fn){var chart=this;this.tipFnName=this.createFnProxy(function(item,index,series){var record=chart.store.getAt(index);return fn(chart,record,index,series)},this.tipFnName);this.swf.setDataTipFunction(this.tipFnName)},setSeries:function(series){this.series=series;this.refresh()},bindStore:function(store,initial){if(!initial&&this.store){if(store!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("datachanged",this.refresh,this);this.store.un("add",this.delayRefresh,this);this.store.un("remove",this.delayRefresh,this);this.store.un("update",this.delayRefresh,this);this.store.un("clear",this.refresh,this)}}if(store){store=Ext.StoreMgr.lookup(store);store.on({scope:this,datachanged:this.refresh,add:this.delayRefresh,remove:this.delayRefresh,update:this.delayRefresh,clear:this.refresh})}this.store=store;if(store&&!initial){this.refresh()}},onSwfReady:function(isReset){Ext.chart.Chart.superclass.onSwfReady.call(this,isReset);this.swf.setType(this.type);if(this.chartStyle){this.setStyles(Ext.apply({},this.extraStyle,this.chartStyle))}if(this.categoryNames){this.setCategoryNames(this.categoryNames)}if(this.tipRenderer){this.setTipRenderer(this.tipRenderer)}if(!isReset){this.bindStore(this.store,true)}this.refresh.defer(10,this)},delayRefresh:function(){if(!this.refreshTask){this.refreshTask=new Ext.util.DelayedTask(this.refresh,this)}this.refreshTask.delay(this.refreshBuffer)},refresh:function(){var styleChanged=false;var data=[],rs=this.store.data.items;for(var j=0,len=rs.length;j<len;j++){data[j]=rs[j].data}var dataProvider=[];var seriesCount=0;var currentSeries=null;var i=0;if(this.series){seriesCount=this.series.length;for(i=0;i<seriesCount;i++){currentSeries=this.series[i];var clonedSeries={};for(var prop in currentSeries){if(prop=="style"&&currentSeries.style!==null){clonedSeries.style=Ext.encode(currentSeries.style);styleChanged=true}else{clonedSeries[prop]=currentSeries[prop]}}dataProvider.push(clonedSeries)}}if(seriesCount>0){for(i=0;i<seriesCount;i++){currentSeries=dataProvider[i];if(!currentSeries.type){currentSeries.type=this.type}currentSeries.dataProvider=data}}else{dataProvider.push({type:this.type,dataProvider:data})}this.swf.setDataProvider(dataProvider)},createFnProxy:function(fn,old){if(old){delete window[old]}var fnName="extFnProxy"+(++Ext.chart.Chart.PROXY_FN_ID);window[fnName]=fn;return fnName},onDestroy:function(){Ext.chart.Chart.superclass.onDestroy.call(this);this.bindStore(null);var tip=this.tipFnName;if(!Ext.isEmpty(tip)){delete window[tip]}}});Ext.reg("chart",Ext.chart.Chart);Ext.chart.Chart.PROXY_FN_ID=0;Ext.chart.Chart.CHART_URL="http://yui.yahooapis.com/2.7.0/build/charts/assets/charts.swf";Ext.chart.PieChart=Ext.extend(Ext.chart.Chart,{type:"pie",onSwfReady:function(isReset){Ext.chart.PieChart.superclass.onSwfReady.call(this,isReset);this.setDataField(this.dataField);this.setCategoryField(this.categoryField)},setDataField:function(field){this.dataField=field;this.swf.setDataField(field)},setCategoryField:function(field){this.categoryField=field;this.swf.setCategoryField(field)}});Ext.reg("piechart",Ext.chart.PieChart);Ext.chart.CartesianChart=Ext.extend(Ext.chart.Chart,{onSwfReady:function(isReset){Ext.chart.CartesianChart.superclass.onSwfReady.call(this,isReset);if(this.xField){this.setXField(this.xField)}if(this.yField){this.setYField(this.yField)}if(this.xAxis){this.setXAxis(this.xAxis)}if(this.yAxis){this.setYAxis(this.yAxis)}},setXField:function(value){this.xField=value;this.swf.setHorizontalField(value)},setYField:function(value){this.yField=value;this.swf.setVerticalField(value)},setXAxis:function(value){this.xAxis=this.createAxis("xAxis",value);this.swf.setHorizontalAxis(this.xAxis)},setYAxis:function(value){this.yAxis=this.createAxis("yAxis",value);this.swf.setVerticalAxis(this.yAxis)},createAxis:function(axis,value){var o=Ext.apply({},value),oldFn=null;if(this[axis]){oldFn=this[axis].labelFunction}if(o.labelRenderer){var fn=o.labelRenderer;o.labelFunction=this.createFnProxy(function(v){return fn(v)},oldFn);delete o.labelRenderer}return o}});Ext.reg("cartesianchart",Ext.chart.CartesianChart);Ext.chart.LineChart=Ext.extend(Ext.chart.CartesianChart,{type:"line"});Ext.reg("linechart",Ext.chart.LineChart);Ext.chart.ColumnChart=Ext.extend(Ext.chart.CartesianChart,{type:"column"});Ext.reg("columnchart",Ext.chart.ColumnChart);Ext.chart.StackedColumnChart=Ext.extend(Ext.chart.CartesianChart,{type:"stackcolumn"});Ext.reg("stackedcolumnchart",Ext.chart.StackedColumnChart);Ext.chart.BarChart=Ext.extend(Ext.chart.CartesianChart,{type:"bar"});Ext.reg("barchart",Ext.chart.BarChart);Ext.chart.StackedBarChart=Ext.extend(Ext.chart.CartesianChart,{type:"stackbar"});Ext.reg("stackedbarchart",Ext.chart.StackedBarChart);Ext.chart.Axis=function(config){Ext.apply(this,config)};Ext.chart.Axis.prototype={type:null,orientation:"horizontal",reverse:false,labelFunction:null,hideOverlappingLabels:true};Ext.chart.NumericAxis=Ext.extend(Ext.chart.Axis,{type:"numeric",minimum:NaN,maximum:NaN,majorUnit:NaN,minorUnit:NaN,snapToUnits:true,alwaysShowZero:true,scale:"linear"});Ext.chart.TimeAxis=Ext.extend(Ext.chart.Axis,{type:"time",minimum:null,maximum:null,majorUnit:NaN,majorTimeUnit:null,minorUnit:NaN,minorTimeUnit:null,snapToUnits:true});Ext.chart.CategoryAxis=Ext.extend(Ext.chart.Axis,{type:"category",categoryNames:null});Ext.chart.Series=function(config){Ext.apply(this,config)};Ext.chart.Series.prototype={type:null,displayName:null};Ext.chart.CartesianSeries=Ext.extend(Ext.chart.Series,{xField:null,yField:null});Ext.chart.ColumnSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"column"});Ext.chart.LineSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"line"});Ext.chart.BarSeries=Ext.extend(Ext.chart.CartesianSeries,{type:"bar"});Ext.chart.PieSeries=Ext.extend(Ext.chart.Series,{type:"pie",dataField:null,categoryField:null});Ext.layout.MenuLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,setContainer:function(ct){this.monitorResize=!ct.floating;ct.on("autosize",this.doAutoSize,this);Ext.layout.MenuLayout.superclass.setContainer.call(this,ct)},renderItem:function(c,position,target){if(!this.itemTpl){this.itemTpl=Ext.layout.MenuLayout.prototype.itemTpl=new Ext.XTemplate('<li id="{itemId}" class="{itemCls}">','<tpl if="needsIcon">','<img src="{icon}" class="{iconCls}"/>',"</tpl>","</li>")}if(c&&!c.rendered){if(Ext.isNumber(position)){position=target.dom.childNodes[position]}var a=this.getItemArgs(c);c.render(c.positionEl=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(target,a,true));c.positionEl.menuItemId=c.getItemId();if(!a.isMenuItem&&a.needsIcon){c.positionEl.addClass("x-menu-list-item-indent")}this.configureItem(c,position)}else{if(c&&!this.isValidParent(c,target)){if(Ext.isNumber(position)){position=target.dom.childNodes[position]}target.dom.insertBefore(c.getActionEl().dom,position||null)}}},getItemArgs:function(c){var isMenuItem=c instanceof Ext.menu.Item;return{isMenuItem:isMenuItem,needsIcon:!isMenuItem&&(c.icon||c.iconCls),icon:c.icon||Ext.BLANK_IMAGE_URL,iconCls:"x-menu-item-icon "+(c.iconCls||""),itemId:"x-menu-el-"+c.id,itemCls:"x-menu-list-item "}},isValidParent:function(c,target){return c.el.up("li.x-menu-list-item",5).dom.parentNode===(target.dom||target)},onLayout:function(ct,target){this.renderAll(ct,target);this.doAutoSize()},doAutoSize:function(){var ct=this.container,w=ct.width;if(ct.floating){if(w){ct.setWidth(w)}else{if(Ext.isIE){ct.setWidth(Ext.isStrict&&(Ext.isIE7||Ext.isIE8)?"auto":ct.minWidth);var el=ct.getEl(),t=el.dom.offsetWidth;ct.setWidth(ct.getLayoutTarget().getWidth()+el.getFrameWidth("lr"))}}}}});Ext.Container.LAYOUTS.menu=Ext.layout.MenuLayout;Ext.menu.Menu=Ext.extend(Ext.Container,{minWidth:120,shadow:"sides",subMenuAlign:"tl-tr?",defaultAlign:"tl-bl?",allowOtherMenus:false,ignoreParentClicks:false,enableScrolling:true,maxHeight:null,scrollIncrement:24,showSeparator:true,defaultOffsets:[0,0],plain:false,floating:true,hidden:true,layout:"menu",hideMode:"offsets",scrollerHeight:8,autoLayout:true,defaultType:"menuitem",initComponent:function(){if(Ext.isArray(this.initialConfig)){Ext.apply(this,{items:this.initialConfig})}this.addEvents("click","mouseover","mouseout","itemclick");Ext.menu.MenuMgr.register(this);if(this.floating){Ext.EventManager.onWindowResize(this.hide,this)}else{if(this.initialConfig.hidden!==false){this.hidden=false}this.internalDefaults={hideOnClick:false}}Ext.menu.Menu.superclass.initComponent.call(this);if(this.autoLayout){this.on({add:this.doLayout,remove:this.doLayout,scope:this})}},getLayoutTarget:function(){return this.ul},onRender:function(ct,position){if(!ct){ct=Ext.getBody()}var dh={id:this.getId(),cls:"x-menu "+((this.floating)?"x-menu-floating x-layer ":"")+(this.cls||"")+(this.plain?" x-menu-plain":"")+(this.showSeparator?"":" x-menu-nosep"),style:this.style,cn:[{tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"},{tag:"ul",cls:"x-menu-list"}]};if(this.floating){this.el=new Ext.Layer({shadow:this.shadow,dh:dh,constrain:false,parentEl:ct,zindex:15000})}else{this.el=ct.createChild(dh)}Ext.menu.Menu.superclass.onRender.call(this,ct,position);if(!this.keyNav){this.keyNav=new Ext.menu.MenuNav(this)}this.focusEl=this.el.child("a.x-menu-focus");this.ul=this.el.child("ul.x-menu-list");this.mon(this.ul,{scope:this,click:this.onClick,mouseover:this.onMouseOver,mouseout:this.onMouseOut});if(this.enableScrolling){this.mon(this.el,{scope:this,delegate:".x-menu-scroller",click:this.onScroll,mouseover:this.deactivateActive})}},findTargetItem:function(e){var t=e.getTarget(".x-menu-list-item",this.ul,true);if(t&&t.menuItemId){return this.items.get(t.menuItemId)}},onClick:function(e){var t=this.findTargetItem(e);if(t){if(t.isFormField){this.setActiveItem(t)}else{if(t instanceof Ext.menu.BaseItem){if(t.menu&&this.ignoreParentClicks){t.expandMenu();e.preventDefault()}else{if(t.onClick){t.onClick(e);this.fireEvent("click",this,t,e)}}}}}},setActiveItem:function(item,autoExpand){if(item!=this.activeItem){this.deactivateActive();if((this.activeItem=item).isFormField){item.focus()}else{item.activate(autoExpand)}}else{if(autoExpand){item.expandMenu()}}},deactivateActive:function(){var a=this.activeItem;if(a){if(a.isFormField){if(a.collapse){a.collapse()}}else{a.deactivate()}delete this.activeItem}},tryActivate:function(start,step){var items=this.items;for(var i=start,len=items.length;i>=0&&i<len;i+=step){var item=items.get(i);if(!item.disabled&&(item.canActivate||item.isFormField)){this.setActiveItem(item,false);return item}}return false},onMouseOver:function(e){var t=this.findTargetItem(e);if(t){if(t.canActivate&&!t.disabled){this.setActiveItem(t,true)}}this.over=true;this.fireEvent("mouseover",this,e,t)},onMouseOut:function(e){var t=this.findTargetItem(e);if(t){if(t==this.activeItem&&t.shouldDeactivate&&t.shouldDeactivate(e)){this.activeItem.deactivate();delete this.activeItem}}this.over=false;this.fireEvent("mouseout",this,e,t)},onScroll:function(e,t){if(e){e.stopEvent()}var ul=this.ul.dom,top=Ext.fly(t).is(".x-menu-scroller-top");ul.scrollTop+=this.scrollIncrement*(top?-1:1);if(top?ul.scrollTop<=0:ul.scrollTop+this.activeMax>=ul.scrollHeight){this.onScrollerOut(null,t)}},onScrollerIn:function(e,t){var ul=this.ul.dom,top=Ext.fly(t).is(".x-menu-scroller-top");if(top?ul.scrollTop>0:ul.scrollTop+this.activeMax<ul.scrollHeight){Ext.fly(t).addClass(["x-menu-item-active","x-menu-scroller-active"])}},onScrollerOut:function(e,t){Ext.fly(t).removeClass(["x-menu-item-active","x-menu-scroller-active"])},show:function(el,pos,parentMenu){if(this.floating){this.parentMenu=parentMenu;if(!this.el){this.render();this.doLayout(false,true)}this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign,this.defaultOffsets),parentMenu)}else{Ext.menu.Menu.superclass.show.call(this)}},showAt:function(xy,parentMenu){if(this.fireEvent("beforeshow",this)!==false){this.parentMenu=parentMenu;if(!this.el){this.render()}if(this.enableScrolling){this.el.setXY(xy);this.constrainScroll(xy[1]);xy=[this.el.adjustForConstraints(xy)[0],xy[1]]}else{xy=this.el.adjustForConstraints(xy)}this.el.setXY(xy);this.el.show();Ext.menu.Menu.superclass.onShow.call(this);if(Ext.isIE){this.fireEvent("autosize",this);if(!Ext.isIE8){this.el.repaint()}}this.hidden=false;this.focus();this.fireEvent("show",this)}},constrainScroll:function(y){var max,full=this.ul.setHeight("auto").getHeight();if(this.floating){max=this.maxHeight?this.maxHeight:Ext.fly(this.el.dom.parentNode).getViewSize().height-y}else{max=this.getHeight()}if(full>max&&max>0){this.activeMax=max-this.scrollerHeight*2-this.el.getFrameWidth("tb")-Ext.num(this.el.shadowOffset,0);this.ul.setHeight(this.activeMax);this.createScrollers();this.el.select(".x-menu-scroller").setDisplayed("")}else{this.ul.setHeight(full);this.el.select(".x-menu-scroller").setDisplayed("none")}this.ul.dom.scrollTop=0},createScrollers:function(){if(!this.scroller){this.scroller={pos:0,top:this.el.insertFirst({tag:"div",cls:"x-menu-scroller x-menu-scroller-top",html:"&#160;"}),bottom:this.el.createChild({tag:"div",cls:"x-menu-scroller x-menu-scroller-bottom",html:"&#160;"})};this.scroller.top.hover(this.onScrollerIn,this.onScrollerOut,this);this.scroller.topRepeater=new Ext.util.ClickRepeater(this.scroller.top,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.top],false)}});this.scroller.bottom.hover(this.onScrollerIn,this.onScrollerOut,this);this.scroller.bottomRepeater=new Ext.util.ClickRepeater(this.scroller.bottom,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.bottom],false)}})}},onLayout:function(){if(this.isVisible()){if(this.enableScrolling){this.constrainScroll(this.el.getTop())}if(this.floating){this.el.sync()}}},focus:function(){if(!this.hidden){this.doFocus.defer(50,this)}},doFocus:function(){if(!this.hidden){this.focusEl.focus()}},hide:function(deep){this.deepHide=deep;Ext.menu.Menu.superclass.hide.call(this);delete this.deepHide},onHide:function(){Ext.menu.Menu.superclass.onHide.call(this);this.deactivateActive();if(this.el&&this.floating){this.el.hide()}var pm=this.parentMenu;if(this.deepHide===true&&pm){if(pm.floating){pm.hide(true)}else{pm.deactivateActive()}}},lookupComponent:function(c){if(Ext.isString(c)){c=(c=="separator"||c=="-")?new Ext.menu.Separator():new Ext.menu.TextItem(c);this.applyDefaults(c)}else{if(Ext.isObject(c)){c=this.getMenuItem(c)}else{if(c.tagName||c.el){c=new Ext.BoxComponent({el:c})}}}return c},applyDefaults:function(c){if(!Ext.isString(c)){c=Ext.menu.Menu.superclass.applyDefaults.call(this,c);var d=this.internalDefaults;if(d){if(c.events){Ext.applyIf(c.initialConfig,d);Ext.apply(c,d)}else{Ext.applyIf(c,d)}}}return c},getMenuItem:function(config){if(!config.isXType){if(!config.xtype&&Ext.isBoolean(config.checked)){return new Ext.menu.CheckItem(config)}return Ext.create(config,this.defaultType)}return config},addSeparator:function(){return this.add(new Ext.menu.Separator())},addElement:function(el){return this.add(new Ext.menu.BaseItem(el))},addItem:function(item){return this.add(item)},addMenuItem:function(config){return this.add(this.getMenuItem(config))},addText:function(text){return this.add(new Ext.menu.TextItem(text))},onDestroy:function(){Ext.menu.Menu.superclass.onDestroy.call(this);Ext.menu.MenuMgr.unregister(this);Ext.EventManager.removeResizeListener(this.hide,this);if(this.keyNav){this.keyNav.disable()}var s=this.scroller;if(s){Ext.destroy(s.topRepeater,s.bottomRepeater,s.top,s.bottom)}Ext.destroy(this.el,this.focusEl,this.ul)}});Ext.reg("menu",Ext.menu.Menu);Ext.menu.MenuNav=Ext.extend(Ext.KeyNav,function(){function up(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)-1,-1)){m.tryActivate(m.items.length-1,-1)}}function down(e,m){if(!m.tryActivate(m.items.indexOf(m.activeItem)+1,1)){m.tryActivate(0,1)}}return{constructor:function(menu){Ext.menu.MenuNav.superclass.constructor.call(this,menu.el);this.scope=this.menu=menu},doRelay:function(e,h){var k=e.getKey();if(this.menu.activeItem&&this.menu.activeItem.isFormField&&k!=e.TAB){return false}if(!this.menu.activeItem&&e.isNavKeyPress()&&k!=e.SPACE&&k!=e.RETURN){this.menu.tryActivate(0,1);return false}return h.call(this.scope||this,e,this.menu)},tab:function(e,m){e.stopEvent();if(e.shiftKey){up(e,m)}else{down(e,m)}},up:up,down:down,right:function(e,m){if(m.activeItem){m.activeItem.expandMenu(true)}},left:function(e,m){m.hide();if(m.parentMenu&&m.parentMenu.activeItem){m.parentMenu.activeItem.activate()}},enter:function(e,m){if(m.activeItem){e.stopPropagation();m.activeItem.onClick(e);m.fireEvent("click",this,m.activeItem);return true}}}}());Ext.menu.MenuMgr=function(){var menus,active,groups={},attached=false,lastShow=new Date();function init(){menus={};active=new Ext.util.MixedCollection();Ext.getDoc().addKeyListener(27,function(){if(active.length>0){hideAll()}})}function hideAll(){if(active&&active.length>0){var c=active.clone();c.each(function(m){m.hide()})}}function onHide(m){active.remove(m);if(active.length<1){Ext.getDoc().un("mousedown",onMouseDown);attached=false}}function onShow(m){var last=active.last();lastShow=new Date();active.add(m);if(!attached){Ext.getDoc().on("mousedown",onMouseDown);attached=true}if(m.parentMenu){m.getEl().setZIndex(parseInt(m.parentMenu.getEl().getStyle("z-index"),10)+3);m.parentMenu.activeChild=m}else{if(last&&last.isVisible()){m.getEl().setZIndex(parseInt(last.getEl().getStyle("z-index"),10)+3)}}}function onBeforeHide(m){if(m.activeChild){m.activeChild.hide()}if(m.autoHideTimer){clearTimeout(m.autoHideTimer);delete m.autoHideTimer}}function onBeforeShow(m){var pm=m.parentMenu;if(!pm&&!m.allowOtherMenus){hideAll()}else{if(pm&&pm.activeChild){pm.activeChild.hide()}}}function onMouseDown(e){if(lastShow.getElapsed()>50&&active.length>0&&!e.getTarget(".x-menu")){hideAll()}}function onBeforeCheck(mi,state){if(state){var g=groups[mi.group];for(var i=0,l=g.length;i<l;i++){if(g[i]!=mi){g[i].setChecked(false)}}}}return{hideAll:function(){hideAll()},register:function(menu){if(!menus){init()}menus[menu.id]=menu;menu.on("beforehide",onBeforeHide);menu.on("hide",onHide);menu.on("beforeshow",onBeforeShow);menu.on("show",onShow);var g=menu.group;if(g&&menu.events.checkchange){if(!groups[g]){groups[g]=[]}groups[g].push(menu);menu.on("checkchange",onCheck)}},get:function(menu){if(typeof menu=="string"){if(!menus){return null}return menus[menu]}else{if(menu.events){return menu}else{if(typeof menu.length=="number"){return new Ext.menu.Menu({items:menu})}else{return Ext.create(menu,"menu")}}}},unregister:function(menu){delete menus[menu.id];menu.un("beforehide",onBeforeHide);menu.un("hide",onHide);menu.un("beforeshow",onBeforeShow);menu.un("show",onShow);var g=menu.group;if(g&&menu.events.checkchange){groups[g].remove(menu);menu.un("checkchange",onCheck)}},registerCheckable:function(menuItem){var g=menuItem.group;if(g){if(!groups[g]){groups[g]=[]}groups[g].push(menuItem);menuItem.on("beforecheckchange",onBeforeCheck)}},unregisterCheckable:function(menuItem){var g=menuItem.group;if(g){groups[g].remove(menuItem);menuItem.un("beforecheckchange",onBeforeCheck)}},getCheckedItem:function(groupId){var g=groups[groupId];if(g){for(var i=0,l=g.length;i<l;i++){if(g[i].checked){return g[i]}}}return null},setCheckedItem:function(groupId,itemId){var g=groups[groupId];if(g){for(var i=0,l=g.length;i<l;i++){if(g[i].id==itemId){g[i].setChecked(true)}}}return null}}}();Ext.menu.BaseItem=function(config){Ext.menu.BaseItem.superclass.constructor.call(this,config);this.addEvents("click","activate","deactivate");if(this.handler){this.on("click",this.handler,this.scope)}};Ext.extend(Ext.menu.BaseItem,Ext.Component,{canActivate:false,activeClass:"x-menu-item-active",hideOnClick:true,clickHideDelay:1,ctype:"Ext.menu.BaseItem",actionMode:"container",onRender:function(container,position){Ext.menu.BaseItem.superclass.onRender.apply(this,arguments);if(this.ownerCt&&this.ownerCt instanceof Ext.menu.Menu){this.parentMenu=this.ownerCt}else{this.container.addClass("x-menu-list-item");this.mon(this.el,"click",this.onClick,this);this.mon(this.el,"mouseenter",this.activate,this);this.mon(this.el,"mouseleave",this.deactivate,this)}},setHandler:function(handler,scope){if(this.handler){this.un("click",this.handler,this.scope)}this.on("click",this.handler=handler,this.scope=scope)},onClick:function(e){if(!this.disabled&&this.fireEvent("click",this,e)!==false&&(this.parentMenu&&this.parentMenu.fireEvent("itemclick",this,e)!==false)){this.handleClick(e)}else{e.stopEvent()}},activate:function(){if(this.disabled){return false}var li=this.container;li.addClass(this.activeClass);this.region=li.getRegion().adjust(2,2,-2,-2);this.fireEvent("activate",this);return true},deactivate:function(){this.container.removeClass(this.activeClass);this.fireEvent("deactivate",this)},shouldDeactivate:function(e){return !this.region||!this.region.contains(e.getPoint())},handleClick:function(e){var pm=this.parentMenu;if(this.hideOnClick){if(pm.floating){pm.hide.defer(this.clickHideDelay,pm,[true])}else{pm.deactivateActive()}}},expandMenu:Ext.emptyFn,hideMenu:Ext.emptyFn});Ext.reg("menubaseitem",Ext.menu.BaseItem);Ext.menu.TextItem=function(cfg){if(typeof cfg=="string"){cfg={text:cfg}}Ext.menu.TextItem.superclass.constructor.call(this,cfg)};Ext.extend(Ext.menu.TextItem,Ext.menu.BaseItem,{hideOnClick:false,itemCls:"x-menu-text",onRender:function(){var s=document.createElement("span");s.className=this.itemCls;s.innerHTML=this.text;this.el=s;Ext.menu.TextItem.superclass.onRender.apply(this,arguments)}});Ext.reg("menutextitem",Ext.menu.TextItem);Ext.menu.Separator=function(config){Ext.menu.Separator.superclass.constructor.call(this,config)};Ext.extend(Ext.menu.Separator,Ext.menu.BaseItem,{itemCls:"x-menu-sep",hideOnClick:false,activeClass:"",onRender:function(li){var s=document.createElement("span");s.className=this.itemCls;s.innerHTML="&#160;";this.el=s;li.addClass("x-menu-sep-li");Ext.menu.Separator.superclass.onRender.apply(this,arguments)}});Ext.reg("menuseparator",Ext.menu.Separator);Ext.menu.Item=function(config){Ext.menu.Item.superclass.constructor.call(this,config);if(this.menu){this.menu=Ext.menu.MenuMgr.get(this.menu)}};Ext.extend(Ext.menu.Item,Ext.menu.BaseItem,{itemCls:"x-menu-item",canActivate:true,showDelay:200,hideDelay:200,ctype:"Ext.menu.Item",onRender:function(container,position){if(!this.itemTpl){this.itemTpl=Ext.menu.Item.prototype.itemTpl=new Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"',"</tpl>",">",'<img src="{icon}" class="x-menu-item-icon {iconCls}"/>','<span class="x-menu-item-text">{text}</span>',"</a>")}var a=this.getTemplateArgs();this.el=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(container,a,true);this.iconEl=this.el.child("img.x-menu-item-icon");this.textEl=this.el.child(".x-menu-item-text");Ext.menu.Item.superclass.onRender.call(this,container,position)},getTemplateArgs:function(){return{id:this.id,cls:this.itemCls+(this.menu?" x-menu-item-arrow":"")+(this.cls?" "+this.cls:""),href:this.href||"#",hrefTarget:this.hrefTarget,icon:this.icon||Ext.BLANK_IMAGE_URL,iconCls:this.iconCls||"",text:this.itemText||this.text||"&#160;"}},setText:function(text){this.text=text||"&#160;";if(this.rendered){this.textEl.update(this.text);this.parentMenu.layout.doAutoSize()}},setIconClass:function(cls){var oldCls=this.iconCls;this.iconCls=cls;if(this.rendered){this.iconEl.replaceClass(oldCls,this.iconCls)}},beforeDestroy:function(){if(this.menu){this.menu.destroy()}Ext.menu.Item.superclass.beforeDestroy.call(this)},handleClick:function(e){if(!this.href){e.stopEvent()}Ext.menu.Item.superclass.handleClick.apply(this,arguments)},activate:function(autoExpand){if(Ext.menu.Item.superclass.activate.apply(this,arguments)){this.focus();if(autoExpand){this.expandMenu()}}return true},shouldDeactivate:function(e){if(Ext.menu.Item.superclass.shouldDeactivate.call(this,e)){if(this.menu&&this.menu.isVisible()){return !this.menu.getEl().getRegion().contains(e.getPoint())}return true}return false},deactivate:function(){Ext.menu.Item.superclass.deactivate.apply(this,arguments);this.hideMenu()},expandMenu:function(autoActivate){if(!this.disabled&&this.menu){clearTimeout(this.hideTimer);delete this.hideTimer;if(!this.menu.isVisible()&&!this.showTimer){this.showTimer=this.deferExpand.defer(this.showDelay,this,[autoActivate])}else{if(this.menu.isVisible()&&autoActivate){this.menu.tryActivate(0,1)}}}},deferExpand:function(autoActivate){delete this.showTimer;this.menu.show(this.container,this.parentMenu.subMenuAlign||"tl-tr?",this.parentMenu);if(autoActivate){this.menu.tryActivate(0,1)}},hideMenu:function(){clearTimeout(this.showTimer);delete this.showTimer;if(!this.hideTimer&&this.menu&&this.menu.isVisible()){this.hideTimer=this.deferHide.defer(this.hideDelay,this)}},deferHide:function(){delete this.hideTimer;if(this.menu.over){this.parentMenu.setActiveItem(this,false)}else{this.menu.hide()}}});Ext.reg("menuitem",Ext.menu.Item);Ext.menu.CheckItem=function(config){Ext.menu.CheckItem.superclass.constructor.call(this,config);this.addEvents("beforecheckchange","checkchange");if(this.checkHandler){this.on("checkchange",this.checkHandler,this.scope)}Ext.menu.MenuMgr.registerCheckable(this)};Ext.extend(Ext.menu.CheckItem,Ext.menu.Item,{itemCls:"x-menu-item x-menu-check-item",groupClass:"x-menu-group-item",checked:false,ctype:"Ext.menu.CheckItem",onRender:function(c){Ext.menu.CheckItem.superclass.onRender.apply(this,arguments);if(this.group){this.el.addClass(this.groupClass)}if(this.checked){this.checked=false;this.setChecked(true,true)}},destroy:function(){Ext.menu.MenuMgr.unregisterCheckable(this);Ext.menu.CheckItem.superclass.destroy.apply(this,arguments)},setChecked:function(state,suppressEvent){if(this.checked!=state&&this.fireEvent("beforecheckchange",this,state)!==false){if(this.container){this.container[state?"addClass":"removeClass"]("x-menu-item-checked")}this.checked=state;if(suppressEvent!==true){this.fireEvent("checkchange",this,state)}}},handleClick:function(e){if(!this.disabled&&!(this.checked&&this.group)){this.setChecked(!this.checked)}Ext.menu.CheckItem.superclass.handleClick.apply(this,arguments)}});Ext.reg("menucheckitem",Ext.menu.CheckItem);Ext.menu.DateMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,pickerId:null,cls:"x-date-menu",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.DatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}},onBeforeShow:function(){if(this.picker){this.picker.hideMonthPicker(true)}},onShow:function(){var el=this.picker.getEl();el.setWidth(el.getWidth())}});Ext.reg("datemenu",Ext.menu.DateMenu);Ext.menu.ColorMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,cls:"x-color-menu",paletteId:null,initComponent:function(){Ext.apply(this,{plain:true,showSeparator:false,items:this.palette=new Ext.ColorPalette(Ext.applyIf({id:this.paletteId},this.initialConfig))});this.palette.purgeListeners();Ext.menu.ColorMenu.superclass.initComponent.call(this);this.relayEvents(this.palette,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}}});Ext.reg("colormenu",Ext.menu.ColorMenu);Ext.form.Field=Ext.extend(Ext.BoxComponent,{invalidClass:"x-form-invalid",invalidText:"The value in this field is invalid",focusClass:"x-form-focus",validationEvent:"keyup",validateOnBlur:true,validationDelay:250,defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},fieldClass:"x-form-field",msgTarget:"qtip",msgFx:"normal",readOnly:false,disabled:false,isFormField:true,msgDisplay:"",hasFocus:false,initComponent:function(){Ext.form.Field.superclass.initComponent.call(this);this.addEvents("focus","blur","specialkey","change","invalid","valid")},getName:function(){return this.rendered&&this.el.dom.name?this.el.dom.name:this.name||this.id||""},onRender:function(ct,position){if(!this.el){var cfg=this.getAutoCreate();if(!cfg.name){cfg.name=this.name||this.id}if(this.inputType){cfg.type=this.inputType}this.autoEl=cfg}Ext.form.Field.superclass.onRender.call(this,ct,position);var type=this.el.dom.type;if(type){if(type=="password"){type="text"}this.el.addClass("x-form-"+type)}if(this.readOnly){this.el.dom.readOnly=true}if(this.tabIndex!==undefined){this.el.dom.setAttribute("tabIndex",this.tabIndex)}this.el.addClass([this.fieldClass,this.cls])},getItemCt:function(){return this.itemCt},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value)}}this.originalValue=this.getValue()},isDirty:function(){if(this.disabled||!this.rendered){return false}return String(this.getValue())!==String(this.originalValue)},afterRender:function(){Ext.form.Field.superclass.afterRender.call(this);this.initEvents();this.initValue()},fireKey:function(e){if(e.isSpecialKey()){this.fireEvent("specialkey",this,e)}},reset:function(){this.setValue(this.originalValue);this.clearInvalid()},initEvents:function(){this.mon(this.el,Ext.EventManager.useKeydown?"keydown":"keypress",this.fireKey,this);this.mon(this.el,"focus",this.onFocus,this);this.mon(this.el,"blur",this.onBlur,this,this.inEditor?{buffer:10}:null)},preFocus:Ext.emptyFn,onFocus:function(){this.preFocus();if(this.focusClass){this.el.addClass(this.focusClass)}if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},beforeBlur:Ext.emptyFn,onBlur:function(){this.beforeBlur();if(this.focusClass){this.el.removeClass(this.focusClass)}this.hasFocus=false;if(this.validationEvent!==false&&(this.validateOnBlur||this.validationEvent!="blur")){this.validate()}var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)}this.fireEvent("blur",this);this.postBlur()},postBlur:Ext.emptyFn,isValid:function(preventMark){if(this.disabled){return true}var restore=this.preventMark;this.preventMark=preventMark===true;var v=this.validateValue(this.processValue(this.getRawValue()));this.preventMark=restore;return v},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();return true}return false},processValue:function(value){return value},validateValue:function(value){return true},markInvalid:function(msg){if(!this.rendered||this.preventMark){return}msg=msg||this.invalidText;var mt=this.getMessageHandler();if(mt){mt.mark(this,msg)}else{if(this.msgTarget){this.el.addClass(this.invalidClass);var t=Ext.getDom(this.msgTarget);if(t){t.innerHTML=msg;t.style.display=this.msgDisplay}}}this.fireEvent("invalid",this,msg)},clearInvalid:function(){if(!this.rendered||this.preventMark){return}this.el.removeClass(this.invalidClass);var mt=this.getMessageHandler();if(mt){mt.clear(this)}else{if(this.msgTarget){this.el.removeClass(this.invalidClass);var t=Ext.getDom(this.msgTarget);if(t){t.innerHTML="";t.style.display="none"}}}this.fireEvent("valid",this)},getMessageHandler:function(){return Ext.form.MessageTargets[this.msgTarget]},getErrorCt:function(){return this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true)},alignErrorIcon:function(){this.errorIcon.alignTo(this.el,"tl-tr",[2,0])},getRawValue:function(){var v=this.rendered?this.el.getValue():Ext.value(this.value,"");if(v===this.emptyText){v=""}return v},getValue:function(){if(!this.rendered){return this.value}var v=this.el.getValue();if(v===this.emptyText||v===undefined){v=""}return v},setRawValue:function(v){return this.rendered?(this.el.dom.value=(Ext.isEmpty(v)?"":v)):""},setValue:function(v){this.value=v;if(this.rendered){this.el.dom.value=(Ext.isEmpty(v)?"":v);this.validate()}return this},append:function(v){this.setValue([this.getValue(),v].join(""))}});Ext.form.MessageTargets={qtip:{mark:function(field,msg){field.el.addClass(field.invalidClass);field.el.dom.qtip=msg;field.el.dom.qclass="x-form-invalid-tip";if(Ext.QuickTips){Ext.QuickTips.enable()}},clear:function(field){field.el.removeClass(field.invalidClass);field.el.dom.qtip=""}},title:{mark:function(field,msg){field.el.addClass(field.invalidClass);field.el.dom.title=msg},clear:function(field){field.el.dom.title=""}},under:{mark:function(field,msg){field.el.addClass(field.invalidClass);if(!field.errorEl){var elp=field.getErrorCt();if(!elp){field.el.dom.title=msg;return}field.errorEl=elp.createChild({cls:"x-form-invalid-msg"});field.errorEl.setWidth(elp.getWidth(true)-20)}field.errorEl.update(msg);Ext.form.Field.msgFx[field.msgFx].show(field.errorEl,field)},clear:function(field){field.el.removeClass(field.invalidClass);if(field.errorEl){Ext.form.Field.msgFx[field.msgFx].hide(field.errorEl,field)}else{field.el.dom.title=""}}},side:{mark:function(field,msg){field.el.addClass(field.invalidClass);if(!field.errorIcon){var elp=field.getErrorCt();if(!elp){field.el.dom.title=msg;return}field.errorIcon=elp.createChild({cls:"x-form-invalid-icon"})}field.alignErrorIcon();field.errorIcon.dom.qtip=msg;field.errorIcon.dom.qclass="x-form-invalid-tip";field.errorIcon.show();field.on("resize",field.alignErrorIcon,field)},clear:function(field){field.el.removeClass(field.invalidClass);if(field.errorIcon){field.errorIcon.dom.qtip="";field.errorIcon.hide();field.un("resize",field.alignErrorIcon,field)}else{field.el.dom.title=""}}}};Ext.form.Field.msgFx={normal:{show:function(msgEl,f){msgEl.setDisplayed("block")},hide:function(msgEl,f){msgEl.setDisplayed(false).update("")}},slide:{show:function(msgEl,f){msgEl.slideIn("t",{stopFx:true})},hide:function(msgEl,f){msgEl.slideOut("t",{stopFx:true,useDisplay:true})}},slideRight:{show:function(msgEl,f){msgEl.fixDisplay();msgEl.alignTo(f.el,"tl-tr");msgEl.slideIn("l",{stopFx:true})},hide:function(msgEl,f){msgEl.slideOut("l",{stopFx:true,useDisplay:true})}}};Ext.reg("field",Ext.form.Field);Ext.form.TextField=Ext.extend(Ext.form.Field,{grow:false,growMin:30,growMax:800,vtype:null,maskRe:null,disableKeyFilter:false,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",selectOnFocus:false,blankText:"This field is required",validator:null,regex:null,regexText:"",emptyText:null,emptyClass:"x-form-empty-field",initComponent:function(){Ext.form.TextField.superclass.initComponent.call(this);this.addEvents("autosize","keydown","keyup","keypress")},initEvents:function(){Ext.form.TextField.superclass.initEvents.call(this);if(this.validationEvent=="keyup"){this.validationTask=new Ext.util.DelayedTask(this.validate,this);this.mon(this.el,"keyup",this.filterValidation,this)}else{if(this.validationEvent!==false&&this.validationEvent!="blur"){this.mon(this.el,this.validationEvent,this.validate,this,{buffer:this.validationDelay})}}if(this.selectOnFocus||this.emptyText){this.mon(this.el,"mousedown",this.onMouseDown,this);if(this.emptyText){this.applyEmptyText()}}if(this.maskRe||(this.vtype&&this.disableKeyFilter!==true&&(this.maskRe=Ext.form.VTypes[this.vtype+"Mask"]))){this.mon(this.el,"keypress",this.filterKeys,this)}if(this.grow){this.mon(this.el,"keyup",this.onKeyUpBuffered,this,{buffer:50});this.mon(this.el,"click",this.autoSize,this)}if(this.enableKeyEvents){this.mon(this.el,{scope:this,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress})}},onMouseDown:function(e){if(!this.hasFocus){this.mon(this.el,"mouseup",Ext.emptyFn,this,{single:true,preventDefault:true})}},processValue:function(value){if(this.stripCharsRe){var newValue=value.replace(this.stripCharsRe,"");if(newValue!==value){this.setRawValue(newValue);return newValue}}return value},filterValidation:function(e){if(!e.isNavKeyPress()){this.validationTask.delay(this.validationDelay)}},onDisable:function(){Ext.form.TextField.superclass.onDisable.call(this);if(Ext.isIE){this.el.dom.unselectable="on"}},onEnable:function(){Ext.form.TextField.superclass.onEnable.call(this);if(Ext.isIE){this.el.dom.unselectable=""}},onKeyUpBuffered:function(e){if(!e.isNavKeyPress()){this.autoSize()}},onKeyUp:function(e){this.fireEvent("keyup",this,e)},onKeyDown:function(e){this.fireEvent("keydown",this,e)},onKeyPress:function(e){this.fireEvent("keypress",this,e)},reset:function(){Ext.form.TextField.superclass.reset.call(this);this.applyEmptyText()},applyEmptyText:function(){if(this.rendered&&this.emptyText&&this.getRawValue().length<1&&!this.hasFocus){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass)}},preFocus:function(){var el=this.el;if(this.emptyText){if(el.dom.value==this.emptyText){this.setRawValue("")}el.removeClass(this.emptyClass)}if(this.selectOnFocus){el.dom.select()}},postBlur:function(){this.applyEmptyText()},filterKeys:function(e){if(e.ctrlKey||e.isSpecialKey()){return}if(!this.maskRe.test(String.fromCharCode(e.getCharCode()))){e.stopEvent()}},setValue:function(v){if(this.emptyText&&this.el&&!Ext.isEmpty(v)){this.el.removeClass(this.emptyClass)}Ext.form.TextField.superclass.setValue.apply(this,arguments);this.applyEmptyText();this.autoSize();return this},validateValue:function(value){if(Ext.isFunction(this.validator)){var msg=this.validator(value);if(msg!==true){this.markInvalid(msg);return false}}if(value.length<1||value===this.emptyText){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(value.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(value.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var vt=Ext.form.VTypes;if(!vt[this.vtype](value,this)){this.markInvalid(this.vtypeText||vt[this.vtype+"Text"]);return false}}if(this.regex&&!this.regex.test(value)){this.markInvalid(this.regexText);return false}return true},selectText:function(start,end){var v=this.getRawValue();var doFocus=false;if(v.length>0){start=start===undefined?0:start;end=end===undefined?v.length:end;var d=this.el.dom;if(d.setSelectionRange){d.setSelectionRange(start,end)}else{if(d.createTextRange){var range=d.createTextRange();range.moveStart("character",start);range.moveEnd("character",end-v.length);range.select()}}doFocus=Ext.isGecko||Ext.isOpera}else{doFocus=true}if(doFocus){this.focus()}},autoSize:function(){if(!this.grow||!this.rendered){return}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)}var el=this.el;var v=el.dom.value;var d=document.createElement("div");d.appendChild(document.createTextNode(v));v=d.innerHTML;d=null;Ext.removeNode(d);v+="&#160;";var w=Math.min(this.growMax,Math.max(this.metrics.getWidth(v)+10,this.growMin));this.el.setWidth(w);this.fireEvent("autosize",this,w)},onDestroy:function(){if(this.validationTask){this.validationTask.cancel();this.validationTask=null}Ext.form.TextField.superclass.onDestroy.call(this)}});Ext.reg("textfield",Ext.form.TextField);Ext.form.TriggerField=Ext.extend(Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"text",size:"16",autocomplete:"off"},hideTrigger:false,editable:true,wrapFocusClass:"x-trigger-wrap-focus",autoSize:Ext.emptyFn,monitorTab:true,deferHeight:true,mimicing:false,actionMode:"wrap",defaultTriggerWidth:17,onResize:function(w,h){Ext.form.TriggerField.superclass.onResize.call(this,w,h);var tw=this.getTriggerWidth();if(Ext.isNumber(w)){this.el.setWidth(w-tw)}this.wrap.setWidth(this.el.getWidth()+tw)},getTriggerWidth:function(){var tw=this.trigger.getWidth();if(!this.hideTrigger&&tw===0){tw=this.defaultTriggerWidth}return tw},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},onRender:function(ct,position){this.doc=Ext.isIE?Ext.getBody():Ext.getDoc();Ext.form.TriggerField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-field-trigger-wrap"});this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(this.hideTrigger){this.trigger.setDisplayed(false)}this.initTrigger();if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())}if(!this.editable){this.editable=true;this.setEditable(false)}this.resizeEl=this.positionEl=this.wrap},afterRender:function(){Ext.form.TriggerField.superclass.afterRender.call(this)},initTrigger:function(){this.mon(this.trigger,"click",this.onTriggerClick,this,{preventDefault:true});this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},onDestroy:function(){Ext.destroy(this.trigger,this.wrap);if(this.mimicing){this.doc.un("mousedown",this.mimicBlur,this)}Ext.form.TriggerField.superclass.onDestroy.call(this)},onFocus:function(){Ext.form.TriggerField.superclass.onFocus.call(this);if(!this.mimicing){this.wrap.addClass(this.wrapFocusClass);this.mimicing=true;this.doc.on("mousedown",this.mimicBlur,this,{delay:10});if(this.monitorTab){this.on("specialkey",this.checkTab,this)}}},checkTab:function(me,e){if(e.getKey()==e.TAB){this.triggerBlur()}},onBlur:Ext.emptyFn,mimicBlur:function(e){if(!this.isDestroyed&&!this.wrap.contains(e.target)&&this.validateBlur(e)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;this.doc.un("mousedown",this.mimicBlur,this);if(this.monitorTab&&this.el){this.un("specialkey",this.checkTab,this)}Ext.form.TriggerField.superclass.onBlur.call(this);if(this.wrap){this.wrap.removeClass(this.wrapFocusClass)}},beforeBlur:Ext.emptyFn,setEditable:function(value){if(value==this.editable){return}this.editable=value;if(!value){this.el.addClass("x-trigger-noedit").on("click",this.onTriggerClick,this).dom.setAttribute("readOnly",true)}else{this.el.removeClass("x-trigger-noedit").un("click",this.onTriggerClick,this).dom.removeAttribute("readOnly")}},validateBlur:function(e){return true},onTriggerClick:Ext.emptyFn});Ext.form.TwinTriggerField=Ext.extend(Ext.form.TriggerField,{initComponent:function(){Ext.form.TwinTriggerField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class}]}},getTrigger:function(index){return this.triggers[index]},initTrigger:function(){var ts=this.trigger.select(".x-form-trigger",true);var triggerField=this;ts.each(function(t,all,index){var triggerIndex="Trigger"+(index+1);t.hide=function(){var w=triggerField.wrap.getWidth();this.dom.style.display="none";triggerField.el.setWidth(w-triggerField.trigger.getWidth());this["hidden"+triggerIndex]=true};t.show=function(){var w=triggerField.wrap.getWidth();this.dom.style.display="";triggerField.el.setWidth(w-triggerField.trigger.getWidth());this["hidden"+triggerIndex]=false};if(this["hide"+triggerIndex]){t.dom.style.display="none";this["hidden"+triggerIndex]=true}this.mon(t,"click",this["on"+triggerIndex+"Click"],this,{preventDefault:true});t.addClassOnOver("x-form-trigger-over");t.addClassOnClick("x-form-trigger-click")},this);this.triggers=ts.elements},getTriggerWidth:function(){var tw=0;Ext.each(this.triggers,function(t,index){var triggerIndex="Trigger"+(index+1),w=t.getWidth();if(w===0&&!this["hidden"+triggerIndex]){tw+=this.defaultTriggerWidth}else{tw+=w}},this);return tw},onDestroy:function(){Ext.destroy(this.triggers);Ext.form.TwinTriggerField.superclass.onDestroy.call(this)},onTrigger1Click:Ext.emptyFn,onTrigger2Click:Ext.emptyFn});Ext.reg("trigger",Ext.form.TriggerField);Ext.form.TextArea=Ext.extend(Ext.form.TextField,{growMin:60,growMax:1000,growAppend:"&#160;\n&#160;",growPad:Ext.isWebKit?-6:0,enterIsSpecial:false,preventScrollbars:false,onRender:function(ct,position){if(!this.el){this.defaultAutoCreate={tag:"textarea",style:"width:100px;height:60px;",autocomplete:"off"}}Ext.form.TextArea.superclass.onRender.call(this,ct,position);if(this.grow){this.textSizeEl=Ext.DomHelper.append(document.body,{tag:"pre",cls:"x-form-grow-sizer"});if(this.preventScrollbars){this.el.setStyle("overflow","hidden")}this.el.setHeight(this.growMin)}},onDestroy:function(){Ext.destroy(this.textSizeEl);Ext.form.TextArea.superclass.onDestroy.call(this)},fireKey:function(e){if(e.isSpecialKey()&&(this.enterIsSpecial||(e.getKey()!=e.ENTER||e.hasModifier()))){this.fireEvent("specialkey",this,e)}},onKeyUp:function(e){if(!e.isNavKeyPress()||e.getKey()==e.ENTER){this.autoSize()}Ext.form.TextArea.superclass.onKeyUp.call(this,e)},autoSize:function(){if(!this.grow||!this.textSizeEl){return}var el=this.el;var v=el.dom.value;var ts=this.textSizeEl;ts.innerHTML="";ts.appendChild(document.createTextNode(v));v=ts.innerHTML;Ext.fly(ts).setWidth(this.el.getWidth());if(v.length<1){v="&#160;&#160;"}else{v+=this.growAppend;if(Ext.isIE){v=v.replace(/\n/g,"<br />")}}ts.innerHTML=v;var h=Math.min(this.growMax,Math.max(ts.offsetHeight,this.growMin)+this.growPad);if(h!=this.lastHeight){this.lastHeight=h;this.el.setHeight(h);this.fireEvent("autosize",this,h)}}});Ext.reg("textarea",Ext.form.TextArea);Ext.form.NumberField=Ext.extend(Ext.form.TextField,{fieldClass:"x-form-field x-form-num-field",allowDecimals:true,decimalSeparator:".",decimalPrecision:2,allowNegative:true,minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,minText:"The minimum value for this field is {0}",maxText:"The maximum value for this field is {0}",nanText:"{0} is not a valid number",baseChars:"0123456789",initEvents:function(){var allowed=this.baseChars+"";if(this.allowDecimals){allowed+=this.decimalSeparator}if(this.allowNegative){allowed+="-"}this.maskRe=new RegExp("["+Ext.escapeRe(allowed)+"]");Ext.form.NumberField.superclass.initEvents.call(this)},validateValue:function(value){if(!Ext.form.NumberField.superclass.validateValue.call(this,value)){return false}if(value.length<1){return true}value=String(value).replace(this.decimalSeparator,".");if(isNaN(value)){this.markInvalid(String.format(this.nanText,value));return false}var num=this.parseValue(value);if(num<this.minValue){this.markInvalid(String.format(this.minText,this.minValue));return false}if(num>this.maxValue){this.markInvalid(String.format(this.maxText,this.maxValue));return false}return true},getValue:function(){return this.fixPrecision(this.parseValue(Ext.form.NumberField.superclass.getValue.call(this)))},setValue:function(v){v=typeof v=="number"?v:parseFloat(String(v).replace(this.decimalSeparator,"."));v=isNaN(v)?"":String(v).replace(".",this.decimalSeparator);return Ext.form.NumberField.superclass.setValue.call(this,v)},parseValue:function(value){value=parseFloat(String(value).replace(this.decimalSeparator,"."));return isNaN(value)?"":value},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?"":value}return parseFloat(parseFloat(value).toFixed(this.decimalPrecision))},beforeBlur:function(){var v=this.parseValue(this.getRawValue());if(!Ext.isEmpty(v)){this.setValue(this.fixPrecision(v))}}});Ext.reg("numberfield",Ext.form.NumberField);Ext.form.DateField=Ext.extend(Ext.form.TriggerField,{format:"m/d/Y",altFormats:"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:"x-form-date-trigger",showToday:true,defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initComponent:function(){Ext.form.DateField.superclass.initComponent.call(this);this.addEvents("select");if(Ext.isString(this.minValue)){this.minValue=this.parseDate(this.minValue)}if(Ext.isString(this.maxValue)){this.maxValue=this.parseDate(this.maxValue)}this.disabledDatesRE=null;this.initDisabledDays()},initDisabledDays:function(){if(this.disabledDates){var dd=this.disabledDates,len=dd.length-1,re="(?:";Ext.each(dd,function(d,i){re+=Ext.isDate(d)?"^"+Ext.escapeRe(d.dateFormat(this.format))+"$":dd[i];if(i!=len){re+="|"}},this);this.disabledDatesRE=new RegExp(re+")")}},setDisabledDates:function(dd){this.disabledDates=dd;this.initDisabledDays();if(this.menu){this.menu.picker.setDisabledDates(this.disabledDatesRE)}},setDisabledDays:function(dd){this.disabledDays=dd;if(this.menu){this.menu.picker.setDisabledDays(dd)}},setMinValue:function(dt){this.minValue=(Ext.isString(dt)?this.parseDate(dt):dt);if(this.menu){this.menu.picker.setMinDate(this.minValue)}},setMaxValue:function(dt){this.maxValue=(Ext.isString(dt)?this.parseDate(dt):dt);if(this.menu){this.menu.picker.setMaxDate(this.maxValue)}},validateValue:function(value){value=this.formatDate(value);if(!Ext.form.DateField.superclass.validateValue.call(this,value)){return false}if(value.length<1){return true}var svalue=value;value=this.parseDate(value);if(!value){this.markInvalid(String.format(this.invalidText,svalue,this.format));return false}var time=value.getTime();if(this.minValue&&time<this.minValue.getTime()){this.markInvalid(String.format(this.minText,this.formatDate(this.minValue)));return false}if(this.maxValue&&time>this.maxValue.getTime()){this.markInvalid(String.format(this.maxText,this.formatDate(this.maxValue)));return false}if(this.disabledDays){var day=value.getDay();for(var i=0;i<this.disabledDays.length;i++){if(day===this.disabledDays[i]){this.markInvalid(this.disabledDaysText);return false}}}var fvalue=this.formatDate(value);if(this.disabledDatesRE&&this.disabledDatesRE.test(fvalue)){this.markInvalid(String.format(this.disabledDatesText,fvalue));return false}return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},getValue:function(){return this.parseDate(Ext.form.DateField.superclass.getValue.call(this))||""},setValue:function(date){return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(date)))},parseDate:function(value){if(!value||Ext.isDate(value)){return value}var v=Date.parseDate(value,this.format);if(!v&&this.altFormats){if(!this.altFormatsArray){this.altFormatsArray=this.altFormats.split("|")}for(var i=0,len=this.altFormatsArray.length;i<len&&!v;i++){v=Date.parseDate(value,this.altFormatsArray[i])}}return v},onDestroy:function(){Ext.destroy(this.menu);Ext.form.DateField.superclass.onDestroy.call(this)},formatDate:function(date){return Ext.isDate(date)?date.dateFormat(this.format):date},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on")},menuEvents:function(method){this.menu[method]("select",this.onSelect,this);this.menu[method]("hide",this.onMenuHide,this);this.menu[method]("show",this.onFocus,this)},onSelect:function(m,d){this.setValue(d);this.fireEvent("select",this,d);this.menu.hide()},onMenuHide:function(){this.focus(false,60);this.menuEvents("un")},beforeBlur:function(){var v=this.parseDate(this.getRawValue());if(v){this.setValue(v)}}});Ext.reg("datefield",Ext.form.DateField);Ext.form.DisplayField=Ext.extend(Ext.form.Field,{validationEvent:false,validateOnBlur:false,defaultAutoCreate:{tag:"div"},fieldClass:"x-form-display-field",htmlEncode:false,initEvents:Ext.emptyFn,isValid:function(){return true},validate:function(){return true},getRawValue:function(){var v=this.rendered?this.el.dom.innerHTML:Ext.value(this.value,"");if(v===this.emptyText){v=""}if(this.htmlEncode){v=Ext.util.Format.htmlDecode(v)}return v},getValue:function(){return this.getRawValue()},getName:function(){return this.name},setRawValue:function(v){if(this.htmlEncode){v=Ext.util.Format.htmlEncode(v)}return this.rendered?(this.el.dom.innerHTML=(Ext.isEmpty(v)?"":v)):(this.value=v)},setValue:function(v){this.setRawValue(v);return this}});Ext.reg("displayfield",Ext.form.DisplayField);Ext.form.ComboBox=Ext.extend(Ext.form.TriggerField,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:"",selectedClass:"x-combo-selected",listEmptyText:"",triggerClass:"x-form-arrow-trigger",shadow:"sides",listAlign:"tl-bl?",maxHeight:300,minHeight:90,triggerAction:"query",minChars:4,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:"query",loadingText:"Loading...",resizable:false,handleHeight:8,allQuery:"",mode:"remote",minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,initComponent:function(){Ext.form.ComboBox.superclass.initComponent.call(this);this.addEvents("expand","collapse","beforeselect","select","beforequery");if(this.transform){var s=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=s.name}if(!this.store){this.mode="local";var d=[],opts=s.options;for(var i=0,len=opts.length;i<len;i++){var o=opts[i],value=(o.hasAttribute?o.hasAttribute("value"):o.getAttributeNode("value").specified)?o.value:o.text;if(o.selected&&Ext.isEmpty(this.value,true)){this.value=value}d.push([value,o.text])}this.store=new Ext.data.ArrayStore({id:0,fields:["value","text"],data:d,autoDestroy:true});this.valueField="value";this.displayField="text"}s.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(s,this.autoCreate||this.defaultAutoCreate);this.render(this.el.parentNode,s);Ext.removeNode(s)}else{Ext.removeNode(s)}}else{if(this.store){this.store=Ext.StoreMgr.lookup(this.store);if(this.store.autoCreated){this.displayField=this.valueField="field1";if(!this.store.expandData){this.displayField="field2"}this.mode="local"}}}this.selectedIndex=-1;if(this.mode=="local"){if(!Ext.isDefined(this.initialConfig.queryDelay)){this.queryDelay=10}if(!Ext.isDefined(this.initialConfig.minChars)){this.minChars=0}}},onRender:function(ct,position){Ext.form.ComboBox.superclass.onRender.call(this,ct,position);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.el.dom.removeAttribute("name")}if(Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")}if(!this.lazyInit){this.initList()}else{this.on("focus",this.initList,this,{single:true})}},initValue:function(){Ext.form.ComboBox.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=Ext.isDefined(this.hiddenValue)?this.hiddenValue:Ext.isDefined(this.value)?this.value:""}},initList:function(){if(!this.list){var cls="x-combo-list";this.list=new Ext.Layer({parentEl:this.getListParent(),shadow:this.shadow,cls:[cls,this.listClass].join(" "),constrain:false});var lw=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setSize(lw,0);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.syncFont!==false){this.list.setStyle("font-size",this.el.getStyle("font-size"))}if(this.title){this.header=this.list.createChild({cls:cls+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:cls+"-inner"});this.mon(this.innerList,"mouseover",this.onViewOver,this);this.mon(this.innerList,"mousemove",this.onViewMove,this);this.innerList.setWidth(lw-this.list.getFrameWidth("lr"));if(this.pageSize){this.footer=this.list.createChild({cls:cls+"-ft"});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight()}if(!this.tpl){this.tpl='<tpl for="."><div class="'+cls+'-item">{'+this.displayField+"}</div></tpl>"}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+cls+"-item",emptyText:this.listEmptyText});this.mon(this.view,"click",this.onViewClick,this);this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.mon(this.resizer,"resize",function(r,w,h){this.maxHeight=h-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=w;this.innerList.setWidth(w-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},getListParent:function(){return document.body},getStore:function(){return this.store},bindStore:function(store,initial){if(this.store&&!initial){if(this.store!==store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("exception",this.collapse,this)}if(!store){this.store=null;if(this.view){this.view.bindStore(null)}if(this.pageTb){this.pageTb.bindStore(null)}}}if(store){if(!initial){this.lastQuery=null;if(this.pageTb){this.pageTb.bindStore(store)}}this.store=Ext.StoreMgr.lookup(store);this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.collapse});if(this.view){this.view.bindStore(store)}}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(e){this.inKeyMode=true;this.selectPrev()},down:function(e){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(e){this.onViewClick()},esc:function(e){this.collapse()},tab:function(e){this.onViewClick(false);return true},scope:this,doRelay:function(e,h,hname){if(hname=="down"||this.scope.isExpanded()){var relay=Ext.KeyNav.prototype.doRelay.apply(this,arguments);if(!Ext.isIE&&Ext.EventManager.useKeydown){this.scope.fireKey(e)}return relay}return true},forceKeyDown:true,defaultEventAction:"stopEvent"});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false&&!this.enableKeyEvents){this.mon(this.el,"keyup",this.onKeyUp,this)}},onDestroy:function(){if(this.dqTask){this.dqTask.cancel();this.dqTask=null}this.bindStore(null);Ext.destroy(this.resizer,this.view,this.pageTb,this.list);Ext.form.ComboBox.superclass.onDestroy.call(this)},fireKey:function(e){if(!this.isExpanded()){Ext.form.ComboBox.superclass.fireKey.call(this,e)}},onResize:function(w,h){Ext.form.ComboBox.superclass.onResize.apply(this,arguments);if(this.isVisible()&&this.list){this.doResize(w)}else{this.bufferSize=w}},doResize:function(w){if(!Ext.isDefined(this.listWidth)){var lw=Math.max(w,this.minListWidth);this.list.setWidth(lw);this.innerList.setWidth(lw-this.list.getFrameWidth("lr"))}},onEnable:function(){Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false}},onDisable:function(){Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true}},onBeforeLoad:function(){if(!this.hasFocus){return}this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+"</div>":"");this.restrictHeight();this.selectedIndex=-1},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0||this.listEmptyText){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onTypeAhead:function(){if(this.store.getCount()>0){var r=this.store.getAt(0);var newValue=r.data[this.displayField];var len=newValue.length;var selStart=this.getRawValue().length;if(selStart!=len){this.setRawValue(newValue);this.selectText(selStart,newValue.length)}}},onSelect:function(record,index){if(this.fireEvent("beforeselect",this,record,index)!==false){this.setValue(record.data[this.valueField||this.displayField]);this.collapse();this.fireEvent("select",this,record,index)}},getName:function(){var hf=this.hiddenField;return hf&&hf.name?hf.name:this.hiddenName||Ext.form.ComboBox.superclass.getName.call(this)},getValue:function(){if(this.valueField){return Ext.isDefined(this.value)?this.value:""}else{return Ext.form.ComboBox.superclass.getValue.call(this)}},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.value=""},setValue:function(v){var text=v;if(this.valueField){var r=this.findRecord(this.valueField,v);if(r){text=r.data[this.displayField]}else{if(Ext.isDefined(this.valueNotFoundText)){text=this.valueNotFoundText}}}this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=v}Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=v;return this},findRecord:function(prop,value){var record;if(this.store.getCount()>0){this.store.each(function(r){if(r.data[prop]==value){record=r;return false}})}return record},onViewMove:function(e,t){this.inKeyMode=false},onViewOver:function(e,t){if(this.inKeyMode){return}var item=this.view.findItemFromChild(t);if(item){var index=this.view.indexOf(item);this.select(index,false)}},onViewClick:function(doFocus){var index=this.view.getSelectedIndexes()[0],s=this.store,r=s.getAt(index);if(r){this.onSelect(r,index)}else{if(s.getCount()===0){this.onEmptyResults()}}if(doFocus!==false){this.el.focus()}},restrictHeight:function(){this.innerList.dom.style.height="";var inner=this.innerList.dom,pad=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,h=Math.max(inner.clientHeight,inner.offsetHeight,inner.scrollHeight),ha=this.getPosition()[1]-Ext.getBody().getScroll().top,hb=Ext.lib.Dom.getViewHeight()-ha-this.getSize().height,space=Math.max(ha,hb,this.minHeight||0)-this.list.shadowOffset-pad-5;h=Math.min(h,space,this.maxHeight);this.innerList.setHeight(h);this.list.beginUpdate();this.list.setHeight(h+pad);this.list.alignTo(this.wrap,this.listAlign);this.list.endUpdate()},onEmptyResults:function(){this.collapse()},isExpanded:function(){return this.list&&this.list.isVisible()},selectByValue:function(v,scrollIntoView){if(!Ext.isEmpty(v,true)){var r=this.findRecord(this.valueField||this.displayField,v);if(r){this.select(this.store.indexOf(r),scrollIntoView);return true}}return false},select:function(index,scrollIntoView){this.selectedIndex=index;this.view.select(index);if(scrollIntoView!==false){var el=this.view.getNode(index);if(el){this.innerList.scrollChildIntoView(el,false)}}},selectNext:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex<ct-1){this.select(this.selectedIndex+1)}}}},selectPrev:function(){var ct=this.store.getCount();if(ct>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex!==0){this.select(this.selectedIndex-1)}}}},onKeyUp:function(e){var k=e.getKey();if(this.editable!==false&&(k==e.BACKSPACE||!e.isSpecialKey())){this.lastKey=k;this.dqTask.delay(this.queryDelay)}Ext.form.ComboBox.superclass.onKeyUp.call(this,e)},validateBlur:function(){return !this.list||!this.list.isVisible()},initQuery:function(){this.doQuery(this.getRawValue())},beforeBlur:function(){var val=this.getRawValue(),rec=this.findRecord(this.displayField,val);if(!rec&&this.forceSelection){if(val.length>0&&val!=this.emptyText){this.el.dom.value=Ext.isDefined(this.lastSelectionText)?this.lastSelectionText:"";this.applyEmptyText()}else{this.clearValue()}}else{if(rec){val=rec.get(this.valueField||this.displayField)}this.setValue(val)}},doQuery:function(q,forceAll){q=Ext.isEmpty(q)?"":q;var qe={query:q,forceAll:forceAll,combo:this,cancel:false};if(this.fireEvent("beforequery",qe)===false||qe.cancel){return false}q=qe.query;forceAll=qe.forceAll;if(forceAll===true||(q.length>=this.minChars)){if(this.lastQuery!==q){this.lastQuery=q;if(this.mode=="local"){this.selectedIndex=-1;if(forceAll){this.store.clearFilter()}else{this.store.filter(this.displayField,q)}this.onLoad()}else{this.store.baseParams[this.queryParam]=q;this.store.load({params:this.getParams(q)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},getParams:function(q){var p={};if(this.pageSize){p.start=0;p.limit=this.pageSize}return p},collapse:function(){if(!this.isExpanded()){return}this.list.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(e){if(!e.within(this.wrap)&&!e.within(this.list)){this.collapse()}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize}this.list.alignTo(this.wrap,this.listAlign);this.list.show();if(Ext.isGecko2){this.innerList.setOverflow("auto")}Ext.getDoc().on({scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this)},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)}else{this.doQuery(this.getRawValue())}this.el.focus()}}});Ext.reg("combo",Ext.form.ComboBox);Ext.form.Checkbox=Ext.extend(Ext.form.Field,{focusClass:undefined,fieldClass:"x-form-field",checked:false,defaultAutoCreate:{tag:"input",type:"checkbox",autocomplete:"off"},actionMode:"wrap",initComponent:function(){Ext.form.Checkbox.superclass.initComponent.call(this);this.addEvents("check")},onResize:function(){Ext.form.Checkbox.superclass.onResize.apply(this,arguments);if(!this.boxLabel&&!this.fieldLabel){this.el.alignTo(this.wrap,"c-c")}},initEvents:function(){Ext.form.Checkbox.superclass.initEvents.call(this);this.mon(this.el,{scope:this,click:this.onClick,change:this.onClick})},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,onRender:function(ct,position){Ext.form.Checkbox.superclass.onRender.call(this,ct,position);if(this.inputValue!==undefined){this.el.dom.value=this.inputValue}this.wrap=this.el.wrap({cls:"x-form-check-wrap"});if(this.boxLabel){this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})}if(this.checked){this.setValue(true)}else{this.checked=this.el.dom.checked}if(Ext.isIE){this.wrap.repaint()}this.resizeEl=this.positionEl=this.wrap},onDestroy:function(){Ext.destroy(this.wrap);Ext.form.Checkbox.superclass.onDestroy.call(this)},initValue:function(){this.originalValue=this.getValue()},getValue:function(){if(this.rendered){return this.el.dom.checked}return this.checked},onClick:function(){if(this.el.dom.checked!=this.checked){this.setValue(this.el.dom.checked)}},setValue:function(v){var checked=this.checked;this.checked=(v===true||v==="true"||v=="1"||String(v).toLowerCase()=="on");if(this.rendered){this.el.dom.checked=this.checked;this.el.dom.defaultChecked=this.checked}if(checked!=this.checked){this.fireEvent("check",this,this.checked);if(this.handler){this.handler.call(this.scope||this,this,this.checked)}}return this}});Ext.reg("checkbox",Ext.form.Checkbox);Ext.form.CheckboxGroup=Ext.extend(Ext.form.Field,{columns:"auto",vertical:false,allowBlank:true,blankText:"You must select at least one item in this group",defaultType:"checkbox",groupCls:"x-form-check-group",initComponent:function(){this.addEvents("change");Ext.form.CheckboxGroup.superclass.initComponent.call(this)},onRender:function(ct,position){if(!this.el){var panelCfg={id:this.id,cls:this.groupCls,layout:"column",border:false,renderTo:ct,bufferResize:false};var colCfg={defaultType:this.defaultType,layout:"form",border:false,defaults:{hideLabel:true,anchor:"100%"}};if(this.items[0].items){Ext.apply(panelCfg,{layoutConfig:{columns:this.items.length},defaults:this.defaults,items:this.items});for(var i=0,len=this.items.length;i<len;i++){Ext.applyIf(this.items[i],colCfg)}}else{var numCols,cols=[];if(typeof this.columns=="string"){this.columns=this.items.length}if(!Ext.isArray(this.columns)){var cs=[];for(var i=0;i<this.columns;i++){cs.push((100/this.columns)*0.01)}this.columns=cs}numCols=this.columns.length;for(var i=0;i<numCols;i++){var cc=Ext.apply({items:[]},colCfg);cc[this.columns[i]<=1?"columnWidth":"width"]=this.columns[i];if(this.defaults){cc.defaults=Ext.apply(cc.defaults||{},this.defaults)}cols.push(cc)}if(this.vertical){var rows=Math.ceil(this.items.length/numCols),ri=0;for(var i=0,len=this.items.length;i<len;i++){if(i>0&&i%rows==0){ri++}if(this.items[i].fieldLabel){this.items[i].hideLabel=false}cols[ri].items.push(this.items[i])}}else{for(var i=0,len=this.items.length;i<len;i++){var ci=i%numCols;if(this.items[i].fieldLabel){this.items[i].hideLabel=false}cols[ci].items.push(this.items[i])}}Ext.apply(panelCfg,{layoutConfig:{columns:numCols},items:cols})}this.panel=new Ext.Panel(panelCfg);this.panel.ownerCt=this;this.el=this.panel.getEl();if(this.forId&&this.itemCls){var l=this.el.up(this.itemCls).child("label",true);if(l){l.setAttribute("htmlFor",this.forId)}}var fields=this.panel.findBy(function(c){return c.isFormField},this);this.items=new Ext.util.MixedCollection();this.items.addAll(fields)}Ext.form.CheckboxGroup.superclass.onRender.call(this,ct,position)},initValue:function(){if(this.value){this.setValue.apply(this,this.buffered?this.value:[this.value]);delete this.buffered;delete this.value}},afterRender:function(){Ext.form.CheckboxGroup.superclass.afterRender.call(this);this.eachItem(function(item){item.on("check",this.fireChecked,this);item.inGroup=true})},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;this.panel.doLayout()}},fireChecked:function(){var arr=[];this.eachItem(function(item){if(item.checked){arr.push(item)}});this.fireEvent("change",this,arr)},validateValue:function(value){if(!this.allowBlank){var blank=true;this.eachItem(function(f){if(f.checked){return(blank=false)}});if(blank){this.markInvalid(this.blankText);return false}}return true},isDirty:function(){if(this.disabled||!this.rendered){return false}var dirty=false;this.eachItem(function(item){if(item.isDirty()){dirty=true;return false}});return dirty},onDisable:function(){this.eachItem(function(item){item.disable()})},onEnable:function(){this.eachItem(function(item){item.enable()})},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;this.panel.doLayout()}},onResize:function(w,h){this.panel.setSize(w,h);this.panel.doLayout()},reset:function(){Ext.form.CheckboxGroup.superclass.reset.call(this);this.eachItem(function(c){if(c.reset){c.reset()}})},setValue:function(){if(this.rendered){this.onSetValue.apply(this,arguments)}else{this.buffered=true;this.value=arguments}return this},onSetValue:function(id,value){if(arguments.length==1){if(Ext.isArray(id)){Ext.each(id,function(val,idx){var item=this.items.itemAt(idx);if(item){item.setValue(val)}},this)}else{if(Ext.isObject(id)){for(var i in id){var f=this.getBox(i);if(f){f.setValue(id[i])}}}else{this.setValueForItem(id)}}}else{var f=this.getBox(id);if(f){f.setValue(value)}}},onDestroy:function(){Ext.destroy(this.panel);Ext.form.CheckboxGroup.superclass.onDestroy.call(this)},setValueForItem:function(val){val=String(val).split(",");this.eachItem(function(item){if(val.indexOf(item.inputValue)>-1){item.setValue(true)}})},getBox:function(id){var box=null;this.eachItem(function(f){if(id==f||f.dataIndex==id||f.id==id||f.getName()==id){box=f;return false}});return box},getValue:function(){var out=[];this.eachItem(function(item){if(item.checked){out.push(item)}});return out},eachItem:function(fn){if(this.items&&this.items.each){this.items.each(fn,this)}},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("checkboxgroup",Ext.form.CheckboxGroup);Ext.form.Radio=Ext.extend(Ext.form.Checkbox,{inputType:"radio",markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,getGroupValue:function(){var p=this.el.up("form")||Ext.getBody();var c=p.child("input[name="+this.el.dom.name+"]:checked",true);return c?c.value:null},onClick:function(){if(this.el.dom.checked!=this.checked){var els=this.getCheckEl().select("input[name="+this.el.dom.name+"]");els.each(function(el){if(el.dom.id==this.id){this.setValue(true)}else{Ext.getCmp(el.dom.id).setValue(false)}},this)}},setValue:function(v){if(typeof v=="boolean"){Ext.form.Radio.superclass.setValue.call(this,v)}else{var r=this.getCheckEl().child("input[name="+this.el.dom.name+"][value="+v+"]",true);if(r){Ext.getCmp(r.id).setValue(true)}}return this},getCheckEl:function(){if(this.inGroup){return this.el.up(".x-form-radio-group")}return this.el.up("form")||Ext.getBody()}});Ext.reg("radio",Ext.form.Radio);Ext.form.RadioGroup=Ext.extend(Ext.form.CheckboxGroup,{allowBlank:true,blankText:"You must select one item in this group",defaultType:"radio",groupCls:"x-form-radio-group",getValue:function(){var out=null;this.eachItem(function(item){if(item.checked){out=item;return false}});return out},onSetValue:function(id,value){if(arguments.length>1){var f=this.getBox(id);if(f){f.setValue(value);if(f.checked){this.eachItem(function(item){if(item!==f){item.setValue(false)}})}}}else{this.setValueForItem(id)}},setValueForItem:function(val){val=String(val).split(",")[0];this.eachItem(function(item){item.setValue(val==item.inputValue)})},fireChecked:function(){if(!this.checkTask){this.checkTask=new Ext.util.DelayedTask(this.bufferChecked,this)}this.checkTask.delay(10)},bufferChecked:function(){var out=null;this.eachItem(function(item){if(item.checked){out=item;return false}});this.fireEvent("change",this,out)},onDestroy:function(){if(this.checkTask){this.checkTask.cancel();this.checkTask=null}Ext.form.RadioGroup.superclass.onDestroy.call(this)}});Ext.reg("radiogroup",Ext.form.RadioGroup);Ext.form.Hidden=Ext.extend(Ext.form.Field,{inputType:"hidden",onRender:function(){Ext.form.Hidden.superclass.onRender.apply(this,arguments)},initEvents:function(){this.originalValue=this.getValue()},setSize:Ext.emptyFn,setWidth:Ext.emptyFn,setHeight:Ext.emptyFn,setPosition:Ext.emptyFn,setPagePosition:Ext.emptyFn,markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn});Ext.reg("hidden",Ext.form.Hidden);Ext.form.BasicForm=function(el,config){Ext.apply(this,config);if(Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/)}this.items=new Ext.util.MixedCollection(false,function(o){return o.getItemId()});this.addEvents("beforeaction","actionfailed","actioncomplete");if(el){this.initEl(el)}Ext.form.BasicForm.superclass.constructor.call(this)};Ext.extend(Ext.form.BasicForm,Ext.util.Observable,{timeout:30,paramOrder:undefined,paramsAsHash:false,waitTitle:"Please Wait...",activeAction:null,trackResetOnLoad:false,initEl:function(el){this.el=Ext.get(el);this.id=this.el.id||Ext.id();if(!this.standardSubmit){this.el.on("submit",this.onSubmit,this)}this.el.addClass("x-form")},getEl:function(){return this.el},onSubmit:function(e){e.stopEvent()},destroy:function(){this.items.each(function(f){Ext.destroy(f)});if(this.el){this.el.removeAllListeners();this.el.remove()}this.purgeListeners()},isValid:function(){var valid=true;this.items.each(function(f){if(!f.validate()){valid=false}});return valid},isDirty:function(){var dirty=false;this.items.each(function(f){if(f.isDirty()){dirty=true;return false}});return dirty},doAction:function(action,options){if(Ext.isString(action)){action=new Ext.form.Action.ACTION_TYPES[action](this,options)}if(this.fireEvent("beforeaction",this,action)!==false){this.beforeAction(action);action.run.defer(100,action)}return this},submit:function(options){if(this.standardSubmit){var v=this.isValid();if(v){var el=this.el.dom;if(this.url&&Ext.isEmpty(el.action)){el.action=this.url}el.submit()}return v}var submitAction=String.format("{0}submit",this.api?"direct":"");this.doAction(submitAction,options);return this},load:function(options){var loadAction=String.format("{0}load",this.api?"direct":"");this.doAction(loadAction,options);return this},updateRecord:function(record){record.beginEdit();var fs=record.fields;fs.each(function(f){var field=this.findField(f.name);if(field){record.set(f.name,field.getValue())}},this);record.endEdit();return this},loadRecord:function(record){this.setValues(record.data);return this},beforeAction:function(action){var o=action.options;if(o.waitMsg){if(this.waitMsgTarget===true){this.el.mask(o.waitMsg,"x-mask-loading")}else{if(this.waitMsgTarget){this.waitMsgTarget=Ext.get(this.waitMsgTarget);this.waitMsgTarget.mask(o.waitMsg,"x-mask-loading")}else{Ext.MessageBox.wait(o.waitMsg,o.waitTitle||this.waitTitle)}}}},afterAction:function(action,success){this.activeAction=null;var o=action.options;if(o.waitMsg){if(this.waitMsgTarget===true){this.el.unmask()}else{if(this.waitMsgTarget){this.waitMsgTarget.unmask()}else{Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide()}}}if(success){if(o.reset){this.reset()}Ext.callback(o.success,o.scope,[this,action]);this.fireEvent("actioncomplete",this,action)}else{Ext.callback(o.failure,o.scope,[this,action]);this.fireEvent("actionfailed",this,action)}},findField:function(id){var field=this.items.get(id);if(!Ext.isObject(field)){this.items.each(function(f){if(f.isFormField&&(f.dataIndex==id||f.id==id||f.getName()==id)){field=f;return false}})}return field||null},markInvalid:function(errors){if(Ext.isArray(errors)){for(var i=0,len=errors.length;i<len;i++){var fieldError=errors[i];var f=this.findField(fieldError.id);if(f){f.markInvalid(fieldError.msg)}}}else{var field,id;for(id in errors){if(!Ext.isFunction(errors[id])&&(field=this.findField(id))){field.markInvalid(errors[id])}}}return this},setValues:function(values){if(Ext.isArray(values)){for(var i=0,len=values.length;i<len;i++){var v=values[i];var f=this.findField(v.id);if(f){f.setValue(v.value);if(this.trackResetOnLoad){f.originalValue=f.getValue()}}}}else{var field,id;for(id in values){if(!Ext.isFunction(values[id])&&(field=this.findField(id))){field.setValue(values[id]);if(this.trackResetOnLoad){field.originalValue=field.getValue()}}}}return this},getValues:function(asString){var fs=Ext.lib.Ajax.serializeForm(this.el.dom);if(asString===true){return fs}return Ext.urlDecode(fs)},getFieldValues:function(){var o={};this.items.each(function(f){o[f.getName()]=f.getValue()});return o},clearInvalid:function(){this.items.each(function(f){f.clearInvalid()});return this},reset:function(){this.items.each(function(f){f.reset()});return this},add:function(){this.items.addAll(Array.prototype.slice.call(arguments,0));return this},remove:function(field){this.items.remove(field);return this},render:function(){this.items.each(function(f){if(f.isFormField&&!f.rendered&&document.getElementById(f.id)){f.applyToMarkup(f.id)}});return this},applyToFields:function(o){this.items.each(function(f){Ext.apply(f,o)});return this},applyIfToFields:function(o){this.items.each(function(f){Ext.applyIf(f,o)});return this},callFieldMethod:function(fnName,args){args=args||[];this.items.each(function(f){if(Ext.isFunction(f[fnName])){f[fnName].apply(f,args)}});return this}});Ext.BasicForm=Ext.form.BasicForm;Ext.FormPanel=Ext.extend(Ext.Panel,{minButtonWidth:75,labelAlign:"left",monitorValid:false,monitorPoll:200,layout:"form",initComponent:function(){this.form=this.createForm();Ext.FormPanel.superclass.initComponent.call(this);this.bodyCfg={tag:"form",cls:this.baseCls+"-body",method:this.method||"POST",id:this.formId||Ext.id()};if(this.fileUpload){this.bodyCfg.enctype="multipart/form-data"}this.initItems();this.addEvents("clientvalidation");this.relayEvents(this.form,["beforeaction","actionfailed","actioncomplete"])},createForm:function(){var config=Ext.applyIf({listeners:{}},this.initialConfig);return new Ext.form.BasicForm(null,config)},initFields:function(){var f=this.form;var formPanel=this;var fn=function(c){if(formPanel.isField(c)){f.add(c)}else{if(c.findBy&&c!=formPanel){formPanel.applySettings(c);if(c.items&&c.items.each){c.items.each(fn,this)}}}};this.items.each(fn,this)},applySettings:function(c){var ct=c.ownerCt;Ext.applyIf(c,{labelAlign:ct.labelAlign,labelWidth:ct.labelWidth,itemCls:ct.itemCls})},getLayoutTarget:function(){return this.form.el},getForm:function(){return this.form},onRender:function(ct,position){this.initFields();Ext.FormPanel.superclass.onRender.call(this,ct,position);this.form.initEl(this.body)},beforeDestroy:function(){this.stopMonitoring();Ext.FormPanel.superclass.beforeDestroy.call(this);this.form.items.clear();Ext.destroy(this.form)},isField:function(c){return !!c.setValue&&!!c.getValue&&!!c.markInvalid&&!!c.clearInvalid},initEvents:function(){Ext.FormPanel.superclass.initEvents.call(this);this.on({scope:this,add:this.onAddEvent,remove:this.onRemoveEvent});if(this.monitorValid){this.startMonitoring()}},onAdd:function(c){Ext.FormPanel.superclass.onAdd.call(this,c);this.processAdd(c)},onAddEvent:function(ct,c){if(ct!==this){this.processAdd(c)}},processAdd:function(c){if(this.isField(c)){this.form.add(c)}else{if(c.findBy){this.applySettings(c);this.form.add.apply(this.form,c.findBy(this.isField))}}},onRemove:function(c){Ext.FormPanel.superclass.onRemove.call(this,c);this.processRemove(c)},onRemoveEvent:function(ct,c){if(ct!==this){this.processRemove(c)}},processRemove:function(c){if(this.isField(c)){this.form.remove(c)}else{if(c.findBy){Ext.each(c.findBy(this.isField),this.form.remove,this.form)}}},startMonitoring:function(){if(!this.validTask){this.validTask=new Ext.util.TaskRunner();this.validTask.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){if(this.validTask){this.validTask.stopAll();this.validTask=null}},load:function(){this.form.load.apply(this.form,arguments)},onDisable:function(){Ext.FormPanel.superclass.onDisable.call(this);if(this.form){this.form.items.each(function(){this.disable()})}},onEnable:function(){Ext.FormPanel.superclass.onEnable.call(this);if(this.form){this.form.items.each(function(){this.enable()})}},bindHandler:function(){var valid=true;this.form.items.each(function(f){if(!f.isValid(true)){valid=false;return false}});if(this.fbar){var fitems=this.fbar.items.items;for(var i=0,len=fitems.length;i<len;i++){var btn=fitems[i];if(btn.formBind===true&&btn.disabled===valid){btn.setDisabled(!valid)}}}this.fireEvent("clientvalidation",this,valid)}});Ext.reg("form",Ext.FormPanel);Ext.form.FormPanel=Ext.FormPanel;Ext.form.FieldSet=Ext.extend(Ext.Panel,{baseCls:"x-fieldset",layout:"form",animCollapse:false,onRender:function(ct,position){if(!this.el){this.el=document.createElement("fieldset");this.el.id=this.id;if(this.title||this.header||this.checkboxToggle){this.el.appendChild(document.createElement("legend")).className="x-fieldset-header"}}Ext.form.FieldSet.superclass.onRender.call(this,ct,position);if(this.checkboxToggle){var o=typeof this.checkboxToggle=="object"?this.checkboxToggle:{tag:"input",type:"checkbox",name:this.checkboxName||this.id+"-checkbox"};this.checkbox=this.header.insertFirst(o);this.checkbox.dom.checked=!this.collapsed;this.mon(this.checkbox,"click",this.onCheckClick,this)}},onCollapse:function(doAnim,animArg){if(this.checkbox){this.checkbox.dom.checked=false}Ext.form.FieldSet.superclass.onCollapse.call(this,doAnim,animArg)},onExpand:function(doAnim,animArg){if(this.checkbox){this.checkbox.dom.checked=true}Ext.form.FieldSet.superclass.onExpand.call(this,doAnim,animArg)},onCheckClick:function(){this[this.checkbox.dom.checked?"expand":"collapse"]()}});Ext.reg("fieldset",Ext.form.FieldSet);Ext.form.HtmlEditor=Ext.extend(Ext.form.Field,{enableFormat:true,enableFontSize:true,enableColors:true,enableAlignments:true,enableLists:true,enableSourceEdit:true,enableLinks:true,enableFont:true,createLinkText:"Please enter the URL for the link:",defaultLinkValue:"http://",fontFamilies:["Arial","Courier New","Tahoma","Times New Roman","Verdana"],defaultFont:"tahoma",defaultValue:(Ext.isOpera||Ext.isIE6)?"&#160;":"&#8203;",actionMode:"wrap",validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:Ext.emptyFn,iframePad:3,hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},initComponent:function(){this.addEvents("initialize","activate","beforesync","beforepush","sync","push","editmodechange")},createFontOptions:function(){var buf=[],fs=this.fontFamilies,ff,lc;for(var i=0,len=fs.length;i<len;i++){ff=fs[i];lc=ff.toLowerCase();buf.push('<option value="',lc,'" style="font-family:',ff,';"',(this.defaultFont==lc?' selected="true">':">"),ff,"</option>")}return buf.join("")},createToolbar:function(editor){var tipsEnabled=Ext.QuickTips&&Ext.QuickTips.isEnabled();function btn(id,toggle,handler){return{itemId:id,cls:"x-btn-icon",iconCls:"x-edit-"+id,enableToggle:toggle!==false,scope:editor,handler:handler||editor.relayBtnCmd,clickEvent:"mousedown",tooltip:tipsEnabled?editor.buttonTips[id]||undefined:undefined,overflowText:editor.buttonTips[id].title||undefined,tabIndex:-1}}var tb=new Ext.Toolbar({renderTo:this.wrap.dom.firstChild});this.mon(tb.el,"click",function(e){e.preventDefault()});if(this.enableFont&&!Ext.isSafari2){this.fontSelect=tb.el.createChild({tag:"select",cls:"x-font-select",html:this.createFontOptions()});this.mon(this.fontSelect,"change",function(){var font=this.fontSelect.dom.value;this.relayCmd("fontname",font);this.deferFocus()},this);tb.add(this.fontSelect.dom,"-")}if(this.enableFormat){tb.add(btn("bold"),btn("italic"),btn("underline"))}if(this.enableFontSize){tb.add("-",btn("increasefontsize",false,this.adjustFont),btn("decreasefontsize",false,this.adjustFont))}if(this.enableColors){tb.add("-",{itemId:"forecolor",cls:"x-btn-icon",iconCls:"x-edit-forecolor",clickEvent:"mousedown",tooltip:tipsEnabled?editor.buttonTips.forecolor||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({allowReselect:true,focus:Ext.emptyFn,value:"000000",plain:true,listeners:{scope:this,select:function(cp,color){this.execCmd("forecolor",Ext.isWebKit||Ext.isIE?"#"+color:color);this.deferFocus()}},clickEvent:"mousedown"})},{itemId:"backcolor",cls:"x-btn-icon",iconCls:"x-edit-backcolor",clickEvent:"mousedown",tooltip:tipsEnabled?editor.buttonTips.backcolor||undefined:undefined,tabIndex:-1,menu:new Ext.menu.ColorMenu({focus:Ext.emptyFn,value:"FFFFFF",plain:true,allowReselect:true,listeners:{scope:this,select:function(cp,color){if(Ext.isGecko){this.execCmd("useCSS",false);this.execCmd("hilitecolor",color);this.execCmd("useCSS",true);this.deferFocus()}else{this.execCmd(Ext.isOpera?"hilitecolor":"backcolor",Ext.isWebKit||Ext.isIE?"#"+color:color);this.deferFocus()}}},clickEvent:"mousedown"})})}if(this.enableAlignments){tb.add("-",btn("justifyleft"),btn("justifycenter"),btn("justifyright"))}if(!Ext.isSafari2){if(this.enableLinks){tb.add("-",btn("createlink",false,this.createLink))}if(this.enableLists){tb.add("-",btn("insertorderedlist"),btn("insertunorderedlist"))}if(this.enableSourceEdit){tb.add("-",btn("sourceedit",true,function(btn){this.toggleSourceEdit(!this.sourceEditMode)}))}}this.tb=tb},getDocMarkup:function(){return'<html><head><style type="text/css">body{border:0;margin:0;padding:3px;height:98%;cursor:text;}</style></head><body></body></html>'},getEditorBody:function(){return this.doc.body||this.doc.documentElement},getDoc:function(){return Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)},getWin:function(){return Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]},onRender:function(ct,position){Ext.form.HtmlEditor.superclass.onRender.call(this,ct,position);this.el.dom.style.border="0 none";this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");if(Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",cn:{cls:"x-html-editor-tb"}});this.createToolbar(this);this.disableItems(true);this.createIFrame();if(!this.width){var sz=this.el.getSize();this.setSize(sz.width,this.height||sz.height)}this.resizeEl=this.positionEl=this.wrap},createIFrame:function(){var iframe=document.createElement("iframe");iframe.name=Ext.id();iframe.frameBorder="0";iframe.src=Ext.SSL_SECURE_URL;this.wrap.dom.appendChild(iframe);this.iframe=iframe;this.monitorTask=Ext.TaskMgr.start({run:this.checkDesignMode,scope:this,interval:100})},initFrame:function(){Ext.TaskMgr.stop(this.monitorTask);this.doc=this.getDoc();this.win=this.getWin();this.doc.open();this.doc.write(this.getDocMarkup());this.doc.close();var task={run:function(){if(this.doc.body||this.doc.readyState=="complete"){Ext.TaskMgr.stop(task);this.doc.designMode="on";this.initEditor.defer(10,this)}},interval:10,duration:10000,scope:this};Ext.TaskMgr.start(task)},checkDesignMode:function(){if(this.wrap&&this.wrap.dom.offsetWidth){var doc=this.getDoc();if(!doc){return}if(!doc.editorInitialized||String(doc.designMode).toLowerCase()!="on"){this.initFrame()}}},disableItems:function(disabled){if(this.fontSelect){this.fontSelect.dom.disabled=disabled}this.tb.items.each(function(item){if(item.getItemId()!="sourceedit"){item.setDisabled(disabled)}})},onResize:function(w,h){Ext.form.HtmlEditor.superclass.onResize.apply(this,arguments);if(this.el&&this.iframe){if(Ext.isNumber(w)){var aw=w-this.wrap.getFrameWidth("lr");this.el.setWidth(aw);this.tb.setWidth(aw);this.iframe.style.width=Math.max(aw,0)+"px"}if(Ext.isNumber(h)){var ah=h-this.wrap.getFrameWidth("tb")-this.tb.el.getHeight();this.el.setHeight(ah);this.iframe.style.height=Math.max(ah,0)+"px";if(this.doc){this.getEditorBody().style.height=Math.max((ah-(this.iframePad*2)),0)+"px"}}}},toggleSourceEdit:function(sourceEditMode){if(sourceEditMode===undefined){sourceEditMode=!this.sourceEditMode}this.sourceEditMode=sourceEditMode===true;var btn=this.tb.items.get("sourceedit");if(btn.pressed!==this.sourceEditMode){btn.toggle(this.sourceEditMode);if(!btn.xtbHidden){return}}if(this.sourceEditMode){this.disableItems(true);this.syncValue();this.iframe.className="x-hidden";this.el.removeClass("x-hidden");this.el.dom.removeAttribute("tabIndex");this.el.focus()}else{if(this.initialized){this.disableItems(false)}this.pushValue();this.iframe.className="";this.el.addClass("x-hidden");this.el.dom.setAttribute("tabIndex",-1);this.deferFocus()}var lastSize=this.lastSize;if(lastSize){delete this.lastSize;this.setSize(lastSize)}this.fireEvent("editmodechange",this,this.sourceEditMode)},createLink:function(){var url=prompt(this.createLinkText,this.defaultLinkValue);if(url&&url!="http://"){this.relayCmd("createlink",url)}},initEvents:function(){this.originalValue=this.getValue()},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,setValue:function(v){Ext.form.HtmlEditor.superclass.setValue.call(this,v);this.pushValue();return this},cleanHtml:function(html){html=String(html);if(Ext.isWebKit){html=html.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,"")}if(html.charCodeAt(0)==this.defaultValue.replace(/\D/g,"")){html=html.substring(1)}return html},syncValue:function(){if(this.initialized){var bd=this.getEditorBody();var html=bd.innerHTML;if(Ext.isWebKit){var bs=bd.getAttribute("style");var m=bs.match(/text-align:(.*?);/i);if(m&&m[1]){html='<div style="'+m[0]+'">'+html+"</div>"}}html=this.cleanHtml(html);if(this.fireEvent("beforesync",this,html)!==false){this.el.dom.value=html;this.fireEvent("sync",this,html)}}},getValue:function(){this[this.sourceEditMode?"pushValue":"syncValue"]();return Ext.form.HtmlEditor.superclass.getValue.call(this)},pushValue:function(){if(this.initialized){var v=this.el.dom.value;if(!this.activated&&v.length<1){v=this.defaultValue}if(this.fireEvent("beforepush",this,v)!==false){this.getEditorBody().innerHTML=v;if(Ext.isGecko){var d=this.doc,mode=d.designMode.toLowerCase();d.designMode=mode.toggle("on","off");d.designMode=mode}this.fireEvent("push",this,v)}}},deferFocus:function(){this.focus.defer(10,this)},focus:function(){if(this.win&&!this.sourceEditMode){this.win.focus()}else{this.el.focus()}},initEditor:function(){try{var dbody=this.getEditorBody();var ss=this.el.getStyles("font-size","font-family","background-image","background-repeat");ss["background-attachment"]="fixed";dbody.bgProperties="fixed";Ext.DomHelper.applyStyles(dbody,ss);if(this.doc){try{Ext.EventManager.removeAll(this.doc)}catch(e){}}this.doc=this.getDoc();Ext.EventManager.on(this.doc,{mousedown:this.onEditorEvent,dblclick:this.onEditorEvent,click:this.onEditorEvent,keyup:this.onEditorEvent,buffer:100,scope:this});if(Ext.isGecko){Ext.EventManager.on(this.doc,"keypress",this.applyCommand,this)}if(Ext.isIE||Ext.isWebKit||Ext.isOpera){Ext.EventManager.on(this.doc,"keydown",this.fixKeys,this)}this.initialized=true;this.fireEvent("initialize",this);this.doc.editorInitialized=true;this.pushValue()}catch(e){}},onDestroy:function(){if(this.monitorTask){Ext.TaskMgr.stop(this.monitorTask)}if(this.rendered){Ext.destroy(this.tb);if(this.wrap){this.wrap.dom.innerHTML="";this.wrap.remove()}}if(this.el){this.el.removeAllListeners();this.el.remove()}if(this.doc){try{Ext.EventManager.removeAll(this.doc);for(var prop in this.doc){delete this.doc[prop]}}catch(e){}}this.purgeListeners()},onFirstFocus:function(){this.activated=true;this.disableItems(false);if(Ext.isGecko){this.win.focus();var s=this.win.getSelection();if(!s.focusNode||s.focusNode.nodeType!=3){var r=s.getRangeAt(0);r.selectNodeContents(this.getEditorBody());r.collapse(true);this.deferFocus()}try{this.execCmd("useCSS",true);this.execCmd("styleWithCSS",false)}catch(e){}}this.fireEvent("activate",this)},adjustFont:function(btn){var adjust=btn.getItemId()=="increasefontsize"?1:-1;var v=parseInt(this.doc.queryCommandValue("FontSize")||2,10);if((Ext.isSafari&&!Ext.isSafari2)||Ext.isChrome||Ext.isAir){if(v<=10){v=1+adjust}else{if(v<=13){v=2+adjust}else{if(v<=16){v=3+adjust}else{if(v<=18){v=4+adjust}else{if(v<=24){v=5+adjust}else{v=6+adjust}}}}}v=v.constrain(1,6)}else{if(Ext.isSafari){adjust*=2}v=Math.max(1,v+adjust)+(Ext.isSafari?"px":0)}this.execCmd("FontSize",v)},onEditorEvent:function(e){this.updateToolbar()},updateToolbar:function(){if(!this.activated){this.onFirstFocus();return}var btns=this.tb.items.map,doc=this.doc;if(this.enableFont&&!Ext.isSafari2){var name=(this.doc.queryCommandValue("FontName")||this.defaultFont).toLowerCase();if(name!=this.fontSelect.dom.value){this.fontSelect.dom.value=name}}if(this.enableFormat){btns.bold.toggle(doc.queryCommandState("bold"));btns.italic.toggle(doc.queryCommandState("italic"));btns.underline.toggle(doc.queryCommandState("underline"))}if(this.enableAlignments){btns.justifyleft.toggle(doc.queryCommandState("justifyleft"));btns.justifycenter.toggle(doc.queryCommandState("justifycenter"));btns.justifyright.toggle(doc.queryCommandState("justifyright"))}if(!Ext.isSafari2&&this.enableLists){btns.insertorderedlist.toggle(doc.queryCommandState("insertorderedlist"));btns.insertunorderedlist.toggle(doc.queryCommandState("insertunorderedlist"))}Ext.menu.MenuMgr.hideAll();this.syncValue()},relayBtnCmd:function(btn){this.relayCmd(btn.getItemId())},relayCmd:function(cmd,value){(function(){this.focus();this.execCmd(cmd,value);this.updateToolbar()}).defer(10,this)},execCmd:function(cmd,value){this.doc.execCommand(cmd,false,value===undefined?null:value);this.syncValue()},applyCommand:function(e){if(e.ctrlKey){var c=e.getCharCode(),cmd;if(c>0){c=String.fromCharCode(c);switch(c){case"b":cmd="bold";break;case"i":cmd="italic";break;case"u":cmd="underline";break}if(cmd){this.win.focus();this.execCmd(cmd);this.deferFocus();e.preventDefault()}}}},insertAtCursor:function(text){if(!this.activated){return}if(Ext.isIE){this.win.focus();var r=this.doc.selection.createRange();if(r){r.collapse(true);r.pasteHTML(text);this.syncValue();this.deferFocus()}}else{this.win.focus();this.execCmd("InsertHTML",text);this.deferFocus()}},fixKeys:function(){if(Ext.isIE){return function(e){var k=e.getKey(),r;if(k==e.TAB){e.stopEvent();r=this.doc.selection.createRange();if(r){r.collapse(true);r.pasteHTML("&nbsp;&nbsp;&nbsp;&nbsp;");this.deferFocus()}}else{if(k==e.ENTER){r=this.doc.selection.createRange();if(r){var target=r.parentElement();if(!target||target.tagName.toLowerCase()!="li"){e.stopEvent();r.pasteHTML("<br />");r.collapse(false);r.select()}}}}}}else{if(Ext.isOpera){return function(e){var k=e.getKey();if(k==e.TAB){e.stopEvent();this.win.focus();this.execCmd("InsertHTML","&nbsp;&nbsp;&nbsp;&nbsp;");this.deferFocus()}}}else{if(Ext.isWebKit){return function(e){var k=e.getKey();if(k==e.TAB){e.stopEvent();this.execCmd("InsertText","\t");this.deferFocus()}else{if(k==e.ENTER){e.stopEvent();this.execCmd("InsertHtml","<br /><br />");this.deferFocus()}}}}}}}(),getToolbar:function(){return this.tb},buttonTips:{bold:{title:"Bold (Ctrl+B)",text:"Make the selected text bold.",cls:"x-html-editor-tip"},italic:{title:"Italic (Ctrl+I)",text:"Make the selected text italic.",cls:"x-html-editor-tip"},underline:{title:"Underline (Ctrl+U)",text:"Underline the selected text.",cls:"x-html-editor-tip"},increasefontsize:{title:"Grow Text",text:"Increase the font size.",cls:"x-html-editor-tip"},decreasefontsize:{title:"Shrink Text",text:"Decrease the font size.",cls:"x-html-editor-tip"},backcolor:{title:"Text Highlight Color",text:"Change the background color of the selected text.",cls:"x-html-editor-tip"},forecolor:{title:"Font Color",text:"Change the color of the selected text.",cls:"x-html-editor-tip"},justifyleft:{title:"Align Text Left",text:"Align text to the left.",cls:"x-html-editor-tip"},justifycenter:{title:"Center Text",text:"Center text in the editor.",cls:"x-html-editor-tip"},justifyright:{title:"Align Text Right",text:"Align text to the right.",cls:"x-html-editor-tip"},insertunorderedlist:{title:"Bullet List",text:"Start a bulleted list.",cls:"x-html-editor-tip"},insertorderedlist:{title:"Numbered List",text:"Start a numbered list.",cls:"x-html-editor-tip"},createlink:{title:"Hyperlink",text:"Make the selected text a hyperlink.",cls:"x-html-editor-tip"},sourceedit:{title:"Source Edit",text:"Switch to source editing mode.",cls:"x-html-editor-tip"}}});Ext.reg("htmleditor",Ext.form.HtmlEditor);Ext.form.TimeField=Ext.extend(Ext.form.ComboBox,{minValue:null,maxValue:null,minText:"The time in this field must be equal to or after {0}",maxText:"The time in this field must be equal to or before {0}",invalidText:"{0} is not a valid time",format:"g:i A",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H",increment:15,mode:"local",triggerAction:"all",typeAhead:false,initDate:"1/1/2008",initComponent:function(){if(typeof this.minValue=="string"){this.minValue=this.parseDate(this.minValue)}if(typeof this.maxValue=="string"){this.maxValue=this.parseDate(this.maxValue)}if(!this.store){var min=this.parseDate(this.minValue)||new Date(this.initDate).clearTime();var max=this.parseDate(this.maxValue)||new Date(this.initDate).clearTime().add("mi",(24*60)-1);var times=[];while(min<=max){times.push(min.dateFormat(this.format));min=min.add("mi",this.increment)}this.store=times}Ext.form.TimeField.superclass.initComponent.call(this)},getValue:function(){var v=Ext.form.TimeField.superclass.getValue.call(this);return this.formatDate(this.parseDate(v))||""},setValue:function(value){return Ext.form.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(value)))},validateValue:Ext.form.DateField.prototype.validateValue,parseDate:Ext.form.DateField.prototype.parseDate,formatDate:Ext.form.DateField.prototype.formatDate,beforeBlur:function(){var v=this.parseDate(this.getRawValue());if(v){this.setValue(v.dateFormat(this.format))}Ext.form.TimeField.superclass.beforeBlur.call(this)}});Ext.reg("timefield",Ext.form.TimeField);Ext.form.Label=Ext.extend(Ext.BoxComponent,{onRender:function(ct,position){if(!this.el){this.el=document.createElement("label");this.el.id=this.getId();this.el.innerHTML=this.text?Ext.util.Format.htmlEncode(this.text):(this.html||"");if(this.forId){this.el.setAttribute("for",this.forId)}}Ext.form.Label.superclass.onRender.call(this,ct,position)},setText:function(t,encode){var e=encode===false;this[!e?"text":"html"]=t;delete this[e?"text":"html"];if(this.rendered){this.el.dom.innerHTML=encode!==false?Ext.util.Format.htmlEncode(t):t}return this}});Ext.reg("label",Ext.form.Label);Ext.form.Action=function(form,options){this.form=form;this.options=options||{}};Ext.form.Action.CLIENT_INVALID="client";Ext.form.Action.SERVER_INVALID="server";Ext.form.Action.CONNECT_FAILURE="connect";Ext.form.Action.LOAD_FAILURE="load";Ext.form.Action.prototype={type:"default",run:function(options){},success:function(response){},handleResponse:function(response){},failure:function(response){this.response=response;this.failureType=Ext.form.Action.CONNECT_FAILURE;this.form.afterAction(this,false)},processResponse:function(response){this.response=response;if(!response.responseText&&!response.responseXML){return true}this.result=this.handleResponse(response);return this.result},getUrl:function(appendParams){var url=this.options.url||this.form.url||this.form.el.dom.action;if(appendParams){var p=this.getParams();if(p){url=Ext.urlAppend(url,p)}}return url},getMethod:function(){return(this.options.method||this.form.method||this.form.el.dom.method||"POST").toUpperCase()},getParams:function(){var bp=this.form.baseParams;var p=this.options.params;if(p){if(typeof p=="object"){p=Ext.urlEncode(Ext.applyIf(p,bp))}else{if(typeof p=="string"&&bp){p+="&"+Ext.urlEncode(bp)}}}else{if(bp){p=Ext.urlEncode(bp)}}return p},createCallback:function(opts){var opts=opts||{};return{success:this.success,failure:this.failure,scope:this,timeout:(opts.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined}}};Ext.form.Action.Submit=function(form,options){Ext.form.Action.Submit.superclass.constructor.call(this,form,options)};Ext.extend(Ext.form.Action.Submit,Ext.form.Action,{type:"submit",run:function(){var o=this.options;var method=this.getMethod();var isGet=method=="GET";if(o.clientValidation===false||this.form.isValid()){Ext.Ajax.request(Ext.apply(this.createCallback(o),{form:this.form.el.dom,url:this.getUrl(isGet),method:method,headers:o.headers,params:!isGet?this.getParams():null,isUpload:this.form.fileUpload}))}else{if(o.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},success:function(response){var result=this.processResponse(response);if(result===true||result.success){this.form.afterAction(this,true);return}if(result.errors){this.form.markInvalid(result.errors)}this.failureType=Ext.form.Action.SERVER_INVALID;this.form.afterAction(this,false)},handleResponse:function(response){if(this.form.errorReader){var rs=this.form.errorReader.read(response);var errors=[];if(rs.records){for(var i=0,len=rs.records.length;i<len;i++){var r=rs.records[i];errors[i]=r.data}}if(errors.length<1){errors=null}return{success:rs.success,errors:errors}}return Ext.decode(response.responseText)}});Ext.form.Action.Load=function(form,options){Ext.form.Action.Load.superclass.constructor.call(this,form,options);this.reader=this.form.reader};Ext.extend(Ext.form.Action.Load,Ext.form.Action,{type:"load",run:function(){Ext.Ajax.request(Ext.apply(this.createCallback(this.options),{method:this.getMethod(),url:this.getUrl(false),headers:this.options.headers,params:this.getParams()}))},success:function(response){var result=this.processResponse(response);if(result===true||!result.success||!result.data){this.failureType=Ext.form.Action.LOAD_FAILURE;this.form.afterAction(this,false);return}this.form.clearInvalid();this.form.setValues(result.data);this.form.afterAction(this,true)},handleResponse:function(response){if(this.form.reader){var rs=this.form.reader.read(response);var data=rs.records&&rs.records[0]?rs.records[0].data:null;return{success:rs.success,data:data}}return Ext.decode(response.responseText)}});Ext.form.Action.DirectLoad=Ext.extend(Ext.form.Action.Load,{constructor:function(form,opts){Ext.form.Action.DirectLoad.superclass.constructor.call(this,form,opts)},type:"directload",run:function(){var args=this.getParams();args.push(this.success,this);this.form.api.load.apply(window,args)},getParams:function(){var buf=[],o={};var bp=this.form.baseParams;var p=this.options.params;Ext.apply(o,p,bp);var paramOrder=this.form.paramOrder;if(paramOrder){for(var i=0,len=paramOrder.length;i<len;i++){buf.push(o[paramOrder[i]])}}else{if(this.form.paramsAsHash){buf.push(o)}}return buf},processResponse:function(result){this.result=result;return result},success:function(response,trans){if(trans.type==Ext.Direct.exceptions.SERVER){response={}}Ext.form.Action.DirectLoad.superclass.success.call(this,response)}});Ext.form.Action.DirectSubmit=Ext.extend(Ext.form.Action.Submit,{constructor:function(form,opts){Ext.form.Action.DirectSubmit.superclass.constructor.call(this,form,opts)},type:"directsubmit",run:function(){var o=this.options;if(o.clientValidation===false||this.form.isValid()){this.success.params=this.getParams();this.form.api.submit(this.form.el.dom,this.success,this)}else{if(o.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},getParams:function(){var o={};var bp=this.form.baseParams;var p=this.options.params;Ext.apply(o,p,bp);return o},processResponse:function(result){this.result=result;return result},success:function(response,trans){if(trans.type==Ext.Direct.exceptions.SERVER){response={}}Ext.form.Action.DirectSubmit.superclass.success.call(this,response)}});Ext.form.Action.ACTION_TYPES={load:Ext.form.Action.Load,submit:Ext.form.Action.Submit,directload:Ext.form.Action.DirectLoad,directsubmit:Ext.form.Action.DirectSubmit};Ext.form.VTypes=function(){var alpha=/^[a-zA-Z_]+$/,alphanum=/^[a-zA-Z0-9_]+$/,email=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,4}$/,url=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;return{email:function(v){return email.test(v)},emailText:'This field should be an e-mail address in the format "user@example.com"',emailMask:/[a-z0-9_\.\-@]/i,url:function(v){return url.test(v)},urlText:'This field should be a URL in the format "http://www.example.com"',alpha:function(v){return alpha.test(v)},alphaText:"This field should only contain letters and _",alphaMask:/[a-z_]/i,alphanum:function(v){return alphanum.test(v)},alphanumText:"This field should only contain letters, numbers and _",alphanumMask:/[a-z0-9_]/i}}();Ext.grid.GridPanel=Ext.extend(Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:"{0} selected row{1}",deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:["columnmove","columnresize","sortchange"],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){Ext.grid.GridPanel.superclass.initComponent.call(this);if(this.columnLines){this.cls=(this.cls||"")+" x-grid-with-col-lines"}this.autoScroll=false;this.autoWidth=false;if(Ext.isArray(this.columns)){this.colModel=new Ext.grid.ColumnModel(this.columns);delete this.columns}if(this.ds){this.store=this.ds;delete this.ds}if(this.cm){this.colModel=this.cm;delete this.cm}if(this.sm){this.selModel=this.sm;delete this.sm}this.store=Ext.StoreMgr.lookup(this.store);this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellmousedown","rowmousedown","headermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","bodyscroll","columnresize","columnmove","sortchange","reconfigure")},onRender:function(ct,position){Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);var c=this.getGridEl();this.el.addClass("x-grid-panel");this.mon(c,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});this.relayEvents(c,["mousedown","mouseup","mouseover","mouseout","keypress","keydown"]);var view=this.getView();view.init(this);view.render();this.getSelectionModel().init(this)},initEvents:function(){Ext.grid.GridPanel.superclass.initEvents.call(this);if(this.loadMask){this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask))}},initStateEvents:function(){Ext.grid.GridPanel.superclass.initStateEvents.call(this);this.mon(this.colModel,"hiddenchange",this.saveState,this,{delay:100})},applyState:function(state){var cm=this.colModel,cs=state.columns;if(cs){for(var i=0,len=cs.length;i<len;i++){var s=cs[i];var c=cm.getColumnById(s.id);if(c){c.hidden=s.hidden;c.width=s.width;var oldIndex=cm.getIndexById(s.id);if(oldIndex!=i){cm.moveColumn(oldIndex,i)}}}}if(state.sort&&this.store){this.store[this.store.remoteSort?"setDefaultSort":"sort"](state.sort.field,state.sort.direction)}var o=Ext.apply({},state);delete o.columns;delete o.sort;Ext.grid.GridPanel.superclass.applyState.call(this,o)},getState:function(){var o={columns:[]};for(var i=0,c;(c=this.colModel.config[i]);i++){o.columns[i]={id:c.id,width:c.width};if(c.hidden){o.columns[i].hidden=true}}if(this.store){var ss=this.store.getSortState();if(ss){o.sort=ss}}return o},afterRender:function(){Ext.grid.GridPanel.superclass.afterRender.call(this);var v=this.view;this.on("bodyresize",v.layout,v);v.layout();if(this.deferRowRender){v.afterRender.defer(10,this.view)}else{v.afterRender()}this.viewReady=true},reconfigure:function(store,colModel){if(this.loadMask){this.loadMask.destroy();this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({},{store:store},this.initialConfig.loadMask))}this.view.initData(store,colModel);this.store=store;this.colModel=colModel;if(this.rendered){this.view.refresh(true)}this.fireEvent("reconfigure",this,store,colModel)},onDestroy:function(){if(this.rendered){var c=this.body;c.removeAllListeners();c.update("");Ext.destroy(this.view,this.loadMask)}else{if(this.store&&this.store.autoDestroy){this.store.destroy()}}Ext.destroy(this.colModel,this.selModel);this.store=this.selModel=this.colModel=this.view=this.loadMask=null;Ext.grid.GridPanel.superclass.onDestroy.call(this)},processEvent:function(name,e){this.fireEvent(name,e);var t=e.getTarget();var v=this.view;var header=v.findHeaderIndex(t);if(header!==false){this.fireEvent("header"+name,this,header,e)}else{var row=v.findRowIndex(t);var cell=v.findCellIndex(t);if(row!==false){this.fireEvent("row"+name,this,row,e);if(cell!==false){this.fireEvent("cell"+name,this,row,cell,e)}}}},onClick:function(e){this.processEvent("click",e)},onMouseDown:function(e){this.processEvent("mousedown",e)},onContextMenu:function(e,t){this.processEvent("contextmenu",e)},onDblClick:function(e){this.processEvent("dblclick",e)},walkCells:function(row,col,step,fn,scope){var cm=this.colModel,clen=cm.getColumnCount();var ds=this.store,rlen=ds.getCount(),first=true;if(step<0){if(col<0){row--;first=false}while(row>=0){if(!first){col=clen-1}first=false;while(col>=0){if(fn.call(scope||this,row,col,cm)===true){return[row,col]}col--}row--}}else{if(col>=clen){row++;first=false}while(row<rlen){if(!first){col=0}first=false;while(col<clen){if(fn.call(scope||this,row,col,cm)===true){return[row,col]}col++}row++}}return null},onResize:function(){Ext.grid.GridPanel.superclass.onResize.apply(this,arguments);if(this.viewReady){this.view.layout()}},getGridEl:function(){return this.body},stopEditing:Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:Ext.emptyFn}:null)}return this.selModel},getStore:function(){return this.store},getColumnModel:function(){return this.colModel},getView:function(){if(!this.view){this.view=new Ext.grid.GridView(this.viewConfig)}return this.view},getDragDropText:function(){var count=this.selModel.getCount();return String.format(this.ddText,count,count==1?"":"s")}});Ext.reg("grid",Ext.grid.GridPanel);Ext.grid.GridView=function(config){Ext.apply(this,config);this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");Ext.grid.GridView.superclass.constructor.call(this)};Ext.extend(Ext.grid.GridView,Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",selectedRowClass:"x-grid3-row-selected",borderWidth:2,tdClass:"x-grid3-cell",hdCls:"x-grid3-hd",markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,cellSelector:"td.x-grid3-cell",rowSelector:"div.x-grid3-row",firstRowCls:"x-grid3-row-first",lastRowCls:"x-grid3-row-last",rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,initTemplates:function(){var ts=this.templates||{};if(!ts.master){ts.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")}if(!ts.header){ts.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>',"</table>")}if(!ts.hcell){ts.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div></td>")}if(!ts.body){ts.body=new Ext.Template("{rows}")}if(!ts.row){ts.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>")}if(!ts.cell){ts.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")}for(var k in ts){var t=ts[k];if(t&&typeof t.compile=="function"&&!t.compiled){t.disableFormats=true;t.compile()}}this.templates=ts;this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},fly:function(el){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body)}this._flyweight.dom=el;return this._flyweight},getEditorParent:function(){return this.scroller.dom},initElements:function(){var E=Ext.Element;var el=this.grid.getGridEl().dom.firstChild;var cs=el.childNodes;this.el=new E(el);this.mainWrap=new E(cs[0]);this.mainHd=new E(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.mainHd.setDisplayed(false)}this.innerHd=this.mainHd.dom.firstChild;this.scroller=new E(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")}this.mainBody=new E(this.scroller.dom.firstChild);this.focusEl=new E(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new E(cs[1]);this.resizeProxy=new E(cs[2])},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},findCell:function(el){if(!el){return false}return this.fly(el).findParent(this.cellSelector,this.cellSelectorDepth)},findCellIndex:function(el,requiredCls){var cell=this.findCell(el);if(cell&&(!requiredCls||this.fly(cell).hasClass(requiredCls))){return this.getCellIndex(cell)}return false},getCellIndex:function(el){if(el){var m=el.className.match(this.colRe);if(m&&m[1]){return this.cm.getIndexById(m[1])}}return false},findHeaderCell:function(el){var cell=this.findCell(el);return cell&&this.fly(cell).hasClass(this.hdCls)?cell:null},findHeaderIndex:function(el){return this.findCellIndex(el,this.hdCls)},findRow:function(el){if(!el){return false}return this.fly(el).findParent(this.rowSelector,this.rowSelectorDepth)},findRowIndex:function(el){var r=this.findRow(el);return r?r.rowIndex:false},getRow:function(row){return this.getRows()[row]},getCell:function(row,col){return this.getRow(row).getElementsByTagName("td")[col]},getHeaderCell:function(index){return this.mainHd.dom.getElementsByTagName("td")[index]},addRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).addClass(cls)}},removeRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).removeClass(cls)}},removeRow:function(row){Ext.removeNode(this.getRow(row));this.syncFocusEl(row)},removeRows:function(firstRow,lastRow){var bd=this.mainBody.dom;for(var rowIndex=firstRow;rowIndex<=lastRow;rowIndex++){Ext.removeNode(bd.childNodes[firstRow])}this.syncFocusEl(firstRow)},getScrollState:function(){var sb=this.scroller.dom;return{left:sb.scrollLeft,top:sb.scrollTop}},restoreScroll:function(state){var sb=this.scroller.dom;sb.scrollLeft=state.left;sb.scrollTop=state.top},scrollToTop:function(){this.scroller.dom.scrollTop=0;this.scroller.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var mb=this.scroller.dom;this.grid.fireEvent("bodyscroll",mb.scrollLeft,mb.scrollTop)},syncHeaderScroll:function(){var mb=this.scroller.dom;this.innerHd.scrollLeft=mb.scrollLeft;this.innerHd.scrollLeft=mb.scrollLeft},updateSortIcon:function(col,dir){var sc=this.sortClasses;var hds=this.mainHd.select("td").removeClass(sc);hds.item(col).addClass(sc[dir=="DESC"?1:0])},updateAllColumnWidths:function(){var tw=this.getTotalWidth(),clen=this.cm.getColumnCount(),ws=[],len,i;for(i=0;i<clen;i++){ws[i]=this.getColumnWidth(i)}this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;for(i=0;i<clen;i++){var hd=this.getHeaderCell(i);hd.style.width=ws[i]}var ns=this.getRows(),row,trow;for(i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;trow=row.firstChild.rows[0];for(var j=0;j<clen;j++){trow.childNodes[j].style.width=ws[j]}}}this.onAllColumnWidthsUpdated(ws,tw)},updateColumnWidth:function(col,width){var w=this.getColumnWidth(col);var tw=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;var hd=this.getHeaderCell(col);hd.style.width=w;var ns=this.getRows(),row;for(var i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;row.firstChild.rows[0].childNodes[col].style.width=w}}this.onColumnWidthUpdated(col,w,tw)},updateColumnHidden:function(col,hidden){var tw=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=tw;this.mainBody.dom.style.width=tw;var display=hidden?"none":"";var hd=this.getHeaderCell(col);hd.style.display=display;var ns=this.getRows(),row;for(var i=0,len=ns.length;i<len;i++){row=ns[i];row.style.width=tw;if(row.firstChild){row.firstChild.style.width=tw;row.firstChild.rows[0].childNodes[col].style.display=display}}this.onColumnHiddenUpdated(col,hidden,tw);delete this.lastViewWidth;this.layout()},doRender:function(cs,rs,ds,startRow,colCount,stripe){var ts=this.templates,ct=ts.cell,rt=ts.row,last=colCount-1;var tstyle="width:"+this.getTotalWidth()+";";var buf=[],cb,c,p={},rp={tstyle:tstyle},r;for(var j=0,len=rs.length;j<len;j++){r=rs[j];cb=[];var rowIndex=(j+startRow);for(var i=0;i<colCount;i++){c=cs[i];p.id=c.id;p.css=i===0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");p.attr=p.cellAttr="";p.value=c.renderer(r.data[c.name],p,r,rowIndex,i,ds);p.style=c.style;if(Ext.isEmpty(p.value)){p.value="&#160;"}if(this.markDirty&&r.dirty&&typeof r.modified[c.name]!=="undefined"){p.css+=" x-grid3-dirty-cell"}cb[cb.length]=ct.apply(p)}var alt=[];if(stripe&&((rowIndex+1)%2===0)){alt[0]="x-grid3-row-alt"}if(r.dirty){alt[1]=" x-grid3-dirty-row"}rp.cols=colCount;if(this.getRowClass){alt[2]=this.getRowClass(r,rowIndex,rp,ds)}rp.alt=alt.join(" ");rp.cells=cb.join("");buf[buf.length]=rt.apply(rp)}return buf.join("")},processRows:function(startRow,skipStripe){if(!this.ds||this.ds.getCount()<1){return}var rows=this.getRows();skipStripe=skipStripe||!this.grid.stripeRows;startRow=startRow||0;Ext.each(rows,function(row,idx){row.rowIndex=idx;if(!skipStripe){row.className=row.className.replace(this.rowClsRe," ");if((idx+1)%2===0){row.className+=" x-grid3-row-alt"}}},this);if(startRow===0){Ext.fly(rows[0]).addClass(this.firstRowCls)}Ext.fly(rows[rows.length-1]).addClass(this.lastRowCls)},afterRender:function(){if(!this.ds||!this.cm){return}this.mainBody.dom.innerHTML=this.renderRows()||"&#160;";this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}},renderUI:function(){var header=this.renderHeaders();var body=this.templates.body.apply({rows:"&#160;"});var html=this.templates.master.apply({body:body,header:header,ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"});var g=this.grid;g.getGridEl().dom.innerHTML=html;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(g.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(g,this.mainHd.dom)}if(g.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(g,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(g,this.mainHd.dom)}if(g.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:g.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(g.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:g.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(g.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(g.enableDragDrop||g.enableDrag){this.dragZone=new Ext.grid.GridDragZone(g,{ddGroup:g.ddGroup||"GridDD"})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var g=this.grid;var c=g.getGridEl();var csize=c.getSize(true);var vw=csize.width;if(!g.hideHeaders&&(vw<20||csize.height<20)){return}if(g.autoHeight){this.scroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static"}}else{this.el.setSize(csize.width,csize.height);var hdHeight=this.mainHd.getHeight();var vh=csize.height-(hdHeight);this.scroller.setSize(vw,vh);if(this.innerHd){this.innerHd.style.width=(vw)+"px"}}if(this.forceFit){if(this.lastViewWidth!=vw){this.fitColumns(false,false);this.lastViewWidth=vw}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(vw,vh)},onLayout:function(vw,vh){},onColumnWidthUpdated:function(col,w,tw){},onAllColumnWidthsUpdated:function(ws,tw){},onColumnHiddenUpdated:function(col,hidden,tw){},updateColumnText:function(col,text){},afterMove:function(colIndex){},init:function(grid){this.grid=grid;this.initTemplates();this.initData(grid.store,grid.colModel);this.initUI(grid)},getColumnId:function(index){return this.cm.getColumnId(index)},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+"px"},getScrollOffset:function(){return Ext.num(this.scrollOffset,Ext.getScrollBarWidth())},renderHeaders:function(){var cm=this.cm,ts=this.templates,ct=ts.hcell,cb=[],p={},len=cm.getColumnCount(),last=len-1;for(var i=0;i<len;i++){p.id=cm.getColumnId(i);p.value=cm.getColumnHeader(i)||"";p.style=this.getColumnStyle(i,true);p.tooltip=this.getColumnTooltip(i);p.css=i===0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");if(cm.config[i].align=="right"){p.istyle="padding-right:16px"}else{delete p.istyle}cb[cb.length]=ct.apply(p)}return ts.header.apply({cells:cb.join(""),tstyle:"width:"+this.getTotalWidth()+";"})},getColumnTooltip:function(i){var tt=this.cm.getColumnTooltip(i);if(tt){if(Ext.QuickTips.isEnabled()){return'ext:qtip="'+tt+'"'}else{return'title="'+tt+'"'}}return""},beforeUpdate:function(){this.grid.stopEditing(true)},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth()},focusRow:function(row){this.focusCell(row,0,false)},focusCell:function(row,col,hscroll){this.syncFocusEl(this.ensureVisible(row,col,hscroll));if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},resolveCell:function(row,col,hscroll){if(typeof row!="number"){row=row.rowIndex}if(!this.ds){return null}if(row<0||row>=this.ds.getCount()){return null}col=(col!==undefined?col:0);var rowEl=this.getRow(row),cm=this.cm,colCount=cm.getColumnCount(),cellEl;if(!(hscroll===false&&col===0)){while(col<colCount&&cm.isHidden(col)){col++}cellEl=this.getCell(row,col)}return{row:rowEl,cell:cellEl}},getResolvedXY:function(resolved){if(!resolved){return null}var s=this.scroller.dom,c=resolved.cell,r=resolved.row;return c?Ext.fly(c).getXY():[this.el.getX(),Ext.fly(r).getY()]},syncFocusEl:function(row,col,hscroll){var xy=row;if(!Ext.isArray(xy)){row=Math.min(row,Math.max(0,this.getRows().length-1));xy=this.getResolvedXY(this.resolveCell(row,col,hscroll))}this.focusEl.setXY(xy||this.scroller.getXY())},ensureVisible:function(row,col,hscroll){var resolved=this.resolveCell(row,col,hscroll);if(!resolved||!resolved.row){return}var rowEl=resolved.row,cellEl=resolved.cell,c=this.scroller.dom,ctop=0,p=rowEl,stop=this.el.dom;while(p&&p!=stop){ctop+=p.offsetTop;p=p.offsetParent}ctop-=this.mainHd.dom.offsetHeight;stop=parseInt(c.scrollTop,10);var cbot=ctop+rowEl.offsetHeight,ch=c.clientHeight,sbot=stop+ch;if(ctop<stop){c.scrollTop=ctop}else{if(cbot>sbot){c.scrollTop=cbot-ch}}if(hscroll!==false){var cleft=parseInt(cellEl.offsetLeft,10);var cright=cleft+cellEl.offsetWidth;var sleft=parseInt(c.scrollLeft,10);var sright=sleft+c.clientWidth;if(cleft<sleft){c.scrollLeft=cleft}else{if(cright>sright){c.scrollLeft=cright-c.clientWidth}}}return this.getResolvedXY(resolved)},insertRows:function(dm,firstRow,lastRow,isUpdate){var last=dm.getCount()-1;if(!isUpdate&&firstRow===0&&lastRow>=last){this.refresh()}else{if(!isUpdate){this.fireEvent("beforerowsinserted",this,firstRow,lastRow)}var html=this.renderRows(firstRow,lastRow),before=this.getRow(firstRow);if(before){if(firstRow===0){Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",before,html)}else{var r=this.getRow(last-1);if(r){Ext.fly(r).removeClass(this.lastRowCls)}Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,html)}if(!isUpdate){this.fireEvent("rowsinserted",this,firstRow,lastRow);this.processRows(firstRow)}else{if(firstRow===0||firstRow>=last){Ext.fly(this.getRow(firstRow)).addClass(firstRow===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(firstRow)},deleteRows:function(dm,firstRow,lastRow){if(dm.getRowCount()<1){this.refresh()}else{this.fireEvent("beforerowsdeleted",this,firstRow,lastRow);this.removeRows(firstRow,lastRow);this.processRows(firstRow);this.fireEvent("rowsdeleted",this,firstRow,lastRow)}},getColumnStyle:function(col,isHeader){var style=!isHeader?(this.cm.config[col].css||""):"";style+="width:"+this.getColumnWidth(col)+";";if(this.cm.isHidden(col)){style+="display:none;"}var align=this.cm.config[col].align;if(align){style+="text-align:"+align+";"}return style},getColumnWidth:function(col){var w=this.cm.getColumnWidth(col);if(typeof w=="number"){return(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)?w:(w-this.borderWidth>0?w-this.borderWidth:0))+"px"}return w},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"},fitColumns:function(preventRefresh,onlyExpand,omitColumn){var cm=this.cm,i;var tw=cm.getTotalWidth(false);var aw=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();if(aw<20){return}var extra=aw-tw;if(extra===0){return false}var vc=cm.getColumnCount(true);var ac=vc-(typeof omitColumn=="number"?1:0);if(ac===0){ac=1;omitColumn=undefined}var colCount=cm.getColumnCount();var cols=[];var extraCol=0;var width=0;var w;for(i=0;i<colCount;i++){if(!cm.isHidden(i)&&!cm.isFixed(i)&&i!==omitColumn){w=cm.getColumnWidth(i);cols.push(i);extraCol=i;cols.push(w);width+=w}}var frac=(aw-cm.getTotalWidth())/width;while(cols.length){w=cols.pop();i=cols.pop();cm.setColumnWidth(i,Math.max(this.grid.minColumnWidth,Math.floor(w+w*frac)),true)}if((tw=cm.getTotalWidth(false))>aw){var adjustCol=ac!=vc?omitColumn:extraCol;cm.setColumnWidth(adjustCol,Math.max(1,cm.getColumnWidth(adjustCol)-(tw-aw)),true)}if(preventRefresh!==true){this.updateAllColumnWidths()}return true},autoExpand:function(preventUpdate){var g=this.grid,cm=this.cm;if(!this.userResized&&g.autoExpandColumn){var tw=cm.getTotalWidth(false);var aw=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();if(tw!=aw){var ci=cm.getIndexById(g.autoExpandColumn);var currentWidth=cm.getColumnWidth(ci);var cw=Math.min(Math.max(((aw-tw)+currentWidth),g.autoExpandMin),g.autoExpandMax);if(cw!=currentWidth){cm.setColumnWidth(ci,cw,true);if(preventUpdate!==true){this.updateColumnWidth(ci,cw)}}}}},getColumnData:function(){var cs=[],cm=this.cm,colCount=cm.getColumnCount();for(var i=0;i<colCount;i++){var name=cm.getDataIndex(i);cs[i]={name:(typeof name=="undefined"?this.ds.fields.get(i).name:name),renderer:cm.getRenderer(i),id:cm.getColumnId(i),style:this.getColumnStyle(i)}}return cs},renderRows:function(startRow,endRow){var g=this.grid,cm=g.colModel,ds=g.store,stripe=g.stripeRows;var colCount=cm.getColumnCount();if(ds.getCount()<1){return""}var cs=this.getColumnData();startRow=startRow||0;endRow=typeof endRow=="undefined"?ds.getCount()-1:endRow;var rs=ds.getRange(startRow,endRow);return this.doRender(cs,rs,ds,startRow,colCount,stripe)},renderBody:function(){var markup=this.renderRows()||"&#160;";return this.templates.body.apply({rows:markup})},refreshRow:function(record){var ds=this.ds,index;if(typeof record=="number"){index=record;record=ds.getAt(index);if(!record){return}}else{index=ds.indexOf(record);if(index<0){return}}this.insertRows(ds,index,index,true);this.getRow(index).rowIndex=index;this.onRemove(ds,record,index+1,true);this.fireEvent("rowupdated",this,index,record)},refresh:function(headersToo){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var result=this.renderBody();this.mainBody.update(result).setWidth(this.getTotalWidth());if(headersToo===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")}},updateHeaderSortState:function(){var state=this.ds.getSortState();if(!state){return}if(!this.sortState||(this.sortState.field!=state.field||this.sortState.direction!=state.direction)){this.grid.fireEvent("sortchange",this.grid,state)}this.sortState=state;var sortColumn=this.cm.findColumnIndex(state.field);if(sortColumn!=-1){var sortDir=state.direction;this.updateSortIcon(sortColumn,sortDir)}},destroy:function(){if(this.colMenu){Ext.menu.MenuMgr.unregister(this.colMenu);this.colMenu.destroy();delete this.colMenu}if(this.hmenu){Ext.menu.MenuMgr.unregister(this.hmenu);this.hmenu.destroy();delete this.hmenu}this.initData(null,null);this.purgeListeners();Ext.fly(this.innerHd).un("click",this.handleHdDown,this);if(this.grid.enableColumnMove){Ext.destroy(this.columnDrag.el,this.columnDrag.proxy.ghost,this.columnDrag.proxy.el,this.columnDrop.el,this.columnDrop.proxyTop,this.columnDrop.proxyBottom,this.columnDrag.dragData.ddel,this.columnDrag.dragData.header);if(this.columnDrag.proxy.anim){Ext.destroy(this.columnDrag.proxy.anim)}delete this.columnDrag.proxy.ghost;delete this.columnDrag.dragData.ddel;delete this.columnDrag.dragData.header;this.columnDrag.destroy();delete Ext.dd.DDM.locationCache[this.columnDrag.id];delete this.columnDrag._domRef;delete this.columnDrop.proxyTop;delete this.columnDrop.proxyBottom;this.columnDrop.destroy();delete Ext.dd.DDM.locationCache["gridHeader"+this.grid.getGridEl().id];delete this.columnDrop._domRef;delete Ext.dd.DDM.ids[this.columnDrop.ddGroup]}if(this.splitone){this.splitone.destroy();delete this.splitone._domRef;delete Ext.dd.DDM.ids["gridSplitters"+this.grid.getGridEl().id]}Ext.fly(this.innerHd).removeAllListeners();Ext.removeNode(this.innerHd);delete this.innerHd;Ext.destroy(this.el,this.mainWrap,this.mainHd,this.scroller,this.mainBody,this.focusEl,this.resizeMarker,this.resizeProxy,this.activeHdBtn,this.dragZone,this.splitZone,this._flyweight);delete this.grid.container;if(this.dragZone){this.dragZone.destroy()}Ext.dd.DDM.currentTarget=null;delete Ext.dd.DDM.locationCache[this.grid.getGridEl().id];Ext.EventManager.removeResizeListener(this.onWindowResize,this)},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var ct=this.grid.ownerCt;if(ct&&ct.getLayout()){ct.on("afterlayout",function(){this.fitColumns(true,true);this.updateHeaders()},this,{single:true})}else{this.fitColumns(true,true)}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.renderUI()},initData:function(ds,cm){if(this.ds){this.ds.un("load",this.onLoad,this);this.ds.un("datachanged",this.onDataChange,this);this.ds.un("add",this.onAdd,this);this.ds.un("remove",this.onRemove,this);this.ds.un("update",this.onUpdate,this);this.ds.un("clear",this.onClear,this);if(this.ds!==ds&&this.ds.autoDestroy){this.ds.destroy()}}if(ds){ds.on({scope:this,load:this.onLoad,datachanged:this.onDataChange,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.onClear})}this.ds=ds;if(this.cm){this.cm.un("configchange",this.onColConfigChange,this);this.cm.un("widthchange",this.onColWidthChange,this);this.cm.un("headerchange",this.onHeaderChange,this);this.cm.un("hiddenchange",this.onHiddenChange,this);this.cm.un("columnmoved",this.onColumnMove,this)}if(cm){delete this.lastViewWidth;cm.on({scope:this,configchange:this.onColConfigChange,widthchange:this.onColWidthChange,headerchange:this.onHeaderChange,hiddenchange:this.onHiddenChange,columnmoved:this.onColumnMove})}this.cm=cm},onDataChange:function(){this.refresh();this.updateHeaderSortState();this.syncFocusEl(0)},onClear:function(){this.refresh();this.syncFocusEl(0)},onUpdate:function(ds,record){this.refreshRow(record)},onAdd:function(ds,records,index){this.insertRows(ds,index,index+(records.length-1))},onRemove:function(ds,record,index,isUpdate){if(isUpdate!==true){this.fireEvent("beforerowremoved",this,index,record)}this.removeRow(index);if(isUpdate!==true){this.processRows(index);this.applyEmptyText();this.fireEvent("rowremoved",this,index,record)}},onLoad:function(){this.scrollToTop.defer(Ext.isGecko?1:0,this)},onColWidthChange:function(cm,col,width){this.updateColumnWidth(col,width)},onHeaderChange:function(cm,col,text){this.updateHeaders()},onHiddenChange:function(cm,col,hidden){this.updateColumnHidden(col,hidden)},onColumnMove:function(cm,oldIndex,newIndex){this.indexMap=null;var s=this.getScrollState();this.refresh(true);this.restoreScroll(s);this.afterMove(newIndex);this.grid.fireEvent("columnmove",oldIndex,newIndex)},onColConfigChange:function(){delete this.lastViewWidth;this.indexMap=null;this.refresh(true)},initUI:function(grid){grid.on("headerclick",this.onHeaderClick,this)},initEvents:function(){},onHeaderClick:function(g,index){if(this.headersDisabled||!this.cm.isSortable(index)){return}g.stopEditing(true);g.store.sort(this.cm.getDataIndex(index))},onRowOver:function(e,t){var row;if((row=this.findRowIndex(t))!==false){this.addRowClass(row,"x-grid3-row-over")}},onRowOut:function(e,t){var row;if((row=this.findRowIndex(t))!==false&&!e.within(this.getRow(row),true)){this.removeRowClass(row,"x-grid3-row-over")}},handleWheel:function(e){e.stopPropagation()},onRowSelect:function(row){this.addRowClass(row,this.selectedRowClass)},onRowDeselect:function(row){this.removeRowClass(row,this.selectedRowClass)},onCellSelect:function(row,col){var cell=this.getCell(row,col);if(cell){this.fly(cell).addClass("x-grid3-cell-selected")}},onCellDeselect:function(row,col){var cell=this.getCell(row,col);if(cell){this.fly(cell).removeClass("x-grid3-cell-selected")}},onColumnSplitterMoved:function(i,w){this.userResized=true;var cm=this.grid.colModel;cm.setColumnWidth(i,w,true);if(this.forceFit){this.fitColumns(true,false,i);this.updateAllColumnWidths()}else{this.updateColumnWidth(i,w);this.syncHeaderScroll()}this.grid.fireEvent("columnresize",i,w)},handleHdMenuClick:function(item){var index=this.hdCtxIndex,cm=this.cm,ds=this.ds,id=item.getItemId();switch(id){case"asc":ds.sort(cm.getDataIndex(index),"ASC");break;case"desc":ds.sort(cm.getDataIndex(index),"DESC");break;default:index=cm.getIndexById(id.substr(4));if(index!=-1){if(item.checked&&cm.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false}cm.setHidden(index,item.checked)}}return true},isHideableColumn:function(c){return !c.hidden&&!c.fixed},beforeColMenuShow:function(){var cm=this.cm,colCount=cm.getColumnCount();this.colMenu.removeAll();for(var i=0;i<colCount;i++){if(cm.config[i].fixed!==true&&cm.config[i].hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+cm.getColumnId(i),text:cm.getColumnHeader(i),checked:!cm.isHidden(i),hideOnClick:false,disabled:cm.config[i].hideable===false}))}}},handleHdDown:function(e,t){if(Ext.fly(t).hasClass("x-grid3-hd-btn")){e.stopEvent();var hd=this.findHeaderCell(t);Ext.fly(hd).addClass("x-grid3-hd-menu-open");var index=this.getCellIndex(hd);this.hdCtxIndex=index;var ms=this.hmenu.items,cm=this.cm;ms.get("asc").setDisabled(!cm.isSortable(index));ms.get("desc").setDisabled(!cm.isSortable(index));this.hmenu.on("hide",function(){Ext.fly(hd).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(t,"tl-bl?")}},handleHdOver:function(e,t){var hd=this.findHeaderCell(t);if(hd&&!this.headersDisabled){this.activeHdRef=t;this.activeHdIndex=this.getCellIndex(hd);var fly=this.fly(hd);this.activeHdRegion=fly.getRegion();if(!this.cm.isMenuDisabled(this.activeHdIndex)){fly.addClass("x-grid3-hd-over");this.activeHdBtn=fly.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(hd.firstChild.offsetHeight-1)+"px"}}}},handleHdMove:function(e,t){var hd=this.findHeaderCell(this.activeHdRef);if(hd&&!this.headersDisabled){var hw=this.splitHandleWidth||5,r=this.activeHdRegion,x=e.getPageX(),ss=hd.style,cur="";if(this.grid.enableColumnResize!==false){if(x-r.left<=hw&&this.cm.isResizable(this.activeHdIndex-1)){cur=Ext.isAir?"move":Ext.isWebKit?"e-resize":"col-resize"}else{if(r.right-x<=(!this.activeHdBtn?hw:2)&&this.cm.isResizable(this.activeHdIndex)){cur=Ext.isAir?"move":Ext.isWebKit?"w-resize":"col-resize"}}}ss.cursor=cur}},handleHdOut:function(e,t){var hd=this.findHeaderCell(t);if(hd&&(!Ext.isIE||!e.within(hd,true))){this.activeHdRef=null;this.fly(hd).removeClass("x-grid3-hd-over");hd.style.cursor=""}},hasRows:function(){var fc=this.mainBody.dom.firstChild;return fc&&fc.nodeType==1&&fc.className!="x-grid-empty"},bind:function(d,c){this.initData(d,c)}});Ext.grid.GridView.SplitDragZone=function(grid,hd){this.grid=grid;this.view=grid.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,hd,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=this.view.splitHandleWidth||5};Ext.extend(Ext.grid.GridView.SplitDragZone,Ext.dd.DDProxy,{b4StartDrag:function(x,y){this.view.headersDisabled=true;var h=this.view.mainWrap.getHeight();this.marker.setHeight(h);this.marker.show();this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);this.proxy.setHeight(h);var w=this.cm.getColumnWidth(this.cellIndex);var minw=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(minw,1000);this.setYConstraint(0,0);this.minX=x-minw;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y)},handleMouseDown:function(e){var t=this.view.findHeaderCell(e.getTarget());if(t){var xy=this.view.fly(t).getXY(),x=xy[0],y=xy[1];var exy=e.getXY(),ex=exy[0];var w=t.offsetWidth,adjust=false;if((ex-x)<=this.hw){adjust=-1}else{if((x+w)-ex<=this.hw){adjust=0}}if(adjust!==false){this.cm=this.grid.colModel;var ci=this.view.getCellIndex(t);if(adjust==-1){if(ci+adjust<0){return}while(this.cm.isHidden(ci+adjust)){--adjust;if(ci+adjust<0){return}}}this.cellIndex=ci+adjust;this.split=t.dom;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(e)}}}},endDrag:function(e){this.marker.hide();var v=this.view;var endX=Math.max(this.minX,e.getPageX());var diff=endX-this.startPos;v.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff);setTimeout(function(){v.headersDisabled=false},50)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.HeaderDragZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,hd);if(hd2){this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2))}this.scroll=false};Ext.extend(Ext.grid.HeaderDragZone,Ext.dd.DragZone,{maxDragWidth:120,getDragData:function(e){var t=Ext.lib.Event.getTarget(e);var h=this.view.findHeaderCell(t);if(h){return{ddel:h.firstChild,header:h}}return false},onInitDrag:function(e){this.view.headersDisabled=true;var clone=this.dragData.ddel.cloneNode(true);clone.id=Ext.id();clone.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(clone);return true},afterValidDrop:function(){var v=this.view;setTimeout(function(){v.headersDisabled=false},50)},afterInvalidDrop:function(){var v=this.view;setTimeout(function(){v.headersDisabled=false},50)}});Ext.grid.HeaderDropZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxyTop=Ext.DomHelper.append(document.body,{cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden")};this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,grid.getGridEl().dom)};Ext.extend(Ext.grid.HeaderDropZone,Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);var cindex=this.view.findCellIndex(t);if(cindex!==false){return this.view.getHeaderCell(cindex)}},nextVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.nextSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h}h=h.nextSibling}return null},prevVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.prevSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h}h=h.prevSibling}return null},positionIndicator:function(h,n,e){var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var px,pt,py=r.top+this.proxyOffsets[1];if((r.right-x)<=(r.right-r.left)/2){px=r.right+this.view.borderWidth;pt="after"}else{px=r.left;pt="before"}if(this.grid.colModel.isFixed(this.view.getCellIndex(n))){return false}px+=this.proxyOffsets[0];this.proxyTop.setLeftTop(px,py);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight()}this.proxyBottom.setLeftTop(px,py+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return pt},onNodeEnter:function(n,dd,e,data){if(data.header!=n){this.positionIndicator(data.header,n,e)}},onNodeOver:function(n,dd,e,data){var result=false;if(data.header!=n){result=this.positionIndicator(data.header,n,e)}if(!result){this.proxyTop.hide();this.proxyBottom.hide()}return result?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(n,dd,e,data){this.proxyTop.hide();this.proxyBottom.hide()},onNodeDrop:function(n,dd,e,data){var h=data.header;if(h!=n){var cm=this.grid.colModel;var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var pt=(r.right-x)<=((r.right-r.left)/2)?"after":"before";var oldIndex=this.view.getCellIndex(h);var newIndex=this.view.getCellIndex(n);if(pt=="after"){newIndex++}if(oldIndex<newIndex){newIndex--}cm.moveColumn(oldIndex,newIndex);return true}return false}});Ext.grid.GridView.ColumnDragZone=function(grid,hd){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,grid,hd,null);this.proxy.el.addClass("x-grid3-col-dd")};Ext.extend(Ext.grid.GridView.ColumnDragZone,Ext.grid.HeaderDragZone,{handleMouseDown:function(e){},callHandleMouseDown:function(e){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,e)}});Ext.grid.SplitDragZone=function(grid,hd,hd2){this.grid=grid;this.view=grid.getView();this.proxy=this.view.resizeProxy;Ext.grid.SplitDragZone.superclass.constructor.call(this,hd,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(hd2));this.scroll=false};Ext.extend(Ext.grid.SplitDragZone,Ext.dd.DDProxy,{fly:Ext.Element.fly,b4StartDrag:function(x,y){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var w=this.cm.getColumnWidth(this.cellIndex);var minw=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(minw,1000);this.setYConstraint(0,0);this.minX=x-minw;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y)},handleMouseDown:function(e){var ev=Ext.EventObject.setEvent(e);var t=this.fly(ev.getTarget());if(t.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(t.dom);this.split=t.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}},endDrag:function(e){this.view.headersDisabled=false;var endX=Math.max(this.minX,Ext.lib.Event.getPageX(e));var diff=endX-this.startPos;this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.GridDragZone=function(grid,config){this.view=grid.getView();Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,config);this.scroll=false;this.grid=grid;this.ddel=document.createElement("div");this.ddel.className="x-grid-dd-wrap"};Ext.extend(Ext.grid.GridDragZone,Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(e){var t=Ext.lib.Event.getTarget(e);var rowIndex=this.view.findRowIndex(t);if(rowIndex!==false){var sm=this.grid.selModel;if(!sm.isSelected(rowIndex)||e.hasModifier()){sm.handleMouseDown(this.grid,rowIndex,e)}return{grid:this.grid,ddel:this.ddel,rowIndex:rowIndex,selections:sm.getSelections()}}return false},onInitDrag:function(e){var data=this.dragData;this.ddel.innerHTML=this.grid.getDragDropText();this.proxy.update(this.ddel)},afterRepair:function(){this.dragging=false},getRepairXY:function(e,data){return false},onEndDrag:function(data,e){},onValidDrop:function(dd,e,id){this.hideProxy()},beforeInvalidDrop:function(e,id){}});Ext.grid.ColumnModel=function(config){if(config.columns){Ext.apply(this,config);this.setConfig(config.columns,true)}else{this.setConfig(config,true)}this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");Ext.grid.ColumnModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.ColumnModel,Ext.util.Observable,{defaultWidth:100,defaultSortable:false,getColumnId:function(index){return this.config[index].id},getColumnAt:function(index){return this.config[index]},setConfig:function(config,initial){var i,c,len;if(!initial){delete this.totalWidth;for(i=0,len=this.config.length;i<len;i++){c=this.config[i];if(c.editor){c.editor.destroy()}}}this.defaults=Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);this.config=config;this.lookup={};for(i=0,len=config.length;i<len;i++){c=Ext.applyIf(config[i],this.defaults);if(typeof c.id=="undefined"){c.id=i}if(!c.isColumn){var Cls=Ext.grid.Column.types[c.xtype||"gridcolumn"];c=new Cls(c);config[i]=c}this.lookup[c.id]=c}if(!initial){this.fireEvent("configchange",this)}},getColumnById:function(id){return this.lookup[id]},getIndexById:function(id){for(var i=0,len=this.config.length;i<len;i++){if(this.config[i].id==id){return i}}return -1},moveColumn:function(oldIndex,newIndex){var c=this.config[oldIndex];this.config.splice(oldIndex,1);this.config.splice(newIndex,0,c);this.dataMap=null;this.fireEvent("columnmoved",this,oldIndex,newIndex)},getColumnCount:function(visibleOnly){if(visibleOnly===true){var c=0;for(var i=0,len=this.config.length;i<len;i++){if(!this.isHidden(i)){c++}}return c}return this.config.length},getColumnsBy:function(fn,scope){var r=[];for(var i=0,len=this.config.length;i<len;i++){var c=this.config[i];if(fn.call(scope||this,c,i)===true){r[r.length]=c}}return r},isSortable:function(col){return !!this.config[col].sortable},isMenuDisabled:function(col){return !!this.config[col].menuDisabled},getRenderer:function(col){if(!this.config[col].renderer){return Ext.grid.ColumnModel.defaultRenderer}return this.config[col].renderer},setRenderer:function(col,fn){this.config[col].renderer=fn},getColumnWidth:function(col){return this.config[col].width},setColumnWidth:function(col,width,suppressEvent){this.config[col].width=width;this.totalWidth=null;if(!suppressEvent){this.fireEvent("widthchange",this,col,width)}},getTotalWidth:function(includeHidden){if(!this.totalWidth){this.totalWidth=0;for(var i=0,len=this.config.length;i<len;i++){if(includeHidden||!this.isHidden(i)){this.totalWidth+=this.getColumnWidth(i)}}}return this.totalWidth},getColumnHeader:function(col){return this.config[col].header},setColumnHeader:function(col,header){this.config[col].header=header;this.fireEvent("headerchange",this,col,header)},getColumnTooltip:function(col){return this.config[col].tooltip},setColumnTooltip:function(col,tooltip){this.config[col].tooltip=tooltip},getDataIndex:function(col){return this.config[col].dataIndex},setDataIndex:function(col,dataIndex){this.config[col].dataIndex=dataIndex},findColumnIndex:function(dataIndex){var c=this.config;for(var i=0,len=c.length;i<len;i++){if(c[i].dataIndex==dataIndex){return i}}return -1},isCellEditable:function(colIndex,rowIndex){return(this.config[colIndex].editable||(typeof this.config[colIndex].editable=="undefined"&&this.config[colIndex].editor))?true:false},getCellEditor:function(colIndex,rowIndex){return this.config[colIndex].getCellEditor(rowIndex)},setEditable:function(col,editable){this.config[col].editable=editable},isHidden:function(colIndex){return !!this.config[colIndex].hidden},isFixed:function(colIndex){return !!this.config[colIndex].fixed},isResizable:function(colIndex){return colIndex>=0&&this.config[colIndex].resizable!==false&&this.config[colIndex].fixed!==true},setHidden:function(colIndex,hidden){var c=this.config[colIndex];if(c.hidden!==hidden){c.hidden=hidden;this.totalWidth=null;this.fireEvent("hiddenchange",this,colIndex,hidden)}},setEditor:function(col,editor){Ext.destroy(this.config[col].editor);this.config[col].editor=editor},destroy:function(){for(var i=0,c=this.config,len=c.length;i<len;i++){Ext.destroy(c[i].editor)}this.purgeListeners()}});Ext.grid.ColumnModel.defaultRenderer=function(value){if(typeof value=="string"&&value.length<1){return"&#160;"}return value};Ext.grid.AbstractSelectionModel=function(){this.locked=false;Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.AbstractSelectionModel,Ext.util.Observable,{init:function(grid){this.grid=grid;this.initEvents()},lock:function(){this.locked=true},unlock:function(){this.locked=false},isLocked:function(){return this.locked},destroy:function(){this.purgeListeners()}});Ext.grid.RowSelectionModel=function(config){Ext.apply(this,config);this.selections=new Ext.util.MixedCollection(false,function(o){return o.id});this.last=false;this.lastActive=false;this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");Ext.grid.RowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.RowSelectionModel,Ext.grid.AbstractSelectionModel,{singleSelect:false,initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:function(e){if(!e.shiftKey||this.singleSelect){this.selectPrevious(false)}else{if(this.last!==false&&this.lastActive!==false){var last=this.last;this.selectRange(this.last,this.lastActive-1);this.grid.getView().focusRow(this.lastActive);if(last!==false){this.last=last}}else{this.selectFirstRow()}}},down:function(e){if(!e.shiftKey||this.singleSelect){this.selectNext(false)}else{if(this.last!==false&&this.lastActive!==false){var last=this.last;this.selectRange(this.last,this.lastActive+1);this.grid.getView().focusRow(this.lastActive);if(last!==false){this.last=last}}else{this.selectFirstRow()}}},scope:this});this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove})},onRefresh:function(){var ds=this.grid.store,index;var s=this.getSelections();this.clearSelections(true);for(var i=0,len=s.length;i<len;i++){var r=s[i];if((index=ds.indexOfId(r.id))!=-1){this.selectRow(index,true)}}if(s.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)}},onRemove:function(v,index,r){if(this.selections.remove(r)!==false){this.fireEvent("selectionchange",this)}},onRowUpdated:function(v,index,r){if(this.isSelected(r)){v.onRowSelect(index)}},selectRecords:function(records,keepExisting){if(!keepExisting){this.clearSelections()}var ds=this.grid.store;for(var i=0,len=records.length;i<len;i++){this.selectRow(ds.indexOf(records[i]),true)}},getCount:function(){return this.selections.length},selectFirstRow:function(){this.selectRow(0)},selectLastRow:function(keepExisting){this.selectRow(this.grid.store.getCount()-1,keepExisting)},selectNext:function(keepExisting){if(this.hasNext()){this.selectRow(this.last+1,keepExisting);this.grid.getView().focusRow(this.last);return true}return false},selectPrevious:function(keepExisting){if(this.hasPrevious()){this.selectRow(this.last-1,keepExisting);this.grid.getView().focusRow(this.last);return true}return false},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount()},hasPrevious:function(){return !!this.last},getSelections:function(){return[].concat(this.selections.items)},getSelected:function(){return this.selections.itemAt(0)},each:function(fn,scope){var s=this.getSelections();for(var i=0,len=s.length;i<len;i++){if(fn.call(scope||this,s[i],i)===false){return false}}return true},clearSelections:function(fast){if(this.isLocked()){return}if(fast!==true){var ds=this.grid.store;var s=this.selections;s.each(function(r){this.deselectRow(ds.indexOfId(r.id))},this);s.clear()}else{this.selections.clear()}this.last=false},selectAll:function(){if(this.isLocked()){return}this.selections.clear();for(var i=0,len=this.grid.store.getCount();i<len;i++){this.selectRow(i,true)}},hasSelection:function(){return this.selections.length>0},isSelected:function(index){var r=Ext.isNumber(index)?this.grid.store.getAt(index):index;return(r&&this.selections.key(r.id)?true:false)},isIdSelected:function(id){return(this.selections.key(id)?true:false)},handleMouseDown:function(g,rowIndex,e){if(e.button!==0||this.isLocked()){return}var view=this.grid.getView();if(e.shiftKey&&!this.singleSelect&&this.last!==false){var last=this.last;this.selectRange(last,rowIndex,e.ctrlKey);this.last=last;view.focusRow(rowIndex)}else{var isSelected=this.isSelected(rowIndex);if(e.ctrlKey&&isSelected){this.deselectRow(rowIndex)}else{if(!isSelected||this.getCount()>1){this.selectRow(rowIndex,e.ctrlKey||e.shiftKey);view.focusRow(rowIndex)}}}},selectRows:function(rows,keepExisting){if(!keepExisting){this.clearSelections()}for(var i=0,len=rows.length;i<len;i++){this.selectRow(rows[i],true)}},selectRange:function(startRow,endRow,keepExisting){var i;if(this.isLocked()){return}if(!keepExisting){this.clearSelections()}if(startRow<=endRow){for(i=startRow;i<=endRow;i++){this.selectRow(i,true)}}else{for(i=startRow;i>=endRow;i--){this.selectRow(i,true)}}},deselectRange:function(startRow,endRow,preventViewNotify){if(this.isLocked()){return}for(var i=startRow;i<=endRow;i++){this.deselectRow(i,preventViewNotify)}},selectRow:function(index,keepExisting,preventViewNotify){if(this.isLocked()||(index<0||index>=this.grid.store.getCount())||(keepExisting&&this.isSelected(index))){return}var r=this.grid.store.getAt(index);if(r&&this.fireEvent("beforerowselect",this,index,keepExisting,r)!==false){if(!keepExisting||this.singleSelect){this.clearSelections()}this.selections.add(r);this.last=this.lastActive=index;if(!preventViewNotify){this.grid.getView().onRowSelect(index)}this.fireEvent("rowselect",this,index,r);this.fireEvent("selectionchange",this)}},deselectRow:function(index,preventViewNotify){if(this.isLocked()){return}if(this.last==index){this.last=false}if(this.lastActive==index){this.lastActive=false}var r=this.grid.store.getAt(index);if(r){this.selections.remove(r);if(!preventViewNotify){this.grid.getView().onRowDeselect(index)}this.fireEvent("rowdeselect",this,index,r);this.fireEvent("selectionchange",this)}},restoreLast:function(){if(this._last){this.last=this._last}},acceptsNav:function(row,col,cm){return !cm.isHidden(col)&&cm.isCellEditable(col,row)},onEditorKey:function(field,e){var k=e.getKey(),newCell,g=this.grid,last=g.lastEdit,ed=g.activeEditor,ae,last,r,c;var shift=e.shiftKey;if(k==e.TAB){e.stopEvent();ed.completeEdit();if(shift){newCell=g.walkCells(ed.row,ed.col-1,-1,this.acceptsNav,this)}else{newCell=g.walkCells(ed.row,ed.col+1,1,this.acceptsNav,this)}}else{if(k==e.ENTER){if(this.moveEditorOnEnter!==false){if(shift){newCell=g.walkCells(last.row-1,last.col,-1,this.acceptsNav,this)}else{newCell=g.walkCells(last.row+1,last.col,1,this.acceptsNav,this)}}}}if(newCell){r=newCell[0];c=newCell[1];if(last.row!=r){this.selectRow(r)}if(g.isEditor&&g.editing){ae=g.activeEditor;if(ae&&ae.field.triggerBlur){ae.field.triggerBlur()}}g.startEditing(r,c)}},destroy:function(){if(this.rowNav){this.rowNav.disable();this.rowNav=null}Ext.grid.RowSelectionModel.superclass.destroy.call(this)}});Ext.grid.Column=function(config){Ext.apply(this,config);if(Ext.isString(this.renderer)){this.renderer=Ext.util.Format[this.renderer]}else{if(Ext.isObject(this.renderer)){this.scope=this.renderer.scope;this.renderer=this.renderer.fn}}this.renderer=this.renderer.createDelegate(this.scope||config);if(this.editor){this.editor=Ext.create(this.editor,"textfield")}};Ext.grid.Column.prototype={isColumn:true,renderer:function(value){if(Ext.isString(value)&&value.length<1){return"&#160;"}return value},getEditor:function(rowIndex){return this.editable!==false?this.editor:null},getCellEditor:function(rowIndex){var editor=this.getEditor(rowIndex);if(editor){if(!editor.startEdit){if(!editor.gridEditor){editor.gridEditor=new Ext.grid.GridEditor(editor)}return editor.gridEditor}else{if(editor.startEdit){return editor}}}return null}};Ext.grid.BooleanColumn=Ext.extend(Ext.grid.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(cfg){Ext.grid.BooleanColumn.superclass.constructor.call(this,cfg);var t=this.trueText,f=this.falseText,u=this.undefinedText;this.renderer=function(v){if(v===undefined){return u}if(!v||v==="false"){return f}return t}}});Ext.grid.NumberColumn=Ext.extend(Ext.grid.Column,{format:"0,000.00",constructor:function(cfg){Ext.grid.NumberColumn.superclass.constructor.call(this,cfg);this.renderer=Ext.util.Format.numberRenderer(this.format)}});Ext.grid.DateColumn=Ext.extend(Ext.grid.Column,{format:"m/d/Y",constructor:function(cfg){Ext.grid.DateColumn.superclass.constructor.call(this,cfg);this.renderer=Ext.util.Format.dateRenderer(this.format)}});Ext.grid.TemplateColumn=Ext.extend(Ext.grid.Column,{constructor:function(cfg){Ext.grid.TemplateColumn.superclass.constructor.call(this,cfg);var tpl=Ext.isObject(this.tpl)?this.tpl:new Ext.XTemplate(this.tpl);this.renderer=function(value,p,r){return tpl.apply(r.data)};this.tpl=tpl}});Ext.grid.Column.types={gridcolumn:Ext.grid.Column,booleancolumn:Ext.grid.BooleanColumn,numbercolumn:Ext.grid.NumberColumn,datecolumn:Ext.grid.DateColumn,templatecolumn:Ext.grid.TemplateColumn};Ext.grid.RowNumberer=function(config){Ext.apply(this,config);if(this.rowspan){this.renderer=this.renderer.createDelegate(this)}};Ext.grid.RowNumberer.prototype={header:"",width:23,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"numberer",rowspan:undefined,renderer:function(v,p,record,rowIndex){if(this.rowspan){p.cellAttr='rowspan="'+this.rowspan+'"'}return rowIndex+1}};Ext.grid.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,dataIndex:"",id:"checker",constructor:function(){Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}},initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){var view=this.grid.getView();view.mainBody.on("mousedown",this.onMouseDown,this);Ext.fly(view.innerHd).on("mousedown",this.onHdMouseDown,this)},this)},onMouseDown:function(e,t){if(e.button===0&&t.className=="x-grid3-row-checker"){e.stopEvent();var row=e.getTarget(".x-grid3-row");if(row){var index=row.rowIndex;if(this.isSelected(index)){this.deselectRow(index)}else{this.selectRow(index,true)}}}},onHdMouseDown:function(e,t){if(t.className=="x-grid3-hd-checker"){e.stopEvent();var hd=Ext.fly(t.parentNode);var isChecked=hd.hasClass("x-grid3-hd-checker-on");if(isChecked){hd.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{hd.addClass("x-grid3-hd-checker-on");this.selectAll()}}},renderer:function(v,p,record){return'<div class="x-grid3-row-checker">&#160;</div>'}});Ext.grid.CellSelectionModel=function(config){Ext.apply(this,config);this.selection=null;this.addEvents("beforecellselect","cellselect","selectionchange");Ext.grid.CellSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.CellSelectionModel,Ext.grid.AbstractSelectionModel,{initEvents:function(){this.grid.on("cellmousedown",this.handleMouseDown,this);this.grid.on(Ext.EventManager.useKeydown?"keydown":"keypress",this.handleKeyDown,this);this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearSelections,beforerowsinserted:this.clearSelections});if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)}},beforeEdit:function(e){this.select(e.row,e.column,false,true,e.record)},onRowUpdated:function(v,index,r){if(this.selection&&this.selection.record==r){v.onCellSelect(index,this.selection.cell[1])}},onViewChange:function(){this.clearSelections(true)},getSelectedCell:function(){return this.selection?this.selection.cell:null},clearSelections:function(preventNotify){var s=this.selection;if(s){if(preventNotify!==true){this.grid.view.onCellDeselect(s.cell[0],s.cell[1])}this.selection=null;this.fireEvent("selectionchange",this,null)}},hasSelection:function(){return this.selection?true:false},handleMouseDown:function(g,row,cell,e){if(e.button!==0||this.isLocked()){return}this.select(row,cell)},select:function(rowIndex,colIndex,preventViewNotify,preventFocus,r){if(this.fireEvent("beforecellselect",this,rowIndex,colIndex)!==false){this.clearSelections();r=r||this.grid.store.getAt(rowIndex);this.selection={record:r,cell:[rowIndex,colIndex]};if(!preventViewNotify){var v=this.grid.getView();v.onCellSelect(rowIndex,colIndex);if(preventFocus!==true){v.focusCell(rowIndex,colIndex)}}this.fireEvent("cellselect",this,rowIndex,colIndex);this.fireEvent("selectionchange",this,this.selection)}},isSelectable:function(rowIndex,colIndex,cm){return !cm.isHidden(colIndex)},onEditorKey:function(field,e){if(e.getKey()==e.TAB){this.handleKeyDown(e)}},handleKeyDown:function(e){if(!e.isNavKeyPress()){return}var k=e.getKey(),g=this.grid,s=this.selection,sm=this,walk=function(row,col,step){return g.walkCells(row,col,step,g.isEditor&&g.editing?sm.acceptsNav:sm.isSelectable,sm)},cell,newCell,r,c,ae;switch(k){case e.ESC:case e.PAGE_UP:case e.PAGE_DOWN:break;default:e.stopEvent();break}if(!s){cell=walk(0,0,1);if(cell){this.select(cell[0],cell[1])}return}cell=s.cell;r=cell[0];c=cell[1];switch(k){case e.TAB:if(e.shiftKey){newCell=walk(r,c-1,-1)}else{newCell=walk(r,c+1,1)}break;case e.DOWN:newCell=walk(r+1,c,1);break;case e.UP:newCell=walk(r-1,c,-1);break;case e.RIGHT:newCell=walk(r,c+1,1);break;case e.LEFT:newCell=walk(r,c-1,-1);break;case e.ENTER:if(g.isEditor&&!g.editing){g.startEditing(r,c);return}break}if(newCell){r=newCell[0];c=newCell[1];this.select(r,c);if(g.isEditor&&g.editing){ae=g.activeEditor;if(ae&&ae.field.triggerBlur){ae.field.triggerBlur()}g.startEditing(r,c)}}},acceptsNav:function(row,col,cm){return !cm.isHidden(col)&&cm.isCellEditable(col,row)}});Ext.grid.EditorGridPanel=Ext.extend(Ext.grid.GridPanel,{clicksToEdit:2,forceValidation:false,isEditor:true,detectEdit:false,autoEncode:false,trackMouseOver:false,initComponent:function(){Ext.grid.EditorGridPanel.superclass.initComponent.call(this);if(!this.selModel){this.selModel=new Ext.grid.CellSelectionModel()}this.activeEditor=null;this.addEvents("beforeedit","afteredit","validateedit")},initEvents:function(){Ext.grid.EditorGridPanel.superclass.initEvents.call(this);this.getGridEl().on("mousewheel",this.stopEditing.createDelegate(this,[true]),this);this.on("columnresize",this.stopEditing,this,[true]);if(this.clicksToEdit==1){this.on("cellclick",this.onCellDblClick,this)}else{var view=this.getView();if(this.clicksToEdit=="auto"&&view.mainBody){view.mainBody.on("mousedown",this.onAutoEditClick,this)}this.on("celldblclick",this.onCellDblClick,this)}},onCellDblClick:function(g,row,col){this.startEditing(row,col)},onAutoEditClick:function(e,t){if(e.button!==0){return}var row=this.view.findRowIndex(t);var col=this.view.findCellIndex(t);if(row!==false&&col!==false){this.stopEditing();if(this.selModel.getSelectedCell){var sc=this.selModel.getSelectedCell();if(sc&&sc[0]===row&&sc[1]===col){this.startEditing(row,col)}}else{if(this.selModel.isSelected(row)){this.startEditing(row,col)}}}},onEditComplete:function(ed,value,startValue){this.editing=false;this.activeEditor=null;var r=ed.record;var field=this.colModel.getDataIndex(ed.col);value=this.postEditValue(value,startValue,r,field);if(this.forceValidation===true||String(value)!==String(startValue)){var e={grid:this,record:r,field:field,originalValue:startValue,value:value,row:ed.row,column:ed.col,cancel:false};if(this.fireEvent("validateedit",e)!==false&&!e.cancel&&String(value)!==String(startValue)){r.set(field,e.value);delete e.cancel;this.fireEvent("afteredit",e)}}this.view.focusCell(ed.row,ed.col)},startEditing:function(row,col){this.stopEditing();if(this.colModel.isCellEditable(col,row)){this.view.ensureVisible(row,col,true);var r=this.store.getAt(row);var field=this.colModel.getDataIndex(col);var e={grid:this,record:r,field:field,value:r.data[field],row:row,column:col,cancel:false};if(this.fireEvent("beforeedit",e)!==false&&!e.cancel){this.editing=true;var ed=this.colModel.getCellEditor(col,row);if(!ed){return}if(!ed.rendered){ed.parentEl=this.view.getEditorParent(ed);ed.on({scope:this,render:{fn:function(c){c.field.focus(false,true)},single:true,scope:this},specialkey:function(field,e){this.getSelectionModel().onEditorKey(field,e)},complete:this.onEditComplete,canceledit:this.stopEditing.createDelegate(this,[true])})}Ext.apply(ed,{row:row,col:col,record:r});this.lastEdit={row:row,col:col};this.activeEditor=ed;var v=this.preEditValue(r,field);ed.startEdit(this.view.getCell(row,col).firstChild,Ext.isDefined(v)?v:"")}}},preEditValue:function(r,field){var value=r.data[field];return this.autoEncode&&Ext.isString(value)?Ext.util.Format.htmlDecode(value):value},postEditValue:function(value,originalValue,r,field){return this.autoEncode&&Ext.isString(value)?Ext.util.Format.htmlEncode(value):value},stopEditing:function(cancel){if(this.editing){var ae=this.activeEditor;if(ae){ae[cancel===true?"cancelEdit":"completeEdit"]();this.view.focusCell(ae.row,ae.col)}this.activeEditor=null}this.editing=false}});Ext.reg("editorgrid",Ext.grid.EditorGridPanel);Ext.grid.GridEditor=function(field,config){Ext.grid.GridEditor.superclass.constructor.call(this,field,config);field.monitorTab=false};Ext.extend(Ext.grid.GridEditor,Ext.Editor,{alignment:"tl-tl",autoSize:"width",hideEl:false,cls:"x-small-editor x-grid-editor",shim:false,shadow:false});Ext.grid.PropertyRecord=Ext.data.Record.create([{name:"name",type:"string"},"value"]);Ext.grid.PropertyStore=function(grid,source){this.grid=grid;this.store=new Ext.data.Store({recordType:Ext.grid.PropertyRecord});this.store.on("update",this.onUpdate,this);if(source){this.setSource(source)}Ext.grid.PropertyStore.superclass.constructor.call(this)};Ext.extend(Ext.grid.PropertyStore,Ext.util.Observable,{setSource:function(o){this.source=o;this.store.removeAll();var data=[];for(var k in o){if(this.isEditableValue(o[k])){data.push(new Ext.grid.PropertyRecord({name:k,value:o[k]},k))}}this.store.loadRecords({records:data},{},true)},onUpdate:function(ds,record,type){if(type==Ext.data.Record.EDIT){var v=record.data.value;var oldValue=record.modified.value;if(this.grid.fireEvent("beforepropertychange",this.source,record.id,v,oldValue)!==false){this.source[record.id]=v;record.commit();this.grid.fireEvent("propertychange",this.source,record.id,v,oldValue)}else{record.reject()}}},getProperty:function(row){return this.store.getAt(row)},isEditableValue:function(val){if(Ext.isDate(val)){return true}return !(Ext.isObject(val)||Ext.isFunction(val))},setValue:function(prop,value){this.source[prop]=value;this.store.getById(prop).set("value",value)},getSource:function(){return this.source}});Ext.grid.PropertyColumnModel=function(grid,store){var g=Ext.grid,f=Ext.form;this.grid=grid;g.PropertyColumnModel.superclass.constructor.call(this,[{header:this.nameText,width:50,sortable:true,dataIndex:"name",id:"name",menuDisabled:true},{header:this.valueText,width:50,resizable:false,dataIndex:"value",id:"value",menuDisabled:true}]);this.store=store;var bfield=new f.Field({autoCreate:{tag:"select",children:[{tag:"option",value:"true",html:"true"},{tag:"option",value:"false",html:"false"}]},getValue:function(){return this.el.dom.value=="true"}});this.editors={date:new g.GridEditor(new f.DateField({selectOnFocus:true})),string:new g.GridEditor(new f.TextField({selectOnFocus:true})),number:new g.GridEditor(new f.NumberField({selectOnFocus:true,style:"text-align:left;"})),"boolean":new g.GridEditor(bfield,{autoSize:"both"})};this.renderCellDelegate=this.renderCell.createDelegate(this);this.renderPropDelegate=this.renderProp.createDelegate(this)};Ext.extend(Ext.grid.PropertyColumnModel,Ext.grid.ColumnModel,{nameText:"Name",valueText:"Value",dateFormat:"m/j/Y",renderDate:function(dateVal){return dateVal.dateFormat(this.dateFormat)},renderBool:function(bVal){return bVal?"true":"false"},isCellEditable:function(colIndex,rowIndex){return colIndex==1},getRenderer:function(col){return col==1?this.renderCellDelegate:this.renderPropDelegate},renderProp:function(v){return this.getPropertyName(v)},renderCell:function(val){var rv=val;if(Ext.isDate(val)){rv=this.renderDate(val)}else{if(typeof val=="boolean"){rv=this.renderBool(val)}}return Ext.util.Format.htmlEncode(rv)},getPropertyName:function(name){var pn=this.grid.propertyNames;return pn&&pn[name]?pn[name]:name},getCellEditor:function(colIndex,rowIndex){var p=this.store.getProperty(rowIndex),n=p.data.name,val=p.data.value;if(this.grid.customEditors[n]){return this.grid.customEditors[n]}if(Ext.isDate(val)){return this.editors.date}else{if(typeof val=="number"){return this.editors.number}else{if(typeof val=="boolean"){return this.editors["boolean"]}else{return this.editors.string}}}},destroy:function(){Ext.grid.PropertyColumnModel.superclass.destroy.call(this);for(var ed in this.editors){Ext.destroy(ed)}}});Ext.grid.PropertyGrid=Ext.extend(Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},initComponent:function(){this.customEditors=this.customEditors||{};this.lastEditRow=null;var store=new Ext.grid.PropertyStore(this);this.propStore=store;var cm=new Ext.grid.PropertyColumnModel(this,store);store.store.sort("name","ASC");this.addEvents("beforepropertychange","propertychange");this.cm=cm;this.ds=store.store;Ext.grid.PropertyGrid.superclass.initComponent.call(this);this.mon(this.selModel,"beforecellselect",function(sm,rowIndex,colIndex){if(colIndex===0){this.startEditing.defer(200,this,[rowIndex,1]);return false}},this)},onRender:function(){Ext.grid.PropertyGrid.superclass.onRender.apply(this,arguments);this.getGridEl().addClass("x-props-grid")},afterRender:function(){Ext.grid.PropertyGrid.superclass.afterRender.apply(this,arguments);if(this.source){this.setSource(this.source)}},setSource:function(source){this.propStore.setSource(source)},getSource:function(){return this.propStore.getSource()}});Ext.reg("propertygrid",Ext.grid.PropertyGrid);Ext.grid.GroupingView=Ext.extend(Ext.grid.GridView,{groupByText:"Group By This Field",showGroupsText:"Show in Groups",hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:"(None)",ignoreAdd:false,groupTextTpl:"{text}",groupMode:"value",gidSeed:1000,initTemplates:function(){Ext.grid.GroupingView.superclass.initTemplates.call(this);this.state={};var sm=this.grid.getSelectionModel();sm.on(sm.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')}this.startGroup.compile();this.endGroup="</div></div>"},findGroup:function(el){return Ext.fly(el).up(".x-grid-group",this.mainBody.dom)},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},onAdd:function(){if(this.enableGrouping&&!this.ignoreAdd){var ss=this.getScrollState();this.refresh();this.restoreScroll(ss)}else{if(!this.enableGrouping){Ext.grid.GroupingView.superclass.onAdd.apply(this,arguments)}}},onRemove:function(ds,record,index,isUpdate){Ext.grid.GroupingView.superclass.onRemove.apply(this,arguments);var g=document.getElementById(record._groupId);if(g&&g.childNodes[1].childNodes.length<1){Ext.removeNode(g)}this.applyEmptyText()},refreshRow:function(record){if(this.ds.getCount()==1){this.refresh()}else{this.isUpdating=true;Ext.grid.GroupingView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false}},beforeMenuShow:function(){var item,items=this.hmenu.items,disabled=this.cm.config[this.hdCtxIndex].groupable===false;if((item=items.get("groupBy"))){item.setDisabled(disabled)}if((item=items.get("showGroups"))){item.setDisabled(disabled);item.setChecked(!!this.getGroupField(),true)}},renderUI:function(){Ext.grid.GroupingView.superclass.renderUI.call(this);this.mainBody.on("mousedown",this.interceptMouse,this);if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})}this.hmenu.on("beforeshow",this.beforeMenuShow,this)}},onGroupByClick:function(){this.grid.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));this.beforeMenuShow()},onShowGroupsClick:function(mi,checked){if(checked){this.onGroupByClick()}else{this.grid.store.clearGrouping()}},toggleGroup:function(group,expanded){this.grid.stopEditing(true);group=Ext.getDom(group);var gel=Ext.fly(group);expanded=expanded!==undefined?expanded:gel.hasClass("x-grid-group-collapsed");this.state[gel.dom.id]=expanded;gel[expanded?"removeClass":"addClass"]("x-grid-group-collapsed")},toggleAllGroups:function(expanded){var groups=this.getGroups();for(var i=0,len=groups.length;i<len;i++){this.toggleGroup(groups[i],expanded)}},expandAllGroups:function(){this.toggleAllGroups(true)},collapseAllGroups:function(){this.toggleAllGroups(false)},interceptMouse:function(e){var hd=e.getTarget(".x-grid-group-hd",this.mainBody);if(hd){e.stopEvent();this.toggleGroup(hd.parentNode)}},getGroup:function(v,r,groupRenderer,rowIndex,colIndex,ds){var g=groupRenderer?groupRenderer(v,{},r,rowIndex,colIndex,ds):String(v);if(g===""||g==="&#160;"){g=this.cm.config[colIndex].emptyGroupText||this.emptyGroupText}return g},getGroupField:function(){return this.grid.store.getGroupState()},afterRender:function(){Ext.grid.GroupingView.superclass.afterRender.call(this);if(this.grid.deferRowRender){this.updateGroupWidths()}},renderRows:function(){var groupField=this.getGroupField();var eg=!!groupField;if(this.hideGroupedColumn){var colIndex=this.cm.findColumnIndex(groupField);if(!eg&&this.lastGroupField!==undefined){this.mainBody.update("");this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField}else{if(eg&&this.lastGroupField===undefined){this.lastGroupField=groupField;this.cm.setHidden(colIndex,true)}else{if(eg&&this.lastGroupField!==undefined&&groupField!==this.lastGroupField){this.mainBody.update("");var oldIndex=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(oldIndex,false);this.lastGroupField=groupField;this.cm.setHidden(colIndex,true)}}}}return Ext.grid.GroupingView.superclass.renderRows.apply(this,arguments)},doRender:function(cs,rs,ds,startRow,colCount,stripe){if(rs.length<1){return""}var groupField=this.getGroupField(),colIndex=this.cm.findColumnIndex(groupField),g;this.enableGrouping=!!groupField;if(!this.enableGrouping||this.isUpdating){return Ext.grid.GroupingView.superclass.doRender.apply(this,arguments)}var gstyle="width:"+this.getTotalWidth()+";",gidPrefix=this.grid.getGridEl().id,cfg=this.cm.config[colIndex],groupRenderer=cfg.groupRenderer||cfg.renderer,prefix=this.showGroupName?(cfg.groupName||cfg.header)+": ":"",groups=[],curGroup,i,len,gid;for(i=0,len=rs.length;i<len;i++){var rowIndex=startRow+i,r=rs[i],gvalue=r.data[groupField];g=this.getGroup(gvalue,r,groupRenderer,rowIndex,colIndex,ds);if(!curGroup||curGroup.group!=g){gid=this.constructId(gvalue,gidPrefix,groupField,colIndex);var isCollapsed=typeof this.state[gid]!=="undefined"?!this.state[gid]:this.startCollapsed;var gcls=isCollapsed?"x-grid-group-collapsed":"";curGroup={group:g,gvalue:gvalue,text:prefix+g,groupId:gid,startRow:rowIndex,rs:[r],cls:gcls,style:gstyle};groups.push(curGroup)}else{curGroup.rs.push(r)}r._groupId=gid}var buf=[];for(i=0,len=groups.length;i<len;i++){g=groups[i];this.doGroupStart(buf,g,cs,ds,colCount);buf[buf.length]=Ext.grid.GroupingView.superclass.doRender.call(this,cs,g.rs,ds,g.startRow,colCount,stripe);this.doGroupEnd(buf,g,cs,ds,colCount)}return buf.join("")},getGroupId:function(value){var field=this.getGroupField();return this.constructId(value,this.grid.getGridEl().id,field,this.cm.findColumnIndex(field))},constructId:function(value,prefix,field,idx){var cfg=this.cm.config[idx],groupRenderer=cfg.groupRenderer||cfg.renderer,val=(this.groupMode=="value")?value:this.getGroup(value,{data:{}},groupRenderer,0,idx,this.ds);return prefix+"-gp-"+field+"-"+Ext.util.Format.htmlEncode(val)},doGroupStart:function(buf,g,cs,ds,colCount){buf[buf.length]=this.startGroup.apply(g)},doGroupEnd:function(buf,g,cs,ds,colCount){buf[buf.length]=this.endGroup},getRows:function(){if(!this.enableGrouping){return Ext.grid.GroupingView.superclass.getRows.call(this)}var r=[];var g,gs=this.getGroups();for(var i=0,len=gs.length;i<len;i++){g=gs[i].childNodes[1].childNodes;for(var j=0,jlen=g.length;j<jlen;j++){r[r.length]=g[j]}}return r},updateGroupWidths:function(){if(!this.enableGrouping||!this.hasRows()){return}var tw=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.getScrollOffset())+"px";var gs=this.getGroups();for(var i=0,len=gs.length;i<len;i++){gs[i].firstChild.style.width=tw}},onColumnWidthUpdated:function(col,w,tw){Ext.grid.GroupingView.superclass.onColumnWidthUpdated.call(this,col,w,tw);this.updateGroupWidths()},onAllColumnWidthsUpdated:function(ws,tw){Ext.grid.GroupingView.superclass.onAllColumnWidthsUpdated.call(this,ws,tw);this.updateGroupWidths()},onColumnHiddenUpdated:function(col,hidden,tw){Ext.grid.GroupingView.superclass.onColumnHiddenUpdated.call(this,col,hidden,tw);this.updateGroupWidths()},onLayout:function(){this.updateGroupWidths()},onBeforeRowSelect:function(sm,rowIndex){if(!this.enableGrouping){return}var row=this.getRow(rowIndex);if(row&&!row.offsetParent){var g=this.findGroup(row);this.toggleGroup(g,true)}}});Ext.grid.GroupingView.GROUP_ID=1000;Ext.form.MiscField=function(config){Ext.form.MiscField.superclass.constructor.call(this,config)};Ext.extend(Ext.form.MiscField,Ext.BoxComponent,{defaultAutoCreate:{tag:"div"},fieldClass:"x-form-field",isFormField:true,value:undefined,disableReset:false,initComponent:function(){Ext.form.MiscField.superclass.initComponent.call(this)},getName:function(){return this.rendered&&this.el.dom.name?this.el.dom.name:(this.hiddenName||"")},onRender:function(ct,position){Ext.form.MiscField.superclass.onRender.call(this,ct,position);if(!this.el){var cfg=this.getAutoCreate();if(!cfg.name){cfg.name=this.name||this.id}this.el=ct.createChild(cfg,position)}this.el.addClass([this.fieldClass,this.cls]);this.initValue()},initValue:function(){if(this.value!==undefined){this.setRawValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setRawValue(this.el.dom.innerHTML)}}},isDirty:function(){return String(this.getRawValue())!==String(this.originalValue)},afterRender:function(){Ext.form.MiscField.superclass.afterRender.call(this);this.initEvents()},reset:function(force){if(!this.disableReset||force===true){this.setRawValue(this.originalValue)}},initEvents:function(){this.originalValue=this.getRawValue()},isValid:function(){return true},validate:function(){return true},processValue:function(value){return value},validateValue:function(value){return true},markInvalid:function(){return},clearInvalid:function(){return},getRawValue:function(){return this.el.dom.innerHTML},getValue:function(){var f=Ext.util.Format;var v=f.trim(f.stripTags(this.getRawValue()));return v},setRawValue:function(v){this.value=v;if(this.rendered){this.el.dom.innerHTML=v}},setValue:function(v){var f=Ext.util.Format;this.setRawValue(f.trim(f.stripTags(v)))}});Ext.ComponentMgr.registerType("miscfield",Ext.form.MiscField);
/*
 * Ext JS Library 3.0+
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right"){this.cls+=" x-status-right"}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var right=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(right){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}},setStatus:function(o){o=o||{};if(typeof o=="string"){o={text:o}}if(o.text!==undefined){this.setText(o.text)}if(o.iconCls!==undefined){this.setIcon(o.iconCls)}if(o.clear){var c=o.clear,wait=this.autoClear,defaults={useDefaults:true,anim:true};if(typeof c=="object"){c=Ext.applyIf(c,defaults);if(c.wait){wait=c.wait}}else{if(typeof c=="number"){wait=c;c=defaults}else{if(typeof c=="boolean"){c=defaults}}}c.threadId=this.activeThreadId;this.clearStatus.defer(wait,this,[c])}return this},clearStatus:function(o){o=o||{};if(o.threadId&&o.threadId!==this.activeThreadId){return this}var text=o.useDefaults?this.defaultText:this.emptyText,iconCls=o.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(o.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:text,iconCls:iconCls});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:text,iconCls:iconCls});this.statusEl.show()}return this},setText:function(text){this.activeThreadId++;this.text=text||"";if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(cls){this.activeThreadId++;cls=cls||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(cls.length>0){this.statusEl.addClass(cls);this.currIconCls=cls}}else{this.currIconCls=cls}return this},showBusy:function(o){if(typeof o=="string"){o={text:o}}o=Ext.applyIf(o||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(o)}});Ext.reg("statusbar",Ext.ux.StatusBar);Ext.namespace("Ext.ux.form");Ext.ux.form.Spinner=function(config){Ext.ux.form.Spinner.superclass.constructor.call(this,config);this.addEvents({spin:true,spinup:true,spindown:true})};Ext.extend(Ext.ux.form.Spinner,Ext.form.TriggerField,{triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,strategy:undefined,onRender:function(ct,position){Ext.ux.form.Spinner.superclass.onRender.call(this,ct,position);this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.show().setRight(2);this.splitter.show().setTop(10);this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initSpinner()},initSpinner:function(){this.keyNav=new Ext.KeyNav(this.el,{up:function(e){e.preventDefault();this.onSpinUp()},down:function(e){e.preventDefault();this.onSpinDown()},pageUp:function(e){e.preventDefault();this.onSpinUpAlternate()},pageDown:function(e){e.preventDefault();this.onSpinDownAlternate()},scope:this});this.trigger.un("click",this.onTriggerClick);this.trigger.on("mouseover",this.onMouseOver,this,{preventDefault:true});this.trigger.on("mouseout",this.onMouseOut,this,{preventDefault:true});this.trigger.on("mousemove",this.onMouseMove,this,{preventDefault:true});this.trigger.on("mousedown",this.onMouseDown,this,{preventDefault:true});this.trigger.on("mouseup",this.onMouseUp,this,{preventDefault:true});this.wrap.on("mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this);if("object"==typeof this.strategy&&this.strategy.xtype){switch(this.strategy.xtype){case"number":this.strategy=new Ext.ux.form.Spinner.NumberStrategy(this.strategy);break;case"date":this.strategy=new Ext.ux.form.Spinner.DateStrategy(this.strategy);break;case"time":this.strategy=new Ext.ux.form.Spinner.TimeStrategy(this.strategy);break;default:delete (this.strategy);break}delete (this.strategy.xtype)}if(this.strategy==undefined){this.strategy=new Ext.ux.form.Spinner.NumberStrategy()}},onMouseOver:function(){if(this.disabled){return}var middle=this.getMiddle();this.__tmphcls=(Ext.EventObject.getPageY()<middle)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.__tmphcls)},onMouseOut:function(){this.trigger.removeClass(this.__tmphcls)},onMouseMove:function(){if(this.disabled){return}var middle=this.getMiddle();if(((Ext.EventObject.getPageY()>middle)&&this.__tmphcls=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<middle)&&this.__tmphcls=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var middle=this.getMiddle();this.__tmpccls=(Ext.EventObject.getPageY()<middle)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.__tmpccls)},onMouseUp:function(){this.trigger.removeClass(this.__tmpccls)},onTriggerClick:function(){if(this.disabled||this.getEl().dom.readOnly){return}var middle=this.getMiddle();var ud=(Ext.EventObject.getPageY()<middle)?"Up":"Down";this["onSpin"+ud]()},getMiddle:function(){var t=this.trigger.getTop();var h=this.trigger.getHeight();var middle=t+(h/2);return middle},handleMouseWheel:function(e){if(this.disabled||this.getEl().dom.readOnly){Ext.EventObject.preventDefault();return}var delta=e.getWheelDelta();if(delta>0){this.onSpinUp();e.stopEvent()}else{if(delta<0){this.onSpinDown();e.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var y=Ext.fly(this.dd.getDragEl()).getTop();var ud="";if(this._previousY>y){ud="Up"}if(this._previousY<y){ud="Down"}if(ud!=""){this["onSpin"+ud]()}this._previousY=y},onSpinUp:function(){if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.strategy.onSpinUp(this)}this.fireEvent("spin",this);this.fireEvent("spinup",this)},onSpinDown:function(){if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.strategy.onSpinDown(this)}this.fireEvent("spin",this);this.fireEvent("spindown",this)},onSpinUpAlternate:function(){this.strategy.onSpinUpAlternate(this);this.fireEvent("spin",this);this.fireEvent("spinup",this)},onSpinDownAlternate:function(){this.strategy.onSpinDownAlternate(this);this.fireEvent("spin",this);this.fireEvent("spindown",this)}});Ext.reg("uxspinner",Ext.ux.form.Spinner);Ext.ux.form.Spinner.Strategy=function(config){Ext.apply(this,config)};Ext.extend(Ext.ux.form.Spinner.Strategy,Ext.util.Observable,{defaultValue:0,minValue:undefined,maxValue:undefined,incrementValue:1,alternateIncrementValue:5,onSpinUp:function(field){this.spin(field,false,false)},onSpinDown:function(field){this.spin(field,true,false)},onSpinUpAlternate:function(field){this.spin(field,false,true)},onSpinDownAlternate:function(field){this.spin(field,true,true)},spin:function(field,down,alternate){},fixBoundries:function(value){return value}});Ext.ux.form.Spinner.NumberStrategy=function(config){Ext.ux.form.Spinner.NumberStrategy.superclass.constructor.call(this,config)};Ext.extend(Ext.ux.form.Spinner.NumberStrategy,Ext.ux.form.Spinner.Strategy,{allowDecimals:true,decimalPrecision:2,spin:function(field,down,alternate){Ext.ux.form.Spinner.NumberStrategy.superclass.spin.call(this,field,down,alternate);var v=parseFloat(field.getValue());var incr=(alternate==true)?this.alternateIncrementValue:this.incrementValue;(down==true)?v-=incr:v+=incr;v=(isNaN(v))?this.defaultValue:v;v=this.fixBoundries(v);field.setRawValue(v)},fixBoundries:function(value){var v=value;if(this.minValue!=undefined&&v<this.minValue){v=this.minValue}if(this.maxValue!=undefined&&v>this.maxValue){v=this.maxValue}return this.fixPrecision(v)},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?"":value}return parseFloat(parseFloat(value).toFixed(this.decimalPrecision))}});Ext.ux.form.Spinner.DateStrategy=function(config){Ext.ux.form.Spinner.DateStrategy.superclass.constructor.call(this,config)};Ext.extend(Ext.ux.form.Spinner.DateStrategy,Ext.ux.form.Spinner.Strategy,{defaultValue:new Date(),format:"Y-m-d",incrementValue:1,incrementConstant:Date.DAY,alternateIncrementValue:1,alternateIncrementConstant:Date.MONTH,spin:function(field,down,alternate){Ext.ux.form.Spinner.DateStrategy.superclass.spin.call(this);var v=field.getRawValue();v=Date.parseDate(v,this.format);var dir=(down==true)?-1:1;var incr=(alternate==true)?this.alternateIncrementValue:this.incrementValue;var dtconst=(alternate==true)?this.alternateIncrementConstant:this.incrementConstant;if(typeof this.defaultValue=="string"){this.defaultValue=Date.parseDate(this.defaultValue,this.format)}v=(v)?v.add(dtconst,dir*incr):this.defaultValue;v=this.fixBoundries(v);field.setRawValue(Ext.util.Format.date(v,this.format))},fixBoundries:function(date){var dt=date;var min=(typeof this.minValue=="string")?Date.parseDate(this.minValue,this.format):this.minValue;var max=(typeof this.maxValue=="string")?Date.parseDate(this.maxValue,this.format):this.maxValue;if(this.minValue!=undefined&&dt<min){dt=min}if(this.maxValue!=undefined&&dt>max){dt=max}return dt}});Ext.ux.form.Spinner.TimeStrategy=function(config){Ext.ux.form.Spinner.TimeStrategy.superclass.constructor.call(this,config)};Ext.extend(Ext.ux.form.Spinner.TimeStrategy,Ext.ux.form.Spinner.DateStrategy,{format:"H:i",incrementValue:1,incrementConstant:Date.MINUTE,alternateIncrementValue:1,alternateIncrementConstant:Date.HOUR});Ext.namespace("Ext.ux");Ext.ux.ColorPicker=Ext.extend(Ext.BoxComponent,{initComponent:function(){this.applyDefaultsCP();Ext.ux.ColorPicker.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorPicker.superclass.onRender.apply(this,arguments);this.body=this.body||(this.container||(this.renderTo||Ext.DomHelper.append(Ext.getBody(),{},true)));if(!this.el){this.el=this.body;if(this.cls){Ext.get(this.el).addClass(this.cls)}}this.renderComponent()},applyDefaultsCP:function(){Ext.apply(this,{cls:"x-cp-mainpanel",resizable:this.resizable||false,HSV:{h:0,s:0,v:0},updateMode:null})},renderComponent:function(){Ext.DomHelper.append(this.body,{id:this.cpGetId("rgb"),cls:"x-cp-rgbpicker"});Ext.DomHelper.append(this.body,{id:this.cpGetId("hue"),cls:"x-cp-huepicker"});this.huePicker=Ext.DomHelper.append(this.body,{cls:"x-cp-hueslider"});this.hueDD=new Ext.dd.DD(this.huePicker,"huePicker");this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:0,bottom:-7,left:0});this.hueDD.onDrag=this.moveHuePicker.createDelegate(this);Ext.get(this.cpGetId("hue")).on("mousedown",this.clickHUEPicker.createDelegate(this));Ext.get(this.huePicker).moveTo(Ext.get(this.cpGetId("hue")).getLeft()-7,Ext.get(this.cpGetId("hue")).getTop()-7);this.rgbPicker=Ext.DomHelper.append(this.body,{cls:"x-cp-rgbslider"});this.rgbDD=new Ext.dd.DD(this.rgbPicker,"rgbPicker");this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.rgbDD.onDrag=this.moveRGBPicker.createDelegate(this);Ext.get(this.cpGetId("rgb")).on("mousedown",this.clickRGBPicker.createDelegate(this));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()-7,Ext.get(this.cpGetId("rgb")).getTop()-7);var br_layout="column";if(Jedox.wss.app.browser=="ie"){br_layout="form"}this.formPanel=new Ext.form.FormPanel({renderTo:Ext.DomHelper.append(this.body,{id:this.cpGetId("fCont"),cls:"x-cp-formcontainer"},true),frame:true,labelAlign:"left",labelWidth:10,items:[{layout:br_layout,items:[{columnWidth:0.5,layout:"form",baseCls:"x-ie-inline",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:""},items:[{fieldLabel:"R",id:this.cpGetId("iRed")},{fieldLabel:"G",id:this.cpGetId("iGreen")},{fieldLabel:"B",id:this.cpGetId("iBlue")}]},{columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:""},items:[{fieldLabel:"H",maxValue:360,id:this.cpGetId("iHue")},{fieldLabel:"S",id:this.cpGetId("iSat")},{fieldLabel:"V",id:this.cpGetId("iVal")}]}]},{layout:"form",defaultType:"textfield",labelAlign:"left",defaults:{width:82,value:"000000",labelSeparator:"",allowBlank:false},id:this.cpGetId("cCont"),items:[{fieldLabel:"#",id:this.cpGetId("iHexa"),value:"000000"}]}]});Ext.getCmp(this.cpGetId("iRed")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iGreen")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iBlue")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iHue")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iSat")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iVal")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iHexa")).on("change",this.updateFromIHexa.createDelegate(this));Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cWebSafe")},true).update("Websafe");Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cInverse")},true).update("Inverse");Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cColor")},true).update("Color");Ext.get(this.cpGetId("cWebSafe")).on("click",this.updateFromBox.createDelegate(this));Ext.get(this.cpGetId("cInverse")).on("click",this.updateFromBox.createDelegate(this));Ext.DomHelper.append(this.body,{tag:"br",cls:"x-cp-clearfloat"})},cpGetId:function(postfix){return this.getId()+"__"+(postfix||"cp")},updateRGBPosition:function(x,y){this.updateMode="click";x=x<0?0:x;x=x>181?181:x;y=y<0?0:y;y=y>181?181:y;this.HSV.s=this.getSaturation(x);this.HSV.v=this.getValue(y);Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+x-7,Ext.get(this.cpGetId("rgb")).getTop()+y-7,(this.animateMove||true));this.updateColor()},updateHUEPosition:function(y){this.updateMode="click";y=y<1?1:y;y=y>181?181:y;this.HSV.h=Math.round(360/181*(181-y));Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+y-7,(this.animateMove||true));this.updateRGBPicker(this.HSV.h);this.updateColor()},clickRGBPicker:function(event,element){this.updateRGBPosition(event.xy[0]-Ext.get(this.cpGetId("rgb")).getLeft(),event.xy[1]-Ext.get(this.cpGetId("rgb")).getTop())},clickHUEPicker:function(event,element){this.updateHUEPosition(event.xy[1]-Ext.get(this.cpGetId("hue")).getTop())},moveRGBPicker:function(event){this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.updateRGBPosition(Ext.get(this.rgbPicker).getLeft()-Ext.get(this.cpGetId("rgb")).getLeft()+7,Ext.get(this.rgbPicker).getTop()-Ext.get(this.cpGetId("rgb")).getTop()+7)},moveHuePicker:function(event){this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:0,bottom:-7,left:0});this.updateHUEPosition(Ext.get(this.huePicker).getTop()-Ext.get(this.cpGetId("hue")).getTop()+7)},updateRGBPicker:function(newValue){this.updateMode="click";Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(newValue,1,1))});this.updateColor()},updateColor:function(){var rgb=this.hsvToRgb(this.HSV.h,this.HSV.s,this.HSV.v);var websafe=this.websafe(rgb);var invert=this.invert(rgb);var wsInvert=this.invert(websafe);if(this.updateMode!=="hexa"){Ext.getCmp(this.cpGetId("iHexa")).setValue(this.rgbToHex(rgb))}if(this.updateMode!=="rgb"){Ext.getCmp(this.cpGetId("iRed")).setValue(rgb[0]);Ext.getCmp(this.cpGetId("iGreen")).setValue(rgb[1]);Ext.getCmp(this.cpGetId("iBlue")).setValue(rgb[2])}if(this.updateMode!=="hsv"){Ext.getCmp(this.cpGetId("iHue")).setValue(Math.round(this.HSV.h));Ext.getCmp(this.cpGetId("iSat")).setValue(Math.round(this.HSV.s*100));Ext.getCmp(this.cpGetId("iVal")).setValue(Math.round(this.HSV.v*100))}Ext.get(this.cpGetId("cColor")).setStyle({background:"#"+this.rgbToHex(rgb),color:"#"+this.rgbToHex(invert)});Ext.getDom(this.cpGetId("cColor")).title="#"+this.rgbToHex(rgb);Ext.get(this.cpGetId("cInverse")).setStyle({background:"#"+this.rgbToHex(invert),color:"#"+this.rgbToHex(rgb)});Ext.getDom(this.cpGetId("cInverse")).title="#"+this.rgbToHex(invert);Ext.get(this.cpGetId("cWebSafe")).setStyle({background:"#"+this.rgbToHex(websafe),color:"#"+this.rgbToHex(wsInvert)});Ext.getDom(this.cpGetId("cWebSafe")).title="#"+this.rgbToHex(websafe);Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+this.getHPos(Ext.getCmp(this.cpGetId("iHue")).getValue())-7,(this.animateMove||true));Ext.get(this.rgbPicker).moveTo(this.getSPos(Ext.getCmp(this.cpGetId("iSat")).getValue()/100)+10,Ext.get(this.cpGetId("hue")).getTop()+this.getVPos(Ext.getCmp(this.cpGetId("iVal")).getValue()/100)-7,(this.animateMove||true));Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(Ext.getCmp(this.cpGetId("iHue")).getValue(),1,1))})},setColor:function(){},updateFromIRGB:function(input,newValue,oldValue){this.updateMode="rgb";var temp=this.rgbToHsv(Ext.getCmp(this.cpGetId("iRed")).getValue(),Ext.getCmp(this.cpGetId("iGreen")).getValue(),Ext.getCmp(this.cpGetId("iBlue")).getValue());this.HSV={h:temp[0],s:temp[1],v:temp[2]};this.updateColor()},updateFromIHSV:function(input,newValue,oldValue){this.updateMode="hsv";this.HSV={h:Ext.getCmp(this.cpGetId("iHue")).getValue(),s:Ext.getCmp(this.cpGetId("iSat")).getValue()/100,v:Ext.getCmp(this.cpGetId("iVal")).getValue()/100};this.updateColor()},updateFromIHexa:function(input,newValue,oldValue){this.updateMode="hexa";var temp=this.rgbToHsv(this.hexToRgb(Ext.getCmp(this.cpGetId("iHexa")).getValue()));this.HSV={h:temp[0],s:temp[1],v:temp[2]};this.updateColor()},updateFromBox:function(event,element){this.updateMode="click";var temp=this.rgbToHsv(this.hexToRgb(Ext.get(element).getColor("backgroundColor","","")));this.HSV={h:temp[0],s:temp[1],v:temp[2]};this.updateColor()},hsvToRgb:function(h,s,v){if(h instanceof Array){return this.hsvToRgb.call(this,h[0],h[1],h[2])}var r,g,b,i,f,p,q,t;i=Math.floor((h/60)%6);f=(h/60)-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break}return[this.realToDec(r),this.realToDec(g),this.realToDec(b)]},rgbToHsv:function(r,g,b){if(r instanceof Array){return this.rgbToHsv.call(this,r[0],r[1],r[2])}r=r/255;g=g/255;b=b/255;var min,max,delta,h,s,v;min=Math.min(Math.min(r,g),b);max=Math.max(Math.max(r,g),b);delta=max-min;switch(max){case min:h=0;break;case r:h=60*(g-b)/delta;if(g<b){h+=360}break;case g:h=(60*(b-r)/delta)+120;break;case b:h=(60*(r-g)/delta)+240;break}s=(max===0)?0:1-(min/max);return[Math.round(h),s,max]},realToDec:function(n){return Math.min(255,Math.round(n*256))},rgbToHex:function(r,g,b){if(r instanceof Array){return this.rgbToHex.call(this,r[0],r[1],r[2])}return this.decToHex(r)+this.decToHex(g)+this.decToHex(b)},decToHex:function(n){var HCHARS="0123456789ABCDEF";n=parseInt(n,10);n=(!isNaN(n))?n:0;n=(n>255||n<0)?0:n;return HCHARS.charAt((n-n%16)/16)+HCHARS.charAt(n%16)},getHCharPos:function(c){var HCHARS="0123456789ABCDEF";return HCHARS.indexOf(c.toUpperCase())},hexToDec:function(hex){var s=hex.split("");return((this.getHCharPos(s[0])*16)+this.getHCharPos(s[1]))},hexToRgb:function(hex){return[this.hexToDec(hex.substr(0,2)),this.hexToDec(hex.substr(2,2)),this.hexToDec(hex.substr(4,2))]},getHue:function(y){var hue=360-Math.round(((181-y)/181)*360);return hue===360?0:hue},getHPos:function(hue){return 181-hue*(181/360)},getSaturation:function(x){return x/181},getSPos:function(saturation){return saturation*181},getValue:function(y){return(181-y)/181},getVPos:function(value){return 181-(value*181)},checkSafeNumber:function(v){if(!isNaN(v)){v=Math.min(Math.max(0,v),255);var i,next;for(i=0;i<256;i=i+51){next=i+51;if(v>=i&&v<=next){return(v-i>25)?next:i}}}return v},websafe:function(r,g,b){if(r instanceof Array){return this.websafe.call(this,r[0],r[1],r[2])}return[this.checkSafeNumber(r),this.checkSafeNumber(g),this.checkSafeNumber(b)]},invert:function(r,g,b){if(r instanceof Array){return this.invert.call(this,r[0],r[1],r[2])}return[255-r,255-g,255-b]}});Ext.ux.ColorDialog=Ext.extend(Ext.Window,{initComponent:function(){this.width=(!this.width||this.width<353)?353:this.width;this.applyDefaultsCP();Ext.ux.ColorDialog.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorDialog.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype);Ext.ux.ColorPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.width=(!this.width||this.width<300)?300:this.width;this.applyDefaultsCP();Ext.ux.ColorPanel.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorPanel.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype);Ext.reg("colorpicker",Ext.ux.ColorPicker);Ext.reg("colordialog",Ext.ux.ColorDialog);Ext.reg("colorpanel",Ext.ux.ColorPanel);Ext.ux.IconCombo=Ext.extend(Ext.form.ComboBox,{initComponent:function(){Ext.apply(this,{tpl:'<tpl for="."><div class="x-combo-list-item ux-icon-combo-item {'+this.iconClsField+'}">{'+this.displayField+"}</div></tpl>"});Ext.ux.IconCombo.superclass.initComponent.call(this)},onRender:function(ct,position){Ext.ux.IconCombo.superclass.onRender.call(this,ct,position);this.wrap.applyStyles({position:"relative"});this.el.addClass("ux-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute"})},setIconCls:function(){var rec=this.store.query(this.valueField,this.getValue()).itemAt(0);if(rec){this.icon.className="ux-icon-combo-icon "+rec.get(this.iconClsField)+" selected"}},setValue:function(value){Ext.ux.IconCombo.superclass.setValue.call(this,value);this.setIconCls()}});Ext.reg("iconcombo",Ext.ux.IconCombo);Ext.ux.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(ct,position){Ext.ux.FileUploadField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:"x-form-file-btn"+(btnCfg.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.fileInput.on("change",function(){var v=this.fileInput.dom.value;if(Ext.isIE){v=v.replace("C:\\fakepath\\","")}this.setValue(v);this.fireEvent("fileselected",this,v)},this)},getFileInputId:function(){return this.id+"-file"},onResize:function(w,h){Ext.ux.FileUploadField.superclass.onResize.call(this,w,h);this.wrap.setWidth(w);if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(w)}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.ux.FileUploadField);Ext.ux.clone=function(o){if(!o||"object"!==typeof o){return o}var c="function"===typeof o.pop?[]:{};var p,v;for(p in o){if(o.hasOwnProperty(p)){v=o[p];if(v&&"object"===typeof v){c[p]=Ext.ux.clone(v)}else{c[p]=v}}}return c};Ext.DataView.LabelEditor=function(cfg,field){Ext.DataView.LabelEditor.superclass.constructor.call(this,field||new Ext.form.TextField({allowBlank:false,growMin:90,growMax:240,grow:true,selectOnFocus:true}),cfg)};Ext.extend(Ext.DataView.LabelEditor,Ext.Editor,{alignment:"tl-tl",hideEl:false,cls:"x-small-editor",shim:false,completeOnEnter:true,cancelOnEsc:true,labelSelector:"span.x-editable",init:function(view){this.view=view;view.on("render",this.initEditor,this);this.on("complete",this.onSave,this)},initEditor:function(){this.view.getEl().on("mousedown",this.onMouseDown,this,{delegate:this.labelSelector})},onMouseDown:function(e,target){if(!e.ctrlKey&&!e.shiftKey){var item=this.view.findItemFromChild(target);e.stopEvent();var record=this.view.store.getAt(this.view.indexOf(item));this.startEdit(target,record.data[this.dataIndex]);this.activeRecord=record}else{e.preventDefault()}},onSave:function(ed,value){this.activeRecord.set(this.dataIndex,value)}});Ext.DataView.DragSelector=function(cfg){cfg=cfg||{};var view,regions,proxy,tracker;var rs,bodyRegion,dragRegion=new Ext.lib.Region(0,0,0,0);var dragSafe=cfg.dragSafe===true;this.init=function(dataView){view=dataView;view.on("render",onRender)};function fillRegions(){rs=[];view.all.each(function(el){rs[rs.length]=el.getRegion()});bodyRegion=view.el.getRegion()}function cancelClick(){return false}function onBeforeStart(e){return !dragSafe||e.target==view.el.dom}function onStart(e){view.on("containerclick",cancelClick,view,{single:true});if(!proxy){proxy=view.el.createChild({cls:"x-view-selector"})}else{proxy.setDisplayed("block")}fillRegions();view.clearSelections()}function onDrag(e){var startXY=tracker.startXY;var xy=tracker.getXY();var x=Math.min(startXY[0],xy[0]);var y=Math.min(startXY[1],xy[1]);var w=Math.abs(startXY[0]-xy[0]);var h=Math.abs(startXY[1]-xy[1]);dragRegion.left=x;dragRegion.top=y;dragRegion.right=x+w;dragRegion.bottom=y+h;dragRegion.constrainTo(bodyRegion);proxy.setRegion(dragRegion);for(var i=0,len=rs.length;i<len;i++){var r=rs[i],sel=dragRegion.intersect(r);if(sel&&!r.selected){r.selected=true;view.select(i,true)}else{if(!sel&&r.selected){r.selected=false;view.deselect(i)}}}}function onEnd(e){if(proxy){proxy.setDisplayed(false)}}function onRender(view){tracker=new Ext.dd.DragTracker({onBeforeStart:onBeforeStart,onStart:onStart,onDrag:onDrag,onEnd:onEnd});tracker.initEl(view.el)}};Ext.tree.TreeNodeProvider=function(cfg){this.data=[];Ext.apply(this,cfg);if(!this.getNodes||(typeof this.getNodes!="function")){throw'!this.getNodes || typeof this.getNodes != "function"'}this.setData=function(t_data){this.data=t_data};this.getData=function(){return this.data}};Ext.tree.MyTreeLoader=function(config){var canFireLoadEvent=true;var treeNodeProvider=null;var loading=false;Ext.apply(this,config);Ext.tree.MyTreeLoader.superclass.constructor.call(this,config);treeNodeProvider=this.treeNodeProvider;var processResponse=function(o,node,callback){try{node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate()}catch(e){canFireLoadEvent=false;this.fireEvent("loadexception",this,node,treeNodeProvider.data)}if(typeof callback=="function"){callback()}if(canFireLoadEvent===true){this.fireEvent("load",this,node,treeNodeProvider.data)}}.createDelegate(this);var requestData=function(node,callback){if(this.fireEvent("beforeload",this,node,callback)!==false){loading=true;var nodesToAdd=null;try{nodesToAdd=treeNodeProvider.getNodes(treeNodeProvider.data)}catch(e){canFireLoadEvent=false;this.fireEvent("loadexception",this,node,treeNodeProvider.data)}if(typeof nodesToAdd!="undefined"&&nodesToAdd!=null){processResponse(nodesToAdd,node,callback)}loading=false}else{canFireLoadEvent=false}}.createDelegate(this);this.load=function(node,callback){canFireLoadEvent=true;if(this.clearOnLoad){while(node.firstChild){var tmpNode=node.firstChild;node.removeChild(tmpNode);tmpNode.destroy()}}if(this.doPreload(node)){if(typeof callback=="function"){callback()}}else{if(treeNodeProvider){requestData(node,callback)}}};this.isLoading=function(){return loading};this.updateTreeNodeProvider=function(obj){if(treeNodeProvider){treeNodeProvider.setData(obj)}};this.getTreeNodeProvider=function(){return treeNodeProvider};this.setTreeNodeProvider=function(newTreeNodeProvider){if(newTreeNodeProvider==null||(typeof newTreeNodeProvider=="undefined")){throw"setTreeNodeProvider, newTreeNodeProvider == null || (typeof newTreeNodeProvider == undefined)"}treeNodeProvider=newTreeNodeProvider}};Ext.tree.MyTreeLoader=Ext.extend(Ext.tree.MyTreeLoader,Ext.tree.TreeLoader);
/*
 * Ext JS Library 3.0+
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","validateedit","afteredit")},init:function(grid){this.grid=grid;this.ownerCt=grid;if(this.clicksToEdit===2){grid.on("rowdblclick",this.onRowDblClick,this)}else{grid.on("rowclick",this.onRowClick,this);if(Ext.isIE){grid.on("rowdblclick",this.onRowDblClick,this)}}grid.getStore().on("remove",function(){this.stopEditing(false)},this);grid.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});grid.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});grid.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var dirty;this.items.each(function(f){if(String(this.values[f.id])!==String(f.getValue())){dirty=true;return false}},this);return dirty},startEditing:function(rowIndex,doFocus){if(this.editing&&this.isDirty()){this.showTooltip("You need to commit or cancel your changes");return}if(Ext.isObject(rowIndex)){rowIndex=this.grid.getStore().indexOf(rowIndex)}if(this.fireEvent("beforeedit",this,rowIndex)!==false){this.editing=true;var g=this.grid,view=g.getView();var row=view.getRow(rowIndex);var record=g.store.getAt(rowIndex);this.record=record;this.rowIndex=rowIndex;this.values={};if(!this.rendered){this.render(view.getEditorParent())}var w=Ext.fly(row).getWidth();this.setSize(w);if(!this.initialized){this.initFields()}var cm=g.getColumnModel(),fields=this.items.items,f,val;for(var i=0,len=cm.getColumnCount();i<len;i++){val=this.preEditValue(record,cm.getDataIndex(i));f=fields[i];f.setValue(val);this.values[f.id]=Ext.isEmpty(val)?"":val}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(row).getXY())}else{this.el.setXY(Ext.fly(row).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(doFocus!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(saveChanges){this.editing=false;if(!this.isVisible()){return}if(saveChanges===false||!this.isValid()){this.hide();return}var changes={},r=this.record,hasChange=false;var cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var dindex=cm.getDataIndex(i);if(!Ext.isEmpty(dindex)){var oldValue=r.data[dindex];var value=this.postEditValue(fields[i].getValue(),oldValue,r,dindex);if(String(oldValue)!==String(value)){changes[dindex]=value;hasChange=true}}}}if(hasChange&&this.fireEvent("validateedit",this,changes,r,this.rowIndex)!==false){r.beginEdit();for(var k in changes){if(changes.hasOwnProperty(k)){r.set(k,changes[k])}}r.endEdit();this.fireEvent("afteredit",this,changes,r,this.rowIndex)}this.hide()},verifyLayout:function(force){if(this.el&&(this.isVisible()||force===true)){var row=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(row).getWidth(),undefined);var cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var adjust=0;if(i===(len-1)){adjust+=3}else{adjust+=1}fields[i].show();fields[i].setWidth(cm.getColumnWidth(i)-adjust)}else{fields[i].hide()}}this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var cm=this.grid.getColumnModel(),pm=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var i=0,len=cm.getColumnCount();i<len;i++){var c=cm.getColumnAt(i);var ed=c.getEditor();if(!ed){ed=c.displayEditor||new Ext.form.DisplayField()}if(i==0){ed.margins=pm("0 1 2 1")}else{if(i==len-1){ed.margins=pm("0 0 2 1")}else{ed.margins=pm("0 1 2")}}ed.setWidth(cm.getColumnWidth(i));ed.column=c;if(ed.ownerCt!==this){ed.on("focus",this.ensureVisible,this);ed.on("specialkey",this.onKey,this)}this.insert(i,ed)}this.initialized=true},onKey:function(f,e){if(e.getKey()===e.ENTER){this.stopEditing(true);e.stopPropagation()}},onGridKey:function(e){if(e.getKey()===e.ENTER&&!this.isVisible()){var r=this.grid.getSelectionModel().getSelected();if(r){var index=this.grid.store.indexOf(r);this.startEditing(index);e.stopPropagation()}}},ensureVisible:function(editor){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(editor.column.id),true)}},onRowClick:function(g,rowIndex,e){if(this.clicksToEdit=="auto"){var li=this.lastClickIndex;this.lastClickIndex=rowIndex;if(li!=rowIndex&&!this.isVisible()){return}}this.startEditing(rowIndex,false);this.doFocus.defer(this.focusDelay,this,[e.getPoint()])},onRowDblClick:function(g,rowIndex,e){this.startEditing(rowIndex,false);this.doFocus.defer(this.focusDelay,this,[e.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText||"Save",width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText||"Cancel",width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments);this.verifyLayout(true)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var h=this.el.dom.clientHeight;var view=this.grid.getView();var scroll=view.scroller.dom.scrollLeft;var width=view.mainBody.getWidth();var bw=this.btns.getWidth();this.btns.el.shift({left:(width/2)-(bw/2)+scroll,top:h-2,stopFx:true,duration:0.2})}},preEditValue:function(r,field){var value=r.data[field];return this.autoEncode&&typeof value==="string"?Ext.util.Format.htmlDecode(value):value},postEditValue:function(value,originalValue,r,field){return this.autoEncode&&typeof value=="string"?Ext.util.Format.htmlEncode(value):value},doFocus:function(pt){if(this.isVisible()){var index=0;if(pt){index=this.getTargetColumnIndex(pt)}var cm=this.grid.getColumnModel();for(var i=index||0,len=cm.getColumnCount();i<len;i++){var c=cm.getColumnAt(i);if(!c.hidden&&c.getEditor()){c.getEditor().focus();break}}}},getTargetColumnIndex:function(pt){var grid=this.grid,v=grid.view;var x=pt.left;var cms=grid.colModel.config;var i=0,match=false;for(var len=cms.length,c;c=cms[i];i++){if(!c.hidden){if(Ext.fly(v.getHeaderCell(i)).getRegion().right>=x){match=i;break}}}return match},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var valid=true;this.items.each(function(f){if(!f.isValid(true)){valid=false;return false}});return valid},bindHandler:function(){if(!this.bound){return false}var valid=this.isValid();if(!valid&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!valid);this.fireEvent("validation",this,valid)},showTooltip:function(msg){var t=this.tooltip;if(!t){t=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:"Errors",autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var v=this.grid.getView(),top=parseInt(this.el.dom.style.top,10),scroll=v.scroller.dom.scrollTop,h=this.el.getHeight();if(top+h>=scroll){t.initTarget(this.items.last().getEl());if(!t.rendered){t.show();t.hide()}t.body.update(msg);t.doAutoWidth();t.show()}else{if(t.rendered){t.hide()}}},getErrorText:function(){var data=["<ul>"];this.items.each(function(f){if(!f.isValid(true)){data.push("<li>",f.activeError,"</li>")}});data.push("</ul>");return data}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);Ext.override(Ext.form.Field,{markInvalid:function(msg){if(!this.rendered||this.preventMark){return}msg=msg||this.invalidText;var mt=this.getMessageHandler();if(mt){mt.mark(this,msg)}else{if(this.msgTarget){this.el.addClass(this.invalidClass);var t=Ext.getDom(this.msgTarget);if(t){t.innerHTML=msg;t.style.display=this.msgDisplay}}}this.activeError=msg;this.fireEvent("invalid",this,msg)}});Ext.override(Ext.ux.grid.RowEditor,{showTooltip:function(msg){var t=this.tooltip;if(!t){t=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0],doAutoWidth:function(adjust){var bw=this.body.getTextWidth();if(this.title){bw=Math.max(bw,this.header.child("span").getTextWidth(this.title))}bw+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding("lr")+(adjust||0);this.setWidth(bw.constrain(this.minWidth,this.maxWidth));if(Ext.isIE7&&!this.repainted){this.el.repaint();this.repainted=true}}})}var v=this.grid.getView(),top=parseInt(this.el.dom.style.top,10),scroll=v.scroller.dom.scrollTop,h=this.el.getHeight();if(top+h>=scroll){t.initTarget(this.items.last().getEl());if(!t.rendered){t.show();t.hide()}t.body.update(msg);t.doAutoWidth(20);t.show()}else{if(t.rendered){t.hide()}}}});Ext.form.Button=function(config){Ext.form.Field.superclass.constructor.call(this,config)};Ext.extend(Ext.form.Button,Ext.form.Field,{autoWidth:function(){if(this.el){this.el.setWidth("auto");if(Ext.isIE7&&Ext.isStrict){var ib=this.el.child("button");if(ib&&ib.getWidth()>20){ib.clip();ib.setWidth(Ext.util.TextMetrics.measure(ib,this.text).width+ib.getFrameWidth("lr"))}}if(this.minWidth){if(this.hidden){this.el.beginMeasure()}if(this.el.getWidth()<this.minWidth){this.el.setWidth(this.minWidth)}if(this.hidden){this.el.endMeasure()}}}},onClick:function(e){if(e){e.preventDefault()}if(!this.disabled){if(this.enableToggle){this.toggle()}if(this.menu&&!this.menu.isVisible()){this.menu.show(this.el,this.menuAlign)}this.fireEvent("click",this,e);if(this.handler){this.el.removeClass("x-btn-over");this.handler.call(this.scope||this,this,e)}}},onMouseOver:function(e){if(!this.disabled){this.el.addClass("x-btn-over");this.fireEvent("mouseover",this,e)}},onMouseOut:function(e){if(!e.within(this.el,true)){this.el.removeClass("x-btn-over");this.fireEvent("mouseout",this,e)}},onMouseDown:function(){if(!this.disabled){this.el.addClass("x-btn-click");Ext.get(document).on("mouseup",this.onMouseUp,this)}},onMouseUp:function(){this.el.removeClass("x-btn-click");Ext.get(document).un("mouseup",this.onMouseUp,this)},onMenuShow:function(e){this.el.addClass("x-btn-menu-active")},onMenuHide:function(e){this.el.removeClass("x-btn-menu-active")},onRender:function(ct){if(!Ext.form.Button.buttonTemplate){Ext.form.Button.buttonTemplate=new Ext.Template('<table border="0" cellpadding="0" cellspacing="0" class="x-btn-wrap"><tbody><tr>','<td class="x-btn-left"><i>&#160;</i></td><td class="x-btn-center"><em><button class="x-btn-text">{0}</button></em></td><td class="x-btn-right"><i>&#160;</i></td><td style="padding-left:4px"></td>',"</tr></tbody></table>")}this.template=Ext.form.Button.buttonTemplate;btn=this.template.append(ct,[this.text||"&#160;"],true);this.el=btn;var btnEl=btn.child("button:first");if(this.cls){btn.addClass(this.cls)}if(this.icon){btnEl.setStyle("background-image","url("+this.icon+")")}if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.tips(Ext.apply({target:btnEl.id},this.tooltip))}else{btnEl.dom[this.tooltipType]=this.tooltip}}if(this.descriptionText){btn.insertHtml("beforeBegin",this.descriptionText)}if(this.id){this.el.dom.id=this.el.id=this.id}if(this.menu){this.el.child(this.menuClassTarget).addClass("x-btn-with-menu");this.menu.on("show",Ext.Button.onMenuShow,this);this.menu.on("hide",Ext.Button.onMenuHide,this)}btn.addClass("x-btn");if(Ext.isIE&&!Ext.isIE7){this.autoWidth.defer(1,this)}else{this.autoWidth()}btn.on("click",this.onClick,this);btn.on("mouseover",this.onMouseOver,this);btn.on("mouseout",this.onMouseOut,this);btn.on("mousedown",this.onMouseDown,this);if(this.hidden){this.hide()}if(this.disabled){this.disable()}Ext.ButtonToggleMgr.register(this);if(this.pressed){this.el.addClass("x-btn-pressed")}if(this.repeat){var repeater=new Ext.util.ClickRepeater(btn,typeof this.repeat=="object"?this.repeat:{});repeater.on("click",this.onClick,this)}}});Ext.namespace("Ext.ux","Ext.ux.form");Ext.ux.form.TriCheckbox=Ext.extend(Ext.form.Checkbox,{values:[null,false,true],checkedCls:["x-checkbox-grayed",null,"x-checkbox-checked"],defaultAutoCreate:{tag:"input",type:"hidden",autocomplete:"off"},cbFocusCls:"x-checkbox-focus",cbOverCls:"x-checkbox-over",cbDownCls:"x-checkbox-down",onRender:function(ct,position){Ext.form.Checkbox.superclass.onRender.call(this,ct,position);this.innerWrap=this.el.wrap({tabIndex:this.tabIndex,cls:this.baseCls+"-wrap-inner"});this.wrap=this.innerWrap.wrap({cls:this.baseCls+"-wrap"});if(this.boxLabel){this.labelEl=this.innerWrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})}this.imageEl=this.innerWrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-checkbox"},this.el);if((typeof this.value=="object"&&this.value===null)||this.value===true){this.setValue(this.value)}else{this.setValue(false)}this.originalValue=this.value},getValue:function(){return Ext.form.Checkbox.superclass.getValue.call(this)},getRawValue:function(){return Ext.form.Checkbox.superclass.getRawValue.call(this)},setValue:function(v){if(!(typeof v=="object"&&v===null)&&v!==true){v=false}Ext.form.Checkbox.superclass.setValue.call(this,v);this.updateCheckCls();this.fireEvent("check",this,v)},getCheckIndex:function(){for(var i=0;i<this.values.length;i++){if(this.value===this.values[i]){return i}}return 0},updateCheckCls:function(){if(!this.wrap){return}var cls=this.checkedCls[this.getCheckIndex()];this.wrap.replaceClass(this._checkCls,cls);this._checkCls=cls},check:function(){if(!this.disabled&&!this.readOnly){this.setValue(this.values[(this.getCheckIndex()+1)%this.values.length])}},afterRender:function(){Ext.form.Checkbox.superclass.afterRender.call(this)},initEvents:function(){Ext.ux.form.TriCheckbox.superclass.initEvents.call(this);this.imageEl.on("click",this.check,this);this.mon(this.el,{scope:this,click:this.check,change:this.check})},initComponent:function(){Ext.form.Checkbox.superclass.initComponent.call(this);this.addEvents("check")}});Ext.reg("tri-checkbox",Ext.ux.form.TriCheckbox);if(Ext.isGecko){Ext.override(Ext.form.ComboBox,{expand:function(combo){if(this.isExpanded()||!this.hasFocus){return}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize}this.list.alignTo(this.wrap,this.listAlign);this.list.show();if(Ext.isGecko2){this.innerList.setOverflow("auto")}Ext.getDoc().on({scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this);var blurField=function(el){el.blur()};blurField.defer(1,this,[this.el])},collapse:function(combo){if(!this.isExpanded()){return}this.list.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this);var blurField=function(el){el.blur()};blurField.defer(1,this,[this.el])}})}Ext.override(Ext.data.Node,{findChild:function(attribute,value,deep){var cs=this.childNodes,res,n;for(var i=0,len=cs.length;i<len;i++){n=cs[i];if(n.attributes[attribute]==value){return n}else{if(deep){res=n.findChild(attribute,value,deep);if(res!=null){return res}}}}return null},findChildBy:function(fn,scope,deep){var cs=this.childNodes,res,n;for(var i=0,len=cs.length;i<len;i++){n=cs[i];if(fn.call(scope||n,n)===true){return n}else{if(deep){res=n.findChildBy(fn,scope,deep);if(res!=null){return res}}}}return null}});if(!("console" in window)||!("firebug" in console)){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=function(){}}}if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={}}YAHOO.namespace=function(){var A=arguments,E=null,C,B,D;for(C=0;C<A.length;C=C+1){D=(""+A[C]).split(".");E=YAHOO;for(B=(D[0]=="YAHOO")?1:0;B<D.length;B=B+1){E[D[B]]=E[D[B]]||{};E=E[D[B]]}}return E};YAHOO.log=function(D,A,C){var B=YAHOO.widget.Logger;if(B&&B.log){return B.log(D,A,C)}else{return false}};YAHOO.register=function(A,E,D){var I=YAHOO.env.modules,B,H,G,F,C;if(!I[A]){I[A]={versions:[],builds:[]}}B=I[A];H=D.version;G=D.build;F=YAHOO.env.listeners;B.name=A;B.version=H;B.build=G;B.versions.push(H);B.builds.push(G);B.mainClass=E;for(C=0;C<F.length;C=C+1){F[C](B)}if(E){E.VERSION=H;E.BUILD=G}else{YAHOO.log("mainClass is undefined for module "+A,"warn")}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(A){return YAHOO.env.modules[A]||null};YAHOO.env.ua=function(){var D=function(H){var I=0;return parseFloat(H.replace(/\./g,function(){return(I++==1)?"":"."}))},G=navigator,F={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,caja:G.cajaVersion,secure:false,os:null},C=navigator&&navigator.userAgent,E=window&&window.location,B=E&&E.href,A;F.secure=B&&(B.toLowerCase().indexOf("https")===0);if(C){if((/windows|win32/i).test(C)){F.os="windows"}else{if((/macintosh/i).test(C)){F.os="macintosh"}}if((/KHTML/).test(C)){F.webkit=1}A=C.match(/AppleWebKit\/([^\s]*)/);if(A&&A[1]){F.webkit=D(A[1]);if(/ Mobile\//.test(C)){F.mobile="Apple"}else{A=C.match(/NokiaN[^\/]*/);if(A){F.mobile=A[0]}}A=C.match(/AdobeAIR\/([^\s]*)/);if(A){F.air=A[0]}}if(!F.webkit){A=C.match(/Opera[\s\/]([^\s]*)/);if(A&&A[1]){F.opera=D(A[1]);A=C.match(/Opera Mini[^;]*/);if(A){F.mobile=A[0]}}else{A=C.match(/MSIE\s([^;]*)/);if(A&&A[1]){F.ie=D(A[1])}else{A=C.match(/Gecko\/([^\s]*)/);if(A){F.gecko=1;A=C.match(/rv:([^\s\)]*)/);if(A&&A[1]){F.gecko=D(A[1])}}}}}}return F}();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var B=YAHOO_config.listener,A=YAHOO.env.listeners,D=true,C;if(B){for(C=0;C<A.length;C++){if(A[C]==B){D=false;break}}if(D){A.push(B)}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var B=YAHOO.lang,A=Object.prototype,H="[object Array]",C="[object Function]",G="[object Object]",E=[],F=["toString","valueOf"],D={isArray:function(I){return A.toString.apply(I)===H},isBoolean:function(I){return typeof I==="boolean"},isFunction:function(I){return(typeof I==="function")||A.toString.apply(I)===C},isNull:function(I){return I===null},isNumber:function(I){return typeof I==="number"&&isFinite(I)},isObject:function(I){return(I&&(typeof I==="object"||B.isFunction(I)))||false},isString:function(I){return typeof I==="string"},isUndefined:function(I){return typeof I==="undefined"},_IEEnumFix:(YAHOO.env.ua.ie)?function(K,J){var I,M,L;for(I=0;I<F.length;I=I+1){M=F[I];L=J[M];if(B.isFunction(L)&&L!=A[M]){K[M]=L}}}:function(){},extend:function(L,M,K){if(!M||!L){throw new Error("extend failed, please check that all dependencies are included.")}var J=function(){},I;J.prototype=M.prototype;L.prototype=new J();L.prototype.constructor=L;L.superclass=M.prototype;if(M.prototype.constructor==A.constructor){M.prototype.constructor=M}if(K){for(I in K){if(B.hasOwnProperty(K,I)){L.prototype[I]=K[I]}}B._IEEnumFix(L.prototype,K)}},augmentObject:function(M,L){if(!L||!M){throw new Error("Absorb failed, verify dependencies.")}var I=arguments,K,N,J=I[2];if(J&&J!==true){for(K=2;K<I.length;K=K+1){M[I[K]]=L[I[K]]}}else{for(N in L){if(J||!(N in M)){M[N]=L[N]}}B._IEEnumFix(M,L)}},augmentProto:function(L,K){if(!K||!L){throw new Error("Augment failed, verify dependencies.")}var I=[L.prototype,K.prototype],J;for(J=2;J<arguments.length;J=J+1){I.push(arguments[J])}B.augmentObject.apply(this,I)},dump:function(I,N){var K,M,P=[],Q="{...}",J="f(){...}",O=", ",L=" => ";if(!B.isObject(I)){return I+""}else{if(I instanceof Date||("nodeType" in I&&"tagName" in I)){return I}else{if(B.isFunction(I)){return J}}}N=(B.isNumber(N))?N:3;if(B.isArray(I)){P.push("[");for(K=0,M=I.length;K<M;K=K+1){if(B.isObject(I[K])){P.push((N>0)?B.dump(I[K],N-1):Q)}else{P.push(I[K])}P.push(O)}if(P.length>1){P.pop()}P.push("]")}else{P.push("{");for(K in I){if(B.hasOwnProperty(I,K)){P.push(K+L);if(B.isObject(I[K])){P.push((N>0)?B.dump(I[K],N-1):Q)}else{P.push(I[K])}P.push(O)}}if(P.length>1){P.pop()}P.push("}")}return P.join("")},substitute:function(Y,J,R){var N,M,L,U,V,X,T=[],K,O="dump",S=" ",I="{",W="}",Q,P;for(;;){N=Y.lastIndexOf(I);if(N<0){break}M=Y.indexOf(W,N);if(N+1>=M){break}K=Y.substring(N+1,M);U=K;X=null;L=U.indexOf(S);if(L>-1){X=U.substring(L+1);U=U.substring(0,L)}V=J[U];if(R){V=R(U,V,X)}if(B.isObject(V)){if(B.isArray(V)){V=B.dump(V,parseInt(X,10))}else{X=X||"";Q=X.indexOf(O);if(Q>-1){X=X.substring(4)}P=V.toString();if(P===G||Q>-1){V=B.dump(V,parseInt(X,10))}else{V=P}}}else{if(!B.isString(V)&&!B.isNumber(V)){V="~-"+T.length+"-~";T[T.length]=K}}Y=Y.substring(0,N)+V+Y.substring(M+1)}for(N=T.length-1;N>=0;N=N-1){Y=Y.replace(new RegExp("~-"+N+"-~"),"{"+T[N]+"}","g")}return Y},trim:function(I){try{return I.replace(/^\s+|\s+$/g,"")}catch(J){return I}},merge:function(){var L={},J=arguments,I=J.length,K;for(K=0;K<I;K=K+1){B.augmentObject(L,J[K],true)}return L},later:function(P,J,Q,L,M){P=P||0;J=J||{};var K=Q,O=L,N,I;if(B.isString(Q)){K=J[Q]}if(!K){throw new TypeError("method undefined")}if(O&&!B.isArray(O)){O=[L]}N=function(){K.apply(J,O||E)};I=(M)?setInterval(N,P):setTimeout(N,P);return{interval:M,cancel:function(){if(this.interval){clearInterval(I)}else{clearTimeout(I)}}}},isValue:function(I){return(B.isObject(I)||B.isString(I)||B.isNumber(I)||B.isBoolean(I))}};B.hasOwnProperty=(A.hasOwnProperty)?function(I,J){return I&&I.hasOwnProperty(J)}:function(I,J){return !B.isUndefined(I[J])&&I.constructor.prototype[J]!==I[J]};D.augmentObject(B,D,true);YAHOO.util.Lang=B;B.augment=B.augmentProto;YAHOO.augment=B.augmentProto;YAHOO.extend=B.extend})();YAHOO.register("yahoo",YAHOO,{version:"2.8.0r4",build:"2446"});(function(){YAHOO.env._id_counter=YAHOO.env._id_counter||0;var E=YAHOO.util,L=YAHOO.lang,m=YAHOO.env.ua,A=YAHOO.lang.trim,d={},h={},N=/^t(?:able|d|h)$/i,X=/color$/i,K=window.document,W=K.documentElement,e="ownerDocument",n="defaultView",v="documentElement",t="compatMode",b="offsetLeft",P="offsetTop",u="offsetParent",Z="parentNode",l="nodeType",C="tagName",O="scrollLeft",i="scrollTop",Q="getBoundingClientRect",w="getComputedStyle",a="currentStyle",M="CSS1Compat",c="BackCompat",g="class",F="className",J="",B=" ",s="(?:^|\\s)",k="(?= |$)",U="g",p="position",f="fixed",V="relative",j="left",o="top",r="medium",q="borderLeftWidth",R="borderTopWidth",D=m.opera,I=m.webkit,H=m.gecko,T=m.ie;E.Dom={CUSTOM_ATTRIBUTES:(!W.hasAttribute)?{"for":"htmlFor","class":F}:{htmlFor:"for",className:g},DOT_ATTRIBUTES:{},get:function(z){var AB,x,AA,y,Y,G;if(z){if(z[l]||z.item){return z}if(typeof z==="string"){AB=z;z=K.getElementById(z);G=(z)?z.attributes:null;if(z&&G&&G.id&&G.id.value===AB){return z}else{if(z&&K.all){z=null;x=K.all[AB];for(y=0,Y=x.length;y<Y;++y){if(x[y].id===AB){return x[y]}}}}return z}if(YAHOO.util.Element&&z instanceof YAHOO.util.Element){z=z.get("element")}if("length" in z){AA=[];for(y=0,Y=z.length;y<Y;++y){AA[AA.length]=E.Dom.get(z[y])}return AA}return z}return null},getComputedStyle:function(G,Y){if(window[w]){return G[e][n][w](G,null)[Y]}else{if(G[a]){return E.Dom.IE_ComputedStyle.get(G,Y)}}},getStyle:function(G,Y){return E.Dom.batch(G,E.Dom._getStyle,Y)},_getStyle:function(){if(window[w]){return function(G,y){y=(y==="float")?y="cssFloat":E.Dom._toCamel(y);var x=G.style[y],Y;if(!x){Y=G[e][n][w](G,null);if(Y){x=Y[y]}}return x}}else{if(W[a]){return function(G,y){var x;switch(y){case"opacity":x=100;try{x=G.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(z){try{x=G.filters("alpha").opacity}catch(Y){}}return x/100;case"float":y="styleFloat";default:y=E.Dom._toCamel(y);x=G[a]?G[a][y]:null;return(G.style[y]||x)}}}}}(),setStyle:function(G,Y,x){E.Dom.batch(G,E.Dom._setStyle,{prop:Y,val:x})},_setStyle:function(){if(T){return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){switch(x){case"opacity":if(L.isString(Y.style.filter)){Y.style.filter="alpha(opacity="+y*100+")";if(!Y[a]||!Y[a].hasLayout){Y.style.zoom=1}}break;case"float":x="styleFloat";default:Y.style[x]=y}}else{}}}else{return function(Y,G){var x=E.Dom._toCamel(G.prop),y=G.val;if(Y){if(x=="float"){x="cssFloat"}Y.style[x]=y}else{}}}}(),getXY:function(G){return E.Dom.batch(G,E.Dom._getXY)},_canPosition:function(G){return(E.Dom._getStyle(G,"display")!=="none"&&E.Dom._inDoc(G))},_getXY:function(){if(K[v][Q]){return function(y){var z,Y,AA,AF,AE,AD,AC,G,x,AB=Math.floor,AG=false;if(E.Dom._canPosition(y)){AA=y[Q]();AF=y[e];z=E.Dom.getDocumentScrollLeft(AF);Y=E.Dom.getDocumentScrollTop(AF);AG=[AB(AA[j]),AB(AA[o])];if(T&&m.ie<8){AE=2;AD=2;AC=AF[t];if(m.ie===6){if(AC!==c){AE=0;AD=0}}if((AC===c)){G=S(AF[v],q);x=S(AF[v],R);if(G!==r){AE=parseInt(G,10)}if(x!==r){AD=parseInt(x,10)}}AG[0]-=AE;AG[1]-=AD}if((Y||z)){AG[0]+=z;AG[1]+=Y}AG[0]=AB(AG[0]);AG[1]=AB(AG[1])}else{}return AG}}else{return function(y){var x,Y,AA,AB,AC,z=false,G=y;if(E.Dom._canPosition(y)){z=[y[b],y[P]];x=E.Dom.getDocumentScrollLeft(y[e]);Y=E.Dom.getDocumentScrollTop(y[e]);AC=((H||m.webkit>519)?true:false);while((G=G[u])){z[0]+=G[b];z[1]+=G[P];if(AC){z=E.Dom._calcBorders(G,z)}}if(E.Dom._getStyle(y,p)!==f){G=y;while((G=G[Z])&&G[C]){AA=G[i];AB=G[O];if(H&&(E.Dom._getStyle(G,"overflow")!=="visible")){z=E.Dom._calcBorders(G,z)}if(AA||AB){z[0]-=AB;z[1]-=AA}}z[0]+=x;z[1]+=Y}else{if(D){z[0]-=x;z[1]-=Y}else{if(I||H){z[0]+=x;z[1]+=Y}}}z[0]=Math.floor(z[0]);z[1]=Math.floor(z[1])}else{}return z}}}(),getX:function(G){var Y=function(x){return E.Dom.getXY(x)[0]};return E.Dom.batch(G,Y,E.Dom,true)},getY:function(G){var Y=function(x){return E.Dom.getXY(x)[1]};return E.Dom.batch(G,Y,E.Dom,true)},setXY:function(G,x,Y){E.Dom.batch(G,E.Dom._setXY,{pos:x,noRetry:Y})},_setXY:function(G,z){var AA=E.Dom._getStyle(G,p),y=E.Dom.setStyle,AD=z.pos,Y=z.noRetry,AB=[parseInt(E.Dom.getComputedStyle(G,j),10),parseInt(E.Dom.getComputedStyle(G,o),10)],AC,x;if(AA=="static"){AA=V;y(G,p,AA)}AC=E.Dom._getXY(G);if(!AD||AC===false){return false}if(isNaN(AB[0])){AB[0]=(AA==V)?0:G[b]}if(isNaN(AB[1])){AB[1]=(AA==V)?0:G[P]}if(AD[0]!==null){y(G,j,AD[0]-AC[0]+AB[0]+"px")}if(AD[1]!==null){y(G,o,AD[1]-AC[1]+AB[1]+"px")}if(!Y){x=E.Dom._getXY(G);if((AD[0]!==null&&x[0]!=AD[0])||(AD[1]!==null&&x[1]!=AD[1])){E.Dom._setXY(G,{pos:AD,noRetry:true})}}},setX:function(Y,G){E.Dom.setXY(Y,[G,null])},setY:function(G,Y){E.Dom.setXY(G,[null,Y])},getRegion:function(G){var Y=function(x){var y=false;if(E.Dom._canPosition(x)){y=E.Region.getRegion(x)}else{}return y};return E.Dom.batch(G,Y,E.Dom,true)},getClientWidth:function(){return E.Dom.getViewportWidth()},getClientHeight:function(){return E.Dom.getViewportHeight()},getElementsByClassName:function(AB,AF,AC,AE,x,AD){AF=AF||"*";AC=(AC)?E.Dom.get(AC):null||K;if(!AC){return[]}var Y=[],G=AC.getElementsByTagName(AF),z=E.Dom.hasClass;for(var y=0,AA=G.length;y<AA;++y){if(z(G[y],AB)){Y[Y.length]=G[y]}}if(AE){E.Dom.batch(Y,AE,x,AD)}return Y},hasClass:function(Y,G){return E.Dom.batch(Y,E.Dom._hasClass,G)},_hasClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom._getAttribute(x,F)||J;if(Y.exec){G=Y.test(y)}else{G=Y&&(B+y+B).indexOf(B+Y+B)>-1}}else{}return G},addClass:function(Y,G){return E.Dom.batch(Y,E.Dom._addClass,G)},_addClass:function(x,Y){var G=false,y;if(x&&Y){y=E.Dom._getAttribute(x,F)||J;if(!E.Dom._hasClass(x,Y)){E.Dom.setAttribute(x,F,A(y+B+Y));G=true}}else{}return G},removeClass:function(Y,G){return E.Dom.batch(Y,E.Dom._removeClass,G)},_removeClass:function(y,x){var Y=false,AA,z,G;if(y&&x){AA=E.Dom._getAttribute(y,F)||J;E.Dom.setAttribute(y,F,AA.replace(E.Dom._getClassRegex(x),J));z=E.Dom._getAttribute(y,F);if(AA!==z){E.Dom.setAttribute(y,F,A(z));Y=true;if(E.Dom._getAttribute(y,F)===""){G=(y.hasAttribute&&y.hasAttribute(g))?g:F;y.removeAttribute(G)}}}else{}return Y},replaceClass:function(x,Y,G){return E.Dom.batch(x,E.Dom._replaceClass,{from:Y,to:G})},_replaceClass:function(y,x){var Y,AB,AA,G=false,z;if(y&&x){AB=x.from;AA=x.to;if(!AA){G=false}else{if(!AB){G=E.Dom._addClass(y,x.to)}else{if(AB!==AA){z=E.Dom._getAttribute(y,F)||J;Y=(B+z.replace(E.Dom._getClassRegex(AB),B+AA)).split(E.Dom._getClassRegex(AA));Y.splice(1,0,B+AA);E.Dom.setAttribute(y,F,A(Y.join(J)));G=true}}}}else{}return G},generateId:function(G,x){x=x||"yui-gen";var Y=function(y){if(y&&y.id){return y.id}var z=x+YAHOO.env._id_counter++;if(y){if(y[e]&&y[e].getElementById(z)){return E.Dom.generateId(y,z+x)}y.id=z}return z};return E.Dom.batch(G,Y,E.Dom,true)||Y.apply(E.Dom,arguments)},isAncestor:function(Y,x){Y=E.Dom.get(Y);x=E.Dom.get(x);var G=false;if((Y&&x)&&(Y[l]&&x[l])){if(Y.contains&&Y!==x){G=Y.contains(x)}else{if(Y.compareDocumentPosition){G=!!(Y.compareDocumentPosition(x)&16)}}}else{}return G},inDocument:function(G,Y){return E.Dom._inDoc(E.Dom.get(G),Y)},_inDoc:function(Y,x){var G=false;if(Y&&Y[C]){x=x||Y[e];G=E.Dom.isAncestor(x[v],Y)}else{}return G},getElementsBy:function(Y,AF,AB,AD,y,AC,AE){AF=AF||"*";AB=(AB)?E.Dom.get(AB):null||K;if(!AB){return[]}var x=[],G=AB.getElementsByTagName(AF);for(var z=0,AA=G.length;z<AA;++z){if(Y(G[z])){if(AE){x=G[z];break}else{x[x.length]=G[z]}}}if(AD){E.Dom.batch(x,AD,y,AC)}return x},getElementBy:function(x,G,Y){return E.Dom.getElementsBy(x,G,Y,null,null,null,true)},batch:function(x,AB,AA,z){var y=[],Y=(z)?AA:window;x=(x&&(x[C]||x.item))?x:E.Dom.get(x);if(x&&AB){if(x[C]||x.length===undefined){return AB.call(Y,x,AA)}for(var G=0;G<x.length;++G){y[y.length]=AB.call(Y,x[G],AA)}}else{return false}return y},getDocumentHeight:function(){var Y=(K[t]!=M||I)?K.body.scrollHeight:W.scrollHeight,G=Math.max(Y,E.Dom.getViewportHeight());return G},getDocumentWidth:function(){var Y=(K[t]!=M||I)?K.body.scrollWidth:W.scrollWidth,G=Math.max(Y,E.Dom.getViewportWidth());return G},getViewportHeight:function(){var G=self.innerHeight,Y=K[t];if((Y||T)&&!D){G=(Y==M)?W.clientHeight:K.body.clientHeight}return G},getViewportWidth:function(){var G=self.innerWidth,Y=K[t];if(Y||T){G=(Y==M)?W.clientWidth:K.body.clientWidth}return G},getAncestorBy:function(G,Y){while((G=G[Z])){if(E.Dom._testElement(G,Y)){return G}}return null},getAncestorByClassName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null}var x=function(y){return E.Dom.hasClass(y,G)};return E.Dom.getAncestorBy(Y,x)},getAncestorByTagName:function(Y,G){Y=E.Dom.get(Y);if(!Y){return null}var x=function(y){return y[C]&&y[C].toUpperCase()==G.toUpperCase()};return E.Dom.getAncestorBy(Y,x)},getPreviousSiblingBy:function(G,Y){while(G){G=G.previousSibling;if(E.Dom._testElement(G,Y)){return G}}return null},getPreviousSibling:function(G){G=E.Dom.get(G);if(!G){return null}return E.Dom.getPreviousSiblingBy(G)},getNextSiblingBy:function(G,Y){while(G){G=G.nextSibling;if(E.Dom._testElement(G,Y)){return G}}return null},getNextSibling:function(G){G=E.Dom.get(G);if(!G){return null}return E.Dom.getNextSiblingBy(G)},getFirstChildBy:function(G,x){var Y=(E.Dom._testElement(G.firstChild,x))?G.firstChild:null;return Y||E.Dom.getNextSiblingBy(G.firstChild,x)},getFirstChild:function(G,Y){G=E.Dom.get(G);if(!G){return null}return E.Dom.getFirstChildBy(G)},getLastChildBy:function(G,x){if(!G){return null}var Y=(E.Dom._testElement(G.lastChild,x))?G.lastChild:null;return Y||E.Dom.getPreviousSiblingBy(G.lastChild,x)},getLastChild:function(G){G=E.Dom.get(G);return E.Dom.getLastChildBy(G)},getChildrenBy:function(Y,y){var x=E.Dom.getFirstChildBy(Y,y),G=x?[x]:[];E.Dom.getNextSiblingBy(x,function(z){if(!y||y(z)){G[G.length]=z}return false});return G},getChildren:function(G){G=E.Dom.get(G);if(!G){}return E.Dom.getChildrenBy(G)},getDocumentScrollLeft:function(G){G=G||K;return Math.max(G[v].scrollLeft,G.body.scrollLeft)},getDocumentScrollTop:function(G){G=G||K;return Math.max(G[v].scrollTop,G.body.scrollTop)},insertBefore:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null}return G[Z].insertBefore(Y,G)},insertAfter:function(Y,G){Y=E.Dom.get(Y);G=E.Dom.get(G);if(!Y||!G||!G[Z]){return null}if(G.nextSibling){return G[Z].insertBefore(Y,G.nextSibling)}else{return G[Z].appendChild(Y)}},getClientRegion:function(){var x=E.Dom.getDocumentScrollTop(),Y=E.Dom.getDocumentScrollLeft(),y=E.Dom.getViewportWidth()+Y,G=E.Dom.getViewportHeight()+x;return new E.Region(x,y,G,Y)},setAttribute:function(Y,G,x){E.Dom.batch(Y,E.Dom._setAttribute,{attr:G,val:x})},_setAttribute:function(x,Y){var G=E.Dom._toCamel(Y.attr),y=Y.val;if(x&&x.setAttribute){if(E.Dom.DOT_ATTRIBUTES[G]){x[G]=y}else{G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;x.setAttribute(G,y)}}else{}},getAttribute:function(Y,G){return E.Dom.batch(Y,E.Dom._getAttribute,G)},_getAttribute:function(Y,G){var x;G=E.Dom.CUSTOM_ATTRIBUTES[G]||G;if(Y&&Y.getAttribute){x=Y.getAttribute(G,2)}else{}return x},_toCamel:function(Y){var x=d;function G(y,z){return z.toUpperCase()}return x[Y]||(x[Y]=Y.indexOf("-")===-1?Y:Y.replace(/-([a-z])/gi,G))},_getClassRegex:function(Y){var G;if(Y!==undefined){if(Y.exec){G=Y}else{G=h[Y];if(!G){Y=Y.replace(E.Dom._patterns.CLASS_RE_TOKENS,"\\$1");G=h[Y]=new RegExp(s+Y+k,U)}}}return G},_patterns:{ROOT_TAG:/^body|html$/i,CLASS_RE_TOKENS:/([\.\(\)\^\$\*\+\?\|\[\]\{\}\\])/g},_testElement:function(G,Y){return G&&G[l]==1&&(!Y||Y(G))},_calcBorders:function(x,y){var Y=parseInt(E.Dom[w](x,R),10)||0,G=parseInt(E.Dom[w](x,q),10)||0;if(H){if(N.test(x[C])){Y=0;G=0}}y[0]+=G;y[1]+=Y;return y}};var S=E.Dom[w];if(m.opera){E.Dom[w]=function(Y,G){var x=S(Y,G);if(X.test(G)){x=E.Dom.Color.toRGB(x)}return x}}if(m.webkit){E.Dom[w]=function(Y,G){var x=S(Y,G);if(x==="rgba(0, 0, 0, 0)"){x="transparent"}return x}}if(m.ie&&m.ie>=8&&K.documentElement.hasAttribute){E.Dom.DOT_ATTRIBUTES.type=true}})();YAHOO.util.Region=function(C,D,A,B){this.top=C;this.y=C;this[1]=C;this.right=D;this.bottom=A;this.left=B;this.x=B;this[0]=B;this.width=this.right-this.left;this.height=this.bottom-this.top};YAHOO.util.Region.prototype.contains=function(A){return(A.left>=this.left&&A.right<=this.right&&A.top>=this.top&&A.bottom<=this.bottom)};YAHOO.util.Region.prototype.getArea=function(){return((this.bottom-this.top)*(this.right-this.left))};YAHOO.util.Region.prototype.intersect=function(E){var C=Math.max(this.top,E.top),D=Math.min(this.right,E.right),A=Math.min(this.bottom,E.bottom),B=Math.max(this.left,E.left);if(A>=C&&D>=B){return new YAHOO.util.Region(C,D,A,B)}else{return null}};YAHOO.util.Region.prototype.union=function(E){var C=Math.min(this.top,E.top),D=Math.max(this.right,E.right),A=Math.max(this.bottom,E.bottom),B=Math.min(this.left,E.left);return new YAHOO.util.Region(C,D,A,B)};YAHOO.util.Region.prototype.toString=function(){return("Region {top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+", height: "+this.height+", width: "+this.width+"}")};YAHOO.util.Region.getRegion=function(D){var F=YAHOO.util.Dom.getXY(D),C=F[1],E=F[0]+D.offsetWidth,A=F[1]+D.offsetHeight,B=F[0];return new YAHOO.util.Region(C,E,A,B)};YAHOO.util.Point=function(A,B){if(YAHOO.lang.isArray(A)){B=A[1];A=A[0]}YAHOO.util.Point.superclass.constructor.call(this,B,A,B,A)};YAHOO.extend(YAHOO.util.Point,YAHOO.util.Region);(function(){var B=YAHOO.util,A="clientTop",F="clientLeft",J="parentNode",K="right",W="hasLayout",I="px",U="opacity",L="auto",D="borderLeftWidth",G="borderTopWidth",P="borderRightWidth",V="borderBottomWidth",S="visible",Q="transparent",N="height",E="width",H="style",T="currentStyle",R=/^width|height$/,O=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,M={get:function(X,Z){var Y="",a=X[T][Z];if(Z===U){Y=B.Dom.getStyle(X,U)}else{if(!a||(a.indexOf&&a.indexOf(I)>-1)){Y=a}else{if(B.Dom.IE_COMPUTED[Z]){Y=B.Dom.IE_COMPUTED[Z](X,Z)}else{if(O.test(a)){Y=B.Dom.IE.ComputedStyle.getPixel(X,Z)}else{Y=a}}}}return Y},getOffset:function(Z,e){var b=Z[T][e],X=e.charAt(0).toUpperCase()+e.substr(1),c="offset"+X,Y="pixel"+X,a="",d;if(b==L){d=Z[c];if(d===undefined){a=0}a=d;if(R.test(e)){Z[H][e]=d;if(Z[c]>d){a=d-(Z[c]-d)}Z[H][e]=L}}else{if(!Z[H][Y]&&!Z[H][e]){Z[H][e]=b}a=Z[H][Y]}return a+I},getBorderWidth:function(X,Z){var Y=null;if(!X[T][W]){X[H].zoom=1}switch(Z){case G:Y=X[A];break;case V:Y=X.offsetHeight-X.clientHeight-X[A];break;case D:Y=X[F];break;case P:Y=X.offsetWidth-X.clientWidth-X[F];break}return Y+I},getPixel:function(Y,X){var a=null,b=Y[T][K],Z=Y[T][X];Y[H][K]=Z;a=Y[H].pixelRight;Y[H][K]=b;return a+I},getMargin:function(Y,X){var Z;if(Y[T][X]==L){Z=0+I}else{Z=B.Dom.IE.ComputedStyle.getPixel(Y,X)}return Z},getVisibility:function(Y,X){var Z;while((Z=Y[T])&&Z[X]=="inherit"){Y=Y[J]}return(Z)?Z[X]:S},getColor:function(Y,X){return B.Dom.Color.toRGB(Y[T][X])||Q},getBorderColor:function(Y,X){var Z=Y[T],a=Z[X]||Z.color;return B.Dom.Color.toRGB(B.Dom.Color.toHex(a))}},C={};C.top=C.right=C.bottom=C.left=C[E]=C[N]=M.getOffset;C.color=M.getColor;C[G]=C[P]=C[V]=C[D]=M.getBorderWidth;C.marginTop=C.marginRight=C.marginBottom=C.marginLeft=M.getMargin;C.visibility=M.getVisibility;C.borderColor=C.borderTopColor=C.borderRightColor=C.borderBottomColor=C.borderLeftColor=M.getBorderColor;B.Dom.IE_COMPUTED=C;B.Dom.IE_ComputedStyle=M})();(function(){var C="toString",A=parseInt,B=RegExp,D=YAHOO.util;D.Dom.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(E){if(!D.Dom.Color.re_RGB.test(E)){E=D.Dom.Color.toHex(E)}if(D.Dom.Color.re_hex.exec(E)){E="rgb("+[A(B.$1,16),A(B.$2,16),A(B.$3,16)].join(", ")+")"}return E},toHex:function(H){H=D.Dom.Color.KEYWORDS[H]||H;if(D.Dom.Color.re_RGB.exec(H)){var G=(B.$1.length===1)?"0"+B.$1:Number(B.$1),F=(B.$2.length===1)?"0"+B.$2:Number(B.$2),E=(B.$3.length===1)?"0"+B.$3:Number(B.$3);H=[G[C](16),F[C](16),E[C](16)].join("")}if(H.length<6){H=H.replace(D.Dom.Color.re_hex3,"$1$1")}if(H!=="transparent"&&H.indexOf("#")<0){H="#"+H}return H.toLowerCase()}}}());YAHOO.register("dom",YAHOO.util.Dom,{version:"2.8.0r4",build:"2446"});YAHOO.util.CustomEvent=function(D,C,B,A,E){this.type=D;this.scope=C||window;this.silent=B;this.fireOnce=E;this.fired=false;this.firedWith=null;this.signature=A||YAHOO.util.CustomEvent.LIST;this.subscribers=[];if(!this.silent){}var F="_YUICEOnSubscribe";if(D!==F){this.subscribeEvent=new YAHOO.util.CustomEvent(F,this,true)}this.lastError=null};YAHOO.util.CustomEvent.LIST=0;YAHOO.util.CustomEvent.FLAT=1;YAHOO.util.CustomEvent.prototype={subscribe:function(B,C,D){if(!B){throw new Error("Invalid callback for subscriber to '"+this.type+"'")}if(this.subscribeEvent){this.subscribeEvent.fire(B,C,D)}var A=new YAHOO.util.Subscriber(B,C,D);if(this.fireOnce&&this.fired){this.notify(A,this.firedWith)}else{this.subscribers.push(A)}},unsubscribe:function(D,F){if(!D){return this.unsubscribeAll()}var E=false;for(var B=0,A=this.subscribers.length;B<A;++B){var C=this.subscribers[B];if(C&&C.contains(D,F)){this._delete(B);E=true}}return E},fire:function(){this.lastError=null;var H=[],A=this.subscribers.length;var D=[].slice.call(arguments,0),C=true,F,B=false;if(this.fireOnce){if(this.fired){return true}else{this.firedWith=D}}this.fired=true;if(!A&&this.silent){return true}if(!this.silent){}var E=this.subscribers.slice();for(F=0;F<A;++F){var G=E[F];if(!G){B=true}else{C=this.notify(G,D);if(false===C){if(!this.silent){}break}}}return(C!==false)},notify:function(F,C){var B,H=null,E=F.getScope(this.scope),A=YAHOO.util.Event.throwErrors;if(!this.silent){}if(this.signature==YAHOO.util.CustomEvent.FLAT){if(C.length>0){H=C[0]}try{B=F.fn.call(E,H,F.obj)}catch(G){this.lastError=G;if(A){throw G}}}else{try{B=F.fn.call(E,this.type,C,F.obj)}catch(D){this.lastError=D;if(A){throw D}}}return B},unsubscribeAll:function(){var A=this.subscribers.length,B;for(B=A-1;B>-1;B--){this._delete(B)}this.subscribers=[];return A},_delete:function(A){var B=this.subscribers[A];if(B){delete B.fn;delete B.obj}this.subscribers.splice(A,1)},toString:function(){return"CustomEvent: '"+this.type+"', context: "+this.scope}};YAHOO.util.Subscriber=function(A,B,C){this.fn=A;this.obj=YAHOO.lang.isUndefined(B)?null:B;this.overrideContext=C};YAHOO.util.Subscriber.prototype.getScope=function(A){if(this.overrideContext){if(this.overrideContext===true){return this.obj}else{return this.overrideContext}}return A};YAHOO.util.Subscriber.prototype.contains=function(A,B){if(B){return(this.fn==A&&this.obj==B)}else{return(this.fn==A)}};YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", overrideContext: "+(this.overrideContext||"no")+" }"};if(!YAHOO.util.Event){YAHOO.util.Event=function(){var G=false,H=[],J=[],A=0,E=[],B=0,C={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9},D=YAHOO.env.ua.ie,F="focusin",I="focusout";return{POLL_RETRYS:500,POLL_INTERVAL:40,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,CAPTURE:7,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:D,_interval:null,_dri:null,_specialTypes:{focusin:(D?"focusin":"focus"),focusout:(D?"focusout":"blur")},DOMReady:false,throwErrors:false,startInterval:function(){if(!this._interval){this._interval=YAHOO.lang.later(this.POLL_INTERVAL,this,this._tryPreloadAttach,null,true)}},onAvailable:function(Q,M,O,P,N){var K=(YAHOO.lang.isString(Q))?[Q]:Q;for(var L=0;L<K.length;L=L+1){E.push({id:K[L],fn:M,obj:O,overrideContext:P,checkReady:N})}A=this.POLL_RETRYS;this.startInterval()},onContentReady:function(N,K,L,M){this.onAvailable(N,K,L,M,true)},onDOMReady:function(){this.DOMReadyEvent.subscribe.apply(this.DOMReadyEvent,arguments)},_addListener:function(M,K,V,P,T,Y){if(!V||!V.call){return false}if(this._isValidCollection(M)){var W=true;for(var Q=0,S=M.length;Q<S;++Q){W=this.on(M[Q],K,V,P,T)&&W}return W}else{if(YAHOO.lang.isString(M)){var O=this.getEl(M);if(O){M=O}else{this.onAvailable(M,function(){YAHOO.util.Event._addListener(M,K,V,P,T,Y)});return true}}}if(!M){return false}if("unload"==K&&P!==this){J[J.length]=[M,K,V,P,T];return true}var L=M;if(T){if(T===true){L=P}else{L=T}}var N=function(Z){return V.call(L,YAHOO.util.Event.getEvent(Z,M),P)};var X=[M,K,V,N,L,P,T,Y];var R=H.length;H[R]=X;try{this._simpleAdd(M,K,N,Y)}catch(U){this.lastError=U;this.removeListener(M,K,V);return false}return true},_getType:function(K){return this._specialTypes[K]||K},addListener:function(M,P,L,N,O){var K=((P==F||P==I)&&!YAHOO.env.ua.ie)?true:false;return this._addListener(M,this._getType(P),L,N,O,K)},addFocusListener:function(L,K,M,N){return this.on(L,F,K,M,N)},removeFocusListener:function(L,K){return this.removeListener(L,F,K)},addBlurListener:function(L,K,M,N){return this.on(L,I,K,M,N)},removeBlurListener:function(L,K){return this.removeListener(L,I,K)},removeListener:function(L,K,R){var M,P,U;K=this._getType(K);if(typeof L=="string"){L=this.getEl(L)}else{if(this._isValidCollection(L)){var S=true;for(M=L.length-1;M>-1;M--){S=(this.removeListener(L[M],K,R)&&S)}return S}}if(!R||!R.call){return this.purgeElement(L,false,K)}if("unload"==K){for(M=J.length-1;M>-1;M--){U=J[M];if(U&&U[0]==L&&U[1]==K&&U[2]==R){J.splice(M,1);return true}}return false}var N=null;var O=arguments[3];if("undefined"===typeof O){O=this._getCacheIndex(H,L,K,R)}if(O>=0){N=H[O]}if(!L||!N){return false}var T=N[this.CAPTURE]===true?true:false;try{this._simpleRemove(L,K,N[this.WFN],T)}catch(Q){this.lastError=Q;return false}delete H[O][this.WFN];delete H[O][this.FN];H.splice(O,1);return true},getTarget:function(M,L){var K=M.target||M.srcElement;return this.resolveTextNode(K)},resolveTextNode:function(L){try{if(L&&3==L.nodeType){return L.parentNode}}catch(K){}return L},getPageX:function(L){var K=L.pageX;if(!K&&0!==K){K=L.clientX||0;if(this.isIE){K+=this._getScrollLeft()}}return K},getPageY:function(K){var L=K.pageY;if(!L&&0!==L){L=K.clientY||0;if(this.isIE){L+=this._getScrollTop()}}return L},getXY:function(K){return[this.getPageX(K),this.getPageY(K)]},getRelatedTarget:function(L){var K=L.relatedTarget;if(!K){if(L.type=="mouseout"){K=L.toElement}else{if(L.type=="mouseover"){K=L.fromElement}}}return this.resolveTextNode(K)},getTime:function(M){if(!M.time){var L=new Date().getTime();try{M.time=L}catch(K){this.lastError=K;return L}}return M.time},stopEvent:function(K){this.stopPropagation(K);this.preventDefault(K)},stopPropagation:function(K){if(K.stopPropagation){K.stopPropagation()}else{K.cancelBubble=true}},preventDefault:function(K){if(K.preventDefault){K.preventDefault()}else{K.returnValue=false}},getEvent:function(M,K){var L=M||window.event;if(!L){var N=this.getEvent.caller;while(N){L=N.arguments[0];if(L&&Event==L.constructor){break}N=N.caller}}return L},getCharCode:function(L){var K=L.keyCode||L.charCode||0;if(YAHOO.env.ua.webkit&&(K in C)){K=C[K]}return K},_getCacheIndex:function(M,P,Q,O){for(var N=0,L=M.length;N<L;N=N+1){var K=M[N];if(K&&K[this.FN]==O&&K[this.EL]==P&&K[this.TYPE]==Q){return N}}return -1},generateId:function(K){var L=K.id;if(!L){L="yuievtautoid-"+B;++B;K.id=L}return L},_isValidCollection:function(L){try{return(L&&typeof L!=="string"&&L.length&&!L.tagName&&!L.alert&&typeof L[0]!=="undefined")}catch(K){return false}},elCache:{},getEl:function(K){return(typeof K==="string")?document.getElementById(K):K},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",YAHOO,0,0,1),_load:function(L){if(!G){G=true;var K=YAHOO.util.Event;K._ready();K._tryPreloadAttach()}},_ready:function(L){var K=YAHOO.util.Event;if(!K.DOMReady){K.DOMReady=true;K.DOMReadyEvent.fire();K._simpleRemove(document,"DOMContentLoaded",K._ready)}},_tryPreloadAttach:function(){if(E.length===0){A=0;if(this._interval){this._interval.cancel();this._interval=null}return}if(this.locked){return}if(this.isIE){if(!this.DOMReady){this.startInterval();return}}this.locked=true;var Q=!G;if(!Q){Q=(A>0&&E.length>0)}var P=[];var R=function(T,U){var S=T;if(U.overrideContext){if(U.overrideContext===true){S=U.obj}else{S=U.overrideContext}}U.fn.call(S,U.obj)};var L,K,O,N,M=[];for(L=0,K=E.length;L<K;L=L+1){O=E[L];if(O){N=this.getEl(O.id);if(N){if(O.checkReady){if(G||N.nextSibling||!Q){M.push(O);E[L]=null}}else{R(N,O);E[L]=null}}else{P.push(O)}}}for(L=0,K=M.length;L<K;L=L+1){O=M[L];R(this.getEl(O.id),O)}A--;if(Q){for(L=E.length-1;L>-1;L--){O=E[L];if(!O||!O.id){E.splice(L,1)}}this.startInterval()}else{if(this._interval){this._interval.cancel();this._interval=null}}this.locked=false},purgeElement:function(O,P,R){var M=(YAHOO.lang.isString(O))?this.getEl(O):O;var Q=this.getListeners(M,R),N,K;if(Q){for(N=Q.length-1;N>-1;N--){var L=Q[N];this.removeListener(M,L.type,L.fn)}}if(P&&M&&M.childNodes){for(N=0,K=M.childNodes.length;N<K;++N){this.purgeElement(M.childNodes[N],P,R)}}},getListeners:function(M,K){var P=[],L;if(!K){L=[H,J]}else{if(K==="unload"){L=[J]}else{K=this._getType(K);L=[H]}}var R=(YAHOO.lang.isString(M))?this.getEl(M):M;for(var O=0;O<L.length;O=O+1){var T=L[O];if(T){for(var Q=0,S=T.length;Q<S;++Q){var N=T[Q];if(N&&N[this.EL]===R&&(!K||K===N[this.TYPE])){P.push({type:N[this.TYPE],fn:N[this.FN],obj:N[this.OBJ],adjust:N[this.OVERRIDE],scope:N[this.ADJ_SCOPE],index:Q})}}}}return(P.length)?P:null},_unload:function(R){var L=YAHOO.util.Event,O,N,M,Q,P,S=J.slice(),K;for(O=0,Q=J.length;O<Q;++O){M=S[O];if(M){K=window;if(M[L.ADJ_SCOPE]){if(M[L.ADJ_SCOPE]===true){K=M[L.UNLOAD_OBJ]}else{K=M[L.ADJ_SCOPE]}}M[L.FN].call(K,L.getEvent(R,M[L.EL]),M[L.UNLOAD_OBJ]);S[O]=null}}M=null;K=null;J=null;if(H){for(N=H.length-1;N>-1;N--){M=H[N];if(M){L.removeListener(M[L.EL],M[L.TYPE],M[L.FN],N)}}M=null}L._simpleRemove(window,"unload",L._unload)},_getScrollLeft:function(){return this._getScroll()[1]},_getScrollTop:function(){return this._getScroll()[0]},_getScroll:function(){var K=document.documentElement,L=document.body;if(K&&(K.scrollTop||K.scrollLeft)){return[K.scrollTop,K.scrollLeft]}else{if(L){return[L.scrollTop,L.scrollLeft]}else{return[0,0]}}},regCE:function(){},_simpleAdd:function(){if(window.addEventListener){return function(M,N,L,K){M.addEventListener(N,L,(K))}}else{if(window.attachEvent){return function(M,N,L,K){M.attachEvent("on"+N,L)}}else{return function(){}}}}(),_simpleRemove:function(){if(window.removeEventListener){return function(M,N,L,K){M.removeEventListener(N,L,(K))}}else{if(window.detachEvent){return function(L,M,K){L.detachEvent("on"+M,K)}}else{return function(){}}}}()}}();(function(){var EU=YAHOO.util.Event;EU.on=EU.addListener;EU.onFocus=EU.addFocusListener;EU.onBlur=EU.addBlurListener;if(EU.isIE){if(self!==self.top){document.onreadystatechange=function(){if(document.readyState=="complete"){document.onreadystatechange=null;EU._ready()}}}else{YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,true);var n=document.createElement("p");EU._dri=setInterval(function(){try{n.doScroll("left");clearInterval(EU._dri);EU._dri=null;EU._ready();n=null}catch(ex){}},EU.POLL_INTERVAL)}}else{if(EU.webkit&&EU.webkit<525){EU._dri=setInterval(function(){var rs=document.readyState;if("loaded"==rs||"complete"==rs){clearInterval(EU._dri);EU._dri=null;EU._ready()}},EU.POLL_INTERVAL)}else{EU._simpleAdd(document,"DOMContentLoaded",EU._ready)}}EU._simpleAdd(window,"load",EU._load);EU._simpleAdd(window,"unload",EU._unload);EU._tryPreloadAttach()})()}YAHOO.util.EventProvider=function(){};YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(A,C,F,E){this.__yui_events=this.__yui_events||{};var D=this.__yui_events[A];if(D){D.subscribe(C,F,E)}else{this.__yui_subscribers=this.__yui_subscribers||{};var B=this.__yui_subscribers;if(!B[A]){B[A]=[]}B[A].push({fn:C,obj:F,overrideContext:E})}},unsubscribe:function(C,E,G){this.__yui_events=this.__yui_events||{};var A=this.__yui_events;if(C){var F=A[C];if(F){return F.unsubscribe(E,G)}}else{var B=true;for(var D in A){if(YAHOO.lang.hasOwnProperty(A,D)){B=B&&A[D].unsubscribe(E,G)}}return B}return false},unsubscribeAll:function(A){return this.unsubscribe(A)},createEvent:function(B,G){this.__yui_events=this.__yui_events||{};var E=G||{},D=this.__yui_events,F;if(D[B]){}else{F=new YAHOO.util.CustomEvent(B,E.scope||this,E.silent,YAHOO.util.CustomEvent.FLAT,E.fireOnce);D[B]=F;if(E.onSubscribeCallback){F.subscribeEvent.subscribe(E.onSubscribeCallback)}this.__yui_subscribers=this.__yui_subscribers||{};var A=this.__yui_subscribers[B];if(A){for(var C=0;C<A.length;++C){F.subscribe(A[C].fn,A[C].obj,A[C].overrideContext)}}}return D[B]},fireEvent:function(B){this.__yui_events=this.__yui_events||{};var D=this.__yui_events[B];if(!D){return null}var A=[];for(var C=1;C<arguments.length;++C){A.push(arguments[C])}return D.fire.apply(D,A)},hasEvent:function(A){if(this.__yui_events){if(this.__yui_events[A]){return true}}return false}};(function(){var A=YAHOO.util.Event,C=YAHOO.lang;YAHOO.util.KeyListener=function(D,I,E,F){if(!D){}else{if(!I){}else{if(!E){}}}if(!F){F=YAHOO.util.KeyListener.KEYDOWN}var G=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled");this.disabledEvent=new YAHOO.util.CustomEvent("disabled");if(C.isString(D)){D=document.getElementById(D)}if(C.isFunction(E)){G.subscribe(E)}else{G.subscribe(E.fn,E.scope,E.correctScope)}function H(O,N){if(!I.shift){I.shift=false}if(!I.alt){I.alt=false}if(!I.ctrl){I.ctrl=false}if(O.shiftKey==I.shift&&O.altKey==I.alt&&O.ctrlKey==I.ctrl){var J,M=I.keys,L;if(YAHOO.lang.isArray(M)){for(var K=0;K<M.length;K++){J=M[K];L=A.getCharCode(O);if(J==L){G.fire(L,O);break}}}else{L=A.getCharCode(O);if(M==L){G.fire(L,O)}}}}this.enable=function(){if(!this.enabled){A.on(D,F,H);this.enabledEvent.fire(I)}this.enabled=true};this.disable=function(){if(this.enabled){A.removeListener(D,F,H);this.disabledEvent.fire(I)}this.enabled=false};this.toString=function(){return"KeyListener ["+I.keys+"] "+D.tagName+(D.id?"["+D.id+"]":"")}};var B=YAHOO.util.KeyListener;B.KEYDOWN="keydown";B.KEYUP="keyup";B.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38}})();YAHOO.register("event",YAHOO.util.Event,{version:"2.8.0r4",build:"2446"});YAHOO.register("yahoo-dom-event",YAHOO,{version:"2.8.0r4",build:"2446"});if(!YAHOO.util.DragDropMgr){YAHOO.util.DragDropMgr=function(){var A=YAHOO.util.Event,B=YAHOO.util.Dom;return{useShim:false,_shimActive:false,_shimState:false,_debugShim:false,_createShim:function(){var C=document.createElement("div");C.id="yui-ddm-shim";if(document.body.firstChild){document.body.insertBefore(C,document.body.firstChild)}else{document.body.appendChild(C)}C.style.display="none";C.style.backgroundColor="red";C.style.position="absolute";C.style.zIndex="99999";B.setStyle(C,"opacity","0");this._shim=C;A.on(C,"mouseup",this.handleMouseUp,this,true);A.on(C,"mousemove",this.handleMouseMove,this,true);A.on(window,"scroll",this._sizeShim,this,true)},_sizeShim:function(){if(this._shimActive){var C=this._shim;C.style.height=B.getDocumentHeight()+"px";C.style.width=B.getDocumentWidth()+"px";C.style.top="0";C.style.left="0"}},_activateShim:function(){if(this.useShim){if(!this._shim){this._createShim()}this._shimActive=true;var C=this._shim,D="0";if(this._debugShim){D=".5"}B.setStyle(C,"opacity",D);this._sizeShim();C.style.display="block"}},_deactivateShim:function(){this._shim.style.display="none";this._shimActive=false},_shim:null,ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,interactionInfo:null,init:function(){this.initialized=true},POINT:0,INTERSECT:1,STRICT_INTERSECT:2,mode:0,_execOnAll:function(E,D){for(var F in this.ids){for(var C in this.ids[F]){var G=this.ids[F][C];if(!this.isTypeOfDD(G)){continue}G[E].apply(G,D)}}},_onLoad:function(){this.init();A.on(document,"mouseup",this.handleMouseUp,this,true);A.on(document,"mousemove",this.handleMouseMove,this,true);A.on(window,"unload",this._onUnload,this,true);A.on(window,"resize",this._onResize,this,true)},_onResize:function(C){this._execOnAll("resetConstraints",[])},lock:function(){this.locked=true},unlock:function(){this.locked=false},isLocked:function(){return this.locked},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:1000,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,fromTimeout:false,regDragDrop:function(D,C){if(!this.initialized){this.init()}if(!this.ids[C]){this.ids[C]={}}this.ids[C][D.id]=D},removeDDFromGroup:function(E,C){if(!this.ids[C]){this.ids[C]={}}var D=this.ids[C];if(D&&D[E.id]){delete D[E.id]}},_remove:function(E){for(var D in E.groups){if(D){var C=this.ids[D];if(C&&C[E.id]){delete C[E.id]}}}delete this.handleIds[E.id]},regHandle:function(D,C){if(!this.handleIds[D]){this.handleIds[D]={}}this.handleIds[D][C]=C},isDragDrop:function(C){return(this.getDDById(C))?true:false},getRelated:function(H,D){var G=[];for(var F in H.groups){for(var E in this.ids[F]){var C=this.ids[F][E];if(!this.isTypeOfDD(C)){continue}if(!D||C.isTarget){G[G.length]=C}}}return G},isLegalTarget:function(G,F){var D=this.getRelated(G,true);for(var E=0,C=D.length;E<C;++E){if(D[E].id==F.id){return true}}return false},isTypeOfDD:function(C){return(C&&C.__ygDragDrop)},isHandle:function(D,C){return(this.handleIds[D]&&this.handleIds[D][C])},getDDById:function(D){for(var C in this.ids){if(this.ids[C][D]){return this.ids[C][D]}}return null},handleMouseDown:function(E,D){this.currentTarget=YAHOO.util.Event.getTarget(E);this.dragCurrent=D;var C=D.getEl();this.startX=YAHOO.util.Event.getPageX(E);this.startY=YAHOO.util.Event.getPageY(E);this.deltaX=this.startX-C.offsetLeft;this.deltaY=this.startY-C.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var F=YAHOO.util.DDM;F.startDrag(F.startX,F.startY);F.fromTimeout=true},this.clickTimeThresh)},startDrag:function(C,E){if(this.dragCurrent&&this.dragCurrent.useShim){this._shimState=this.useShim;this.useShim=true}this._activateShim();clearTimeout(this.clickTimeout);var D=this.dragCurrent;if(D&&D.events.b4StartDrag){D.b4StartDrag(C,E);D.fireEvent("b4StartDragEvent",{x:C,y:E})}if(D&&D.events.startDrag){D.startDrag(C,E);D.fireEvent("startDragEvent",{x:C,y:E})}this.dragThreshMet=true},handleMouseUp:function(C){if(this.dragCurrent){clearTimeout(this.clickTimeout);if(this.dragThreshMet){if(this.fromTimeout){this.fromTimeout=false;this.handleMouseMove(C)}this.fromTimeout=false;this.fireEvents(C,true)}else{}this.stopDrag(C);this.stopEvent(C)}},stopEvent:function(C){if(this.stopPropagation){YAHOO.util.Event.stopPropagation(C)}if(this.preventDefault){YAHOO.util.Event.preventDefault(C)}},stopDrag:function(E,D){var C=this.dragCurrent;if(C&&!D){if(this.dragThreshMet){if(C.events.b4EndDrag){C.b4EndDrag(E);C.fireEvent("b4EndDragEvent",{e:E})}if(C.events.endDrag){C.endDrag(E);C.fireEvent("endDragEvent",{e:E})}}if(C.events.mouseUp){C.onMouseUp(E);C.fireEvent("mouseUpEvent",{e:E})}}if(this._shimActive){this._deactivateShim();if(this.dragCurrent&&this.dragCurrent.useShim){this.useShim=this._shimState;this._shimState=false}}this.dragCurrent=null;this.dragOvers={}},handleMouseMove:function(F){var C=this.dragCurrent;if(C){if(YAHOO.util.Event.isIE&&!F.button){this.stopEvent(F);return this.handleMouseUp(F)}else{if(F.clientX<0||F.clientY<0){}}if(!this.dragThreshMet){var E=Math.abs(this.startX-YAHOO.util.Event.getPageX(F));var D=Math.abs(this.startY-YAHOO.util.Event.getPageY(F));if(E>this.clickPixelThresh||D>this.clickPixelThresh){this.startDrag(this.startX,this.startY)}}if(this.dragThreshMet){if(C&&C.events.b4Drag){C.b4Drag(F);C.fireEvent("b4DragEvent",{e:F})}if(C&&C.events.drag){C.onDrag(F);C.fireEvent("dragEvent",{e:F})}if(C){this.fireEvents(F,false)}}this.stopEvent(F)}},fireEvents:function(V,L){var a=this.dragCurrent;if(!a||a.isLocked()||a.dragOnly){return}var N=YAHOO.util.Event.getPageX(V),M=YAHOO.util.Event.getPageY(V),P=new YAHOO.util.Point(N,M),K=a.getTargetCoord(P.x,P.y),F=a.getDragEl(),E=["out","over","drop","enter"],U=new YAHOO.util.Region(K.y,K.x+F.offsetWidth,K.y+F.offsetHeight,K.x),I=[],D={},Q=[],c={outEvts:[],overEvts:[],dropEvts:[],enterEvts:[]};for(var S in this.dragOvers){var d=this.dragOvers[S];if(!this.isTypeOfDD(d)){continue}if(!this.isOverTarget(P,d,this.mode,U)){c.outEvts.push(d)}I[S]=true;delete this.dragOvers[S]}for(var R in a.groups){if("string"!=typeof R){continue}for(S in this.ids[R]){var G=this.ids[R][S];if(!this.isTypeOfDD(G)){continue}if(G.isTarget&&!G.isLocked()&&G!=a){if(this.isOverTarget(P,G,this.mode,U)){D[R]=true;if(L){c.dropEvts.push(G)}else{if(!I[G.id]){c.enterEvts.push(G)}else{c.overEvts.push(G)}this.dragOvers[G.id]=G}}}}}this.interactionInfo={out:c.outEvts,enter:c.enterEvts,over:c.overEvts,drop:c.dropEvts,point:P,draggedRegion:U,sourceRegion:this.locationCache[a.id],validDrop:L};for(var C in D){Q.push(C)}if(L&&!c.dropEvts.length){this.interactionInfo.validDrop=false;if(a.events.invalidDrop){a.onInvalidDrop(V);a.fireEvent("invalidDropEvent",{e:V})}}for(S=0;S<E.length;S++){var Y=null;if(c[E[S]+"Evts"]){Y=c[E[S]+"Evts"]}if(Y&&Y.length){var H=E[S].charAt(0).toUpperCase()+E[S].substr(1),X="onDrag"+H,J="b4Drag"+H,O="drag"+H+"Event",W="drag"+H;if(this.mode){if(a.events[J]){a[J](V,Y,Q);a.fireEvent(J+"Event",{event:V,info:Y,group:Q})}if(a.events[W]){a[X](V,Y,Q);a.fireEvent(O,{event:V,info:Y,group:Q})}}else{for(var Z=0,T=Y.length;Z<T;++Z){if(a.events[J]){a[J](V,Y[Z].id,Q[0]);a.fireEvent(J+"Event",{event:V,info:Y[Z].id,group:Q[0]})}if(a.events[W]){a[X](V,Y[Z].id,Q[0]);a.fireEvent(O,{event:V,info:Y[Z].id,group:Q[0]})}}}}}},getBestMatch:function(E){var G=null;var D=E.length;if(D==1){G=E[0]}else{for(var F=0;F<D;++F){var C=E[F];if(this.mode==this.INTERSECT&&C.cursorIsOver){G=C;break}else{if(!G||!G.overlap||(C.overlap&&G.overlap.getArea()<C.overlap.getArea())){G=C}}}}return G},refreshCache:function(D){var F=D||this.ids;for(var C in F){if("string"!=typeof C){continue}for(var E in this.ids[C]){var G=this.ids[C][E];if(this.isTypeOfDD(G)){var H=this.getLocation(G);if(H){this.locationCache[G.id]=H}else{delete this.locationCache[G.id]}}}}},verifyEl:function(D){try{if(D){var C=D.offsetParent;if(C){return true}}}catch(E){}return false},getLocation:function(H){if(!this.isTypeOfDD(H)){return null}var F=H.getEl(),K,E,D,M,L,N,C,J,G;try{K=YAHOO.util.Dom.getXY(F)}catch(I){}if(!K){return null}E=K[0];D=E+F.offsetWidth;M=K[1];L=M+F.offsetHeight;N=M-H.padding[0];C=D+H.padding[1];J=L+H.padding[2];G=E-H.padding[3];return new YAHOO.util.Region(N,C,J,G)},isOverTarget:function(K,C,E,F){var G=this.locationCache[C.id];if(!G||!this.useCache){G=this.getLocation(C);this.locationCache[C.id]=G}if(!G){return false}C.cursorIsOver=G.contains(K);var J=this.dragCurrent;if(!J||(!E&&!J.constrainX&&!J.constrainY)){return C.cursorIsOver}C.overlap=null;if(!F){var H=J.getTargetCoord(K.x,K.y);var D=J.getDragEl();F=new YAHOO.util.Region(H.y,H.x+D.offsetWidth,H.y+D.offsetHeight,H.x)}var I=F.intersect(G);if(I){C.overlap=I;return(E)?true:C.cursorIsOver}else{return false}},_onUnload:function(D,C){this.unregAll()},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null}this._execOnAll("unreg",[]);this.ids={}},elementCache:{},getElWrapper:function(D){var C=this.elementCache[D];if(!C||!C.el){C=this.elementCache[D]=new this.ElementWrapper(YAHOO.util.Dom.get(D))}return C},getElement:function(C){return YAHOO.util.Dom.get(C)},getCss:function(D){var C=YAHOO.util.Dom.get(D);return(C)?C.style:null},ElementWrapper:function(C){this.el=C||null;this.id=this.el&&C.id;this.css=this.el&&C.style},getPosX:function(C){return YAHOO.util.Dom.getX(C)},getPosY:function(C){return YAHOO.util.Dom.getY(C)},swapNode:function(E,C){if(E.swapNode){E.swapNode(C)}else{var F=C.parentNode;var D=C.nextSibling;if(D==E){F.insertBefore(E,C)}else{if(C==E.nextSibling){F.insertBefore(C,E)}else{E.parentNode.replaceChild(C,E);F.insertBefore(E,D)}}}},getScroll:function(){var E,C,F=document.documentElement,D=document.body;if(F&&(F.scrollTop||F.scrollLeft)){E=F.scrollTop;C=F.scrollLeft}else{if(D){E=D.scrollTop;C=D.scrollLeft}else{}}return{top:E,left:C}},getStyle:function(D,C){return YAHOO.util.Dom.getStyle(D,C)},getScrollTop:function(){return this.getScroll().top},getScrollLeft:function(){return this.getScroll().left},moveToEl:function(C,E){var D=YAHOO.util.Dom.getXY(E);YAHOO.util.Dom.setXY(C,D)},getClientHeight:function(){return YAHOO.util.Dom.getViewportHeight()},getClientWidth:function(){return YAHOO.util.Dom.getViewportWidth()},numericSort:function(D,C){return(D-C)},_timeoutCount:0,_addListeners:function(){var C=YAHOO.util.DDM;if(YAHOO.util.Event&&document){C._onLoad()}else{if(C._timeoutCount>2000){}else{setTimeout(C._addListeners,10);if(document&&document.body){C._timeoutCount+=1}}}},handleWasClicked:function(C,E){if(this.isHandle(E,C.id)){return true}else{var D=C.parentNode;while(D){if(this.isHandle(E,D.id)){return true}else{D=D.parentNode}}}return false}}}();YAHOO.util.DDM=YAHOO.util.DragDropMgr;YAHOO.util.DDM._addListeners()}(function(){var A=YAHOO.util.Event;var B=YAHOO.util.Dom;YAHOO.util.DragDrop=function(E,C,D){if(E){this.init(E,C,D)}};YAHOO.util.DragDrop.prototype={events:null,on:function(){this.subscribe.apply(this,arguments)},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true},unlock:function(){this.locked=false},isTarget:true,padding:null,dragOnly:false,useShim:false,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,deltaX:0,deltaY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,cursorIsOver:false,overlap:null,b4StartDrag:function(C,D){},startDrag:function(C,D){},b4Drag:function(C){},onDrag:function(C){},onDragEnter:function(C,D){},b4DragOver:function(C){},onDragOver:function(C,D){},b4DragOut:function(C){},onDragOut:function(C,D){},b4DragDrop:function(C){},onDragDrop:function(C,D){},onInvalidDrop:function(C){},b4EndDrag:function(C){},endDrag:function(C){},b4MouseDown:function(C){},onMouseDown:function(C){},onMouseUp:function(C){},onAvailable:function(){},getEl:function(){if(!this._domRef){this._domRef=B.get(this.id)}return this._domRef},getDragEl:function(){return B.get(this.dragElId)},init:function(F,C,D){this.initTarget(F,C,D);A.on(this._domRef||this.id,"mousedown",this.handleMouseDown,this,true);for(var E in this.events){this.createEvent(E+"Event")}},initTarget:function(E,C,D){this.config=D||{};this.events={};this.DDM=YAHOO.util.DDM;this.groups={};if(typeof E!=="string"){this._domRef=E;E=B.generateId(E)}this.id=E;this.addToGroup((C)?C:"default");this.handleElId=E;A.onAvailable(E,this.handleOnAvailable,this,true);this.setDragElId(E);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig()},applyConfig:function(){this.events={mouseDown:true,b4MouseDown:true,mouseUp:true,b4StartDrag:true,startDrag:true,b4EndDrag:true,endDrag:true,drag:true,b4Drag:true,invalidDrop:true,b4DragOut:true,dragOut:true,dragEnter:true,b4DragOver:true,dragOver:true,b4DragDrop:true,dragDrop:true};if(this.config.events){for(var C in this.config.events){if(this.config.events[C]===false){this.events[C]=false}}}this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false);this.dragOnly=((this.config.dragOnly===true)?true:false);this.useShim=((this.config.useShim===true)?true:false)},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable()},setPadding:function(E,C,F,D){if(!C&&0!==C){this.padding=[E,E,E,E]}else{if(!F&&0!==F){this.padding=[E,C,E,C]}else{this.padding=[E,C,F,D]}}},setInitPosition:function(F,E){var G=this.getEl();if(!this.DDM.verifyEl(G)){if(G&&G.style&&(G.style.display=="none")){}else{}return}var D=F||0;var C=E||0;var H=B.getXY(G);this.initPageX=H[0]-D;this.initPageY=H[1]-C;this.lastPageX=H[0];this.lastPageY=H[1];this.setStartPosition(H)},setStartPosition:function(D){var C=D||B.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=C[0];this.startPageY=C[1]},addToGroup:function(C){this.groups[C]=true;this.DDM.regDragDrop(this,C)},removeFromGroup:function(C){if(this.groups[C]){delete this.groups[C]}this.DDM.removeDDFromGroup(this,C)},setDragElId:function(C){this.dragElId=C},setHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C)}this.handleElId=C;this.DDM.regHandle(this.id,C)},setOuterHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C)}A.on(C,"mousedown",this.handleMouseDown,this,true);this.setHandleElId(C);this.hasOuterHandles=true},unreg:function(){A.removeListener(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this)},isLocked:function(){return(this.DDM.isLocked()||this.locked)},handleMouseDown:function(J,I){var D=J.which||J.button;if(this.primaryButtonOnly&&D>1){return}if(this.isLocked()){return}var C=this.b4MouseDown(J),F=true;if(this.events.b4MouseDown){F=this.fireEvent("b4MouseDownEvent",J)}var E=this.onMouseDown(J),H=true;if(this.events.mouseDown){H=this.fireEvent("mouseDownEvent",J)}if((C===false)||(E===false)||(F===false)||(H===false)){return}this.DDM.refreshCache(this.groups);var G=new YAHOO.util.Point(A.getPageX(J),A.getPageY(J));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(G,this)){}else{if(this.clickValidator(J)){this.setStartPosition();this.DDM.handleMouseDown(J,this);this.DDM.stopEvent(J)}else{}}},clickValidator:function(D){var C=YAHOO.util.Event.getTarget(D);return(this.isValidHandleChild(C)&&(this.id==this.handleElId||this.DDM.handleWasClicked(C,this.id)))},getTargetCoord:function(E,D){var C=E-this.deltaX;var F=D-this.deltaY;if(this.constrainX){if(C<this.minX){C=this.minX}if(C>this.maxX){C=this.maxX}}if(this.constrainY){if(F<this.minY){F=this.minY}if(F>this.maxY){F=this.maxY}}C=this.getTick(C,this.xTicks);F=this.getTick(F,this.yTicks);return{x:C,y:F}},addInvalidHandleType:function(C){var D=C.toUpperCase();this.invalidHandleTypes[D]=D},addInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C)}this.invalidHandleIds[C]=C},addInvalidHandleClass:function(C){this.invalidHandleClasses.push(C)},removeInvalidHandleType:function(C){var D=C.toUpperCase();delete this.invalidHandleTypes[D]},removeInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C)}delete this.invalidHandleIds[C]},removeInvalidHandleClass:function(D){for(var E=0,C=this.invalidHandleClasses.length;E<C;++E){if(this.invalidHandleClasses[E]==D){delete this.invalidHandleClasses[E]}}},isValidHandleChild:function(F){var E=true;var H;try{H=F.nodeName.toUpperCase()}catch(G){H=F.nodeName}E=E&&!this.invalidHandleTypes[H];E=E&&!this.invalidHandleIds[F.id];for(var D=0,C=this.invalidHandleClasses.length;E&&D<C;++D){E=!B.hasClass(F,this.invalidHandleClasses[D])}return E},setXTicks:function(F,C){this.xTicks=[];this.xTickSize=C;var E={};for(var D=this.initPageX;D>=this.minX;D=D-C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true}}for(D=this.initPageX;D<=this.maxX;D=D+C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true}}this.xTicks.sort(this.DDM.numericSort)},setYTicks:function(F,C){this.yTicks=[];this.yTickSize=C;var E={};for(var D=this.initPageY;D>=this.minY;D=D-C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true}}for(D=this.initPageY;D<=this.maxY;D=D+C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true}}this.yTicks.sort(this.DDM.numericSort)},setXConstraint:function(E,D,C){this.leftConstraint=parseInt(E,10);this.rightConstraint=parseInt(D,10);this.minX=this.initPageX-this.leftConstraint;this.maxX=this.initPageX+this.rightConstraint;if(C){this.setXTicks(this.initPageX,C)}this.constrainX=true},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks()},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0},setYConstraint:function(C,E,D){this.topConstraint=parseInt(C,10);this.bottomConstraint=parseInt(E,10);this.minY=this.initPageY-this.topConstraint;this.maxY=this.initPageY+this.bottomConstraint;if(D){this.setYTicks(this.initPageY,D)}this.constrainY=true},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var D=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var C=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(D,C)}else{this.setInitPosition()}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize)}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)}},getTick:function(I,F){if(!F){return I}else{if(F[0]>=I){return F[0]}else{for(var D=0,C=F.length;D<C;++D){var E=D+1;if(F[E]&&F[E]>=I){var H=I-F[D];var G=F[E]-I;return(G>H)?F[D]:F[E]}}return F[F.length-1]}}},toString:function(){return("DragDrop "+this.id)}};YAHOO.augment(YAHOO.util.DragDrop,YAHOO.util.EventProvider)})();YAHOO.util.DD=function(C,A,B){if(C){this.init(C,A,B)}};YAHOO.extend(YAHOO.util.DD,YAHOO.util.DragDrop,{scroll:true,autoOffset:function(C,B){var A=C-this.startPageX;var D=B-this.startPageY;this.setDelta(A,D)},setDelta:function(B,A){this.deltaX=B;this.deltaY=A},setDragElPos:function(C,B){var A=this.getDragEl();this.alignElWithMouse(A,C,B)},alignElWithMouse:function(C,G,F){var E=this.getTargetCoord(G,F);if(!this.deltaSetXY){var H=[E.x,E.y];YAHOO.util.Dom.setXY(C,H);var D=parseInt(YAHOO.util.Dom.getStyle(C,"left"),10);var B=parseInt(YAHOO.util.Dom.getStyle(C,"top"),10);this.deltaSetXY=[D-E.x,B-E.y]}else{YAHOO.util.Dom.setStyle(C,"left",(E.x+this.deltaSetXY[0])+"px");YAHOO.util.Dom.setStyle(C,"top",(E.y+this.deltaSetXY[1])+"px")}this.cachePosition(E.x,E.y);var A=this;setTimeout(function(){A.autoScroll.call(A,E.x,E.y,C.offsetHeight,C.offsetWidth)},0)},cachePosition:function(B,A){if(B){this.lastPageX=B;this.lastPageY=A}else{var C=YAHOO.util.Dom.getXY(this.getEl());this.lastPageX=C[0];this.lastPageY=C[1]}},autoScroll:function(J,I,E,K){if(this.scroll){var L=this.DDM.getClientHeight();var B=this.DDM.getClientWidth();var N=this.DDM.getScrollTop();var D=this.DDM.getScrollLeft();var H=E+I;var M=K+J;var G=(L+N-I-this.deltaY);var F=(B+D-J-this.deltaX);var C=40;var A=(document.all)?80:30;if(H>L&&G<C){window.scrollTo(D,N+A)}if(I<N&&N>0&&I-N<C){window.scrollTo(D,N-A)}if(M>B&&F<C){window.scrollTo(D+A,N)}if(J<D&&D>0&&J-D<C){window.scrollTo(D-A,N)}}},applyConfig:function(){YAHOO.util.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false)},b4MouseDown:function(A){this.setStartPosition();this.autoOffset(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A))},b4Drag:function(A){this.setDragElPos(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A))},toString:function(){return("DD "+this.id)}});YAHOO.util.DDProxy=function(C,A,B){if(C){this.init(C,A,B);this.initFrame()}};YAHOO.util.DDProxy.dragElId="ygddfdiv";YAHOO.extend(YAHOO.util.DDProxy,YAHOO.util.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var B=this,A=document.body;if(!A||!A.firstChild){setTimeout(function(){B.createFrame()},50);return}var F=this.getDragEl(),E=YAHOO.util.Dom;if(!F){F=document.createElement("div");F.id=this.dragElId;var D=F.style;D.position="absolute";D.visibility="hidden";D.cursor="move";D.border="2px solid #aaa";D.zIndex=999;D.height="25px";D.width="25px";var C=document.createElement("div");E.setStyle(C,"height","100%");E.setStyle(C,"width","100%");E.setStyle(C,"background-color","#ccc");E.setStyle(C,"opacity","0");F.appendChild(C);A.insertBefore(F,A.firstChild)}},initFrame:function(){this.createFrame()},applyConfig:function(){YAHOO.util.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||YAHOO.util.DDProxy.dragElId)},showFrame:function(E,D){var C=this.getEl();var A=this.getDragEl();var B=A.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(B.width,10)/2),Math.round(parseInt(B.height,10)/2))}this.setDragElPos(E,D);YAHOO.util.Dom.setStyle(A,"visibility","visible")},_resizeProxy:function(){if(this.resizeFrame){var H=YAHOO.util.Dom;var B=this.getEl();var C=this.getDragEl();var G=parseInt(H.getStyle(C,"borderTopWidth"),10);var I=parseInt(H.getStyle(C,"borderRightWidth"),10);var F=parseInt(H.getStyle(C,"borderBottomWidth"),10);var D=parseInt(H.getStyle(C,"borderLeftWidth"),10);if(isNaN(G)){G=0}if(isNaN(I)){I=0}if(isNaN(F)){F=0}if(isNaN(D)){D=0}var E=Math.max(0,B.offsetWidth-I-D);var A=Math.max(0,B.offsetHeight-G-F);H.setStyle(C,"width",E+"px");H.setStyle(C,"height",A+"px")}},b4MouseDown:function(B){this.setStartPosition();var A=YAHOO.util.Event.getPageX(B);var C=YAHOO.util.Event.getPageY(B);this.autoOffset(A,C)},b4StartDrag:function(A,B){this.showFrame(A,B)},b4EndDrag:function(A){YAHOO.util.Dom.setStyle(this.getDragEl(),"visibility","hidden")},endDrag:function(D){var C=YAHOO.util.Dom;var B=this.getEl();var A=this.getDragEl();C.setStyle(A,"visibility","");C.setStyle(B,"visibility","hidden");YAHOO.util.DDM.moveToEl(B,A);C.setStyle(A,"visibility","hidden");C.setStyle(B,"visibility","")},toString:function(){return("DDProxy "+this.id)}});YAHOO.util.DDTarget=function(C,A,B){if(C){this.initTarget(C,A,B)}};YAHOO.extend(YAHOO.util.DDTarget,YAHOO.util.DragDrop,{toString:function(){return("DDTarget "+this.id)}});YAHOO.register("dragdrop",YAHOO.util.DragDropMgr,{version:"2.8.0r4",build:"2446"});(function(){var B=YAHOO.util.Dom.getXY,A=YAHOO.util.Event,D=Array.prototype.slice;function C(G,E,F,H){C.ANIM_AVAIL=(!YAHOO.lang.isUndefined(YAHOO.util.Anim));if(G){this.init(G,E,true);this.initSlider(H);this.initThumb(F)}}YAHOO.lang.augmentObject(C,{getHorizSlider:function(F,G,I,H,E){return new C(F,F,new YAHOO.widget.SliderThumb(G,F,I,H,0,0,E),"horiz")},getVertSlider:function(G,H,E,I,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,0,0,E,I,F),"vert")},getSliderRegion:function(G,H,J,I,E,K,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,J,I,E,K,F),"region")},SOURCE_UI_EVENT:1,SOURCE_SET_VALUE:2,SOURCE_KEY_EVENT:3,ANIM_AVAIL:false},true);YAHOO.extend(C,YAHOO.util.DragDrop,{_mouseDown:false,dragOnly:true,initSlider:function(E){this.type=E;this.createEvent("change",this);this.createEvent("slideStart",this);this.createEvent("slideEnd",this);this.isTarget=false;this.animate=C.ANIM_AVAIL;this.backgroundEnabled=true;this.tickPause=40;this.enableKeys=true;this.keyIncrement=20;this.moveComplete=true;this.animationDuration=0.2;this.SOURCE_UI_EVENT=1;this.SOURCE_SET_VALUE=2;this.valueChangeSource=0;this._silent=false;this.lastOffset=[0,0]},initThumb:function(F){var E=this;this.thumb=F;F.cacheBetweenDrags=true;if(F._isHoriz&&F.xTicks&&F.xTicks.length){this.tickPause=Math.round(360/F.xTicks.length)}else{if(F.yTicks&&F.yTicks.length){this.tickPause=Math.round(360/F.yTicks.length)}}F.onAvailable=function(){return E.setStartSliderState()};F.onMouseDown=function(){E._mouseDown=true;return E.focus()};F.startDrag=function(){E._slideStart()};F.onDrag=function(){E.fireEvents(true)};F.onMouseUp=function(){E.thumbMouseUp()}},onAvailable:function(){this._bindKeyEvents()},_bindKeyEvents:function(){A.on(this.id,"keydown",this.handleKeyDown,this,true);A.on(this.id,"keypress",this.handleKeyPress,this,true)},handleKeyPress:function(F){if(this.enableKeys){var E=A.getCharCode(F);switch(E){case 37:case 38:case 39:case 40:case 36:case 35:A.preventDefault(F);break;default:}}},handleKeyDown:function(J){if(this.enableKeys){var G=A.getCharCode(J),F=this.thumb,H=this.getXValue(),E=this.getYValue(),I=true;switch(G){case 37:H-=this.keyIncrement;break;case 38:E-=this.keyIncrement;break;case 39:H+=this.keyIncrement;break;case 40:E+=this.keyIncrement;break;case 36:H=F.leftConstraint;E=F.topConstraint;break;case 35:H=F.rightConstraint;E=F.bottomConstraint;break;default:I=false}if(I){if(F._isRegion){this._setRegionValue(C.SOURCE_KEY_EVENT,H,E,true)}else{this._setValue(C.SOURCE_KEY_EVENT,(F._isHoriz?H:E),true)}A.stopEvent(J)}}},setStartSliderState:function(){this.setThumbCenterPoint();this.baselinePos=B(this.getEl());this.thumb.startOffset=this.thumb.getOffsetFromParent(this.baselinePos);if(this.thumb._isRegion){if(this.deferredSetRegionValue){this._setRegionValue.apply(this,this.deferredSetRegionValue);this.deferredSetRegionValue=null}else{this.setRegionValue(0,0,true,true,true)}}else{if(this.deferredSetValue){this._setValue.apply(this,this.deferredSetValue);this.deferredSetValue=null}else{this.setValue(0,true,true,true)}}},setThumbCenterPoint:function(){var E=this.thumb.getEl();if(E){this.thumbCenterPoint={x:parseInt(E.offsetWidth/2,10),y:parseInt(E.offsetHeight/2,10)}}},lock:function(){this.thumb.lock();this.locked=true},unlock:function(){this.thumb.unlock();this.locked=false},thumbMouseUp:function(){this._mouseDown=false;if(!this.isLocked()){this.endMove()}},onMouseUp:function(){this._mouseDown=false;if(this.backgroundEnabled&&!this.isLocked()){this.endMove()}},getThumb:function(){return this.thumb},focus:function(){this.valueChangeSource=C.SOURCE_UI_EVENT;var E=this.getEl();if(E.focus){try{E.focus()}catch(F){}}this.verifyOffset();return !this.isLocked()},onChange:function(E,F){},onSlideStart:function(){},onSlideEnd:function(){},getValue:function(){return this.thumb.getValue()},getXValue:function(){return this.thumb.getXValue()},getYValue:function(){return this.thumb.getYValue()},setValue:function(){var E=D.call(arguments);E.unshift(C.SOURCE_SET_VALUE);return this._setValue.apply(this,E)},_setValue:function(I,L,G,H,E){var F=this.thumb,K,J;if(!F.available){this.deferredSetValue=arguments;return false}if(this.isLocked()&&!H){return false}if(isNaN(L)){return false}if(F._isRegion){return false}this._silent=E;this.valueChangeSource=I||C.SOURCE_SET_VALUE;F.lastOffset=[L,L];this.verifyOffset();this._slideStart();if(F._isHoriz){K=F.initPageX+L+this.thumbCenterPoint.x;this.moveThumb(K,F.initPageY,G)}else{J=F.initPageY+L+this.thumbCenterPoint.y;this.moveThumb(F.initPageX,J,G)}return true},setRegionValue:function(){var E=D.call(arguments);E.unshift(C.SOURCE_SET_VALUE);return this._setRegionValue.apply(this,E)},_setRegionValue:function(F,J,H,I,G,K){var L=this.thumb,E,M;if(!L.available){this.deferredSetRegionValue=arguments;return false}if(this.isLocked()&&!G){return false}if(isNaN(J)){return false}if(!L._isRegion){return false}this._silent=K;this.valueChangeSource=F||C.SOURCE_SET_VALUE;L.lastOffset=[J,H];this.verifyOffset();this._slideStart();E=L.initPageX+J+this.thumbCenterPoint.x;M=L.initPageY+H+this.thumbCenterPoint.y;this.moveThumb(E,M,I);return true},verifyOffset:function(){var F=B(this.getEl()),E=this.thumb;if(!this.thumbCenterPoint||!this.thumbCenterPoint.x){this.setThumbCenterPoint()}if(F){if(F[0]!=this.baselinePos[0]||F[1]!=this.baselinePos[1]){this.setInitPosition();this.baselinePos=F;E.initPageX=this.initPageX+E.startOffset[0];E.initPageY=this.initPageY+E.startOffset[1];E.deltaSetXY=null;this.resetThumbConstraints();return false}}return true},moveThumb:function(K,J,I,G){var L=this.thumb,M=this,F,E,H;if(!L.available){return}L.setDelta(this.thumbCenterPoint.x,this.thumbCenterPoint.y);E=L.getTargetCoord(K,J);F=[Math.round(E.x),Math.round(E.y)];if(this.animate&&L._graduated&&!I){this.lock();this.curCoord=B(this.thumb.getEl());this.curCoord=[Math.round(this.curCoord[0]),Math.round(this.curCoord[1])];setTimeout(function(){M.moveOneTick(F)},this.tickPause)}else{if(this.animate&&C.ANIM_AVAIL&&!I){this.lock();H=new YAHOO.util.Motion(L.id,{points:{to:F}},this.animationDuration,YAHOO.util.Easing.easeOut);H.onComplete.subscribe(function(){M.unlock();if(!M._mouseDown){M.endMove()}});H.animate()}else{L.setDragElPos(K,J);if(!G&&!this._mouseDown){this.endMove()}}}},_slideStart:function(){if(!this._sliding){if(!this._silent){this.onSlideStart();this.fireEvent("slideStart")}this._sliding=true;this.moveComplete=false}},_slideEnd:function(){if(this._sliding){var E=this._silent;this._sliding=false;this.moveComplete=true;this._silent=false;if(!E){this.onSlideEnd();this.fireEvent("slideEnd")}}},moveOneTick:function(F){var H=this.thumb,G=this,I=null,E,J;if(H._isRegion){I=this._getNextX(this.curCoord,F);E=(I!==null)?I[0]:this.curCoord[0];I=this._getNextY(this.curCoord,F);J=(I!==null)?I[1]:this.curCoord[1];I=E!==this.curCoord[0]||J!==this.curCoord[1]?[E,J]:null}else{if(H._isHoriz){I=this._getNextX(this.curCoord,F)}else{I=this._getNextY(this.curCoord,F)}}if(I){this.curCoord=I;this.thumb.alignElWithMouse(H.getEl(),I[0]+this.thumbCenterPoint.x,I[1]+this.thumbCenterPoint.y);if(!(I[0]==F[0]&&I[1]==F[1])){setTimeout(function(){G.moveOneTick(F)},this.tickPause)}else{this.unlock();if(!this._mouseDown){this.endMove()}}}else{this.unlock();if(!this._mouseDown){this.endMove()}}},_getNextX:function(E,F){var H=this.thumb,J,G=[],I=null;if(E[0]>F[0]){J=H.tickSize-this.thumbCenterPoint.x;G=H.getTargetCoord(E[0]-J,E[1]);I=[G.x,G.y]}else{if(E[0]<F[0]){J=H.tickSize+this.thumbCenterPoint.x;G=H.getTargetCoord(E[0]+J,E[1]);I=[G.x,G.y]}else{}}return I},_getNextY:function(E,F){var H=this.thumb,J,G=[],I=null;if(E[1]>F[1]){J=H.tickSize-this.thumbCenterPoint.y;G=H.getTargetCoord(E[0],E[1]-J);I=[G.x,G.y]}else{if(E[1]<F[1]){J=H.tickSize+this.thumbCenterPoint.y;G=H.getTargetCoord(E[0],E[1]+J);I=[G.x,G.y]}else{}}return I},b4MouseDown:function(E){if(!this.backgroundEnabled){return false}this.thumb.autoOffset();this.baselinePos=[]},onMouseDown:function(F){if(!this.backgroundEnabled||this.isLocked()){return false}this._mouseDown=true;var E=A.getPageX(F),G=A.getPageY(F);this.focus();this._slideStart();this.moveThumb(E,G)},onDrag:function(F){if(this.backgroundEnabled&&!this.isLocked()){var E=A.getPageX(F),G=A.getPageY(F);this.moveThumb(E,G,true,true);this.fireEvents()}},endMove:function(){this.unlock();this.fireEvents();this._slideEnd()},resetThumbConstraints:function(){var E=this.thumb;E.setXConstraint(E.leftConstraint,E.rightConstraint,E.xTickSize);E.setYConstraint(E.topConstraint,E.bottomConstraint,E.xTickSize)},fireEvents:function(G){var F=this.thumb,I,H,E;if(!G){F.cachePosition()}if(!this.isLocked()){if(F._isRegion){I=F.getXValue();H=F.getYValue();if(I!=this.previousX||H!=this.previousY){if(!this._silent){this.onChange(I,H);this.fireEvent("change",{x:I,y:H})}}this.previousX=I;this.previousY=H}else{E=F.getValue();if(E!=this.previousVal){if(!this._silent){this.onChange(E);this.fireEvent("change",E)}}this.previousVal=E}}},toString:function(){return("Slider ("+this.type+") "+this.id)}});YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider);YAHOO.widget.Slider=C})();YAHOO.widget.SliderThumb=function(G,B,E,D,A,F,C){if(G){YAHOO.widget.SliderThumb.superclass.constructor.call(this,G,B);this.parentElId=B}this.isTarget=false;this.tickSize=C;this.maintainOffset=true;this.initSlider(E,D,A,F,C);this.scroll=false};YAHOO.extend(YAHOO.widget.SliderThumb,YAHOO.util.DD,{startOffset:null,dragOnly:true,_isHoriz:false,_prevVal:0,_graduated:false,getOffsetFromParent0:function(C){var A=YAHOO.util.Dom.getXY(this.getEl()),B=C||YAHOO.util.Dom.getXY(this.parentElId);return[(A[0]-B[0]),(A[1]-B[1])]},getOffsetFromParent:function(H){var A=this.getEl(),E,I,F,B,K,D,C,J,G;if(!this.deltaOffset){I=YAHOO.util.Dom.getXY(A);F=H||YAHOO.util.Dom.getXY(this.parentElId);E=[(I[0]-F[0]),(I[1]-F[1])];B=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10);K=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10);D=B-E[0];C=K-E[1];if(isNaN(D)||isNaN(C)){}else{this.deltaOffset=[D,C]}}else{J=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10);G=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10);E=[J+this.deltaOffset[0],G+this.deltaOffset[1]]}return E},initSlider:function(D,C,A,E,B){this.initLeft=D;this.initRight=C;this.initUp=A;this.initDown=E;this.setXConstraint(D,C,B);this.setYConstraint(A,E,B);if(B&&B>1){this._graduated=true}this._isHoriz=(D||C);this._isVert=(A||E);this._isRegion=(this._isHoriz&&this._isVert)},clearTicks:function(){YAHOO.widget.SliderThumb.superclass.clearTicks.call(this);this.tickSize=0;this._graduated=false},getValue:function(){return(this._isHoriz)?this.getXValue():this.getYValue()},getXValue:function(){if(!this.available){return 0}var A=this.getOffsetFromParent();if(YAHOO.lang.isNumber(A[0])){this.lastOffset=A;return(A[0]-this.startOffset[0])}else{return(this.lastOffset[0]-this.startOffset[0])}},getYValue:function(){if(!this.available){return 0}var A=this.getOffsetFromParent();if(YAHOO.lang.isNumber(A[1])){this.lastOffset=A;return(A[1]-this.startOffset[1])}else{return(this.lastOffset[1]-this.startOffset[1])}},toString:function(){return"SliderThumb "+this.id},onChange:function(A,B){}});(function(){var A=YAHOO.util.Event,B=YAHOO.widget;function C(I,F,H,D){var G=this,J={min:false,max:false},E,K;this.minSlider=I;this.maxSlider=F;this.activeSlider=I;this.isHoriz=I.thumb._isHoriz;E=this.minSlider.thumb.onMouseDown;K=this.maxSlider.thumb.onMouseDown;this.minSlider.thumb.onMouseDown=function(){G.activeSlider=G.minSlider;E.apply(this,arguments)};this.maxSlider.thumb.onMouseDown=function(){G.activeSlider=G.maxSlider;K.apply(this,arguments)};this.minSlider.thumb.onAvailable=function(){I.setStartSliderState();J.min=true;if(J.max){G.fireEvent("ready",G)}};this.maxSlider.thumb.onAvailable=function(){F.setStartSliderState();J.max=true;if(J.min){G.fireEvent("ready",G)}};I.onMouseDown=F.onMouseDown=function(L){return this.backgroundEnabled&&G._handleMouseDown(L)};I.onDrag=F.onDrag=function(L){G._handleDrag(L)};I.onMouseUp=F.onMouseUp=function(L){G._handleMouseUp(L)};I._bindKeyEvents=function(){G._bindKeyEvents(this)};F._bindKeyEvents=function(){};I.subscribe("change",this._handleMinChange,I,this);I.subscribe("slideStart",this._handleSlideStart,I,this);I.subscribe("slideEnd",this._handleSlideEnd,I,this);F.subscribe("change",this._handleMaxChange,F,this);F.subscribe("slideStart",this._handleSlideStart,F,this);F.subscribe("slideEnd",this._handleSlideEnd,F,this);this.createEvent("ready",this);this.createEvent("change",this);this.createEvent("slideStart",this);this.createEvent("slideEnd",this);D=YAHOO.lang.isArray(D)?D:[0,H];D[0]=Math.min(Math.max(parseInt(D[0],10)|0,0),H);D[1]=Math.max(Math.min(parseInt(D[1],10)|0,H),0);if(D[0]>D[1]){D.splice(0,2,D[1],D[0])}this.minVal=D[0];this.maxVal=D[1];this.minSlider.setValue(this.minVal,true,true,true);this.maxSlider.setValue(this.maxVal,true,true,true)}C.prototype={minVal:-1,maxVal:-1,minRange:0,_handleSlideStart:function(E,D){this.fireEvent("slideStart",D)},_handleSlideEnd:function(E,D){this.fireEvent("slideEnd",D)},_handleDrag:function(D){B.Slider.prototype.onDrag.call(this.activeSlider,D)},_handleMinChange:function(){this.activeSlider=this.minSlider;this.updateValue()},_handleMaxChange:function(){this.activeSlider=this.maxSlider;this.updateValue()},_bindKeyEvents:function(D){A.on(D.id,"keydown",this._handleKeyDown,this,true);A.on(D.id,"keypress",this._handleKeyPress,this,true)},_handleKeyDown:function(D){this.activeSlider.handleKeyDown.apply(this.activeSlider,arguments)},_handleKeyPress:function(D){this.activeSlider.handleKeyPress.apply(this.activeSlider,arguments)},setValues:function(H,K,I,E,J){var F=this.minSlider,M=this.maxSlider,D=F.thumb,L=M.thumb,N=this,G={min:false,max:false};if(D._isHoriz){D.setXConstraint(D.leftConstraint,L.rightConstraint,D.tickSize);L.setXConstraint(D.leftConstraint,L.rightConstraint,L.tickSize)}else{D.setYConstraint(D.topConstraint,L.bottomConstraint,D.tickSize);L.setYConstraint(D.topConstraint,L.bottomConstraint,L.tickSize)}this._oneTimeCallback(F,"slideEnd",function(){G.min=true;if(G.max){N.updateValue(J);setTimeout(function(){N._cleanEvent(F,"slideEnd");N._cleanEvent(M,"slideEnd")},0)}});this._oneTimeCallback(M,"slideEnd",function(){G.max=true;if(G.min){N.updateValue(J);setTimeout(function(){N._cleanEvent(F,"slideEnd");N._cleanEvent(M,"slideEnd")},0)}});F.setValue(H,I,E,false);M.setValue(K,I,E,false)},setMinValue:function(F,H,I,E){var G=this.minSlider,D=this;this.activeSlider=G;D=this;this._oneTimeCallback(G,"slideEnd",function(){D.updateValue(E);setTimeout(function(){D._cleanEvent(G,"slideEnd")},0)});G.setValue(F,H,I)},setMaxValue:function(D,H,I,F){var G=this.maxSlider,E=this;this.activeSlider=G;this._oneTimeCallback(G,"slideEnd",function(){E.updateValue(F);setTimeout(function(){E._cleanEvent(G,"slideEnd")},0)});G.setValue(D,H,I)},updateValue:function(J){var E=this.minSlider.getValue(),K=this.maxSlider.getValue(),F=false,D,M,H,I,L,G;if(E!=this.minVal||K!=this.maxVal){F=true;D=this.minSlider.thumb;M=this.maxSlider.thumb;H=this.isHoriz?"x":"y";G=this.minSlider.thumbCenterPoint[H]+this.maxSlider.thumbCenterPoint[H];I=Math.max(K-G-this.minRange,0);L=Math.min(-E-G-this.minRange,0);if(this.isHoriz){I=Math.min(I,M.rightConstraint);D.setXConstraint(D.leftConstraint,I,D.tickSize);M.setXConstraint(L,M.rightConstraint,M.tickSize)}else{I=Math.min(I,M.bottomConstraint);D.setYConstraint(D.leftConstraint,I,D.tickSize);M.setYConstraint(L,M.bottomConstraint,M.tickSize)}}this.minVal=E;this.maxVal=K;if(F&&!J){this.fireEvent("change",this)}},selectActiveSlider:function(H){var E=this.minSlider,D=this.maxSlider,J=E.isLocked()||!E.backgroundEnabled,G=D.isLocked()||!E.backgroundEnabled,F=YAHOO.util.Event,I;if(J||G){this.activeSlider=J?D:E}else{if(this.isHoriz){I=F.getPageX(H)-E.thumb.initPageX-E.thumbCenterPoint.x}else{I=F.getPageY(H)-E.thumb.initPageY-E.thumbCenterPoint.y}this.activeSlider=I*2>D.getValue()+E.getValue()?D:E}},_handleMouseDown:function(D){if(!D._handled&&!this.minSlider._sliding&&!this.maxSlider._sliding){D._handled=true;this.selectActiveSlider(D);return B.Slider.prototype.onMouseDown.call(this.activeSlider,D)}else{return false}},_handleMouseUp:function(D){B.Slider.prototype.onMouseUp.apply(this.activeSlider,arguments)},_oneTimeCallback:function(G,D,F){var E=function(){G.unsubscribe(D,E);F.apply({},arguments)};G.subscribe(D,E)},_cleanEvent:function(K,E){var J,I,D,G,H,F;if(K.__yui_events&&K.events[E]){for(I=K.__yui_events.length;I>=0;--I){if(K.__yui_events[I].type===E){J=K.__yui_events[I];break}}if(J){H=J.subscribers;F=[];G=0;for(I=0,D=H.length;I<D;++I){if(H[I]){F[G++]=H[I]}}J.subscribers=F}}}};YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider);B.Slider.getHorizDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,G,0,0,F),E=new B.SliderThumb(K,H,0,G,0,0,F);return new C(new B.Slider(H,H,I,"horiz"),new B.Slider(H,H,E,"horiz"),G,D)};B.Slider.getVertDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,0,0,G,F),E=new B.SliderThumb(K,H,0,0,0,G,F);return new B.DualSlider(new B.Slider(H,H,I,"vert"),new B.Slider(H,H,E,"vert"),G,D)};YAHOO.widget.DualSlider=C})();YAHOO.register("slider",YAHOO.widget.Slider,{version:"2.8.0r4",build:"2446"});var jg_ok,jg_ie,jg_fast,jg_dom,jg_moz;function _chkDHTM(wnd,x,i){x=wnd.document.body||null;jg_ie=x&&typeof x.insertAdjacentHTML!="undefined"&&wnd.document.createElement;jg_dom=(x&&!jg_ie&&typeof x.appendChild!="undefined"&&typeof wnd.document.createRange!="undefined"&&typeof(i=wnd.document.createRange()).setStartBefore!="undefined"&&typeof i.createContextualFragment!="undefined");jg_fast=jg_ie&&wnd.document.all&&!wnd.opera;jg_moz=jg_dom&&typeof x.style.MozOpacity!="undefined";jg_ok=!!(jg_ie||jg_dom)}function _pntCnvDom(){var x=this.wnd.document.createRange();x.setStartBefore(this.cnv);x=x.createContextualFragment(jg_fast?this._htmRpc():this.htm);if(this.cnv){this.cnv.appendChild(x)}this.htm=""}function _pntCnvIe(){if(this.cnv){this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm)}this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntN(){}function _mkDiv(x,y,w,h){this.htm+='<div style="position:absolute;left:'+x+"px;top:"+y+"px;width:"+w+"px;height:"+h+"px;clip:rect(0,"+w+"px,"+h+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function _mkDivIe(x,y,w,h){this.htm+="%%"+this.color+";"+x+";"+y+";"+w+";"+h+";"}function _mkDivPrt(x,y,w,h){this.htm+='<div style="position:absolute;border-left:'+w+"px solid "+this.color+";left:"+x+"px;top:"+y+"px;width:0px;height:"+h+"px;clip:rect(0,"+w+"px,"+h+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}var _regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px"></div>\n')}function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px;border-left:$4px solid $1"></div>\n')}function _mkLin(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2}var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1:1;if(dx>=dy){var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx,ox=x;while(dx>0){--dx;++x;if(p>0){this._mkDiv(ox,y,x-ox,1);y+=yIncr;p+=pru;ox=x}else{p+=pr}}this._mkDiv(ox,y,x2-ox+1,1)}else{var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy,oy=y;if(y2<=y1){while(dy>0){--dy;if(p>0){this._mkDiv(x++,y,1,oy-y+1);y+=yIncr;p+=pru;oy=y}else{y+=yIncr;p+=pr}}this._mkDiv(x2,y2,1,oy-y2+1)}else{while(dy>0){--dy;y+=yIncr;if(p>0){this._mkDiv(x++,oy,1,y-oy);p+=pru;oy=y}else{p+=pr}}this._mkDiv(x2,oy,1,y2-oy+1)}}}function _mkLin2D(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2}var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1:1;var s=this.stroke;if(dx>=dy){if(dx>0&&s-3>0){var _s=(s*dx*Math.sqrt(1+dy*dy/(dx*dx))-dx-(s>>1)*dy)/dx;_s=(!(s-4)?Math.ceil(_s):Math.round(_s))+1}else{var _s=s}var ad=Math.ceil(s/2);var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx,ox=x;while(dx>0){--dx;++x;if(p>0){this._mkDiv(ox,y,x-ox+ad,_s);y+=yIncr;p+=pru;ox=x}else{p+=pr}}this._mkDiv(ox,y,x2-ox+ad+1,_s)}else{if(s-3>0){var _s=(s*dy*Math.sqrt(1+dx*dx/(dy*dy))-(s>>1)*dx-dy)/dy;_s=(!(s-4)?Math.ceil(_s):Math.round(_s))+1}else{var _s=s}var ad=Math.round(s/2);var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy,oy=y;if(y2<=y1){++ad;while(dy>0){--dy;if(p>0){this._mkDiv(x++,y,_s,oy-y+ad);y+=yIncr;p+=pru;oy=y}else{y+=yIncr;p+=pr}}this._mkDiv(x2,y2,_s,oy-y2+ad)}else{while(dy>0){--dy;y+=yIncr;if(p>0){this._mkDiv(x++,oy,_s,y-oy+ad);p+=pru;oy=y}else{p+=pr}}this._mkDiv(x2,oy,_s,y2-oy+ad+1)}}}function _mkLinDott(x1,y1,x2,y2){if(x1>x2){var _x2=x2;var _y2=y2;x2=x1;y2=y1;x1=_x2;y1=_y2}var dx=x2-x1,dy=Math.abs(y2-y1),x=x1,y=y1,yIncr=(y1>y2)?-1:1,drw=true;if(dx>=dy){var pr=dy<<1,pru=pr-(dx<<1),p=pr-dx;while(dx>0){--dx;if(drw){this._mkDiv(x,y,1,1)}drw=!drw;if(p>0){y+=yIncr;p+=pru}else{p+=pr}++x}}else{var pr=dx<<1,pru=pr-(dy<<1),p=pr-dy;while(dy>0){--dy;if(drw){this._mkDiv(x,y,1,1)}drw=!drw;y+=yIncr;if(p>0){++x;p+=pru}else{p+=pr}}}if(drw){this._mkDiv(x,y,1,1)}}function _mkOv(left,top,width,height){var a=(++width)>>1,b=(++height)>>1,wod=width&1,hod=height&1,cx=left+a,cy=top+b,x=0,y=b,ox=0,oy=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),w,h;while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);tt+=bb4*(++x)-aa2*(((y--)<<1)-3);w=x-ox;h=oy-y;if((w&2)&&(h&2)){this._mkOvQds(cx,cy,x-2,y+2,1,1,wod,hod);this._mkOvQds(cx,cy,x-1,y+1,1,1,wod,hod)}else{this._mkOvQds(cx,cy,x-1,oy,w,h,wod,hod)}ox=x;oy=y}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y)}}}w=a-ox+1;h=(oy<<1)+hod;y=cy-oy;this._mkDiv(cx-a,y,w,h);this._mkDiv(cx+ox+wod-1,y,w,h)}function _mkOv2D(left,top,width,height){var s=this.stroke;width+=s+1;height+=s+1;var a=width>>1,b=height>>1,wod=width&1,hod=height&1,cx=left+a,cy=top+b,x=0,y=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1);if(s-4<0&&(!(s-2)||width-51>0&&height-51>0)){var ox=0,oy=b,w,h,pxw;while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);tt+=bb4*(++x)-aa2*(((y--)<<1)-3);w=x-ox;h=oy-y;if(w-1){pxw=w+1+(s&1);h=s}else{if(h-1){pxw=s;h+=1+(s&1)}else{pxw=h=s}}this._mkOvQds(cx,cy,x-1,oy,pxw,h,wod,hod);ox=x;oy=y}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y)}}}this._mkDiv(cx-a,cy-oy,s,(oy<<1)+hod);this._mkDiv(cx+a+wod-s,cy-oy,s,(oy<<1)+hod)}else{var _a=(width-(s<<1))>>1,_b=(height-(s<<1))>>1,_x=0,_y=_b,_aa2=(_a*_a)<<1,_aa4=_aa2<<1,_bb2=(_b*_b)<<1,_bb4=_bb2<<1,_st=(_aa2>>1)*(1-(_b<<1))+_bb2,_tt=(_bb2>>1)-_aa2*((_b<<1)-1),pxl=new Array(),pxt=new Array(),_pxb=new Array();pxl[0]=0;pxt[0]=b;_pxb[0]=_b-1;while(y>0){if(st<0){pxl[pxl.length]=x;pxt[pxt.length]=y;st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){pxl[pxl.length]=x;st+=bb2*((x<<1)+3)-aa4*(y-1);tt+=bb4*(++x)-aa2*(((y--)<<1)-3);pxt[pxt.length]=y}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y)}}if(_y>0){if(_st<0){_st+=_bb2*((_x<<1)+3);_tt+=_bb4*(++_x);_pxb[_pxb.length]=_y-1}else{if(_tt<0){_st+=_bb2*((_x<<1)+3)-_aa4*(_y-1);_tt+=_bb4*(++_x)-_aa2*(((_y--)<<1)-3);_pxb[_pxb.length]=_y-1}else{_tt-=_aa2*((_y<<1)-3);_st-=_aa4*(--_y);_pxb[_pxb.length-1]--}}}}var ox=-wod,oy=b,_oy=_pxb[0],l=pxl.length,w,h;for(var i=0;i<l;i++){if(typeof _pxb[i]!="undefined"){if(_pxb[i]<_oy||pxt[i]<oy){x=pxl[i];this._mkOvQds(cx,cy,x,oy,x-ox,oy-_oy,wod,hod);ox=x;oy=pxt[i];_oy=_pxb[i]}}else{x=pxl[i];this._mkDiv(cx-x,cy-oy,1,(oy<<1)+hod);this._mkDiv(cx+ox+wod,cy-oy,1,(oy<<1)+hod);ox=x;oy=pxt[i]}}this._mkDiv(cx-a,cy-oy,1,(oy<<1)+hod);this._mkDiv(cx+ox+wod,cy-oy,1,(oy<<1)+hod)}}function _mkOvDott(left,top,width,height){var a=(++width)>>1,b=(++height)>>1,wod=width&1,hod=height&1,hodu=hod^1,cx=left+a,cy=top+b,x=0,y=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),drw=true;while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);tt+=bb4*(++x)-aa2*(((y--)<<1)-3)}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y)}}if(drw&&y>=hodu){this._mkOvQds(cx,cy,x,y,1,1,wod,hod)}drw=!drw}}function _mkRect(x,y,w,h){var s=this.stroke;this._mkDiv(x,y,w,s);this._mkDiv(x+w,y,s,h);this._mkDiv(x,y+h,w+s,s);this._mkDiv(x,y+s,s,h-s)}function _mkRectDott(x,y,w,h){this.drawLine(x,y,x+w,y);this.drawLine(x+w,y,x+w,y+h);this.drawLine(x,y+h,x+w,y+h);this.drawLine(x,y,x,y+h)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.ITALIC_BOLD=this.ITALIC+this.BOLD;this.BOLD_ITALIC=this.ITALIC_BOLD}var Font=new jsgFont();function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke();function jsGraphics(cnv,wnd){this.setColor=function(x){this.color=x.toLowerCase()};this.setStroke=function(x){this.stroke=x;if(!(x+1)){this.drawLine=_mkLinDott;this._mkOv=_mkOvDott;this.drawRect=_mkRectDott}else{if(x-1>0){this.drawLine=_mkLin2D;this._mkOv=_mkOv2D;this.drawRect=_mkRect}else{this.drawLine=_mkLin;this._mkOv=_mkOv;this.drawRect=_mkRect}}};this.setPrintable=function(arg){this.printable=arg;if(jg_fast){this._mkDiv=_mkDivIe;this._htmRpc=arg?_htmPrtRpc:_htmRpc}else{this._mkDiv=arg?_mkDivPrt:_mkDiv}};this.setFont=function(fam,sz,sty){this.ftFam=fam;this.ftSz=sz;this.ftSty=sty||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(x,y){for(var i=x.length-1;i;){--i;this.drawLine(x[i],y[i],x[i+1],y[i+1])}};this.fillRect=function(x,y,w,h){this._mkDiv(x,y,w,h)};this.drawPolygon=function(x,y){this.drawPolyline(x,y);this.drawLine(x[x.length-1],y[x.length-1],x[0],y[0])};this.drawEllipse=this.drawOval=function(x,y,w,h){this._mkOv(x,y,w,h)};this.fillEllipse=this.fillOval=function(left,top,w,h){var a=w>>1,b=h>>1,wod=w&1,hod=h&1,cx=left+a,cy=top+b,x=0,y=b,oy=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),xl,dw,dh;if(w){while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);xl=cx-x;dw=(x<<1)+wod;tt+=bb4*(++x)-aa2*(((y--)<<1)-3);dh=oy-y;this._mkDiv(xl,cy-oy,dw,dh);this._mkDiv(xl,cy+y+hod,dw,dh);oy=y}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y)}}}}this._mkDiv(cx-a,cy-oy,w,(oy<<1)+hod)};this.fillArc=function(iL,iT,iW,iH,fAngA,fAngZ){var a=iW>>1,b=iH>>1,iOdds=(iW&1)|((iH&1)<<16),cx=iL+a,cy=iT+b,x=0,y=b,ox=x,oy=y,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),xEndA,yEndA,xEndZ,yEndZ,iSects=(1<<(Math.floor((fAngA%=360)/180)<<3))|(2<<(Math.floor((fAngZ%=360)/180)<<3))|((fAngA>=fAngZ)<<16),aBndA=new Array(b+1),aBndZ=new Array(b+1);fAngA*=Math.PI/180;fAngZ*=Math.PI/180;xEndA=cx+Math.round(a*Math.cos(fAngA));yEndA=cy+Math.round(-b*Math.sin(fAngA));_mkLinVirt(aBndA,cx,cy,xEndA,yEndA);xEndZ=cx+Math.round(a*Math.cos(fAngZ));yEndZ=cy+Math.round(-b*Math.sin(fAngZ));_mkLinVirt(aBndZ,cx,cy,xEndZ,yEndZ);while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x)}else{if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);ox=x;tt+=bb4*(++x)-aa2*(((y--)<<1)-3);this._mkArcDiv(ox,y,oy,cx,cy,iOdds,aBndA,aBndZ,iSects);oy=y}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y);if(y&&(aBndA[y]!=aBndA[y-1]||aBndZ[y]!=aBndZ[y-1])){this._mkArcDiv(x,y,oy,cx,cy,iOdds,aBndA,aBndZ,iSects);ox=x;oy=y}}}}this._mkArcDiv(x,0,oy,cx,cy,iOdds,aBndA,aBndZ,iSects);if(iOdds>>16){if(iSects>>16){var xl=(yEndA<=cy||yEndZ>cy)?(cx-x):cx;this._mkDiv(xl,cy,x+cx-xl+(iOdds&65535),1)}else{if((iSects&1)&&yEndZ>cy){this._mkDiv(cx-x,cy,x,1)}}}};this.fillPolygon=function(array_x,array_y){var i;var y;var miny,maxy;var x1,y1;var x2,y2;var ind1,ind2;var ints;var n=array_x.length;if(!n){return}miny=array_y[0];maxy=array_y[0];for(i=1;i<n;i++){if(array_y[i]<miny){miny=array_y[i]}if(array_y[i]>maxy){maxy=array_y[i]}}for(y=miny;y<=maxy;y++){var polyInts=new Array();ints=0;for(i=0;i<n;i++){if(!i){ind1=n-1;ind2=0}else{ind1=i-1;ind2=i}y1=array_y[ind1];y2=array_y[ind2];if(y1<y2){x1=array_x[ind1];x2=array_x[ind2]}else{if(y1>y2){y2=array_y[ind1];y1=array_y[ind2];x2=array_x[ind1];x1=array_x[ind2]}else{continue}}if((y>=y1)&&(y<y2)){polyInts[ints++]=Math.round((y-y1)*(x2-x1)/(y2-y1)+x1)}else{if((y==maxy)&&(y>y1)&&(y<=y2)){polyInts[ints++]=Math.round((y-y1)*(x2-x1)/(y2-y1)+x1)}}}polyInts.sort(_CompInt);for(i=0;i<ints;i+=2){this._mkDiv(polyInts[i],y,polyInts[i+1]-polyInts[i]+1,1)}}};this.drawString=function(txt,x,y){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+x+"px;top:"+y+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+txt+"</div>"};this.drawStringRect=function(txt,x,y,width,halign){this.htm+='<div style="position:absolute;overflow:hidden;left:'+x+"px;top:"+y+"px;width:"+width+"px;text-align:"+halign+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+txt+"</div>"};this.drawImage=function(imgSrc,x,y,w,h,a){this.htm+='<div style="position:absolute;left:'+x+"px;top:"+y+"px;"+(w?("width:"+w+"px;"):"")+(h?("height:"+h+"px;"):"")+'"><img src="'+imgSrc+'"'+(w?(' width="'+w+'"'):"")+(h?(' height="'+h+'"'):"")+(a?(" "+a):"")+"></div>"};this.clear=function(){this.htm="";if(this.cnv){this.cnv.innerHTML=""}};this._mkOvQds=function(cx,cy,x,y,w,h,wod,hod){var xl=cx-x,xr=cx+x+wod-w,yt=cy-y,yb=cy+y+hod-h;if(xr>xl+w){this._mkDiv(xr,yt,w,h);this._mkDiv(xr,yb,w,h)}else{w=xr-xl+w}this._mkDiv(xl,yt,w,h);this._mkDiv(xl,yb,w,h)};this._mkArcDiv=function(x,y,oy,cx,cy,iOdds,aBndA,aBndZ,iSects){var xrDef=cx+x+(iOdds&65535),y2,h=oy-y,xl,xr,w;if(!h){h=1}x=cx-x;if(iSects&16711680){y2=cy-y-h;if(iSects&255){if(iSects&2){xl=Math.max(x,aBndZ[y]);w=xrDef-xl;if(w>0){this._mkDiv(xl,y2,w,h)}}if(iSects&1){xr=Math.min(xrDef,aBndA[y]);w=xr-x;if(w>0){this._mkDiv(x,y2,w,h)}}}else{this._mkDiv(x,y2,xrDef-x,h)}y2=cy+y+(iOdds>>16);if(iSects&65280){if(iSects&256){xl=Math.max(x,aBndA[y]);w=xrDef-xl;if(w>0){this._mkDiv(xl,y2,w,h)}}if(iSects&512){xr=Math.min(xrDef,aBndZ[y]);w=xr-x;if(w>0){this._mkDiv(x,y2,w,h)}}}else{this._mkDiv(x,y2,xrDef-x,h)}}else{if(iSects&255){if(iSects&2){xl=Math.max(x,aBndZ[y])}else{xl=x}if(iSects&1){xr=Math.min(xrDef,aBndA[y])}else{xr=xrDef}y2=cy-y-h;w=xr-xl;if(w>0){this._mkDiv(xl,y2,w,h)}}if(iSects&65280){if(iSects&256){xl=Math.max(x,aBndA[y])}else{xl=x}if(iSects&512){xr=Math.min(xrDef,aBndZ[y])}else{xr=xrDef}y2=cy+y+(iOdds>>16);w=xr-xl;if(w>0){this._mkDiv(xl,y2,w,h)}}}};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN);this.color="#000000";this.htm="";this.wnd=wnd||window;if(!jg_ok){_chkDHTM(this.wnd)}if(jg_ok){if(cnv){if(typeof(cnv)=="string"){this.cont=document.all?(this.wnd.document.all[cnv]||null):document.getElementById?(this.wnd.document.getElementById(cnv)||null):null}else{if(cnv==window.document){this.cont=document.getElementsByTagName("body")[0]}else{this.cont=cnv}}this.cnv=this.wnd.document.createElement("div");this.cnv.style.fontSize=0;this.cont.appendChild(this.cnv);this.paint=jg_dom?_pntCnvDom:_pntCnvIe}else{this.paint=_pntDoc}}else{this.paint=_pntN}this.setPrintable(false)}function _mkLinVirt(aLin,x1,y1,x2,y2){var dx=Math.abs(x2-x1),dy=Math.abs(y2-y1),x=x1,y=y1,xIncr=(x1>x2)?-1:1,yIncr=(y1>y2)?-1:1,p,i=0;if(dx>=dy){var pr=dy<<1,pru=pr-(dx<<1);p=pr-dx;while(dx>0){--dx;if(p>0){aLin[i++]=x;y+=yIncr;p+=pru}else{p+=pr}x+=xIncr}}else{var pr=dx<<1,pru=pr-(dy<<1);p=pr-dy;while(dy>0){--dy;y+=yIncr;aLin[i++]=x;if(p>0){x+=xIncr;p+=pru}else{p+=pr}}}for(var len=aLin.length,i=len-i;i;){aLin[len-(i--)]=x}}function _CompInt(x,y){return(x-y)}if(!Jedox){var Jedox={util:{},gen:{},wss:{cls:{},app:{},general:{},backend:{},grid:{},keyboard:{},mouse:{},range:{},sheet:{},style:{},book:{},workspace:{},dialog:{chart:{},format:{}},i18n:{},palo:{},action:{},hb:{},hl:{},format:{},cndfmt:{},formel:{},events:{},wsel:{},error:{}}}}Jedox.util=new function(){this.extend=function(subclass,parent){var F=function(){};F.prototype=parent.prototype;subclass.prototype=new F();subclass.prototype.constructor=subclass;subclass.parent=parent.prototype;if(parent.prototype.constructor==Object.prototype.constructor){parent.prototype.constructor=parent}};this.addEvent=function(obj,type,func,capture){if(obj.addEventListener){obj.addEventListener(type,func,capture);return true}if(obj.attachEvent){return obj.attachEvent("on".concat(type),func)}};this.ignoreSelection=function(ev){if(!ev){ev=window.event}if(ev.stopPropagation){ev.stopPropagation()}else{ev.cancelBubble=true}return false};this.unignoreSelection=function(ev){if(!ev){ev=window.event}if(ev.stopPropagation){ev.stopPropagation()}else{ev.cancelBubble=true}return true};this.setText=document.getElementsByTagName("body")[0].innerText!=undefined?function(obj,text){obj.innerText=text}:function(obj,text){obj.textContent=text};this.cols2Tree=function(vals,isReversed){if(typeof vals!="object"){return[]}if(isReversed){var name_idx=0,alias_idx=1,lvl_idx=2}else{var lvl_idx=0,name_idx=1,alias_idx=2}var len=vals.length,name,alias,curr_lvl,list=[],curr_lists={};if(len&&len%3==0&&typeof(curr_lvl=vals[lvl_idx])=="number"){name=vals[name_idx];alias=vals[alias_idx];if(alias==""){alias=name}curr_lists[curr_lvl]=list;for(var lvl,lvl_prev=curr_lvl,i=3;i<len;i+=3){lvl=vals[i+lvl_idx];if(lvl>lvl_prev){curr_lists[lvl]=curr_lists[curr_lvl][curr_lists[curr_lvl].push({val:name,text:alias,leaf:false,children:[]})-1].children}else{curr_lists[curr_lvl].push({val:name,text:alias,leaf:true})}lvl_prev=lvl;if(lvl in curr_lists){curr_lvl=lvl}name=vals[i+name_idx];if((alias=vals[i+alias_idx])==""){alias=name}}curr_lists[curr_lvl].push({val:name,text:alias,leaf:true})}else{for(var val,i=0;i<len;++i){val=vals[i],list.push({val:val,text:val,leaf:true})}}return list};this.reg2rng=function(ul,w,h){return ul.concat(ul[0]+w-1,ul[1]+h-1)};this.rngCap=function(rng,pt){if(rng[2]>pt[0]){rng[2]=pt[0]}if(rng[3]>pt[1]){rng[3]=pt[1]}};this.objFlip=function(obj){flip={};for(var key in obj){flip[obj[key]]=key}return flip};this.serializer=new function(){var meta_map={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},meta_re=/[\\\"\x08\x09\x0a\x0c\x0d]/g;function meta_repl(c){return meta_map[c]}function quote(str,out){meta_re.lastIndex=0;out.push('"',(meta_re.test(str)?str.replace(meta_re,meta_repl):str),'"')}this.enc=function(v,out){var f=out instanceof Array?false:(out=["("],true);switch(typeof(v)){case"string":quote(v,out);break;case"number":case"boolean":out.push(v);break;case"object":if(v===null){out.push("null")}else{if(v instanceof Array){out.push("[");var l=v.length,i=0,c=false;while(i<l){if(c){out.push(",")}this.enc(v[i++],out);c=true}out.push("]")}else{if(v instanceof String){quote(v,out)}else{if(v instanceof Number||v instanceof Boolean){out.push(v)}else{out.push("{");var c=false,k;for(k in v){if(c){out.push(",")}out.push('"',k,'":');this.enc(v[k],out);c=true}out.push("}")}}}}break;default:out.push("undefined");break}if(f){out.push(")");return out.join("")}};this.dec=function(str){return eval(str)}};this.offsetLeft=function(el){return el.offsetLeft};this.offsetTop=function(el){return el.offsetTop};this.getSelection=function(el){if("selectionStart" in el){return{start:el.selectionStart,end:el.selectionEnd}}var sel=el.createTextRange(),pre=el.createTextRange();sel.moveToBookmark(document.selection.createRange().getBookmark());pre.collapse(true);pre.setEndPoint("EndToStart",sel);var start=pre.text.length;return{start:start,end:start+sel.text.length}};this.getSelected=function(el){var sel;return(sel=document.selection)?(sel.type=="Text"?sel.createRange().text:""):el.value.substring(el.selectionStart,el.selectionEnd)}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length,from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0){from+=len}for(;from<len;from++){if(from in this&&this[from]===elt){return from}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(fun){if(typeof fun!="function"){throw new TypeError()}for(var len=this.length,thisp=arguments[1],i=0;i<len;i++){if(i in this){fun.call(thisp,this[i],i,this)}}}}if(!Array.prototype.compare){Array.prototype.compare=function(testArr){if(this.length!=testArr.length){return false}for(var i=0;i<testArr.length;i++){if(this[i].compare){if(!this[i].compare(testArr[i])){return false}}if(this[i]!==testArr[i]){return false}}return true}}if(!String.prototype.entityify){String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}Jedox.util.Interface=function(name,methods){if(arguments.length!=2){throw new Error("Interface constructor called with ".concat(arguments.length,"arguments, but expected exactly 2."))}this.name=name;this.methods=[];for(var i=0,len=methods.length;i<len;i++){if(typeof methods[i]!=="string"){throw new Error("Interface constructor expects method names to be passed in as a string.")}this.methods.push(methods[i])}};Jedox.util.Interface.ensureImplements=function(object){if(arguments.length<2){throw new Error("Function Interface.ensureImplements called with ".concat(arguments.length,"arguments, but expected at least 2."))}for(var i=1,len=arguments.length;i<len;i++){var _interface=arguments[i];if(_interface.constructor!==Jedox.util.Interface){throw new Error("Function Interface.ensureImplements expects arguments two and above to be instances of Interface.")}for(var j=0,methodsLen=_interface.methods.length;j<methodsLen;j++){var method=_interface.methods[j];if(!object[method]||typeof object[method]!=="function"){throw new Error("Function Interface.ensureImplements: object does not implement the ".concat(_interface.name," interface. Method ",method," was not found."))}}}};Jedox.gen.Observer=function(){this._fns=[];this._ths=[]};Jedox.gen.Observer.prototype={notify:function(that){var idx,fns=this._fns.slice(),ths=this._ths.slice(),args=Array.prototype.slice.call(arguments,1);for(var len=fns.length,i=0;i<len;++i){fns[i].apply(ths[i]?ths[i]:that,args)}return this},subscribe:function(fn,th){if(this._fns.indexOf(fn)<0){this._fns.push(fn),this._ths.push(th)}return this},unsubscribe:function(fn){var idx;if((idx=this._fns.indexOf(fn))>=0){this._fns.splice(idx,1),this._ths.splice(idx,1)}return this}};Jedox.gen.SparseVector=function(len,def){this._len=len;this._def=def;this._els={};this._bit={}};Jedox.gen.SparseVector.prototype={getLen:function(){return this._len},getDef:function(){return this._def},setElemAt:function(i,val){if(i<1||i>this._len){return}var nod,len=this._len,els=this._els,bit=this._bit;if(i in els){if(val==this._def){val-=els[i];delete els[i]}else{val-=els[i],els[i]+=val}while(i<=len){bit[i][0]+=val,i+=i&-i}}else{if(val!=this._def){els[i]=val;while(i<=len){if(i in bit){(nod=bit[i])[0]+=val}else{nod=bit[i]=[val,0]}++nod[1],i+=i&-i}}}return this},getElemAt:function(i){if(i<1||i>this._len){return}return i in this._els?this._els[i]:this._def},reInit:function(def){this._els={};this._bit={};if(typeof def=="number"){this._def=def}return this},getSumUpTo:function(i,from){if(i<1||i>this._len+1||(typeof from=="number"&&from>=i)){return}var nod,idx=--i,ndc=0,nds=0,bit=this._bit;while(i>0){if(i in bit){nds+=(nod=bit[i])[0],ndc+=nod[1]}i-=i&-i}return nds+(idx-ndc)*this._def-(typeof from=="number"?this.getSumUpTo(from):0)},getIdxByOffset:function(i,offset){if(i<1||i>this._len){return}for(var s=0;s<=offset;s+=this.getElemAt(i++)){}return i-1},getSparseArray:function(){var array=[];for(var idx in this._els){array.push(idx|0,this._els[idx])}return array}};Jedox.wss.cls.Point=function(x,y){this._x=x;this._y=y};Jedox.wss.cls.Point.prototype={getX:function(){return this._x},getY:function(){return this._y},setX:function(x){this._x=x},setY:function(y){this._y=y},getCoords:function(){return[this._x,this._y]},toString:function(){return this._x+" / "+this._y},equals:function(point){return this._x==point._x&&this._y==point._y},equalsX:function(point){return this._x==point._x},equalsY:function(point){return this._y==point._y},clone:function(){return new Jedox.wss.cls.Point(this._x,this._y)}};String.prototype.localize=function(params){var orig=this.toString(),trans=Jedox.wss.i18n.strings[orig];if(trans){if(params instanceof Object){for(var p in params){trans=trans.replace("{".concat(p,"}"),params[p])}}return trans}return orig};Jedox.wss.error=new function(){var that=this;var _types={INFO:0,WARN:1,ERR:2};var _flags={SILENT:1,FATAL:2};var _origins={NA:0,UI:1,UI_B:2,CORE:3};var _origins_desc=["General","Application","Application Backend","Server"];var _db={1:{name:"GenericException",type:_types.ERR,origin:_origins.NA},100:{name:"RuntimeException",type:_types.ERR,origin:_origins.UI_B},101:{name:"ParsingFailedException",type:_types.ERR,origin:_origins.UI_B},102:{name:"NotImplementedException",type:_types.ERR,origin:_origins.UI_B},103:{name:"InvalidSessionException",type:_types.ERR,flag:_flags.FATAL,origin:_origins.UI_B},1000:{name:"InsufficientRightsException",type:_types.ERR,origin:_origins.CORE},1100:{name:"EventHandlerAbortException",type:_types.ERR,origin:_origins.CORE},1200:{name:"ClipboardInvalidIndexException",type:_types.WARN,origin:_origins.CORE},1300:{name:"InvalidNameException",type:_types.ERR,origin:_origins.CORE},1400:{name:"InterpreterRuntimeError",type:_types.ERR,origin:_origins.CORE},1500:{name:"InvalidFormulaException",type:_types.ERR,origin:_origins.CORE},1600:{name:"CyclicDependencyException",type:_types.ERR,origin:_origins.CORE},1700:{name:"ArrayException",type:_types.WARN,origin:_origins.CORE},1800:{name:"NoWorkbookSelectedException",type:_types.ERR,origin:_origins.CORE},1801:{name:"NoWorksheetSelectedException",type:_types.ERR,origin:_origins.CORE},1802:{name:"NoApplicationSelectedException",type:_types.ERR,origin:_origins.CORE},1900:{name:"LoadApplicationException",type:_types.ERR,origin:_origins.CORE},1901:{name:"LoadException",type:_types.ERR,origin:_origins.CORE},1902:{name:"SaveException",type:_types.ERR,origin:_origins.CORE},2000:{name:"ConditionalFormatException",type:_types.ERR,origin:_origins.CORE},2100:{name:"NamedFormulaException",type:_types.ERR,origin:_origins.CORE},2101:{name:"NamedFormulaDoesNotExistException",type:_types.WARN,origin:_origins.CORE},2200:{name:"CopyWorksheetException",type:_types.ERR,origin:_origins.CORE},2300:{name:"RangeException",type:_types.ERR,origin:_origins.CORE},2400:{name:"MergedCellException",type:_types.ERR,origin:_origins.CORE},2500:{name:"AuthenticationException",type:_types.ERR,origin:_origins.CORE},2600:{name:"CellDimensionException",type:_types.ERR,origin:_origins.CORE},2700:{name:"SessionException",type:_types.ERR,flag:_flags.FATAL,origin:_origins.CORE},2800:{name:"InvalidGroupException",type:_types.ERR,origin:_origins.CORE},2900:{name:"InvalidUserException",type:_types.ERR,origin:_origins.CORE},3000:{name:"TranslationTableException",type:_types.ERR,origin:_origins.CORE},3100:{name:"WorksheetCopyException",type:_types.ERR,origin:_origins.CORE},3200:{name:"WorkbookCloneException",type:_types.ERR,origin:_origins.CORE},3300:{name:"ExtensionRegistryException",type:_types.ERR,origin:_origins.CORE},3400:{name:"ExtensionCallerException",type:_types.ERR,origin:_origins.CORE},3500:{name:"CyclicArrayException",type:_types.WARN,origin:_origins.CORE},3600:{name:"WorksheetElementException",type:_types.ERR,origin:_origins.CORE},3700:{name:"FormatException",type:_types.ERR,origin:_origins.CORE},3800:{name:"StyleManagerException",type:_types.ERR,origin:_origins.CORE},3900:{name:"BoundedPointException",type:_types.ERR,origin:_origins.CORE},4000:{name:"FilterRegistryException",type:_types.ERR,origin:_origins.CORE},4100:{name:"ContainerWrapperException",type:_types.ERR,origin:_origins.CORE},4200:{name:"SelectionToLargeException",type:_types.ERR,origin:_origins.CORE},4300:{name:"ExtensionFailureException",type:_types.ERR,origin:_origins.CORE},4400:{name:"PaloConnectorException",type:_types.ERR,origin:_origins.CORE},4500:{name:"FatalException",type:_types.ERR,flag:_flags.FATAL,origin:_origins.CORE},4600:{name:"ArrayFormulaOnMergedCellException",type:_types.ERR,origin:_origins.CORE},4700:{name:"ValueConversionException",type:_types.ERR,origin:_origins.CORE}};function _relogin(){window.parent.onbeforeunload=function(){};window.parent.location.href="/spreadsheet/root/ui/login/?r"}this.show=function(code,msg,params){var i18n_err=Jedox.wss.i18n.errors;if(!(code in _db)||!(code in i18n_err)){code=1}var err=_db[code];if(err.flag&_flags.SILENT){return}var icons=[Ext.MessageBox.INFO,Ext.MessageBox.WARNING,Ext.MessageBox.ERROR],mb_conf={title:_origins_desc[err.origin].concat(" Error").localize().concat(" ",code),icon:icons[err.type],buttons:Ext.MessageBox.OK},desc=i18n_err[code];if(typeof params=="object"&&params.length){for(var p in params){desc=desc.replace("{".concat(p,"}"),params[p])}}if(typeof msg=="string"&&msg.length>0){desc=desc.concat("<br/><br/><br/>","Error Data".localize(),":<br/>",msg,"<br/>")}else{desc=desc.concat("<br/>")}if(err.flag&_flags.FATAL){desc=desc.concat("<br/><b>","This is a fatal error, re-login will be required!".localize(),"</b><br/>");mb_conf.fn=_relogin}mb_conf.msg=desc;Ext.MessageBox.show(mb_conf)};this.scan=function(res){var el;for(var i in res){if((el=res[i])[0]===false){that.show(el[1],el[2])}}}};Jedox.wss.backend.conn=new function(){var that=this,_json=Ext.util.JSON,_ccmd=[],_cbs=[],_hasCBs=false,_batchOpen=0,_currCmd;this.Q_VALUE=1;this.Q_FORMULA=2;this.Q_STYLE=4;this.Q_FORMULA_WE=8;this.Q_ATTRS=16;this.Q_DIMS=32;this.Q_FMT_VAL=64;this.Q_FMT=128;this.Q_MERGE=256;this.Q_FORMULA_NF=512;this.Q_LOCK=1024;this.Q_ALL=2013;this.xhrHdrs={};this.cmdHdr=["cdrn",{cm:true}];this.dummy_cb=[this,function(){}];this.ping_interval=240000;this.createBatch=function(){++_batchOpen};this.cmd=function(cb,cmdHdr,cmdData,gridRange,diffCols,diffRows,diffWhat){var idx=_ccmd.push(_currCmd=cmdHdr.concat(cmdData))-1;if(_batchOpen){if(cb instanceof Array&&cb.length>1){_cbs.push(cb);_hasCBs=true}else{_cbs.push(undefined)}return idx}return that.sendBatch(cb,gridRange,diffCols,diffRows,diffWhat)};this.cmdData=function(cmdIdx,cmdData){if(!(cmdIdx in _ccmd)){return false}_ccmd[cmdIdx]=_ccmd[cmdIdx].concat(cmdData);return true};this.setCcmd=function(ccmd){_ccmd=ccmd;_cbs=[];_hasCBs=false;_batchOpen=1};this.handleRes=function(data,cbs){var el;if(data instanceof Array&&(el=data[0]) instanceof Array){if(typeof el[0]=="boolean"){var hdr=undefined,res=data}else{var hdr=data[0],res=(el=data[1]) instanceof Array&&(el=el[0]) instanceof Array&&typeof el[0]=="boolean"?data[1]:undefined}}else{var hdr=data,res=undefined}if(res){Jedox.wss.error.scan(res)}if(!(cbs instanceof Array)||!cbs.length){return data}var cb_hdr=cbs.shift(),cb=cb_hdr,len;if(hdr!==undefined&&cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],[data].concat(cb.slice(2)))}if(!res){return}if((len=res.length)&&len==cbs.length){for(var i=0;i<len;++i){if((cb=cbs[i]) instanceof Array&&cb.length>1){cb[1].apply(cb[0],[res[i]].concat(cb.slice(2)))}}}if(hdr===undefined&&(cb=cb_hdr) instanceof Array&&cb.length>1){cb[1].apply(cb[0],[data].concat(cb.slice(2)))}};this.sendBatch=function(cb,gridRange,diffCols,diffRows,diffWhat){if(_batchOpen>1){--_batchOpen;return true}_batchOpen=0;_currCmd=undefined;if(!_ccmd.length){return undefined}if(typeof _ccmd=="object"){_ccmd=_json.encode(_ccmd)}var dimSet=diffCols!=false?1:0;if(diffRows!=false){dimSet|=2}if(cb instanceof Array&&cb.length>1){_cbs.unshift(cb);_hasCBs=true}else{_cbs.unshift(undefined)}if(!_hasCBs){res=typeof gridRange!="object"?that.ccmd_s(_ccmd):that.rpc_s("WSS","exec",[_ccmd,gridRange,dimSet,diffWhat]);_ccmd=[];_cbs=[];return that.handleRes(res)}var post=[that,that.handleRes,_cbs];if(typeof gridRange!="object"){that.ccmd(post,_ccmd)}else{that.rpc(post,"WSS","exec",[_ccmd,gridRange,dimSet,diffWhat])}_ccmd=[];_cbs=[];_hasCBs=false;return true};this.ccmd=function(cb,ccmd){if(!(cb instanceof Array)||cb.length<2){return false}if(typeof ccmd=="object"){ccmd=_json.encode(ccmd)}var xhr=new XMLHttpRequest();xhr.open("POST","/spreadsheet/ub/ccmd",true);xhr.onreadystatechange=function(ev){if(xhr.readyState==4&&xhr.status==200){cb[1].apply(cb[0],[_json.decode(xhr.responseText)].concat(cb.slice(2)))}};for(var hdrName in that.xhrHdrs){xhr.setRequestHeader(hdrName,that.xhrHdrs[hdrName])}xhr.send(ccmd);return true};this.ccmd_s=function(ccmd){if(typeof ccmd=="object"){ccmd=_json.encode(ccmd)}var xhr=new XMLHttpRequest();xhr.open("POST","/spreadsheet/ub/ccmd",false);for(var hdrName in that.xhrHdrs){xhr.setRequestHeader(hdrName,that.xhrHdrs[hdrName])}xhr.send(ccmd);return xhr.readyState==4&&xhr.status==200?_json.decode(xhr.responseText):undefined};this.rpc=function(cb,obj,method,params){if(!(cb instanceof Array)||cb.length<2){return false}var xhr=new XMLHttpRequest();xhr.open("POST","/spreadsheet/root/cc/rpc.php",true);xhr.onreadystatechange=function(ev){if(xhr.readyState==4&&xhr.status==200){cb[1].apply(cb[0],[_json.decode(xhr.responseText)].concat(cb.slice(2)))}};for(var hdrName in that.xhrHdrs){xhr.setRequestHeader(hdrName,that.xhrHdrs[hdrName])}xhr.send(_json.encode([obj,method,params]));return true};this.rpc_s=function(obj,method,params){var xhr=new XMLHttpRequest();xhr.open("POST","/spreadsheet/root/cc/rpc.php",false);for(var hdrName in that.xhrHdrs){xhr.setRequestHeader(hdrName,that.xhrHdrs[hdrName])}xhr.send(_json.encode([obj,method,params]));return xhr.readyState==4&&xhr.status==200?_json.decode(xhr.responseText):undefined};this.ping=function(){that.ccmd(that.dummy_cb,that.ping_cmd);setTimeout(that.ping,that.ping_interval)}};Jedox.wss.backend.ha=function(stub){if(typeof stub!="function"){return Jedox.wss.backend.ha=undefined}var HA=function(){HA.parent.constructor.call(this);this.loadWorkbook=function(id,group,hierarchy,ext){return this.load_workbook(id,group==undefined?null:group,hierarchy==undefined?null:hierarchy,ext==undefined?null:ext)};this.saveWorkbook=function(group,hierarchy,name,parentId){return this.save_workbook(group,hierarchy,name,parentId==undefined?null:parentId)}};Jedox.util.extend(HA,stub);return Jedox.wss.backend.ha=new HA()};Jedox.wss.cls.MagicDot=function(startCoords,id,parentElement){var that=this;var _htmlElement=document.createElement("div");var _htmlLines=[];var _parent=parentElement;var _scope=this;var _initialMovement;var _offsetX;var _offsetY;var _startCoords;var _environment=_parent.getEnvironment();var _book=_parent.getBook();function _reverseDirection(direction){var newDirection;switch(direction){case Jedox.wss.grid.ScrollDirection.RIGHT:newDirection=Jedox.wss.grid.ScrollDirection.LEFT;break;case Jedox.wss.grid.ScrollDirection.LEFT:newDirection=Jedox.wss.grid.ScrollDirection.RIGHT;break;case Jedox.wss.grid.ScrollDirection.DOWN:newDirection=Jedox.wss.grid.ScrollDirection.UP;break;case Jedox.wss.grid.ScrollDirection.UP:newDirection=Jedox.wss.grid.ScrollDirection.DOWN;break}return newDirection}this.modifyRange=function(ev){if(document.all){ev=window.event}var targetCell=document.all?ev.srcElement:ev.target;var cell=_parent.getLastChangedCell();var neighbourCells=_getNeighbourCells(cell);var monitorArea=_getMonitorArea(neighbourCells);var gridScreenCoords=_environment.shared.gridScreenCoords;var scrollDir=Jedox.wss.grid.ScrollDirection;var directionX=scrollDir.NONE;var directionY=scrollDir.NONE;var direction=scrollDir.NONE;var changeDirection=false;var focusCell;console.log(monitorArea);if(ev.clientX>monitorArea[1].getX()){directionX=scrollDir.RIGHT}else{if(ev.clientX<monitorArea[0].getX()){directionX=scrollDir.LEFT}}if(ev.clientY>monitorArea[1].getY()){directionY=scrollDir.DOWN}else{if(ev.clientY<monitorArea[0].getY()){directionY=scrollDir.UP}}if(directionX==scrollDir.NONE&&directionY==scrollDir.NONE){return}direction=(ev.clientX-_offsetX>ev.clientY-_offsetY)?directionX:directionY;var corners=_parent.getCorners();switch(direction){case scrollDir.RIGHT:focusCell=neighbourCells.E;break;case scrollDir.LEFT:focusCell=neighbourCells.W;break;case scrollDir.DOWN:focusCell=neighbourCells.S;break;case scrollDir.UP:focusCell=neighbourCells.X;break}if(_initialMovement==scrollDir.NONE){_initialMovement=direction}var focusCellCoords=_book.getCoordsByCell(focusCell);if((ev.clientX-_offsetX)>(ev.clientY-_offsetY)){var endPoint=new Jedox.wss.cls.Point(focusCellCoords[0],_startCoords[1].getY());_parent.hideElement(0);_parent.hideElement(1);_parent.hideElement(2);_parent.showElement(3)}else{if((ev.clientY-_offsetY)>(ev.clientX-_offsetX)){var endPoint=new Jedox.wss.cls.Point(_startCoords[1].getX(),focusCellCoords[1]);_parent.hideElement(0);_parent.hideElement(2);_parent.hideElement(3);_parent.showElement(1)}}var startPoint=new Jedox.wss.cls.Point(_startCoords[0].getX(),_startCoords[0].getY());_environment.shared.defaultSelection.set(startPoint,endPoint);_parent.setLastChangedCell(focusCell);_scope.draw()};this.expand=function(){var corners=_parent.getCornersPx();_htmlElement.style.width=corners[1].getX()-corners[0].getX()+"px";_htmlElement.style.height=corners[1].getY()-corners[0].getY()+"px"};this.setBorders=function(upperLeft,lowerRight){_upperLeft=upperLeft.clone();_lowerRight=lowerRight.clone()};this.setSizes=function(x,y,width,height){var edge=_parent.getHtmlEdges()[0];var viewportPos=Jedox.wss.app.activeBook.getViewportPos();_initialMovement=Jedox.wss.grid.ScrollDirection.NONE;_startCoords=_parent.getParent().getStartCoords();_offsetX=edge.offsetLeft+edge.offsetWidth-viewportPos[0][0];_offsetY=edge.offsetTop+edge.offsetHeight-viewportPos[0][1];Jedox.wss.app.mouseUpObserver.subscribe(_scope.hide)};this.draw=function(){var rangeLines=_parent.getHtmlElements();for(var i=0;i<4;i++){if(i==0||i==1){_htmlLines[i].style.width=_htmlElement.offsetWidth+3+"px";_htmlLines[i].style.height="3px"}else{_htmlLines[i].style.width="3px";_htmlLines[i].style.height=_htmlElement.offsetHeight+3+"px"}switch(i){case 0:_htmlLines[i].style.top=Jedox.util.offsetTop(_htmlElement)+"px";_htmlLines[i].style.left=Jedox.util.offsetLeft(_htmlElement)+"px";break;case 1:_htmlLines[i].style.top=Jedox.util.offsetTop(_htmlElement)+_htmlElement.offsetHeight+"px";_htmlLines[i].style.left=Jedox.util.offsetLeft(_htmlElement)+"px";break;case 2:_htmlLines[i].style.top=Jedox.util.offsetTop(_htmlElement)+"px";_htmlLines[i].style.left=Jedox.util.offsetLeft(_htmlElement)+"px";break;case 3:_htmlLines[i].style.top=Jedox.util.offsetTop(_htmlElement)+"px";_htmlLines[i].style.left=Jedox.util.offsetLeft(_htmlElement)+_htmlElement.offsetWidth+"px";break}_htmlLines[i].style.display="block"}};this.hide=function(){for(var i=0;i<4;i++){_htmlLines[i].style.display="none"}Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.READY);_initialMovement=Jedox.wss.grid.ScrollDirection.NONE;_parent.setVisibility(Jedox.wss.range.DisplayStatus.VISIBLE);_parent.draw()};this.set=function(upperLeft,lowerRight){_upperLeft=upperLeft;_lowerRight=lowerRight};function _init(){var container=_parent.getContainer();for(var i=0;i<4;i++){_htmlLines.push(document.createElement("div"));_htmlLines[i].className="modifyingBorder";container.appendChild(_htmlLines[i])}_htmlElement.style.position="absolute";container.appendChild(_htmlElement)}this.getType=function(){return Jedox.wss.range.AreaStatus.FORMULA};_init()};Jedox.wss.cls.Environment=function(){this.shared=new Jedox.wss.cls.SharedEnvironment()};Jedox.wss.cls.SharedEnvironment=function(){this.defaultSelection=null;this.formulaSelection=null;this.copySelection=null;this.headerMarkMode="";this.headerStyle=0;this.lastMarkMode=0;this.inputField=null;this.selectedCell="";this.selectedCellCoords=[];this.lastCell=null;this.lastCellCoords=[];this.selectedCellValue="";this.selectedCellFormula="";this.selectedRowNumericName="";this.selectedColumnName="";this.selectedAbsRowNameNumeric="";this.selectedAbsColumnName="";this.selectedRowName="";this.selectedRow="";this.selectedColumn="";this.cursorField=null;this.viewMode=Jedox.wss.grid.viewMode.USER;this.inputMode=Jedox.wss.grid.GridMode.READY;this.lastRangeStartCoord=[];this.lastRangeEndCoord=[];this.editingDirectly=false;this.oldValue="";this.lastInputValue="";this.activeNewArea=false;this.mousePosition="";this.headerSelected=null;this.headerResizeType=Jedox.wss.grid.headerType.NONE;this.headerResizeCoord=0;this.headerResize=[];this.gridScreenCoords=[[],[]];this.gridScreenCoordsMax=null;this.gridPosOffset=[0,0];this.autoScroll=null;this.winStateMax=true;this.undoState=[0,0];this.undoValue=null;this.redoValue=null;this.dynaranges={};this.HBMode=Jedox.wss.hb.HBMode.DESIGNER};Jedox.wss.cls.SheetSelector=function(winId,book){var that=this,_sheetSelOC=document.getElementById(winId.concat("_sheetSelectorOC")),_sheetList=[],_handleTabChange=true,_handleEvent=true,_loadMark=false,_activeSheetId,_tabView,_toolbar;this.actionTypes={NONE:0,SELECTED:1,ADDED:2,REMOVED:3,COPIED:4,MOVED:5,UNCLONED:6};this.action=that.actionTypes.NONE;this.actionData=undefined;function _posById(sheetId){for(var i=_sheetList.length-1;i>=0;--i){if(_sheetList[i].id==sheetId){return i}}return -1}function _posByName(sheetName){for(var i=_sheetList.length-1;i>=0;--i){if(_sheetList[i].title==sheetName){return i}}return -1}function _tabById(sheetId){for(var i=_sheetList.length-1;i>=0;--i){if(_sheetList[i].id==sheetId){return _sheetList[i]}}return false}this.readWorksheets=function(){_handleTabChange=false;var sheetUids=book._sheetUids;for(var sheetUid in sheetUids){var tab=_tabView.add({id:sheetUid,title:sheetUids[sheetUid],html:"",closable:false,cls:"extbottomtab"}).show();_sheetList.push(tab)}if(book._viewMode!=Jedox.wss.grid.viewMode.USER){_tabView.add({id:"addSheet",cls:"addsheet",title:"&nbsp;",html:"",iconCls:"newtab",closable:false}).show()}_activeSheetId=book._aSheetUid;_tabView.setActiveTab(_activeSheetId);_handleTabChange=_handleEvent=true};this.selectFirstSheet=function(){_tabView.setActiveTab(0)};this.selectPreviousSheet=function(){var curPos=_posById(_activeSheetId);if(curPos>0){_tabView.setActiveTab(--curPos)}};this.selectNextSheet=function(){var curPos=_posById(_activeSheetId);if(curPos<_sheetList.length-1){_tabView.setActiveTab(++curPos)}};this.selectLastSheet=function(){_tabView.setActiveTab(_sheetList.length-1)};function _selectByPos(pos){if(pos<0){return false}_tabView.setActiveTab(pos);return true}this.selectByName=function(sheetName){if(sheetName==""){return true}var selRes=_selectByPos(_posByName(sheetName));if(selRes){_activeSheetId=this.getIdByName(sheetName)}return selRes};this.selectById=function(sheetId,loadMark){if(sheetId==""){return true}_loadMark=loadMark;var selRes=_selectByPos(_posById(sheetId));if(selRes){_activeSheetId=sheetId}return selRes};this.getLoadMark=function(doReset){var lm=_loadMark;if(doReset){_loadMark=false}return lm};this.getActiveSheetId=function(){return _activeSheetId};this.getActiveSheetName=function(){return _tabById(_activeSheetId).title};this.getIdByName=function(sheetName){for(var i=_sheetList.length-1;i>=0;--i){if(_sheetList[i].title==sheetName){return _sheetList[i].id}}return false};this.insertEntry=function(sheetName,sheetId,nextSheetId){if(typeof nextSheetId=="string"&&nextSheetId.length>0){var sheetPos=_posById(nextSheetId),pos;if(sheetPos>=0){pos=sheetPos}}else{var pos=_sheetList.length}var tab=_tabView.insert(pos,{id:sheetId,title:sheetName,html:"",closable:false,cls:"extbottomtab"}).show();_sheetList.splice(pos,0,tab);_activeSheetId=sheetId};this.addSheet=function(nextSheetId){_handleTabChange=_handleEvent=false;that.action=that.actionTypes.ADDED;that.actionData=nextSheetId==undefined?"":nextSheetId;book._actOnSheetSel()};this.removeSheet=function(sheetId){if(_sheetList.length<2){Ext.MessageBox.show({title:"Delete Worksheet".localize(),msg:"delLastWorksheet".localize(),icon:Ext.MessageBox.WARNING,modal:true,buttons:Ext.MessageBox.OK});return}that.action=that.actionTypes.REMOVED;that.actionData=sheetId;var pos=_posById(sheetId);_tabView.setActiveTab(pos+1==_sheetList.length?pos-1:pos+1);_tabView.remove(_sheetList[pos]);_sheetList.splice(pos,1)};this.copySheet=function(wsId,nextSheetId,wbId){_handleTabChange=_handleEvent=false;that.action=that.actionTypes.COPIED;that.actionData={wsId:wsId,nextSheetId:nextSheetId,wbId:wbId};book._actOnSheetSel()};this.moveSheet=function(wsId,nextSheetId,wbId){var toOtherWB=typeof wbId=="string"&&wbId.length;if(toOtherWB&&_sheetList.length<2){Ext.MessageBox.show({title:"Move Worksheet".localize(),msg:"moveLastWorksheet".localize(),icon:Ext.MessageBox.WARNING,modal:true,buttons:Ext.MessageBox.OK});return}var pos=_posById(wsId);if(toOtherWB){_tabView.setActiveTab(pos+1==_sheetList.length?pos-1:pos+1)}_handleTabChange=_handleEvent=false;_tabView.remove(_sheetList[pos]);_sheetList.splice(pos,1);that.action=that.actionTypes.MOVED;that.actionData={wsId:wsId,nextSheetId:nextSheetId,wbId:wbId};book._actOnSheetSel()};this._refresh=function(){if(Jedox.wss.app.browser=="sf"){_tabView.render(winId+"_sheetSelectorIC")}};this.enable=function(enable){_handleTabChange=_handleEvent=enable!=false};this.freeze=function(freeze){_handleEvent=freeze==false};this.setWidth=function(width){_sheetSelOC.style.width="".concat(width,"px");_tabView.setWidth(width-_toolbar.getSize().width)};this.disableAddTab=function(){_tabView.getItem(_sheetList.length).disable()};this.enableAddTab=function(){_tabView.getItem(_sheetList.length).enable()};function _showContextMenu(tabPanel,tab,ev){if(tab.id=="addSheet"||book._viewMode!=Jedox.wss.grid.viewMode.DESIGNER||Jedox.wss.app.sourceSel){return}tabPanel.activate(tab);var contextMenu=new Ext.menu.Menu({id:"chartContextMenu",cls:"default-format-window",enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}},items:[{text:"Insert".localize(),handler:function(){that.addSheet(tab.id)}},{text:"Delete".localize(),iconCls:"delete_sheet",handler:function(){that.removeSheet(tab.id)}},{text:"Rename".localize(),handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.renameSheet,[tab.id,tab.title])}},{text:"Move or Copy".localize().concat("..."),handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.sheetMoveCopy)}}]});contextMenu.showAt(ev.getPoint())}function _beforeTabChange(tabPanel,newTab,currTab){return _handleEvent}function _onTabChange(tabPanel,tab){if(!_handleTabChange){return}var sourceSel=Jedox.wss.app.sourceSel;if(tab.getId()=="addSheet"){if(sourceSel){return}else{return that.addSheet()}}_handleTabChange=_handleEvent=false;var env=book._aPane._env.shared;if(env.inputMode==Jedox.wss.grid.GridMode.INPUT){Jedox.wss.keyboard.sendInput(env.inputField,13,false)}env.inputField.style.display="none";function cbTabChange(){_activeSheetId=tab.getId();if(that.action==that.actionTypes.NONE){that.action=that.actionTypes.SELECTED}book._actOnSheetSel(sourceSel?[this,function(){sourceSel.afterSheetChange(this.getActiveSheetName())}]:null)}if(sourceSel){sourceSel.beforeSheetChange([this,cbTabChange],this.getActiveSheetName())}else{cbTabChange()}}_toolbar=new Ext.Toolbar({cls:"extsheetselector",renderTo:winId+"_sheetSelectorTB"});_toolbar.add({iconCls:"shsel_first",scale:"xsmall",tooltip:"First Sheet".localize(),handler:that.selectFirstSheet},{iconCls:"shsel_prev",scale:"xsmall",tooltip:"Previous Sheet".localize(),handler:that.selectPreviousSheet},{iconCls:"shsel_next",scale:"xsmall",tooltip:"Next Sheet".localize(),handler:that.selectNextSheet},{iconCls:"shsel_last",scale:"xsmall",tooltip:"Last Sheet".localize(),handler:that.selectLastSheet});_toolbar.doLayout();_tabView=new Ext.TabPanel({cls:"extsheettabs",renderTo:winId+"_sheetSelectorIC",resizeTabs:false,minTabWidth:70,tabWidth:90,enableTabScroll:true,height:0,tabPosition:"bottom",collapsed:false,bodyBorder:false,border:false,hideBorders:true,autoWidth:true,autoScroll:true,listeners:{tabchange:{fn:_onTabChange,scope:this},beforetabchange:{fn:_beforeTabChange,scope:this},contextmenu:{fn:_showContextMenu,scope:this}}});_tabView.getEl().on({mouseover:{fn:function(){Jedox.wss.app.showBrowserCtx=true},scope:this},mouseout:{fn:function(){Jedox.wss.app.showBrowserCtx=false},scope:this}})};Jedox.wss.cls.AutoScroll=function(){var that=this;var _hook=null;this.scrollElem=false;var _defScrollSteps=[[25,250],[50,150],[75,50],[100,25]];function _calcScrollSpeed(scrollArea,position){var scrollPerc=position*100/scrollArea;for(var i=0;i<_defScrollSteps.length;++i){if(scrollPerc<=_defScrollSteps[i][0]){return _defScrollSteps[i][1]}}}function _stopScroll(ev){clearTimeout(that.scrollElem);var scrollType=Jedox.wss.grid.scrollType;var activeBook=Jedox.wss.app.activeBook;activeBook.stopScrollGrid(scrollType.HORIZ);activeBook.stopScrollGrid(scrollType.VERT);Jedox.wss.app.mouseUpObserver.unsubscribe(_stopScroll);if(_hook!=null){activeBook.scrollObserver.unsubscribe(_hook)}}this.checkAndScroll=function(ev,hook,direction,innerOffset,scope){_hook=hook;var gridScreenCoords=Jedox.wss.app.environment.gridScreenCoords,scrollType=Jedox.wss.grid.scrollType,horScrollDir=Jedox.wss.grid.horScrollDir,vertScrollDir=Jedox.wss.grid.vertScrollDir,activeBook=Jedox.wss.app.activeBook,scrollAction=0;var cbStartScrollGrid=function(){if(direction==scrollType.ALL||direction==scrollType.VERT){if(ev.clientY>=gridScreenCoords[0][1]&&ev.clientY<=gridScreenCoords[1][1]){activeBook.stopScrollGrid(scrollType.VERT)}else{Jedox.wss.app.mouseUpObserver.subscribe(_stopScroll,scope);activeBook.scrollObserver.subscribe(hook,scope);if(ev.clientY>gridScreenCoords[1][1]){activeBook.startScrollGrid(undefined,scrollType.VERT,vertScrollDir.DOWN,_calcScrollSpeed(gridScreenCoords[2][1]-gridScreenCoords[1][1],ev.clientY-gridScreenCoords[1][1]))}else{activeBook.startScrollGrid(undefined,scrollType.VERT,vertScrollDir.UP,_calcScrollSpeed(gridScreenCoords[0][1],gridScreenCoords[0][1]-ev.clientY))}}}};if(direction==scrollType.ALL||direction==scrollType.HORIZ){if(innerOffset==undefined){if(ev.clientX<gridScreenCoords[0][0]){scrollAction--}else{if(ev.clientX>gridScreenCoords[1][0]){scrollAction++}}}else{if(ev.clientX>=gridScreenCoords[0][0]&&ev.clientX<=gridScreenCoords[0][0]+innerOffset){scrollAction--}else{if(ev.clientX>=gridScreenCoords[1][0]-innerOffset&&ev.clientX<=gridScreenCoords[1][0]){scrollAction++}}}if(scrollAction==0){activeBook.stopScrollGrid(scrollType.HORIZ)}else{Jedox.wss.app.mouseUpObserver.subscribe(_stopScroll,scope);if(hook!=null){activeBook.scrollObserver.subscribe(hook,scope)}if(scrollAction>0){activeBook.startScrollGrid([this,cbStartScrollGrid],scrollType.HORIZ,horScrollDir.RIGHT,(innerOffset==undefined)?_calcScrollSpeed(gridScreenCoords[2][0]-gridScreenCoords[1][0],ev.clientX-gridScreenCoords[1][0]):_defScrollSteps[1][1])}else{activeBook.startScrollGrid([this,cbStartScrollGrid],scrollType.HORIZ,horScrollDir.LEFT,_calcScrollSpeed(gridScreenCoords[0][0],gridScreenCoords[0][0]-ev.clientX))}return}}cbStartScrollGrid()}};Jedox.wss.cls.CursorField=function(domID,container,areaPres){var _cursorFld;var _env=Jedox.wss.app.environment;this.getCursorField=function(){return _cursorFld};this.draw=function(activeCell,activeCellCoords){var viewMode=Jedox.wss.grid.viewMode,offsets=(_env.viewMode==viewMode.DESIGNER)?{t:1,l:0,w:-6,h:-6}:{t:-1,l:-1,w:-5,h:-5},activeBook=Jedox.wss.app.activeBook,selCelFVal=(activeBook==undefined)?_env.selectedCellValue:activeBook.getCellValue(activeCellCoords.getX(),activeCellCoords.getY()),defDraw=true;if(selCelFVal==undefined){selCelFVal=""}if(activeBook==undefined){if(selCelFVal.indexOf("<")==0){defDraw=false}}else{var cellType=activeBook.getCellType(activeCellCoords.getX(),activeCellCoords.getY());defDraw=(cellType==undefined||cellType=="s"||cellType=="n"||cellType=="b"||cellType=="e")}_cursorFld.style.left=activeCell.ulX+offsets.l+"px";_cursorFld.style.top=activeCell.ulY+offsets.t+"px";_cursorFld.style.width=activeCell.lrX-activeCell.ulX+offsets.w+"px";_cursorFld.style.height=activeCell.lrY-activeCell.ulY+offsets.h+"px";if(defDraw){Jedox.util.setText(_cursorFld,selCelFVal)}else{while(_cursorFld.childNodes.length>=1){_cursorFld.removeChild(_cursorFld.firstChild)}_cursorFld.appendChild(_env.selectedCell.firstChild.cloneNode(true))}Jedox.wss.style.cellTransfer(_cursorFld);_cursorFld.style.display="block"};this.hide=function(){_cursorFld.style.display="none"};this.show=function(){_cursorFld.style.display="block"};function _init(){var viewMode=Jedox.wss.grid.viewMode;_cursorFld=document.createElement("div");_cursorFld.id="".concat(domID,"_cursorField");_cursorFld.ondblclick=function(){Jedox.wss.mouse.showCursorLayer("marker_sand_clock");var selCellCoords=_env.selectedCellCoords;var cbRes=Jedox.wss.app.activeBook.cbFire(selCellCoords[0],selCellCoords[1],"dblclick",{c:selCellCoords[0],r:selCellCoords[1]});Jedox.wss.mouse.hideCursorLayer();if(!cbRes){return false}Jedox.wss.general.setInputMode(_cursorFld.innerHTML!=""?Jedox.wss.grid.GridMode.EDIT:Jedox.wss.grid.GridMode.INPUT);Jedox.wss.general.showInputField(null,false,true)};if(_env.viewMode==viewMode.DESIGNER){_cursorFld.onmousedown=function(ev){if(document.all){ev=window.event}var selCellCoords=_env.selectedCellCoords;if(!Jedox.wss.app.activeBook.cbFire(selCellCoords[0],selCellCoords[1],"mousedown",ev)){return false}if(ev.button==2||(Ext.isMac&&ev.button==0&&Jedox.wss.app.ctrlKeyPressed)){Jedox.wss.mouse.showMainCntxMenu(ev)}else{if(_env.inputMode==Jedox.wss.grid.GridMode.DIALOG&&Jedox.wss.app.sourceSel){Jedox.wss.mouse.initSourceRange(Jedox.wss.app.activeBook.getCellByCoords(selCellCoords[0],selCellCoords[1]),selCellCoords)}else{var singleCell=areaPres._selection.isSingleCell();areaPres._selection.set(new Jedox.wss.cls.Point(selCellCoords[0],selCellCoords[1]),new Jedox.wss.cls.Point(selCellCoords[0],selCellCoords[1]));if(!singleCell){areaPres._selection.draw()}areaPres.registerForMouseMovement(_env.selectedCell)}}};_cursorFld.onmouseover=function(){_env.lastCell=_env.selectedCell;_env.lastCellCoords=_env.selectedCellCoords};_cursorFld.className="activeCellElement cursorField default-format"}else{if(_env.viewMode==viewMode.USER){_cursorFld.className="cursorFieldUM default-format"}}_cursorFld.style.display="none";container.appendChild(_cursorFld);_env.cursorField=_cursorFld}_init()};Jedox.wss.workspace=new function(){var that=this,_workspace=document.getElementById("workspace"),_heightDecrement=document.getElementById("barsContainer").offsetHeight+document.getElementById("statusBarContainer").offsetHeight,_panel=null,_windows=[],_openWinNum=0,_minimizedWins=[];this.activeWin=null;this.windowsArrangement="tiled";var GridWindow=Ext.extend(Ext.Window,{initComponent:function(){GridWindow.superclass.initComponent.call(this)},minimize:function(){if(!this._minimized){this._isMinimizing=true;if(this.id==Jedox.wss.workspace.activeWin.id){var arrWins=Jedox.wss.workspace.getVisibleWinsList();if(arrWins.length>1){Jedox.wss.workspace.activeWin=arrWins[1]}}this._restoreData={w:((this.maximized)?this.restoreSize.width:this.getSize().width),x:((this.maximized)?this.restorePos[0]:this.x),y:((this.maximized)?this.restorePos[1]:this.y)};var titleSize=Ext.util.TextMetrics.measure(this.header.id,this.title);if(titleSize.width>70){var headerId=this.header.id;var _getNewName=function(inName,inWidth){if(Ext.util.TextMetrics.measure(headerId,inName+"...").width>inWidth){return _getNewName(inName.substring(0,inName.length-1),inWidth)}else{return inName+"..."}};this._restoreData.title=this.title;this.setTitle(_getNewName(this.title.substring(0,this.title.length-1),70))}this.restore();this._minimized=true;this.toBack();this.collapse();this.tools.restore.show();this.tools.maximize.show();this.tools.minimize.hide();this.setWidth(150);var _wsH=_panel.getInnerHeight();var i=0;for(;i<_minimizedWins.length;i++){if(!_minimizedWins[i]){_minimizedWins[i]=true;this.setPosition(2*(i+1)+(150*i),_wsH-this.header.getSize().height-2);this._restoreData.position=i;break}}if(i==_minimizedWins.length){_minimizedWins[i]=true;this.setPosition(2*(i+1)+(150*i),_wsH-this.header.getSize().height-2);this._restoreData.position=i}delete this._isMinimizing}},restore:function(){if(this._minimized){this._isMinimizing=true;this._minimized=false;this.setWidth(this._restoreData.w);this.setPosition(this._restoreData.x,this._restoreData.y);if(this._restoreData.title){this.setTitle(this._restoreData.title)}delete this._isMinimizing;this.expand();this.tools.minimize.show();this.tools.restore.hide();_minimizedWins[this._restoreData.position]=false;delete this._restoreData}else{GridWindow.superclass.restore.call(this)}},maximize:function(){GridWindow.superclass.maximize.call(this);if(this._minimized){this._minimized=false;if(this.maximized){this.restoreSize.width=this._restoreData.w;this.restorePos=[this._restoreData.x,this._restoreData.y];if(this._restoreData.title){this.setTitle(this._restoreData.title)}}this.tools.minimize.show();_minimizedWins[this._restoreData.position]=false;delete this._restoreData}},show:function(animateTarget,callback,scope){GridWindow.superclass.show.call(this,animateTarget,callback,scope);if(this._minimized){this.collapse()}}});var _hasMinimizedWins=function(){for(var i=0;i<_minimizedWins.length;i++){if(_minimizedWins[i]){return true}}return false};var _getHeight=function(){return document.getElementById("barsContainer").offsetHeight+document.getElementById("statusBarContainer").offsetHeight};this.resizeMaxWindows=function(){for(var i=0;i<_windows.length;i++){if((_windows[i])&&(_windows[i][1])&&(_windows[i][1].maximized)){_windows[i][1].setHeight((window.innerWidth?window.innerHeight:document.documentElement.clientHeight)-_getHeight())}}};this.resize=function(){var newheight=(window.innerWidth?window.innerHeight:document.documentElement.clientHeight)-_getHeight();_workspace.style.height="".concat(newheight,"px");_panel.setHeight(newheight);if(_hasMinimizedWins()){for(var tmpWin,i=0;i<_windows.length;i++){if((_windows[i])&&(_windows[i][1])){tmpWin=_windows[i][1];if(tmpWin._minimized){tmpWin.setPosition(tmpWin.getPosition()[0],newheight-tmpWin.header.getSize().height-2)}}}}};this.createWindow=function(title){var enaRestr=!Jedox.wss.app.UPRestrictMode;return new GridWindow({width:900,height:300,minWidth:350,minHeight:150,maximizable:true,minimizable:enaRestr,bodyBorder:false,border:true,header:false,footer:false,plain:true,shadow:false,hideBorders:true,title:title,onEsc:Ext.emptyFn,contentEl:document.createElement("div"),closable:enaRestr,_minimized:false,_winId:_windows.length})};this.displayWindow=function(win,uid,ghn){var winId=win.initialConfig._winId,title=win.initialConfig.title;if(winId!=_windows.length){return false}var winEntry=[title,win,undefined,uid,ghn];_windows.push(winEntry);_panel.add(win);win.render(_panel.body);win.show();win.maximize();that.activeWin=win;winEntry[2]=_addWinMenuLnk(winId,title);return true};this.showWin=function(winId){var win=_windows[winId][1];win.toFront();that.activeWin=win;if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.DESIGNER){that.chkHBCtl()}};this.showWinByWbId=function(wbId){for(var win=_windows,i=win.length-1;i>=0;--i){if(win[i]!=undefined&&win[i][3]==wbId){that.showWin(i);break}}};this.showWinByMeta=function(wbName,wbGhn){for(var win=_windows,name=wbName,ghn=wbGhn,i=win.length-1;i>=0;--i){if(win[i]!=undefined&&(ghn!=undefined?win[i][4]!=null&&win[i][4]["g"]==ghn.g&&win[i][4]["h"]==ghn.h&&win[i][4]["n"]==ghn.n:win[i][4]==null)&&win[i][0]==name){that.showWin(i);return true}}Jedox.wss.general.showMsg("Application Error".localize(),"noWBtoSwitch".localize(),Ext.MessageBox.ERROR);return false};this.chkWinByWbId=function(wbId){for(var win=_windows,i=win.length-1;i>=0;--i){if(win[i]!=undefined&&win[i][3]==wbId){return true}}return false};this.cleanupWinClose=function(winId){_delWinMenuLnk(winId);if(that.activeWin==_windows[winId][1]){that.activeWin=undefined}_windows[winId]=undefined;if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.DESIGNER){Jedox.wss.app.currFormula.value="";Jedox.wss.app.currCoord.value="";that.chkHBCtl()}};_addWinMenuLnk=function(winId,winName){if(Jedox.wss.app.UPRestrictMode){return}if(winName.length>30){winName=winName.substring(0,14).concat("...",winName.substring(winName.length-9))}return(Jedox.wss.app.menubar?Jedox.wss.app.menubar.windowMenu:Jedox.wss.app.toolbar.openDocs).add({id:"".concat("menu-win-",++_openWinNum),text:"".concat(_openWinNum,". ",winName),href:"javascript: Jedox.wss.workspace.showWin(".concat(winId,");")})};this.chkHBCtl=function(){var activeSheet=Jedox.wss.app.activeSheet;if(activeSheet==undefined||!activeSheet.isClone()){Jedox.wss.hb.syncCntrl(false);Jedox.wss.hb.enaDisHBAdd("enable")}else{Jedox.wss.hb.syncCntrl(true);Jedox.wss.hb.enaDisHBAdd("disable")}};_delWinMenuLnk=function(winId){(Jedox.wss.app.menubar?Jedox.wss.app.menubar.windowMenu:Jedox.wss.app.toolbar.openDocs).remove(_windows[winId][2]);var openwn=0;for(var win,itemTxt,len=_windows.length,id=0;id<len;++id){win=_windows[id];if(win==undefined||id==winId){continue}itemTxt=win[2].text;win[2].setText("".concat(++openwn,itemTxt.substring(itemTxt.indexOf(". "))))}_openWinNum=openwn};this.updateMeta=function(winId,winName,ghn){_windows[winId][0]=winName;_windows[winId][2].setText(_windows[winId][2].getId().substring(9).concat(". ",winName));_windows[winId][4]=ghn};_panel=new Ext.Panel({renderTo:_workspace,autoWidth:true,bodyBorder:false,border:false,bodyStyle:"background-color: transparent;",elements:"body"});this.getVisibleWinsList=function(){if((_windows.length>0)&&(that.activeWin)){var winList=[that.activeWin];var activeWinId=that.activeWin.id;for(var i=0;i<_windows.length;++i){if((_windows[i])&&(_windows[i][1])&&(_windows[i][1].id!=activeWinId)&&(_windows[i][1].isVisible())&&(!_windows[i][1]._minimized)){winList[winList.length]=_windows[i][1]}}return winList}return[]};this.hideActiveWin=function(){if(that.getVisibleWinsList().length>1){try{var metaData=this.getMetaByWinId(Jedox.wss.app.activeBook.getWinId());for(var triggers=Jedox.wss.events.triggers.hideWorkbook_before,i=triggers.length-1,wbMeta=metaData;i>=0;i--){triggers[i][0]["hideWorkbook_before"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}that.activeWin.hide();Jedox.wss.action.adjustToACL();for(var triggers=Jedox.wss.events.triggers.hideWorkbook_after,i=triggers.length-1,wbMeta=metaData;i>=0;i--){triggers[i][0]["hideWorkbook_after"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}}};this.getHiddenWinsList=function(){var winList=[];if((_windows.length>0)&&(that.activeWin)){for(var i=0;i<_windows.length;i++){if((_windows[i])&&(_windows[i][1])&&(!_windows[i][1].isVisible())){winList[winList.length]=_windows[i][1]}}}return winList};this.hasMinimized=function(){return _hasMinimizedWins()};this.getMetaByWinId=function(winId){return{name:_windows[winId][0],ghn:_windows[winId][4]}};this.closeActiveWin=function(){Jedox.wss.general.chkState();var actWin=this.activeWin;actWin.close();return actWin!=this.activeWin};this.closeWinByMeta=function(wbName,wbGhn){for(var win=_windows,name=wbName,ghn=wbGhn,i=win.length-1;i>=0;--i){if(win[i]!=undefined&&(ghn!=undefined?win[i][4]!=null&&win[i][4]["g"]==ghn.g&&win[i][4]["h"]==ghn.h&&win[i][4]["n"]==ghn.n:win[i][4]==null)&&win[i][0]==name){if(that.activeWin==win[i][1]){Jedox.wss.general.chkState()}win[i][1].close();var clsDone=win[i]==undefined;if(!clsDone){this.showWinByMeta(wbName,wbGhn)}return clsDone}}Jedox.wss.general.showMsg("Application Error".localize(),"noWBtoClose".localize(),Ext.MessageBox.ERROR);return false};this.notifyCloseByMeta=function(wbMeta){try{for(var triggers=Jedox.wss.events.triggers.closeWorkbook_after,i=triggers.length-1;i>=0;--i){triggers[i][0]["closeWorkbook_after"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}};this.resize()};Jedox.wss.range=new function(){this.RangeMode={NONE:0,EDIT:1,HIDDEN:2};this.RangeType={NORMAL:0,FORMULA:1,MARK:2};this.AreaStatus={NORMAL:0,HOVERING:1,DRAGGING:2,RESIZING:3,EXPANDING:4,MOVING:5};this.AreaState={NORMAL:0,NEW:1};this.BorderState={NORMAL:0,BOLD:1,UNKOWN:2,DOTTED:3};this.DisplayStatus={VISIBLE:0,HIDDEN:1};this.ResizeDirection={NONE:0,SOUTH_EAST:1,SOUTH_WEST:2,NORTH_EAST:3,NORTH_WEST:4};this.ContentType={FORMULA:1,STYLE:2,FORMAT:4,ATTRS:8,CNDFMT:16,ALL_CLEAR:1|2|4|8,ALL_PASTE:1|2|4|8|16,VALUE:32};this.drawDependingCells=function(formulastr){var env=Jedox.wss.app.environment,refs=Jedox.wss.formula.parse(formulastr,Jedox.wss.app.activePane.getCellNFs(env.selectedCellCoords[0],env.selectedCellCoords[1]));if(refs.sgn==env.formulaSelection.lastParseRes.sgn){return}env.formulaSelection.lastParseRes=refs;var refs_tbl=refs.tbl,toks={},tok,key;for(key in refs_tbl){toks[key]=refs_tbl[key].slice()}for(var area,area_tok,states=Jedox.wss.range.AreaState,areas=env.formulaSelection.getRanges().slice(),i=areas.length-1;i>=0;--i){area=areas[i];area_tok=area.formulaToken;key=area_tok.key;if(!(key in toks)){env.formulaSelection.removeRange(i);continue}tok=toks[key].shift();if(area_tok.id!=tok.id||area.getState()==states.NEW){area_tok.id=tok.id,area.setState(states.NORMAL),area.repaint()}area.formulaToken=tok;if(!toks[key].length){delete toks[key]}}var activeSheet=Jedox.wss.app.activeBook.getSheetSelector().getActiveSheetName(),Point=Jedox.wss.cls.Point;for(key in toks){for(var i=toks[key].length-1;i>=0;--i){tok=toks[key][i];if(tok.sheet.length&&tok.sheet!=activeSheet){continue}var area=env.formulaSelection.getRange(env.formulaSelection.addRange(new Point(tok.rng[0],tok.rng[1]),new Point(tok.rng[2],tok.rng[3]),tok.nf)-1);area.formulaToken=tok;area.draw()}}};this.getCellCoord=function(cell){return[[Jedox.util.offsetLeft(cell),Jedox.util.offsetLeft(cell)+cell.offsetWidth],[Jedox.util.offsetTop(cell),Jedox.util.offsetTop(cell)+cell.offsetHeight]]}};Jedox.wss.grid=new function(){this.ScrollDirection={UP:1,DOWN:2,LEFT:4,RIGHT:8,DOWN_RIGHT:10,UP_LEFT:5,NONE:11};this.GridMode={READY:0,EDIT:1,INPUT:2,POINT:3,CNTRL:4,DIALOG:5};this.IterationMode={NEXT:0,PREV:1,NEXTX:2,PREVY:3,PREVX:4,NEXTY:5,FIRST:6,LAST:7};this.viewMode={DESIGNER:"designer",USER:"user",PREVIEW:"preview"};this.headerType={COLUMN:0,ROW:1,NONE:2};this.scrollType={HORIZ:0,VERT:1,ALL:2};this.vertScrollDir={UP:-1,DOWN:1};this.horScrollDir={LEFT:-1,RIGHT:1};this.gridOperation={COPY:0,CUT:1};this.permission={PERM_NONE:0,PERM_READ:1,PERM_WRITE:3,PERM_DELETE:7,PERM_SPLASH:15};var _cbHandles={};this.defMaxCoords=[256,65536];this.defCachePageSize=[256,1024];this.defLoadTableCoef=1.2;this.defDefColRowDims=[64,20];this.defCellSizeIncr=[5,5];this.defVertSBIncr={designer:20,user:0};this.defRightBottomOffset={designer:[42+17,20+17],user:[17,17]};this.defScrollbarBGOffset=[2*17,2*17];this.defSliderBorderElemsSize=[8,8];this.defSliderCenterElemSize=[8,8];this.defDefScrollSpeed=80;this.defScrollSteps=[[25,250],[50,150],[75,50],[100,25]];this.maxGridOffset=[41,44];this.cbReg=function(handle,cb){if(_cbHandles[handle]!=undefined||typeof cb[0]!="object"||typeof cb[1]!="function"){return false}_cbHandles[handle]=cb;return true};this.cbGet=function(handle){return _cbHandles[handle]}};Jedox.wss.grid.PaneStorage=function(pane){this._pane=pane;this._json=Ext.util.JSON;this._mapJStoCSS=Jedox.wss.style.mapJStoCSS;this._tbl=[];var w=pane._numCols,h=pane._numRows;for(var row,i=h-1;i>=0;--i){row=this._tbl[i]=[],row.length=w}};Jedox.wss.grid.PaneStorage.prototype={set:function(x,y,obj,comb){if(obj==undefined){return this.del(x,y)}var cobj;if(comb&&(cobj=this._tbl[y][x])){if("_pend" in cobj&&!("_pend" in obj)){delete cobj._pend}for(var type in obj){if(obj[type]!==""){cobj[type]=obj[type]}else{delete cobj[type]}}}else{this._tbl[y][x]=obj}},setPart:function(x,y,val,type){switch(type){case"s":var cell=this._tbl[y][x],styleDef,styleOld;if(cell&&(styleOld=cell.s)){var attrCSS,attrDef,styleNew=styleOld;for(var attr in val){if((attrCSS=this._mapJStoCSS[attr])==undefined){continue}attrDef=attrCSS.concat(":",val[attr],";");if(styleNew.indexOf(attrDef)!=-1){continue}if(styleNew.indexOf(attrCSS)==-1){styleNew=styleNew.concat(attrDef);continue}var re=new RegExp(attrCSS.concat(":[^;]*;"),"i");styleNew=styleNew.replace(re,attrDef)}if(styleNew!=styleOld){cell.s=styleNew}}else{if(styleDef=Jedox.wss.style.convJStoCSS(val)){this.set(x,y,{s:styleDef},true)}}return}},setRangePart:function(x1,y1,x2,y2,val,type){switch(type){case"k":var cell;if(val==true){for(var y=y1;y<=y2;++y){for(var x=x1;x<=x2;++x){if((cell=this._tbl[y][x])&&"k" in cell){delete cell.k}}}}else{for(var y=y1;y<=y2;++y){for(var x=x1;x<=x2;++x){if(cell=this._tbl[y][x]){cell.k=false}else{this._tbl[y][x]={k:false}}}}}return}},setAttr:function(x,y,attrs,comb){var cell=this._tbl[y][x];if(cell){if(comb&&"a" in cell){for(name in attrs){cell.a[name]=attrs[name]}}else{cell.a=attrs}}else{this._tbl[y][x]={a:attrs}}},getAttr:function(x,y,name){var cell=this._tbl[y][x];if(cell&&"a" in cell){return cell.a[name]}return undefined},del:function(x,y){delete this._tbl[y][x]},delPart:function(x,y,type){var cell=this._tbl[y][x];if(cell){delete cell[type]}},get:function(x,y){return this._tbl[y][x]},getPart:function(x,y,type){var cell=this._tbl[y][x];if(cell){return cell[type]}return undefined},fetch:function(x,y,prop){if(y in this._tbl){var cell=this._tbl[y][x];if(cell){return prop?cell[prop]:cell}}return undefined},has:function(x,y){return y in this._tbl&&this._tbl[y][x]!=undefined},hasPart:function(x,y,type){return y in this._tbl&&this._tbl[y][x]!=undefined&&type in this._tbl[y][x]}};Jedox.wss.grid.PaneCache=function(pane){this._pane=pane;this._conn=Jedox.wss.backend.conn;this._json=Ext.util.JSON;this._xhrHdrs=this._conn.xhrHdrs;this._raCoef=this._READAHEAD_COEF;this.clear()};Jedox.wss.grid.PaneCache.prototype={_READAHEAD_COEF:2,clear:function(){this._map={};this._rng=[0,0,0,0]},get:function(x,y){if(x in this._map){return this._map[x][y]}return undefined},getPart:function(x,y,type){if(x in this._map){x=this._map[x];if(y in x){return x[y][type]}return undefined}return undefined},has:function(x,y){return x in this._map&&y in this._map[x]},hasPart:function(x,y,type){return x in this._map&&y in this._map[x]&&type in this._map[x][y]},abort:function(){if(this._activeXHR){this._activeXHR.abort();delete this._activeXHR}},miss:function(rng){return rng[0]<this._rng[0]||rng[2]>this._rng[2]||rng[1]<this._rng[1]||rng[3]>this._rng[3]},load:function(cb,rng,opts,spec){if(typeof opts!="object"){opts={}}if(opts.sdr in rng){var h_incr=this._pane._numCols*this._raCoef,v_incr=this._pane._numRows*this._raCoef,fuc=this._pane._sheet._farthestUsedCell;switch(opts.sdr){case 0:if((rng[0]-=h_incr)<1){rng[0]=1}break;case 2:if((rng[2]+=h_incr)>fuc[0]){rng[2]=fuc[0]}break;case 1:if((rng[1]-=v_incr)<1){rng[1]=1}break;case 3:if((rng[3]+=v_incr)>fuc[1]){rng[3]=fuc[1]}break}}var that=this,xhr=new XMLHttpRequest();xhr.open("POST","/spreadsheet/ub/ccmd",true);for(var hdrName in this._xhrHdrs){xhr.setRequestHeader(hdrName,this._xhrHdrs[hdrName])}xhr.onreadystatechange=function(ev){if(xhr.readyState==4&&xhr.status==200){that.fill.call(that,cb,that._json.decode(xhr.responseText),rng,opts)}};xhr.send('[["grar",'.concat(this._conn.Q_ALL,",",rng[0],",",rng[1],",",rng[2],",",rng[3],opts.rfr?",true]]":"]]"));if(spec){delete this._activeXHR}else{this._activeXHR=xhr}},fill:function(cb,rgns,rng,opts){var map=this._map={},grid=this._pane.getGridRng(),frn=opts.frn?this._pane.furnishCell:false;this._rng=rng;rgns=rgns[0];for(var rgn,i=0;(rgn=rgns[++i])!=undefined;){for(var cell,x=rgn[0],y=rgn[1],w=rgn[2],j=2;(cell=rgn[++j])!=undefined;){if(!(x in map)){map[x]={}}map[x][y]=cell;if(frn&&x>=grid[0]&&x<=grid[2]&&y>=grid[1]&&y<=grid[3]){frn.call(this._pane,x,y,cell)}if(++x-rgn[0]>=w&&w>0){++y,x=rgn[0]}}}if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}}};Jedox.wss.grid.Pane=function(cb,sheet,id,contentEl){var that=this;this._inited=false;this._sheet=sheet;this._book=sheet._book;this._id=id;this._domId=sheet._domId.concat("P",id);this._contentEl=contentEl;this._conf=sheet._paneConf[id];this._winObj=sheet._winObj;this.scrollObserver=this._book.scrollObserver;this._viewMode=Jedox.wss.app.appMode;this._app=Jedox.wss.app;this._jwgrid=Jedox.wss.grid;this._jwstyle=Jedox.wss.style;this._jutil=Jedox.util;this._conn=Jedox.wss.backend.conn;this._ha=Jedox.wss.backend.ha;this._srl=this._jutil.serializer;this._n2l=this._app.numberToLetter;this._setText=this._jutil.setText;this._gmode_edit=sheet._gmode_edit;this._colWidths=sheet._colWidths;this._rowHeights=sheet._rowHeights;this._env=new Jedox.wss.cls.Environment();Jedox.wss.app.environment=this._env.shared;this._env.shared.viewMode=this._viewMode;var winPos=this._winObj.getPosition(),gridOffset=this._jwgrid.maxGridOffset;this._env.shared.gridScreenCoordsMax=[winPos[0]+gridOffset[0],winPos[1]+gridOffset[1]];this._app.activePane=this._book._aPane=sheet._aPane=this;var x=this._conf.coords.x,y=this._conf.coords.y;if(this._gmode_edit){this._colHdrsOC=sheet["_colHdrsOC".concat(x)];this._colHdrsIC=sheet["_colHdrsIC".concat(x)];this._colHdrs=sheet["_colHdrs".concat(x)];this._rowHdrsOC=sheet["_rowHdrsOC".concat(y)];this._rowHdrsIC=sheet["_rowHdrsIC".concat(y)];this._rowHdrs=sheet["_rowHdrs".concat(y)]}this._numCols=sheet["_numCols".concat(x)];this._numRows=sheet["_numRows".concat(y)];this._tableSize=[this._numCols,this._numRows];this._maxCoords=[this._conf.range[2],this._conf.range[3]];this._tableMat=[];this._tableRows=[];this._colSeps=[];this._cppi=[];this._cpp=[];this._defcppi=[];this._defcpp=[];this._farthestSeenCell=[];this._loadTableCoef=this._jwgrid.defLoadTableCoef;this._currTopCell=[1,1];this._oldCTC=[1,1];this._lastDestCell=[0,0];this._lastDoneDestCell=[0,0];this._cellSizeIncr=this._jwgrid.defCellSizeIncr;this._ocWidth=this._conf.coords.w;this._ocHeight=this._conf.coords.h;this._storage=new Jedox.wss.grid.PaneStorage(this);this._cache=new Jedox.wss.grid.PaneCache(this);this._numericSeps=Jedox.wss.i18n.separators;this._reThouSep=new RegExp("\\".concat(this._numericSeps[1]),"g");this._l10nBool=Jedox.wss.i18n.bool;this._rePaloData=new RegExp("^=PALO.DATAC?\\((.*)\\)$");this._genContentEl();this._oc=contentEl;this._ic=document.getElementById(this._domId+"_IC");this._oc.scrollLeft=0;this._oc.scrollTop=0;var mouse=Jedox.wss.mouse;if(this._gmode_edit){this._ic.onmouseover=mouse.overTracking}else{this._ic.ondblclick=mouse.mouseonCellDblClick}this._ic.onmousedown=mouse.mouseOnCellDown;for(var row,tr=this._tableRows,tm=this._tableMat,tw=this._numCols,rows=document.getElementsByName(this._domId+"_gridRow"),i=this._numRows-1;i>=0;--i){row=rows[i];tr[i]=row;tm[i]=[];for(var tmi=tm[i],cells=row.getElementsByTagName("div"),j=tw-1;j>=0;--j){tmi[j]=cells[j]}}this._firstRowCells=this._tableMat[0];this._env.shared.inputField=document.getElementById(this._domId+"_inputField");if(this._gmode_edit){for(var cs=this._colSeps,seps=document.getElementsByName(this._domId+"_colSep"),i=this._numCols-1;i>=0;--i){cs[i]=seps[i]}this._env.shared.defaultSelection=this._defaultSelection=new Jedox.wss.grid.DefaultSelection(new Jedox.wss.cls.Point(1,1),this);this._env.shared.formulaSelection=this._formulaSelection=new Jedox.wss.grid.FormulaSelection(new Jedox.wss.cls.Point(1,1),this);this._env.shared.copySelection=this._copySelection=new Jedox.wss.grid.CopySelection(new Jedox.wss.cls.Point(1,1),this);this._env.shared.autoScroll=new Jedox.wss.cls.AutoScroll();this._ic.onselectstart=this._jutil.ignoreSelection;this._env.shared.inputField.onkeyup=Jedox.wss.keyboard.setFieldContent;this._env.shared.inputField.onselectstart=this._jutil.unignoreSelection;this._env.shared.inputField.onmousedown=function(){if(Jedox.wss.app.fromFormulaField){that._env.shared.inputMode=that._jwgrid.GridMode.EDIT}that._formulaSelection.activeToken=null}}else{this._cursorField=new Jedox.wss.cls.CursorField(this._domId,this._ic,null);this._env.shared.inputField.onkeyup=Jedox.wss.keyboard.setFieldSize}this._env.shared.inputField.onfocus=function(){Jedox.wss.app.lastInputField=that._env.shared.inputField};this._fit();if(this._sheet._farthestUsedCell[0]>this._defcppi[0]+2){this._farthestSeenCell[0]=this._sheet._farthestUsedCell[0]}else{this._farthestSeenCell[0]=this._defcppi[0]+2}if(this._sheet._farthestUsedCell[1]>this._defcppi[1]+2){this._farthestSeenCell[1]=this._sheet._farthestUsedCell[1]}else{this._farthestSeenCell[1]=this._defcppi[1]+2}if(this._currTopCell[0]>this._sheet._farthestUsedCell[0]||this._currTopCell[1]>this._sheet._farthestUsedCell[1]){this._load_wsels(cb)}else{this._cache.load([this,this._load_wsels,cb],this.getGridRng(),{frn:true})}};Jedox.wss.grid.Pane.prototype={_SCROLL_BACK:-1,_SCROLL_FWD:1,_load_wsels:function(cb){this._conn.createBatch();Jedox.wss.general.createWorksheetElements();Jedox.wss.hb.loadAll();Jedox.wss.wsel.loadAll();Jedox.wss.wsel.img.loadAll();this._conn.sendBatch([this,this._init_post,cb])},_init_post:function(res,cb){if(this._gmode_edit){this._defaultSelection.selectFirstCell();Jedox.wss.hb.syncCntrl(false);Jedox.wss.hb.enaDisHBAdd("enable");Jedox.wss.general.refreshCursorField()}this._book._sheetSelector.enable(true);this._inited=true;if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}},_genContentEl:function(){var html=['<div id="',this._domId,'_IC" class="paneIC">'];var cws=this._colWidths,rhs=this._rowHeights,wdecr=this._cellSizeIncr[0],hdecr=this._cellSizeIncr[1];if(this._gmode_edit){for(var c=this._conf.range[0],l=0,i=this._numCols-1;i>=0;l+=cws.getElemAt(c++),--i){html.push('<div id="',this._domId,'_colSep" name="',this._domId,'_colSep" class="gridColSep" style="left:',l,'px;"></div>')}}for(var t=0,r=this._conf.range[1],rh=rhs.getElemAt(r),i=this._numRows-1;i>=0;t+=rh,rh=rhs.getElemAt(++r),--i){html.push('<div class="gridRow" id="',this._domId,'_gridRow" name="',this._domId,'_gridRow" style="top:',t,"px;",(rh?"height:".concat(rh-hdecr,"px;"):"display:none;"),'">');for(var l=0,c=this._conf.range[0],cw=cws.getElemAt(c),j=this._numCols-1;j>=0;l+=cw,cw=cws.getElemAt(++c),--j){html.push('<div class="gridCell" style="left:',l,"px;",(cw?"width:".concat(cw-wdecr,"px;"):"display:none;"),'"></div>')}html.push("</div>")}html.push('<textarea class="inputField default-format" id="',this._domId,'_inputField" name="',this._domId,'_inputField"></textarea><div class="HeaderMarker" id="',this._domId,'_startMarker"></div><div class="HeaderMarker" id="',this._domId,'_stopMarker"></div></div>');this._contentEl.innerHTML=html.join("")},_fit:function(cb){this._env.shared.winStateMax=this._winObj.maximized;this._ocWidth=this._conf.coords.w;this._ocHeight=this._conf.coords.h;var pos=this._lastDestCell[0]+1,sum=this._colWidths.getElemAt(pos),els;for(var max=this._ocWidth,cw=this._colWidths;sum<=max;sum+=cw.getElemAt(++pos)){}this._cppi[0]=pos-this._lastDestCell[0]-1;this._cpp[0]=this._cppi[0]+((els=this._colWidths.getElemAt(pos))-sum+this._ocWidth)/els;this._defcpp[0]=this._ocWidth/this._sheet._defColRowDims[0];this._defcppi[0]=parseInt(this._defcpp[0]);pos=this._lastDestCell[1]+1,sum=this._rowHeights.getElemAt(pos);for(var max=this._ocHeight,rh=this._rowHeights;sum<=max;sum+=rh.getElemAt(++pos)){}this._cppi[1]=pos-this._lastDestCell[1]-1;this._cpp[1]=this._cppi[1]+((els=this._rowHeights.getElemAt(pos))-sum+this._ocHeight)/els;this._defcpp[1]=this._ocHeight/this._sheet._defColRowDims[1];this._defcppi[1]=parseInt(this._defcpp[1]);if(!this._inited){return}var newDefFUC,lDCcppi;if(this._farthestSeenCell[0]<(newDefFUC=this._defcppi[0]+2)){this._farthestSeenCell[0]=newDefFUC}else{if((lDCcppi=this._lastDestCell[0]+this._cppi[0])>=this._sheet._farthestUsedCell[0]&&lDCcppi>=this._defcppi[0]+2){this._farthestSeenCell[0]=lDCcppi}}this._book._recalcSlider(0);if(this._farthestSeenCell[1]<(newDefFUC=this._defcppi[1]+2)){this._farthestSeenCell[1]=newDefFUC}else{if((lDCcppi=this._lastDestCell[1]+this._cppi[1])>=this._sheet._farthestUsedCell[1]&&lDCcppi>=this._defcppi[1]+2){this._farthestSeenCell[1]=lDCcppi}}this._book._recalcSlider(1);if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}},_reconstruct:function(cb,cDiff,rDiff,inScroll){if(cDiff>0){var lastCol=this._currTopCell[0]+this._numCols-1,dfCells=document.createDocumentFragment(),decr=this._cellSizeIncr[0],lastCell=this._firstRowCells[this._numCols-1],lastStoCell=this._srl.enc(this._storage._tbl[0][this._numCols-1]),cEdge=parseInt(lastCell.style.left)+this._colWidths.getElemAt(lastCol),c=lastCol,i=cDiff,cell,w,wpx,lpx,disp;if(this._gmode_edit){var dfSeps=document.createDocumentFragment(),lastSep=this._colSeps[this._numCols-1],sep;if(inScroll){var dfHdrs=document.createDocumentFragment(),lastHdr=this._colHdrs[this._numCols-1],hdr}}else{if(inScroll){inScroll=false}}do{cell=lastCell.cloneNode(true);cell.style.left=lpx="".concat(cEdge,"px");w=this._colWidths.getElemAt(++c);disp=false;if(w){cell.style.width=wpx="".concat(w-decr,"px");if(cell.style.display){cell.style.display=disp=""}}else{if(!cell.style.display){cell.style.display=disp="none"}}dfCells.appendChild(cell);if(this._gmode_edit){sep=lastSep.cloneNode(true);sep.style.left=lpx;dfSeps.appendChild(sep);this._colSeps.push(sep);if(inScroll){hdr=lastHdr.cloneNode(true);this._setText(hdr,this._n2l[c]);hdr.style.left=lpx;if(w){hdr.style.width=wpx}if(disp!==false){hdr.style.display=disp}dfHdrs.appendChild(hdr);this._colHdrs.push(hdr)}}cEdge+=w}while(--i);if(this._gmode_edit){this._ic.appendChild(dfSeps)}var cells,matRow,stoRow,j;i=this._numRows-1;do{cells=dfCells.cloneNode(true);matRow=this._tableMat[i];stoRow=this._storage._tbl[i];j=0;do{matRow.push(cells.childNodes[j]);stoRow.push(this._srl.dec(lastStoCell))}while(++j<cDiff);this._tableRows[i].appendChild(cells)}while(--i>=0);this._tableSize[0]=(this._numCols+=cDiff);if(inScroll){this._colHdrsIC.appendChild(dfHdrs);this._sheet["_numCols".concat(this._conf.coords.x)]=this._numCols}this._cache.load(null,this._jutil.reg2rng([lastCol+1,this._currTopCell[1]],cDiff,this._numRows),{frn:true,rfr:true},true)}if(rDiff>0){var lastRow=this._currTopCell[1]+this._numRows-1,dfTblRows=document.createDocumentFragment(),decr=this._cellSizeIncr[1],lastTblRow=this._tableRows[this._numRows-1],lastStoRow=this._srl.enc(this._storage._tbl[this._numRows-1]),rEdge=parseInt(lastTblRow.style.top)+this._rowHeights.getElemAt(lastRow),numCols=this._numCols,r=lastRow,i=rDiff,tblRow,h,firstCell,matRow,off,j,hpx,tpx,disp;if(this._gmode_edit){if(inScroll){var dfHdrs=document.createDocumentFragment(),lastHdr=this._rowHdrs[this._numRows-1],hdr}}else{if(inScroll){inScroll=false}}do{tblRow=lastTblRow.cloneNode(true);tblRow.style.top=tpx="".concat(rEdge,"px");h=this._rowHeights.getElemAt(++r);disp=false;if(h){tblRow.style.height=hpx="".concat(h-decr,"px");if(tblRow.style.display){tblRow.style.display=disp=""}}else{if(!tblRow.style.display){tblRow.style.display=disp="none"}}dfTblRows.appendChild(tblRow);this._tableRows.push(tblRow);firstCell=this._tableMat[this._numRows-1][0];off=-1;while(firstCell!=lastTblRow.childNodes[++off]){}matRow=[];j=off;do{matRow.push(tblRow.childNodes[j])}while(++j<numCols);j=0;do{matRow.push(tblRow.childNodes[j])}while(++j<off);this._tableMat.push(matRow);this._storage._tbl.push(this._srl.dec(lastStoRow));if(inScroll){hdr=lastHdr.cloneNode(true);this._setText(hdr,r);hdr.style.top=tpx;if(h){hdr.style.height=hpx}if(disp!==false){hdr.style.display=disp}dfHdrs.appendChild(hdr);this._rowHdrs.push(hdr)}rEdge+=h}while(--i);this._ic.appendChild(dfTblRows);this._tableSize[1]=(this._numRows+=rDiff);if(inScroll){this._rowHdrsIC.appendChild(dfHdrs);this._sheet["_numRows".concat(this._conf.coords.y)]=this._numRows}this._cache.load(null,this._jutil.reg2rng([this._currTopCell[0],lastRow+1],this._numCols,rDiff),{frn:true,rfr:true},true)}this._fit(cb)},_loadTable:function(doHoriz,doVert,fillCells,doClean){if(doVert){for(var hdr,ndh,tr,ntpx,rhd=this._rowHdrs,rhs=this._rowHeights,trs=this._tableRows,rhi=this._cellSizeIncr[1],ctc=this._currTopCell[1],i=this._numRows-1,ctci=ctc+i,nt=rhs.getSumUpTo(ctci),rh=rhs.getElemAt(ctci);i>=0;--i,nt-=(rh=rhs.getElemAt(--ctci))){ntpx="".concat(nt,"px");tr=trs[i];if(rh){if(tr.style.display!=""){ndh=";height:".concat(rh-rhi,"px;display:;")}else{if((rh-=rhi)!=parseInt(tr.style.height)){ndh=";height:".concat(rh,"px;")}else{ndh=""}}}else{ndh=tr.style.display!="none"?";display:none;":""}if(ndh.length){tr.style.cssText="top:".concat(ntpx,ndh)}else{tr.style.top=ntpx}if(this._gmode_edit){hdr=rhd[i];if(ndh.length){hdr.style.cssText="top:".concat(ntpx,ndh)}else{hdr.style.top=ntpx}this._setText(hdr,ctci)}}}if(doHoriz||fillCells){for(var hdr,nlpx,ndw,st,ch=this._colHdrs,cs=this._colSeps,ntl=this._n2l,cws=this._colWidths,rhs=this._rowHeights,cwi=this._cellSizeIncr[0],rhi=this._cellSizeIncr[1],frc=this._firstRowCells,tm=this._tableMat,th=this._numRows,decSep=this._numericSeps[0],l10nBool=this._l10nBool,ctc=this._currTopCell,j=this._numCols-1,ctcj=ctc[0]+j,nl=cws.getSumUpTo(ctcj),cw=cws.getElemAt(ctcj),dta=this._jwstyle.defTextAlign;j>=0;--j,nl-=(cw=cws.getElemAt(--ctcj))){nlpx="".concat(nl,"px");if(cw){st=frc[j].style;if(st.display!=""){ndw=true,cw=";width:".concat(cw-cwi,"px;display:;")}else{ndw=(cw-=cwi)!=parseInt(st.width),cw=";width:".concat(cw,"px;")}}else{ndw=frc[j].style.display!="none",cw=";display:none;"}for(var newc,oldc,cell,i=th-1,ctci=ctc[1]+i;i>=0;--i){newc=this._cache.get(ctcj,ctci--);oldc=this._storage.get(j,i);cell=tm[i][j];if(newc!=undefined&&"s" in newc){cell.style.cssText="left:".concat(nlpx,cw,newc.s);if(cell.style.borderTopWidth=="2px"){cell.style.width="".concat(cws.getElemAt(ctcj)-cwi-1,"px")}if(cell.style.borderLeftWidth=="2px"){cell.style.height="".concat(rhs.getElemAt(ctci+1)-rhi-1,"px")}}else{if(ndw||(oldc!=undefined&&"s" in oldc)||doClean){cell.style.cssText="left:".concat(nlpx,cw)}else{if(doHoriz){cell.style.left=nlpx}}}if(newc!=undefined&&"m" in newc&&newc.m[0]==true){if(cell.className.indexOf("mergedCell")==-1){cell.className+=" mergedCell"}for(var sum=0,max=newc.m[2],k=0;k<max;sum+=cws.getElemAt(ctcj+k++)){}cell.style.width="".concat(sum-cwi,"px");for(var sum=0,max=newc.m[1],k=0;k<max;sum+=rhs.getElemAt(ctci+ ++k)){}cell.style.height="".concat(sum-rhi,"px")}else{if(cell.className.indexOf("mergedCell")!=-1){cell.className="gridCell";cell.style.width="".concat(cws.getElemAt(ctcj)-cwi,"px");cell.style.height="".concat(rhs.getElemAt(ctci+1)-rhi,"px")}}if(newc!=undefined&&"m" in newc&&newc.m[0]==false){cell.style.visibility="hidden"}else{if(cell.style.visibility=="hidden"){cell.style.visibility=""}}if(newc!=undefined&&"v" in newc){switch(typeof newc.v){case"number":newc.v=decSep=="."?""+newc.v:(""+newc.v).replace(".",decSep);break;case"boolean":newc.v=l10nBool[newc.v];break}if(newc.t=="h"){cell.innerHTML=newc.v}else{this._setText(cell,newc.l||newc.v)}if("t" in newc&&cell.style.textAlign==""&&dta[newc.t]!=""){cell.style.textAlign=dta[newc.t]}}else{if((oldc!=undefined&&"v" in oldc)||doClean){this._setText(cell,"")}}if(!this._gmode_edit){if(newc!=undefined&&"k" in newc&&newc.k===false){cell.className="gridCell gridCellUnlocked"}else{if((oldc!=undefined&&"k" in oldc&&oldc.k===false)||doClean){cell.className="gridCell"}}}this._storage.set(j,i,newc)}if(doHoriz&&this._gmode_edit){hdr=ch[j];if(ndw){hdr.style.cssText="left:".concat(nlpx,cw)}else{hdr.style.left=nlpx}this._setText(hdr,ntl[ctcj]);cs[j].style.left=nlpx}}}},_calcScroll:function(params,amount){var type=params.type;if(params.dir==this._SCROLL_BACK){var fincoord=this._currTopCell[type]-amount;if(fincoord<1){amount+=fincoord-1;fincoord=1}var newcoord=this._currTopCell[type],oldcoord=this._currTopCell[type]+this._tableSize[type],s_amount=-amount}else{if(params.dir==this._SCROLL_FWD){var fincoord=this._currTopCell[type]+this._tableSize[type]-1+amount;if(fincoord>this._maxCoords[type]){amount-=fincoord-this._maxCoords[type]}else{if(fincoord>this._farthestSeenCell[type]+1){amount-=fincoord-this._farthestSeenCell[type]-1}}fincoord=this._currTopCell[type]+this._tableSize[type];var newcoord=fincoord-1,oldcoord=this._currTopCell[type]-1,s_amount=amount}else{return false}}if(amount>0){params.amount=amount;params.s_amount=s_amount;params.fincoord=fincoord;params.newcoord=newcoord;params.oldcoord=oldcoord}return true},_scrollTableX:function(dir,amount,newcoord,oldcoord){var newwidth,oldwidth,newleft,hdr,sep,wdiff,newx,cw=this._colWidths,rh=this._rowHeights,tw=this._numCols,th=this._numRows,csi=this._cellSizeIncr[0],rhi=this._cellSizeIncr[1],frc=this._firstRowCells,ch=this._colHdrs,cs=this._colSeps,ntl=this._n2l,decSep=this._numericSeps[0],l10nBool=this._l10nBool,tm=this._tableMat,st=this._storage._tbl,dta=this._jwstyle.defTextAlign,ctc=this._currTopCell[1];for(var i=amount;i>0;--i){if(dir==this._SCROLL_BACK){--newcoord;--oldcoord;newx=0;oldwidth=cw.getElemAt(oldcoord);newwidth=cw.getElemAt(newcoord);newleft="".concat(parseInt(frc[0].style.left)-newwidth,"px");if(this._gmode_edit){ch.unshift(hdr=ch.pop()),cs.unshift(sep=cs.pop())}}else{++newcoord;++oldcoord;newx=tw-1;oldwidth=cw.getElemAt(oldcoord);newwidth=cw.getElemAt(newcoord);newleft="".concat(parseInt(frc[tw-1].style.left)+cw.getElemAt(newcoord-1),"px");if(this._gmode_edit){ch.push(hdr=ch.shift()),cs.push(sep=cs.shift())}}if(newwidth!=oldwidth){wdiff=true;if(newwidth){newwidth=";width:".concat(newwidth-csi,"px;",(oldwidth?"":"display:;"))}else{newwidth=";display:none;"}}else{if(newwidth){wdiff=false,newwidth=";width:".concat(newwidth-csi,"px;")}else{wdiff=false,newwidth=";display:none;"}}if(this._gmode_edit){if(wdiff){hdr.style.cssText="left:".concat(newleft,newwidth)}else{hdr.style.left=newleft}this._setText(hdr,ntl[newcoord]);sep.style.left=newleft}for(var row,srow,cell,newc,oldc,j=th-1,ctcj=ctc+j;j>=0;--j,--ctcj){row=tm[j];srow=st[j];if(dir==this._SCROLL_BACK){row.unshift(cell=row.pop());srow.unshift(oldc=srow.pop())}else{row.push(cell=row.shift());srow.push(oldc=srow.shift())}newc=this._cache.get(newcoord,ctcj);if(newc!=undefined&&"s" in newc){cell.style.cssText="left:".concat(newleft,newwidth,newc.s);if(cell.style.borderTopWidth=="2px"){cell.style.width="".concat(cw.getElemAt(newcoord)-csi-1,"px")}if(cell.style.borderLeftWidth=="2px"){cell.style.height="".concat(rh.getElemAt(ctcj)-rhi-1,"px")}}else{if(wdiff||(oldc!=undefined&&"s" in oldc)){cell.style.cssText="left:".concat(newleft,newwidth)}else{cell.style.left=newleft}}if(newc!=undefined&&"m" in newc&&newc.m[0]==true){if(cell.className.indexOf("mergedCell")==-1){cell.className+=" mergedCell"}for(var sum=0,max=newc.m[2],k=0;k<max;sum+=cw.getElemAt(newcoord+k++)){}cell.style.width="".concat(sum-csi,"px");for(var sum=0,max=newc.m[1],k=0;k<max;sum+=rh.getElemAt(ctcj+k++)){}cell.style.height="".concat(sum-rhi,"px")}else{if(cell.className.indexOf("mergedCell")!=-1){cell.className="gridCell";cell.style.width="".concat(cw.getElemAt(newcoord)-csi,"px");cell.style.height="".concat(rh.getElemAt(ctcj)-rhi,"px")}}if(newc!=undefined&&"m" in newc&&newc.m[0]==false){cell.style.visibility="hidden"}else{if(cell.style.visibility=="hidden"){cell.style.visibility=""}}if(newc!=undefined&&"v" in newc){switch(typeof newc.v){case"number":newc.v=decSep=="."?""+newc.v:(""+newc.v).replace(".",decSep);break;case"boolean":newc.v=l10nBool[newc.v];break}if(newc.t=="h"){cell.innerHTML=newc.v}else{this._setText(cell,newc.l||newc.v)}if("t" in newc&&cell.style.textAlign==""&&dta[newc.t]!=""){cell.style.textAlign=dta[newc.t]}}else{if(oldc!=undefined&&"v" in oldc){this._setText(cell,"")}}if(!this._gmode_edit){if(newc!=undefined&&"k" in newc&&newc.k===false){cell.className="gridCell gridCellUnlocked"}else{if(oldc!=undefined&&"k" in oldc&&oldc.k===false){cell.className="gridCell"}}}srow[newx]=newc}}},_scrollTableY:function(dir,amount,newcoord,oldcoord){var newheight,oldheight,newtop,row,srow,tblrow,hdr,ndh,rh=this._rowHeights,cw=this._colWidths,csi=this._cellSizeIncr[1],cwi=this._cellSizeIncr[0],tr=this._tableRows,tm=this._tableMat,st=this._storage._tbl,rhd=this._rowHdrs,th=this._numRows,tw=this._numCols,l10nBool=this._l10nBool,decSep=this._numericSeps[0],dta=this._jwstyle.defTextAlign,ctc=this._currTopCell[0];for(var i=amount;i>0;--i){if(dir==this._SCROLL_BACK){--newcoord;--oldcoord;oldheight=rh.getElemAt(oldcoord);newheight=rh.getElemAt(newcoord);newtop=parseInt(tr[0].style.top)-newheight;tm.unshift(row=tm.pop());st.unshift(srow=st.pop());tr.unshift(tblrow=tr.pop());if(this._gmode_edit){rhd.unshift(hdr=rhd.pop())}}else{++newcoord;++oldcoord;oldheight=rh.getElemAt(oldcoord);newheight=rh.getElemAt(newcoord);newtop=parseInt(tr[th-1].style.top)+rh.getElemAt(newcoord-1);tm.push(row=tm.shift());st.push(srow=st.shift());tr.push(tblrow=tr.shift());if(this._gmode_edit){rhd.push(hdr=rhd.shift())}}if(newheight!=oldheight){ndh=true;if(newheight){var csstxt="top:".concat(newtop,"px;height:",newheight-csi,"px;",(oldheight?"":"display:;"))}else{var csstxt="top:".concat(newtop,"px;display:none;")}tblrow.style.cssText=csstxt}else{ndh=false,tblrow.style.top=newtop="".concat(newtop,"px")}if(this._gmode_edit){if(ndh){hdr.style.cssText=csstxt}else{hdr.style.top=newtop}this._setText(hdr,newcoord)}for(var cell,newc,oldc,j=tw-1,ctcj=ctc+j;j>=0;--j,--ctcj){cell=row[j];newc=this._cache.get(ctcj,newcoord);oldc=srow[j];if(newc!=undefined&&"s" in newc){cell.style.cssText="left:".concat(cell.style.left,";width:",cell.style.width,";display:",cell.style.display,";",newc.s);if(cell.style.borderTopWidth=="2px"){cell.style.width="".concat(cw.getElemAt(ctcj)-cwi-1,"px")}if(cell.style.borderLeftWidth=="2px"){cell.style.height="".concat(rh.getElemAt(newcoord)-csi-1,"px")}}else{if(oldc!=undefined&&"s" in oldc){cell.style.cssText="left:".concat(cell.style.left,";width:",cell.style.width,";display:",cell.style.display,";")}}if(newc!=undefined&&"m" in newc&&newc.m[0]==true){if(cell.className.indexOf("mergedCell")==-1){cell.className+=" mergedCell"}for(var sum=0,max=newc.m[2],k=0;k<max;sum+=cw.getElemAt(ctcj+k++)){}cell.style.width="".concat(sum-cwi,"px");for(var sum=0,max=newc.m[1],k=0;k<max;sum+=rh.getElemAt(newcoord+k++)){}cell.style.height="".concat(sum-csi,"px")}else{if(cell.className.indexOf("mergedCell")!=-1){cell.className="gridCell";cell.style.width="".concat(cw.getElemAt(ctcj)-cwi,"px");cell.style.height="".concat(rh.getElemAt(newcoord)-csi,"px")}}if(newc!=undefined&&"m" in newc&&newc.m[0]==false){cell.style.visibility="hidden"}else{if(cell.style.visibility=="hidden"){cell.style.visibility=""}}if(newc!=undefined&&"v" in newc){switch(typeof newc.v){case"number":newc.v=decSep=="."?""+newc.v:(""+newc.v).replace(".",decSep);break;case"boolean":newc.v=l10nBool[newc.v];break}if(newc.t=="h"){cell.innerHTML=newc.v}else{this._setText(cell,newc.l||newc.v)}if("t" in newc&&cell.style.textAlign==""&&dta[newc.t]!=""){cell.style.textAlign=dta[newc.t]}}else{if(oldc!=undefined&&"v" in oldc){this._setText(cell,"")}}if(!this._gmode_edit){if(newc!=undefined&&"k" in newc&&newc.k===false){cell.className="gridCell gridCellUnlocked"}else{if(oldc!=undefined&&"k" in oldc&&oldc.k===false){cell.className="gridCell"}}}srow[j]=newc}}},_scrollGridX:function(offset,destCellAbs,cb){if(destCellAbs==undefined){destCellAbs=Math.round(offset/this._book._sliderTicks[0])}if(destCellAbs==this._lastDestCell[0]){return}this._lastDestCell[0]=destCellAbs;var dir=destCellAbs<this._lastDoneDestCell[0]?this._SCROLL_BACK:this._SCROLL_FWD,destCellRel=destCellAbs-(this._currTopCell[0]-1);var colw,pos=destCellAbs+1,sum=this._colWidths.getElemAt(pos);for(var max=this._ocWidth,cw=this._colWidths;sum<max;sum+=cw.getElemAt(++pos)){}var cppi=pos-destCellAbs-1,cpp=cppi+((colw=this._colWidths.getElemAt(pos))-sum+this._ocWidth)/colw;if(destCellAbs+cppi>this._farthestSeenCell[0]&&(this._farthestSeenCell[0]=destCellAbs+cppi)>this._maxCoords[0]){this._farthestSeenCell[0]=this._maxCoords[0]}if(cppi+3>this._numCols){this._reconstruct(null,cppi+3-this._numCols,0,true)}var scrollParams={type:0,dir:dir,r_dir:dir,amount:0},gridParams={dca:destCellAbs,cppi:cppi,cpp:cppi};if(Math.abs(destCellRel)+1>=this._numCols*this._loadTableCoef){var ctc=destCellAbs;destCellRel=1;var gridEdge=ctc+this._numCols-1;if(ctc<1){destCellRel-=-ctc+1;ctc=1}else{if(gridEdge>this._farthestSeenCell[0]){if(gridEdge>this._maxCoords[0]){var corr=gridEdge-this._maxCoords[0]}else{var corr=gridEdge-this._farthestSeenCell[0]-1}destCellRel+=corr;ctc-=corr}}gridParams.ctc=ctc;gridParams.dcr=destCellRel;var loadRng=this._jutil.reg2rng([ctc,this._currTopCell[1]],this._numCols,this._numRows);this._jutil.rngCap(loadRng,this._sheet._farthestUsedCell);if(ctc>this._sheet._farthestUsedCell[0]||this._currTopCell[1]>this._sheet._farthestUsedCell[1]||!this._cache.miss(loadRng)){return this._scrollGridX_do(true,gridParams,scrollParams,cb)}this._cache.abort();clearTimeout(this._book._tid_scrollGrid);var that=this;this._book._tid_scrollGrid=setTimeout(function(){that._cache.load([that,that._scrollGridX_do,true,gridParams,scrollParams,cb],loadRng,{sdr:1+dir})},200);this._book._scrollPending=true;return}if(destCellRel>=0){if(destCellRel+cppi<this._numCols){var rremaining=this._numCols-destCellRel-cppi;if(rremaining<1){this._calcScroll(scrollParams,1-rremaining);destCellRel-=scrollParams.amount}else{var lmissing=1-destCellRel;if(lmissing>0&&this._currTopCell[0]-lmissing>0){scrollParams.dir=this._SCROLL_BACK;this._calcScroll(scrollParams,lmissing);destCellRel+=scrollParams.amount}}}else{this._calcScroll(scrollParams,destCellRel+cppi-this._numCols+2);destCellRel-=scrollParams.amount}}else{this._calcScroll(scrollParams,-destCellRel+1);destCellRel+=scrollParams.amount}gridParams.dcr=destCellRel;var loadRng=this._jutil.reg2rng([scrollParams.fincoord,this._currTopCell[1]],scrollParams.amount,this._numRows);this._jutil.rngCap(loadRng,this._sheet._farthestUsedCell);if(!scrollParams.amount||scrollParams.fincoord>this._sheet._farthestUsedCell[0]||this._currTopCell[1]>this._sheet._farthestUsedCell[1]||!this._cache.miss(loadRng)){return this._scrollGridX_do(false,gridParams,scrollParams,cb)}this._cache.abort();clearTimeout(this._book._tid_scrollGrid);var that=this;this._book._tid_scrollGrid=setTimeout(function(){that._cache.load([that,that._scrollGridX_do,false,gridParams,scrollParams,cb],loadRng,{sdr:1+dir})},200);this._book._scrollPending=true},_scrollGridX_do:function(mode,gridParams,scrollParams,cb){this._lastDoneDestCell[0]=gridParams.dca;this._cppi[0]=gridParams.cppi;this._cpp[0]=gridParams.cpp;if(mode){this._oldCTC[0]=this._currTopCell[0];this._currTopCell[0]=gridParams.ctc;this._loadTable(true,false,true,false);var newleft=this._colWidths.getSumUpTo(this._currTopCell[0]+gridParams.dcr)}else{if(scrollParams.amount){this._scrollTableX(scrollParams.dir,scrollParams.amount,scrollParams.newcoord,scrollParams.oldcoord),this._currTopCell[0]+=scrollParams.s_amount}var newleft=parseInt(this._firstRowCells[gridParams.dcr].style.left)}this._oc.scrollLeft=newleft;if(this._gmode_edit){this._colHdrsOC.scrollLeft=newleft}if(this._book._doCheckSlider){this._book._checkSlider(0)}this._book._scrollPending=false;this._book.scrollObserver.notify(this,this,0,scrollParams.r_dir,this._lastDestCell[0]+1,this._lastDestCell[0]+this._cppi[0],this._book._currScrollSpeeds[0]);if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}},_scrollGridY:function(offset,destCellAbs,cb){if(destCellAbs==undefined){destCellAbs=parseInt(offset/this._book._sliderTicks[1])}if(destCellAbs==this._lastDestCell[1]){return}this._lastDestCell[1]=destCellAbs;var dir=destCellAbs<this._lastDoneDestCell[1]?this._SCROLL_BACK:this._SCROLL_FWD,destCellRel=destCellAbs-(this._currTopCell[1]-1);var rowh,pos=destCellAbs+1,sum=this._rowHeights.getElemAt(pos);for(var max=this._ocHeight,rh=this._rowHeights;sum<max;sum+=rh.getElemAt(++pos)){}var cppi=pos-destCellAbs-1;cpp=cppi+((rowh=this._rowHeights.getElemAt(pos))-sum+this._ocHeight)/rowh;if(destCellAbs+cppi>this._farthestSeenCell[1]&&(this._farthestSeenCell[1]=destCellAbs+cppi)>this._maxCoords[1]){this._farthestSeenCell[1]=this._maxCoords[1]}if(cppi+3>this._numRows){this._reconstruct(null,0,cppi+3-this._numRows,true)}var scrollParams={type:1,dir:dir,r_dir:dir,amount:0},gridParams={dca:destCellAbs,cppi:cppi,cpp:cppi};if(Math.abs(destCellRel)+1>=this._numRows*this._loadTableCoef){var ctc=destCellAbs;destCellRel=1;var gridEdge=ctc+this._numRows-1;if(ctc<1){destCellRel-=-ctc+1;ctc=1}else{if(gridEdge>this._farthestSeenCell[1]){if(gridEdge>this._maxCoords[1]){var corr=gridEdge-this._maxCoords[1]}else{var corr=gridEdge-this._farthestSeenCell[1]-1}destCellRel+=corr;ctc-=corr}}gridParams.ctc=ctc;gridParams.dcr=destCellRel;var loadRng=this._jutil.reg2rng([this._currTopCell[0],ctc],this._numCols,this._numRows);this._jutil.rngCap(loadRng,this._sheet._farthestUsedCell);if(ctc>this._sheet._farthestUsedCell[1]||this._currTopCell[0]>this._sheet._farthestUsedCell[0]||!this._cache.miss(loadRng)){return this._scrollGridY_do(true,gridParams,scrollParams,cb)}this._cache.abort();clearTimeout(this._book._tid_scrollGrid);var that=this;this._book._tid_scrollGrid=setTimeout(function(){that._cache.load([that,that._scrollGridY_do,true,gridParams,scrollParams,cb],loadRng,{sdr:2+dir})},200);this._book._scrollPending=true;return}if(destCellRel>=0){if(destCellRel+cppi<this._numRows){var dremaining=this._numRows-destCellRel-cppi;if(dremaining<1){this._calcScroll(scrollParams,1-dremaining);destCellRel-=scrollParams.amount}else{var umissing=1-destCellRel;if(umissing>0&&this._currTopCell[1]-umissing>0){scrollParams.dir=this._SCROLL_BACK;this._calcScroll(scrollParams,umissing);destCellRel+=scrollParams.amount}}}else{this._calcScroll(scrollParams,destCellRel+cppi-this._numRows+2);destCellRel-=scrollParams.amount}}else{this._calcScroll(scrollParams,-destCellRel+1);destCellRel+=scrollParams.amount}gridParams.dcr=destCellRel;var loadRng=this._jutil.reg2rng([this._currTopCell[0],scrollParams.fincoord],this._numCols,scrollParams.amount);this._jutil.rngCap(loadRng,this._sheet._farthestUsedCell);if(!scrollParams.amount||scrollParams.fincoord>this._sheet._farthestUsedCell[1]||this._currTopCell[0]>this._sheet._farthestUsedCell[0]||!this._cache.miss(loadRng)){return this._scrollGridY_do(false,gridParams,scrollParams,cb)}this._cache.abort();clearTimeout(this._book._tid_scrollGrid);var that=this;this._book._tid_scrollGrid=setTimeout(function(){that._cache.load([that,that._scrollGridY_do,false,gridParams,scrollParams,cb],loadRng,{sdr:2+dir})},200);this._book._scrollPending=true},_scrollGridY_do:function(mode,gridParams,scrollParams,cb){this._lastDoneDestCell[1]=gridParams.dca;this._cppi[1]=gridParams.cppi;this._cpp[1]=gridParams.cpp;if(mode){this._oldCTC[1]=this._currTopCell[1];this._currTopCell[1]=gridParams.ctc;this._loadTable(false,true,true,false);var newtop=this._rowHeights.getSumUpTo(this._currTopCell[1]+gridParams.dcr)}else{if(scrollParams.amount){this._scrollTableY(scrollParams.dir,scrollParams.amount,scrollParams.newcoord,scrollParams.oldcoord),this._currTopCell[1]+=scrollParams.s_amount}var newtop=parseInt(this._tableRows[gridParams.dcr].style.top)}this._oc.scrollTop=newtop;if(this._gmode_edit){this._rowHdrsOC.scrollTop=newtop}if(this._book._doCheckSlider){this._book._checkSlider(1)}this._book._scrollPending=false;this._book.scrollObserver.notify(this,this,1,scrollParams.r_dir,this._lastDestCell[1]+1,this._lastDestCell[1]+this._cppi[1],this._book._currScrollSpeeds[1]);if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}},getCoordsByCell:function(obj){for(var tmi,ldc=this._lastDestCell,ctc=this._currTopCell,cppi=this._cppi,tm=this._tableMat,i=ldc[1]-ctc[1]+1,uly=i+cppi[1];i<=uly;++i){if(i in tm){tmi=tm[i]}else{break}for(var j=ldc[0]-ctc[0]+1,ulx=j+cppi[0];j<=ulx;++j){if(tmi[j]==obj){return[ctc[0]+j,ctc[1]+i]}}}return undefined},getCellByPos:function(x,y){if(y in this._tableMat){return this._tableMat[y][x]}return undefined},getCellByCoords:function(col,row){col-=this._currTopCell[0];row-=this._currTopCell[1];if(row in this._tableMat){return this._tableMat[row][col]}return undefined},getPixelsByCoords:function(col,row){return[this._colWidths.getSumUpTo(col),this._rowHeights.getSumUpTo(row)]},furnishCell:function(col,row,obj,comb){var x=col-this._currTopCell[0],y=row-this._currTopCell[1],cell=this.getCellByPos(x,y),stor=this._storage,decSep;if(cell==undefined){return false}var s="s" in obj?obj.s:(comb?undefined:""),s_old=stor.getPart(x,y,"s"),cws=this._colWidths,rhs=this._rowHeights,cwi=this._cellSizeIncr[0],rhi=this._cellSizeIncr[1];if(s!=undefined&&(s!=""||s_old!=undefined)){cell.style.cssText="left:".concat(cell.style.left,";width:",cell.style.width,";height:",cell.style.height,";visibility:",cell.style.visibility,";display:",cell.style.display,";text-align:",cell.style.textAlign,";",s);if(cell.style.borderTopWidth=="2px"){cell.style.width="".concat(cws.getElemAt(col)-cwi-1,"px")}if(cell.style.borderLeftWidth=="2px"){cell.style.height="".concat(rhs.getElemAt(row)-rhi-1,"px")}}if("v" in obj){switch(typeof obj.v){case"number":obj.v=(decSep=this._numericSeps[0])=="."?""+obj.v:(""+obj.v).replace(".",decSep);break;case"boolean":obj.v=this._l10nBool[obj.v];break}}if("l" in obj){var v=obj.o!=""?obj.l:("v" in obj?obj.v:stor.getPart(x,y,"v"))}else{if("v" in obj){var v=stor.hasPart(x,y,"l")?undefined:obj.v}else{var v=comb?undefined:""}}if(v!=undefined){var t=obj.t,t_old=stor.getPart(x,y,"t");if(t=="h"||(!t&&t_old=="h")){cell.innerHTML=v}else{this._setText(cell,v)}if(t&&((s==undefined&&(s_old==undefined||s_old.indexOf("text-align:")==-1))||(s!=undefined&&s.indexOf("text-align:")==-1))&&((t_old==undefined&&this._jwstyle.defTextAlign[t]!="")||(t_old!=undefined&&t!=t_old))){cell.style.textAlign=this._jwstyle.defTextAlign[t]}}if("m" in obj){if(obj.m[0]==true){if(cell.className.indexOf("mergedCell")==-1){cell.className+=" mergedCell"}for(var sum=0,max=obj.m[2],i=0;i<max;sum+=cws.getElemAt(col+i++)){}cell.style.width="".concat(sum-cwi,"px");for(var sum=0,max=obj.m[1],i=0;i<max;sum+=rhs.getElemAt(row+i++)){}cell.style.height="".concat(sum-rhi,"px")}else{if(cell.className.indexOf("mergedCell")!=-1){cell.className="gridCell";cell.style.width="".concat(cws.getElemAt(col)-cwi,"px");cell.style.height="".concat(rhs.getElemAt(row)-rhi,"px")}}}else{if(!comb&&cell.className.indexOf("mergedCell")!=-1){cell.className="gridCell";cell.style.width="".concat(cws.getElemAt(col)-cwi,"px");cell.style.height="".concat(rhs.getElemAt(row)-rhi,"px")}}if("m" in obj){if(obj.m[0]==false){if(cell.style.visibility!="hidden"){cell.style.visibility="hidden"}}else{if(cell.style.visibility=="hidden"){cell.style.visibility=""}}}else{if(!comb&&cell.style.visibility=="hidden"){cell.style.visibility=""}}if(!this._gmode_edit&&"k" in obj&&obj.k!==stor.getPart(x,y,"k")){cell.className=obj.k?"gridCell":"gridCell gridCellUnlocked"}this._storage.set(x,y,obj,comb)},getNeighByOffset:function(col,row,offx,offy){col=this._colWidths.getIdxByOffset(col,offx);row=this._rowHeights.getIdxByOffset(row,offy);return[col,row,this.getCellByCoords(col,row)]},isCellVisible:function(col,row){return col>=this._lastDestCell[0]+1&&col<=this._lastDestCell[0]+this._cppi[0]&&row>=this._lastDestCell[1]+1&&row<=this._lastDestCell[1]+this._cppi[1]},isCellLocked:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"k")!==false},getCellDims:function(col,row){return[this._colWidths.getElemAt(col),this._rowHeights.getElemAt(row)]},getCell:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1])},getCellValue:function(col,row){col-=this._currTopCell[0];row-=this._currTopCell[1];if(col<0||col>=this._numCols||row<0||row>=this._numRows){return undefined}return this._storage.hasPart(col,row,"l")?this._storage.getPart(col,row,"l"):this._storage.getPart(col,row,"v")},getCellFVal:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"l")},getCellUVal:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"v")},getCellFormula:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"f")},getCellNFs:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"n")},getCellType:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"t")},getCellStyle:function(col,row){return this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"s")},setCellValue:function(col,row,val){if(typeof val!="string"){return false}var cb=[this._book,this._book.exec],x=col-this._currTopCell[0],y=row-this._currTopCell[1];if(val[0]=="="){this._conn.setCcmd([["cdrn",{cm:true},[col,row,col,row,{v:val}]]])}else{var n=this._numericSeps[0]!="."?val.replace(this._reThouSep,"").replace(this._numericSeps[0],"."):val.replace(this._reThouSep,""),quo={n:"",s:'"'},match,f,t,v,cell_old;if(n===""||n===null||n===undefined){v="",t="e"}else{if(!isNaN(n)){v=n*1,t="n"}else{if(val.toUpperCase()==this._l10nBool[true]){v=true,t="b",val=this._l10nBool[true]}else{if(val.toUpperCase()==this._l10nBool[false]){v=false,t="b",val=this._l10nBool[false]}else{t=(v=val)[0]=="<"?"h":"s"}}}}if(t in quo&&(f=this._storage.fetch(x,y,"f"))!=undefined&&(match=f.match(this._rePaloData))!==null){this._conn.setCcmd([["cdrn",{cm:true},[col,row,col,row,{v:"=PALO.SETDATA(".concat(quo[t],v,quo[t],this._numericSeps[2],this._l10nBool[false],this._numericSeps[2],match[1],")")}],[col,row,col,row,{v:f}]]])}else{cell_old=(cell_old=this._storage.fetch(x,y))!==undefined?{v:cell_old.v,f:cell_old.f,t:cell_old.t}:{};this.furnishCell(col,row,{v:val,t:t,_pend:true},true),this._conn.setCcmd([["cdrn",{cm:true},[col,row,col,row,{v:v}]]]);cb.push([this,this.setCellValue_post,col,row,cell_old])}}this._conn.sendBatch(cb,this.getRealGridRange(),true,true,this._conn.Q_VALUE|this._conn.Q_STYLE|this._conn.Q_FORMULA_WE|this._conn.Q_ATTRS|this._conn.Q_FMT_VAL|this._conn.Q_FMT|this._conn.Q_FORMULA_NF|this._conn.Q_LOCK)},setCellValue_post:function(res,col,row,cell_old){var x=col-this._currTopCell[0],y=row-this._currTopCell[1];if(this._storage.hasPart(x,y,"_pend")){this.furnishCell(col,row,cell_old,true)}},setRangeValue:function(range,vals){if(typeof vals!="object"||!("length" in vals)){return false}var cmd_range=[range[0],range[1],range[2],range[3]],cmd_post=[],seps=this._numericSeps,l10nBool=this._l10nBool,reTS=this._reThouSep,rePD=this._rePaloData,quo={n:"",s:'"'},val,match,f,v,t,n;for(var len=vals.length,col=range[0],row=range[1],i=0;i<len;++i){val=vals[i];if(val[0]=="="){cmd_range.push({v:val})}else{n=seps[0]!="."?val.replace(reTS,"").replace(seps[0],"."):val.replace(reTS,"");if(n===""||n===null||n===undefined){v="",t="e"}else{if(!isNaN(n)){v=n*1,t="n"}else{if(val.toUpperCase()==l10nBool[true]){v=true,t="b"}else{if(val.toUpperCase()==l10nBool[false]){v=false,t="b"}else{v=val,t="s"}}}}if(t in quo&&(f=this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"f"))!=undefined&&(match=f.match(rePD))!==null){cmd_range.push({v:"=PALO.SETDATA(".concat(quo[t],v,quo[t],seps[2],l10nBool[false],seps[2],match[1],")")});cmd_post.push([col,row,col,row,{v:f}])}else{cmd_range.push({v:v})}}if(++col>range[2]){++row,col=range[0]}}this._conn.setCcmd([["cdrn",{cm:true},cmd_range]].concat(cmd_post.length?[["cdrn",{cm:true}].concat(cmd_post)]:[]));this._conn.sendBatch([this._book,this._book.exec],this.getRealGridRange(),true,true,this._conn.Q_VALUE|this._conn.Q_STYLE|this._conn.Q_FORMULA_WE|this._conn.Q_ATTRS|this._conn.Q_FMT_VAL|this._conn.Q_FMT|this._conn.Q_FORMULA_NF|this._conn.Q_LOCK)},setArrayFormula:function(range,val){range.push(val);this._conn.cmd([this._book,this._book.exec],["saf"],[range],this.getRealGridRange(),true,true,this._conn.Q_VALUE|this._conn.Q_STYLE|this._conn.Q_FORMULA_WE|this._conn.Q_FMT_VAL|this._conn.Q_FMT|this._conn.Q_FORMULA_NF)},merge:function(range,isUnMerge){var mi;if(range[0]==range[2]&&range[1]==range[3]&&(mi=this._storage.fetch(range[0]-this._currTopCell[0],range[1]-this._currTopCell[1],"m"))!==undefined&&mi[0]===true){range[2]+=mi[2]-1,range[3]+=mi[1]-1}if(range[2]>this._sheet._farthestUsedCell[0]){this._sheet._farthestUsedCell[0]=range[2]}if(range[3]>this._sheet._farthestUsedCell[1]){this._sheet._farthestUsedCell[1]=range[3]}this._conn.cmd([this._book,this._book.exec,[this,this._merge_post,range,isUnMerge]],[isUnMerge?"umrg":"mrg"],[range],this.getRealGridRange(),true,true,this._conn.Q_VALUE|this._conn.Q_STYLE|this._conn.Q_FORMULA_WE|this._conn.Q_FMT_VAL|this._conn.Q_MERGE|this._conn.Q_FORMULA_NF)},_merge_post:function(res,range,isUnMerge){this._defaultSelection.set(new Jedox.wss.cls.Point(range[0],range[1]),isUnMerge?new Jedox.wss.cls.Point(range[2],range[3]):new Jedox.wss.cls.Point(range[0],range[1]));this._defaultSelection.draw();if(isUnMerge){this._defaultSelection.checkForUndoneMarkers(true);Jedox.wss.general.setCurrentCoord()}},getMergeInfo:function(col,row){var mi=this._storage.fetch(col-this._currTopCell[0],row-this._currTopCell[1],"m");if(typeof mi!="object"){return undefined}return mi[0]==true?[true,mi[2],mi[1]]:[false,mi[2]+1,mi[1]+1]},getMergeState:function(range){var x1=range[0]-this._currTopCell[0],y1=range[1]-this._currTopCell[1],x2=range[2]-this._currTopCell[0],y2=range[3]-this._currTopCell[1];if(x1<0||x1>=this._numCols||y1<0||y1>=this._numRows||x2<0||x2>=this._numCols||y2<0||y2>=this._numRows){return undefined}var mi=this._storage.fetch(x1,y1,"m"),c_mi;for(var y=y2;y>=y1;--y){for(var x=x2;x>=x1;--x){if(x==x1&&y==y1){continue}c_mi=this._storage.fetch(x,y,"m");if(mi){if(!c_mi||c_mi[0]){return undefined}if(mi[0]){if(c_mi[1]!=range[1]-1||c_mi[2]!=range[0]-1){return undefined}}else{if(mi[1]!=c_mi[1]||mi[2]!=c_mi[2]){return undefined}}}else{if(c_mi){return undefined}}}}return mi?true:false},setCellStyle:function(col,row,style){if(col>this._sheet._farthestUsedCell[0]){this._sheet._farthestUsedCell[0]=col}if(row>this._sheet._farthestUsedCell[1]){this._sheet._farthestUsedCell[1]=row}col-=this._currTopCell[0],row-=this._currTopCell[1];var cstyle=this.getCellByPos(col,row);if(cstyle==undefined){return}cstyle=cstyle.style;for(var attr in style){cstyle[attr]=style[attr]}this._storage.setPart(col,row,style,"s")},setRangeStyle:function(range,style){if(range[2]>this._sheet._farthestUsedCell[0]){this._sheet._farthestUsedCell[0]=range[2]}if(range[3]>this._sheet._farthestUsedCell[1]){this._sheet._farthestUsedCell[1]=range[3]}var x1=range[0]-this._currTopCell[0],y1=range[1]-this._currTopCell[1],x2=range[2]-this._currTopCell[0],y2=range[3]-this._currTopCell[1];if(x1>=this._numCols||x2<0||y1>=this._numRows||y2<0){return}if(x1<0){x1=0}else{if(x1>=this._numCols){x1=this._numCols-1}}if(y1<0){y1=0}else{if(y1>=this._numRows){y1=this._numRows-1}}if(x2<0){x2=0}else{if(x2>=this._numCols){x2=this._numCols-1}}if(y2<0){y2=0}else{if(y2>=this._numRows){y2=this._numRows-1}}var cstyle;for(var y=y2;y>=y1;--y){for(var x=x2;x>=x1;--x){cstyle=this._tableMat[y][x].style;for(var attr in style){cstyle[attr]=style[attr]}this._storage.setPart(x,y,style,"s")}}},getRangeStyle:function(range,attrs){var x1=range[0]-this._currTopCell[0],y1=range[1]-this._currTopCell[1],x2=range[2]-this._currTopCell[0],y2=range[3]-this._currTopCell[1];if(x1<0||x1>=this._numCols||y1<0||y1>=this._numRows||x2<0||x2>=this._numCols||y2<0||y2>=this._numRows){return{}}var cstyle=this._tableMat[y1][x1].style;for(var attr in attrs){attrs[attr]=cstyle[attr]}for(var tm=this._tableMat,y=y1;y<=y2;++y){for(var x=x1;x<=x2;++x){cstyle=tm[y][x].style;for(var attr in attrs){if(cstyle[attr]!=attrs[attr]){delete attrs[attr]}}}}return attrs},setRangeFormat:function(range,fmt){var mi;if(range[0]==range[2]&&range[1]==range[3]&&(mi=this.getMergeInfo(range[0],range[1]))&&mi[0]){range[2]+=mi[1]-1,range[3]+=mi[2]-1}this._conn.cmd([this._book,this._book.exec],this._conn.cmdHdr,[[range[0],range[1],range[2],range[3],{o:fmt.shift(),a:{o:fmt}}]],this.getRealGridRange(),false,false,this._conn.Q_STYLE|this._conn.Q_ATTRS|this._conn.Q_FMT_VAL|this._conn.Q_FMT)},getRangeFormat:function(range){var x1=range[0]-this._currTopCell[0],y1=range[1]-this._currTopCell[1],x2=range[2]-this._currTopCell[0],y2=range[3]-this._currTopCell[1];if(x1<0||x1>=this._numCols||y1<0||y1>=this._numRows||x2<0||x2>=this._numCols||y2<0||y2>=this._numRows){return undefined}var fmt=[this._storage.getPart(x1,y1,"o")].concat(this._storage.getAttr(x1,y1,"o")),fmt_len=fmt.length;for(var y=y2;y>=y1;--y){for(var c_fmt,x=x2;x>=x1;--x){c_fmt=[this._storage.getPart(x,y,"o")].concat(this._storage.getAttr(x,y,"o"));if(c_fmt.length!=fmt_len){return undefined}for(var i=fmt_len-1;i>=0;--i){if(c_fmt[i]!=fmt[i]){return undefined}}}}return fmt[0]!=undefined?fmt:undefined},setRangeLock:function(range,lock){lock=lock?true:false;var x1=range[0]-this._currTopCell[0],y1=range[1]-this._currTopCell[1],x2=range[2]-this._currTopCell[0],y2=range[3]-this._currTopCell[1];if(x1>=this._numCols||x2<0||y1>=this._numRows||y2<0){return}if(x1<0){x1=0}else{if(x1>=this._numCols){x1=this._numCols-1}}if(y1<0){y1=0}else{if(y1>=this._numRows){y1=this._numRows-1}}if(x2<0){x2=0}else{if(x2>=this._numCols){x2=this._numCols-1}}if(y2<0){y2=0}else{if(y2>=this._numRows){y2=this._numRows-1}}this._storage.setRangePart(x1,y1,x2,y2,lock,"k");this._conn.cmd(this._conn.dummy_cb,["lock"],[range,lock])},getCoordsFirstVCell:function(){return[this._lastDestCell[0]+1,this._lastDestCell[1]+1]},getCoordsLastVCell:function(){return[this._lastDestCell[0]+this._cppi[0],this._lastDestCell[1]+this._cppi[1]]},getVisibleRange:function(type){return[this._lastDestCell[type]+1,this._lastDestCell[type]+this._cppi[type]]},getGridRng:function(){var ctc=this._currTopCell;return ctc.concat(ctc[0]+this._numCols-1,ctc[1]+this._numRows-1)},getRealGridRange:function(){return[[this._currTopCell[0],this._currTopCell[1]],[this._currTopCell[0]+this._numCols-1,this._currTopCell[1]+this._numRows-1]]},getViewportSize:function(){return[this._ocWidth,this._ocHeight]},getViewportPos:function(){return[[this._oc.scrollLeft,this._oc.scrollTop],[this._oc.scrollLeft+this._ocWidth,this._oc.scrollTop+this._ocHeight]]},getFarthestUsedCell:function(){return[this._sheet._farthestUsedCell[0],this._sheet._farthestUsedCell[1]]},pasteRange:function(cb,range,clip_id,paste_what){if(typeof paste_what!="number"){paste_what=Jedox.wss.range.ContentType.ALL_PASTE}range.unshift(clip_id);range.push(paste_what);this._conn.createBatch();this._conn.cmd(null,["ptrn"],[range]);this._conn.cmd(null,["adcr"],[1,[range[2],range[4]]]);this._conn.sendBatch([this._book,this._book.exec,cb],this.getRealGridRange())},clrRange:function(range,clr_what){if(typeof clr_what!="number"){clr_what=1}range.unshift(clr_what);this._conn.cmd([this._book,this._book.exec],["clr"],[range],this.getRealGridRange())},cbFire:function(col,row,attr_name,params){col-=this._currTopCell[0];row-=this._currTopCell[1];if(col<0||col>=this._numCols||row<0||row>=this._numRows){return false}var args=this._storage.getAttr(col,row,attr_name),cb;if(args==undefined||(cb=this._jwgrid.cbGet(args[0]))==undefined){return true}return cb[1].apply(cb[0],[params].concat(args.slice(1)))},recalc:function(cb){this._conn.rpc([this._book,this._book.exec,[this,this.recalc_post,cb]],"WSS","recalc",[this.getGridRng(),Jedox.wss.app.autoCalc])},recalc_post:function(res,cb){if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}},getColHdrsIC:function(){return this._colHdrsIC},getRowHdrsIC:function(){return this._rowHdrsIC},getBookIC:function(){return this._ic},getEnvironment:function(){return this._env},getDomId:function(){return this._domId},getCursorField:function(){return this._cursorField},insertCol:function(col,num){return this._sheet.insertCol(col,num)},insertRow:function(row,num){return this._sheet.insertRow(row,num)},deleteCol:function(col,num){return this._sheet.deleteCol(col,num)},deleteRow:function(row,num){return this._sheet.deleteRow(row,num)},activateHdr:function(type,idx,cls){return this._sheet.activateHdr(type,idx,cls)},activateHdrRng:function(type,rng,cls){return this._sheet.activateHdrRng(type,rng,cls)},activateHdrAll:function(type,cls){return this._sheet.activateHdrAll(type,cls)},getCoordByHdr:function(type,obj){return this._sheet.getCoordByHdr(type,obj)},getHdrByCoord:function(type,coord){return this._sheet.getHdrByCoord(type,coord)},scrollTo:function(cb,col,row,minscroll,force){this._book.scrollTo(cb,col,row,minscroll,force)}};Jedox.wss.grid.Sheet=function(cb,book,uid){this._inited=false;this._book=book;this._uid=uid;this._id=book._sheetCnt++;this._domId=book._domId.concat("S",this._id);this._contentEl=document.createElement("div");this._winObj=book._winObj;this._viewMode=Jedox.wss.app.appMode;this._app=Jedox.wss.app;this._jwgrid=Jedox.wss.grid;this._jwstyle=Jedox.wss.style;this._conn=Jedox.wss.backend.conn;this._cellSizeIncr=this._jwgrid.defCellSizeIncr;this._setText=Jedox.util.setText;this._n2l=Jedox.wss.app.numberToLetter;this._gmode_edit=book._gmode_edit;this._defMaxCoords=[this._jwgrid.defMaxCoords[0],this._jwgrid.defMaxCoords[1]];this._conn.setCcmd('[["gdcr",2],["gcr",0,1,'.concat(this._defMaxCoords[0]-1,'],["gcr",1,1,',this._defMaxCoords[1]-1,'],["gurn"],["wget","",[],["e_id","crosshairs","panes"],{"e_type":"panescnf"}]]'));this._conn.sendBatch([this,this._init_post,cb])};Jedox.wss.grid.Sheet.prototype={_SCROLL_HORIZ:0,_SCROLL_VERT:1,_init_post:function(res,cb){var that=this;if(res[0][0]!==true||res[1][0]!==true||res[2][0]!==true||res[3][0]!==true||res[4][0]!==true){return}this._defColRowDims=res[0][1],this._colRowDims=[this._colWidths=new Jedox.gen.SparseVector(this._defMaxCoords[0],this._defColRowDims[0]),this._rowHeights=new Jedox.gen.SparseVector(this._defMaxCoords[1],this._defColRowDims[1])];var incr=this._cellSizeIncr[0];for(var w,col_ws=res[1][1],len=col_ws.length,i=0;i<len;i+=2){this._colWidths.setElemAt(col_ws[i]+1,(w=col_ws[i+1])>=incr?w:0)}incr=this._cellSizeIncr[1];for(var h,row_hs=res[2][1],len=row_hs.length,i=0;i<len;i+=2){this._rowHeights.setElemAt(row_hs[i]+1,(h=row_hs[i+1])>=incr?h:0)}this._farthestUsedCell=res[3][1];if(res[4][1].length){this._paneConfUid=res[4][1][0].e_id;this._crosshairs=res[4][1][0].crosshairs;this._paneConf=res[4][1][0].panes}else{this._paneConfUid=null;this._crosshairs=[0,0];this._paneConf=[{range:[1,1,this._defMaxCoords[0],this._defMaxCoords[1]],hscroll:true,vscroll:true,pos:[1,1]}]}this._genContentEl();if(this._gmode_edit){this._colHdrsOC0=document.getElementById(this._domId+"_colHdrsOC0");this._colHdrsIC0=document.getElementById(this._domId+"_colHdrsIC0");this._rowHdrsOC0=document.getElementById(this._domId+"_rowHdrsOC0");this._rowHdrsIC0=document.getElementById(this._domId+"_rowHdrsIC0");this._colHdrsOC0.scrollLeft=0;this._rowHdrsOC0.scrollTop=0;this._hdrsICs0=[this._colHdrsIC0,this._rowHdrsIC0];this._hdrsICs1=[];this._hdrClss=["gridColHdr","gridRowHdr"];var p0Coords=this._paneConf[0].coords;if(this._crosshairs[0]){this._colHdrsOC0.style.width="".concat(p0Coords.w,"px");this._colHdrsOC1=document.getElementById(this._domId+"_colHdrsOC1");this._colHdrsIC1=document.getElementById(this._domId+"_colHdrsIC1");this._hdrsICs1[0]=this._colHdrsIC1;this._colHdrsOC1.style.borderLeft="1px solid #000000";this._colHdrsOC1.scrollLeft=0}if(this._crosshairs[1]){this._rowHdrsOC0.style.height="".concat(p0Coords.h,"px");this._rowHdrsOC1=document.getElementById(this._domId+"_rowHdrsOC1");this._rowHdrsIC1=document.getElementById(this._domId+"_rowHdrsIC1");this._hdrsICs1[1]=this._rowHdrsIC1;this._rowHdrsOC1.style.borderTop="1px solid #000000";this._rowHdrsOC1.scrollTop=0}this._colHdrs0=[];this._rowHdrs0=[];this._hdrArrs0=[this._colHdrs0,this._rowHdrs0];this._activeHdrs_o0=[{},{}];this._activeHdrs_a0=[[],[]];this._activeHdrsAll0=[false,false];for(var ch=this._colHdrs0,hdrs=this._colHdrsIC0.getElementsByTagName("div"),i=this._numCols0-1;i>=0;--i){ch[i]=hdrs[i]}for(var rh=this._rowHdrs0,hdrs=this._rowHdrsIC0.getElementsByTagName("div"),i=this._numRows0-1;i>=0;--i){rh[i]=hdrs[i]}this._hdrArrs1=[];this._activeHdrs_o1=[{},{}];this._activeHdrs_a1=[[],[]];this._activeHdrsAll1=[false,false];if(this._crosshairs[0]){this._colHdrs1=[];this._hdrArrs1[0]=this._colHdrs1;for(var ch=this._colHdrs1,hdrs=this._colHdrsIC1.getElementsByTagName("div"),i=this._numCols1-1;i>=0;--i){ch[i]=hdrs[i]}}if(this._crosshairs[1]){this._rowHdrs1=[];this._hdrArrs1[1]=this._rowHdrs1;for(var rh=this._rowHdrs1,hdrs=this._rowHdrsIC1.getElementsByTagName("div"),i=this._numRows1-1;i>=0;--i){rh[i]=hdrs[i]}}document.getElementById(this._domId+"_gridSelectAll").onmousedown=function(ev){that._aPane._defaultSelection.markAllCells(ev)};this._colHdrsIC0.onmousemove=Jedox.wss.mouse.checkForResize;this._colHdrsIC0.onmousedown=function(ev){that._aPane._defaultSelection.selectOrResize(ev);document.body.onselectstart=Jedox.util.ignoreSelection};this._colHdrsIC0.ondblclick=Jedox.wss.mouse.autoSizeCell;this._rowHdrsIC0.onmousemove=Jedox.wss.mouse.checkForResize;this._rowHdrsIC0.onmousedown=function(ev){that._aPane._defaultSelection.selectOrResize(ev);document.body.onselectstart=Jedox.util.ignoreSelection};this._rowHdrsIC0.ondblclick=Jedox.wss.mouse.autoSizeCell;document.body.onmouseup=function(){document.body.onselectstart=Jedox.util.unignoreSelection}}else{this._activeHdrs_o0=[[],[]];this._activeHdrs_a0=[[],[]];this._activeHdrs_o1=[[],[]];this._activeHdrs_a1=[[],[]]}this._paneOCs=[];this._panes=[];for(var i=this._numPanes-1;i>=0;--i){this["_paneOC".concat(i)]=this._paneOCs[i]=document.getElementById(this._domId.concat("P",i,"_OC"));this._panes[i]=new Jedox.wss.grid.Pane(i?0:cb,this,i,this._paneOCs[i])}this._book._recalcSlider(0);this._book._recalcSlider(1);this._inited=true},_genContentEl:function(){if(this._gmode_edit){var hdrsWidth=41,hdrsHeight=19,html=['<div id="',this._domId,'_gridSelectAll" class="gridSelectAll"></div>'];var decr=this._cellSizeIncr[0];if(this._crosshairs[0]){html.push('<div id="',this._domId,'_colHdrsOC0" class="gridColHdrsOC" style="left:',hdrsWidth,'px;"><div id="',this._domId,'_colHdrsIC0" class="gridColHdrsIC">');for(var w,cols=this._crosshairs[0],c=this._paneConf[0].range[0],l=0,i=0;i<cols;++i,++c,l+=w){w=this._colWidths.getElemAt(c);html.push('<div class="gridColHdr" style="left:',l,"px;",(w?"width:".concat(w-decr,"px;"):"display:none;"),'">',this._n2l[c],"</div>")}html.push("</div></div>");this._numCols0=cols;var colPaneId=1,colsOffset=l}else{var colPaneId=0,colsOffset=0}var colsSize=this._book._sheetsOCWidth-hdrsWidth-colsOffset;html.push('<div id="',this._domId,"_colHdrsOC",colPaneId,'" class="gridColHdrsOC" style="left:',colsOffset+hdrsWidth,"px;width:",colsSize,'px;"><div id="',this._domId,"_colHdrsIC",colPaneId,'" class="gridColHdrsIC">');for(var w,xtra_c=2,c_first=this._paneConf[colPaneId].range[0],c=c_first,l=0;l<=colsSize||xtra_c--;++c,l+=w){w=this._colWidths.getElemAt(c);html.push('<div class="gridColHdr" style="left:',l,"px;",(w?"width:".concat(w-decr,"px;"):"display:none;"),'">',this._n2l[c],"</div>")}html.push("</div></div>");this["_numCols".concat(colPaneId)]=c-c_first;decr=this._cellSizeIncr[1];if(this._crosshairs[1]){html.push('<div id="',this._domId,'_rowHdrsOC0" class="gridRowHdrsOC" style="top:',hdrsHeight,'px;"><div id="',this._domId,'_rowHdrsIC0" class="gridRowHdrsIC">');for(var h,rows=this._crosshairs[1],r=this._paneConf[0].range[1],t=0,i=0;i<rows;++i,++r,t+=h){h=this._rowHeights.getElemAt(r);html.push('<div class="gridRowHdr" style="top:',t,"px;",(h?"height:".concat(h-decr,"px;"):"display:none;"),'">',r,"</div>")}html.push("</div></div>");this._numRows0=rows;var rowPaneId=1,rowsOffset=t}else{var rowPaneId=0,rowsOffset=0}var rowsSize=this._book._sheetsOCHeight-hdrsHeight-rowsOffset;html.push('<div id="',this._domId,"_rowHdrsOC",rowPaneId,'" class="gridRowHdrsOC" style="top:',rowsOffset+hdrsHeight,"px;height:",rowsSize,'px;"><div id="',this._domId,"_rowHdrsIC",rowPaneId,'" class="gridRowHdrsIC">');for(var h,xtra_r=2,r_first=this._paneConf[rowPaneId+colPaneId].range[1],r=r_first,t=0;t<=rowsSize||xtra_r--;++r,t+=h){h=this._rowHeights.getElemAt(r);html.push('<div class="gridRowHdr" style="top:',t,"px;",(h?"height:".concat(h-decr,"px;"):"display:none;"),'">',r,"</div>")}html.push("</div></div>");this["_numRows".concat(rowPaneId)]=r-r_first}else{var hdrsWidth=0,hdrsHeight=0,html=[];if(this._crosshairs[0]){for(var cols=this._crosshairs[0],colsOffset=0,c=this._paneConf[0].range[0],i=0;i<cols;++i,colsOffset+=this._colWidths.getElemAt(c++)){}this._numCols0=cols;var colPaneId=1}else{var colPaneId=0,colsOffset=0}var colsSize=this._book._sheetsOCWidth-hdrsWidth-colsOffset;for(var xtra_c=2,c_first=this._paneConf[colPaneId].range[0],c=c_first,l=0;l<=colsSize||xtra_c--;l+=this._colWidths.getElemAt(c++)){}this["_numCols".concat(colPaneId)]=c-c_first;if(this._crosshairs[1]){for(var rows=this._crosshairs[1],rowsOffset=0,r=this._paneConf[0].range[1],i=0;i<rows;++i,rowsOffset+=this._rowHeights.getElemAt(r++)){}this._numRows0=rows;var rowPaneId=1}else{var rowPaneId=0,rowsOffset=0}var rowsSize=this._book._sheetsOCHeight-hdrsHeight-rowsOffset;for(var xtra_r=2,r_first=this._paneConf[rowPaneId+colPaneId].range[1],r=r_first,t=0;t<=rowsSize||xtra_r--;t+=this._rowHeights.getElemAt(r++)){}this["_numRows".concat(rowPaneId)]=r-r_first}if(this._crosshairs[0]&&this._crosshairs[1]){this._paneConf[0].coords={l:hdrsWidth,t:hdrsHeight,w:colsOffset,h:rowsOffset,x:0,y:0};this._paneConf[1].coords={l:colsOffset+hdrsWidth,t:hdrsHeight,w:colsSize,h:rowsOffset,x:1,y:0};this._paneConf[2].coords={l:hdrsWidth,t:rowsOffset+hdrsHeight,w:colsOffset,h:rowsSize,x:0,y:1};this._paneConf[3].coords={l:colsOffset+hdrsWidth,t:rowsOffset+hdrsHeight,w:colsSize,h:rowsSize,x:1,y:1};this._paneConf[1].customCSS="border-left:1px solid #000000;";this._paneConf[2].customCSS="border-top:1px solid #000000;";this._paneConf[3].customCSS="border-top:1px solid #000000;border-left:1px solid #000000;"}else{if(this._crosshairs[0]){this._paneConf[0].coords={l:hdrsWidth,t:hdrsHeight,w:colsOffset,h:rowsSize,x:0,y:0};this._paneConf[1].coords={l:colsOffset+hdrsWidth,t:hdrsHeight,w:colsSize,h:rowsSize,x:1,y:0};this._paneConf[1].customCSS="border-left:1px solid #000000;"}else{if(this._crosshairs[1]){this._paneConf[0].coords={l:hdrsWidth,t:hdrsHeight,w:colsSize,h:rowsOffset,x:0,y:0};this._paneConf[1].coords={l:hdrsWidth,t:rowsOffset+hdrsHeight,w:colsSize,h:rowsSize,x:0,y:1};this._paneConf[1].customCSS="border-top:1px solid #000000;"}else{this._paneConf[0].coords={l:hdrsWidth,t:hdrsHeight,w:colsSize,h:rowsSize,x:0,y:0}}}}this._numPanes=this._paneConf.length;for(var pane,i=this._numPanes-1;i>=0;--i){pane=this._paneConf[i];html.push('<div id="',this._domId,"P",i,'_OC" class="paneOC" style="left:',pane.coords.l,"px;top:",pane.coords.t,"px;width:",pane.coords.w,"px;height:",pane.coords.h,"px;",pane.customCSS,'"></div>')}this._contentEl.id=this._domId.concat("_OC");this._contentEl.className="sheetOC";this._contentEl.innerHTML=html.join("");this._book._sheetsOC.appendChild(this._contentEl)},_fit:function(){this._contentEl.style.width="".concat(this._book._sheetsOCWidth,"px");this._contentEl.style.height="".concat(this._book._sheetsOCHeight,"px");if(this._crosshairs[0]&&this._crosshairs[1]){var colsSizeId=1,rowsSizeId=2,fits={1:1,2:2,3:3}}else{if(this._crosshairs[0]){var colsSizeId=1,rowsSizeId=0,fits={0:2,1:3}}else{if(this._crosshairs[1]){var colsSizeId=0,rowsSizeId=1,fits={0:1,1:3}}else{var colsSizeId=0,rowsSizeId=0,fits={0:3}}}}var colsSize=this._book._sheetsOCWidth-this._paneConf[colsSizeId].coords.l,rowsSize=this._book._sheetsOCHeight-this._paneConf[rowsSizeId].coords.t,colsSizePx="".concat(colsSize,"px"),rowsSizePx="".concat(rowsSize,"px");if(this._gmode_edit){this["_colHdrsOC".concat(colsSizeId?"1":"0")].style.width=colsSizePx;this["_rowHdrsOC".concat(rowsSizeId?"1":"0")].style.height=rowsSizePx}for(id in fits){if(fits[id]&1){this._paneConf[id].coords.w=colsSize,this._paneOCs[id].style.width=colsSizePx}if(fits[id]&2){this._paneConf[id].coords.h=rowsSize,this._paneOCs[id].style.height=rowsSizePx}}this._reconstruct()},_reconstruct:function(cb){var cIdx=this._crosshairs[0]?1:0,rIdx=this._crosshairs[1]?1:0;if(this._gmode_edit){var colHdrs=this["_colHdrs".concat(cIdx)],rowHdrs=this["_rowHdrs".concat(rIdx)],cOC=this["_colHdrsOC".concat(cIdx)],rOC=this["_rowHdrsOC".concat(rIdx)],lastC=colHdrs[this["_numCols".concat(cIdx)]-1],lastR=rowHdrs[this["_numRows".concat(rIdx)]-1],lastCol=this.getCoordByHdr(0,lastC),lastRow=this.getCoordByHdr(1,lastR)}else{var cPane=this._panes[cIdx],rPane=rIdx?this._panes[rIdx+cIdx]:this._panes[0],cOC=cPane._oc,rOC=rPane._oc,lastC=cPane._firstRowCells[cPane._numCols-1],lastR=rPane._tableRows[rPane._numRows-1],lastCol=cPane._currTopCell[0]+cPane._numCols-1,lastRow=rPane._currTopCell[1]+rPane._numRows-1}var hEdge=cOC.scrollLeft+cOC.offsetWidth,vEdge=rOC.scrollTop+rOC.offsetHeight,cEdge=parseInt(lastC.style.left)+this._colWidths.getElemAt(lastCol),rEdge=parseInt(lastR.style.top)+this._rowHeights.getElemAt(lastRow),prcs=[{},{},{},{}],next=lastCol+1;hEdge+=this._colWidths.getElemAt(next)+this._colWidths.getElemAt(++next);vEdge+=this._rowHeights.getElemAt(next=lastRow+1)+this._rowHeights.getElemAt(++next);if(cEdge<hEdge){var c=lastCol,diff;if(this._gmode_edit){var docFrag=document.createDocumentFragment(),decr=this._cellSizeIncr[0],hdr,w;do{hdr=lastC.cloneNode(true);this._setText(hdr,this._n2l[++c]);hdr.style.left="".concat(cEdge,"px");w=this._colWidths.getElemAt(c);if(w){hdr.style.width="".concat(w-decr,"px");if(hdr.style.display){hdr.style.display=""}}else{if(!hdr.style.display){hdr.style.display="none"}}docFrag.appendChild(hdr);colHdrs.push(hdr);cEdge+=w}while(cEdge<hEdge);cOC.firstChild.appendChild(docFrag)}else{do{cEdge+=this._colWidths.getElemAt(++c)}while(cEdge<hEdge)}this["_numCols".concat(cIdx)]+=(diff=c-lastCol);prcs[cIdx].c=diff;if(rIdx){prcs[rIdx|cIdx<<1].c=diff}}if(rEdge<vEdge){var r=lastRow,diff;if(this._gmode_edit){var docFrag=document.createDocumentFragment(),decr=this._cellSizeIncr[1],hdr,h;do{hdr=lastR.cloneNode(true);this._setText(hdr,++r);hdr.style.top="".concat(rEdge,"px");h=this._rowHeights.getElemAt(r);if(h){hdr.style.height="".concat(h-decr,"px");if(hdr.style.display){hdr.style.display=""}}else{if(!hdr.style.display){hdr.style.display="none"}}docFrag.appendChild(hdr);rowHdrs.push(hdr);rEdge+=h}while(rEdge<vEdge);rOC.firstChild.appendChild(docFrag)}else{do{rEdge+=this._rowHeights.getElemAt(++r)}while(rEdge<vEdge)}this["_numRows".concat(rIdx)]+=(diff=r-lastRow);if(cIdx){prcs[rIdx<<=1].r=diff;prcs[cIdx|rIdx].r=diff}else{prcs[rIdx].r=diff}}for(var prc=prcs[0],i=0;i<this._numPanes;prc=prcs[++i]){if(prc.c||prc.r){this._panes[i]._reconstruct(cb,prc.c,prc.r)}else{this._panes[i]._fit(cb)}}},isClone:function(){return this._uid in this._book._sheetsO2C},getUid:function(){return this._uid in this._book._sheetsO2C?this._book._sheetsO2C[this._uid]:this._uid},activateHdr:function(type,idx,cls){var notfnd=true,clss=this._hdrClss[type].concat(" ",cls);for(var size,sprop=type?"height":"width",crd=this._colRowDims[type],csi=this._cellSizeIncr[type],hdrsIC=this._hdrsICs0[type],hdrs=this._activeHdrs_a0[type],i=hdrs.length-1,hdr=hdrs[i];i>=0;hdr=hdrs[--i]){if(hdr[0]!=idx){hdrsIC.removeChild(hdr[1])}else{notfnd=false;var actHdr=hdr[1];if(actHdr.className!=clss){actHdr.className=clss}if(actHdr.style[sprop]!=(size="".concat(crd.getElemAt(idx)-csi,"px"))){actHdr.style[sprop]=size}}}if(notfnd){var actHdr=this._hdrArrs0[type][idx-this._aPane._currTopCell[type]].cloneNode(true);actHdr.id="ah".concat(type,"_",idx);actHdr.className=clss;this._hdrsICs0[type].appendChild(actHdr)}this._activeHdrs_a0[type]=[[idx,actHdr]];this._activeHdrs_o0[type]={};this._activeHdrs_o0[type][idx]=0;return true},activateHdrRng:function(type,rng,cls){var hdrs_a=[],hdrs_o={},clss=this._hdrClss[type].concat(" ",cls);for(var size,sprop=type?"height":"width",csi=this._cellSizeIncr[type],crd=this._colRowDims[type],hdrsIC=this._hdrsICs0[type],hdrs=this._activeHdrs_a0[type],i=hdrs.length-1,hdr=hdrs[i];i>=0;hdr=hdrs[--i]){if(rng[0]<=hdr[0]&&hdr[0]<=rng[1]){hdrs_a.push(hdr);hdrs_o[hdr[0]]=hdrs_a.length-1;if(hdr[1].className!=clss){hdr[1].className=clss}if(hdr[1].style[sprop]!=(size="".concat(crd.getElemAt(hdr[0])-csi,"px"))){hdr[1].style[sprop]=size}}else{hdrsIC.removeChild(hdr[1])}}for(var actHdr,hdrArrs=this._hdrArrs0[type],ctct=this._aPane._currTopCell[type],hdrIC=this._hdrsICs0[type],i=rng[0];i<=rng[1];++i){if(!(i in hdrs_o)){if(i-ctct>=this._aPane._tableSize[type]){break}else{if(i-ctct<0){continue}}actHdr=hdrArrs[i-ctct].cloneNode(true);actHdr.id="ah".concat(type,"_",i);actHdr.className=clss;hdrIC.appendChild(actHdr);hdrs_a.push([i,actHdr]);hdrs_o[i]=hdrs_a.length-1}}this._activeHdrs_a0[type]=hdrs_a;this._activeHdrs_o0[type]=hdrs_o;return true},activateHdrAll:function(type,cls){if(this._activeHdrsAll0[type]==cls){return true}for(var hdrsIC=this._hdrsICs0[type],hdrs=this._activeHdrs_a0[type],i=hdrs.length-1;i>=0;--i){hdrsIC.removeChild(hdrs[i][1])}if(this._activeHdrs_a0[type].length>0){this._activeHdrs_a0[type]=[],this._activeHdrs_o0[type]={}}for(var hdrs=this._hdrArrs0[type],i=hdrs.length-1;i>=0;--i){hdrs[i].className=cls}this._activeHdrsAll0[type]=cls;return true},getCoordByHdr:function(type,obj){if((type|1)!=1){return undefined}for(var hdrs=this._hdrArrs0[type],ahdrs_o=this._activeHdrs_o0[type],ahdrs_a=this._activeHdrs_a0[type],i=this._aPane._tableSize[type]-1,ctci=this._aPane._currTopCell[type]+i;i>=0;--i,--ctci){if(hdrs[i]==obj){return ctci}else{if(ctci in ahdrs_o&&ahdrs_a[ahdrs_o[ctci]][1]==obj){return ctci}}}},getHdrByCoord:function(type,coord){if((type|1)!=1){return undefined}return this._hdrArrs0[type][coord-this._aPane._currTopCell[type]]},insertCol:function(col,num){this._conn.cmd([this._book,this._book.exec],["ic"],[[col,num]],this._aPane.getRealGridRange(),true,false)},insertRow:function(row,num){this._conn.cmd([this._book,this._book.exec],["ir"],[[row,num]],this._aPane.getRealGridRange(),false,true)},deleteCol:function(col,num){this._conn.cmd([this._book,this._book.exec],["dc"],[[col,num]],this._aPane.getRealGridRange(),true,false)},deleteRow:function(row,num){this._conn.cmd([this._book,this._book.exec],["dr"],[[row,num]],this._aPane.getRealGridRange(),false,true)},setColRowSize:function(type,chngsets){if((type|1)!=1||!(chngsets instanceof Array)){return false}var sizes,range,size,sizepx,len,visible,oldvals,csi=this._cellSizeIncr[type],crs=this._colRowDims[type],def=crs.getDef(),tbl_size=[this._numCols0,this._numRows0],ctc=this._aPane._currTopCell,tbl_beg=ctc[type],tbl_end=tbl_beg+tbl_size[type]-1,i;for(i=chngsets.length-1;i>=0;--i){if((len=(sizes=chngsets[i].slice()).length-2)<1){continue}range=[sizes.shift(),sizes.shift()];if(len!=1&&range[1]-range[0]!=len-1){continue}if(len!=1){size=undefined}else{if((size=sizes[0])==-1){size=def}else{if(size<csi){size=0}}}if(visible=(range[0]>tbl_end||range[1]<tbl_beg)?false:(oldvals={},true)){for(var min=range[0]>tbl_beg?range[0]:tbl_beg,c=range[1]<tbl_end?range[1]:tbl_end;c>=min;--c){oldvals[c]=crs.getElemAt(c)}}if(range[0]==1&&range[1]==this._defMaxCoords[type]&&len==1&&size!=this._defColRowDims[type]){this._defColRowDims[type]=size;crs.reInit(size);this._aPane._defcpp[type]=(type==this._SCROLL_HORIZ?this._aPane._ocWidth:this._aPane._ocHeight)/size;this._aPane._defcppi[type]=this._aPane._defcpp[type]|0;sizepx="".concat(size-csi,"px")}else{if(len==1){for(var min=range[0],c=range[1];c>=min;--c){if(crs.getElemAt(c)!=size){crs.setElemAt(c,size)}}sizepx="".concat(size-csi,"px")}else{for(var c=range[1],j=len-1;j>=0;--j,--c){if((size=sizes[j])==-1){size=def}else{if(size<csi){size=0}}if(crs.getElemAt(c)!=size){crs.setElemAt(c,size)}}}}if(!visible){continue}for(var oldsize,st,tr_s,newpos,diff,move_sum=0,th=this._numRows0,tw=this._numCols0,tm=this._aPane._tableMat,ch=this._aPane._colHdrs,cs=this._aPane._colSeps,rh=this._aPane._rowHdrs,fr=this._aPane._firstRowCells,tr=this._aPane._tableRows,ahdrs_o=this._activeHdrs_o0[type],ahdrs_a=this._activeHdrs_a0[type],curr=range[0]>tbl_beg?range[0]-tbl_beg:0,max=range[1]<tbl_end?range[1]-tbl_beg:tbl_end-tbl_beg,curr_abs=tbl_beg+curr,c=curr_abs-range[0];curr<=max;){if(len>1){if((size=sizes[c++])==-1){size=def}else{if(size<csi){size=0}}sizepx="".concat(size-csi,"px")}if(type==this._SCROLL_HORIZ){if((oldsize=oldvals[curr_abs])!=size){if(this._gmode_edit){if(size){st=ch[curr].style;st.width=sizepx;if(oldsize==0){st.display=""}}else{if(oldsize){ch[curr].style.display="none"}}if(curr_abs in ahdrs_o){if(size){st=ahdrs_a[ahdrs_o[curr_abs]][1].style;st.width=sizepx;if(oldsize==0){st.display=""}}else{if(oldsize){ahdrs_a[ahdrs_o[curr_abs]][1].style.display="none"}}}}diff=size-oldsize;for(var mi,mrow,cell,cspx,row=ctc[1],j=0;j<th;++j,++row){if((mi=this._aPane._storage.getPart(curr,j,"m"))!==undefined){if(mi[0]===true){cspx="".concat(parseInt(tm[j][curr].style.width)+diff,"px")}else{cspx=sizepx;if((mrow=mi[1]+1)==row&&(cell=this._aPane.getCellByCoords(mi[2]+1,mrow))!==undefined){cell.style.width="".concat(parseInt(cell.style.width)+diff,"px")}}}else{cspx=sizepx}if(size){st=tm[j][curr].style;st.width=cspx;if(oldsize==0){st.display=""}}else{if(oldsize){tm[j][curr].style.display="none"}}}move_sum+=diff}++curr_abs;if(curr++==max||!move_sum){continue}newpos="".concat(parseInt(fr[curr].style.left)+move_sum,"px");if(this._gmode_edit){ch[curr].style.left=newpos;if(curr_abs in ahdrs_o){ahdrs_a[ahdrs_o[curr_abs]][1].style.left=newpos}cs[curr].style.left=newpos}for(var j=0;j<th;tm[j][curr].style.left=newpos,++j){}}else{if((oldsize=oldvals[curr_abs])!=size){if(size){if(this._gmode_edit){st=rh[curr].style;st.height=sizepx;if(oldsize==0){st.display=""}if(curr_abs in ahdrs_o){st=ahdrs_a[ahdrs_o[curr_abs]][1].style;st.height=sizepx;if(oldsize==0){st.display=""}}}st=tr[curr].style;st.height=sizepx;if(oldsize==0){st.display=""}}else{if(oldsize){if(this._gmode_edit){rh[curr].style.display="none";if(curr_abs in ahdrs_o){ahdrs_a[ahdrs_o[curr_abs]][1].style.display="none"}}tr[curr].style.display="none"}}diff=size-oldsize;for(var mi,mcol,cell,col=ctc[0],j=0;j<tw;++j,++col){if((mi=this._aPane._storage.getPart(j,curr,"m"))!==undefined){if(mi[0]===true){tm[curr][j].style.height="".concat(parseInt(tm[curr][j].style.height)+diff,"px")}else{if((mcol=mi[2]+1)==col&&(cell=this._aPane.getCellByCoords(mcol,mi[1]+1))!==undefined){cell.style.height="".concat(parseInt(cell.style.height)+diff,"px")}}}}move_sum+=diff}++curr_abs;if(curr++==max||!move_sum){continue}newpos="".concat(parseInt((tr_s=tr[curr].style).top)+move_sum,"px");if(this._gmode_edit){rh[curr].style.top=newpos;if(curr_abs in ahdrs_o){ahdrs_a[ahdrs_o[curr_abs]][1].style.top=newpos}}tr_s.top=newpos}}if(!move_sum){continue}for(var ahdr,ahdr_s,ahdrs_a=this._activeHdrs_a0[type],curr=-1;(ahdr=ahdrs_a[++curr])!=undefined;){if(ahdr[0]<=range[1]){continue}if(type==this._SCROLL_HORIZ){(ahdr_s=ahdr[1].style).left="".concat(parseInt(ahdr_s.left)+move_sum,"px")}else{(ahdr_s=ahdr[1].style).top="".concat(parseInt(ahdr_s.top)+move_sum,"px")}}if(range[1]>=tbl_end){continue}for(var tr_s,newpos,curr=range[1]-tbl_beg+1,max=tbl_size[type];curr<max;++curr){if(type==this._SCROLL_HORIZ){newpos="".concat(parseInt(fr[curr].style.left)+move_sum,"px");if(this._gmode_edit){ch[curr].style.left=newpos,cs[curr].style.left=newpos}for(var j=0;j<th;tm[j][curr].style.left=newpos,++j){}}else{newpos="".concat(parseInt((tr_s=tr[curr].style).top)+move_sum,"px");if(this._gmode_edit){rh[curr].style.top=newpos}tr_s.top=newpos}}}this._reconstruct();if(this._gmode_edit){this._aPane._defaultSelection.draw(),this._aPane._formulaSelection.draw(),this._aPane._copySelection.draw()}var cr_size,pos=this._aPane._lastDestCell[type]+1,sum=crs.getElemAt(pos),oc_size=type==this._SCROLL_HORIZ?this._aPane._ocWidth:this._aPane._ocHeight;for(var max=oc_size;sum<max;sum+=crs.getElemAt(++pos)){}this._aPane._cppi[type]=pos-this._aPane._lastDestCell[type]-1;this._aPane._cpp[type]=this._aPane._cppi[type]+((cr_size=crs.getElemAt(pos))-sum+oc_size)/cr_size;this._book._recalcSlider(type)},resizeColRow:function(type,ranges,newsize){if((type|1)!=1){return false}if(newsize<this._cellSizeIncr[type]){newsize=0}var range,chngsets=[],max=ranges.length,i=0;for(;i<max;++i){range=ranges[i],chngsets.push([range[0],range[1],newsize])}this.setColRowSize(type,chngsets);if(ranges.length==1&&ranges[0][0]==1&&ranges[0][1]==this._defMaxCoords[type]){this._conn.cmd(this._conn.dummy_cb,["sdcr"],[type,newsize])}else{this._conn.cmd(this._conn.dummy_cb,["scr",type],chngsets)}},autofitColRow:function(type,ranges){this._conn.cmd([this._book,this._book.exec],["afit",type],ranges,this._aPane.getRealGridRange(),!type,!!type,0)},adjustRowHeights:function(row1,row2,contentHeight){var ranges=[],range=undefined,rowHeight;for(var rh=this._rowHeights,row=row1;row<=row2;++row){rowHeight=rh.getElemAt(row);if(contentHeight==rowHeight){continue}if(contentHeight>rowHeight){if(range===undefined){range=[row,row];continue}if(row==range[1]+1){range[1]=row;continue}ranges.push(range);range=[row,row]}}if(range!==undefined){ranges.push(range)}if(ranges.length){this.resizeColRow(1,ranges,contentHeight)}},newDims:function(type,dims_new){var svec_old=this._colRowDims[type],dims_old=svec_old.getSparseArray(),idx_max=svec_old.getLen(),idx,idx_old=idx_max,idx_new=idx_max,val,val_old=0,val_new=0,next_new=true,next_old=true,cond=2,sets=[],set;for(var i_old=0,i_new=0,end_old=dims_old.length,end_new=dims_new.length;cond;){if(next_new){if(i_new<end_new){idx_new=dims_new[i_new++]+1;val_new=dims_new[i_new++]}else{idx_new=idx_max;val_new=0;--cond}next_new=false}if(next_old){if(i_old<end_old){idx_old=dims_old[i_old++];val_old=dims_old[i_old++]}else{idx_old=idx_max;val_old=0;--cond}next_old=false}if(idx_new<idx_old){next_new=true;idx=idx_new;val=val_new}else{if(idx_new>idx_old){next_old=true;idx=idx_old;val=-1}else{next_new=true;next_old=true;if(val_new==val_old){continue}else{idx=idx_new;val=val_new}}}if(!set){set=[idx,idx,val]}else{if(idx==set[1]+1){++set[1];if(set.length>3||val!=set[2]){set.push(val)}}else{sets.push(set);set=[idx,idx,val]}}}if(set){sets.push(set)}this.setColRowSize(type,sets)},recalc:function(cb){this._aPane.recalc(cb)}};Jedox.wss.grid.Book=function(cb,winObj,wbId,wbGHN){var that=this;this._inited=false;this._winObj=winObj;this._winId=winObj.initialConfig._winId;this._wbId=wbId;this._domId="B".concat(this._winId);this._contentEl=winObj.initialConfig.contentEl;this.scrollObserver=new Jedox.gen.Observer();this._viewMode=Jedox.wss.app.appMode;this._app=Jedox.wss.app;this._jwgrid=Jedox.wss.grid;this._jwstyle=Jedox.wss.style;this._json=Ext.util.JSON;this._conn=Jedox.wss.backend.conn;this._ha=Jedox.wss.backend.ha;this._gmode_edit=this._viewMode==this._jwgrid.viewMode.DESIGNER;this._defScrollSpeed=this._jwgrid.defDefScrollSpeed;this._currScrollSpeeds=[0,0];this._tid_scrollGrid=0;this._tid_startScrollGrid=[0,0];this._tid_scrollReach=0;this._scrollPending=false;this._scrollOpPending=false;this._doCheckSlider=false;this._scrollDirectionMap=[];var scrollDir=this._jwgrid.ScrollDirection;this._scrollDirectionMap[scrollDir.UP]=[this._SCROLL_VERT,this._SCROLL_BACK];this._scrollDirectionMap[scrollDir.DOWN]=[this._SCROLL_VERT,this._SCROLL_FWD];this._scrollDirectionMap[scrollDir.LEFT]=[this._SCROLL_HORIZ,this._SCROLL_BACK];this._scrollDirectionMap[scrollDir.RIGHT]=[this._SCROLL_HORIZ,this._SCROLL_FWD];this._genContentEl();Jedox.wss.workspace.displayWindow(winObj,wbId,wbGHN);winObj.on("activate",function(){that._selectGrid()});winObj.on("bodyresize",function(){that._fit()});winObj.on("bodyresize",function(){that._sheetSelector._refresh()});winObj.on("beforeclose",function(){return that._beforeUnloadGrid()});winObj.on("close",function(){that._unloadGrid()});winObj.on("restore",function(){that._restoreGrid()});this._horSB=document.getElementById(this._domId.concat("_gridHorSB"));this._horSB_bg=document.getElementById(this._domId.concat("_gridHorSB_bg"));this._vertSB=document.getElementById(this._domId.concat("_gridVertSB"));this._vertSB_bg=document.getElementById(this._domId.concat("_gridVertSB_bg"));this._sliders=[YAHOO.widget.Slider.getHorizSlider(this._domId+"_gridHorSB_bg",this._domId+"_gridHorSB_slider",0,1,1),YAHOO.widget.Slider.getVertSlider(this._domId+"_gridVertSB_bg",this._domId+"_gridVertSB_slider",0,1,1)];this._sliderFills=[[document.getElementById(this._domId+"_gridHorSB_lfill"),document.getElementById(this._domId+"_gridHorSB_rfill")],[document.getElementById(this._domId+"_gridVertSB_ufill"),document.getElementById(this._domId+"_gridVertSB_dfill")]];this._sliderCenter=[document.getElementById(this._domId+"_gridHorSB_cntr"),document.getElementById(this._domId+"_gridVertSB_cntr")];this._sliderSize=[0,0];this._sliderTicks=[0,0];this._scrollbarBGOffset=[this._jwgrid.defScrollbarBGOffset[0],this._jwgrid.defScrollbarBGOffset[1]];this._sliderBorderElemsSize=[this._jwgrid.defSliderBorderElemsSize[0],this._jwgrid.defSliderBorderElemsSize[1]];this._sliderCenterElemSize=[this._jwgrid.defSliderCenterElemSize[0],this._jwgrid.defSliderCenterElemSize[1]];this._flattenedCenterElem=[false,false];this._sliderThumbSize=[0,0];this._scrollSpace=[0,0];this._scrollSpaceCorr=[0,0];this._sliders[0].subscribe("change",function(offset,destCellAbs,cb){that._aPane._scrollGridX(offset,destCellAbs,cb)});this._sliders[0].subscribe("slideEnd",function(){that._horSB_slideEnd()});this._sliders[0].scrollGrid=function(offset,destCellAbs,cb){that._aPane._scrollGridX(offset,destCellAbs,cb)};this._sliders[0].setConstraint=function(from,to,ticksize){this.thumb.setXConstraint(from,to,ticksize)};this._sliders[0].onMouseDown=function(ev){that._sliderX_omd(ev)};this._sliders[0].onMouseUp=function(){that._clr_tid_SR()};this._sliders[0].animate=false;this._sliders[0].dragOnly=false;this._sliders[0].enableKeys=false;this._sliderFills[0].setSize=function(elem,size){this[elem].style.width=size+"px"};this._sliderCenter[0].setSize=function(size){this.style.width=size+"px"};this._sliders[1].subscribe("change",function(offset,destCellAbs,cb){that._aPane._scrollGridY(offset,destCellAbs,cb)});this._sliders[1].subscribe("slideEnd",function(){that._vertSB_slideEnd()});this._sliders[1].scrollGrid=function(offset,destCellAbs,cb){that._aPane._scrollGridY(offset,destCellAbs,cb)};this._sliders[1].setConstraint=function(from,to,ticksize){this.thumb.setYConstraint(from,to,ticksize)};this._sliders[1].onMouseDown=function(ev){that._sliderY_omd(ev)};this._sliders[1].onMouseUp=function(){that._clr_tid_SR()};this._sliders[1].animate=false;this._sliders[1].dragOnly=false;this._sliders[1].enableKeys=false;this._sliderFills[1].setSize=function(elem,size){this[elem].style.height=size+"px"};this._sliderCenter[1].setSize=function(size){this.style.height=size+"px"};var horSB_left=document.getElementById(this._domId+"_gridHorSB_left");horSB_left.onmousedown=function(){that._horSB_left_omd()};horSB_left.onmouseup=function(){that._horSB_stop()};horSB_left.onmouseout=function(){that._horSB_stop()};var horSB_right=document.getElementById(this._domId+"_gridHorSB_right");horSB_right.onmousedown=function(){that._horSB_right_omd()};horSB_right.onmouseup=function(){that._horSB_stop()};horSB_right.onmouseout=function(){that._horSB_stop()};var vertSB_up=document.getElementById(this._domId+"_gridVertSB_up");vertSB_up.onmousedown=function(){that._vertSB_up_omd()};vertSB_up.onmouseup=function(){that._vertSB_stop()};vertSB_up.onmouseout=function(){that._vertSB_stop()};var vertSB_down=document.getElementById(this._domId+"_gridVertSB_down");vertSB_down.onmousedown=function(){that._vertSB_down_omd()};vertSB_down.onmouseup=function(){that._vertSB_stop()};vertSB_down.onmouseout=function(){that._vertSB_stop()};this._sheetsOC=document.getElementById(this._domId.concat("_sheets"));this._sheetCnt=0;this._sheets={};this._sheetSelector=new Jedox.wss.cls.SheetSelector(this._domId,this);this._fit();this._conn.setCcmd('[["olst",2],["olst",3],["ocurr",2],["bget","",[],[],{"e_type":"conf"}]]');this._conn.sendBatch([this,this._init_post,cb])};Jedox.wss.grid.Book.prototype={_SCROLL_HORIZ:0,_SCROLL_VERT:1,_SCROLL_BACK:-1,_SCROLL_FWD:1,_FLAG_RENEW:1,_FLAG_RECON:2,_init_post:function(res,cb){if(res[0][0]!==true||res[1][0]!==true||res[2][0]!==true||res[3][0]!==true){return}this._sheetUids=res[0][1];this._sheetsC2O=res[1][1];this._sheetsO2C=Jedox.util.objFlip(this._sheetsC2O);var aSheetUid=res[2][1];this._aSheetUid=aSheetUid in this._sheetsC2O?this._sheetsC2O[aSheetUid]:aSheetUid;this._sheetSelector.readWorksheets();if(res[3][1].length){this._conf=res[3][1][0];this._autoRefresh="autoRefresh" in this._conf?this._conf.autoRefresh:0}else{this._conf=null;this._autoRefresh=0}this._showSheet(cb,this._aSheetUid);this._inited=true},_genContentEl:function(){var html=['<div id="',this._domId,'_gridVertSB" class="gridVertSB">','<img id="',this._domId,'_gridVertSB_up" class="gridVertSB_up" src="../lib/ext/resources/images/default/s.gif" width="17" height="17" />','<div id="',this._domId,'_gridVertSB_bg" class="gridVertSB_bg">','<div id="',this._domId,'_gridVertSB_slider" class="gridVertSB_slider">','<img class="gridScrollImg_el_top" width="17" height="4" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_vfill" width="17" height="1" id="',this._domId,'_gridVertSB_ufill" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_vcenter" width="17" height="8" id="',this._domId,'_gridVertSB_cntr" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_vfill" width="17" height="1" id="',this._domId,'_gridVertSB_dfill" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_bottom" width="17" height="4" src="../lib/ext/resources/images/default/s.gif" />',"</div>","</div>",'<img id="',this._domId,'_gridVertSB_down" class="gridVertSB_down" src="../lib/ext/resources/images/default/s.gif" width="17" height="17" />',"</div>",'<div id="',this._domId,'_sheets" class="sheetsOC"> </div>','<div id="gridBRSpacer"> </div>','<div class="sheetSelectorOC"',(Jedox.wss.app.UPRestrictMode&&Jedox.wss.app.userPreview?' style="visibility: hidden;"':""),' id="',this._domId,'_sheetSelectorOC">','<div class="sheetSelectorTB" id="',this._domId,'_sheetSelectorTB"></div>','<div class="sheetSelectorIC" id="',this._domId,'_sheetSelectorIC"></div>',"</div>",'<div id="',this._domId,'_gridHorSB" class="gridHorSB">','<img id="',this._domId,'_gridHorSB_left" class="gridHorSB_left" src="../lib/ext/resources/images/default/s.gif" width="17" height="17" />','<div id="',this._domId,'_gridHorSB_bg" class="gridHorSB_bg">','<div id="',this._domId,'_gridHorSB_slider" class="gridHorSB_slider">','<img class="gridScrollImg_el_left" width="4" height="17" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_hfill" height="17" width="1" id="',this._domId,'_gridHorSB_lfill" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_hcenter" height="17" width="8" id="',this._domId,'_gridHorSB_cntr" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_hfill" height="17" width="1" id="',this._domId,'_gridHorSB_rfill" src="../lib/ext/resources/images/default/s.gif" />','<img class="gridScrollImg_el_right" width="4" height="17" src="../lib/ext/resources/images/default/s.gif" />',"</div>","</div>",'<img id="',this._domId,'_gridHorSB_right" class="gridHorSB_right" src="../lib/ext/resources/images/default/s.gif" width="17" height="17" />',"</div>"];this._contentEl.id=this._domId.concat("_OC");this._contentEl.innerHTML=html.join("")},_fit:function(){if(this._winObj._isMinimizing){return}this._sheetsOCWidth=this._winObj.getInnerWidth()-17;this._sheetsOCHeight=this._winObj.getInnerHeight()-17;var horSB_width=this._sheetsOCWidth/2;this._sliderSize[0]=horSB_width-this._scrollbarBGOffset[0];this._sliderSize[1]=this._sheetsOCHeight-this._scrollbarBGOffset[1];this._sheetsOC.style.width="".concat(this._sheetsOCWidth,"px");this._sheetSelector.setWidth(this._sheetsOCWidth-horSB_width);this._horSB.style.width="".concat(horSB_width,"px");this._horSB_bg.style.width="".concat(this._sliderSize[0],"px");this._sheetsOC.style.height=this._vertSB.style.height="".concat(this._sheetsOCHeight,"px");this._vertSB_bg.style.height="".concat(this._sliderSize[1],"px");for(var sheetUid in this._sheets){this._sheets[sheetUid]._fit()}},_showSheet:function(cb,uid,flags){if(!(uid in this._sheetUids)){return false}if(this._aSheet){this._aSheet._contentEl.style.visibility="hidden"}if(flags&this._FLAG_RENEW&&uid in this._sheets){this._sheetsOC.removeChild(this._sheets[uid]._contentEl);delete this._sheets[uid]}this._aSheetUid=uid;if(uid in this._sheets){this._app.activeSheet=this._aSheet=this._sheets[uid];this._app.activePane=this._aPane=this._aSheet._aPane;this._app.environment=this._aPane._env.shared;this._aSheet._contentEl.style.visibility="";this._sheetSelector.enable(true);this._aSheet.recalc(flags&this._FLAG_RECON?[this._aSheet,this._aSheet._reconstruct,cb]:cb)}else{this._app.activeSheet=this._aSheet=this._sheets[uid]=new Jedox.wss.grid.Sheet(cb,this,uid)}return true},setClone:function(cloneUid){this._sheetsO2C[this._aSheetUid]=cloneUid;this._sheetsC2O[cloneUid]=this._aSheetUid},_actOnSheetSel:function(cb){switch(this._sheetSelector.action){case this._sheetSelector.actionTypes.SELECTED:var sheetUid=this._sheetSelector.getActiveSheetId(),res;if(!(sheetUid in this._sheetUids)){break}if(sheetUid in this._sheetsO2C){this._ha.selectSheet(this._sheetsO2C[sheetUid],true,this._gmode_edit)}else{if((res=this._ha.selectSheet(sheetUid,false,this._gmode_edit,null,cb instanceof Array&&cb.length>1?true:false))[1]){this._sheetsO2C[sheetUid]=res[2],this._sheetsC2O[res[2]]=sheetUid}}this._showSheet(cb,sheetUid,this._FLAG_RECON);Jedox.wss.workspace.chkHBCtl();break;case this._sheetSelector.actionTypes.ADDED:var res=this._ha.addSheet(this._sheetSelector.actionData);if(res.errcode){break}this._sheetSelector.freeze(false);this._sheetSelector.insertEntry(res.name,res.wsid,this._sheetSelector.actionData);this._sheetSelector.freeze(true);this._sheetUids[res.wsid]=res.name;this._showSheet(cb,res.wsid);break;case this._sheetSelector.actionTypes.REMOVED:var sheetUid=this._sheetSelector.getActiveSheetId();if(sheetUid in this._sheetsO2C){this._ha.selectSheet(this._sheetsO2C[sheetUid],true,this._gmode_edit)}else{this._ha.selectSheet(sheetUid,false,this._gmode_edit)}this._showSheet(cb,sheetUid,this._FLAG_RECON);var removedSheetUid=this._sheetSelector.actionData;this._sheetsOC.removeChild(this._sheets[removedSheetUid]._contentEl);delete this._sheetUids[removedSheetUid];delete this._sheets[removedSheetUid];this._conn.cmd(this._conn.dummy_cb,["odel",2],[removedSheetUid]);break;case this._sheetSelector.actionTypes.COPIED:var data=this._sheetSelector.actionData,sameWb=typeof data.wbId!="string"||!data.wbId.length,res=this._ha.copySheet(data.wsId,data.nextSheetId,data.wbId);if(res.errcode){break}if(sameWb){this._sheetSelector.freeze(false);this._sheetSelector.insertEntry(res.name,res.wsid,data.nextSheetId);this._sheetSelector.freeze(true);this._sheetUids[res.wsid]=res.name;this._showSheet(cb,res.wsid)}else{this._sheetSelector.enable(true);Jedox.wss.general.setInputMode(this._app.lastInputModeDlg);this._app.lastInputMode=this._jwgrid.GridMode.READY;Jedox.wss.workspace.showWinByWbId(data.wbId);var destWb=this._app.activeBook;destWb._sheetUids[res.wsid]=res.name;destWb._sheetSelector.insertEntry(res.name,res.wsid,data.nextSheetId)}break;case this._sheetSelector.actionTypes.MOVED:var data=this._sheetSelector.actionData,sameWb=typeof data.wbId!="string"||!data.wbId.length,res=this._ha.moveSheet(data.wsId,data.nextSheetId,data.wbId);if(res.errcode){break}if(sameWb){this._sheetSelector.freeze(false);this._sheetSelector.insertEntry(res.name,res.wsid,data.nextSheetId);this._sheetSelector.freeze(true);this._sheetSelector.enable(true);if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}}else{this._sheetsOC.removeChild(this._sheets[data.wsId]._contentEl);delete this._sheetUids[data.wsId];delete this._sheets[data.wsId];this._sheetSelector.enable(true);Jedox.wss.general.setInputMode(this._app.lastInputModeDlg);this._app.lastInputMode=this._jwgrid.GridMode.READY;Jedox.wss.workspace.showWinByWbId(data.wbId);var destWb=this._app.activeBook;destWb._sheetUids[res.wsid]=res.name;destWb._sheetSelector.insertEntry(res.name,res.wsid,data.nextSheetId)}break;case this._sheetSelector.actionTypes.UNCLONED:Jedox.wss.wsel.unloadAll();if(this._ha.removeCloneWorksheet()===false){break}delete this._sheetsC2O[this._sheetsO2C[this._aSheetUid]];delete this._sheetsO2C[this._aSheetUid];this._ha.selectSheet(this._aSheetUid,false,this._gmode_edit);this._showSheet(cb,this._aSheetUid,this._FLAG_RENEW);break}this._sheetSelector.action=this._sheetSelector.actionTypes.NONE},_selectGrid:function(){if(this._app.activeBook==this){return}var workspace=Jedox.wss.workspace,metaData=workspace.getMetaByWinId(this._winId);try{for(var triggers=Jedox.wss.events.triggers.switchWorkbook_before,i=triggers.length-1,wbMeta=metaData;i>=0;i--){triggers[i][0]["switchWorkbook_before"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}this._app.activeBook=this;this._app.activeSheet=this._aSheet;this._app.activePane=this._aPane;workspace.activeWin=this._winObj;this._app.environment=this._aPane._env.shared;if(this._gmode_edit){workspace.chkHBCtl()}this._app.updateUndoState();if(!this._sheetSelector.getLoadMark(true)){this._ha.selectBook(this._wbId);var sheetUid=this._sheetSelector.getActiveSheetId();if(sheetUid in this._sheetsO2C){this._ha.selectSheet(this._sheetsO2C[sheetUid],true,this._gmode_edit)}else{this._ha.selectSheet(sheetUid,false,this._gmode_edit)}this._aPane.recalc()}Jedox.wss.action.adjustToACL();try{for(var triggers=Jedox.wss.events.triggers.switchWorkbook_after,i=triggers.length-1,wbMeta=metaData;i>=0;i--){triggers[i][0]["switchWorkbook_after"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}},_beforeUnloadGrid:function(){function dywtscDlg(bnsRes){function wbClose(){var activeBook=Jedox.wss.app.activeBook;activeBook._doClose=true;activeBook._winObj.close()}Ext.MessageBox.buttonText={ok:"OK".localize(),cancel:"Cancel".localize(),yes:"Yes".localize(),no:"No".localize()};if(bnsRes[0][0]&&bnsRes[0][1]){Ext.MessageBox.show({title:"File not saved".localize(),msg:"autosave_msg".localize(),icon:Ext.MessageBox.WARNING,modal:true,buttons:Ext.MessageBox.YESNOCANCEL,fn:function(btn){switch(btn){case"yes":Jedox.wss.book.save([this,wbClose]);break;case"no":wbClose();break;case"cancel":break}}})}else{wbClose()}}var wbMeta=Jedox.wss.workspace.getMetaByWinId(this._winId);try{for(var triggers=Jedox.wss.events.triggers.closeWorkbook_before,i=triggers.length-1;i>=0;--i){triggers[i][0]["closeWorkbook_before"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}if(this._app.environment.viewMode!=Jedox.wss.grid.viewMode.USER&&this._doClose!==true&&(wbMeta.ghn==null||wbMeta.ghn.p>=Jedox.wss.grid.permission.PERM_WRITE)){this._conn.cmd([this,dywtscDlg],["bns"],[]);return false}Jedox.wss.wsel.unloadAll()}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR);return false}return true},_unloadGrid:function(){var metaData=Jedox.wss.workspace.getMetaByWinId(this._winId);this._ha.removeBook(this._wbId);Jedox.wss.book.destroy(this._winId);Jedox.wss.action.adjustToACL();try{for(var triggers=Jedox.wss.events.triggers.closeWorkbook_after,i=triggers.length-1,wbMeta=metaData;i>=0;--i){triggers[i][0]["closeWorkbook_after"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}},_restoreGrid:function(){this._aPane._env.shared.winStateMax=this._winObj.maximized},_recalcSlider:function(type,no_repos){if((type|1)!=1){return false}var paneOCSize=parseInt(type==this._SCROLL_HORIZ?this._aPane._contentEl.style.width:this._aPane._contentEl.style.height);this._sliderThumbSize[type]=parseInt(paneOCSize/(paneOCSize+(this._aPane._farthestSeenCell[type]-this._aPane._cpp[type])*this._aSheet._defColRowDims[type])*this._sliderSize[type]);if(this._sliderThumbSize[type]<this._sliderBorderElemsSize[type]){this._sliderThumbSize[type]=this._sliderBorderElemsSize[type]}this._scrollSpace[type]=this._sliderSize[type]-this._sliderThumbSize[type];this._sliderTicks[type]=this._scrollSpace[type]/(this._aPane._farthestSeenCell[type]-this._aPane._defcppi[type]);this._scrollSpaceCorr[type]=0;var ticksi=Math.round(this._sliderTicks[type]);if(ticksi>0){var mod=this._scrollSpace[type]%ticksi;if(mod>ticksi/2){this._scrollSpaceCorr[type]=ticksi-mod}else{this._scrollSpaceCorr[type]=-mod}}else{ticksi=1}this._sliders[type].setConstraint(0,this._scrollSpace[type]+this._scrollSpaceCorr[type],ticksi);var thumbexcfill=this._sliderBorderElemsSize[type]+this._sliderCenterElemSize[type];if(this._sliderThumbSize[type]<thumbexcfill){if(this._flattenedCenterElem[type]==false){this._sliderCenter[type].setSize(0);this._flattenedCenterElem[type]=true}thumbexcfill=this._sliderBorderElemsSize[type]}else{if(this._flattenedCenterElem[type]==true){this._sliderCenter[type].setSize(this._sliderCenterElemSize[type]);this._flattenedCenterElem[type]=false}}var fillsize=this._sliderThumbSize[type]-thumbexcfill-this._scrollSpaceCorr[type];if(fillsize>0){var fillhalf=Math.round(fillsize/2);this._sliderFills[type].setSize(1,fillhalf);this._sliderFills[type].setSize(0,fillsize-fillhalf)}else{this._sliderFills[type].setSize(1,0);this._sliderFills[type].setSize(0,0)}if(no_repos){return}this._sliders[type].setValue(this._aPane._lastDestCell[type]*this._sliderTicks[type],true,true,true)},startScrollGrid:function(cb,type,dir,speed){if(arguments[4]!==true){if((type|1)!=1||this._scrollOpPending){return false}if(speed==undefined||speed==NaN||speed<=0){speed=this._defScrollSpeed}if(speed==this._currScrollSpeeds[type]){return true}if(this._currScrollSpeeds[type]){clearTimeout(this._tid_startScrollGrid[type])}this._currScrollSpeeds[type]=speed;this._scrollOpPending=true}if(dir==this._SCROLL_BACK){if(this._aPane._lastDestCell[type]>0){this._doCheckSlider=true;return this._sliders[type].scrollGrid(0,this._aPane._lastDestCell[type]-1,[this,this.startScrollGrid_post,cb,type,dir,speed])}}else{if(this._scrollSpace[type]+this._scrollSpaceCorr[type]-this._sliders[type].getValue()<this._sliderTicks[type]){if(this._gmode_edit){if(this._aPane._farthestSeenCell[type]<this._aPane._maxCoords[type]){this._aPane._farthestSeenCell[type]++;return this._sliders[type].scrollGrid(0,this._aPane._lastDestCell[type]+1,[this,this.startScrollGrid_post,cb,type,dir,speed,true])}else{if(this._aPane._lastDestCell[type]+this._aPane._cppi[type]<this._aPane._maxCoords[type]){return this._sliders[type].scrollGrid(0,this._aPane._lastDestCell[type]+1,[this,this.startScrollGrid_post,cb,type,dir,speed])}}}else{if(this._aPane._lastDestCell[type]+this._aPane._cppi[type]<this._aPane._farthestSeenCell[type]){return this._sliders[type].scrollGrid(0,this._aPane._lastDestCell[type]+1,[this,this.startScrollGrid_post,cb,type,dir,speed])}}}else{return this._sliders[type].scrollGrid(0,this._aPane._lastDestCell[type]+1,[this,this.startScrollGrid_post,cb,type,dir,speed])}}this._currScrollSpeeds[type]=0;this._scrollOpPending=false;return true},startScrollGrid_post:function(cb,type,dir,speed,mode){if(mode){this._recalcSlider(type,true),this._sliders[type].setValue(this._scrollSpace[type]+this._scrollSpaceCorr[type],true,true,true)}else{this._sliders[type].setValue(this._aPane._lastDestCell[type]*this._sliderTicks[type],true,true,true)}if(this._currScrollSpeeds[type]){var that=this;this._tid_startScrollGrid[type]=setTimeout(function(){that.startScrollGrid(cb,type,dir,speed,true)},speed)}if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}this._scrollOpPending=false},stopScrollGrid:function(type){this._currScrollSpeeds[type]=0},scrollTo:function(cb,col,row,minscroll,force){if(this._scrollOpPending){return false}--col;--row;var doHoriz=false,doVert=false;if(col<this._aPane._lastDestCell[0]){doHoriz=true}else{if(col>this._aPane._lastDestCell[0]+this._aPane._cppi[0]-1){doHoriz=true;if(minscroll==true){col-=this._aPane._cppi[0]-1}}else{if(force){doHoriz=true}}}if(row<this._aPane._lastDestCell[1]){doVert=true}else{if(row>this._aPane._lastDestCell[1]+this._aPane._cppi[1]-1){doVert=true;if(minscroll==true){row-=this._aPane._cppi[1]-1}}else{if(force){doVert=true}}}this._scrollOpPending=true;if(doHoriz){if(col>this._aPane._maxCoords[0]-this._aPane._cppi[0]){col=this._aPane._maxCoords[0]-this._aPane._cppi[0]}if(col+this._aPane._cppi[0]>this._aPane._farthestSeenCell[0]){this._aPane._farthestSeenCell[0]=col+this._aPane._cppi[0]}this._doCheckSlider=true;this._aPane._scrollGridX(undefined,col,doVert?[this,this._scrollTo_vert,cb,row]:[this,this._scrollTo_post,cb,false])}else{if(doVert){this._scrollTo_vert(cb,row)}else{if(cb instanceof Array&&cb.length>1){this._scrollTo_post(cb,false)}}}},_scrollTo_vert:function(cb,row){if(row>this._aPane._maxCoords[1]-this._aPane._cppi[1]){row=this._aPane._maxCoords[1]-this._aPane._cppi[1]}var atEnd=false;if(row+this._aPane._cppi[1]>=this._aPane._farthestSeenCell[1]){this._aPane._farthestSeenCell[1]=row+this._aPane._cppi[1],atEnd=true}this._doCheckSlider=true;this._aPane._scrollGridY(undefined,row,[this,this._scrollTo_post,cb,atEnd])},_scrollTo_post:function(cb,atEnd){if(atEnd){this._sliders[1].setValue(this._scrollSpace[1],true,true,true)}if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}this._scrollOpPending=false},_checkSlider:function(type){if(this._aPane._farthestSeenCell[type]>this._aSheet._farthestUsedCell[type]&&this._aPane._lastDestCell[type]+this._aPane._cppi[type]<this._aPane._farthestSeenCell[type]){if(this._aPane._lastDestCell[type]+this._aPane._cppi[type]>this._aSheet._farthestUsedCell[type]){this._aPane._farthestSeenCell[type]=this._aPane._lastDestCell[type]+this._aPane._cppi[type]}else{this._aPane._farthestSeenCell[type]=this._aSheet._farthestUsedCell[type]}if(this._aPane._farthestSeenCell[type]<this._aPane._defcppi[type]+2){this._aPane._farthestSeenCell[type]=this._aPane._defcppi[type]+2}}this._recalcSlider(type);this._doCheckSlider=false;return true},_scrollReach:function(type,mousePos){if((type|1)!=1||this._scrollOpPending){return false}var dir=0;if(type==this._SCROLL_HORIZ){if(mousePos<this._sliders[0].thumb.lastPageX){dir=this._SCROLL_BACK}else{if(mousePos>this._sliders[0].thumb.lastPageX+this._sliders[0].thumb._domRef.offsetWidth){dir=this._SCROLL_FWD}}}else{if(mousePos<this._sliders[1].thumb.lastPageY){dir=this._SCROLL_BACK}else{if(mousePos>this._sliders[1].thumb.lastPageY+this._sliders[1].thumb._domRef.offsetHeight){dir=this._SCROLL_FWD}}}if(dir==this._SCROLL_BACK){var interimDestCell=this._aPane._lastDoneDestCell[type]-this._aPane._cppi[type];if(interimDestCell<0){interimDestCell=0}this._scrollOpPending=true;this._doCheckSlider=true;this._sliders[type].scrollGrid(0,interimDestCell,[this,this.scrollReach_post,type,mousePos,interimDestCell])}else{if(dir==this._SCROLL_FWD){var interimDestCell=this._aPane._lastDoneDestCell[type]+this._aPane._cppi[type];if(interimDestCell+this._aPane._cppi[type]>this._aPane._farthestSeenCell[type]){if(this._gmode_edit){this._aPane._farthestSeenCell[type]=interimDestCell+this._aPane._cppi[type];if(this._aPane._farthestSeenCell[type]>this._aPane._maxCoords[type]){this._aPane._farthestSeenCell[type]=this._aPane._maxCoords[type]}this._recalcSlider(type)}else{interimDestCell=this._aPane._farthestSeenCell[type]-this._aPane._cppi[type]}}this._scrollOpPending=true;this._doCheckSlider=true;this._sliders[type].scrollGrid(0,interimDestCell,[this,this.scrollReach_post,type,mousePos,interimDestCell])}else{this._scrollOpPending=false,this._checkSlider(type)}}},scrollReach_post:function(type,mousePos,interimDestCell){this._sliders[type].setValue(interimDestCell*this._sliderTicks[type],true,true,true);if(!this._scrollOpPending){return}var that=this;this._tid_scrollReach=setTimeout(function(){that._scrollReach(type,mousePos)},50);this._scrollOpPending=false},exec:function(res,cb){if(typeof res!="object"||!res.length){return false}cmds=res[0];for(var cmd,cmdid,c=-1;(cmd=cmds[++c])!=undefined;){switch(cmdid=cmd.shift()){case"crgn":this._aPane._cache.clear();for(var rgn,frn=this._aPane.furnishCell,comb=cmd[0].cm,i=0;(rgn=cmd[++i])!=undefined;){for(var cell,x=rgn[0],y=rgn[1],w=rgn[2],j=2;(cell=rgn[++j])!=undefined;){frn.call(this._aPane,x,y,cell,comb);if(++x-rgn[0]>=w&&w>0){++y,x=rgn[0]}}}break;case"ccr":this._aSheet.setColRowSize(cmd.shift(),cmd);break;case"wmv":if(cmd.length){for(var wsel,i=cmd.length-1;i>=0;--i){wsel=cmd[i];switch(wsel.type){case"img":Jedox.wss.wsel.img.moveTo(wsel.id,wsel.pos,wsel.offsets);break;case"formel":Jedox.wss.wsel.formelMoveTo(wsel);break;case"chart":Jedox.wss.wsel.chart.reMovize(wsel.id,wsel.pos,wsel.offsets);break;case"hb":Jedox.wss.hb.move(wsel.id,wsel.pos);break}}}break;case"rw":if(cmd.length){Jedox.wss.general.refreshWorksheetElements(cmd)}break;case"rf":if(cmd.length){Jedox.wss.wsel.refreshAll(cmd)}break;case"wtrd":if(cmd.length){Jedox.wss.wsel.updateTarget(cmd)}break;case"curn":this._aSheet._farthestUsedCell[0]=cmd[0];if(cmd[0]>this._aPane._farthestSeenCell[0]){this._aPane._farthestSeenCell[0]=cmd[0],this._recalcSlider(0)}this._aSheet._farthestUsedCell[1]=cmd[1];if(cmd[1]>this._aPane._farthestSeenCell[1]){this._aPane._farthestSeenCell[1]=cmd[1],this._recalcSlider(1)}break;case"ncr":this._aSheet.newDims(0,cmd[0]);this._aSheet.newDims(1,cmd[1]);break}}Jedox.wss.general.refreshCursorField();if(this._gmode_edit){Jedox.wss.general.setCurrentCoord()}if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],[res[1]].concat(cb.slice(2)))}},cb:function(handle,params,diff_params){if(diff_params===undefined){diff_params=[]}var rgr=(typeof diff_params=="object"&&diff_params!==null)?this._aPane.getRealGridRange():(diff_params=[],null);var dimSet=diff_params[0]!=false?1:0;if(diff_params[1]!=false){dimSet|=2}this._conn.rpc([this._conn,this._conn.handleRes,[[this,this.exec]]],"WSS","cb",[handle,params,rgr,dimSet,diff_params[2]])},_undo_redo:function(op,steps){this._conn.createBatch();this._conn.cmd(null,[op],[steps]);this._conn.cmd(null,["gust"],[]);this._conn.sendBatch([this,this.exec],this._aPane.getRealGridRange())},undo:function(steps){this._undo_redo("undo",steps)},redo:function(steps){this._undo_redo("redo",steps)},_clr_tid_SR:function(){clearTimeout(this._tid_scrollReach);this._scrollOpPending=false},_sliderX_omd:function(ev){this._scrollReach(0,ev.clientX)},_sliderY_omd:function(ev){this._scrollReach(1,ev.clientY)},_horSB_left_omd:function(){this.startScrollGrid(undefined,0,-1)},_horSB_right_omd:function(){this.startScrollGrid(undefined,0,1)},_horSB_stop:function(){this.stopScrollGrid(0)},_vertSB_up_omd:function(){this.startScrollGrid(undefined,1,-1)},_vertSB_down_omd:function(){this.startScrollGrid(undefined,1,1)},_vertSB_stop:function(){this.stopScrollGrid(1)},_horSB_slideEnd:function(){this._scrollPending?this._doCheckSlider=true:this._checkSlider(0)},_vertSB_slideEnd:function(){this._scrollPending?this._doCheckSlider=true:this._checkSlider(1)},getEnvironment:function(){return this._aPane._env},getDomId:function(){return this._aPane._domId},getWinId:function(){return this._winId},getScrollDirMap:function(){return this._scrollDirectionMap},setWinCaption:function(capt){this._winObj.setTitle(capt)},setWbId:function(id){this._wbId=id},getWbId:function(){return this._wbId},getWsId:function(){return this._sheetSelector.getActiveSheetId()},getSheetSelector:function(){return this._sheetSelector},getCursorField:function(){return this._aPane._cursorField},isClone:function(){return this._aSheet.isClone()},getCoordByHdr:function(type,obj){return this._aSheet.getCoordByHdr(type,obj)},getHdrByCoord:function(type,coord){return this._aSheet.getHdrByCoord(type,coord)},activateHdr:function(type,idx,cls){return this._aSheet.activateHdr(type,idx,cls)},activateHdrRng:function(type,rng,cls){return this._aSheet.activateHdrRng(type,rng,cls)},activateHdrAll:function(type,cls){return this._aSheet.activateHdrAll(type,cls)},insertCol:function(col,num){return this._aSheet.insertCol(col,num)},insertRow:function(row,num){return this._aSheet.insertRow(row,num)},deleteCol:function(col,num){return this._aSheet.deleteCol(col,num)},deleteRow:function(row,num){return this._aSheet.deleteRow(row,num)},resizeColRow:function(type,ranges,newsize){return this._aSheet.resizeColRow(type,ranges,newsize)},autofitColRow:function(type,ranges){return this._aSheet.autofitColRow(type,ranges)},getCoordsByCell:function(obj){return this._aPane.getCoordsByCell(obj)},getCellByCoords:function(col,row){return this._aPane.getCellByCoords(col,row)},getPixelsByCoords:function(col,row){return this._aPane.getPixelsByCoords(col,row)},furnishCell:function(col,row,obj,comb){return this._aPane.furnishCell(col,row,obj,comb)},getNeighByOffset:function(col,row,offx,offy){return this._aPane.getNeighByOffset(col,row,offx,offy)},isCellVisible:function(col,row){return this._aPane.isCellVisible(col,row)},isCellLocked:function(col,row){return this._aPane.isCellLocked(col,row)},getCellDims:function(col,row){return this._aPane.getCellDims(col,row)},getCellValue:function(col,row){return this._aPane.getCellValue(col,row)},getCellFVal:function(col,row){return this._aPane.getCellFVal(col,row)},getCellUVal:function(col,row){return this._aPane.getCellUVal(col,row)},getCellFormula:function(col,row){return this._aPane.getCellFormula(col,row)},getCellType:function(col,row){return this._aPane.getCellType(col,row)},getCellStyle:function(col,row){return this._aPane.getCellStyle(col,row)},setCellValue:function(col,row,val){return this._aPane.setCellValue(col,row,val)},setRangeValue:function(range,vals){return this._aPane.setRangeValue(range,vals)},setArrayFormula:function(range,val){return this._aPane.setArrayFormula(range,val)},merge:function(range,isUnMerge){return this._aPane.merge(range,isUnMerge)},getMergeInfo:function(col,row){return this._aPane.getMergeInfo(col,row)},setCellStyle:function(col,row,style){return this._aPane.setCellStyle(col,row,style)},setRangeStyle:function(range,style){return this._aPane.setRangeStyle(range,style)},getRangeStyle:function(range,attrs){return this._aPane.getRangeStyle(range,attrs)},setRangeFormat:function(range,fmt){return this._aPane.setRangeFormat(range,fmt)},getRangeFormat:function(range){return this._aPane.getRangeFormat(range)},setRangeLock:function(range,lock){return this._aPane.setRangeLock(range,lock)},getCoordsFirstVCell:function(){return this._aPane.getCoordsFirstVCell()},getCoordsLastVCell:function(){return this._aPane.getCoordsLastVCell()},getVisibleRange:function(type){return this._aPane.getVisibleRange(type)},getRealGridRange:function(){return this._aPane.getRealGridRange()},getViewportSize:function(){return this._aPane.getViewportSize()},getViewportPos:function(){return this._aPane.getViewportPos()},getFarthestUsedCell:function(){return this._aPane.getFarthestUsedCell()},pasteRange:function(cb,range,clip_id,paste_what){return this._aPane.pasteRange(cb,range,clip_id,paste_what)},clrRange:function(range,clr_what){return this._aPane.clrRange(range,clr_what)},cbFire:function(col,row,attr_name,params){return this._aPane.cbFire(col,row,attr_name,params)},recalc:function(){return this._aPane.recalc()},getColHdrsIC:function(){return this._aPane._colHdrsIC},getRowHdrsIC:function(){return this._aPane._rowHdrsIC},getBookIC:function(){return this._aPane._ic}};Jedox.wss.grid.Selection=(function(){return function(startCoords,book){this._ranges=[];this._mode=Jedox.wss.range.RangeMode.NONE;this._activeRange=0;this._scope=this;this._startCoords=startCoords;this._book=book;this._container=((book==null)?null:this._book.getBookIC());this._environment=((book==null)?null:this._book.getEnvironment());this._headerState={colActive:false,colSelected:false,rowActive:false,rowSelected:false};this.lastParseRes=[];this.activeToken=null}})();Jedox.wss.grid.Selection.prototype={_isRect:function(){return false},_setLegacyVars:function(){var activeCell=this._ranges[this._activeRange].getActiveCell();if(this._environment.shared.headerMarkMode==""){this._environment.shared.headerStyle=0;this._environment.shared.lastMarkMode=0}this.setActiveCell(null,activeCell.getX()-Jedox.wss.app.firstRowNumeric+1,activeCell.getY()-Jedox.wss.app.firstColumn+1,false)},getActiveCellElement:function(){return this._ranges[this._activeRange].getCursorField()},getRanges:function(){return this._ranges},getRange:function(idx){return this._ranges[idx]},getValue:function(){var cellValue,cellFormula;var activeCell=this._ranges[this._activeRange].getActiveCell();try{cellValue=this._book.getCellUVal(activeCell.getX(),activeCell.getY());if(cellValue==undefined){cellValue=""}}catch(e){cellValue=""}try{cellFormula=this._book.getCellFormula(activeCell.getX(),activeCell.getY());if(cellFormula==undefined){cellFormula=""}}catch(e){cellFormula=""}return[cellValue,cellFormula]},activeCellIsVisible:function(){var activeCell=this._ranges[this._activeRange].getActiveCell();return this._book.isCellVisible(activeCell.getX(),activeCell.getY())},setMode:function(mode){this._mode=mode},getMode:function(){return this._mode},isSingleCell:function(){return(this._ranges[this._activeRange].getUpperLeft().equals(this._ranges[this._activeRange].getLowerRight()))},isSingleColumn:function(){return(this._ranges[this._activeRange].getUpperLeft().equalsY(this._ranges[this._activeRange].getLowerRight()))},isSingleRow:function(){return(this._ranges[this._activeRange].getUpperLeft().equalsX(this._ranges[this._activeRange].getLowerRight()))},getCell:function(numericX,numericY){return this._book.getCellByCoords(numericX,numericY)},setActiveCell:function(CellElement,x,y,saveLastCell){var currentFormula=Jedox.wss.app.currFormula;var inputField=this._environment.shared.inputField;this._environment.shared.selectedCell=this.getCell(x,y);this._environment.shared.selectedCellCoords=[x,y];try{this._environment.shared.selectedCellValue=this._book.getCellUVal(x,y);if(this._environment.shared.selectedCellValue==undefined){this._environment.shared.selectedCellValue=""}this._environment.shared.selectedCellFormula=this._book.getCellFormula(x,y);if(this._environment.shared.selectedCellFormula==undefined){this._environment.shared.selectedCellFormula=""}}catch(Exception){this._environment.shared.selectedCellValue="";this._environment.shared.selectedCellFormula=""}this._environment.shared.selectedRowNumericName=x;this._environment.shared.selectedColumnName=y;this._environment.shared.selectedAbsRowNameNumeric=Jedox.wss.app.firstRowNumeric+x-1;this._environment.shared.selectedAbsColumnName=Jedox.wss.app.firstColumn+y-1;this._environment.shared.selectedRowName=Jedox.wss.app.numberToLetter[x];this._environment.shared.selectedRow=this._book.getColHdrsIC().childNodes[x-1];this._environment.shared.selectedColumn=this._book.getRowHdrsIC().childNodes[y-1];var value=this.getValue();Jedox.wss.app.currCoord.value=this._environment.shared.selectedRowName+this._environment.shared.selectedAbsColumnName;this._environment.shared.inputField.value=value[0];Jedox.wss.app.currFormula.value=(value[1]!="")?value[1]:Jedox.wss.general.filterHLTags(x,y,value[0],false);try{if(this._environment.shared.cursorField!=null){Jedox.wss.style.cellTransfer(this._environment.shared.cursorField)}Jedox.wss.style.syncBar()}catch(e){}},setRefActiveCell:function(cell){this._ranges[this._activeRange].setRefActiveCell(cell)},getRefActiveCell:function(){return this._ranges[this._activeRange].getRefActiveCell()},scrollToActiveCell:function(previousActiveCell){var tmp=this._ranges[this._activeRange].getActiveCell();var offsets=[];offsets[0]=tmp.getX()-previousActiveCell.getX();offsets[1]=tmp.getY()-previousActiveCell.getY();if((!((tmp.getX()>=Jedox.wss.app.firstRowNumeric)))||(((tmp.getX()==(Jedox.wss.app.firstRowNumeric+1))&&(offsets[0]<0)))){if(offsets[0]>0){Jedox.wss.sheet.scrollXBy(Math.abs(offsets[0]),Jedox.wss.grid.ScrollDirection.RIGHT)}else{if(offsets[0]<0){Jedox.wss.sheet.scrollXBy(Math.abs(offsets[0]),Jedox.wss.grid.ScrollDirection.LEFT)}}}if((!((tmp.getY()>=Jedox.wss.app.firstColumn)))||(((tmp.getY()==(Jedox.wss.app.firstColumn+1))&&(offsets[1]<0)))){if(offsets[1]>0){Jedox.wss.sheet.scrollYBy(Math.abs(offsets[1]),Jedox.wss.grid.ScrollDirection.DOWN)}else{if(offsets[1]<0){Jedox.wss.sheet.scrollYBy(Math.abs(offsets[1]),Jedox.wss.grid.ScrollDirection.UP)}}}},_activeCellIsBevoreBoundary:function(){var activeCell=this._ranges[this._activeRange].getActiveCell();return((activeCell.getX()==(Jedox.wss.app.firstRowNumeric+1))||(activeCell.getY()==(Jedox.wss.app.firstColumn+1)))},_iterate:function(mode){var newRangeSelected=false;var direction;var offsets=[];var visibleBefore=this._scope.activeCellIsVisible();var previousActiveCell=this._ranges[this._activeRange].getActiveCell().clone();if(!this._isRect()){switch(mode){case Jedox.wss.grid.IterationMode.NEXT:case Jedox.wss.grid.IterationMode.NEXTY:if(this._ranges[this._activeRange].isLast()){this._ranges[this._activeRange].deactivate();if(this._activeRange==this._ranges.length-1){this._activeRange=0}else{this._activeRange++}this._ranges[this._activeRange].activate(direction);newRangeSelected=true;console.warn("previous range")}break;case Jedox.wss.grid.IterationMode.PREV:case Jedox.wss.grid.IterationMode.PREVY:if(this._ranges[this._activeRange].isFirst()){this._ranges[this._activeRange].deactivate();if(this._activeRange===0){this._activeRange=this._ranges.length}else{this._activeRange--}this._ranges[this._activeRange].activate(direction);newRangeSelected=true;consol.warn("previous range")}break}}if(!newRangeSelected){switch(mode){case Jedox.wss.grid.IterationMode.NEXT:this._ranges[this._activeRange].next();break;case Jedox.wss.grid.IterationMode.PREV:this._ranges[this._activeRange].prev();break;case Jedox.wss.grid.IterationMode.NEXTY:this._ranges[this._activeRange].nextY();break;case Jedox.wss.grid.IterationMode.PREVY:this._ranges[this._activeRange].prevY();break}}var activeBook=this._book,activeCell=this._ranges[this._activeRange].getActiveCell(),that=this,cbScrollTo=function(){that._setLegacyVars();that.draw()};if(visibleBefore){if(!this._book.isCellVisible(activeCell.getX(),activeCell.getY())&&!activeBook._scrollOpPending){this._book.scrollTo([this,cbScrollTo],activeCell.getX(),activeCell.getY(),true,false)}}else{if(activeBook._scrollOpPending){return}this._book.scrollTo([this,cbScrollTo],activeCell.getX(),activeCell.getY(),false,false)}},setState:function(state){if(state==Jedox.wss.range.AreaState.NEW){for(var i=this._ranges.length-1;i>=0;--i){if(this._ranges[i].getState()==Jedox.wss.range.AreaState.NEW){this._ranges[i].setState(Jedox.wss.range.AreaState.NORMAL);this._ranges[i].repaint()}}}if(this._activeRange in this._ranges){this._ranges[this._activeRange].setState(state)}},expandToCell:function(cell){this._ranges[this._activeRange].expandToCell(cell)},focusActiveCell:function(){var tmp=this._ranges[this._activeRange].getActiveCell();var gridUpperLeft=new Jedox.wss.cls.Point(Jedox.wss.app.firstRowNumeric,Jedox.wss.app.firstColumn);if((gridUpperLeft.getX()+this._ranges[this._activeRange].getOffsets()[0]+1-tmp.getX())>0){Jedox.wss.sheet.scrollXBy(Math.abs(gridUpperLeft.getX()-tmp.getX()+1),Jedox.wss.grid.ScrollDirection.LEFT)}if((gridUpperLeft.getY()+this._ranges[this._activeRange].getOffsets()[0]+1-tmp.getY())>0){Jedox.wss.sheet.scrollYBy(Math.abs(gridUpperLeft.getY()-tmp.getY()+1),Jedox.wss.grid.ScrollDirection.UP)}if((gridUpperLeft.getX()+this._ranges[this._activeRange].getOffsets()[1]+1-tmp.getX())<0){Jedox.wss.sheet.scrollXBy(Math.abs(gridUpperLeft.getX()-tmp.getX()+1),Jedox.wss.grid.ScrollDirection.RIGHT)}if((gridUpperLeft.getY()+this._ranges[this._activeRange].getOffsets()[1]+1-tmp.getY())<0){Jedox.wss.sheet.scrollYBy(Math.abs(gridUpperLeft.getY()-tmp.getY()+1),Jedox.wss.grid.ScrollDirection.DOWN)}},next:function(){this._iterate(Jedox.wss.grid.IterationMode.NEXT)},prev:function(){this._iterate(Jedox.wss.grid.IterationMode.PREV)},nextY:function(){this._iterate(Jedox.wss.grid.IterationMode.NEXTY)},prevY:function(){this._iterate(Jedox.wss.grid.IterationMode.PREVY)},toString:function(){var s="";s+="Mode: "+this._mode;s+=" Ranges: ";for(var i=0;i<this._ranges.length;i++){s+=this._ranges[i].toString()}return s},getFormula:function(makeAbs){var i=0,rngs=this._ranges,len=rngs.length,f="=";for(;i<len;f=f.concat(rngs[i++].getValue(makeAbs))){}return f},moveTo:function(x,y,mode){this._ranges[this._activeRange].moveTo(x,y);this.checkForUndoneMarkers()},expandIfActive:function(amount,direction){var status=this._ranges[this._activeRange].getStatus();if(status==Jedox.wss.range.AreaStatus.RESIZING){this.expand(amount,direction)}},expand:function(amount,direction){this._ranges[this._activeRange].expand(amount,direction)},set:function(startPoint,endPoint){if(this._isRect()){if(!this._scope.activeCellIsVisible()){}var range=this._ranges[this._activeRange],headerMarkMode=this._environment.shared.headerMarkMode,chkHiddenColRow=Jedox.wss.general.chkHiddenColRow;this._selectionChanged=true;startPoint.setX(chkHiddenColRow(false,startPoint.getX(),0,true));startPoint.setY(chkHiddenColRow(true,startPoint.getY(),0,true));endPoint.setX(chkHiddenColRow(false,endPoint.getX(),0,false));endPoint.setY(chkHiddenColRow(true,endPoint.getY(),0,false));range.set(startPoint,endPoint);if((startPoint.getX()>endPoint.getX())||(startPoint.getY()>endPoint.getY())){this._ranges[this._activeRange].toggleCoords()}var isSingleCell=this.isSingleCell(),defMaxCoords=Jedox.wss.grid.defMaxCoords,idclNS=Jedox.wss.app[Jedox.wss.app.menubar?"menubar":"toolbar"];if(!isSingleCell&&endPoint.getX()==defMaxCoords[0]&&endPoint.getY()==defMaxCoords[1]){range.setActiveCell(new Jedox.wss.cls.Point(this._book.getCoordsFirstVCell()[0],this._book.getCoordsFirstVCell()[1]));idclNS.insRow.disable();idclNS.insCol.disable();idclNS.delRow.disable();idclNS.delCol.disable()}else{if(!isSingleCell&&endPoint.getX()==defMaxCoords[0]){range.setActiveCell(new Jedox.wss.cls.Point(chkHiddenColRow(false,this._book.getCoordsFirstVCell()[0],0,true),startPoint.getY()));idclNS.insCol.disable();idclNS.delCol.disable()}else{if(!isSingleCell&&endPoint.getY()==defMaxCoords[1]){range.setActiveCell(new Jedox.wss.cls.Point(startPoint.getX(),chkHiddenColRow(true,this._book.getCoordsFirstVCell()[1],0,true)));idclNS.insRow.disable();idclNS.delRow.disable()}else{range.setActiveCell(startPoint);idclNS.insRow.enable();idclNS.insCol.enable();idclNS.delRow.enable();idclNS.delCol.enable()}}}if(!((headerMarkMode=="column"&&startPoint.getX()!=endPoint.getX())||(headerMarkMode=="row"&&startPoint.getY()!=endPoint.getY()))){this._setLegacyVars()}}},fillContent:function(amount,direction,mode){if(!this._isRect()){}},getActiveRange:function(){return this._ranges[this._activeRange]},getState:function(){return this._ranges[this._activeRange].getState()},getState:function(){return _state},moveCells:function(amount,direction,mode){if(!this._isRect()){}},removeAll:function(){for(var i=this._ranges.length-1;i>=0;this.removeRange(i--)){}this.lastParseRes=[]},addRange:function(startPoint,endPoint){return this._ranges.push(new Jedox.wss.grid.Range(this,startPoint,endPoint))},setActiveRange:function(rangeId){if(typeof rangeId=="object"){var idx=this._ranges.indexOf(rangeId);if(idx>=0){this._activeRange=idx}return}if((rangeId>=0)&&(rangeId<this._ranges.length)){this._activeRange=rangeId}else{throw new Error("Invalid range id: ",rangeId)}},registerForMouseMovement:function(element){if(this._activeRange in this._ranges){this._ranges[this._activeRange].registerForMouseMovement(element)}},setVisibility:function(visibility){for(var i=0;i<this._ranges.length;i++){this._scope.setActiveRange(i);this._ranges[this._activeRange].setVisibility(visibility)}},draw:function(){for(var i=0;i<this._ranges.length;i++){this._scope.setActiveRange(i);this._ranges[this._activeRange].draw()}},removeRange:function(id){if(this._ranges[id]){this._ranges[id].destruct();this._ranges.splice(id,1);return true}else{console.warn("invalid range id: ",id);return false}},_clearHeaderMarkers:function(clearAll,type){if((clearAll||type==Jedox.wss.grid.headerType.COLUMN)&&(this.dynarange||this._headerState.colActive||this._headerState.colSelected)){this._book.activateHdrAll(Jedox.wss.grid.headerType.COLUMN,"gridColHdr");this._headerState.colActive=false;this._headerState.colSelected=false}if((clearAll||type==Jedox.wss.grid.headerType.ROW)&&(this.dynarange||this._headerState.rowActive||this._headerState.rowSelected)){this._book.activateHdrAll(Jedox.wss.grid.headerType.ROW,"gridRowHdr");this._headerState.rowActive=false;this._headerState.rowSelected=false}},checkForUndoneMarkers:function(force){if(!this._selectionChanged&&!(force!=undefined&&force)){return}if(this.isSingleCell()){var dimensions=this.getActiveRange().getCorners(),mergeInfo=this._book.getMergeInfo(dimensions[0].getX(),dimensions[0].getY());if(mergeInfo!=undefined&&mergeInfo){this.drawMarkers([dimensions[0],new Jedox.wss.cls.Point(dimensions[0].getX()+mergeInfo[1]-1,dimensions[0].getY()+mergeInfo[2]-1)])}else{this._clearHeaderMarkers(true,null);this._book.activateHdr(Jedox.wss.grid.headerType.COLUMN,dimensions[0].getX(),"col_active");this._book.activateHdr(Jedox.wss.grid.headerType.ROW,dimensions[0].getY(),"row_active")}}else{if(this.dynarange){this._clearHeaderMarkers(true,null)}this.drawMarkers()}this._selectionChanged=false},drawMarkers:function(rng){var dimensions=(rng!=undefined)?rng:this.getActiveRange().getCorners();if(dimensions[0].getX()==1&&dimensions[1].getX()==Jedox.wss.grid.defMaxCoords[0]){this._book.activateHdrAll(Jedox.wss.grid.headerType.COLUMN,"gridColHdr "+((this._environment.shared.headerStyle==1)?"col_selected":"col_active"));this._headerState.colActive=true}else{this._book.activateHdrRng(Jedox.wss.grid.headerType.COLUMN,[dimensions[0].getX(),dimensions[1].getX()],(!this.dynarange&&(this._environment.shared.headerStyle==1||this._environment.shared.headerStyle==3||(dimensions[0].getY()==1&&dimensions[1].getY()==Jedox.wss.grid.defMaxCoords[1])))?"col_selected":"col_active")}if(dimensions[0].getY()==1&&dimensions[1].getY()==Jedox.wss.grid.defMaxCoords[1]){this._book.activateHdrAll(Jedox.wss.grid.headerType.ROW,"gridRowHdr "+((this._environment.shared.headerStyle==1)?"row_selected":"row_active"));this._headerState.rowActive=true}else{this._book.activateHdrRng(Jedox.wss.grid.headerType.ROW,[dimensions[0].getY(),dimensions[1].getY()],(!this.dynarange&&(this._environment.shared.headerStyle==1||this._environment.shared.headerStyle==2||(dimensions[0].getX()==1&&dimensions[1].getX()==Jedox.wss.grid.defMaxCoords[0])))?"row_selected":"row_active")}},updateRangeSelector:function(){if((this._environment.shared.lastRangeStartCoord[0]==this._environment.shared.lastRangeEndCoord[0])&&(this._environment.shared.lastRangeStartCoord[1]==this._environment.shared.lastRangeEndCoord[1])){Jedox.wss.app.currCoord.value=Jedox.wss.app.numberToLetter[this._environment.shared.selectedCellCoords[0]]+this._environment.shared.selectedCellCoords[1]}else{Jedox.wss.app.currCoord.value=((this._environment.shared.lastRangeEndCoord[1]-this._environment.shared.lastRangeStartCoord[1])+1)+"R x "+((this._environment.shared.lastRangeEndCoord[0]-this._environment.shared.lastRangeStartCoord[0])+1)+"C"}},emptyCellContent:function(){var rngClearType=Jedox.wss.range.ContentType,rng;this._environment.shared.inputField.value="";this._environment.shared.selectedCellValue="";Jedox.wss.app.currFormula.value="";this._environment.shared.cursorField.innerHTML="";if(this.isSingleCell()){this._clearHeaderMarkers(true,null);var selCoords=this._environment.shared.selectedCellCoords;this._book.activateHdr(Jedox.wss.grid.headerType.COLUMN,selCoords[0],"col_active");this._book.activateHdr(Jedox.wss.grid.headerType.ROW,selCoords[1],"row_active");rng=[selCoords[0],selCoords[1],selCoords[0],selCoords[1]]}else{var rngCorners=this.getActiveRange().getCorners();rng=[rngCorners[0].getX(),rngCorners[0].getY(),rngCorners[1].getX(),rngCorners[1].getY()]}this._book.clrRange(rng,rngClearType.FORMULA|rngClearType.ATTRS)},selectOrResize:function(myEvent){var myElement,elemData,col,row;var env=this._environment.shared;var XOffset=5;var YOffset=5;if(document.all){myEvent=window.event}var isRightClick=myEvent.button==2||(Ext.isMac&&myEvent.button==0&&Jedox.wss.app.ctrlKeyPressed);if(isRightClick){var defMaxCoords=Jedox.wss.grid.defMaxCoords,rngCorners=this.getActiveRange().getCorners();if((rngCorners[0].getX()==1&&rngCorners[1].getX()==defMaxCoords[0]&&rngCorners[0].getY()!=rngCorners[1].getY())||(rngCorners[0].getY()==1&&rngCorners[1].getY()==defMaxCoords[1]&&rngCorners[0].getX()!=rngCorners[1].getX())){Jedox.wss.mouse.showMainCntxMenu(myEvent);return}}if(myEvent.detail==2){return}myElement=(document.all)?myEvent.srcElement:myEvent.target;col=(myElement.parentNode.className=="gridColHdrsIC")?this._book.getCoordByHdr(Jedox.wss.grid.headerType.COLUMN,myElement):0;row=(myElement.parentNode.className=="gridRowHdrsIC")?this._book.getCoordByHdr(Jedox.wss.grid.headerType.ROW,myElement):0;if(Jedox.wss.app.mouseButton1Down){Jedox.wss.mouse.fetchGlobalMouseMove(myEvent)}else{if(env.mousePosition=="colResize"&&!isRightClick){var targetOffsetX=(document.all)?myEvent.offsetX:myEvent.layerX;if(targetOffsetX<=XOffset){myElement=this._book.getHdrByCoord(Jedox.wss.grid.headerType.COLUMN,--col)}Jedox.wss.mouse.startHeaderResize(Jedox.wss.grid.headerType.COLUMN,myElement,col,myEvent.clientX)}else{if(env.mousePosition=="rowResize"&&!isRightClick){var targetOffsetY=(document.all)?myEvent.offsetY:myEvent.layerY;if(targetOffsetY<=YOffset){myElement=this._book.getHdrByCoord(Jedox.wss.grid.headerType.ROW,--row)}Jedox.wss.mouse.startHeaderResize(Jedox.wss.grid.headerType.ROW,myElement,row,myEvent.clientY)}else{Jedox.wss.mouse.showCursorLayer((env.mousePosition=="rowMark")?"marker_multirow_select":"marker_multicol_select");Jedox.wss.mouse.calcGridScreenCoords(myEvent,myElement);if(env.mousePosition=="rowMark"||(env.mousePosition=="rowResize"&&isRightClick)){var visCell=this._book.getCoordsFirstVCell();var visRange=this._book.getVisibleRange(Jedox.wss.grid.headerType.ROW);++visRange[1];var visRangeDim=new Object();visRangeDim[visRange[0]-1]=env.gridScreenCoords[0][1];for(var i=visRange[0];i<=visRange[1];++i){visRangeDim[i]=visRangeDim[i-1]+this._book.getCellDims(visCell[0],i)[1]}env.headerSelected={coordBegin:row,coordEnd:row,screenBegin:visRangeDim[row-1],screenEnd:visRangeDim[row],coordCurr:row,coordInit:row,visRange:visRange,visOposRangeBegin:visCell[0],visRangeDim:visRangeDim};env.headerMarkMode="row";env.headerStyle=env.lastMarkMode=2;this._clearHeaderMarkers(false,Jedox.wss.grid.headerType.ROW);this.set(new Jedox.wss.cls.Point(Jedox.wss.app.firstRowNumeric,row),new Jedox.wss.cls.Point(Jedox.wss.grid.defMaxCoords[0],row));this.draw();this.getActiveRange().reposBgndMask(false)}else{if(env.mousePosition=="colMark"||(env.mousePosition=="colResize"&&isRightClick)){var visCell=this._book.getCoordsFirstVCell();var visRange=this._book.getVisibleRange(Jedox.wss.grid.headerType.COLUMN);++visRange[1];var visRangeDim=new Object();visRangeDim[visRange[0]-1]=env.gridScreenCoords[0][0];for(var i=visRange[0];i<=visRange[1];++i){visRangeDim[i]=visRangeDim[i-1]+this._book.getCellDims(i,visCell[1])[0]}env.headerSelected={coordBegin:col,coordEnd:col,screenBegin:visRangeDim[col-1],screenEnd:visRangeDim[col],coordCurr:col,coordInit:col,visRange:visRange,visOposRangeBegin:visCell[1],visRangeDim:visRangeDim};env.headerMarkMode="column";env.headerStyle=env.lastMarkMode=3;this._clearHeaderMarkers(false,Jedox.wss.grid.headerType.COLUMN);this.set(new Jedox.wss.cls.Point(col,Jedox.wss.app.firstColumn),new Jedox.wss.cls.Point(col,Jedox.wss.grid.defMaxCoords[1]));this.draw();this.getActiveRange().reposBgndMask(false)}}}}}if(isRightClick){Jedox.wss.mouse.showMainCntxMenu(myEvent)}},_refreshElement:function(scope,range){range.draw()},_hdrMarkOnScroll:function(book,type,direction,firstVisCoord,lastVisCoord,scrollTimeout){var scope=this;var env=Jedox.wss.app.environment;var headerSelected=env.headerSelected;var scrollType=Jedox.wss.grid.scrollType;var scrollDir=Jedox.wss.grid.ScrollDirection;var defMaxCoords=Jedox.wss.grid.defMaxCoords;var selection=env.defaultSelection;var range=selection.getActiveRange();var rangeCoords=range.getCorners();var _hdrResizeLeft=function(){var nmcDelta=Math.abs(headerSelected.coordCurr-firstVisCoord-((firstVisCoord==1)?0:1));headerSelected.coordCurr-=nmcDelta;headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr];if(headerSelected.coordCurr>rangeCoords[0].getX()){selection.expand(nmcDelta*-1,scrollDir.RIGHT);headerSelected.coordEnd=headerSelected.coordCurr}else{selection.expand(nmcDelta,scrollDir.LEFT);headerSelected.coordBegin=headerSelected.coordCurr;headerSelected.coordEnd=headerSelected.coordInit}scope._refreshElement(scope,range)};var _hdrResizeRight=function(){var nmcDelta=Math.abs(lastVisCoord-headerSelected.coordCurr-((lastVisCoord==defMaxCoords[0])?0:1));headerSelected.coordCurr+=nmcDelta;headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr];if(headerSelected.coordCurr<rangeCoords[1].getX()){selection.expand(nmcDelta*-1,scrollDir.LEFT);headerSelected.coordBegin=headerSelected.coordCurr}else{selection.expand(nmcDelta,scrollDir.RIGHT);headerSelected.coordEnd=headerSelected.coordCurr;headerSelected.coordBegin=headerSelected.coordInit}scope._refreshElement(scope,range)};var _hdrResizeDown=function(){var nmcDelta=Math.abs(lastVisCoord-headerSelected.coordCurr-((lastVisCoord==defMaxCoords[1])?0:1));headerSelected.coordCurr+=nmcDelta;headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr];if(headerSelected.coordCurr<rangeCoords[1].getY()){selection.expand(nmcDelta*-1,scrollDir.UP);headerSelected.coordBegin=headerSelected.coordCurr}else{selection.expand(nmcDelta,scrollDir.DOWN);headerSelected.coordEnd=headerSelected.coordCurr;headerSelected.coordBegin=headerSelected.coordInit}scope._refreshElement(scope,range)};var _hdrResizeUp=function(){var nmcDelta=Math.abs(headerSelected.coordCurr-firstVisCoord-((firstVisCoord==1)?0:1));headerSelected.coordCurr-=nmcDelta;headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr];if(headerSelected.coordCurr>rangeCoords[0].getY()){selection.expand(nmcDelta*-1,scrollDir.DOWN);headerSelected.coordEnd=headerSelected.coordCurr}else{selection.expand(nmcDelta,scrollDir.UP);headerSelected.coordBegin=headerSelected.coordCurr;headerSelected.coordEnd=headerSelected.coordInit}scope._refreshElement(scope,range)};var _incVisRange=function(book,dim){if(dim==0){var delItemDim=book.getCellDims(headerSelected.visRange[0],headerSelected.visOposRangeBegin)[dim]}else{var delItemDim=book.getCellDims(headerSelected.visOposRangeBegin,headerSelected.visRange[0])[dim]}for(var i=headerSelected.visRange[0]+1;i<=headerSelected.visRange[1];++i){headerSelected.visRangeDim[i]-=delItemDim}delete headerSelected.visRangeDim[headerSelected.visRange[0]];++headerSelected.visRange[0];++headerSelected.visRange[1];headerSelected.visRangeDim[headerSelected.visRange[1]]=headerSelected.visRangeDim[headerSelected.visRange[1]-1]+book.getCellDims(headerSelected.visRange[1],headerSelected.visOposRangeBegin)[dim]};var _decVisRange=function(book,dim){if(dim==0){var insItemDim=book.getCellDims(headerSelected.visRange[0]-1,headerSelected.visOposRangeBegin)[dim]}else{var insItemDim=book.getCellDims(headerSelected.visOposRangeBegin,headerSelected.visRange[0]-1)[dim]}for(var i=headerSelected.visRange[0];i<headerSelected.visRange[1];++i){headerSelected.visRangeDim[i]+=insItemDim}delete headerSelected.visRangeDim[headerSelected.visRange[1]];--headerSelected.visRange[0];--headerSelected.visRange[1];headerSelected.visRangeDim[headerSelected.visRange[0]]=env.gridScreenCoords[0][dim]+insItemDim};if(type==scrollType.HORIZ){if(direction==Jedox.wss.grid.horScrollDir.RIGHT){_incVisRange(book,0);if(headerSelected.coordCurr<lastVisCoord-1){_hdrResizeRight()}if(lastVisCoord==defMaxCoords[0]){env.autoScroll.scrollElem=setTimeout(_hdrResizeRight,scrollTimeout)}}else{_decVisRange(book,0);if(headerSelected.coordCurr>firstVisCoord+1){_hdrResizeLeft()}if(firstVisCoord==1){env.autoScroll.scrollElem=setTimeout(_hdrResizeLeft,scrollTimeout)}}}else{if(direction==Jedox.wss.grid.vertScrollDir.DOWN){_incVisRange(book,1);if(headerSelected.coordCurr<lastVisCoord-1){_hdrResizeDown()}if(lastVisCoord==defMaxCoords[1]){env.autoScroll.scrollElem=setTimeout(_hdrResizeDown,scrollTimeout)}}else{_decVisRange(book,1);if(headerSelected.coordCurr>firstVisCoord+1){_hdrResizeUp()}if(firstVisCoord==1){env.autoScroll.scrollElem=setTimeout(_hdrResizeUp,scrollTimeout)}}}},resizeByHeader:function(ev){var env=this._environment.shared;var gridScreenCoords=env.gridScreenCoords;var headerSelected=env.headerSelected;var grid=Jedox.wss.grid;var selection=this;var activeBook=this._book;var range=this.getActiveRange();function incCoord(pos,maxPos){do{if(headerSelected.coordCurr<maxPos){++headerSelected.coordCurr}else{return}}while(pos>headerSelected.visRangeDim[headerSelected.coordCurr]);if(headerSelected.coordCurr>headerSelected.coordEnd){headerSelected.coordEnd=headerSelected.coordCurr;headerSelected.coordBegin=headerSelected.coordInit}else{headerSelected.coordBegin=headerSelected.coordCurr}headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr]}function decCoord(pos){do{if(headerSelected.coordCurr>1){--headerSelected.coordCurr}else{return}}while(pos<headerSelected.visRangeDim[headerSelected.coordCurr-1]);if(headerSelected.coordCurr<headerSelected.coordBegin){headerSelected.coordBegin=headerSelected.coordCurr;headerSelected.coordEnd=headerSelected.coordInit}else{headerSelected.coordEnd=headerSelected.coordCurr}headerSelected.screenBegin=headerSelected.visRangeDim[headerSelected.coordCurr-1];headerSelected.screenEnd=headerSelected.visRangeDim[headerSelected.coordCurr]}if(env.headerMarkMode=="column"){env.autoScroll.checkAndScroll(ev,this._hdrMarkOnScroll,grid.scrollType.HORIZ,null,this);if(Jedox.wss.app.xPos<headerSelected.screenBegin&&Jedox.wss.app.xPos>gridScreenCoords[0][0]){decCoord(Jedox.wss.app.xPos)}else{if(Jedox.wss.app.xPos>headerSelected.screenEnd&&Jedox.wss.app.xPos<gridScreenCoords[1][0]){incCoord(Jedox.wss.app.xPos,grid.defMaxCoords[0])}else{return}}this.set(new Jedox.wss.cls.Point(headerSelected.coordBegin,Jedox.wss.app.firstColumn),new Jedox.wss.cls.Point(headerSelected.coordEnd,grid.defMaxCoords[1]));range.setActiveCell(new Jedox.wss.cls.Point(headerSelected.coordInit,range.getActiveCell().getY()));this.draw();this.updateRangeSelector();env.headerStyle=3;return}else{if(env.headerMarkMode=="row"){env.autoScroll.checkAndScroll(ev,this._hdrMarkOnScroll,grid.scrollType.VERT,null,this);if(Jedox.wss.app.yPos<headerSelected.screenBegin&&Jedox.wss.app.yPos>gridScreenCoords[0][1]){decCoord(Jedox.wss.app.yPos)}else{if(Jedox.wss.app.yPos>headerSelected.screenEnd&&Jedox.wss.app.yPos<gridScreenCoords[1][1]){incCoord(Jedox.wss.app.yPos,grid.defMaxCoords[1])}else{return}}this.set(new Jedox.wss.cls.Point(Jedox.wss.app.firstRowNumeric,headerSelected.coordBegin),new Jedox.wss.cls.Point(grid.defMaxCoords[0],headerSelected.coordEnd));range.setActiveCell(new Jedox.wss.cls.Point(range.getActiveCell().getX(),headerSelected.coordInit));this.draw();this.updateRangeSelector();env.headerStyle=2}}},getSelHeaderFromRange:function(type,resizedHdr){var headerType=Jedox.wss.grid.headerType;var defRngCoords=this.getActiveRange().getCorners();if(type==headerType.COLUMN&&defRngCoords[0].getY()==1&&defRngCoords[1].getY()==Jedox.wss.grid.defMaxCoords[1]&&resizedHdr>=defRngCoords[0].getX()&&resizedHdr<=defRngCoords[1].getX()){return[[defRngCoords[0].getX(),defRngCoords[1].getX()]]}else{if(type==headerType.ROW&&defRngCoords[0].getX()==1&&defRngCoords[1].getX()==Jedox.wss.grid.defMaxCoords[0]&&resizedHdr>=defRngCoords[0].getY()&&resizedHdr<=defRngCoords[1].getY()){return[[defRngCoords[0].getY(),defRngCoords[1].getY()]]}else{return[[resizedHdr,resizedHdr]]}}},markAllCells:function(){if(this._environment.shared.inputMode==Jedox.wss.grid.GridMode.READY){var defMaxCoords=Jedox.wss.grid.defMaxCoords;this._environment.shared.headerMarkMode="all";this._environment.shared.lastMarkMode=1;this._environment.shared.headerStyle=1;this.set(new Jedox.wss.cls.Point(1,1),new Jedox.wss.cls.Point(defMaxCoords[0],defMaxCoords[1]));this.draw()}},_positionRng:function(x,y){var that=this,cbScrollTo=function(){that.set(new Jedox.wss.cls.Point(x,y),new Jedox.wss.cls.Point(x,y));that.draw()};if(this._book._scrollOpPending){return}this._book.scrollTo([this,cbScrollTo],x,y,false,false)},selectFirstCell:function(){this._positionRng(1,1)},selectFirstVisCell:function(){var fvcCoords=this._book.getCoordsFirstVCell();this._positionRng(fvcCoords[0],fvcCoords[1])},_copyAndCutImpl:function(op,copyToClp){var env=this._environment.shared,startCoords=env.lastRangeStartCoord,endCoords=env.lastRangeEndCoord,endCoordsCopy=[endCoords[0],endCoords[1]],startPnt=new Jedox.wss.cls.Point(startCoords[0],startCoords[1]),endPnt=new Jedox.wss.cls.Point(endCoords[0],endCoords[1]),copySel=Jedox.wss.app.copySelection;if(copySel!=null){copySel.removeAll()}copySel=env.copySelection;copySel.addRange(startPnt);copySel.setActiveRange(copySel.getRanges().length-1);copySel.setState(Jedox.wss.range.AreaState.NEW);copySel.set(startPnt,endPnt);copySel.draw();Jedox.wss.app.copySelection=copySel;if(startPnt.equals(endPnt)){var mergeInfoStart=this._book.getMergeInfo(startPnt.getX(),startPnt.getY());if(mergeInfoStart){endCoordsCopy=[startPnt.getX()+mergeInfoStart[1]-1,startPnt.getY()+mergeInfoStart[2]-1]}}Jedox.wss.app.clipboard={id:Jedox.wss.backend.conn.cmd(0,[op==Jedox.wss.grid.gridOperation.COPY?"cprn":"ctrn"],[[startCoords[0],startCoords[1],endCoordsCopy[0],endCoordsCopy[1]]])[0][1][0],op:op,value:null};if(copyToClp){var clpVal="",isFirst=true;for(var i=startCoords[1];i<=endCoords[1];i++,isFirst=true,clpVal=clpVal.concat("\r\n")){for(var j=startCoords[0];j<=endCoords[0];j++){cellVal=this._book.getCellValue(j,i);if(isFirst){isFirst=false}else{clpVal=clpVal.concat("\t")}clpVal=clpVal.concat((cellVal==undefined)?"":cellVal)}}Jedox.wss.general.setSysClipboard(clpVal)}},copy:function(copyToClp){this._copyAndCutImpl(Jedox.wss.grid.gridOperation.COPY,copyToClp)},cut:function(copyToClp){this._copyAndCutImpl(Jedox.wss.grid.gridOperation.CUT,copyToClp)},paste:function(pasteWhat){var clipboard=Jedox.wss.app.clipboard;if(clipboard==null){var clpVal=Jedox.wss.general.getSysClipboard();if(clpVal==null){return}var rows=clpVal.split("\n"),maxRowLen=0;for(var i=rows.length-1;i>=0;i--){rows[i]=rows[i].split("\t");maxRowLen=rows[i].length}if(rows[rows.length-1]==""){rows.splice(rows.length-1,1)}for(var i=rows.length-1;i>=0;i--){for(var j=0,cnt=maxRowLen-rows[i].length;j<cnt;j++){rows[i].push("")}}clipboard={id:null,op:Jedox.wss.grid.gridOperation.CUT,value:rows,markRngDim:{width:maxRowLen,height:rows.length}}}var env=this._environment.shared,markRng,markRngDim;var startCoords=env.lastRangeStartCoord;var endCoords=env.lastRangeEndCoord;if(clipboard.id==null){markRngDim=(clipboard.markRngDim==undefined)?{width:1,height:1}:clipboard.markRngDim}else{markRng=Jedox.wss.app.copySelection;var markRngCoords=markRng.getActiveRange().getCorners();if(markRngCoords[0].equals(markRngCoords[1])){var mergeInfoStart=this._book.getMergeInfo(markRngCoords[0].getX(),markRngCoords[0].getY());if(mergeInfoStart){markRngCoords[1]=new Jedox.wss.cls.Point(markRngCoords[0].getX()+mergeInfoStart[1]-1,markRngCoords[0].getY()+mergeInfoStart[2]-1)}}markRngDim={width:markRngCoords[1].getX()-markRngCoords[0].getX()+1,height:markRngCoords[1].getY()-markRngCoords[0].getY()+1}}var defRngDim={width:endCoords[0]-startCoords[0]+1,height:endCoords[1]-startCoords[1]+1};if(clipboard.op==Jedox.wss.grid.gridOperation.CUT||(defRngDim.width<markRngDim.width||defRngDim.width%markRngDim.width!=0)||(defRngDim.height<markRngDim.height||defRngDim.height%markRngDim.height!=0)){this.set(new Jedox.wss.cls.Point(startCoords[0],startCoords[1]),new Jedox.wss.cls.Point(startCoords[0]+markRngDim.width-1,startCoords[1]+markRngDim.height-1));this.draw()}startCoords=env.lastRangeStartCoord;endCoords=env.lastRangeEndCoord;if(clipboard.id==null){if(clipboard.markRngDim==undefined){this._book.setCellValue(startCoords[0],startCoords[1],clipboard.value)}else{var vals=[];for(var len=clipboard.value.length-1,i=-1;i<len;vals=vals.concat(clipboard.value[++i])){}this._book.setRangeValue([startCoords[0],startCoords[1],endCoords[0],endCoords[1]],vals)}}else{this._book.pasteRange([this,this.draw],[startCoords[0],startCoords[1],endCoords[0],endCoords[1]],clipboard.id,pasteWhat)}var cursorValue=this._book.getCellValue(startCoords[0],startCoords[1]);env.cursorField.innerHTML=(cursorValue==undefined)?"":cursorValue;Jedox.wss.style.cellTransfer(env.cursorField);if(clipboard.id!=null&&clipboard.op==Jedox.wss.grid.gridOperation.CUT){markRng.removeAll();Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)}},hide:function(){for(var i=this._ranges.length-1;i>=0;i--){this._ranges[i].hide()}},show:function(){for(var i=this._ranges.length-1;i>=0;i--){this._ranges[i].show()}},setCursor:function(el,cur){this._ranges[this._activeRange].setCursor(el,cur)},getBook:function(){return this._book},getContainer:function(){return this._container},getEnvironment:function(){return this._environment},getDomId:function(){return this._book.getDomId()}};Jedox.wss.grid.DefaultSelection=(function(){return function(startCoords,book){Jedox.wss.grid.DefaultSelection.parent.constructor.call(this,startCoords,book);this._ranges=[new Jedox.wss.grid.DefaultRange(this,this._startCoords,this._startCoords)];this._firstRange=this._ranges[0];this._activeRange=0;this._ranges[this._activeRange].activate();this._setLegacyVars()}})();Jedox.util.extend(Jedox.wss.grid.DefaultSelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.DefaultSelection;clsRef.prototype._isRect=function(){return(this._ranges.length===1)};clsRef.prototype.addRange=function(startPoint,endPoint){return this._ranges.push(new Jedox.wss.grid.DefaultRange(this,startPoint,endPoint))};clsRef.prototype.expandToCell=function(cell){this._selectionChanged=true;this._ranges[this._activeRange].expandToCell(cell)};clsRef.prototype.moveTo=function(x,y,mode){this._selectionChanged=true;this._ranges[this._activeRange].moveTo(x,y);this.checkForUndoneMarkers()};clsRef.prototype.expand=function(amount,direction,defExpand){this._selectionChanged=true;this._ranges[this._activeRange].expand(amount,direction,defExpand)};clsRef.prototype.show=function(){for(var i=this._ranges.length-1;i>=0;i--){if(this._ranges[i].isVisible()){return}this._ranges[i].show()}this._selectionChanged=true;this.checkForUndoneMarkers()};clsRef.prototype.jumpTo=function(rng){this.set(new Jedox.wss.cls.Point(rng[0],rng[1]),new Jedox.wss.cls.Point(rng[2],rng[3]));this.draw()};clsRef=null;Jedox.wss.grid.FormulaSelection=(function(){return function(startCoords,book){Jedox.wss.grid.FormulaSelection.parent.constructor.call(this,startCoords,book);this.setVisibility(Jedox.wss.range.DisplayStatus.HIDDEN)}})();Jedox.util.extend(Jedox.wss.grid.FormulaSelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.FormulaSelection;clsRef.prototype.addRange=function(startPoint,endPoint,isPassive){return this._ranges.push(new Jedox.wss.grid.FormulaRange(this,startPoint,endPoint,isPassive))};clsRef.prototype.moveTo=function(x,y,mode){this._ranges[this._activeRange].moveTo(x,y);this.checkForUndoneMarkers()};clsRef.prototype.expand=function(amount,direction){this._ranges[this._activeRange].expand(amount,direction)};clsRef.prototype._refreshElement=function(scope,range){range.formulaUpdate();range.draw()};clsRef=null;Jedox.wss.grid.CopySelection=(function(){return function(startCoords,book){Jedox.wss.grid.CopySelection.parent.constructor.call(this,startCoords,book);this.setVisibility(Jedox.wss.range.DisplayStatus.HIDDEN)}})();Jedox.util.extend(Jedox.wss.grid.CopySelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.CopySelection;clsRef.prototype._isRect=function(){return(this._ranges.length===1)};clsRef.prototype.addRange=function(startPoint,endPoint){return this._ranges.push(new Jedox.wss.grid.CopyRange(this,startPoint,endPoint))};clsRef=null;Jedox.wss.grid.DynarangeSelection=(function(){return function(book,props){var startCoords=new Jedox.wss.cls.Point(props.src[0],props.src[1]);Jedox.wss.grid.DynarangeSelection.parent.constructor.call(this,startCoords,book);this.dynarange=true;this._endCoords=new Jedox.wss.cls.Point(props.src[2],props.src[3]);this._ranges=[new Jedox.wss.grid.DynarangeRange(this,this._startCoords,this._endCoords,props)];this._firstRange=this._ranges[0];this._activeRange=0}})();Jedox.util.extend(Jedox.wss.grid.DynarangeSelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.DynarangeSelection;clsRef.prototype._isRect=function(){return(this._ranges.length===1)};clsRef.prototype.setMode=function(mode){this._mode=mode;if(this._mode==Jedox.wss.range.RangeMode.EDIT){Jedox.wss.hb.setAllNormal(this.getActiveRange().getId());this._environment.shared.defaultSelection.hide();this._selectionChanged=true;this.checkForUndoneMarkers()}this.getActiveRange().switchMode(mode)};clsRef.prototype.getProps=function(){return this.getActiveRange().getProps()};clsRef.prototype.setProps=function(props){this.getActiveRange().setProps(props)};clsRef.prototype.hide=function(){this.setMode(Jedox.wss.range.RangeMode.HIDDEN)};clsRef.prototype.show=function(){this.setMode(Jedox.wss.range.RangeMode.NONE)};clsRef.prototype.redraw=function(){var actRng=this.getActiveRange();actRng.draw(false);actRng.setNormalMode()};clsRef.prototype.remove=function(perm){this.getActiveRange().remove(perm)};clsRef.prototype.move=function(pos){this.getActiveRange().move(pos)};clsRef=null;Jedox.wss.grid.DynarangeSubSelection=(function(){return function(startCoords,endCoords,book,parent,parentStartPoint,parentEndPoint){Jedox.wss.grid.DynarangeSubSelection.parent.constructor.call(this,startCoords,book);this._endCoords=endCoords;this._parent=parent;var that=this;this._ranges=[new Jedox.wss.grid.DynarangeSubRange(parent,that,startCoords,endCoords,parentStartPoint,parentEndPoint)];this._firstRange=this._ranges[0];this._activeRange=0}})();Jedox.util.extend(Jedox.wss.grid.DynarangeSubSelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.DynarangeSubSelection;clsRef.prototype._isRect=function(){return(this._ranges.length===1)};clsRef.prototype.setMode=function(mode){this._mode=mode;if(this._mode==Jedox.wss.range.RangeMode.EDIT){Jedox.wss.hb.setAllNormal(this.getActiveRange().getId())}this.getActiveRange().switchMode(mode)};clsRef.prototype.getProps=function(){return this.getActiveRange().getProps()};clsRef.prototype.setProps=function(props){this.getActiveRange().setProps(props)};clsRef.prototype.hide=function(){this.setMode(Jedox.wss.range.RangeMode.HIDDEN)};clsRef.prototype.show=function(){this.setMode(Jedox.wss.range.RangeMode.NONE)};clsRef.prototype.remove=function(){this.getActiveRange().remove()};clsRef=null;Jedox.wss.grid.FillSelection=(function(){return function(startCoords,book){Jedox.wss.grid.FillSelection.parent.constructor.call(this,startCoords,book);this._ranges=[new Jedox.wss.grid.FillRange(this,startCoords,startCoords)];this._firstRange=this._ranges[0];this._activeRange=0}})();Jedox.util.extend(Jedox.wss.grid.FillSelection,Jedox.wss.grid.Selection);clsRef=Jedox.wss.grid.FillSelection;clsRef=null;Jedox.wss.grid.Range=(function(){var _colors=["#0000FF","#008000","#9900CC","#800000","#00CC33","#FF6600","#CC0099"];var _curHotSpot;return function(selection,startPoint,endPoint){var _prot=this.prototype;this._selection=selection;this._startPoint=startPoint;this._endPoint=endPoint;this._upperLeft=startPoint.clone();this._lowerRight=endPoint!=undefined?endPoint.clone():startPoint.clone();this._lastActiveCell=startPoint.clone();this._scope=this;this._environment=(selection!==null)?selection.getEnvironment():null;this.formulaToken=null;this._edgeElems=[];this._cornerElems=[];this._ulCorner=new Jedox.wss.cls.Point(1,1);this._lrCorner=new Jedox.wss.cls.Point(1,1);this._status=Jedox.wss.range.AreaStatus.NORMAL;this._monitorCell={};this._monitorCellCoords=[];this._monitorCoords={};this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this._bgndMaskPos=[0,0];this._realCoords=this.getCorners();this._borderState=Jedox.wss.range.BorderState.UNKOWN;this._visibility=Jedox.wss.range.DisplayStatus.VISIBLE;this._container=selection.getContainer();this._scrollElem=false;this._doCC=false,_doPaste=false;this.getColors=function(){return _colors};this.getParent=function(){return selection};this._activeCell=this._anchorCell=new Jedox.wss.cls.Point(this._startPoint.getX(),this._startPoint.getY());this._offsets=[(this._startPoint.getX()-Jedox.wss.app.firstRowNumeric),(this._startPoint.getY()-Jedox.wss.app.firstColumn)];this._state=Jedox.wss.range.AreaState.NORMAL}})();Jedox.wss.grid.Range.prototype={_updateOffsets:function(){this._offsets=[(this._upperLeft.getX()-Jedox.wss.app.firstRowNumeric),(this._upperLeft.getY()-Jedox.wss.app.firstColumn)]},setToActiveCell:function(){this._scope.set(this._activeCell,this._activeCell);this._scope.draw()},getStartCoords:function(){return this._startCoords},setStartCoords:function(){this._startCoords=[this._upperLeft.clone(),this._lowerRight.clone()]},afterExpanding:function(){if(!((this._upperLeft.equals(this._startCoords[0]))&&(this._lowerRight.equals(this._startCoords[1])))){Jedox.wss.backend.ha.CopyFill(this._startCoords[0].getX(),this._startCoords[0].getY(),this._startCoords[1].getX(),this._startCoords[1].getY(),this._lowerRight.getX(),this._lowerRight.getY(),this._upperLeft.getX(),this._upperLeft.getY(),0)}},toggleCoords:function(){this.toggleCorners(this._upperLeft,this._lowerRight)},toggleCorners:function(ul,lr){var tmp;if(ul.getX()>lr.getX()){tmp=ul.getX();ul.setX(lr.getX());lr.setX(tmp)}if(ul.getY()>lr.getY()){tmp=ul.getY();ul.setY(lr.getY());lr.setY(tmp)}},getValue:function(makeAbs){var ntl=Jedox.wss.app.numberToLetter,ul=this._upperLeft,lr=this._lowerRight,pfx=makeAbs?"$":"";return pfx.concat(ntl[ul.getX()],pfx,ul.getY(),ul.equals(lr)?"":":".concat(pfx,ntl[lr.getX()],pfx,lr.getY()))},getCoords:function(){return[this._upperLeft.getX(),this._upperLeft.getY(),this._lowerRight.getX(),this._lowerRight.getY()]},getLastActiveCell:function(){return this._lastActiveCell},expandToCell:function(cell,setLastActiveCell){var diff=new Jedox.wss.cls.Point((cell.getX()-this._lastActiveCell.getX()),(cell.getY()-this._lastActiveCell.getY()));if(diff.getX()>0){var direction=Jedox.wss.grid.ScrollDirection.RIGHT;this._selection.expand(diff.getX(),direction)}else{if(diff.getX()<0){var direction=Jedox.wss.grid.ScrollDirection.LEFT;this._selection.expand(Math.abs(diff.getX()),direction)}}if(diff.getY()>0){var direction=Jedox.wss.grid.ScrollDirection.DOWN;this._selection.expand(diff.getY(),direction)}else{if(diff.getY()<0){var direction=Jedox.wss.grid.ScrollDirection.UP;this._selection.expand(Math.abs(diff.getY()),direction)}}this._selection.draw();this.reposBgndMask(true);if(setLastActiveCell){this._lastActiveCell=cell.clone()}},getCursorField:function(){return this._cursorField.getCursorField()},setActiveCell:function(cell){this._activeCell=cell.clone()},setRefActiveCell:function(cell){this._refActiveCell=cell.clone()},getRefActiveCell:function(){return this._refActiveCell},getCorners:function(){return[this._upperLeft,this._lowerRight]},getActiveCell:function(){return this._activeCell},getState:function(){return this._state},getOffsets:function(){return this._offsets},getUpperLeft:function(){return this._upperLeft},getLowerRight:function(){return this._lowerRight},activate:function(){},deactivate:function(){},set:function(startPoint,endPoint){this._upperLeft=new Jedox.wss.cls.Point(parseInt(startPoint.getX(),10),parseInt(startPoint.getY(),10));this._lowerRight=new Jedox.wss.cls.Point(parseInt(endPoint.getX(),10),parseInt(endPoint.getY(),10));this._lastActiveCell=new Jedox.wss.cls.Point(parseInt(endPoint.getX(),10),parseInt(endPoint.getY(),10));this.setActiveCell(startPoint.clone())},moveTo:function(x,y){x=parseInt(x,10);y=parseInt(y,10);if(x<1||y<1){return}var width=this._lowerRight.getX()-this._upperLeft.getX();var height=this._lowerRight.getY()-this._upperLeft.getY();this._upperLeft.setX(x);this._upperLeft.setY(y);this._lowerRight.setX(x+width);this._lowerRight.setY(y+height);this._environment.shared.lastRangeStartCoord=[this._upperLeft.getX(),this._upperLeft.getY()];this._environment.shared.lastRangeEndCoord=[this._lowerRight.getX(),this._lowerRight.getY()];this._updateOffsets()},setLowerRight:function(point){this._lowerRight=point},setUpperLeft:function(point){this._upperLeft=point},isFirst:function(){return(this._upperLeft.equals(this._activeCell))},isLast:function(){return(this._lowerRight.equals(this._activeCell))},next:function(){var activeBook=Jedox.wss.app.activeBook,actCell=this._activeCell;if(actCell.equalsX(this._lowerRight)){if(actCell.equalsY(this._lowerRight)){actCell.setX(this._upperLeft.getX());actCell.setY(this._upperLeft.getY())}else{actCell.setX(this._upperLeft.getX());actCell.setY(Jedox.wss.general.chkHiddenColRow(true,actCell.getY(),1,true))}}else{actCell.setX(Jedox.wss.general.chkHiddenColRow(false,actCell.getX(),1,true))}var mrgInfoT=activeBook.getMergeInfo(actCell.getX(),actCell.getY());if(mrgInfoT){if(mrgInfoT[0]){if(actCell.getX()<this._upperLeft.getX()||actCell.getY()<this._upperLeft.getY()||actCell.getX()+(mrgInfoT[1]-1)>this._lowerRight.getX()||actCell.getY()+(mrgInfoT[2]-1)>this._lowerRight.getY()){var newX=actCell.getX()+(mrgInfoT[1]-1);actCell.setX(newX>this._lowerRight.getX()?this._lowerRight.getX():newX);this.next()}}else{var mrgInfoTM=activeBook.getMergeInfo(mrgInfoT[1],mrgInfoT[2]),newX=mrgInfoT[1]+(mrgInfoTM[1]-1);actCell.setX(newX>this._lowerRight.getX()?this._lowerRight.getX():newX);this.next()}}},prev:function(){var activeBook=Jedox.wss.app.activeBook,actCell=this._activeCell;if(actCell.equalsX(this._upperLeft)){if(actCell.equalsY(this._upperLeft)){actCell.setX(this._lowerRight.getX());actCell.setY(this._lowerRight.getY())}else{actCell.setX(this._lowerRight.getX());actCell.setY(Jedox.wss.general.chkHiddenColRow(true,actCell.getY(),1,false))}}else{actCell.setX(Jedox.wss.general.chkHiddenColRow(false,actCell.getX(),1,false))}var mrgInfoT=activeBook.getMergeInfo(actCell.getX(),actCell.getY());if(mrgInfoT){if(mrgInfoT[0]){if(actCell.getX()<this._upperLeft.getX()||actCell.getY()<this._upperLeft.getY()||actCell.getX()+(mrgInfoT[1]-1)>this._lowerRight.getX()||actCell.getY()+(mrgInfoT[2]-1)>this._lowerRight.getY()){var newX=actCell.getX()-(mrgInfoT[1]-1);actCell.setX(newX<this._upperLeft.getX()?this._upperLeft.getX():newX);this.prev()}}else{var mrgInfoTM=activeBook.getMergeInfo(mrgInfoT[1],mrgInfoT[2]),newX=actCell.getX()-(mrgInfoTM[1]-1);actCell.setX(newX<this._upperLeft.getX()?this._upperLeft.getX():newX);if(!(actCell.getX()==mrgInfoT[1]&&actCell.getY()==mrgInfoT[2]&&mrgInfoT[1]+(mrgInfoTM[1]-1)<=this._lowerRight.getX()&&mrgInfoT[2]+(mrgInfoTM[2]-1)<=this._lowerRight.getY())){this.prev()}}}},nextY:function(){var activeBook=Jedox.wss.app.activeBook,actCell=this._activeCell;if(actCell.equalsY(this._lowerRight)){if(actCell.equalsX(this._lowerRight)){actCell.setX(this._upperLeft.getX());actCell.setY(this._upperLeft.getY())}else{actCell.setY(this._upperLeft.getY());actCell.setX(Jedox.wss.general.chkHiddenColRow(false,actCell.getX(),1,true))}}else{actCell.setY(Jedox.wss.general.chkHiddenColRow(true,actCell.getY(),1,true))}var mrgInfoT=activeBook.getMergeInfo(actCell.getX(),actCell.getY());if(mrgInfoT){if(mrgInfoT[0]){if(actCell.getX()<this._upperLeft.getX()||actCell.getY()<this._upperLeft.getY()||actCell.getX()+(mrgInfoT[1]-1)>this._lowerRight.getX()||actCell.getY()+(mrgInfoT[2]-1)>this._lowerRight.getY()){var newY=actCell.getY()+(mrgInfoT[2]-1);actCell.setY(newY>this._lowerRight.getY()?this._lowerRight.getY():newY);this.nextY()}}else{var mrgInfoTM=activeBook.getMergeInfo(mrgInfoT[1],mrgInfoT[2]),newY=mrgInfoT[2]+(mrgInfoTM[2]-1);actCell.setY(newY>this._lowerRight.getY()?this._lowerRight.getY():newY);this.nextY()}}},prevY:function(){var activeBook=Jedox.wss.app.activeBook,actCell=this._activeCell;if(actCell.equalsY(this._upperLeft)){if(actCell.equalsX(this._upperLeft)){actCell.setX(this._lowerRight.getX());actCell.setY(this._lowerRight.getY())}else{actCell.setX(Jedox.wss.general.chkHiddenColRow(false,actCell.getX(),1,false));actCell.setY(this._lowerRight.getY())}}else{actCell.setY(Jedox.wss.general.chkHiddenColRow(true,actCell.getY(),1,false))}var mrgInfoT=activeBook.getMergeInfo(actCell.getX(),actCell.getY());if(mrgInfoT){if(mrgInfoT[0]){if(actCell.getX()<this._upperLeft.getX()||actCell.getY()<this._upperLeft.getY()||actCell.getX()+(mrgInfoT[1]-1)>this._lowerRight.getX()||actCell.getY()+(mrgInfoT[2]-1)>this._lowerRight.getY()){var newY=actCell.getY()-(mrgInfoT[2]-1);actCell.setX(newY<this._upperLeft.getY()?this._upperLeft.getY():newY);this.prevY()}}else{var mrgInfoTM=activeBook.getMergeInfo(mrgInfoT[1],mrgInfoT[2]),newY=actCell.getY()-(mrgInfoTM[2]-1);actCell.setY(newY<this._upperLeft.getY()?this._upperLeft.getY():newY);if(!(actCell.getX()==mrgInfoT[1]&&actCell.getY()==mrgInfoT[2]&&mrgInfoT[1]+(mrgInfoTM[1]-1)<=this._lowerRight.getX()&&mrgInfoT[2]+(mrgInfoTM[2]-1)<=this._lowerRight.getY())){this.prevY()}}}},toString:function(){var s="";s+=" active cell: "+this._activeCell;s+=" upper left corner: "+this._upperLeft.toString();s+=" lower right corner: "+this._lowerRight.toString();return s},formulaUpdate:function(){var env=this._environment.shared,currFormula=Jedox.wss.app.currFormula,tok,rangeVal;if((tok=this.formulaToken).key==(rangeVal=this.getValue())){return}env.inputField.value=currFormula.value=currFormula.value.substring(0,tok.start).concat(rangeVal,currFormula.value.substring(tok.end));this._selection.lastParseRes=Jedox.wss.formula.parse(currFormula.value,Jedox.wss.app.activePane.getCellNFs(env.selectedCellCoords[0],env.selectedCellCoords[1]));for(var range,ranges=this._selection.getRanges(),i=ranges.length-1;i>=0;--i){(range=ranges[i]).formulaToken=this._selection.lastParseRes[range.formulaToken.idx]}this._selection.activeToken=this.formulaToken;Jedox.wss.keyboard.setFieldSize()},_updateRangeSelector:function(){return},expand:function(amount,direction,defExpand){var that=this,offset,activeBook=Jedox.wss.app.activeBook,lastCellCoords=this._environment.shared.lastCellCoords,srcUl=this._upperLeft.clone(),srcLr=this._lowerRight.clone(),dstUl=this._upperLeft.clone(),dstLr=this._lowerRight.clone(),mrgInfoActCell=activeBook.getMergeInfo(this._activeCell.getX(),this._activeCell.getY());function locMergedAreas(area,expand,ul,lr){var mrgAreas={ulX:0,ulY:0,lrX:0,lrY:0},updLastCell=false,adjDone=false;if(!ul||!lr){ul=that._upperLeft;lr=that._lowerRight;updLastCell=true}for(var i=area.ulY;i<=area.lrY;i++){for(var j=area.ulX,mrgInfo,mrgInfoMa;j<=area.lrX;j++){mrgInfo=activeBook.getMergeInfo(j,i);if(mrgInfo){if(mrgInfo[0]){if(expand){mrgAreas.ulX=(mrgAreas.ulX==0||mrgAreas.ulX>j)?j:mrgAreas.ulX;mrgAreas.ulY=(mrgAreas.ulY==0||mrgAreas.ulY>i)?i:mrgAreas.ulY;mrgAreas.lrX=(mrgAreas.lrX==0||mrgAreas.lrX<j+mrgInfo[1]-1)?j+mrgInfo[1]-1:mrgAreas.lrX;mrgAreas.lrY=(mrgAreas.lrY==0||mrgAreas.lrY<i+mrgInfo[2]-1)?i+mrgInfo[2]-1:mrgAreas.lrY}else{if(j+mrgInfo[1]-1>area.lrX){mrgAreas.lrX=j-1}if(i+mrgInfo[2]-1>area.lrY){mrgAreas.lrY=i-1}}}else{mrgInfoMa=activeBook.getMergeInfo(mrgInfo[1],mrgInfo[2]);if(expand){mrgAreas.ulX=(mrgAreas.ulX==0||mrgAreas.ulX>mrgInfo[1])?mrgInfo[1]:mrgAreas.ulX;mrgAreas.ulY=(mrgAreas.ulY==0||mrgAreas.ulY>mrgInfo[2])?mrgInfo[2]:mrgAreas.ulY;mrgAreas.lrX=(mrgAreas.lrX==0||mrgAreas.lrX<mrgInfo[1]+mrgInfoMa[1]-1)?mrgInfo[1]+mrgInfoMa[1]-1:mrgAreas.lrX;mrgAreas.lrY=(mrgAreas.lrY==0||mrgAreas.lrY<mrgInfo[2]+mrgInfoMa[2]-1)?mrgInfo[2]+mrgInfoMa[2]-1:mrgAreas.lrY}else{if(mrgInfo[1]<area.ulX){mrgAreas.ulX=mrgInfo[1]+mrgInfoMa[1]}if(mrgInfo[2]<area.ulY){mrgAreas.ulY=mrgInfo[2]+mrgInfoMa[2]}}}}}}if(mrgAreas.ulX>0&&((expand&&mrgAreas.ulX<ul.getX())||(!expand&&mrgAreas.ulX>ul.getX()))){ul.setX(mrgAreas.ulX);adjDone=true}if(mrgAreas.ulY>0&&((expand&&mrgAreas.ulY<ul.getY())||(!expand&&mrgAreas.ulY>ul.getY()))){ul.setY(mrgAreas.ulY);adjDone=true}if(mrgAreas.lrX>0&&((expand&&mrgAreas.lrX>lr.getX())||(!expand&&mrgAreas.lrX<lr.getX()))){lr.setX(mrgAreas.lrX);adjDone=true}if(mrgAreas.lrY>0&&((expand&&mrgAreas.lrY>lr.getY())||(!expand&&mrgAreas.lrY<lr.getY()))){lr.setY(mrgAreas.lrY);adjDone=true}if(updLastCell){that._lastActiveCell=new Jedox.wss.cls.Point(lr.getX()>that._activeCell.getX()?lr.getX():ul.getX(),lr.getY()>that._activeCell.getY()?lr.getY():ul.getY())}if(adjDone){locMergedAreas({ulX:ul.getX(),ulY:ul.getY(),lrX:lr.getX(),lrY:lr.getY()},expand,ul,lr)}}function isInsideRng(cell,ul,lr){return cell.getX()>=ul.getX()&&cell.getY()>=ul.getY()&&cell.getX()<=lr.getX()&&cell.getY()<=lr.getY()}function chkRng(ul,lr,expand){locMergedAreas({ulX:ul.getX(),ulY:ul.getY(),lrX:lr.getX(),lrY:lr.getY()},expand,ul,lr);return isInsideRng(that._activeCell,ul,lr)}function calcDefExpand(){switch(direction){case Jedox.wss.grid.ScrollDirection.UP:if(that._activeCell.getY()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[2]-1:0)<dstLr.getY()){dstLr.setY(dstLr.getY()-((dstLr.getY()-lastCellCoords[1]>1)?dstLr.getY()-lastCellCoords[1]:amount))}else{if(dstLr.getY()<dstUl.getY()){dstLr.setY(dstLr.getY()-amount)}else{dstUl.setY(dstUl.getY()-amount)}}break;case Jedox.wss.grid.ScrollDirection.DOWN:if(that._activeCell.getY()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[2]-1:0)<dstLr.getY()){if(dstLr.getY()>dstUl.getY()){dstLr.setY(dstLr.getY()+amount)}else{dstUl.setY(dstUl.getY()-amount)}}else{if(dstLr.getY()<dstUl.getY()){dstLr.setY(dstLr.getY()+amount)}else{dstUl.setY(dstUl.getY()+((lastCellCoords[1]-dstUl.getY()>1)?lastCellCoords[1]-dstUl.getY():amount))}}break;case Jedox.wss.grid.ScrollDirection.LEFT:if(that._activeCell.getX()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[1]-1:0)<dstLr.getX()){dstLr.setX(dstLr.getX()-((dstLr.getX()-lastCellCoords[0]>1)?dstLr.getX()-lastCellCoords[0]:amount))}else{if(dstLr.getX()<dstUl.getX()){dstLr.setX(dstLr.getX()-amount)}else{dstUl.setX(dstUl.getX()-amount)}}break;case Jedox.wss.grid.ScrollDirection.RIGHT:if(that._activeCell.getX()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[1]-1:0)<dstLr.getX()){if(dstUl.getX()<dstLr.getX()){dstLr.setX(dstLr.getX()+amount)}}else{if(dstUl.getX()>dstLr.getX()){dstLr.setX(dstLr.getX()-amount)}else{dstUl.setX(dstUl.getX()+((lastCellCoords[0]-dstUl.getX()>1)?lastCellCoords[0]-dstUl.getX():amount))}}break;default:throw new Error("Invalid direction: "+direction)}}function calcKeyExpand(){switch(direction){case Jedox.wss.grid.ScrollDirection.UP:if(dstLr.getY()>that._activeCell.getY()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[2]-1:0)){var dstCopyUl=dstUl.clone(),dstCopyLr=dstLr.clone();dstCopyLr.setY(dstCopyLr.getY()-amount);if(!chkRng(dstCopyUl,dstCopyLr,false)){dstUl.setY(dstUl.getY()-amount)}else{dstLr.setY(dstLr.getY()-amount)}}else{dstUl.setY(dstUl.getY()-amount)}break;case Jedox.wss.grid.ScrollDirection.DOWN:if(dstUl.getY()<that._activeCell.getY()){var dstCopyUl=dstUl.clone(),dstCopyLr=dstLr.clone();dstCopyUl.setY(dstCopyUl.getY()+amount);if(!chkRng(dstCopyUl,dstCopyLr,false)){dstLr.setY(dstLr.getY()+amount)}else{dstUl.setY(dstUl.getY()+amount)}}else{dstLr.setY(dstLr.getY()+amount)}break;case Jedox.wss.grid.ScrollDirection.LEFT:if(dstLr.getX()>that._activeCell.getX()+(mrgInfoActCell&&mrgInfoActCell[0]?mrgInfoActCell[1]-1:0)){var dstCopyUl=dstUl.clone(),dstCopyLr=dstLr.clone();dstCopyLr.setX(dstCopyLr.getX()-amount);if(!chkRng(dstCopyUl,dstCopyLr,false)){dstUl.setX(dstUl.getX()-amount)}else{dstLr.setX(dstLr.getX()-amount)}}else{dstUl.setX(dstUl.getX()-amount)}break;case Jedox.wss.grid.ScrollDirection.RIGHT:if(dstUl.getX()<that._activeCell.getX()){var dstCopyUl=dstUl.clone(),dstCopyLr=dstLr.clone();dstCopyUl.setX(dstCopyUl.getX()+amount);if(!chkRng(dstCopyUl,dstCopyLr,false)){dstLr.setX(dstLr.getX()+amount)}else{dstUl.setX(dstUl.getX()+amount)}}else{dstLr.setX(dstLr.getX()+amount)}break;default:throw new Error("Invalid direction: "+direction)}}function calcPlainRng(){dstUl.setX(lastCellCoords[0]<that._activeCell.getX()?lastCellCoords[0]:that._activeCell.getX());dstUl.setY(lastCellCoords[1]<that._activeCell.getY()?lastCellCoords[1]:that._activeCell.getY());dstLr.setX(lastCellCoords[0]>that._activeCell.getX()?lastCellCoords[0]:that._activeCell.getX());dstLr.setY(lastCellCoords[1]>that._activeCell.getY()?lastCellCoords[1]:that._activeCell.getY())}function constrainToGrid(ul,lr){var defMaxCoords=Jedox.wss.grid.defMaxCoords;if(ul.getX()<1){ul.setX(1)}if(ul.getY()<1){ul.setY(1)}if(lr.getX()>defMaxCoords[0]){lr.setX(defMaxCoords[0])}if(lr.getY()>defMaxCoords[1]){lr.setY(defMaxCoords[1])}}if(defExpand){calcDefExpand()}else{calcKeyExpand()}this.toggleCorners(dstUl,dstLr);if(defExpand){calcPlainRng()}var expanded=dstLr.getX()-dstUl.getX()>srcLr.getX()-srcUl.getX()||dstLr.getY()-dstUl.getY()>srcLr.getY()-srcUl.getY();if(expanded&&isInsideRng(new Jedox.wss.cls.Point(lastCellCoords[0],lastCellCoords[1]),this._upperLeft,this._lowerRight)){return}constrainToGrid(dstUl,dstLr);this._upperLeft=dstUl.clone();this._lowerRight=dstLr.clone();locMergedAreas({ulX:this._upperLeft.getX(),ulY:this._upperLeft.getY(),lrX:this._lowerRight.getX(),lrY:this._lowerRight.getY()},expanded||defExpand);this._environment.shared.lastRangeStartCoord=[this._upperLeft.getX(),this._upperLeft.getY()];this._environment.shared.lastRangeEndCoord=[this._lowerRight.getX(),this._lowerRight.getY()];this._updateOffsets();this._updateRangeSelector()},setAnchorCell:function(cell){this._anchorCell=cell},getAnchorCell:function(){return this._anchorCell},getLastChangedCell:function(){return this._latestChangedCell},setLastChangedCell:function(cell){this._latestChangedCell=cell},getHtmlEdges:function(){return this._cornerElems},setVisibility:function(visibility){this._visibility=visibility},getStatus:function(){return this._status},getCornersPx:function(){return[this._ulCorner,this._lrCorner]},hideBorders:function(){for(var i=0;i<4;i++){this._edgeElems[i].style.display="none"}this._cornerElems[0].style.display="none"},_addCursor:function(el,id){switch(id){case 0:el.style.cursor="se-resize";break;case 1:el.style.cursor="sw-resize";break;case 2:el.style.cursor="ne-resize";break;case 3:el.style.cursor="nw-resize";break}},_mouseOnEdge:function(ev){this._hover(ev)},_legacyDraw:function(){this._environment.shared.lastRangeStartCoord=[(this._realCoords[0]).getX(),(this._realCoords[0]).getY()];this._environment.shared.lastRangeEndCoord=[(this._realCoords[1]).getX(),(this._realCoords[1]).getY()];this._selection.checkForUndoneMarkers()},_mouseOffEdge:function(ev){if(this._status!=Jedox.wss.range.AreaStatus.RESIZING){this._unHover(ev)}},_mouseOnEdgeDown:function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;switch(elem.style.cursor){case"se-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_EAST;break;case"sw-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_WEST;break;case"ne-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.NORTH_EAST;break;case"nw-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.NORTH_WEST;break;default:this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_EAST}Jedox.wss.app.mimicOvertracking=(Ext.isGecko3&&ev.button==0);this._selection.activeToken=this.formulaToken;this.registerForMouseMovement(this._environment.shared.lastCell)},registerForMouseMovement:function(cell){this._realCoords=this.getCorners();this._status=Jedox.wss.range.AreaStatus.RESIZING;this._setMonitorCell(cell);var tmp=this._selection.getBook().getCoordsByCell(this._monitorCell);var x=(tmp[0]==this._realCoords[0].getX())?this._realCoords[1].getX():this._realCoords[0].getX();var y=(tmp[1]==this._realCoords[0].getY())?this._realCoords[1].getY():this._realCoords[0].getY();this.setActiveCell(new Jedox.wss.cls.Point(x,y));this._latestChangedCell=this._lrCell;this._selection.setMode(Jedox.wss.range.RangeMode.EDIT);Jedox.wss.app.mouseMovementObserver.subscribe(this._move,this);Jedox.wss.app.mouseUpObserver.subscribe(this._onmouseup,this)},_mouseOnEdgeUp:function(ev){Jedox.wss.app.mimicOvertracking=false;this._legacyMouseUp();this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._selection.setMode(Jedox.wss.range.RangeMode.NONE)},_onmouseout:function(ev){this._unHover(ev)},_onmousemove:function(ev){this._hover(ev)},_hover:function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;if((this._selection.getMode()==Jedox.wss.range.RangeMode.EDIT)||(this._status==Jedox.wss.range.AreaStatus.RESIZING)||(this._status==Jedox.wss.range.AreaStatus.DRAGGING)){return}switch(elem.className){case"defaultRangeBorder":if(Jedox.wss.app.ctrlKeyPressed){_curHotSpot="7 4"}else{_curHotSpot="9 9"}if(Jedox.wss.app.browser=="ie"){_curHotSpot=""}elem.style.cursor="".concat("url(/ui/app/res/img/cursors/rng_",Jedox.wss.app.ctrlKeyPressed?"copy":"move",".cur)",_curHotSpot,", default");this._environment.shared.mousePosition="rngBorder";break;case"formularRangeBorder":elem.style.cursor="move";break;case"rangeEdge":_curHotSpot="9 9";if(Jedox.wss.app.browser=="ie"){_curHotSpot=""}elem.style.cursor="".concat("url(/ui/app/res/img/cursors/md_curr",(Jedox.wss.app.ctrlKeyPressed?"_plus":""),".cur)",_curHotSpot,", default");this._environment.shared.mousePosition="magicDot"}this._status=Jedox.wss.range.AreaStatus.HOVERING},_unHover:function(ev){if(document.all){ev=window.event}var elem;if(this._status==Jedox.wss.range.AreaStatus.RESIZING){return}if(typeof(ev)==="object"){elem=document.all?ev.srcElement:ev.target;if((elem.className=="formularRangeBorder")||(elem.className=="defaultRangeBorder")){elem.style.cursor="inherit"}}else{for(var i=0;i<this._edgeElems.length;i++){this._edgeElems[i].style.cursor="inherit"}}if((this._status==Jedox.wss.range.AreaStatus.RESIZING)||(this._status==Jedox.wss.range.AreaStatus.DRAGGING)){return}this._status=Jedox.wss.range.AreaStatus.NORMAL},_legacyMouseUp:function(){var gridMode=Jedox.wss.grid.GridMode,sourceSel=Jedox.wss.app.sourceSel;if(!sourceSel){switch(this._environment.shared.inputMode){case gridMode.INPUT:Jedox.wss.general.setInputMode(gridMode.EDIT);break;case gridMode.POINT:Jedox.wss.general.setInputMode(Jedox.wss.app.lastInputMode);break}}else{var selRange=Ext.getCmp("selRange"),sheetName=Jedox.wss.app.activeBook.getSheetSelector().getActiveSheetName(),rng=(sheetName.search(/ /)>=0?"'".concat(sheetName,"'"):sheetName).concat("!",this.getValue(true));sourceSel.rng=rng;selRange.setValue(rng);selRange.selectText();selRange.focus();Jedox.wss.general.setInputMode(gridMode.DIALOG)}},_onmouseup:function(ev){Jedox.wss.app.mimicOvertracking=false;if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this.afterExpanding()}this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this._selection.setMode(Jedox.wss.range.RangeMode.NONE);this._legacyMouseUp();this.reposBgndMask(true);if(this._doPaste&&Jedox.wss.app.clipboard!=null){this._selection.paste();this._doPaste=false;this._environment.shared.copySelection.removeAll();Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)}},_onmousedown:function(ev){var that=this;if(document.all){ev=window.event}this._status=Jedox.wss.range.AreaStatus.DRAGGING;Jedox.wss.app.mimicOvertracking=(Ext.isGecko3&&ev.button==0);this._setMonitorCell(this._environment.shared.lastCell);Jedox.wss.app.mouseMovementObserver.subscribe(this._move,this);Jedox.wss.app.mouseUpObserver.subscribe(this._onmouseup,this);this._selection.activeToken=this.formulaToken;this._selection.setMode(Jedox.wss.range.RangeMode.EDIT);this.reposBgndMask(false)},_setMonitorCell:function(cell,el){if(!cell){return}var monitorCoords=[],monitorCell,xOffset=0,yOffset=0,pxOffset=(el==undefined||el.className!="HBSubRangeBorder")?0:2;if(Jedox.util.offsetTop(cell.parentNode)<Jedox.util.offsetTop(this._edgeElems[0])){yOffset=1}else{if(Jedox.util.offsetTop(cell.parentNode)>=Jedox.util.offsetTop(this._edgeElems[1])-pxOffset){yOffset=-1}}if(Jedox.util.offsetLeft(cell)<Jedox.util.offsetLeft(this._edgeElems[2])){xOffset=1}else{if(Jedox.util.offsetLeft(cell)>=Jedox.util.offsetLeft(this._edgeElems[3])-pxOffset){xOffset=-1}}var cellCoords=this._selection.getBook().getCoordsByCell(cell);if(!cellCoords){return}if(this._status!=Jedox.wss.range.AreaStatus.DRAGGING&&this._realCoords[0].equals(this._realCoords[1])){this._monitorCell=cell;this._monitorCellCoords=[cellCoords[0],cellCoords[1]]}else{var xIncOffset=cellCoords[0]+xOffset<1?1:cellCoords[0]+xOffset,yIncOffset=cellCoords[1]+yOffset<1?1:cellCoords[1]+yOffset;this._monitorCell=this._selection.getCell(xIncOffset,yIncOffset);this._monitorCellCoords=[xIncOffset,yIncOffset];this._environment.shared.lastCell=this._monitorCell;this._environment.shared.lastCellCoords=this._monitorCellCoords}this._monitorCoords[0]=new Jedox.wss.cls.Point(Jedox.util.offsetLeft(this._monitorCell),Jedox.util.offsetTop(this._monitorCell.parentNode));this._monitorCoords[1]=new Jedox.wss.cls.Point(Jedox.util.offsetLeft(this._monitorCell)+this._monitorCell.offsetWidth,Jedox.util.offsetTop(this._monitorCell.parentNode)+this._monitorCell.offsetHeight)},_refreshElement:function(scope,book,nmcX,nmcY){scope.draw();scope._setMonitorCell(book.getCellByCoords(nmcX,nmcY))},_resizeOnScroll:function(book,type,direction,firstVisCoord,lastVisCoord,scrollTimeout){if(direction==undefined){return}var scope=this;var lastCellCoords=this._environment.shared.lastCellCoords;var rangeStatus=Jedox.wss.range.AreaStatus;var scrollType=Jedox.wss.grid.scrollType;var scrollDir=Jedox.wss.grid.ScrollDirection;var defMaxCoords=Jedox.wss.grid.defMaxCoords;var rangeCoords=this.getCorners();var nmcX=lastCellCoords[0];var nmcY=lastCellCoords[1];function scrollLeft(){if(scope._status==rangeStatus.RESIZING){var nmcXDelta=Math.abs(nmcX-firstVisCoord-((firstVisCoord==1)?0:1));nmcX=nmcX-nmcXDelta;if(nmcX>rangeCoords[0].getX()){scope._selection.expand(nmcXDelta*-1,scrollDir.RIGHT)}else{scope._selection.expand(nmcXDelta,scrollDir.LEFT)}}else{if(scope._status==rangeStatus.DRAGGING){nmcX=(firstVisCoord>1)?firstVisCoord+1:firstVisCoord;scope._selection.moveTo(nmcX,scope._realCoords[0].getY())}}scope._refreshElement(scope,book,nmcX,nmcY)}function scrollRight(){if(scope._status==rangeStatus.RESIZING){var nmcXDelta=Math.abs(lastVisCoord-nmcX-((lastVisCoord==defMaxCoords[0])?0:1));nmcX=nmcX+nmcXDelta;if(nmcX<rangeCoords[1].getX()){scope._selection.expand(nmcXDelta*-1,scrollDir.LEFT)}else{scope._selection.expand(nmcXDelta,scrollDir.RIGHT)}}else{if(scope._status==rangeStatus.DRAGGING){nmcX=(lastVisCoord<defMaxCoords[0])?lastVisCoord-1:lastVisCoord;scope._selection.moveTo(nmcX-(scope._realCoords[1].getX()-scope._realCoords[0].getX()),scope._realCoords[0].getY())}}scope._refreshElement(scope,book,nmcX,nmcY)}function scrollUp(){if(scope._status==rangeStatus.RESIZING){var nmcYDelta=Math.abs(nmcY-firstVisCoord-((firstVisCoord==1)?0:1));nmcY=nmcY-nmcYDelta;if(nmcY>rangeCoords[0].getY()){scope._selection.expand(nmcYDelta*-1,scrollDir.DOWN)}else{scope._selection.expand(nmcYDelta,scrollDir.UP)}}else{if(scope._status==rangeStatus.DRAGGING){nmcY=(firstVisCoord>1)?firstVisCoord+1:firstVisCoord;scope._selection.moveTo(scope._realCoords[0].getX(),nmcY)}}scope._refreshElement(scope,book,nmcX,nmcY)}function scrollDown(){if(scope._status==rangeStatus.RESIZING){var nmcYDelta=Math.abs(lastVisCoord-nmcY-((lastVisCoord==defMaxCoords[1])?0:1));nmcY=nmcY+nmcYDelta;if(nmcY<rangeCoords[1].getY()){scope._selection.expand(nmcYDelta*-1,scrollDir.UP)}else{scope._selection.expand(nmcYDelta,scrollDir.DOWN)}}else{if(scope._status==rangeStatus.DRAGGING){nmcY=(lastVisCoord<defMaxCoords[1])?lastVisCoord-1:lastVisCoord;scope._selection.moveTo(scope._realCoords[0].getX(),nmcY-(scope._realCoords[1].getY()-scope._realCoords[0].getY()))}}scope._refreshElement(scope,book,nmcX,nmcY)}if(type==scrollType.HORIZ){if(direction==Jedox.wss.grid.horScrollDir.RIGHT){if(nmcX<lastVisCoord-1){scrollRight()}if(lastVisCoord==defMaxCoords[0]){this._environment.shared.autoScroll.scrollElem=setTimeout(scrollRight,scrollTimeout)}}else{if(nmcX>firstVisCoord+1){scrollLeft()}if(firstVisCoord==1){this._environment.shared.autoScroll.scrollElem=setTimeout(scrollLeft,scrollTimeout)}}}else{if(direction==Jedox.wss.grid.vertScrollDir.DOWN){if(nmcY<lastVisCoord-1){scrollDown()}if(lastVisCoord==defMaxCoords[1]){this._environment.shared.autoScroll.scrollElem=setTimeout(scrollDown,scrollTimeout)}}else{if(nmcY>firstVisCoord+1){scrollUp()}if(firstVisCoord==1){this._environment.shared.autoScroll.scrollElem=setTimeout(scrollUp,scrollTimeout)}}}},_move:function(ev){if(document.all){ev=window.event}if(this._doCC){this._doCC=false;this._doPaste=true;if(ev.ctrlKey){this._selection.copy()}else{this._selection.cut()}}this._environment.shared.autoScroll.checkAndScroll(ev,this._resizeOnScroll,Jedox.wss.grid.scrollType.ALL,null,this);this._selection.setActiveRange(this);if(this._status==Jedox.wss.range.AreaStatus.DRAGGING){var elemCoords=this._environment.shared.lastCellCoords;this._selection.moveTo(elemCoords[0]+this._realCoords[0].getX()-this._monitorCellCoords[0],elemCoords[1]+this._realCoords[0].getY()-this._monitorCellCoords[1])}else{this._resizeRange(ev)}this.draw();this._setMonitorCell(this._environment.shared.lastCell)},_resizeRange:function(ev){var row=this._environment.shared.lastCellCoords[0]-this._monitorCellCoords[0],column=this._environment.shared.lastCellCoords[1]-this._monitorCellCoords[1];var diff=new Jedox.wss.cls.Point(row,column);if(diff.getX()>0){this._selection.expand(diff.getX(),Jedox.wss.grid.ScrollDirection.RIGHT,true)}else{if(diff.getX()<0){this._selection.expand(Math.abs(diff.getX()),Jedox.wss.grid.ScrollDirection.LEFT,true)}}if(diff.getY()>0){this._selection.expand(diff.getY(),Jedox.wss.grid.ScrollDirection.DOWN,true)}else{if(diff.getY()<0){this._selection.expand(Math.abs(diff.getY()),Jedox.wss.grid.ScrollDirection.UP,true)}}},setState:function(state){this._state=state},getHtmlElements:function(){return this._edgeElems},hide:function(){var i;for(i=0;i<this._edgeElems.length;i++){this._edgeElems[i].style.display="none"}for(i=0;i<this._cornerElems.length;i++){this._cornerElems[i].style.display="none"}},hideElement:function(elementNumber){this._edgeElems[elementNumber].style.display="none"},showElement:function(elementNumber){this._edgeElems[elementNumber].style.display="block"},getOffsetsPx:function(useragent){var offsets=[];switch(useragent){case"ff":offsets=[{left:1,top:-1,width:-1,height:2},{left:1,top:-4,width:-1,height:0},{left:-1,top:1,width:0,height:-2},{left:-3,top:1,width:0,height:-2}];break;case"sf":offsets=[{left:1,top:-1,width:-1,height:2},{left:1,top:-4,width:-1,height:0},{left:-1,top:1,width:0,height:-2},{left:-3,top:1,width:0,height:-2}];break;case"ie":offsets=[{left:1,top:-1,width:-1,height:2},{left:1,top:-4,width:-1,height:0},{left:-1,top:1,width:0,height:-2},{left:-3,top:1,width:0,height:-2}];break;default:offsets=[{left:1,top:-1,width:-1,height:2},{left:1,top:-4,width:-1,height:0},{left:-1,top:1,width:0,height:-2},{left:-3,top:1,width:0,height:-2}];console.warn("Unkown user agent: ",useragent)}return offsets},drawActiveCell:function(){this._cursorField.draw(this._activeCellEl,this.getActiveCell())},draw:function(){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){return}var ulOffset=1,lrOffset=1,pxCoords,book=this._selection.getBook();this._realCoords=this.getCorners();if((this._ulCell=book.getCellByCoords(this._realCoords[0].getX(),this._realCoords[0].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[0].getX(),this._realCoords[0].getY());this._ulCorner.setX(pxCoords[0]-ulOffset);this._ulCorner.setY(pxCoords[1]-ulOffset)}else{this._ulCorner.setX(this._ulCell.offsetLeft-ulOffset);this._ulCorner.setY(this._ulCell.parentNode.offsetTop-ulOffset)}if((this._lrCell=book.getCellByCoords(this._realCoords[1].getX(),this._realCoords[1].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[1].getX()+1,this._realCoords[1].getY()+1);this._lrCorner.setX(pxCoords[0]);this._lrCorner.setY(pxCoords[1]+lrOffset)}else{this._lrCorner.setX(this._lrCell.offsetLeft+this._lrCell.offsetWidth);this._lrCorner.setY(this._lrCell.parentNode.offsetTop+this._lrCell.offsetHeight+lrOffset)}this._drawRect();if(this._state==Jedox.wss.range.AreaState.NORMAL&&(this._status==Jedox.wss.range.AreaStatus.RESIZING||this._status==Jedox.wss.range.AreaStatus.DRAGGING)){this._setBorderBold()}else{this._setBorder()}this._drawCorners()},_drawRect:function(brdSize){var offsets=this.getOffsetsPx(Jedox.wss.app.browser);if(brdSize==undefined){brdSize=5}this._edgeElems[0].style.left="".concat(this._ulCorner.getX()+offsets[0].left,"px");this._edgeElems[0].style.top="".concat(this._ulCorner.getY()+offsets[0].top,"px");this._edgeElems[0].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[0].width,"px");this._edgeElems[0].style.height="".concat(brdSize+offsets[0].height,"px");this._edgeElems[0].style.display="block";this._edgeElems[1].style.left="".concat(this._ulCorner.getX()+offsets[1].left,"px");this._edgeElems[1].style.top="".concat(this._lrCorner.getY()+offsets[1].top,"px");this._edgeElems[1].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[1].width,"px");this._edgeElems[1].style.height="".concat(brdSize+offsets[1].height,"px");this._edgeElems[1].style.display="block";this._edgeElems[2].style.left="".concat(this._ulCorner.getX()+offsets[2].left,"px");this._edgeElems[2].style.top="".concat(this._ulCorner.getY()+offsets[2].top,"px");this._edgeElems[2].style.width="".concat(brdSize+offsets[2].width,"px");this._edgeElems[2].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[2].height,"px");this._edgeElems[2].style.display="block";this._edgeElems[3].style.left="".concat(this._lrCorner.getX()+offsets[3].left,"px");this._edgeElems[3].style.top="".concat(this._ulCorner.getY()+offsets[3].top,"px");this._edgeElems[3].style.width="".concat(brdSize+offsets[3].width,"px");this._edgeElems[3].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[3].height,"px");this._edgeElems[3].style.display="block"},_drawBgnd:function(){this._bgndElemParams={l:this._ulCorner.getX()+4,t:this._ulCorner.getY()+4,w:this._lrCorner.getX()-this._ulCorner.getX()-6,h:this._lrCorner.getY()-this._ulCorner.getY()-6};this._bgndElem.style.left=this._bgndElemParams.l+"px";this._bgndElem.style.width=this._bgndElemParams.w+"px";this._bgndElem.style.top=this._bgndElemParams.t+"px";this._bgndElem.style.height=this._bgndElemParams.h+"px";this._bgndElem.style.display="block";if(this._status!=Jedox.wss.range.AreaStatus.DRAGGING){this._legacyDraw()}else{Jedox.wss.app.mouseUpObserver.subscribe(this._legacyDraw,this)}this._reposBgndMask(this._selection.getBook(),0);this._reposBgndMask(this._selection.getBook(),1)},reposBgndMask:function(whether){return},_reposBgndMask:function(book,type){if(type==0){var attr="left",range_beg=this._bgndElemParams.l,range_end=range_beg+this._bgndElemParams.w}else{if(type==1){var attr="top",range_beg=this._bgndElemParams.t,range_end=range_beg+this._bgndElemParams.h}else{return}}var vport_size=book.getViewportSize()[type],vport_beg=book.getViewportPos()[0][type],vport_end=vport_beg+vport_size;if(range_beg>vport_end||vport_beg>range_end){return}var isect_beg=range_beg<vport_beg?vport_beg:range_beg,isect_end=range_end<vport_end?range_end:vport_end;var mask_beg=range_beg+this._bgndMaskPos[type],mask_end=mask_beg+vport_size*2,vport_half=parseInt(vport_size/2);if(isect_beg>=mask_beg+vport_half&&isect_end<=mask_end-vport_half){return}if(isect_beg==range_beg){this._bgndMaskPos[type]=-vport_half}else{if(isect_end==range_end){this._bgndMaskPos[type]=parseInt(range_end-range_beg-vport_size-vport_half)}else{this._bgndMaskPos[type]=isect_beg-range_beg-vport_half}}this._bgndMask.style[attr]="".concat(this._bgndMaskPos[type],"px")},destruct:function(){Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);for(var i=3;i>=0;--i){this._edgeElems[i].parentNode.removeChild(this._edgeElems[i])}},_getColorNumber:function(){return(this.formulaToken instanceof Object?this.formulaToken.id:0)%this.getColors().length},_setBorder:function(){if(this._borderState==Jedox.wss.range.BorderState.NORMAL){return}if(this._state==Jedox.wss.range.AreaState.NEW){this._edgeElems[0].style.backgroundImage="url(/ui/app/res/img/borders/new_horizontal_up.gif)";this._edgeElems[0].style.backgroundRepeat="repeat-x";this._edgeElems[0].style.backgroundPosition="0px 2px";this._edgeElems[1].style.backgroundImage="url(/ui/app/res/img/borders/new_horizontal_up.gif)";this._edgeElems[1].style.backgroundRepeat="repeat-x";this._edgeElems[1].style.backgroundPosition="0px 1px";this._edgeElems[2].style.backgroundImage="url(/ui/app/res/img/borders/new_vertical_left.gif)";this._edgeElems[2].style.backgroundRepeat="repeat-y";this._edgeElems[2].style.backgroundPosition="2px 0px";this._edgeElems[3].style.backgroundImage="url(/ui/app/res/img/borders/new_vertical_left.gif)";this._edgeElems[3].style.backgroundRepeat="repeat-y";this._edgeElems[3].style.backgroundPosition="1px 0px"}else{var colorNumber=this._getColorNumber();this._edgeElems[0].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_normal.gif)");this._edgeElems[0].style.backgroundPosition="0px 0px";this._edgeElems[1].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_normal.gif)");this._edgeElems[1].style.backgroundPosition="0px 0px";this._edgeElems[2].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_normal.gif)");this._edgeElems[2].style.backgroundPosition="0px 0px";this._edgeElems[3].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_normal.gif)");this._edgeElems[3].style.backgroundPosition="0px 0px"}this._borderState=Jedox.wss.range.BorderState.NORMAL},_setBorderBold:function(){if(this._borderState==Jedox.wss.range.BorderState.BOLD||this._state==Jedox.wss.range.AreaState.NEW){return}var colorNumber=this._getColorNumber();this._edgeElems[0].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_down.gif)");this._edgeElems[0].style.backgroundPosition="0px 0px";this._edgeElems[1].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_up.gif)");this._edgeElems[1].style.backgroundPosition="0px 0px";this._edgeElems[2].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_right.gif)");this._edgeElems[2].style.backgroundPosition="0px 0px";this._edgeElems[3].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_left.gif)");this._edgeElems[3].style.backgroundPosition="0px 0px";this._borderState=Jedox.wss.range.BorderState.BOLD},_drawCorners:function(){return},setCursor:function(el,cur){if(cur=="rng_copy"){_curHotSpot="7 4"}else{if(cur=="rng_move"){_curHotSpot="9 9"}else{if(cur=="sand_clock"){_curHotSpot="10 10"}else{if(cur=="arrow_sclock"){_curHotSpot="10 10"}else{if(cur=="hand"){_curHotSpot="5 0"}else{if(cur=="md_curr"){_curHotSpot="8 8"}else{if(cur=="md_curr_plus"){_curHotSpot="8 8"}else{if(cur=="move"){_curHotSpot="9 9"}else{_curHotSpot=""}}}}}}}}if(Jedox.wss.app.browser=="ie"){_curHotSpot=""}switch(el){case"rngBorder":for(var i=0;i<this._edgeElems.length;i++){this._edgeElems[i].style.cursor="".concat("url(/ui/app/res/img/cursors/",cur,".cur)",_curHotSpot,", default")}break;case"magicDot":this._cornerElems[0].style.cursor="".concat("url(/ui/app/res/img/cursors/",cur,".cur)",_curHotSpot,", default")}},repaint:function(){var colorNumber=this._getColorNumber();if(this._state==Jedox.wss.range.AreaState.NEW){this._edgeElems[0].style.backgroundImage="url(/ui/app/res/img/borders/new_horizontal_up.gif)";this._edgeElems[0].style.backgroundRepeat="repeat-x";this._edgeElems[0].style.backgroundPosition="0px 2px";this._edgeElems[1].style.backgroundImage="url(/ui/app/res/img/borders/new_horizontal_up.gif)";this._edgeElems[1].style.backgroundRepeat="repeat-x";this._edgeElems[1].style.backgroundPosition="0px 1px";this._edgeElems[2].style.backgroundImage="url(/ui/app/res/img/borders/new_vertical_left.gif)";this._edgeElems[2].style.backgroundRepeat="repeat-y";this._edgeElems[2].style.backgroundPosition="2px 0px";this._edgeElems[3].style.backgroundImage="url(/ui/app/res/img/borders/new_vertical_left.gif)";this._edgeElems[3].style.backgroundRepeat="repeat-y";this._edgeElems[3].style.backgroundPosition="1px 0px"}else{this._edgeElems[0].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_normal.gif)");this._edgeElems[0].style.backgroundPosition="0px 0px";this._edgeElems[1].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_horizontal_normal.gif)");this._edgeElems[1].style.backgroundPosition="0px 0px";this._edgeElems[2].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_normal.gif)");this._edgeElems[3].style.backgroundPosition="0px 0px";this._edgeElems[3].style.backgroundImage="url(/ui/app/res/img/borders/".concat(colorNumber,"_vertical_normal.gif)");this._edgeElems[3].style.backgroundPosition="0px 0px"}for(var color=(this.getColors())[colorNumber],i=4;i>0;this._cornerElems[--i].style.backgroundColor=color){}},getContainer:function(){return this._container},getEnvironment:function(){return this._environment},getBook:function(){return this._selection.getBook()}};Jedox.wss.grid.DefaultRange=(function(){return function(selection,startPoint,endPoint){Jedox.wss.grid.DefaultRange.parent.constructor.call(this,selection,startPoint,endPoint);var that=this;for(var htmlEl,clsName="defaultRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;Jedox.util.addEvent(htmlEl,"mousedown",function(ev){that._onmousedown(ev)},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._onmouseup(ev)},false);Jedox.util.addEvent(htmlEl,"mousemove",function(ev){that._onmousemove(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._onmouseout(ev)},false);this._container.appendChild(htmlEl)}this._cursorField=new Jedox.wss.cls.CursorField(this._selection.getDomId(),this._container,this);this._fillRange=new Jedox.wss.grid.FillSelection(this._upperLeft,this._selection.getBook());htmlEl=this._cornerElems[0]=document.createElement("div");htmlEl.className="rangeEdge";this._addCursor(htmlEl,0);Jedox.util.addEvent(htmlEl,"mousedown",function(ev){var env=Jedox.wss.app.environment,gridMode=Jedox.wss.grid.GridMode;if((env.inputMode==Jedox.wss.grid.GridMode.INPUT||env.inputMode==Jedox.wss.grid.GridMode.EDIT)&&Jedox.wss.keyboard.sendInput(env.inputField,13,false)){Jedox.wss.keyboard.cancelInput(true);try{Jedox.wss.app.currFormula.blur()}catch(e){}}var viewportPos=Jedox.wss.app.activeBook.getViewportPos();that._fillRange.getActiveRange().activate({ul:that._upperLeft.clone(),lr:that._lowerRight.clone(),ulPx:that._ulCorner.clone(),lrPx:that._lrCorner.clone(),mdLRCornerPx:new Jedox.wss.cls.Point(that._cornerElems[0].offsetLeft+that._cornerElems[0].offsetWidth+env.gridScreenCoords[0][0]-viewportPos[0][0],that._cornerElems[0].offsetTop+that._cornerElems[0].offsetHeight+env.gridScreenCoords[0][1]-viewportPos[0][1])})},false);Jedox.util.addEvent(htmlEl,"mouseover",function(ev){that._mouseOnEdge(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._mouseOffEdge(ev)},false);this._container.appendChild(htmlEl);this._bgndElem=document.createElement("div");this._bgndElem.className="rangeBackground";this._bgndElem.onmousemove=Jedox.wss.mouse.rangeOverTracking;this._bgndElem.onmousedown=Jedox.wss.mouse.mouseOnRangeDown;this._bgndMask=document.createElement("div");this._bgndMask.className="rangeMask";var vportSize=this._selection.getBook().getViewportSize();this._bgndMask.style.cssText="".concat("width:",vportSize[0]*2,"px;height:",vportSize[1]*2,"px;left:0px;top:0px;");this._bgndElem.appendChild(this._bgndMask);this._container.appendChild(this._bgndElem)}})();Jedox.util.extend(Jedox.wss.grid.DefaultRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.DefaultRange;clsRef.prototype.moveTo=function(x,y){x=parseInt(x,10);y=parseInt(y,10);var width=this._lowerRight.getX()-this._upperLeft.getX(),height=this._lowerRight.getY()-this._upperLeft.getY(),defMaxCoords=Jedox.wss.grid.defMaxCoords;if(x<1||y<1||x+width>defMaxCoords[0]||y+height>defMaxCoords[1]){return}this._upperLeft.setX(x);this._upperLeft.setY(y);this._lowerRight.setX(x+width);this._lowerRight.setY(y+height);this._environment.shared.lastRangeStartCoord=[this._upperLeft.getX(),this._upperLeft.getY()];this._environment.shared.lastRangeEndCoord=[this._lowerRight.getX(),this._lowerRight.getY()];this._activeCell.setX(x);this._activeCell.setY(y);this._selection.setActiveCell(null,x-Jedox.wss.app.firstRowNumeric+1,y-Jedox.wss.app.firstColumn+1,false);this._updateOffsets()};clsRef.prototype._updateRangeSelector=function(){this._selection.updateRangeSelector()};clsRef.prototype._mouseOnEdgeDown=function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;switch(elem.style.cursor){case"se-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_EAST;break;case"sw-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_WEST;break;case"ne-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.NORTH_EAST;break;case"nw-resize":this._resizeDirection=Jedox.wss.range.ResizeDirection.NORTH_WEST;break;default:this._resizeDirection=Jedox.wss.range.ResizeDirection.SOUTH_EAST}this._selection.activeToken=this.formulaToken;this.registerForMouseMovement(this._environment.shared.lastCell);this._latestChangedCell=this._lrCell;this.setStartCoords()};clsRef.prototype._legacyMouseUp=function(){if(this._environment.shared.inputMode==Jedox.wss.grid.GridMode.EDIT){Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.READY)}else{if(this._environment.shared.inputMode==Jedox.wss.grid.GridMode.INPUT){Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.EDIT)}}Jedox.wss.general.setCoords();this._selection.checkForUndoneMarkers()};clsRef.prototype._onmouseup=function(ev){Jedox.wss.app.mimicOvertracking=false;if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this.afterExpanding()}this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this._selection.setMode(Jedox.wss.range.RangeMode.NONE);Jedox.wss.app.mouseUpObserver.unsubscribe(this._legacyDraw);this._legacyMouseUp();this.reposBgndMask(true);if(this._doPaste&&Jedox.wss.app.clipboard!=null){this._selection.paste();this._doPaste=false;this._environment.shared.copySelection.removeAll();Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)}};clsRef.prototype._onmousedown=function(ev){var that=this;if(document.all){ev=window.event}this._doCC=true;this._status=Jedox.wss.range.AreaStatus.DRAGGING;Jedox.wss.app.mimicOvertracking=(Ext.isGecko3&&ev.button==0);this._setMonitorCell(this._environment.shared.lastCell);Jedox.wss.app.mouseMovementObserver.subscribe(this._move,this);Jedox.wss.app.mouseUpObserver.subscribe(this._onmouseup,this);this._selection.activeToken=this.formulaToken;this._selection.setMode(Jedox.wss.range.RangeMode.EDIT);this.reposBgndMask(false)};clsRef.prototype._move=function(ev){if(document.all){ev=window.event}if(this._doCC){this._doCC=false;this._doPaste=true;if(ev.ctrlKey){this._selection.copy()}else{this._selection.cut()}}this._environment.shared.autoScroll.checkAndScroll(ev,this._resizeOnScroll,Jedox.wss.grid.scrollType.ALL,null,this);this._selection.setActiveRange(this);if(this._status==Jedox.wss.range.AreaStatus.DRAGGING){var elemCoords=this._environment.shared.lastCellCoords;this._selection.moveTo(elemCoords[0]+this._realCoords[0].getX()-this._monitorCellCoords[0],elemCoords[1]+this._realCoords[0].getY()-this._monitorCellCoords[1])}else{this._resizeRange(ev)}this.draw();this._setMonitorCell(this._environment.shared.lastCell)};clsRef.prototype.hide=function(){this._switchVisibility(false)};clsRef.prototype.show=function(){this._switchVisibility(true)};clsRef.prototype._switchVisibility=function(rngVis){for(var i=0;i<this._edgeElems.length;i++){this._edgeElems[i].style.display=rngVis?"block":"none"}for(var i=0;i<this._cornerElems.length;i++){this._cornerElems[i].style.display=rngVis?"block":"none"}if(rngVis){this._cursorField.show()}else{this._cursorField.hide()}this._bgndElem.style.display=rngVis?"block":"none"};clsRef.prototype.isVisible=function(){return this._edgeElems[0].style.display=="block"&&this._cornerElems[0].style.display=="block"};clsRef.prototype.getOffsetsPx=function(useragent){var offsets=[];switch(useragent){case"ff":offsets=[{left:0,top:-1,width:1,height:0},{left:0,top:-2,width:0,height:0},{left:-1,top:0,width:0,height:1},{left:-2,top:0,width:0,height:0}];break;case"sf":offsets=[{left:0,top:-1,width:1,height:0},{left:0,top:-2,width:0,height:0},{left:-1,top:0,width:0,height:1},{left:-2,top:0,width:0,height:0}];break;case"ie":offsets=[{left:0,top:-1,width:1,height:0},{left:0,top:-2,width:0,height:0},{left:-1,top:0,width:0,height:1},{left:-2,top:0,width:0,height:0}];break;default:offsets=[{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0}];console.warn("Unkown user agent: ",useragent)}return offsets};clsRef.prototype.draw=function(){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){return}var ulOffset,lrOffset,pxCoords,book=this._selection.getBook(),activeSheet=Jedox.wss.app.activeSheet,acell=this.getActiveCell(),actX=activeSheet._colWidths.getElemAt(acell.getX()),actY=activeSheet._rowHeights.getElemAt(acell.getY());if(!actX||!actY){actX=acell.getX()+(!actX?1:0);actY=acell.getY()+(!actY?1:0);this._selection.set(new Jedox.wss.cls.Point(actX,actY),new Jedox.wss.cls.Point(actX,actY));this._selection.draw();return}var acellEl=book.getCellByCoords(acell.getX(),acell.getY());if(acellEl){var acellCoords=book.getPixelsByCoords(acell.getX(),acell.getY());this._activeCellEl={ulX:acellCoords[0],ulY:acellCoords[1],lrX:acellCoords[0]+acellEl.offsetWidth,lrY:acellCoords[1]+acellEl.offsetHeight}}ulOffset=1;lrOffset=0;this._realCoords=this.getCorners();if((this._ulCell=book.getCellByCoords(this._realCoords[0].getX(),this._realCoords[0].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[0].getX(),this._realCoords[0].getY());this._ulCorner.setX(pxCoords[0]-ulOffset);this._ulCorner.setY(pxCoords[1]-ulOffset)}else{this._ulCorner.setX(this._ulCell.offsetLeft-ulOffset);this._ulCorner.setY(this._ulCell.parentNode.offsetTop-ulOffset)}if((this._lrCell=book.getCellByCoords(this._realCoords[1].getX(),this._realCoords[1].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[1].getX()+1,this._realCoords[1].getY()+1);this._lrCorner.setX(pxCoords[0]);this._lrCorner.setY(pxCoords[1]+lrOffset)}else{this._lrCorner.setX(this._lrCell.offsetLeft+this._lrCell.offsetWidth);this._lrCorner.setY(this._lrCell.parentNode.offsetTop+this._lrCell.offsetHeight+lrOffset)}this._drawRect();this._drawBgnd();this.drawActiveCell();this._setBorder();this._drawCorners();Jedox.wss.hb.setAllNormal()};clsRef.prototype.reposBgndMask=function(whether){if(whether){if(this._bgndElemParams.w>this._selection.getBook().getViewportSize()[0]||this._bgndElemParams.h>this._selection.getBook().getViewportSize()[1]){this._selection.getBook().scrollObserver.subscribe(this._reposBgndMask,this)}}else{this._selection.getBook().scrollObserver.unsubscribe(this._reposBgndMask)}};clsRef.prototype.destruct=function(){Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);for(var i=3;i>=0;--i){this._edgeElems[i].parentNode.removeChild(this._edgeElems[i]);this._cornerElems[i].parentNode.removeChild(this._cornerElems[i])}};clsRef.prototype._getColorNumber=function(){return"default"};clsRef.prototype._drawCorners=function(){this._cornerElems[0].style.left="".concat(this._lrCorner.getX()-3,"px");this._cornerElems[0].style.top="".concat(this._lrCorner.getY()-3,"px");this._cornerElems[0].style.display="block"};clsRef=null;Jedox.wss.grid.FormulaRange=(function(){var gpOffset=5,gpOffsetEdge=[[-gpOffset,-gpOffset],[gpOffset,-gpOffset],[-gpOffset,gpOffset],[gpOffset,gpOffset]];return function(selection,startPoint,endPoint,isPassive){Jedox.wss.grid.FormulaRange.parent.constructor.call(this,selection,startPoint,endPoint);var that=this;var _curHotSpot;for(var htmlEl,clsName="formularRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;if(!isPassive){Jedox.util.addEvent(htmlEl,"mousedown",function(ev){that._onmousedown(ev)},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._onmouseup(ev)},false);Jedox.util.addEvent(htmlEl,"mousemove",function(ev){that._onmousemove(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._onmouseout(ev)},false)}this._container.appendChild(htmlEl)}for(var htmlEl,clsName="formularRangeEdge",i=3;i>=0;--i){htmlEl=this._cornerElems[i]=document.createElement("div");htmlEl.className=clsName;htmlEl.idx=i;this._addCursor(htmlEl,i);if(!isPassive){Jedox.util.addEvent(htmlEl,"mousedown",function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;that._environment.shared.gridPosOffset=gpOffsetEdge[elem.idx];that._mouseOnEdgeDown(ev)},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._environment.shared.gridPosOffset=[0,0];that._mouseOnEdgeUp(ev)},false);Jedox.util.addEvent(htmlEl,"mouseover",function(ev){that._mouseOnEdge(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._mouseOffEdge(ev)},false)}this._container.appendChild(htmlEl)}}})();Jedox.util.extend(Jedox.wss.grid.FormulaRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.FormulaRange;clsRef.prototype._hover=function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;if(this._selection.getMode()==Jedox.wss.range.RangeMode.EDIT||this._status==Jedox.wss.range.AreaStatus.RESIZING||this._status==Jedox.wss.range.AreaStatus.DRAGGING){return}this._setBorderBold();switch(elem.className){case"defaultRangeBorder":_curHotSpot=Jedox.wss.app.ctrlKeyPressed?"7 4":"9 9";if(Jedox.wss.app.browser=="ie"){_curHotSpot=""}elem.style.cursor="".concat("url(/ui/app/res/img/cursors/rng_",Jedox.wss.app.ctrlKeyPressed?"copy":"move",".cur)",_curHotSpot,", default");this._environment.shared.mousePosition="rngBorder";break;case"formularRangeBorder":elem.style.cursor="move";break;case"rangeEdge":_curHotSpot="9 9";if(Jedox.wss.app.browser=="ie"){_curHotSpot=""}elem.style.cursor="".concat("url(/ui/app/res/img/cursors/md_curr",(Jedox.wss.app.ctrlKeyPressed?"_plus":""),".cur)",_curHotSpot,", default");this._environment.shared.mousePosition="magicDot";break}this._status=Jedox.wss.range.AreaStatus.HOVERING};clsRef.prototype._unHover=function(ev){if(document.all){ev=window.event}var elem;if(this._status==Jedox.wss.range.AreaStatus.RESIZING){return}if(ev instanceof Object){elem=document.all?ev.srcElement:ev.target;if(elem.className=="formularRangeBorder"||elem.className=="defaultRangeBorder"){elem.style.cursor="inherit"}}else{for(var i=0;i<this._edgeElems.length;i++){this._edgeElems[i].style.cursor="inherit"}}if(this._status==Jedox.wss.range.AreaStatus.RESIZING||this._status==Jedox.wss.range.AreaStatus.DRAGGING){return}this._setBorder();this._status=Jedox.wss.range.AreaStatus.NORMAL};clsRef.prototype._refreshElement=function(scope,book,nmcX,nmcY){if(!Jedox.wss.app.sourceSel){scope.formulaUpdate()}scope.draw();scope._setMonitorCell(book.getCellByCoords(nmcX,nmcY))};clsRef.prototype._move=function(ev){if(document.all){ev=window.event}if(this._doCC){this._doCC=false;this._doPaste=true;if(ev.ctrlKey){this._selection.copy()}else{this._selection.cut()}}this._environment.shared.autoScroll.checkAndScroll(ev,this._resizeOnScroll,Jedox.wss.grid.scrollType.ALL,null,this);this._selection.setActiveRange(this);if(this._status==Jedox.wss.range.AreaStatus.DRAGGING){var elemCoords=this._environment.shared.lastCellCoords;this._selection.moveTo(elemCoords[0]+this._realCoords[0].getX()-this._monitorCellCoords[0],elemCoords[1]+this._realCoords[0].getY()-this._monitorCellCoords[1])}else{if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this._magicDot.modifyRange(ev)}else{this._resizeRange(ev)}}if(!Jedox.wss.app.sourceSel){this.formulaUpdate()}this.draw();this._setMonitorCell(this._environment.shared.lastCell)};clsRef.prototype.destruct=function(){Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);for(var i=3;i>=0;--i){this._edgeElems[i].parentNode.removeChild(this._edgeElems[i]);this._cornerElems[i].parentNode.removeChild(this._cornerElems[i])}};clsRef.prototype._drawCorners=function(){if(this.formulaToken instanceof Object&&this.formulaToken.nf){return}var colors=this.getColors();var color=colors[(this.formulaToken instanceof Object?this.formulaToken.id:0)%colors.length];var offsets=[];switch(Jedox.wss.app.browser){case"ff":offsets={ul:{x:1,y:1},lr:{x:3,y:4}};break;case"sf":offsets={ul:{x:1,y:1},lr:{x:3,y:4}};break;case"ie":offsets={ul:{x:1,y:1},lr:{x:3,y:4}};break;default:offsets={ul:{x:1,y:1},lr:{x:3,y:4}}}for(var xpos,ypos,i=3,el=this._cornerElems[i];i>=0;el=this._cornerElems[--i]){switch(i){case 0:xpos=this._lrCorner.getX()-offsets.lr.x;ypos=this._lrCorner.getY()-offsets.lr.y;break;case 1:xpos=this._ulCorner.getX()-offsets.ul.x;ypos=this._lrCorner.getY()-offsets.lr.y;break;case 2:xpos=this._lrCorner.getX()-offsets.lr.x;ypos=this._ulCorner.getY()-offsets.ul.y;break;case 3:xpos=this._ulCorner.getX()-offsets.ul.x;ypos=this._ulCorner.getY()-offsets.ul.y;break}el.style.backgroundColor=color;el.style.left="".concat(xpos,"px");el.style.top="".concat(ypos,"px");el.style.display="block"}};clsRef=null;Jedox.wss.grid.CopyRange=(function(){return function(selection,startPoint,endPoint){Jedox.wss.grid.CopyRange.parent.constructor.call(this,selection,startPoint,endPoint);var that=this;for(var htmlEl,clsName="formularRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;this._container.appendChild(htmlEl)}}})();Jedox.util.extend(Jedox.wss.grid.CopyRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.CopyRange;clsRef=null;Jedox.wss.grid.DynarangeRange=(function(){var constants={DIRECTION:{VERT:0,HORIZ:1}},gpOffset=7,gpOffsetBorder=[[0,gpOffset],[0,-gpOffset],[gpOffset,0],[-gpOffset,0]],gpOffsetEdge=[[-gpOffset,-gpOffset],[gpOffset,-gpOffset],[-gpOffset,gpOffset],[gpOffset,gpOffset]];return function(selection,startPoint,endPoint,props){Jedox.wss.grid.DynarangeRange.parent.constructor.call(this,selection,startPoint,endPoint);this._mode=Jedox.wss.range.RangeMode.EDIT;this._props=props;this._propsPrev=(props.wselid==undefined)?null:Ext.ux.clone(props);this._cntrlElems={};this._expDir=props.dir;this.getConstant=function(name){return constants[name]};var that=this;for(var htmlEl,clsName="HBRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;htmlEl.idx=i;Jedox.util.addEvent(htmlEl,"mousedown",function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;if(that.chkRightClick.call(that,ev)){that._environment.shared.gridPosOffset=gpOffsetBorder[elem.idx];that._onmousedown(ev)}},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._environment.shared.gridPosOffset=[0,0];that._onmouseup(ev)},false);Jedox.util.addEvent(htmlEl,"mousemove",function(ev){that._onmousemove(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._onmouseout(ev)},false);this._container.appendChild(htmlEl)}for(var htmlEl,clsName="HBRangeEdge",i=3;i>=0;--i){htmlEl=this._cornerElems[i]=document.createElement("div");htmlEl.className=clsName;htmlEl.idx=i;this._addCursor(htmlEl,i);Jedox.util.addEvent(htmlEl,"mousedown",function(ev){if(document.all){ev=window.event}var elem=document.all?ev.srcElement:ev.target;if(that.chkRightClick.call(that,ev)){that._environment.shared.gridPosOffset=gpOffsetEdge[elem.idx];that._mouseOnEdgeDown(ev)}},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._environment.shared.gridPosOffset=[0,0];that._mouseOnEdgeUp(ev,true)},false);Jedox.util.addEvent(htmlEl,"mouseover",function(ev){that._mouseOnEdge(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._mouseOffEdge(ev)},false);this._container.appendChild(htmlEl)}this._cntrlElems.props=document.createElement("div");this._cntrlElems.props.className="HBProps";Jedox.util.addEvent(this._cntrlElems.props,"mousedown",function(ev){if(that.chkRightClick.call(that,ev)){that._openPropDlg(ev)}},false);Jedox.util.addEvent(this._cntrlElems.props,"mouseover",function(ev){that._propsBtnMouseOver(ev)},false);this._container.appendChild(this._cntrlElems.props);this._cntrlElems.dirArrow=document.createElement("div");this._cntrlElems.dirArrow.id="dirArrowCont";this._cntrlElems.dirArrow.className="HBDirArrCont";Jedox.util.addEvent(this._cntrlElems.dirArrow,"dblclick",function(ev){that._dirSwitchMouseDown(true)},false);Jedox.util.addEvent(this._cntrlElems.dirArrow,"mousedown",function(ev){if(that.chkRightClick.call(that,ev)){that._environment.shared.gridPosOffset=gpOffsetBorder[that._expDir==constants.DIRECTION.VERT?2:0];that._dirArrowMouseDown(ev)}},false);Jedox.util.addEvent(this._cntrlElems.dirArrow,"mouseup",function(ev){that._environment.shared.gridPosOffset=[0,0]},false);Jedox.util.addEvent(this._cntrlElems.dirArrow,"mousemove",function(ev){that._onmousemove(ev)},false);Jedox.util.addEvent(this._cntrlElems.dirArrow,"mouseout",function(ev){that._onmouseout(ev)},false);this._container.appendChild(this._cntrlElems.dirArrow);this._cntrlElems.arrCanvas=new jsGraphics(this._cntrlElems.dirArrow);var selCellCoords=(props.dcell==undefined)?this._environment.shared.selectedCellCoords:[props.src[0]+props.dcell[0],props.src[1]+props.dcell[1]];var dataCellPos=new Jedox.wss.cls.Point(selCellCoords[0],selCellCoords[1]);this._subrange=new Jedox.wss.grid.DynarangeSubSelection(dataCellPos,dataCellPos,this._selection.getBook(),that,startPoint,endPoint);this.draw(false);if(props.wselid==undefined){this.save()}}})();Jedox.util.extend(Jedox.wss.grid.DynarangeRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.DynarangeRange;clsRef.prototype.chkRightClick=function(ev){if(document.all){ev=window.event}if(ev.button==2||(Ext.isMac&&ev.button==0&&Jedox.wss.app.ctrlKeyPressed)){this._selection.setMode(Jedox.wss.range.RangeMode.EDIT);this.showCntxMenu(ev);return false}else{return true}};clsRef.prototype.showCntxMenu=function(ev){var that=this,cntxMenu=new Ext.menu.Menu({id:"HBContextMenu",cls:"default-format-window",enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}},items:[{text:"Switch Direction".localize(),iconCls:"hb_switch_dir",handler:function(item,ev){that._dirSwitchMouseDown.call(that,true)}},{text:"Delete".localize(),iconCls:"icon_delete",handler:function(){Jedox.wss.hb.delDynarange(that._props.id)}},"-",{text:"Properties".localize().concat("..."),iconCls:"hb_properties",handler:function(item,ev){that._openPropDlg.call(that,ev.browserEvent)}}]});cntxMenu.showAt([ev.clientX,ev.clientY])};clsRef.prototype.getOffsetsPx=function(useragent){var offsets=[];switch(useragent){case"ff":offsets=[{left:0,top:-6,width:0,height:0,propsTop:2,propsLeft:3,dirArrTop:-6,dirArrHeight:8},{left:1,top:-2,width:0,height:0},{left:-6,top:0,width:0,height:0,dirArrLeft:-6,dirArrWidth:8},{left:-1,top:0,width:0,height:0}];break;case"sf":offsets=[{left:0,top:-6,width:0,height:0,propsTop:2,propsLeft:3,dirArrTop:-6,dirArrHeight:8},{left:1,top:-2,width:0,height:0},{left:-6,top:0,width:0,height:0,dirArrLeft:-6,dirArrWidth:8},{left:-1,top:0,width:0,height:0}];break;case"ie":offsets=[{left:0,top:-6,width:0,height:0,propsTop:2,propsLeft:3,dirArrTop:-6,dirArrHeight:8},{left:1,top:-2,width:0,height:0},{left:-6,top:0,width:0,height:0,dirArrLeft:-6,dirArrWidth:8},{left:-1,top:0,width:0,height:0}];break;default:offsets=[{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0}];console.warn("Unkown user agent: ",useragent)}return offsets};clsRef.prototype.draw=function(setHdr){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){return}var ulOffset=1,lrOffset=1,pxCoords,book=this._selection.getBook();this._realCoords=this.getCorners();if((this._ulCell=book.getCellByCoords(this._realCoords[0].getX(),this._realCoords[0].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[0].getX(),this._realCoords[0].getY());this._ulCorner.setX(pxCoords[0]-ulOffset);this._ulCorner.setY(pxCoords[1]-ulOffset)}else{this._ulCorner.setX(this._ulCell.offsetLeft-ulOffset);this._ulCorner.setY(this._ulCell.parentNode.offsetTop-ulOffset)}if((this._lrCell=book.getCellByCoords(this._realCoords[1].getX(),this._realCoords[1].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[1].getX()+1,this._realCoords[1].getY()+1);this._lrCorner.setX(pxCoords[0]);this._lrCorner.setY(pxCoords[1]+lrOffset)}else{this._lrCorner.setX(this._lrCell.offsetLeft+this._lrCell.offsetWidth);this._lrCorner.setY(this._lrCell.parentNode.offsetTop+this._lrCell.offsetHeight+lrOffset)}this._drawRect(6);this._setBorder();this._drawCorners();this._drawControls();this._subrange.getActiveRange().updateParentCoords(this._upperLeft,this._lowerRight);if(setHdr==undefined){this._selection._selectionChanged=true;this._selection.checkForUndoneMarkers()}};clsRef.prototype._drawCorners=function(){var offsets=[];switch(Jedox.wss.app.browser){case"ff":offsets=[{xpos:0,ypos:-1},{xpos:6,ypos:-1},{xpos:0,ypos:6},{xpos:6,ypos:6}];break;case"sf":offsets=[{xpos:0,ypos:-1},{xpos:6,ypos:-1},{xpos:0,ypos:6},{xpos:6,ypos:6}];break;case"ie":offsets=[{xpos:0,ypos:-1},{xpos:6,ypos:-1},{xpos:0,ypos:6},{xpos:6,ypos:6}];break;default:offsets=[{xpos:0,ypos:-1},{xpos:6,ypos:-1},{xpos:0,ypos:6},{xpos:6,ypos:6}];console.warn("Unkown user agent: ",useragent)}for(var xpos,ypos,i=3,el=this._cornerElems[i];i>=0;el=this._cornerElems[--i]){switch(i){case 0:xpos=this._lrCorner.getX()+offsets[0].xpos;ypos=this._lrCorner.getY()+offsets[0].ypos;break;case 1:xpos=this._ulCorner.getX()-offsets[1].xpos;ypos=this._lrCorner.getY()+offsets[1].ypos;break;case 2:xpos=this._lrCorner.getX()+offsets[2].xpos;ypos=this._ulCorner.getY()-offsets[2].ypos;break;case 3:xpos=this._ulCorner.getX()-offsets[3].xpos;ypos=this._ulCorner.getY()-offsets[3].ypos;break}el.style.left="".concat(xpos,"px");el.style.top="".concat(ypos,"px");el.style.display="block"}};clsRef.prototype._drawRect=function(brdSize){var offsets=this.getOffsetsPx(Jedox.wss.app.browser);if(brdSize==undefined){brdSize=5}this._edgeElems[0].style.left="".concat(this._ulCorner.getX()+offsets[0].left,"px");this._edgeElems[0].style.top="".concat(this._ulCorner.getY()+offsets[0].top,"px");this._edgeElems[0].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[0].width,"px");this._edgeElems[0].style.height="".concat(brdSize+offsets[0].height,"px");this._edgeElems[0].style.borderBottom="2px solid #000000";this._edgeElems[0].style.display="block";this._edgeElems[1].style.left="".concat(this._ulCorner.getX()+offsets[1].left,"px");this._edgeElems[1].style.top="".concat(this._lrCorner.getY()+offsets[1].top,"px");this._edgeElems[1].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[1].width,"px");this._edgeElems[1].style.height="".concat(brdSize+offsets[1].height,"px");this._edgeElems[1].style.borderTop="2px solid #000000";this._edgeElems[1].style.display="block";this._edgeElems[2].style.left="".concat(this._ulCorner.getX()+offsets[2].left,"px");this._edgeElems[2].style.top="".concat(this._ulCorner.getY()+offsets[2].top,"px");this._edgeElems[2].style.width="".concat(brdSize+offsets[2].width,"px");this._edgeElems[2].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[2].height,"px");this._edgeElems[2].style.borderRight="2px solid #000000";this._edgeElems[2].style.display="block";this._edgeElems[3].style.left="".concat(this._lrCorner.getX()+offsets[3].left,"px");this._edgeElems[3].style.top="".concat(this._ulCorner.getY()+offsets[3].top,"px");this._edgeElems[3].style.width="".concat(brdSize+offsets[3].width,"px");this._edgeElems[3].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[3].height,"px");this._edgeElems[3].style.borderLeft="2px solid #000000";this._edgeElems[3].style.display="block"};clsRef.prototype._drawControls=function(){var offsets=this.getOffsetsPx(Jedox.wss.app.browser);this._cntrlElems.props.style.left="".concat(this._ulCorner.getX()+offsets[0].propsLeft,"px");this._cntrlElems.props.style.top="".concat(this._ulCorner.getY()+offsets[0].propsTop,"px");this._cntrlElems.props.style.display="block";this._drawDirArrow(offsets)};clsRef.prototype._drawDirArrow=function(offsets){if(offsets==undefined){offsets=this.getOffsetsPx(Jedox.wss.app.browser)}if(this._expDir==this.getConstant("DIRECTION").VERT){var dirArrHeight=this._lrCorner.getY()-this._ulCorner.getY()+offsets[2].height;this._cntrlElems.dirArrow.style.left="".concat(this._ulCorner.getX()+offsets[2].dirArrLeft,"px");this._cntrlElems.dirArrow.style.top="".concat(this._ulCorner.getY()+offsets[2].top,"px");this._cntrlElems.dirArrow.style.width="".concat(6+offsets[2].dirArrWidth,"px");this._cntrlElems.dirArrow.style.height="".concat(dirArrHeight,"px");this._cntrlElems.dirArrow.style.display="block";this._cntrlElems.arrCanvas.clear();this._cntrlElems.arrCanvas.setColor("#455B87");this._cntrlElems.arrCanvas.fillRect(4,0,5,dirArrHeight-15);this._cntrlElems.arrCanvas.fillPolygon(new Array(0,12,6),new Array(dirArrHeight-15,dirArrHeight-15,dirArrHeight));this._cntrlElems.arrCanvas.paint()}else{var dirArrWidth=this._lrCorner.getX()-this._ulCorner.getX()+offsets[0].width;this._cntrlElems.dirArrow.style.left="".concat(this._ulCorner.getX()+offsets[0].left,"px");this._cntrlElems.dirArrow.style.top="".concat(this._ulCorner.getY()+offsets[0].dirArrTop,"px");this._cntrlElems.dirArrow.style.width="".concat(dirArrWidth,"px");this._cntrlElems.dirArrow.style.height="".concat(6+offsets[0].dirArrHeight,"px");this._cntrlElems.dirArrow.style.display="block";this._cntrlElems.arrCanvas.clear();this._cntrlElems.arrCanvas.setColor("#455B87");this._cntrlElems.arrCanvas.fillRect(0,4,dirArrWidth-15,5);this._cntrlElems.arrCanvas.fillPolygon(new Array(dirArrWidth-15,dirArrWidth-15,dirArrWidth),new Array(0,12,6));this._cntrlElems.arrCanvas.paint()}};clsRef.prototype._dirSwitchMouseDown=function(doSave){this._expDir=(this._expDir==this.getConstant("DIRECTION").VERT?this.getConstant("DIRECTION").HORIZ:this.getConstant("DIRECTION").VERT);this._drawDirArrow();if(doSave){this.save(false)}};clsRef.prototype._dirArrowMouseDown=function(ev){if(document.all){ev=window.event}var mouseEl=(document.all)?ev.srcElement:ev.target,rngMode=Jedox.wss.range.RangeMode,offsets=[0,0];if(mouseEl.id!="dirArrowCont"){offsets=[mouseEl.offsetLeft,mouseEl.offsetTop];while(mouseEl.id!="dirArrowCont"){mouseEl=mouseEl.parentNode}}if(this._mode==rngMode.NONE){this._selection.setMode(rngMode.EDIT)}Jedox.wss.mouse.calcGridScreenCoords(ev,mouseEl,offsets);this._onmousedown(ev)};clsRef.prototype.switchMode=function(mode){var rngMode=Jedox.wss.range.RangeMode;this._mode=mode;this._subrange.getActiveRange().setMode(mode);switch(mode){case rngMode.NONE:this.setNormalMode();break;case rngMode.EDIT:this.setEditMode();break;case rngMode.HIDDEN:this.setHiddenMode()}};clsRef.prototype.setNormalMode=function(){for(var i=3,el=this._cornerElems[i];i>=0;el=this._cornerElems[--i]){el.style.zIndex="38";el.style.display="none"}for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.zIndex="38";el.style.backgroundImage="none";el.style.backgroundColor="transparent";el.style.display="block"}this._cntrlElems.dirArrow.style.zIndex="40";this._cntrlElems.props.style.zIndex="41";this._cntrlElems.props.style.display="none";this._cntrlElems.dirArrow.style.display="block";this._subrange.getActiveRange().setNormalMode()};clsRef.prototype.setEditMode=function(){for(var i=3,el=this._cornerElems[i];i>=0;el=this._cornerElems[--i]){el.style.zIndex="42";el.style.display="block"}for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.zIndex="42";el.style.backgroundImage="url(/ui/app/res/img/borders/hb_horizontal_normal.gif)";el.style.backgroundColor="#FFFFFF"}this._cntrlElems.dirArrow.style.zIndex="44";this._cntrlElems.props.style.zIndex="45";this._cntrlElems.props.style.display="block";this._subrange.getActiveRange().setEditMode()};clsRef.prototype.setHiddenMode=function(){for(var i=3,el=this._cornerElems[i];i>=0;el=this._cornerElems[--i]){el.style.display="none"}for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.display="none"}this._cntrlElems.props.style.display="none";this._cntrlElems.dirArrow.style.display="none";this._subrange.getActiveRange().setHiddenMode()};clsRef.prototype._getColorNumber=function(){return"hb"};clsRef.prototype.getProps=function(){this._props.src=[this._upperLeft.getX(),this._upperLeft.getY(),this._lowerRight.getX(),this._lowerRight.getY()];this._props.dir=this._expDir;this._props.dcell=this._subrange.getActiveRange().getPosInParent();return this._props};clsRef.prototype.setProps=function(props){if(props.dir!=this._expDir){this._dirSwitchMouseDown(false)}this._props=props;this._subrange.getActiveRange()._drawDataCell();this.save(true)};clsRef.prototype.getId=function(){return this._props.id};clsRef.prototype._mouseOnEdgeUp=function(ev){Jedox.wss.app.mimicOvertracking=false;this._legacyMouseUp();this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this.save(false)};clsRef.prototype._onmouseup=function(ev){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this.afterExpanding()}this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this._legacyMouseUp();this.save(false)};clsRef.prototype._openPropDlg=function(ev){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.insertDynarange,[this.getProps()]);if(document.all){window.event.returnValue=false;window.event.cancelBubble=true}else{ev.preventDefault();ev.stopPropagation()}};clsRef.prototype._propsBtnMouseOver=function(ev){var coords=Jedox.wss.mouse.getGridPos((document.all)?window.event:ev);Jedox.wss.mouse.mimicCellMouseEvent(coords[0],coords[1],"mouseover")};clsRef.prototype.remove=function(perm){this._subrange.remove();for(var i=3;i>=0;--i){this._container.removeChild(this._edgeElems[i])}for(var i=3;i>=0;--i){this._container.removeChild(this._cornerElems[i])}this._container.removeChild(this._cntrlElems.props);this._container.removeChild(this._cntrlElems.dirArrow);if(perm){var activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,rngClearType=Jedox.wss.range.ContentType,dcellX=this._props.src[0]+this._props.dcell[0],dcellY=this._props.src[1]+this._props.dcell[1],ngetRes=conn.cmd(0,["nget"],[[1,1,this._props.id,this._selection.getBook().getSheetSelector().getActiveSheetId()]])[0];conn.createBatch();conn.cmd(0,["wdel"],["",[this._props.wselid]]);if(ngetRes[0]){conn.cmd(0,["ndel"],[ngetRes[1][0].uuid])}activeBook.clrRange([dcellX,dcellY,dcellX,dcellY],rngClearType.FORMULA|rngClearType.ATTRS);conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange(),false,false)}};clsRef.prototype.save=function(force){var props=this.getProps(),prevVal=this._props._preview_val;function propsChanged(prev,curr){return(!prev.src.compare(curr.src)||prev.dir!=curr.dir||!prev.dcell.compare(curr.dcell))}var propsClone=Ext.ux.clone(props),id=propsClone.id,_gendata=propsClone._gendata,activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,that=this,dcellX=props.src[0]+props.dcell[0],dcellY=props.src[1]+props.dcell[1],numToLet=Jedox.wss.app.numberToLetter,nLoc="=$".concat(numToLet[this._upperLeft.getX()],"$",this._upperLeft.getY(),":$",numToLet[this._lowerRight.getX()],"$",this._lowerRight.getY());delete propsClone.id;delete propsClone._gendata;if(!("wselid" in props)){var updWSElId=function(res){if(res[0][0]&&res[0][1].length){that._props.wselid=res[0][1][0]}};conn.createBatch();conn.cmd(0,["wadd"],["",{e_type:"hb",id:id,hbdata:propsClone,_gendata:_gendata,n_location:nLoc,pos_offsets:[0,0,0,0]}]);conn.cmd(0,["nadd"],[[1,1,{name:this._props.id,refers_to:'="'.concat(prevVal,'"'),scope:this._selection.getBook().getSheetSelector().getActiveSheetName(),comment:"Managed by DynaRange ".concat(this._props.id)}]]);conn.cmd(0,["cdrn",{cm:true}],[[dcellX,dcellY,dcellX,dcellY,{v:prevVal,a:{palo_pe:{type:"dim",name:props._gendata[0][2]}}}]]);conn.sendBatch([activeBook,activeBook.exec,[this,updWSElId]],activeBook.getRealGridRange(),false,false)}else{if(force==undefined||force||propsChanged(this._propsPrev,props)){var updObj={},prevDcellX=this._propsPrev.src[0]+this._propsPrev.dcell[0],prevDcellY=this._propsPrev.src[1]+this._propsPrev.dcell[1];delete propsClone.wselid;updObj[props.wselid]={id:id,hbdata:propsClone,_gendata:_gendata,n_location:nLoc,pos_offsets:[0,0,0,0]};conn.createBatch();conn.cmd(0,["wupd"],["",updObj]);if(dcellX!=prevDcellX||dcellY!=prevDcellY||prevVal!=this._propsPrev._preview_val||props._gendata[0][2]!=this._propsPrev._gendata[0][2]){var rngClearType=Jedox.wss.range.ContentType;activeBook.clrRange([prevDcellX,prevDcellY,prevDcellX,prevDcellY],rngClearType.FORMULA|rngClearType.ATTRS);conn.cmd(0,["cdrn",{cm:true}],[[dcellX,dcellY,dcellX,dcellY,{v:prevVal,a:{palo_pe:{type:"dim",name:props._gendata[0][2]}}}]])}conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange(),false,false)}}this._propsPrev=Ext.ux.clone(props)};clsRef.prototype.move=function(pos){this._upperLeft.setX(pos[0]);this._upperLeft.setY(pos[1]);this._lowerRight.setX(pos[2]);this._lowerRight.setY(pos[3]);this.save(false)};clsRef=null;Jedox.wss.grid.DynarangeSubRange=(function(){return function(parent,selection,startPoint,endPoint,parentStartPoint,parentEndPoint){Jedox.wss.grid.DynarangeSubRange.parent.constructor.call(this,selection,startPoint,endPoint);this._parent=parent;this._parentStartPoint=parentStartPoint.clone();this._parentEndPoint=parentEndPoint.clone();this._cntrlElems={};this._mode=Jedox.wss.range.RangeMode.EDIT;this.parentOffset={top:this._upperLeft.getY()-parentStartPoint.getY(),left:this._upperLeft.getX()-parentStartPoint.getX()};var that=this;for(var htmlEl,clsName="HBSubRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;Jedox.util.addEvent(htmlEl,"mousedown",function(ev){if(parent.chkRightClick.call(parent,ev)){that._onmousedown(ev)}},false);Jedox.util.addEvent(htmlEl,"mouseup",function(ev){that._onmouseup(ev);parent.save(false)},false);Jedox.util.addEvent(htmlEl,"mousemove",function(ev){that._onmousemove(ev)},false);Jedox.util.addEvent(htmlEl,"mouseout",function(ev){that._onmouseout(ev)},false);this._container.appendChild(htmlEl)}this._cntrlElems.list=document.createElement("div");this._cntrlElems.list.className="HBSubList";Jedox.util.addEvent(this._cntrlElems.list,"mousedown",function(ev){if(parent.chkRightClick.call(parent,ev)){that._openListDlg(ev)}},false);Jedox.util.addEvent(this._cntrlElems.list,"mouseover",function(ev){that._listBtnMouseOver(ev)},false);this._container.appendChild(this._cntrlElems.list);this._dataCell=document.createElement("div");this._dataCell.className="HBSubDataCell";Jedox.util.addEvent(this._dataCell,"mousedown",function(ev){if(parent.chkRightClick.call(parent,ev)){that._dataCellMouseDown(ev)}},false);Jedox.util.addEvent(this._dataCell,"mouseover",function(ev){that._dataCellMouseOver(ev)},false);this._container.appendChild(this._dataCell);this.draw()}})();Jedox.util.extend(Jedox.wss.grid.DynarangeSubRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.DynarangeSubRange;clsRef.prototype.getOffsetsPx=function(useragent){var offsets=[];switch(useragent){case"ff":offsets=[{left:-5,top:-6,width:6,height:0,listTop:2,listLeftWhenRight:0,listLeftWhenLeft:1},{left:-5,top:0,width:6,height:0},{left:-5,top:0,width:0,height:0},{left:1,top:-6,width:0,height:12}];break;case"sf":offsets=[{left:-5,top:-6,width:6,height:0,listTop:2,listLeftWhenRight:0,listLeftWhenLeft:1},{left:-5,top:0,width:6,height:0},{left:-5,top:0,width:0,height:0},{left:1,top:-6,width:0,height:12}];break;case"ie":offsets=[{left:-5,top:-6,width:6,height:0,listTop:2,listLeftWhenRight:0,listLeftWhenLeft:1},{left:-5,top:0,width:6,height:0},{left:-5,top:0,width:0,height:0},{left:1,top:-6,width:0,height:12}];break;default:offsets=[{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0}];console.warn("Unkown user agent: ",useragent)}return offsets};clsRef.prototype.draw=function(){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){return}var ulOffset=1,lrOffset=1,pxCoords,book=this._selection.getBook();this._realCoords=this.getCorners();if((this._ulCell=book.getCellByCoords(this._realCoords[0].getX(),this._realCoords[0].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[0].getX(),this._realCoords[0].getY());this._ulCorner.setX(pxCoords[0]-ulOffset);this._ulCorner.setY(pxCoords[1]-ulOffset)}else{this._ulCorner.setX(this._ulCell.offsetLeft-ulOffset);this._ulCorner.setY(this._ulCell.parentNode.offsetTop-ulOffset)}if((this._lrCell=book.getCellByCoords(this._realCoords[1].getX(),this._realCoords[1].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[1].getX()+1,this._realCoords[1].getY()+1);this._lrCorner.setX(pxCoords[0]);this._lrCorner.setY(pxCoords[1]+lrOffset)}else{this._lrCorner.setX(this._lrCell.offsetLeft+this._lrCell.offsetWidth);this._lrCorner.setY(this._lrCell.parentNode.offsetTop+this._lrCell.offsetHeight+lrOffset)}this._drawRect(6);this._setBorder();this._drawControls();this._drawDataCell()};clsRef.prototype._drawRect=function(brdSize){var offsets=this.getOffsetsPx(Jedox.wss.app.browser);if(brdSize==undefined){brdSize=5}this._edgeElems[0].style.left="".concat(this._ulCorner.getX()+offsets[0].left,"px");this._edgeElems[0].style.top="".concat(this._ulCorner.getY()+offsets[0].top,"px");this._edgeElems[0].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[0].width,"px");this._edgeElems[0].style.height="".concat(brdSize+offsets[0].height,"px");this._edgeElems[0].style.display="block";this._edgeElems[1].style.left="".concat(this._ulCorner.getX()+offsets[1].left,"px");this._edgeElems[1].style.top="".concat(this._lrCorner.getY()+offsets[1].top,"px");this._edgeElems[1].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[1].width,"px");this._edgeElems[1].style.height="".concat(brdSize+offsets[1].height,"px");this._edgeElems[1].style.display="block";this._edgeElems[2].style.left="".concat(this._ulCorner.getX()+offsets[2].left,"px");this._edgeElems[2].style.top="".concat(this._ulCorner.getY()+offsets[2].top,"px");this._edgeElems[2].style.width="".concat(brdSize+offsets[2].width,"px");this._edgeElems[2].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[2].height,"px");this._edgeElems[2].style.display="block";this._edgeElems[3].style.left="".concat(this._lrCorner.getX()+offsets[3].left,"px");this._edgeElems[3].style.top="".concat(this._ulCorner.getY()+offsets[3].top,"px");this._edgeElems[3].style.width="".concat(brdSize+offsets[3].width,"px");this._edgeElems[3].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[3].height,"px");this._edgeElems[3].style.display="block"};clsRef.prototype.updateParentCoords=function(startPoint,endPoint){this._parentStartPoint=startPoint.clone();this._parentEndPoint=endPoint.clone();if(this._parentStartPoint.getX()+this.parentOffset.left>this._parentEndPoint.getX()){this._upperLeft.setX(this._parentEndPoint.getX());this.parentOffset.left=this._parentEndPoint.getX()-this._parentStartPoint.getX()}else{this._upperLeft.setX(this._parentStartPoint.getX()+this.parentOffset.left)}if(this._parentStartPoint.getY()+this.parentOffset.top>this._parentEndPoint.getY()){this._upperLeft.setY(this._parentEndPoint.getY());this.parentOffset.top=this._parentEndPoint.getY()-this._parentStartPoint.getY()}else{this._upperLeft.setY(this._parentStartPoint.getY()+this.parentOffset.top)}this._lowerRight=this._upperLeft.clone();this.draw()};clsRef.prototype._drawControls=function(){var offsets=this.getOffsetsPx(Jedox.wss.app.browser),cntrlStyle=this._cntrlElems.list.style,cntrlWidth=19;if(this._parentStartPoint.getX()==this._parentEndPoint.getX()){cntrlStyle.left="".concat(this._lrCorner.getX()-cntrlWidth+offsets[0].listLeftWhenRight,"px")}else{if(this._parentEndPoint.getX()==this._lowerRight.getX()){cntrlStyle.left="".concat(this._ulCorner.getX()-cntrlWidth+offsets[0].listLeftWhenLeft,"px")}else{cntrlStyle.left="".concat(this._lrCorner.getX()+offsets[0].listLeftWhenRight,"px")}}cntrlStyle.top="".concat(this._ulCorner.getY()+offsets[0].listTop,"px");cntrlStyle.display="block"};clsRef.prototype._drawDataCell=function(){var viewMode=Jedox.wss.grid.viewMode,offsets=(Jedox.wss.app.environment.viewMode==viewMode.DESIGNER)?{t:0,l:0,w:-2,h:-4}:{t:-1,l:-1,w:-7,h:-6},book=this._selection.getBook(),refCell=book.getCellByCoords(this._upperLeft.getX(),this._upperLeft.getY());if(!refCell){var refCellUL=book.getPixelsByCoords(this._upperLeft.getX(),this._upperLeft.getY()),refCellWH=book.getCellDims(this._upperLeft.getX(),this._upperLeft.getY())}this._dataCell.style.left=(refCell?refCell.offsetLeft:refCellUL[0])+offsets.l+"px";this._dataCell.style.top=(refCell?refCell.parentNode.offsetTop:refCellUL[1])+offsets.t+"px";this._dataCell.style.width=(refCell?refCell.offsetWidth:refCellWH[0]+1)+offsets.w+"px";this._dataCell.style.height=(refCell?refCell.offsetHeight:refCellWH[1]+1)+offsets.h+"px";var dataCellContent="{".concat(this._parent._props._gendata[0][2],"}");Jedox.util.setText(this._dataCell,dataCellContent);if(refCell){Jedox.wss.style.cellTransfer(this._dataCell,refCell)}this._dataCell.style.fontSize="8pt";this._dataCell.style.textAlign="center";if(this._dataCell.style.backgroundColor==""){this._dataCell.style.backgroundColor="#ffffff"}this._dataCell.style.display="block"};clsRef.prototype.switchMode=function(mode){};clsRef.prototype.setNormalMode=function(){for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.zIndex="37";el.style.display="none"}this._dataCell.style.zIndex="39";this._cntrlElems.list.style.zIndex="40";this._cntrlElems.list.style.display="none";this._dataCell.style.display="block"};clsRef.prototype.setEditMode=function(){for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.zIndex="41";el.style.display="block"}this._dataCell.style.zIndex="43";this._cntrlElems.list.style.zIndex="44";this._cntrlElems.list.style.display="block"};clsRef.prototype.setHiddenMode=function(){for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.display="none"}this._cntrlElems.list.style.display="none";this._dataCell.style.display="none"};clsRef.prototype._getColorNumber=function(){return"hbsub"};clsRef.prototype.getPosInParent=function(){return[this.parentOffset.left,this.parentOffset.top]};clsRef.prototype._openListDlg=function(ev){var props=this._parent.getProps();if(props._gendata[0][0]==-1){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.insertDynarange,[props])}else{Jedox.wss.palo.utils.openSubsetEditor({mode:1,dynarange:props})}if(document.all){window.event.returnValue=false;window.event.cancelBubble=true}else{ev.preventDefault();ev.stopPropagation()}};clsRef.prototype.setMode=function(mode){this._mode=mode};clsRef.prototype._dataCellMouseDown=function(ev){var env=this._environment.shared,gridMode=Jedox.wss.grid.GridMode,value=env.inputField.value;if((env.inputMode==gridMode.EDIT||env.inputMode==gridMode.INPUT)&&(value.length>0)&&(value.substr(0,1)=="=")){Jedox.wss.mouse.mimicCellMouseEvent(this._upperLeft.getX(),this._upperLeft.getY(),"mousedown");return}var rngMode=Jedox.wss.range.RangeMode;if(this._mode==rngMode.NONE){this._parent._selection.setMode(rngMode.EDIT)}};clsRef.prototype._dataCellMouseOver=function(){var env=this._environment.shared,x=this._upperLeft.getX(),y=this._upperLeft.getY();env.lastCell=Jedox.wss.app.activeBook.getCellByCoords(x,y);env.lastCellCoords=[x,y]};clsRef.prototype._onmousedown=function(ev){var that=this;if(document.all){ev=window.event}this._status=Jedox.wss.range.AreaStatus.DRAGGING;Jedox.wss.app.mimicOvertracking=(Ext.isGecko3&&ev.button==0);this._setMonitorCell(this._environment.shared.lastCell,(document.all)?ev.srcElement:ev.target);Jedox.wss.app.mouseMovementObserver.subscribe(this._move,this);Jedox.wss.app.mouseUpObserver.subscribe(this._onmouseup,this);this._selection.activeToken=this.formulaToken};clsRef.prototype._onmouseup=function(ev){Jedox.wss.app.mimicOvertracking=false;if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this.afterExpanding()}this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this._legacyMouseUp();this._parent.save(false)};clsRef.prototype._move=function(ev){if(document.all){ev=window.event}this._environment.shared.autoScroll.checkAndScroll(ev,this._resizeOnScroll,Jedox.wss.grid.scrollType.ALL,null,this);this._selection.setActiveRange(this);if(this._status==Jedox.wss.range.AreaStatus.DRAGGING){var elemCoords=this._environment.shared.lastCellCoords,newX=elemCoords[0]+this._realCoords[0].getX()-this._monitorCellCoords[0],newY=elemCoords[1]+this._realCoords[0].getY()-this._monitorCellCoords[1];if(newX>=this._parentStartPoint.getX()&&newX<=this._parentEndPoint.getX()&&newY>=this._parentStartPoint.getY()&&newY<=this._parentEndPoint.getY()){this._selection.moveTo(newX,newY);this.parentOffset.left=newX-this._parentStartPoint.getX();this.parentOffset.top=newY-this._parentStartPoint.getY()}}this.draw();this._setMonitorCell(this._environment.shared.lastCell)};clsRef.prototype._listBtnMouseOver=function(ev){var coords=Jedox.wss.mouse.getGridPos((document.all)?window.event:ev);Jedox.wss.mouse.mimicCellMouseEvent(coords[0],coords[1],"mouseover")};clsRef.prototype.remove=function(){for(var i=3;i>=0;--i){this._container.removeChild(this._edgeElems[i])}this._container.removeChild(this._cntrlElems.list);this._container.removeChild(this._dataCell)};clsRef=null;Jedox.wss.grid.FillRange=(function(){return function(selection,startPoint,endPoint){Jedox.wss.grid.FillRange.parent.constructor.call(this,selection,startPoint,endPoint);this._active=false;this._direction=Jedox.wss.grid.ScrollDirection.NONE;this._dmActive=false;var that=this;for(var htmlEl,clsName="fillRangeBorder",i=3;i>=0;--i){htmlEl=this._edgeElems[i]=document.createElement("div");htmlEl.className=clsName;this._container.appendChild(htmlEl)}this._delMarker=document.createElement("div");this._delMarker.className="fillDelMarker";this._container.appendChild(this._delMarker)}})();Jedox.util.extend(Jedox.wss.grid.FillRange,Jedox.wss.grid.Range);clsRef=Jedox.wss.grid.FillRange;clsRef.prototype.getOffsetsPx=function(useragent){var offsets=[];switch(useragent){case"ff":offsets=[{left:0,top:0,width:-1,height:0},{left:0,top:-2,width:2,height:0},{left:0,top:0,width:0,height:0},{left:-1,top:0,width:0,height:0}];break;case"sf":offsets=[{left:0,top:0,width:-1,height:0},{left:0,top:-2,width:2,height:0},{left:0,top:0,width:0,height:0},{left:-1,top:0,width:0,height:0}];break;case"ie":offsets=[{left:0,top:0,width:-1,height:0},{left:0,top:-2,width:2,height:0},{left:0,top:0,width:0,height:0},{left:-1,top:0,width:0,height:0}];break;default:offsets=[{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0},{left:0,top:0,width:0,height:0}];console.warn("Unkown user agent: ",useragent)}return offsets};clsRef.prototype.draw=function(){if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){return}var ulOffset=1,lrOffset=1,pxCoords,book=this._selection.getBook();this._realCoords=this.getCorners();if((this._ulCell=book.getCellByCoords(this._realCoords[0].getX(),this._realCoords[0].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[0].getX(),this._realCoords[0].getY());this._ulCorner.setX(pxCoords[0]-ulOffset);this._ulCorner.setY(pxCoords[1]-ulOffset)}else{this._ulCorner.setX(this._ulCell.offsetLeft-ulOffset);this._ulCorner.setY(this._ulCell.parentNode.offsetTop-ulOffset)}if((this._lrCell=book.getCellByCoords(this._realCoords[1].getX(),this._realCoords[1].getY()))==undefined){pxCoords=book.getPixelsByCoords(this._realCoords[1].getX()+1,this._realCoords[1].getY()+1);this._lrCorner.setX(pxCoords[0]);this._lrCorner.setY(pxCoords[1]+lrOffset)}else{this._lrCorner.setX(this._lrCell.offsetLeft+this._lrCell.offsetWidth);this._lrCorner.setY(this._lrCell.parentNode.offsetTop+this._lrCell.offsetHeight+lrOffset)}this._drawRect(3);this._setBorder()};clsRef.prototype._drawRect=function(brdSize){var offsets=this.getOffsetsPx(Jedox.wss.app.browser);if(brdSize==undefined){brdSize=5}this._edgeElems[0].style.left="".concat(this._ulCorner.getX()+offsets[0].left,"px");this._edgeElems[0].style.top="".concat(this._ulCorner.getY()+offsets[0].top,"px");this._edgeElems[0].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[0].width,"px");this._edgeElems[0].style.height="".concat(brdSize+offsets[0].height,"px");this._edgeElems[0].style.display="block";this._edgeElems[1].style.left="".concat(this._ulCorner.getX()+offsets[1].left,"px");this._edgeElems[1].style.top="".concat(this._lrCorner.getY()+offsets[1].top,"px");this._edgeElems[1].style.width="".concat(this._lrCorner.getX()-this._ulCorner.getX()+offsets[1].width,"px");this._edgeElems[1].style.height="".concat(brdSize+offsets[1].height,"px");this._edgeElems[1].style.display="block";this._edgeElems[2].style.left="".concat(this._ulCorner.getX()+offsets[2].left,"px");this._edgeElems[2].style.top="".concat(this._ulCorner.getY()+offsets[2].top,"px");this._edgeElems[2].style.width="".concat(brdSize+offsets[2].width,"px");this._edgeElems[2].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[2].height,"px");this._edgeElems[2].style.display="block";this._edgeElems[3].style.left="".concat(this._lrCorner.getX()+offsets[3].left,"px");this._edgeElems[3].style.top="".concat(this._ulCorner.getY()+offsets[3].top,"px");this._edgeElems[3].style.width="".concat(brdSize+offsets[3].width,"px");this._edgeElems[3].style.height="".concat(this._lrCorner.getY()-this._ulCorner.getY()+offsets[3].height,"px");this._edgeElems[3].style.display="block"};clsRef.prototype.activate=function(defSelCoords){this._upperLeft=defSelCoords.ul;this._initUpperLeft=this._upperLeft.clone();this._lowerRight=defSelCoords.lr;this._initLowerRight=this._lowerRight.clone();this._ulCorner=defSelCoords.ulPx;this._lrCorner=defSelCoords.lrPx;this._mdLRCornerPx=defSelCoords.mdLRCornerPx;this._lrCell=this._selection.getBook().getCellByCoords(this._lowerRight.getX(),this._lowerRight.getY());this.setStartCoords();this.registerForMouseMovement(this._environment.shared.lastCell)};clsRef.prototype._diffRanges=function(ulA,lrA,ulB,lrB){if(ulA.equals(ulB)&&lrA.equals(lrB)){return[ulA.getX(),ulA.getY(),lrA.getX(),lrA.getY()]}if(lrB.getY()>lrA.getY()){return[ulA.getX(),lrA.getY()+1,lrB.getX(),lrB.getY()]}if(ulB.getY()<ulA.getY()){return[ulB.getX(),ulB.getY(),lrB.getX(),ulA.getY()-1]}if(lrB.getX()>lrA.getX()){return[lrA.getX()+1,ulA.getY(),lrB.getX(),lrB.getY()]}if(ulA.getX()>ulB.getX()){return[ulB.getX(),ulB.getY(),ulA.getX()-1,lrB.getY()]}return[]};clsRef.prototype.deactivate=function(){if(this._active){for(var i=3,el=this._edgeElems[i];i>=0;el=this._edgeElems[--i]){el.style.display="none"}this._active=false;this._direction=Jedox.wss.grid.ScrollDirection.NONE;var dmActive=this._dmActive;if(!dmActive&&this._upperLeft.equals(this._initUpperLeft)&&this._lowerRight.equals(this._initLowerRight)){return}this._unsetDelMarker();var defSel=this._environment.shared.defaultSelection;if(dmActive){var defSelCoords=this._diffRanges(this._dmUpperLeft,this._dmLowerRight,this._initUpperLeft,this._initLowerRight);defSel.set(new Jedox.wss.cls.Point(defSelCoords[0],defSelCoords[1]),new Jedox.wss.cls.Point(defSelCoords[2],defSelCoords[3]))}else{defSel.set(this._upperLeft,this._lowerRight)}defSel.draw();if(dmActive){this._selection.getBook().clrRange([this._dmUpperLeft.getX(),this._dmUpperLeft.getY(),this._dmLowerRight.getX(),this._dmLowerRight.getY()])}else{this._selection.getBook().pasteRange(null,this._diffRanges(this._initUpperLeft,this._initLowerRight,this._upperLeft,this._lowerRight),Jedox.wss.backend.conn.cmd(0,["cfrn"],[[this._initUpperLeft.getX(),this._initUpperLeft.getY(),this._initLowerRight.getX(),this._initLowerRight.getY()]])[0][1][0])}}};clsRef.prototype._move=function(ev){if(document.all){ev=window.event}var gridScreenCoords=this._environment.shared.gridScreenCoords;if(ev.clientX<=gridScreenCoords[0][0]||ev.clientX>=gridScreenCoords[1][0]||ev.clientY<=gridScreenCoords[0][1]||ev.clientY>=gridScreenCoords[1][1]){return false}this._environment.shared.autoScroll.checkAndScroll(ev,this._resizeOnScroll,Jedox.wss.grid.scrollType.ALL,null,this);this._selection.setActiveRange(this);try{this._resizeRange(ev);if(this._active){this.draw();this._setMonitorCell(this._environment.shared.lastCell)}}catch(e){}};clsRef.prototype._onmouseup=function(ev){Jedox.wss.app.mimicOvertracking=false;if(this._status==Jedox.wss.range.AreaStatus.EXPANDING){this.afterExpanding()}this._status=Jedox.wss.range.AreaStatus.HOVERING;Jedox.wss.app.mouseMovementObserver.unsubscribe(this._move);Jedox.wss.app.mouseUpObserver.unsubscribe(this._onmouseup);this._unHover(ev);this._resizeDirection=Jedox.wss.range.ResizeDirection.NONE;this.deactivate()};clsRef.prototype._getPixelCoords=function(el){var viewportPos=this._selection.getBook().getViewportPos(),gridScreenCoords=this._environment.shared.gridScreenCoords,elLeft=el.offsetLeft-viewportPos[0][0]+gridScreenCoords[0][0],elTop=el.parentNode.offsetTop-viewportPos[0][1]+gridScreenCoords[0][1];return[new Jedox.wss.cls.Point(elLeft,elTop),new Jedox.wss.cls.Point(elLeft+el.offsetWidth,elTop+el.offsetHeight)]};clsRef.prototype._getNeighbourCells=function(cellHtmlEl){var defMaxCoords=Jedox.wss.grid.defMaxCoords,book=this._selection.getBook(),cellCoords=book.getCoordsByCell(cellHtmlEl);if(cellCoords==undefined){return null}var x=cellCoords[0],y=cellCoords[1];return{NW:(x==1||y==1)?null:book.getCellByCoords(x-1,y-1),N:(y==1)?null:book.getCellByCoords(x,y-1),NE:(x==defMaxCoords[0]||y==1)?null:book.getCellByCoords(x+1,y-1),W:(x==1)?null:book.getCellByCoords(x-1,y),X:cellHtmlEl,E:(x==defMaxCoords[0])?null:book.getCellByCoords(x+1,y),SW:(x==1||y==defMaxCoords[1])?null:book.getCellByCoords(x-1,y+1),S:(y==defMaxCoords[1])?null:book.getCellByCoords(x,y+1),SE:(x==defMaxCoords[0]||y==defMaxCoords[1])?null:book.getCellByCoords(x+1,y+1)}};clsRef.prototype._getMonitorArea=function(ev,cellArea,cursorCellCoords){var gridScreenCoords=this._environment.shared.gridScreenCoords,scrollDir=Jedox.wss.grid.ScrollDirection,book=this._selection.getBook(),refEl=cellArea.X,x,y,monArea=[];switch(this._direction){case scrollDir.NONE:var refEl=(this._initUpperLeft.getX()==1||this._initUpperLeft.getX()!=this._initLowerRight.getX())?cellArea.X:cellArea.W,refElPxCoords=this._getPixelCoords(refEl);x=this._initUpperLeft.getX()==1?refElPxCoords[0].getX():Math.floor(refElPxCoords[1].getX()-refEl.offsetWidth/2);y=Math.floor(refElPxCoords[1].getY()-refEl.offsetHeight/2);break;case scrollDir.UP:case scrollDir.DOWN:if(this._dmActive){var refElX=cellArea.X;if(this._initUpperLeft.getX()==1){var lastRefElX=book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()),lastRefElXPx=this._getPixelCoords(lastRefElX)[0].getX()}else{var lastRefElX=book.getCellByCoords(this._initUpperLeft.getX()-1,this._initUpperLeft.getY()),lastRefElXPx=Math.floor(this._getPixelCoords(lastRefElX)[1].getX()-lastRefElX.offsetWidth/2)}x=Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2);var delX=Math.floor(this._mdLRCornerPx.getX()-Math.abs(ev.clientY-this._mdLRCornerPx.getY()));x=(x<delX)?x:(delX>lastRefElXPx?delX:lastRefElXPx)}else{if(cursorCellCoords[1]==this._initLowerRight.getY()){var refElX=this._initUpperLeft.getX()!=this._initLowerRight.getX()?cellArea.X:cellArea.W;x=Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2)}else{if(cursorCellCoords[1]>this._initLowerRight.getY()){var refElXLLPx=this._getPixelCoords(book.getCellByCoords(this._initUpperLeft.getX(),this._initLowerRight.getY()));if(this._initUpperLeft.getX()==1){var incRefElX=book.getCellByCoords(this._initUpperLeft.getX(),this._initLowerRight.getY()),incRefElXPx=this._getPixelCoords(incRefElX)[0].getX()}else{var incRefElX=book.getCellByCoords(this._initUpperLeft.getX()-1,this._initLowerRight.getY()),incRefElXPx=Math.floor(this._getPixelCoords(incRefElX)[1].getX()-incRefElX.offsetWidth/2)}x=refElXLLPx[0].getX()-Math.abs(ev.clientY-refElXLLPx[1].getY());x=(x<incRefElXPx)?x:incRefElXPx}else{var refElXULPx=this._getPixelCoords(book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()));if(this._initUpperLeft.getX()==1){var incRefElX=book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()),incRefElXPx=this._getPixelCoords(incRefElX)[0].getX()}else{var incRefElX=book.getCellByCoords(this._initUpperLeft.getX()-1,this._initUpperLeft.getY()),incRefElXPx=Math.floor(this._getPixelCoords(incRefElX)[1].getX()-incRefElX.offsetWidth/2)}x=refElXULPx[0].getX()-Math.abs(ev.clientY-refElXULPx[0].getY());x=(x<incRefElXPx)?x:incRefElXPx}}}var firstCol=this._initUpperLeft.getX()==1,refElY=cursorCellCoords[1]<this._initLowerRight.getY()||(cursorCellCoords[1]==this._initLowerRight.getY()&&this._dmActive)?cellArea[firstCol?"N":"NW"]:cellArea[firstCol?"X":"W"];y=(refElY==null)?gridScreenCoords[0][1]:Math.floor(this._getPixelCoords(refElY)[1].getY()-refElY.offsetHeight/2);break;case scrollDir.RIGHT:case scrollDir.LEFT:var refElX=(cursorCellCoords[0]<this._initLowerRight.getX())||(cursorCellCoords[0]>=this._initLowerRight.getX()&&this._dmActive)?cellArea.W:cellArea.X;x=(refElX==null)?gridScreenCoords[0][0]:Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2);if(this._dmActive){var refElY=cellArea.X;y=Math.floor(this._getPixelCoords(refElY)[1].getY()-refElY.offsetHeight/2);var delY=Math.floor(this._mdLRCornerPx.getY()-Math.abs(ev.clientX-this._mdLRCornerPx.getX()));y=(y<delY)?y:delY}else{if(cursorCellCoords[0]==this._initLowerRight.getX()){var refElY=cellArea.X;y=Math.floor(this._getPixelCoords(refElY)[1].getY()-refElY.offsetHeight/2)}else{if(cursorCellCoords[0]>this._initLowerRight.getX()){var refElYURPx=this._getPixelCoords(book.getCellByCoords(this._initLowerRight.getX(),this._initUpperLeft.getY()));if(this._initUpperLeft.getY()==1){var incRefElY=book.getCellByCoords(this._initLowerRight.getX(),this._initUpperLeft.getY()),incRefElYPx=this._getPixelCoords(incRefElY)[0].getY()}else{var incRefElY=book.getCellByCoords(this._initLowerRight.getX(),this._initUpperLeft.getY()-1),incRefElYPx=Math.floor(this._getPixelCoords(incRefElY)[1].getY()-incRefElY.offsetHeight/2)}y=refElYURPx[0].getY()-Math.abs(ev.clientX-refElYURPx[1].getX());y=(y<incRefElYPx)?y:incRefElYPx}else{var refElYULPx=this._getPixelCoords(book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()));if(this._initUpperLeft.getY()==1){var incRefElY=book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()),incRefElYPx=this._getPixelCoords(incRefElY)[0].getY()}else{var incRefElY=book.getCellByCoords(this._initUpperLeft.getX(),this._initUpperLeft.getY()-1),incRefElYPx=Math.floor(this._getPixelCoords(incRefElY)[1].getY()-incRefElY.offsetHeight/2)}y=refElYULPx[0].getY()-Math.abs(ev.clientX-refElYULPx[0].getX());y=(y<incRefElYPx)?y:incRefElYPx}}}break}monArea.push(new Jedox.wss.cls.Point(x,y));switch(this._direction){case scrollDir.NONE:var refEl=cellArea.SE;refElPxCoords=this._getPixelCoords(refEl);x=Math.floor(refElPxCoords[1].getX()-refEl.offsetWidth/2);y=Math.floor(refElPxCoords[1].getY()-refEl.offsetHeight/2);break;case scrollDir.DOWN:case scrollDir.UP:var refElY=(cursorCellCoords[1]>=this._initLowerRight.getY()&&!this._dmActive)?cellArea.S:cellArea.X;y=(refElY==null)?gridScreenCoords[1][1]:Math.floor(this._getPixelCoords(refElY)[1].getY()-refElY.offsetHeight/2);if(this._dmActive){var refElX=book.getCellByCoords(this._initLowerRight.getX()+1,this._initLowerRight.getY()),refElLR=book.getCellByCoords(this._initLowerRight.getX(),this._initLowerRight.getY()),refElLRPx=this._getPixelCoords(refElLR),refElYPx=this._mdLRCornerPx.getY()-Math.abs(this._mdLRCornerPx.getX()-ev.clientX);x=Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2);y=((Math.floor(refElLRPx[1].getX()-refElLR.offsetWidth/2)<=ev.clientX&&x>=ev.clientX)||y<refElYPx)?y:refElYPx}else{if(cursorCellCoords[1]==this._initLowerRight.getY()){var refElX=cellArea.E;x=Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2)}else{if(cursorCellCoords[1]>this._initLowerRight.getY()){var refElXLRPx=this._getPixelCoords(book.getCellByCoords(this._initLowerRight.getX(),this._initLowerRight.getY())),incRefElX=book.getCellByCoords(this._initLowerRight.getX()+1,this._initLowerRight.getY()),incRefElXPx=Math.floor(this._getPixelCoords(incRefElX)[1].getX()-incRefElX.offsetWidth/2);x=refElXLRPx[1].getX()+Math.abs(ev.clientY-refElXLRPx[1].getY());x=(x>incRefElXPx)?x:incRefElXPx}else{var refElXURPx=this._getPixelCoords(book.getCellByCoords(this._initLowerRight.getX(),this._initUpperLeft.getY())),incRefElX=book.getCellByCoords(this._initLowerRight.getX()+1,this._initUpperLeft.getY()),incRefElXPx=Math.floor(this._getPixelCoords(incRefElX)[1].getX()-incRefElX.offsetWidth/2);x=refElXURPx[1].getX()+Math.abs(ev.clientY-refElXURPx[0].getY());x=(x>incRefElXPx)?x:incRefElXPx}}}break;case scrollDir.RIGHT:case scrollDir.LEFT:var refElX=(cursorCellCoords[0]>=this._initLowerRight.getX()&&!this._dmActive)?cellArea.E:cellArea.X;x=(refElX==null)?gridScreenCoords[1][0]:Math.floor(this._getPixelCoords(refElX)[1].getX()-refElX.offsetWidth/2);if(this._dmActive){var refElXPx=this._mdLRCornerPx.getX()-Math.abs(this._mdLRCornerPx.getY()-ev.clientY);var refElY=book.getCellByCoords(this._initLowerRight.getX(),this._initLowerRight.getY()+1);x=(cursorCellCoords[0]<=this._initLowerRight.getX())?(x<refElXPx?x:refElXPx):x;y=Math.floor(this._getPixelCoords(refElY)[1].getY()-refElY.offsetHeight/2)}else{if(cursorCellCoords[0]>this._initLowerRight.getX()){var refElYLRPx=this._getPixelCoords(book.getCellByCoords(this._initLowerRight.getX(),this._initLowerRight.getY())),incRefElY=book.getCellByCoords(this._initLowerRight.getX(),this._initLowerRight.getY()+1),incRefElYPx=Math.floor(this._getPixelCoords(incRefElY)[1].getY()-incRefElY.offsetHeight/2);y=refElYLRPx[1].getY()+Math.abs(ev.clientX-refElYLRPx[1].getX());y=(y>incRefElYPx)?y:incRefElYPx}else{var refElYLLPx=this._getPixelCoords(book.getCellByCoords(this._initUpperLeft.getX(),this._initLowerRight.getY())),incRefElY=book.getCellByCoords(this._initUpperLeft.getX(),this._initLowerRight.getY()+1),incRefElYPx=Math.floor(this._getPixelCoords(incRefElY)[1].getY()-incRefElY.offsetHeight/2);y=refElYLLPx[1].getY()+Math.abs(ev.clientX-refElYLLPx[0].getX());y=(y>incRefElYPx)?y:incRefElYPx}}break}monArea.push(new Jedox.wss.cls.Point(x,y));return monArea};clsRef.prototype._resizeRange=function(ev){var targetCell=document.all?ev.srcElement:ev.target,cell=this._latestChangedCell,cursorCellCoords=Jedox.wss.mouse.getGridPos(ev),neighbourCells=this._getNeighbourCells(cell),book=this._selection.getBook();if(neighbourCells==null){return false}var monitorArea=this._getMonitorArea(ev,neighbourCells,cursorCellCoords),gridScreenCoords=this._environment.shared.gridScreenCoords,scrollDir=Jedox.wss.grid.ScrollDirection,directionX=scrollDir.NONE,directionY=scrollDir.NONE,changeDirection=false,focusCell;function setRngEqInit(scope){scope._upperLeft=scope._initUpperLeft.clone();scope._lowerRight=scope._initLowerRight.clone()}if(ev.clientX>monitorArea[1].getX()){directionX=scrollDir.RIGHT}else{if(ev.clientX<monitorArea[0].getX()){directionX=scrollDir.LEFT}}if(ev.clientY>monitorArea[1].getY()){directionY=scrollDir.DOWN}else{if(ev.clientY<monitorArea[0].getY()){directionY=scrollDir.UP}}if(directionX==scrollDir.NONE&&directionY==scrollDir.NONE){return}else{if(directionX!=scrollDir.NONE&&directionY!=scrollDir.NONE){this._direction=(Math.abs(ev.clientX-this._mdLRCornerPx.getX())>Math.abs(ev.clientY-this._mdLRCornerPx.getY()))?directionX:directionY}else{this._direction=(directionX==scrollDir.NONE)?directionY:directionX}}this._active=true;switch(this._direction){case scrollDir.RIGHT:if(cursorCellCoords[0]>this._initLowerRight.getX()){if(cursorCellCoords[0]>0){this._unsetDelMarker();this._lowerRight.setX(cursorCellCoords[0]);this._lowerRight.setY(this._initLowerRight.getY());this._upperLeft=this._initUpperLeft.clone();focusCell=book.getCellByCoords(this._lowerRight.getX(),this._lowerRight.getY())}}else{if(cursorCellCoords[0]+((this._initUpperLeft.equals(this._initLowerRight))?0:1)<this._initUpperLeft.getX()){this._unsetDelMarker();this._upperLeft.setX(cursorCellCoords[0]+1);this._upperLeft.setY(this._initUpperLeft.getY());this._lowerRight=this._initLowerRight.clone();focusCell=book.getCellByCoords(this._upperLeft.getX(),this._upperLeft.getY())}else{setRngEqInit(this);var refCell;if(cursorCellCoords[0]>this._initLowerRight.getX()){this._unsetDelMarker();refCell=new Jedox.wss.cls.Point(cursorCellCoords[0],cursorCellCoords[1]);focusCell=book.getCellByCoords(cursorCellCoords[0],cursorCellCoords[1])}else{if(this._mdLRCornerPx.getX()-ev.clientX>this._mdLRCornerPx.getY()-ev.clientY){refCell=new Jedox.wss.cls.Point(cursorCellCoords[0]+1,this._initUpperLeft.getY());focusCell=book.getCellByCoords(cursorCellCoords[0]+1,cursorCellCoords[1])}else{refCell=new Jedox.wss.cls.Point(this._initUpperLeft.getX(),cursorCellCoords[1]+1);this._direction=scrollDir.DOWN;focusCell=book.getCellByCoords(cursorCellCoords[0]+1,cursorCellCoords[1]+1)}this._setDelMarker(refCell,this._initLowerRight.clone())}}}break;case scrollDir.LEFT:if(cursorCellCoords[0]-1>this._initLowerRight.getX()){this._unsetDelMarker();this._lowerRight.setX(cursorCellCoords[0]-1);this._lowerRight.setY(this._initLowerRight.getY());this._upperLeft=this._initUpperLeft.clone();focusCell=book.getCellByCoords(this._lowerRight.getX(),this._lowerRight.getY())}else{if(cursorCellCoords[0]<this._initUpperLeft.getX()){if(cursorCellCoords[0]>0){this._unsetDelMarker();this._upperLeft.setX(cursorCellCoords[0]);this._upperLeft.setY(this._initUpperLeft.getY());this._lowerRight=this._initLowerRight.clone();focusCell=book.getCellByCoords(this._upperLeft.getX(),this._upperLeft.getY())}}else{setRngEqInit(this);var refCell;if(this._mdLRCornerPx.getX()-ev.clientX>this._mdLRCornerPx.getY()-ev.clientY){refCell=new Jedox.wss.cls.Point(cursorCellCoords[0],this._initUpperLeft.getY());var refCellEl=book.getCellByCoords(refCell.getX(),refCell.getY());if(ev.clientX>Math.floor(this._getPixelCoords(refCellEl)[1].getX()-refCellEl.offsetWidth/2)){refCell.setX(refCell.getX()+1)}focusCell=book.getCellByCoords(refCell.getX(),cursorCellCoords[1])}else{var refCellEl=book.getCellByCoords(cursorCellCoords[0],cursorCellCoords[1]),yOffset=ev.clientY>Math.floor(this._getPixelCoords(refCellEl)[1].getY()-refCellEl.offsetHeight/2)?1:0;refCell=new Jedox.wss.cls.Point(this._initUpperLeft.getX(),cursorCellCoords[1]+yOffset);focusCell=book.getCellByCoords(cursorCellCoords[0],cursorCellCoords[1]+yOffset);this._direction=scrollDir.DOWN}this._setDelMarker(refCell,this._initLowerRight.clone())}}break;case scrollDir.DOWN:if(cursorCellCoords[1]>this._initLowerRight.getY()){if(cursorCellCoords[1]>0){this._unsetDelMarker();this._lowerRight.setX(this._initLowerRight.getX());this._lowerRight.setY(cursorCellCoords[1]);this._upperLeft=this._initUpperLeft.clone();focusCell=book.getCellByCoords(this._lowerRight.getX(),this._lowerRight.getY())}}else{if(cursorCellCoords[1]+1<this._initUpperLeft.getY()){this._unsetDelMarker();this._upperLeft.setX(this._initUpperLeft.getX());this._upperLeft.setY(cursorCellCoords[1]+1);this._lowerRight=this._initLowerRight.clone();focusCell=book.getCellByCoords(this._upperLeft.getX(),this._upperLeft.getY())}else{setRngEqInit(this);var refCell;if(cursorCellCoords[1]+1>this._initLowerRight.getY()){this._unsetDelMarker();refCell=new Jedox.wss.cls.Point(this._initUpperLeft.getX(),cursorCellCoords[1])}else{if(this._mdLRCornerPx.getX()-(ev.clientX-gridScreenCoords[0][0])>this._mdLRCornerPx.getY()-(ev.clientY-gridScreenCoords[0][1])){refCell=new Jedox.wss.cls.Point(cursorCellCoords[0],this._initUpperLeft.getY())}else{refCell=new Jedox.wss.cls.Point(this._initUpperLeft.getX(),cursorCellCoords[1]+1)}this._setDelMarker(refCell,this._initLowerRight.clone())}focusCell=book.getCellByCoords(cursorCellCoords[0],refCell.getY())}}break;case scrollDir.UP:if(cursorCellCoords[1]-1>this._initLowerRight.getY()){this._unsetDelMarker();this._lowerRight.setX(this._initLowerRight.getX());this._lowerRight.setY(cursorCellCoords[1]-1);this._upperLeft=this._initUpperLeft.clone();focusCell=book.getCellByCoords(this._lowerRight.getX(),this._lowerRight.getY())}else{if(cursorCellCoords[1]<this._initUpperLeft.getY()){if(cursorCellCoords[1]>0){this._unsetDelMarker();this._upperLeft.setX(this._initUpperLeft.getX());this._upperLeft.setY(cursorCellCoords[1]);this._lowerRight=this._initLowerRight.clone();focusCell=book.getCellByCoords(this._upperLeft.getX(),this._upperLeft.getY())}}else{setRngEqInit(this);var refCell;if(this._mdLRCornerPx.getX()-ev.clientX>this._mdLRCornerPx.getY()-ev.clientY){var refCellEl=book.getCellByCoords(cursorCellCoords[0],cursorCellCoords[1]),xOffset=ev.clientX>Math.floor(this._getPixelCoords(refCellEl)[1].getX()-refCellEl.offsetWidth/2)?1:0;refCell=new Jedox.wss.cls.Point(cursorCellCoords[0]+xOffset,this._initUpperLeft.getY());focusCell=book.getCellByCoords(cursorCellCoords[0]+xOffset,refCell.getY());this._direction=scrollDir.RIGHT}else{refCell=new Jedox.wss.cls.Point(this._initUpperLeft.getX(),cursorCellCoords[1]);focusCell=book.getCellByCoords(cursorCellCoords[0],refCell.getY())}this._setDelMarker(refCell,this._initLowerRight.clone())}}}this._latestChangedCell=focusCell;this.toggleCoords()};clsRef.prototype._getColorNumber=function(){return"fill"};clsRef.prototype._setDelMarker=function(ul,lr){var offsets={t:0,l:0,w:-1,h:-1},book=this._selection.getBook(),refUL=book.getCellByCoords(ul.getX(),ul.getY()),refLR=book.getCellByCoords(lr.getX(),lr.getY());this._delMarker.style.left=refUL.offsetLeft+offsets.l+"px";this._delMarker.style.top=refUL.parentNode.offsetTop+offsets.t+"px";this._delMarker.style.width=refLR.offsetLeft+refLR.offsetWidth-refUL.offsetLeft+offsets.w+"px";this._delMarker.style.height=refLR.parentNode.offsetTop+refLR.offsetHeight-refUL.parentNode.offsetTop+offsets.h+"px";this._delMarker.style.display="block";this._dmUpperLeft=ul;this._dmLowerRight=lr;this._dmActive=true};clsRef.prototype._unsetDelMarker=function(){if(this._dmActive){this._delMarker.style.display="none";this._dmActive=false}};clsRef=null;if(!Jedox.wss.app.currentDialogControl){Jedox.wss.keyboard.checkGlobalInput=function(myEvent){if(!Jedox.wss.app.loaded){return}if(document.all){myEvent=window.event}var myKeyPressed=((document.all)?myEvent.keyCode:myEvent.which);Jedox.wss.app.lastKeyPressed=myKeyPressed;var result=true;var newMode;var tmp;var env=Jedox.wss.app.environment;var activeBook=Jedox.wss.app.activeBook;var ctrlpressed=false;if(env.inputMode!=Jedox.wss.grid.GridMode.DIALOG&&env.editingDirectly){var lastInputField=Jedox.wss.app.lastInputField;var selCellCoords=env.selectedCellCoords;if(env.viewMode!=Jedox.wss.grid.viewMode.USER&&(lastInputField==Jedox.wss.app.currFormula||!activeBook.isCellVisible(selCellCoords[0],selCellCoords[1]))){Jedox.wss.app.currFormula.focus();Jedox.wss.app.fromFormulaField=true}else{lastInputField.focus()}}if(myEvent.ctrlKey&&!Jedox.wss.app.ctrlKeyPressed){Jedox.wss.app.ctrlKeyPressed=true}if(env.viewMode!=Jedox.wss.grid.viewMode.USER&&!Jedox.wss.app.ctrlKeyPressed){env.defaultSelection.show();Jedox.wss.hb.setAllNormal()}switch(myKeyPressed){case 9:case 13:if(env.inputMode==Jedox.wss.grid.GridMode.EDIT||env.inputMode==Jedox.wss.grid.GridMode.INPUT){result=Jedox.wss.keyboard.sendInput(env.inputField,13,(myKeyPressed==13&&myEvent.ctrlKey&&myEvent.shiftKey))}if((env.inputMode!=Jedox.wss.grid.GridMode.CNTRL)&&(env.inputMode!=Jedox.wss.grid.GridMode.DIALOG)){if(result){Jedox.wss.keyboard.cancelInput((myKeyPressed==9)?false:true);try{Jedox.wss.app.currFormula.blur()}catch(e){}if(myKeyPressed==9){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.RIGHT,myEvent.shiftKey,1,myKeyPressed)}else{if(!(myEvent.ctrlKey&&myEvent.shiftKey)){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.DOWN,myEvent.shiftKey,1,myKeyPressed)}}}else{alert("Invalid input!".localize());Jedox.wss.general.focusInputField()}}break;case 27:if(env.viewMode==Jedox.wss.grid.viewMode.DESIGNER&&env.inputMode==Jedox.wss.grid.GridMode.EDIT){Jedox.wss.app.currFormula.blur()}Jedox.wss.keyboard.cancelInput();env.editingDirectly=false;break;case 36:if(myEvent.ctrlKey){Jedox.wss.keyboard.preventKeyEvent(myEvent);activeBook.scrollTo([this,setDefaultRange,[1,1,1,1]],1,1,true,false);return}break;case 35:if(myEvent.ctrlKey){Jedox.wss.keyboard.preventKeyEvent(myEvent);var fuc=activeBook.getFarthestUsedCell();activeBook.scrollTo([this,setDefaultRange,[fuc[0],fuc[1],fuc[0],fuc[1]]],fuc[0],fuc[1],true,false);return}break;case 33:case 34:case 37:case 38:case 39:case 40:if(env.inputMode==Jedox.wss.grid.GridMode.INPUT){var value=env.inputField.value;if((value.length>0)&&(value.substr(0,1)=="=")){var elemCoords;if(env.formulaSelection.activeToken!=null){var point,area=env.formulaSelection.getActiveRange(),areaCorners=area.getCorners();elemCoords=Jedox.wss.keyboard.calcCursorRng(areaCorners[0].clone(),areaCorners[1].clone(),area.getAnchorCell().clone(),myKeyPressed,myEvent.shiftKey);area.set(elemCoords[0],elemCoords[1]);if(elemCoords[0].equals(elemCoords[1])){area.setAnchorCell(elemCoords[0])}area.formulaUpdate();area.draw()}else{var defRngActCell=env.defaultSelection.getActiveRange().getActiveCell().clone();elemCoords=Jedox.wss.keyboard.calcCursorRng(defRngActCell,defRngActCell,defRngActCell,myKeyPressed,myEvent.shiftKey);if(!activeBook.isCellVisible(elemCoords[2].getX(),elemCoords[2].getY())&&activeBook._scrollOpPending){return}var currFormula=Jedox.wss.app.currFormula,cursorPos=Jedox.util.getSelection(Jedox.wss.app.fromFormulaField?currFormula:env.inputField).start;if(cursorPos<currFormula.value.length||value.substr(-1,1).match(/^[a-z0-9]$/i)!=null){if(env.oldValue!=value){Jedox.wss.keyboard.sendInput(env.inputField,1000)}else{Jedox.wss.keyboard.cancelInput()}return Jedox.wss.keyboard.checkGlobalInput(myEvent)}var area_id=env.formulaSelection.addRange(new Jedox.wss.cls.Point(elemCoords[0].getX(),elemCoords[0].getY()))-1;env.formulaSelection.setActiveRange(area_id);var area=env.formulaSelection.getActiveRange(),areaVal=area.getValue();env.inputField.value=currFormula.value=value.concat(areaVal);var refs=Jedox.wss.formula.parse(currFormula.value,Jedox.wss.app.activePane.getCellNFs(elemCoords[0].getX(),elemCoords[0].getY()));env.formulaSelection.lastParseRes=refs;env.formulaSelection.activeToken=area.formulaToken=refs[refs.length-1];env.formulaSelection.setState(Jedox.wss.range.AreaState.NEW);area.draw();Jedox.wss.keyboard.setFieldSize();env.lastInputValue=currFormula.value}if(!activeBook.isCellVisible(elemCoords[2].getX(),elemCoords[2].getY())){Jedox.wss.keyboard.preventKeyEvent(myEvent);activeBook.scrollTo([this,kbdHandlerEnd],elemCoords[2].getX(),elemCoords[2].getY(),true,false);return}}else{result=Jedox.wss.keyboard.sendInput(env.inputField,13);if(result){Jedox.wss.keyboard.cancelInput(false);try{Jedox.wss.app.currFormula.blur()}catch(e){}Jedox.wss.keyboard.handleCursorKey(myEvent)}else{alert("Invalid input!".localize());Jedox.wss.general.focusInputField()}}Jedox.wss.keyboard.preventKeyEvent(myEvent)}else{if(!env.editingDirectly&&(env.inputMode!=Jedox.wss.grid.GridMode.CNTRL)&&(env.inputMode!=Jedox.wss.grid.GridMode.DIALOG)){Jedox.wss.keyboard.handleCursorKey(myEvent)}if((env.inputMode==Jedox.wss.grid.GridMode.DIALOG)&&Jedox.wss.app.currentDialogControl!=null){var selCmp=Ext.getCmp(Jedox.wss.app.currentDialogControl);if(selCmp.getXType()=="dataview"){var currIndex=selCmp.getSelectedIndexes()[0];switch(myKeyPressed){case 33:case 37:case 38:selCmp.select((currIndex>0)?--currIndex:Jedox.wss.app.currentDialogControlItemsCnt-1);break;case 34:case 39:case 40:selCmp.select((currIndex<Jedox.wss.app.currentDialogControlItemsCnt-1)?++currIndex:0);break}Jedox.wss.keyboard.preventKeyEvent(myEvent)}}}break;case 46:if((env.inputMode!=Jedox.wss.grid.GridMode.INPUT)&&(env.inputMode!=Jedox.wss.grid.GridMode.EDIT)&&(env.inputMode!=Jedox.wss.grid.GridMode.CNTRL)&&(env.inputMode!=Jedox.wss.grid.GridMode.DIALOG)&&(!env.editingDirectly)){if(env.viewMode==Jedox.wss.grid.viewMode.USER){env.inputField.value="";env.selectedCellValue="";env.cursorField.innerHTML="";var cellCoords=env.lastRangeStartCoord;activeBook.clrRange([cellCoords[0],cellCoords[1],cellCoords[0],cellCoords[1]])}else{env.defaultSelection.emptyCellContent()}}break;case 113:if((env.inputMode!=Jedox.wss.grid.GridMode.EDIT)&&(env.inputMode!=Jedox.wss.grid.GridMode.INPUT)){Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.EDIT);Jedox.wss.general.showInputField(null,false,true)}else{newMode=(env.inputMode==Jedox.wss.grid.GridMode.EDIT)?Jedox.wss.grid.GridMode.INPUT:Jedox.wss.grid.GridMode.EDIT;Jedox.wss.general.setInputMode(newMode)}break;case 120:if(env.inputMode!=Jedox.wss.grid.GridMode.EDIT&&env.inputMode!=Jedox.wss.grid.GridMode.INPUT){Jedox.wss.app.activeBook.recalc()}break;case 122:return;break;case 17:var mousePos=env.mousePosition;if(mousePos=="rngBorder"||mousePos=="magicDot"){env.defaultSelection.setCursor(mousePos,(mousePos=="rngBorder")?"rng_copy":"md_curr_plus")}break;case 67:if(myEvent.ctrlKey){Jedox.wss.action.copy(true);if(env.inputMode==Jedox.wss.grid.GridMode.READY||env.inputMode==Jedox.wss.grid.GridMode.DIALOG){var copyToClp=true}}else{handleDefault()}break;case 71:if(myEvent.ctrlKey){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.goTo)}else{handleDefault()}break;case 86:if(myEvent.ctrlKey&&env.inputMode==Jedox.wss.grid.GridMode.READY){if(Jedox.wss.app.clipboard==null){var pomdiv=document.createElement("div");pomdiv.setAttribute("id","pomdiv");pomdiv.style.width="1px";pomdiv.style.height="1px";pomdiv.style.position="relative";pomdiv.style.overflow="hidden";var _pinput=document.createElement("textarea");_pinput.setAttribute("id","_paste_field_");_pinput.setAttribute("name","_paste_field_");_pinput.setAttribute("style","position: float; width: 1px; height: 1px; z-index: 999; overflow: hidden;");pomdiv.appendChild(_pinput);document.body.appendChild(pomdiv);document.getElementById("_paste_field_").focus();document.getElementById("_paste_field_").select();var pasteFromClp=true}else{Jedox.wss.action.paste()}}else{handleDefault()}break;case 88:if(myEvent.ctrlKey){Jedox.wss.action.cut(true);if(env.inputMode==Jedox.wss.grid.GridMode.READY||env.inputMode==Jedox.wss.grid.GridMode.DIALOG){var copyToClp=true}}else{handleDefault()}break;case 89:if(myEvent.ctrlKey){Jedox.wss.sheet.redo();Jedox.wss.keyboard.preventKeyEvent(myEvent)}else{handleDefault()}break;case 90:if(myEvent.ctrlKey){Jedox.wss.sheet.undo();Jedox.wss.keyboard.preventKeyEvent(myEvent)}else{handleDefault()}break;default:handleDefault()}function handleDefault(){if(myKeyPressed==8||myKeyPressed==32||(myKeyPressed>41&&myKeyPressed<=90)||(myKeyPressed>96&&myKeyPressed<=107)||(myKeyPressed>108&&myKeyPressed<=111)||(myKeyPressed>=187&&myKeyPressed<=226)){if(env.inputMode==Jedox.wss.grid.GridMode.READY){if(env.viewMode==Jedox.wss.grid.viewMode.USER){var selCoords=env.selectedCellCoords;if(Jedox.wss.app.activeBook.isCellLocked(selCoords[0],selCoords[1])){return}}env.selectedCellValue="";env.selectedCellFormula="";Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.INPUT);Jedox.wss.general.showInputField(null,false,true,false);Jedox.wss.app.updateUndoState([1,0],false)}else{if(env.inputMode==Jedox.wss.grid.GridMode.EDIT||env.inputMode==Jedox.wss.grid.GridMode.INPUT){Jedox.wss.app.updateUndoState([1,0],false)}}}}function resetFocus(){Jedox.wss.general.setInputMode(Jedox.wss.app.lastInputModeDlg);Jedox.wss.app.lastInputMode=Jedox.wss.grid.GridMode.READY}function setDefaultRange(rng){var defSel=env.defaultSelection;if(defSel){defSel.jumpTo(rng)}kbdHandlerEnd()}function kbdHandlerEnd(){if(pasteFromClp==undefined&&env.inputMode!=Jedox.wss.grid.GridMode.EDIT&&env.inputMode!=Jedox.wss.grid.GridMode.INPUT&&env.inputMode!=Jedox.wss.grid.GridMode.CNTRL&&env.inputMode!=Jedox.wss.grid.GridMode.DIALOG){Jedox.wss.keyboard.preventKeyEvent(myEvent)}if(env.viewMode==Jedox.wss.grid.viewMode.USER){Jedox.wss.keyboard.handleUMFocus(myKeyPressed,myEvent.shiftKey)}if(copyToClp!=undefined&&copyToClp){resetFocus()}if(pasteFromClp!=undefined&&pasteFromClp){setTimeout("Jedox.wss.action.paste()",1);resetFocus()}}kbdHandlerEnd()}}Jedox.wss.keyboard.calcCursorRng=function(ul,lr,act,key,shiftPressed){var defMaxCoords=Jedox.wss.grid.defMaxCoords,focusCell;switch(key){case 37:if(shiftPressed){if(ul.equalsX(lr)){ul.setX((ul.getX()>1)?ul.getX()-1:ul.getX());focusCell=ul}else{if(ul.equalsX(act)){lr.setX((lr.getX()>1)?lr.getX()-1:lr.getX());focusCell=lr}else{ul.setX((ul.getX()>1)?ul.getX()-1:ul.getX());focusCell=ul}}}else{var newX=(act.getX()>1)?act.getX()-1:act.getX();var newY=act.getY();ul.setX(newX);ul.setY(newY);lr.setX(newX);lr.setY(newY);focusCell=ul}break;case 39:if(shiftPressed){if(ul.equalsX(lr)){lr.setX((lr.getX()<defMaxCoords[0])?lr.getX()+1:lr.getX());focusCell=ul}else{if(lr.equalsX(act)){ul.setX((ul.getX()<defMaxCoords[0])?ul.getX()+1:ul.getX());focusCell=ul}else{lr.setX((lr.getX()<defMaxCoords[0])?lr.getX()+1:lr.getX());focusCell=lr}}}else{var newX=(act.getX()<defMaxCoords[0])?act.getX()+1:act.getX();var newY=act.getY();ul.setX(newX);ul.setY(newY);lr.setX(newX);lr.setY(newY);focusCell=ul}break;case 33:case 38:if(shiftPressed){if(ul.equalsY(lr)){ul.setY((ul.getY()>1)?ul.getY()-1:ul.getY());focusCell=ul}else{if(ul.equalsY(act)){lr.setY((lr.getY()>1)?lr.getY()-1:lr.getY());focusCell=lr}else{ul.setY((ul.getY()>1)?ul.getY()-1:ul.getY());focusCell=ul}}}else{var newX=act.getX();var newY=(act.getY()>1)?act.getY()-1:act.getY();ul.setX(newX);ul.setY(newY);lr.setX(newX);lr.setY(newY);focusCell=ul}break;case 34:case 40:if(shiftPressed){if(ul.equalsY(lr)){lr.setY((lr.getY()<defMaxCoords[1])?lr.getY()+1:lr.getY());focusCell=lr}else{if(lr.equalsY(act)){ul.setY((ul.getY()<defMaxCoords[1])?ul.getY()+1:ul.getY());focusCell=ul}else{lr.setY((lr.getY()<defMaxCoords[1])?lr.getY()+1:lr.getY());focusCell=lr}}}else{var newX=act.getX();var newY=(act.getY()<defMaxCoords[1])?act.getY()+1:act.getY();ul.setX(newX);ul.setY(newY);lr.setX(newX);lr.setY(newY);focusCell=ul}break}return[ul,lr,focusCell]};Jedox.wss.keyboard.cursorKeys={16:true,33:true,34:true,37:true,38:true,39:true,40:true};Jedox.wss.keyboard.setFieldContent=function(ev){var env=Jedox.wss.app.environment,currFormula=Jedox.wss.app.currFormula,changed;if(Jedox.wss.app.fromFormulaField){env.inputField.value=currFormula.value}else{currFormula.value=env.inputField.value}if(changed=env.lastInputValue!=currFormula.value){Jedox.wss.keyboard.setFieldSize();env.lastInputValue=currFormula.value}if(currFormula.value.substr(0,1)!="="){return}var keyPressed=document.all?(typeof window.event=="object"?window.event.keyCode:-1):(typeof ev=="object"?ev.which:-1);if(!(keyPressed in Jedox.wss.keyboard.cursorKeys)){env.formulaSelection.activeToken=null}if(changed){Jedox.wss.range.drawDependingCells(currFormula.value)}};Jedox.wss.keyboard.setFieldSize=function(){var env=Jedox.wss.app.environment;var selCellWidth=env.selectedCell.offsetWidth,selCellHeight=env.selectedCell.offsetHeight;var activeBook=Jedox.wss.app.activeBook;var inputField=env.inputField;var tm=Ext.util.TextMetrics.createInstance(inputField.id);var rightMargin=tm.getWidth("WWW");var contWidth=tm.getWidth(inputField.value.replace(/ /g,"t"));var contLineHeight=tm.getHeight("W");var fieldWidth=contWidth;var fieldHeight=contLineHeight;var lastVisCellCoords=activeBook.getCoordsLastVCell();var lastVisCell=activeBook.getCellByCoords(lastVisCellCoords[0],lastVisCellCoords[1]);var maxDims={width:lastVisCell.offsetLeft+lastVisCell.offsetWidth-inputField.offsetLeft-2,height:lastVisCell.parentNode.offsetTop+lastVisCell.offsetHeight-inputField.offsetTop};if(contWidth<selCellWidth-8){fieldWidth=selCellWidth-((env.viewMode==Jedox.wss.grid.viewMode.USER)?3:2)}else{if(contWidth<maxDims.width){fieldWidth+=rightMargin}else{fieldWidth=maxDims.width;contWidth*=1.3;fieldHeight=Math.round(contWidth/maxDims.width)*contLineHeight+((contWidth%maxDims.width>0)?contLineHeight:0);if(fieldHeight>maxDims.height){fieldHeight=maxDims.height}}}inputField.style.width=fieldWidth+"px";if(fieldHeight>selCellHeight){inputField.style.height=fieldHeight+"px"}};Jedox.wss.keyboard.sendInput=function(myInputBox,myKeyCode,isArrFrml){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,cellValue=myInputBox.value,selCellCoords=env.selectedCellCoords;if(env.viewMode==Jedox.wss.grid.viewMode.USER&&!cellValue.search(/^=/)){return true}else{if(isArrFrml===undefined||!isArrFrml){if(cellValue==env.oldValue){return true}var hdata=Jedox.wss.hl.get(selCellCoords);if(hdata){if(hdata.dyn){if(cellValue.search(/^=HYPERLINK\(/)!=0){activeBook.clrRange([selCellCoords[0],selCellCoords[1],selCellCoords[0],selCellCoords[1]],Jedox.wss.range.ContentType.ATTRS)}}else{Jedox.wss.hl.updateText([selCellCoords[0],selCellCoords[1],selCellCoords[0],selCellCoords[1]],cellValue);cellValue=Jedox.wss.general.filterHLTags(selCellCoords[0],selCellCoords[1],cellValue,true)}}env.selectedCellValue=cellValue;activeBook.setCellValue(selCellCoords[0],selCellCoords[1],cellValue)}else{activeBook.setArrayFormula(env.defaultSelection.getActiveRange().getCoords(),cellValue);var selCellValue=activeBook.getCellValue(selCellCoords[0],selCellCoords[1]);env.selectedCellValue=(selCellValue==undefined)?"":selCellValue;var selCellFormula=activeBook.getCellFormula(selCellCoords[0],selCellCoords[1]);env.selectedCellFormula=(selCellFormula==undefined)?"":selCellFormula;Jedox.wss.app.currFormula.value=env.selectedCellFormula}}Jedox.wss.keyboard.cancelInput();return true};Jedox.wss.keyboard.cancelInput=function(delMarkRng){var env=Jedox.wss.app.environment;var inputField=env.inputField;var isUserMode=(env.viewMode==Jedox.wss.grid.viewMode.USER);env.editingDirectly=false;if(!isUserMode){var selCellCoords=env.selectedCellCoords;Jedox.wss.app.currFormula.value=((env.selectedCellFormula!="")&&(env.selectedCellFormula!="null"))?env.selectedCellFormula:Jedox.wss.general.filterHLTags(selCellCoords[0],selCellCoords[1],env.selectedCellValue,false)}Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.READY);inputField.style.zIndex="37";inputField.style.display="none";env.lastInputValue="";env.activeNewArea=false;if(!isUserMode){env.cursorField.style.visibility="";env.formulaSelection.removeAll();if(delMarkRng==undefined||delMarkRng){env.copySelection.removeAll();if(Jedox.wss.app.clipboard!=null&&Jedox.wss.app.clipboard.id!=null){Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)}}}else{Jedox.wss.app.clipboard=null}};Jedox.wss.keyboard.shiftDirection=function(direction){switch(direction){case Jedox.wss.grid.ScrollDirection.DOWN:direction=Jedox.wss.grid.ScrollDirection.UP;break;case Jedox.wss.grid.ScrollDirection.UP:direction=Jedox.wss.grid.ScrollDirection.DOWN;break;case Jedox.wss.grid.ScrollDirection.LEFT:direction=Jedox.wss.grid.ScrollDirection.RIGHT;break;case Jedox.wss.grid.ScrollDirection.RIGHT:direction=Jedox.wss.grid.ScrollDirection.LEFT;break}return direction};Jedox.wss.keyboard.preventKeyEvent=function(myKeyEvent){if(Jedox.wss.app.environment.inputMode!=Jedox.wss.grid.GridMode.EDIT){if(document.all){window.event.returnValue=false;window.event.cancelBubble=true}else{myKeyEvent.preventDefault()}}return false};Jedox.wss.keyboard.handleCursorKey=function(keyEvent){var keyPressed=((document.all)?keyEvent.keyCode:keyEvent.which);var amount=1;switch(keyPressed){case 37:if(Jedox.wss.app.environment.selectedAbsRowNameNumeric>1){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.LEFT,keyEvent.shiftKey,amount,keyPressed)}break;case 33:case 38:if(Jedox.wss.app.environment.selectedAbsColumnName>1){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.UP,keyEvent.shiftKey,amount,keyPressed)}break;case 39:if(Jedox.wss.app.environment.selectedAbsRowNameNumeric<Jedox.wss.grid.defMaxCoords[0]){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.RIGHT,keyEvent.shiftKey,amount,keyPressed)}break;case 34:case 40:if(Jedox.wss.app.environment.selectedAbsColumnName<Jedox.wss.grid.defMaxCoords[1]){Jedox.wss.keyboard.moveCursor(Jedox.wss.grid.ScrollDirection.DOWN,keyEvent.shiftKey,amount,keyPressed)}break}};Jedox.wss.keyboard.isCursorkey=function(keyCode){return((keyCode>=37)&&(keyCode<=40))};Jedox.wss.keyboard.moveCursor=function(direction,shiftKey,amount,keyCode){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){return}var range=(Jedox.wss.app.environment.activeNewArea)?Jedox.wss.app.environment.formulaSelection:Jedox.wss.app.environment.defaultSelection,activeBook=Jedox.wss.app.activeBook,activeCell=range.getActiveRange().getActiveCell(),lastActiveCell=range.getActiveRange().getLastActiveCell(),coords=activeCell.clone(),lastCell=activeCell.clone(),isCursorKey=Jedox.wss.keyboard.isCursorkey(keyCode),i=0,activeSheet=Jedox.wss.app.activeSheet;if(!Jedox.wss.app.environment.defaultSelection.isSingleCell()&&!(keyCode==13||keyCode==9)&&!shiftKey){range.set(activeCell,activeCell)}if(shiftKey){if(isCursorKey){coords=lastActiveCell.clone()}else{direction=Jedox.wss.keyboard.shiftDirection(direction)}}var rangeSingleCell=range.isSingleCell(),chkHiddenColRow=Jedox.wss.general.chkHiddenColRow;switch(direction){case Jedox.wss.grid.ScrollDirection.DOWN:if(rangeSingleCell||(shiftKey&&isCursorKey)){var newYCoord=chkHiddenColRow(true,coords.getY(),amount,true),newXCoord=chkHiddenColRow(false,coords.getX(),0,true),mergeInfoSrc=activeBook.getMergeInfo(coords.getX(),coords.getY()),mergeInfo=activeBook.getMergeInfo(newXCoord,newYCoord);if(!mergeInfoSrc){range.setRefActiveCell(coords)}if(mergeInfo&&!mergeInfo[0]){var mergeInfoMa=mergeInfoSrc&&mergeInfoSrc[0]?mergeInfoSrc:activeBook.getMergeInfo(mergeInfo[1],mergeInfo[2]);if(mergeInfoMa&&mergeInfoMa[0]){if(mergeInfoSrc&&mergeInfoSrc[0]){if(rangeSingleCell){newYCoord=mergeInfo[2]+mergeInfoMa[2]}if(!shiftKey){var refCell=range.getRefActiveCell();if(refCell&&refCell.getX()>=mergeInfo[1]&&refCell.getX()<=(mergeInfo[1]+mergeInfoMa[1]-1)){newXCoord=refCell.getX()}var mergeInfoShiftCell=activeBook.getMergeInfo(newXCoord,newYCoord);if(mergeInfoShiftCell&&!mergeInfoShiftCell[0]){newXCoord=mergeInfoShiftCell[1];newYCoord=mergeInfoShiftCell[2]}}}else{newXCoord=mergeInfo[1];newYCoord=mergeInfo[2]}}}if(newXCoord<=Jedox.wss.grid.defMaxCoords[0]&&newYCoord<=Jedox.wss.grid.defMaxCoords[1]){coords.setX(newXCoord);coords.setY(newYCoord)}}else{for(i=0;i<amount;i++){range.nextY()}}break;case Jedox.wss.grid.ScrollDirection.UP:if(rangeSingleCell||(shiftKey&&isCursorKey)){var newYCoord=chkHiddenColRow(true,coords.getY(),amount,false),newXCoord=chkHiddenColRow(false,coords.getX(),0,false),mergeInfoSrc=activeBook.getMergeInfo(coords.getX(),coords.getY()),mergeInfo=activeBook.getMergeInfo(newXCoord,newYCoord);if(!mergeInfoSrc){range.setRefActiveCell(coords)}if(!shiftKey||(shiftKey&&!isCursorKey)){if(!mergeInfo){if(mergeInfoSrc&&mergeInfoSrc[0]){var refCell=range.getRefActiveCell();if(refCell&&refCell.getX()>=coords.getX()&&refCell.getX()<=(coords.getX()+mergeInfoSrc[1]-1)){newXCoord=refCell.getX()}var mergeInfoShiftCell=activeBook.getMergeInfo(newXCoord,newYCoord);if(mergeInfoShiftCell&&!mergeInfoShiftCell[0]){newXCoord=mergeInfoShiftCell[1];newYCoord=mergeInfoShiftCell[2]}}}else{if(!mergeInfo[0]){newXCoord=mergeInfo[1];newYCoord=mergeInfo[2]}}}if(newXCoord>=1&&newYCoord>=1){coords.setX(newXCoord);coords.setY(newYCoord)}}else{for(i=0;i<amount;i++){range.prevY()}}break;case Jedox.wss.grid.ScrollDirection.RIGHT:if(rangeSingleCell||(shiftKey&&isCursorKey)){var newYCoord=chkHiddenColRow(true,coords.getY(),0,true),newXCoord=chkHiddenColRow(false,coords.getX(),amount,true),mergeInfoSrc=activeBook.getMergeInfo(coords.getX(),coords.getY()),mergeInfo=activeBook.getMergeInfo(newXCoord,newYCoord);if(!mergeInfoSrc){range.setRefActiveCell(coords)}if(mergeInfo&&!mergeInfo[0]){var mergeInfoMa=mergeInfoSrc&&mergeInfoSrc[0]?mergeInfoSrc:activeBook.getMergeInfo(mergeInfo[1],mergeInfo[2]);if(mergeInfoMa&&mergeInfoMa[0]){if(mergeInfoSrc&&mergeInfoSrc[0]){if(rangeSingleCell){newXCoord=mergeInfo[1]+mergeInfoMa[1]}if(!shiftKey){var refCell=range.getRefActiveCell();if(refCell&&refCell.getY()>=mergeInfo[2]&&refCell.getY()<=(mergeInfo[2]+mergeInfoMa[2]-1)){newYCoord=refCell.getY()}var mergeInfoShiftCell=activeBook.getMergeInfo(newXCoord,newYCoord);if(mergeInfoShiftCell&&!mergeInfoShiftCell[0]){newXCoord=mergeInfoShiftCell[1];newYCoord=mergeInfoShiftCell[2]}}}else{newXCoord=mergeInfo[1];if(!shiftKey){newYCoord=mergeInfo[2]}}}}if(newXCoord<=Jedox.wss.grid.defMaxCoords[0]&&newYCoord<=Jedox.wss.grid.defMaxCoords[1]){coords.setX(newXCoord);coords.setY(newYCoord)}}else{for(i=0;i<amount;i++){range.next()}}break;case Jedox.wss.grid.ScrollDirection.LEFT:if(rangeSingleCell||(shiftKey&&isCursorKey)){var newYCoord=chkHiddenColRow(true,coords.getY(),0,false),newXCoord=chkHiddenColRow(false,coords.getX(),amount,false),mergeInfoSrc=activeBook.getMergeInfo(coords.getX(),coords.getY()),mergeInfo=activeBook.getMergeInfo(newXCoord,newYCoord);if(!mergeInfoSrc){range.setRefActiveCell(coords)}if(!shiftKey||(shiftKey&&!isCursorKey)){if(!mergeInfo){if(mergeInfoSrc&&mergeInfoSrc[0]){var refCell=range.getRefActiveCell();if(refCell!=undefined&&refCell.getY()>=coords.getY()&&refCell.getY()<=(coords.getY()+mergeInfoSrc[2]-1)){newYCoord=refCell.getY()}var mergeInfoShiftCell=activeBook.getMergeInfo(newXCoord,newYCoord);if(mergeInfoShiftCell&&!mergeInfoShiftCell[0]){newXCoord=mergeInfoShiftCell[1];newYCoord=mergeInfoShiftCell[2]}}}else{if(!mergeInfo[0]){newXCoord=mergeInfo[1];newYCoord=mergeInfo[2]}}}if(newXCoord>=1&&newYCoord>=1){coords.setX(newXCoord);coords.setY(newYCoord)}}else{for(i=0;i<amount;i++){range.prev()}}break;default:console.error("Invalid cursor direction!");return}if((rangeSingleCell||(shiftKey&&isCursorKey))&&!activeBook.isCellVisible(coords.getX(),coords.getY())&&activeBook._scrollOpPending){return}if(shiftKey&&isCursorKey){range.expandToCell(coords,false)}else{if(rangeSingleCell){range.set(coords,coords)}else{range._setLegacyVars()}}var scrollMap=(activeBook.getScrollDirMap())[direction],cbScrollTo=function(){range.draw()};if((rangeSingleCell||(shiftKey&&isCursorKey))&&!activeBook.isCellVisible(coords.getX(),coords.getY())){activeBook.scrollTo([this,cbScrollTo],coords.getX(),coords.getY(),true,false)}else{range.draw()}};Jedox.wss.keyboard.preventEvent=function(ev){if(Jedox.wss.app.environment.inputMode!=Jedox.wss.grid.GridMode.EDIT){if(document.all){window.event.returnValue=false;window.event.cancelBubble=true}else{ev.preventDefault();ev.stopPropagation()}}return false};Jedox.wss.keyboard.focusInput=function(currX,currY,direction){var activeBook=Jedox.wss.app.activeBook;var iterMode=Jedox.wss.grid.IterationMode;var realRng=activeBook.getRealGridRange();function iterForHor(currX,currY){var x=currX+1,y=currY;for(;!(x==currX&&y==currY);((++y>realRng[1][1])?y=realRng[0][1]:y),x=realRng[0][0]){for(;x<=realRng[1][0];++x){if(!activeBook.isCellLocked(x,y)){Jedox.wss.mouse.mimicCellMouseEvent(x,y,"mousedown");return}}}}function iterBackHor(currX,currY){var x=currX-1,y=currY;for(;!(x==currX&&y==currY);((--y<realRng[0][1])?y=realRng[1][1]:y),x=realRng[1][0]){for(;x>=realRng[0][0];--x){if(!activeBook.isCellLocked(x,y)){Jedox.wss.mouse.mimicCellMouseEvent(x,y,"mousedown");return}}}}function iterForVert(currX,currY){var x=currX,y=currY+1;for(;!(x==currX&&y==currY);((++x>realRng[1][0])?x=realRng[0][0]:x),y=realRng[0][1]){for(;y<=realRng[1][1];++y){if(!activeBook.isCellLocked(x,y)){Jedox.wss.mouse.mimicCellMouseEvent(x,y,"mousedown");return}}}}function iterBackVert(currX,currY){var x=currX,y=currY-1;for(;!(x==currX&&y==currY);((--x<realRng[0][0])?x=realRng[1][0]:x),y=realRng[1][1]){for(;y>=realRng[0][1];--y){if(!activeBook.isCellLocked(x,y)){Jedox.wss.mouse.mimicCellMouseEvent(x,y,"mousedown");return}}}}switch(direction){case iterMode.NEXTX:iterForHor(currX,currY);break;case iterMode.PREVX:iterBackHor(currX,currY);break;case iterMode.NEXTY:iterForVert(currX,currY);break;case iterMode.PREVY:iterBackVert(currX,currY);break;case iterMode.FIRST:iterForHor(realRng[1][0],realRng[1][1]);break;case iterMode.LAST:iterBackHor(realRng[0][0],realRng[0][1]);break}};Jedox.wss.keyboard.handleUMFocus=function(keyCode,shiftKey){var selCellCoords=Jedox.wss.app.environment.selectedCellCoords;if(selCellCoords.length==0){selCellCoords=[1,1]}switch(keyCode){case 9:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],shiftKey?Jedox.wss.grid.IterationMode.PREVX:Jedox.wss.grid.IterationMode.NEXTX);break;case 13:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],shiftKey?Jedox.wss.grid.IterationMode.PREVY:Jedox.wss.grid.IterationMode.NEXTY);break;case 39:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],Jedox.wss.grid.IterationMode.NEXTX);break;case 37:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],Jedox.wss.grid.IterationMode.PREVX);break;case 40:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],Jedox.wss.grid.IterationMode.NEXTY);break;case 38:Jedox.wss.keyboard.focusInput(selCellCoords[0],selCellCoords[1],Jedox.wss.grid.IterationMode.PREVY);break}};Jedox.wss.keyboard.fetchGlobalKeyUp=function(ev){if(document.all){ev=window.event}if(!ev.ctrlKey){Jedox.wss.app.ctrlKeyPressed=false;var env=Jedox.wss.app.environment;var mousePos=env.mousePosition;if(mousePos=="rngBorder"||mousePos=="magicDot"){env.defaultSelection.setCursor(mousePos,(mousePos=="rngBorder")?"rng_move":"md_curr")}}};Jedox.wss.keyboard.genKbdEvent=function(keyCode,ctrlKey,altKey,shiftKey,metaKey){if(window.KeyEvent){var evObj=document.createEvent("KeyEvents");evObj.initKeyEvent("keydown",true,true,window,ctrlKey,altKey,shiftKey,metaKey,keyCode,0);fireOnThis.dispatchEvent(evObj)}else{var evObj=document.createEventObject();evObj.ctrlKey=true;evObj.keyCode=keyCode;document.fireEvent("onkeydown",evObj)}};Jedox.wss.mouse.MouseIsOnCell=function(XPos,YPos,Coords){return(((XPos>=Coords[0][0])&&(XPos<=Coords[0][1]))&&((YPos>=Coords[1][0])&&(YPos<=Coords[1][1])))};Jedox.wss.mouse.updateLastCell=function(el,elCoords){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,mergeInfo=activeBook.getMergeInfo(elCoords[0],elCoords[1]);if(mergeInfo!=undefined&&!mergeInfo){env.lastCellCoords=[mergeInfo[1],mergeInfo[2]];env.lastCell=activeBook.getCellByCoords(mergeInfo[1],mergeInfo[2])}else{env.lastCell=el;env.lastCellCoords=[elCoords[0],elCoords[1]]}};Jedox.wss.mouse.overTracking=function(ev){var activeBook=Jedox.wss.app.activeBook,elCoords;if(!Jedox.wss.app.loaded||activeBook==undefined){return}if(document.all){ev=window.event}var el=(document.all)?ev.srcElement:ev.target;if(el.tagName!="DIV"){el=el.parentNode}if((elCoords=activeBook.getCoordsByCell(el))==undefined){return}Jedox.wss.mouse.updateLastCell(el,elCoords);if(el.tagName=="DIV"&&el.className=="gridCell"){Jedox.wss.keyboard.preventEvent(ev)}};Jedox.wss.mouse.rangeOverTracking=function(myEvent){var env=Jedox.wss.app.environment;if(env.viewMode==Jedox.wss.grid.viewMode.USER){return}if(document.all){myEvent=window.event}var activeBook=Jedox.wss.app.activeBook,myElement=(document.all)?myEvent.srcElement:myEvent.target,rangeStartCoords=env.defaultSelection.getActiveRange().getUpperLeft(),lastCellCoords=env.lastCellCoords,targetCoords=activeBook.getNeighByOffset(rangeStartCoords.getX(),rangeStartCoords.getY(),(document.all?myEvent.offsetX:myEvent.layerX)+myElement.offsetLeft+4,(document.all?myEvent.offsetY:myEvent.layerY)+myElement.offsetTop+4);if(lastCellCoords[0]!=targetCoords[0]||lastCellCoords[1]!=targetCoords[1]){env.lastCell=targetCoords[2];env.lastCellCoords=[targetCoords[0],targetCoords[1]]}if(myElement.tagName=="DIV"&&myElement.className=="gridCell"){Jedox.wss.keyboard.preventEvent(myEvent)}};Jedox.wss.mouse.mouseonCellDblClick=function(ev){if(document.all){ev=window.event}var el=(document.all)?ev.srcElement:ev.target;if(el.tagName!="DIV"){el=el.parentNode}var activeBook=Jedox.wss.app.activeBook,cellCoords=activeBook.getCoordsByCell(el);if(!cellCoords){return true}Jedox.wss.mouse.showCursorLayer("marker_sand_clock");var cbRes=activeBook.cbFire(cellCoords[0],cellCoords[1],"dblclick",{c:cellCoords[0],r:cellCoords[1]});Jedox.wss.mouse.hideCursorLayer();if(!cbRes){return false}};Jedox.wss.mouse.mouseOnCellDown=function(myEvent){if(document.all){myEvent=window.event}var myElement=(document.all)?myEvent.srcElement:myEvent.target;if(myElement.tagName!="DIV"){myElement=myElement.parentNode}var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,elCoords=activeBook.getCoordsByCell(myElement);if(elCoords==undefined){return}var cbRes=activeBook.cbFire(elCoords[0],elCoords[1],"mousedown",myEvent);if(!cbRes){Jedox.wss.keyboard.preventEvent(myEvent);return false}if(env.viewMode==Jedox.wss.grid.viewMode.USER&&activeBook.isCellLocked(elCoords[0],elCoords[1])){Jedox.wss.keyboard.cancelInput();return}var value;if((env.inputMode==Jedox.wss.grid.GridMode.EDIT)||(env.inputMode==Jedox.wss.grid.GridMode.INPUT)){value=env.inputField.value;if(value.length>0&&value.substr(0,1)=="="&&env.viewMode!=Jedox.wss.grid.viewMode.USER){Jedox.wss.app.lastInputMode=env.inputMode;Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.POINT);var elemCoords=activeBook.getCoordsByCell(myElement);if(env.formulaSelection.activeToken!=null){var point,area=env.formulaSelection.getActiveRange();area.set(point=new Jedox.wss.cls.Point(elemCoords[0],elemCoords[1]),point);area.formulaUpdate();area.draw()}else{var currFormula=Jedox.wss.app.currFormula,selection=Jedox.util.getSelection(Jedox.wss.app.fromFormulaField?currFormula:env.inputField),selStart=selection.start,selEnd=selection.end;if(selStart==0||value.substr(selStart-1,1).match(/^[a-z0-9]$/i)!=null){if(env.oldValue!=value){Jedox.wss.keyboard.sendInput(env.inputField,1000)}else{Jedox.wss.keyboard.cancelInput()}return Jedox.wss.mouse.mouseOnCellDown(myEvent)}env.inputField.value=currFormula.value=value.substring(0,selStart).concat(Jedox.wss.app.numberToLetter[elemCoords[0]],elemCoords[1],value.substring(selEnd));Jedox.wss.range.drawDependingCells(currFormula.value);Jedox.wss.keyboard.setFieldSize();env.lastInputValue=currFormula.value;for(var tok,area,areas=env.formulaSelection.getRanges(),i=areas.length-1;i>=0;--i){if(selStart>=(tok=(area=areas[i]).formulaToken).start&&selStart<tok.end){env.formulaSelection.activeToken=tok;env.formulaSelection.setActiveRange(i);env.formulaSelection.setState(Jedox.wss.range.AreaState.NEW);area.repaint();break}}}Jedox.wss.app.environment.formulaSelection.registerForMouseMovement(myElement)}else{if(Jedox.wss.app.environment.viewMode!=Jedox.wss.grid.viewMode.USER){Jedox.wss.app.environment.formulaSelection.removeAll()}else{Jedox.wss.app.environment.inputField.style.display="none"}if(Jedox.wss.app.environment.oldValue!=value){Jedox.wss.keyboard.sendInput(Jedox.wss.app.environment.inputField,1000)}else{Jedox.wss.keyboard.cancelInput()}Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.READY);Jedox.wss.hb.setAllNormal()}}if(Jedox.wss.app.environment.inputMode==Jedox.wss.grid.GridMode.DIALOG&&Jedox.wss.app.sourceSel){Jedox.wss.mouse.initSourceRange(myElement,activeBook.getCoordsByCell(myElement))}if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.DESIGNER&&Jedox.wss.app.environment.inputMode==Jedox.wss.grid.GridMode.READY){var elementCoords;var activeBook=Jedox.wss.app.activeBook;if(activeBook!=undefined){var elementCoords=activeBook.getCoordsByCell(myElement);if(elementCoords==undefined){return}}Jedox.wss.app.environment.defaultSelection.set(new Jedox.wss.cls.Point(elementCoords[0],elementCoords[1]),new Jedox.wss.cls.Point(elementCoords[0],elementCoords[1]));Jedox.wss.app.environment.defaultSelection.registerForMouseMovement(myElement);Jedox.wss.app.environment.defaultSelection.draw();Jedox.wss.app.environment.defaultSelection.getActiveRange().reposBgndMask(false);if(myEvent.button==2||(Ext.isMac&&myEvent.button==0&&Jedox.wss.app.ctrlKeyPressed)){Jedox.wss.mouse.showMainCntxMenu(myEvent)}Jedox.wss.hb.setAllNormal()}if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){var selectedCellCoords=activeBook.getCoordsByCell(myElement),mrgInfoSelCell=activeBook.getMergeInfo(selectedCellCoords[0],selectedCellCoords[1]);env.selectedCell=myElement;env.selectedCellCoords=selectedCellCoords;env.lastRangeStartCoord=env.lastRangeEndCoord=[selectedCellCoords[0],selectedCellCoords[1]];var selCellValue=activeBook.getCellValue(selectedCellCoords[0],selectedCellCoords[1]);env.selectedCellValue=(selCellValue==undefined)?"":selCellValue;var actCellCoords=activeBook.getPixelsByCoords(selectedCellCoords[0],selectedCellCoords[1]),actCellIncCoords=activeBook.getPixelsByCoords(selectedCellCoords[0]+(mrgInfoSelCell&&mrgInfoSelCell[0]?mrgInfoSelCell[1]:1),selectedCellCoords[1]+(mrgInfoSelCell&&mrgInfoSelCell[0]?mrgInfoSelCell[2]:1));activeBook.getCursorField().draw({ulX:actCellCoords[0],ulY:actCellCoords[1],lrX:actCellIncCoords[0],lrY:actCellIncCoords[1]},new Jedox.wss.cls.Point(selectedCellCoords[0],selectedCellCoords[1]))}};Jedox.wss.mouse.initSourceRange=function(cell,ulCoords,lrCoords){if(!lrCoords){lrCoords=ulCoords}var formSel=Jedox.wss.app.environment.formulaSelection;formSel.removeAll();formSel.addRange(new Jedox.wss.cls.Point(ulCoords[0],ulCoords[1]),new Jedox.wss.cls.Point(lrCoords[0],lrCoords[1]));formSel.setActiveRange(formSel.getRanges().length-1);formSel.setState(Jedox.wss.range.AreaState.NEW);if(cell){Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.POINT);formSel.registerForMouseMovement(cell)}formSel.draw()};Jedox.wss.mouse.mouseOnRangeDown=function(myEvent){if(document.all){myEvent=window.event}var env=Jedox.wss.app.environment,myElement=(document.all)?myEvent.srcElement:myEvent.target,srcRngMode=env.inputMode==Jedox.wss.grid.GridMode.DIALOG&&Jedox.wss.app.sourceSel;if(!srcRngMode&&myEvent.button==2&&myElement.className=="rangeMask"){Jedox.wss.mouse.showMainCntxMenu(myEvent);Jedox.wss.keyboard.preventEvent(myEvent);return}var activeBook=Jedox.wss.app.activeBook,rangeStartCoords=env.defaultSelection.getActiveRange().getUpperLeft(),targetCoords=activeBook.getNeighByOffset(rangeStartCoords.getX(),rangeStartCoords.getY(),((document.all)?myEvent.offsetX:myEvent.layerX)+myElement.offsetLeft+4,((document.all)?myEvent.offsetY:myEvent.layerY)+myElement.offsetTop+4),tX=targetCoords[0],tY=targetCoords[1],targetMrgInfo=activeBook.getMergeInfo(tX,tY);if(targetMrgInfo&&!targetMrgInfo[0]){tX=targetMrgInfo[1],tY=targetMrgInfo[2]}if(env.inputMode==Jedox.wss.grid.GridMode.READY){env.defaultSelection.set(new Jedox.wss.cls.Point(tX,tY),new Jedox.wss.cls.Point(tX,tY));if(env.viewMode==Jedox.wss.grid.viewMode.DESIGNER){env.defaultSelection.registerForMouseMovement(targetCoords[2])}env.defaultSelection.draw();env.defaultSelection.getActiveRange().reposBgndMask(false)}if(srcRngMode){Jedox.wss.mouse.initSourceRange(activeBook.getCellByCoords(targetCoords[0],targetCoords[1]),targetCoords)}if((myElement.tagName=="DIV")&&(myElement.className=="rangeMask")){Jedox.wss.keyboard.preventEvent(myEvent)}};Jedox.wss.mouse.checkForResize=function(MyEvent){var Sheet,Column,Row,RowNumeric,MyElement,elemData;if(document.all){MyEvent=window.event}MyElement=(document.all)?MyEvent.srcElement:MyEvent.target;if(Jedox.wss.app.environment.inputMode==Jedox.wss.grid.GridMode.EDIT){return}function checkPosition(){var XOffset=5;var YOffset=4;var activeBook=Jedox.wss.app.activeBook;if(MyElement.parentNode.className=="gridColHdrsIC"){var resizeIndex=(MyElement.className+"").indexOf(" col_resize");var targetX=(document.all)?MyEvent.offsetX:MyEvent.layerX;if((targetX<=XOffset&&(activeBook.getCoordByHdr(Jedox.wss.grid.headerType.COLUMN,MyElement)!=1))||(MyElement.offsetWidth-targetX<=XOffset)){Jedox.wss.app.environment.mousePosition="colResize";if(resizeIndex==-1){MyElement.className+=" col_resize"}}else{Jedox.wss.app.environment.mousePosition="colMark";if(resizeIndex>-1){MyElement.className=MyElement.className.substring(0,resizeIndex)}}}if(MyElement.parentNode.className=="gridRowHdrsIC"){var resizeIndex=(MyElement.className+"").indexOf(" row_resize");var targetY=(document.all)?MyEvent.offsetY:MyEvent.layerY;if((targetY<=YOffset&&(activeBook.getCoordByHdr(Jedox.wss.grid.headerType.ROW,MyElement)!=1))||(MyElement.offsetHeight-targetY<=YOffset)){Jedox.wss.app.environment.mousePosition="rowResize";if(resizeIndex==-1){MyElement.className+=" row_resize"}}else{Jedox.wss.app.environment.mousePosition="rowMark";if(resizeIndex>-1){MyElement.className=MyElement.className.substring(0,resizeIndex)}}}}if((Jedox.wss.app.xPos!=MyEvent.clientX)||(Jedox.wss.app.yPos!=MyEvent.clientY)){if(Jedox.wss.app.mouseButton1Down){if(Jedox.wss.app.environment.headerMarkMode===""){Jedox.wss.mouse.fetchGlobalMouseMove(MyEvent)}}else{Jedox.wss.app.xPos=MyEvent.clientX;Jedox.wss.app.yPos=MyEvent.clientY;checkPosition()}}};Jedox.wss.mouse.fetchMove=function(MouseEvent){if(Jedox.wss.app.maybeDragging||Jedox.wss.app.environment.headerResizeType==Jedox.wss.grid.headerType.COLUMN||Jedox.wss.app.environment.headerResizeType==Jedox.wss.grid.headerType.ROW){return}var Coords=null;if(Jedox.wss.app.environment.lastCell===null){Jedox.wss.app.xPos=MouseEvent.clientX;Jedox.wss.app.yPos=MouseEvent.clientY}else{Coords=Jedox.wss.range.getCellCoord(Jedox.wss.app.environment.lastCell);if(!(Jedox.wss.mouse.MouseIsOnCell(MouseEvent.clientX,MouseEvent.clientY,Coords))){Jedox.wss.app.xPos=MouseEvent.clientX;Jedox.wss.app.yPos=MouseEvent.clientY}}};Jedox.wss.mouse.calcGridScreenCoords=function(ev,el,offsets){if(!offsets){offsets=[0,0]}var viewportPos=Jedox.wss.app.activeBook.getViewportPos(),gridScreenX=ev.clientX-(el.offsetLeft+(document.all?ev.offsetX:ev.layerX)+offsets[0]-viewportPos[0][0]),gridScreenY=ev.clientY-((el.className=="gridCell"?el.parentNode.offsetTop:el.offsetTop)+(document.all?ev.offsetY:ev.layerY)+offsets[1]-viewportPos[0][1]);Jedox.wss.app.environment.gridScreenCoords=[[gridScreenX,gridScreenY],[gridScreenX+viewportPos[1][0]-viewportPos[0][0],gridScreenY+viewportPos[1][1]-viewportPos[0][1]],[(document.all)?document.body.clientWidth:window.innerWidth,(document.all)?document.body.clientHeight:window.innerHeight]]};Jedox.wss.mouse.fetchGlobalMouseDown=function(myMouseEvent){Jedox.wss.app.mouseDownObserver.notify(this,myMouseEvent);if(!Jedox.wss.app.loaded){return}if(document.all){myMouseEvent=window.event}var mouseEl=(document.all)?myMouseEvent.srcElement:myMouseEvent.target,trigCls=["gridCell","rangeEdge","HBRangeBorder","HBSubDataCell"];if(trigCls.indexOf(mouseEl.className)>=0){Jedox.wss.mouse.calcGridScreenCoords(myMouseEvent,mouseEl)}Jedox.wss.app.mouseButton1Down=false;Jedox.wss.app.mouseButton2Down=false;if((document.all&&myMouseEvent.button==1)||(myMouseEvent.button===0)){Jedox.wss.app.mouseButton1Down=true}else{if(myMouseEvent.button==2){Jedox.wss.app.mouseButton2Down=true}}try{var ParentElementId=mouseEl.parentNode.childNodes[0].id;if((typeof(ParentElementId)!="undefined")&&(ParentElementId.length>5)&&(ParentElementId.substring(0,6)!="column")){Jedox.wss.app.maybeDragging=true}else{Jedox.wss.app.maybeDragging=false}}catch(Exception){Jedox.wss.app.maybeDragging=true}};Jedox.wss.mouse.fetchGlobalMouseUp=function(myMouseEvent){Jedox.wss.app.mouseUpObserver.notify(this,myMouseEvent);if(!Jedox.wss.app.loaded){return}if(document.all){myMouseEvent=window.event}var env=Jedox.wss.app.environment;if(env==null){return}if((document.all&&myMouseEvent.button==1)||(myMouseEvent.button===0)){Jedox.wss.app.mouseButton1Down=false;Jedox.wss.app.mouseButton2Down=false;if(env.headerResizeType!=Jedox.wss.grid.headerType.NONE){Jedox.wss.mouse.stopHeaderResize()}}Jedox.wss.app.maybeDragging=false;Jedox.wss.app.mouseButton2Down=false;if(env.headerMarkMode.length>0){Jedox.wss.mouse.hideCursorLayer()}env.headerMarkMode="";env.headerSelected=null;if(env.viewMode!=Jedox.wss.grid.viewMode.USER){env.defaultSelection.getActiveRange().reposBgndMask(true);Jedox.wss.wsel.moveSave()}};Jedox.wss.mouse.fetchGlobalMouseMove=function(MyMouseEvent){Jedox.wss.app.mouseMovementObserver.notify(this,MyMouseEvent);if(!Jedox.wss.app.loaded){return}if(Jedox.wss.app.mimicOvertracking){var elCoords=Jedox.wss.mouse.getGridPos(MyMouseEvent);if(elCoords[0]>0&&elCoords[1]>0){Jedox.wss.mouse.updateLastCell(elCoords[2],[elCoords[0],elCoords[1]])}}if(document.all){MyMouseEvent=window.event}var i;var elem=(document.all)?MyMouseEvent.srcElement:MyMouseEvent.target;var env=Jedox.wss.app.environment;if(env==null){return}Jedox.wss.app.xPos=MyMouseEvent.clientX;Jedox.wss.app.yPos=MyMouseEvent.clientY;var hdrResType=env.headerResizeType;if(hdrResType==Jedox.wss.grid.headerType.COLUMN){Jedox.wss.mouse.doHeaderResize(hdrResType,MyMouseEvent.clientX)}else{if(hdrResType==Jedox.wss.grid.headerType.ROW){Jedox.wss.mouse.doHeaderResize(hdrResType,MyMouseEvent.clientY)}}if(env.headerMarkMode=="column"||env.headerMarkMode=="row"){env.defaultSelection.resizeByHeader(MyMouseEvent)}};Jedox.wss.mouse.appendtoScrollwheel=function(){if(window.addEventListener){window.addEventListener("DOMMouseScroll",Jedox.wss.mouse.fetchWheel,false)}window.onmousewheel=document.onmousewheel=Jedox.wss.mouse.fetchWheel};Jedox.wss.mouse.fetchWheel=function(ev){if(Jedox.wss.app.environment.inputMode!=Jedox.wss.grid.GridMode.DIALOG){var value=0;if(!ev){ev=window.event}if(ev.wheelDelta){value=ev.wheelDelta;if(!(typeof HTMLElement!="undefined"&&HTMLElement.prototype)){value*=-1}}else{if(ev.detail){value=ev.detail}}if(value>0){Jedox.wss.sheet.scrollYBy(1,Jedox.wss.grid.ScrollDirection.DOWN)}else{if(value<0){Jedox.wss.sheet.scrollYBy(1,Jedox.wss.grid.ScrollDirection.UP)}}Jedox.wss.keyboard.preventKeyEvent(ev)}};Jedox.wss.mouse.showCursorLayer=function(cls){var cursorMarker=document.getElementById("CursorMarker");cursorMarker.style.top="0px";cursorMarker.style.left="0px";cursorMarker.style.width=(document.all)?document.body.clientWidth:window.innerWidth+"px";cursorMarker.style.height=(document.all)?document.body.clientHeight:window.innerHeight+"px";cursorMarker.className=cls;cursorMarker.style.display="block"};Jedox.wss.mouse.hideCursorLayer=function(){var cursorMarker=document.getElementById("CursorMarker");cursorMarker.style.width="0px";cursorMarker.style.height="0px";cursorMarker.style.display="none"};Jedox.wss.mouse.startHeaderResize=function(type,elem,coord,cursorOffset){var hdrType=Jedox.wss.grid.headerType;var activeBook=Jedox.wss.app.activeBook;var gridIC=activeBook.getBookIC();var winID=activeBook.getDomId();Jedox.wss.app.environment.headerResizeType=type;Jedox.wss.app.environment.headerResizeCoord=coord;var startMarkerLeft=(type==hdrType.COLUMN)?elem.offsetLeft:0;var startMarkerTop=(type==hdrType.ROW)?elem.offsetTop:-1;var stopMarkerLeft=(type==hdrType.COLUMN)?elem.offsetLeft+elem.offsetWidth:0;var stopMarkerTop=(type==hdrType.ROW)?elem.offsetTop+elem.offsetHeight:-1;var markerHeight=((type==hdrType.COLUMN)?gridIC.offsetHeight:1)+"px";var markerWidth=((type==hdrType.ROW)?gridIC.offsetWidth:1)+"px";var borderTopWidth=(type==hdrType.ROW)?"1px":"0px";var borderLeftWidth=(type==hdrType.COLUMN)?"1px":"0px";var startMarker=document.getElementById("".concat(winID,"_startMarker"));startMarker.style.left=startMarkerLeft+"px";startMarker.style.top=startMarkerTop+"px";startMarker.style.height=markerHeight;startMarker.style.width=markerWidth;startMarker.style.borderTopWidth=borderTopWidth;startMarker.style.borderLeftWidth=borderLeftWidth;startMarker.style.display="block";var stopMarker=document.getElementById("".concat(winID,"_stopMarker"));stopMarker.style.left=stopMarkerLeft+"px";stopMarker.style.top=stopMarkerTop+"px";stopMarker.style.height=markerHeight;stopMarker.style.width=markerWidth;stopMarker.style.borderTopWidth=borderTopWidth;stopMarker.style.borderLeftWidth=borderLeftWidth;stopMarker.style.display="block";this.showCursorLayer((type==hdrType.ROW)?"marker_row_resize":"marker_col_resize");var viewportPos=Jedox.wss.app.activeBook.getViewportPos();if(type==hdrType.ROW){Jedox.wss.app.environment.headerResize=[startMarkerTop,stopMarkerTop,cursorOffset-(stopMarkerTop-viewportPos[0][1]),viewportPos[0][1],viewportPos[1][1],stopMarkerTop]}else{Jedox.wss.app.environment.headerResize=[startMarkerLeft,stopMarkerLeft,cursorOffset-(stopMarkerLeft-viewportPos[0][0]),viewportPos[0][0],viewportPos[1][0],stopMarkerLeft]}};Jedox.wss.mouse.doHeaderResize=function(type,cursorOffset){var hdrRes=Jedox.wss.app.environment.headerResize;var stopMarker=document.getElementById("".concat(Jedox.wss.app.activeBook.getDomId(),"_stopMarker"));var newPos=cursorOffset-hdrRes[2]+hdrRes[3];if(newPos>hdrRes[4]){newPos=hdrRes[1]}else{if(newPos<hdrRes[0]+5){newPos=hdrRes[0]+5}}if(type==Jedox.wss.grid.headerType.COLUMN){stopMarker.style.left=newPos+"px"}else{stopMarker.style.top=newPos+"px"}hdrRes[5]=newPos};Jedox.wss.mouse.stopHeaderResize=function(){var env=Jedox.wss.app.environment;var hdrRes=env.headerResize;var resizedHdr=env.headerResizeCoord;var winID=Jedox.wss.app.activeBook.getDomId();var startMarker=document.getElementById("".concat(winID,"_startMarker"));var stopMarker=document.getElementById("".concat(winID,"_stopMarker"));var hdrCoords=env.defaultSelection.getSelHeaderFromRange(env.headerResizeType,resizedHdr);if(hdrRes[1]!=hdrRes[5]){Jedox.wss.app.activeBook.resizeColRow(env.headerResizeType,hdrCoords,hdrRes[5]-hdrRes[0]);Jedox.wss.hb.setAllNormal(null,true)}startMarker.style.display="none";stopMarker.style.display="none";this.hideCursorLayer();env.headerResizeType=Jedox.wss.grid.headerType.NONE;env.headerResize=[]};Jedox.wss.mouse.autoSizeCell=function(ev){var mousePosition=Jedox.wss.app.environment.mousePosition;if(!(mousePosition=="colResize"||mousePosition=="rowResize")){return}if(document.all){ev=window.event}if(!((document.all&&ev.button==1)||(ev.button===0))){return}var myElement=(document.all)?ev.srcElement:ev.target;var XOffset=5;var YOffset=5;var activeBook=Jedox.wss.app.activeBook;var headerType=Jedox.wss.grid.headerType;var hdrCoords=undefined;if(mousePosition=="colResize"){var selHdr=activeBook.getCoordByHdr(headerType.COLUMN,myElement);var targetOffsetX=(document.all)?ev.offsetX:ev.layerX;if(targetOffsetX<=XOffset){--selHdr}hdrCoords=Jedox.wss.app.environment.defaultSelection.getSelHeaderFromRange(headerType.COLUMN,selHdr)}else{if(mousePosition=="rowResize"){var selHdr=activeBook.getCoordByHdr(headerType.ROW,myElement);var targetOffsetY=(document.all)?ev.offsetY:ev.layerY;if(targetOffsetY<=YOffset){--selHdr}hdrCoords=Jedox.wss.app.environment.defaultSelection.getSelHeaderFromRange(headerType.ROW,selHdr)}}Jedox.wss.app.activeBook.autofitColRow(mousePosition=="colResize"?0:1,hdrCoords)};Jedox.wss.mouse.showMainCntxMenu=function(ev){var defMaxCoords=Jedox.wss.grid.defMaxCoords,env=Jedox.wss.app.environment,selEndCoord=env.lastRangeEndCoord,selType=(selEndCoord[0]==defMaxCoords[0]&&selEndCoord[1]==defMaxCoords[1])?"all":(selEndCoord[0]==defMaxCoords[0])?"row":(selEndCoord[1]==defMaxCoords[1])?"col":null,insItem,delItem;if(selType==null){insItem=new Ext.menu.Item({text:"Insert".localize(),menu:{items:[{text:"Shift cells right".localize(),handler:function(){Jedox.wss.sheet.ins(Jedox.wss.sheet.insDelMode.SHIFT_HOR)}},{text:"Shift cells down".localize(),handler:function(){Jedox.wss.sheet.ins(Jedox.wss.sheet.insDelMode.SHIFT_VER)}},{text:"Entire row".localize(),iconCls:"ico_ins_row",handler:function(){Jedox.wss.action.insDelRowCol("ins","row")}},{text:"Entire column".localize(),iconCls:"ico_ins_column",handler:function(){Jedox.wss.action.insDelRowCol("ins","col")}}]}});delItem=new Ext.menu.Item({text:"Delete".localize(),menu:{items:[{text:"Shift cells left".localize(),handler:function(){Jedox.wss.sheet.del(Jedox.wss.sheet.insDelMode.SHIFT_HOR)}},{text:"Shift cells up".localize(),handler:function(){Jedox.wss.sheet.del(Jedox.wss.sheet.insDelMode.SHIFT_VER)}},{text:"Entire row".localize(),iconCls:"ico_del_row",handler:function(){Jedox.wss.action.insDelRowCol("del","row")}},{text:"Entire column".localize(),iconCls:"ico_del_column",handler:function(){Jedox.wss.action.insDelRowCol("del","col")}}]}})}else{insItem=new Ext.menu.Item({text:"Insert".localize(),handler:function(){Jedox.wss.action.insDelRowCol("ins",selType)},disabled:(selType=="all")});delItem=new Ext.menu.Item({text:"Delete".localize(),handler:function(){Jedox.wss.action.insDelRowCol("del",selType)},disabled:(selType=="all")})}var clpExs=Jedox.wss.app.clipboard==null?false:true,mainCntxMenu=new Ext.menu.Menu({id:"chartContextMenu",cls:"default-format-window",enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}},items:[{text:"Cut".localize(),iconCls:"icon_cut",handler:function(){Jedox.wss.action.cut(false)}},{text:"Copy".localize(),iconCls:"icon_copy",handler:function(){Jedox.wss.action.copy(false)}},{text:"Paste".localize(),iconCls:"icon_paste",disabled:!clpExs,handler:Jedox.wss.action.paste},{text:"Paste Special".localize().concat("..."),disabled:!clpExs,handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.pasteSpecial,[])}},"-",insItem,delItem,"-",{id:"formatCellsContext",text:"Format Cells".localize().concat("..."),iconCls:"icon_edit",handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.formatCells,[])}}].concat(Jedox.wss.hl.rangeContextMenu(ev))});if(env.selectedCellFormula.indexOf("=SPARK")==0){mainCntxMenu.insert(7,new Ext.menu.Item({text:"Edit Micro Chart".localize().concat("..."),iconCls:"icon_insert_chart",handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.microChart,[true])}}))}mainCntxMenu.showAt([ev.clientX,ev.clientY])};Jedox.wss.mouse.getGridPos=function(ev){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,gridScreenCoords=env.gridScreenCoords,gridPosOffset=env.gridPosOffset,firstVCell=activeBook.getCoordsFirstVCell();if(ev.clientX<gridScreenCoords[0][0]||ev.clientX>gridScreenCoords[1][0]||ev.clientY<gridScreenCoords[0][1]||ev.clientY>gridScreenCoords[1][1]){return[0,0]}return activeBook.getNeighByOffset(firstVCell[0],firstVCell[1],ev.clientX-gridScreenCoords[0][0]+gridPosOffset[0],ev.clientY-gridScreenCoords[0][1]+gridPosOffset[1])};Jedox.wss.mouse.mimicCellMouseEvent=function(x,y,evName){var activeBook=Jedox.wss.app.activeBook,cbScrollTo=function(){var target=activeBook.getCellByCoords(x,y);if(document.dispatchEvent){var oEvent=document.createEvent("MouseEvents");oEvent.initMouseEvent(evName,true,true,window,1,1,1,1,1,false,false,false,false,0,target);target.dispatchEvent(oEvent)}else{if(document.fireEvent){target.fireEvent("on".concat(evName))}}};if(!activeBook.isCellVisible(x,y)){if(activeBook._scrollOpPending){return}activeBook.scrollTo([this,cbScrollTo],x,y,true,false)}else{cbScrollTo()}};Jedox.wss.mouse.regHyperlinkHandlers=function(){Jedox.wss.grid.cbReg("hl",[this,Jedox.wss.hl.follow])};Jedox.wss.general=new function(){var that=this;this.startUp=function(){if(Ext.isGecko){Jedox.wss.app.browser="ff"}else{if(Ext.isSafari){Jedox.wss.app.browser="sf"}else{if(Ext.isIE){Jedox.wss.app.browser="ie"}}}Jedox.wss.app.UPRestrictMode=Jedox.wss.app.UPRestrictModeEnabled&&Jedox.wss.app.appMode==Jedox.wss.grid.viewMode.USER&&Jedox.wss.app.standalone;Ext.applyIf(Jedox.wss.i18n.strings,Jedox.wss.tmp.i18n_strings);delete Jedox.wss.tmp.i18n_strings;Jedox.wss.app.dynJSAutoload();window.onresize=Jedox.wss.workspace.resize;document.onkeydown=Jedox.wss.keyboard.checkGlobalInput;document.onkeyup=Jedox.wss.keyboard.fetchGlobalKeyUp;document.onmouseup=Jedox.wss.mouse.fetchGlobalMouseUp;document.onmousedown=Jedox.wss.mouse.fetchGlobalMouseDown;document.onmousemove=Jedox.wss.mouse.fetchGlobalMouseMove;Jedox.wss.app.currFormula=document.getElementById("currFormula");Jedox.wss.app.currCoord=document.getElementById("currCoord");Jedox.wss.backend.ha(WSS);Jedox.wss.backend.studio=new Studio();if(!Jedox.wss.app.serverAvailable){alert("srvNotRespond".localize());return}Jedox.wss.app.mouseMovementObserver=new Jedox.gen.Observer();Jedox.wss.app.mouseUpObserver=new Jedox.gen.Observer();Jedox.wss.app.mouseDownObserver=new Jedox.gen.Observer();Ext.QuickTips.init();var tbarLayouts=Jedox.wss.app.toolbarLayouts;switch(Jedox.wss.app.toolbarLayout){case tbarLayouts.TOOLBAR:Jedox.wss.app.initMenuBar();Jedox.wss.app.initActiveToolbars();break;case tbarLayouts.RIBBON:Jedox.wss.app.initRibbon();break}Jedox.wss.app.initStatusBar();Jedox.wss.palo.utils.registerHandlers();Jedox.wss.hb.regECHandlers();Jedox.wss.mouse.regHyperlinkHandlers();Jedox.wss.app.screenPosition=[0,0];var isUserMode=Jedox.wss.app.appMode==Jedox.wss.grid.viewMode.USER;var wbList=Jedox.wss.backend.ha.getLoadedBooks(),currWbId=Jedox.wss.backend.ha.getCurrWbId(),upRestr=Jedox.wss.app.UPRestrictMode;Jedox.wss.app.workbookList=wbList;if(opener!=null&&isUserMode){try{opener.Jedox.wss.general.switchSuspendMode(true);Jedox.wss.app.userPreview=true}catch(e){}}function spawn(idx){if(idx<0){return that.startUp_post(currWbId)}var wbMeta=wbList[idx][2].length?Ext.util.JSON.decode(wbList[idx][2]):null;if((wbMeta&&wbMeta.hidden)||(upRestr&&wbList[idx][0]!=currWbId)){spawn(idx-1);return}var ghn=wbMeta!=null?{g:wbMeta.group,h:wbMeta.hierarchy,n:wbMeta.node,p:wbMeta.perm,v:wbMeta.hidden===true}:null;Jedox.wss.backend.ha.selectBook(wbList[idx][0],!isUserMode,!(upRestr&&Jedox.wss.app.userPreview));Jedox.wss.book.spawn([this,function(){spawn(idx-1)}],wbList[idx][0],wbMeta!=null?wbMeta.name:wbList[idx][1],ghn)}spawn(wbList.length-1)};this.startUp_post=function(currWbId){var wbList=Jedox.wss.app.workbookList;if(currWbId!=null&&currWbId.length&&currWbId!=wbList[0][0]){Jedox.wss.workspace.showWinByWbId(currWbId)}Jedox.wss.action.adjustToACL();var activeBook=Jedox.wss.app.activeBook;if(activeBook&&activeBook._autoRefresh){Jedox.wss.book.startRefresh(activeBook)}if(!wbList.length&&!currWbId){var preload=Jedox.wss.backend.ha.getPreload();if(preload&&!preload[1]){if(!preload[2].search(/^recovery*/i)){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.recover,[preload[3],[null].concat(preload[0])])}else{Jedox.wss.general.showMsg("Application Error".localize(),"errLoadWB_intro".localize().concat(" ",preload[2].localize()),Ext.MessageBox.ERROR,[this,Jedox.wss.workspace.notifyCloseByMeta,{ghn:{g:preload[0][1],h:preload[0][2],n:preload[0][0]},name:null}])}}}Jedox.wss.app.loaded=true};this.setCurrentCoord=function(){var env=Jedox.wss.app.environment,selCellCoords=env.selectedCellCoords,value=env.defaultSelection.getValue();Jedox.wss.app.currCoord.value=env.selectedRowName+env.selectedAbsColumnName;env.inputField.value=value[0];Jedox.wss.app.currFormula.value=(value[1]!="")?value[1]:that.filterHLTags(selCellCoords[0],selCellCoords[1],value[0],false)};this.setCoords=function(){Jedox.wss.app.currCoord.value=Jedox.wss.app.numberToLetter[Jedox.wss.app.environment.selectedCellCoords[0]]+Jedox.wss.app.environment.selectedCellCoords[1]};this.setInputMode=function(inputMode){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,sheetSel=activeBook?activeBook.getSheetSelector():undefined,modeDesc="";function removeMarkRng(){if(env.copySelection!=null){env.copySelection.removeAll();Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)}}function saveInitVal(){Jedox.wss.app.updateUndoState([0,0]);env.undoValue=env.inputField.value}switch(inputMode){case Jedox.wss.grid.GridMode.EDIT:if(sheetSel){sheetSel.enable(false)}removeMarkRng();saveInitVal();modeDesc="Edit";break;case Jedox.wss.grid.GridMode.INPUT:if(sheetSel){sheetSel.enable(false)}removeMarkRng();saveInitVal();modeDesc="Enter";break;case Jedox.wss.grid.GridMode.POINT:modeDesc="Point";break;default:if(sheetSel){sheetSel.enable(true)}Jedox.wss.app.updateUndoState();modeDesc="Ready"}if(env!=null){env.inputMode=inputMode}Jedox.wss.app.statusBar.setInputMode(modeDesc)};this.mouseDownOnFormFld=function(event){var env=Jedox.wss.app.environment;var range=env.defaultSelection;var gridMode=Jedox.wss.grid.GridMode;function cbMain(){Jedox.wss.app.fromFormulaField=true;Jedox.wss.app.lastInputField=Jedox.wss.app.currFormula;env.formulaSelection.activeToken=null;Jedox.wss.app.currFormula.focus()}function cbInputEdit(){Jedox.wss.keyboard.setFieldSize();cbMain()}if(env.inputMode==gridMode.INPUT){that.setInputMode(gridMode.EDIT)}else{if(env.inputMode!=gridMode.EDIT){var value=range.getValue();env.inputField.value=value[1];that.setInputMode(gridMode.EDIT);Jedox.wss.keyboard.setFieldContent();that.showInputField([this,cbInputEdit],false,true);return}}cbMain()};this.focusOnFormFld=function(event){Jedox.wss.keyboard.setFieldSize()};this.toggleCellLock=function(){var env=Jedox.wss.app.environment;var startCoord=env.lastRangeStartCoord;var endCoord=env.lastRangeEndCoord;var selCoord=env.selectedCellCoords;var activeBook=Jedox.wss.app.activeBook;if(Jedox.wss.app.performItemToggle){activeBook.setRangeLock([startCoord[0],startCoord[1],endCoord[0],endCoord[1]],!activeBook.isCellLocked(selCoord[0],selCoord[1]))}};this.focusInputField=function(){if(Jedox.wss.app.fromFormulaField){Jedox.wss.app.currFormula.focus()}else{var inputField=Jedox.wss.app.environment.inputField,fieldLen=inputField.value.length;inputField[Ext.isSafari?"select":"focus"]();if(document.all){var selRng=document.selection.createRange();selRng.move("character",fieldLen);selRng.select()}else{inputField.setSelectionRange(fieldLen,fieldLen)}}};this.isRngSingleCell=function(){var env=Jedox.wss.app.environment;var rngStartCoords=env.lastRangeStartCoord;var rngEndCoords=env.lastRangeEndCoord;return(rngStartCoords[0]==rngEndCoords[0]&&rngStartCoords[1]==rngEndCoords[1])};this.updateInputFieldPosition=function(){var env=Jedox.wss.app.environment;var inputField=env.inputField;var cursorField=env.cursorField;if(this.isRngSingleCell()){inputField.style.left=cursorField.offsetLeft+"px";inputField.style.top=cursorField.offsetTop+"px"}else{inputField.style.left=cursorField.offsetLeft+(document.all?3:0)+"px";inputField.style.top=cursorField.offsetTop+(document.all?3:0)+"px"}inputField.style.height=cursorField.offsetHeight+"px"};this.showInputField=function(cb,moveToFirstChar,directly,fetchFormula){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,vMode=Jedox.wss.grid.viewMode,inputField=env.inputField,selectedCell=env.selectedCell,selectedCellValue=env.selectedCellValue,selectedCellCoords=env.selectedCellCoords,extraXOffset=(Jedox.wss.app.isIE)?1:0,extraYOffset=(Jedox.wss.app.isIE)?1:0,myPosition,oldValue=null,calculatedCellContent=false;fetchFormula=(fetchFormula==undefined)?true:fetchFormula;inputField.style.visibility="hidden";function delArrForm(formVal){if(formVal.charAt(0)=="{"&&formVal.charAt(formVal.length-1)=="}"){oldValue=formVal;formVal=formVal.substring(1,formVal.length-1)}return formVal}var cbScrollTo=function(){env.editingDirectly=directly;if(env.viewMode==vMode.USER){inputField.style.top=selectedCell.parentNode.offsetTop-1+"px";inputField.style.left=selectedCell.offsetLeft-1+"px";inputField.style.width=selectedCell.offsetWidth-3+"px";inputField.style.height=selectedCell.offsetHeight-4+"px"}else{that.updateInputFieldPosition();inputField.style.height=selectedCell.offsetHeight-(that.isRngSingleCell()?4:5)+"px";inputField.style.borderStyle="none"}var selFormulaSet=(env.selectedCellFormula!="null"&&env.selectedCellFormula.length>0);if(fetchFormula&&env.viewMode==vMode.DESIGNER&&!selFormulaSet){var rngFormulaVal=env.defaultSelection.getValue()[1];if(rngFormulaVal!=env.selectedCellFormula){env.selectedCellFormula=rngFormulaVal;selFormulaSet=true}}inputField.value=env.viewMode==vMode.DESIGNER&&selFormulaSet?delArrForm(env.selectedCellFormula):(selectedCellValue.length?that.filterHLTags(selectedCellCoords[0],selectedCellCoords[1],selectedCellValue,false):" ");Jedox.wss.style.cellTransfer(inputField);var c=selectedCellCoords[0],r=selectedCellCoords[1];if(inputField.style.textAlign==""&&(activeBook.getCellValue(c,r)==undefined||activeBook.getCellFormula(c,r)!=undefined)){inputField.style.textAlign="left"}inputField.style.zIndex="39";inputField.style.display="block";inputField.style.visibility="visible";if(moveToFirstChar){if(document.all){var selRng=document.selection.createRange();selRng.move("character",0);selRng.select()}else{inputField.setSelectionRange(0,0)}}if(env.viewMode!=vMode.USER){Jedox.wss.keyboard.setFieldContent()}else{Jedox.wss.keyboard.setFieldSize()}env.oldValue=(oldValue==null)?inputField.value:oldValue;env.lastInputValue=inputField.value;if(selectedCellValue.length==0&&!selFormulaSet){inputField.value="";if(env.viewMode==vMode.DESIGNER){Jedox.wss.app.currFormula.value=""}}that.focusInputField();if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}};if(env.viewMode==vMode.DESIGNER){if(activeBook._scrollOpPending){return}env.cursorField.style.visibility="hidden";activeBook.scrollTo([this,cbScrollTo],selectedCellCoords[0],selectedCellCoords[1],false,false)}else{cbScrollTo()}};this.addFileMenuEntry=function(entryText){var fixedItemsCount=(Jedox.wss.app.appMode==Jedox.wss.grid.viewMode.USER)?8:13;var itemName=(entryText.length>30)?(entryText.substring(0,14)+"..."+entryText.substring(entryText.length-9)):entryText;var menuPosition=Jedox.wss.app.menubar.fileMenu.items.length-fixedItemsCount+1;Jedox.wss.app.menubar.fileMenu.add({text:menuPosition+". "+itemName+".wss",href:"javascript: Jedox.wss.book.load(null,'"+entryText+"');"})};this.createWorksheetElements=function(){function _load(res){if(!(res instanceof Array)||res[0]!==true){return}res=res[1];var jwdchart=Jedox.wss.dialog.chart,winId=Jedox.wss.app.activeBook.getDomId();for(var chartData,i=res.length-1;i>=0;--i){jwdchart.createChart(false,winId,(chartData=res[i]).e_id,chartData.n_location,chartData.pos_offsets,chartData.size,chartData.subtype)}}Jedox.wss.backend.conn.cmd([this,_load],["wget"],["",[],["e_id","size","subtype","n_location","pos_offsets"],{e_type:"chart"}])};this.refreshWorksheetElements=function(wsElements){var winId=Jedox.wss.app.activeBook.getDomId();var numOfElems=wsElements.length;for(var currDate=new Date(),i=0;i<numOfElems;i++){document.getElementById("".concat(winId,"_ws_element_",wsElements[i])).src="/spreadsheet/root/cc/gen_element.php?wam=".concat(Jedox.wss.app.appModeS,"&id=",wsElements[i],"&ts=",currDate.getTime())}};this.getSysClipboard=function(){var pasteFld=document.getElementById("_paste_field_");return(pasteFld==null)?null:document.getElementById("_paste_field_").value};this.setSysClipboard=function(value){Jedox.wss.app.lastInputModeDlg=Jedox.wss.app.environment.inputMode;that.setInputMode(Jedox.wss.grid.GridMode.DIALOG);if(!document.getElementById("_copy_field_")){_cinput=document.createElement("textarea");_cinput.setAttribute("id","_copy_field_");_cinput.setAttribute("name","_copy_field_");_cinput.setAttribute("style","position: float; width: 1px; height: 1px; user-select: text; -moz-user-select: text; -webkit-user-select: text; z-index: 999;");_cinput.setAttribute("value","1");document.getElementById("mainBody").appendChild(_cinput)}if(Jedox.wss.app.browser=="ie"){var copyfld=document.getElementById("_copy_field_");copyfld.value=value;copyfld.select();document.selection.createRange()}else{var copyfld=document.getElementById("_copy_field_");copyfld.value=value;copyfld.select();copyfld.selectionStart=0;copyfld.selectionEnd=65535}};this.filterHLTags=function(x,y,val,addTags){if(Jedox.wss.app.activeBook==undefined){return val}var valType=Jedox.wss.app.activeBook.getCellType(x,y),hlTag=Jedox.wss.hl.hlTag;if(addTags){if(valType=="h"&&val.search(/^=HYPERLINK\(/)){return hlTag.begin.concat(val,hlTag.end)}}else{if(valType==undefined||valType=="h"){var bStrs=[hlTag.oldBegin,hlTag.begin];for(var bStr in bStrs){if(val.indexOf(bStrs[bStr])==0){return val.replace(bStrs[bStr],"").replace(hlTag.end,"")}}}}return val};this.switchSuspendMode=function(status){if(status){if(!that.switchSuspendModeAlert){that.switchSuspendModeAlert=new Ext.Window({title:"Suspend Mode".localize(),id:"ext-el-mask-suspend-win",cls:"default-format-window",closable:false,autoDestroy:true,plain:true,draggable:false,constrain:true,modal:true,resizable:false,animCollapse:false,width:400,autoHeight:true,layout:"fit",items:[new Ext.Panel({bodyStyle:"padding: 10px; color: #000000; font-size: 9pt; background-color: transparent;",border:false,frame:false,autoHeight:true,layout:"fit",items:[{html:"suspModeMsg".localize(),baseCls:"x-plain"}]})]});Jedox.wss.app.lastInputModeDlg=Jedox.wss.app.environment.inputMode;that.setInputMode(Jedox.wss.grid.GridMode.DIALOG);that.switchSuspendModeAlert.show(this)}}else{if(that.switchSuspendModeAlert){var ha=Jedox.wss.backend.ha,activeBook=Jedox.wss.app.activeBook;ha.selectBook(activeBook.getWbId());ha.selectSheet(activeBook.getWsId(),activeBook.isClone());that.setInputMode(Jedox.wss.app.lastInputModeDlg);Jedox.wss.app.lastInputMode=Jedox.wss.grid.GridMode.READY;activeBook.recalc();that.switchSuspendModeAlert.destroy();that.switchSuspendModeAlert=null}}};this.appUnload=function(){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){try{opener.Jedox.wss.general.switchSuspendMode(false)}catch(e){}}document.getElementById("mainBody").style.display="none"};this.showMsg=function(title,msg,dlgIcon,cb){var env=Jedox.wss.app.environment;function resetInput(){if(env&&env.inputMode==Jedox.wss.grid.GridMode.DIALOG){that.setInputMode(Jedox.wss.app.lastInputModeDlg);Jedox.wss.app.lastInputMode=Jedox.wss.grid.GridMode.READY}if(cb instanceof Array&&cb.length>1){cb[1].apply(cb[0],cb.slice(2))}}if(env&&env.inputMode!=Jedox.wss.grid.GridMode.DIALOG){Jedox.wss.app.lastInputModeDlg=env.inputMode;that.setInputMode(Jedox.wss.grid.GridMode.DIALOG)}Ext.MessageBox.show({title:title,msg:msg,icon:dlgIcon,modal:true,buttons:Ext.MessageBox.OK,fn:resetInput})};this.refreshCursorField=function(){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,cursorField=env.cursorField,selCellCoords=env.selectedCellCoords,cursorValue=typeof selCellCoords[0]!="number"||typeof selCellCoords[1]!="number"?undefined:activeBook.getCellValue(selCellCoords[0],selCellCoords[1]),redrawCursorField;try{redrawCursorField=!cursorValue.search(/^<img src="/)}catch(e){redrawCursorField=false}if(env.viewMode==Jedox.wss.grid.viewMode.USER&&cursorField.style.display!="none"&&activeBook.isCellLocked(selCellCoords[0],selCellCoords[1])){cursorField.style.display="none";return}if(redrawCursorField){env.defaultSelection.getActiveRange().drawActiveCell()}else{Jedox.util.setText(cursorField,cursorValue==undefined?"":that.filterHLTags(selCellCoords[0],selCellCoords[1],cursorValue,false));Jedox.wss.style.cellTransfer(cursorField)}};this.chkState=function(){var env=Jedox.wss.app.environment;if(env&&env.inputMode.inputMode==Jedox.wss.grid.GridMode.DIALOG){throw {key:"wb_in_dlg_mode",params:{}}}if(that.switchSuspendModeAlert){throw {key:"wb_in_suspend_mode",params:{}}}};this.chkHiddenColRow=function(isRow,pos,amount,isInc){var dim=isRow?Jedox.wss.app.activeSheet._rowHeights:Jedox.wss.app.activeSheet._colWidths,maxCoords=Jedox.wss.grid.defMaxCoords[isRow?1:0],dirIdx=isInc?1:-1,foundUnhidden=false;for(var i=pos+amount*dirIdx;isInc?i<=maxCoords:i>=0;i+=dirIdx){if(dim.getElemAt(i)>0){foundUnhidden=true;break}}return foundUnhidden?(isInc?pos+(i-pos):pos-(pos-i)):pos};this.showRecent=function(res,menu,alignEl,alignPos,parentMenu){menu.removeAll();for(var item,name,i=res.length-1,loadRecent=Jedox.wss.book.loadRecent;i>=0;--i){item=res[i].location;name=item.path.substr(item.path.lastIndexOf("/")+1);menu.addMenuItem({text:name,iconCls:"w3s_workbook",ghn:{g:item.group,h:item.hierarchy,n:item.node,nm:name},qtip:item.path,listeners:{afterrender:function(){Ext.QuickTips.register({target:this.getEl(),text:this.initialConfig.qtip,showDelay:500})}},handler:function(item){loadRecent(item)}})}menu.loaded=true;menu.show(alignEl,alignPos,parentMenu)};this.autoCalc=function(state){var conn=Jedox.wss.backend.conn;conn.cmd(conn.dummy_cb,["sac"],[state?1:0]);Jedox.wss.app.autoCalc=state}};Jedox.wss.format.getSample=function(format,val){var numericSeps=Jedox.wss.i18n.separators,l10nBool=Jedox.wss.i18n.bool,reThouSep=new RegExp("\\".concat(numericSeps[1]),"g"),num=numericSeps[0]!="."?val.replace(reThouSep,"").replace(numericSeps[0],"."):val.replace(reThouSep,""),res;if(val===""||val===null||val===undefined){val=""}else{if(!isNaN(num)){val=num*1}else{if(val.toUpperCase()==l10nBool[true]){val=true}else{if(val.toUpperCase()==l10nBool[false]){val=false}}}}res=Jedox.wss.backend.conn.cmd(0,["gfs"],[format,val])[0];return typeof res=="object"&&res[0]==true?res[1]:""};Jedox.wss.style=new function(){var that=this,_conn=Jedox.wss.backend.conn,_re_textAlign=/text-align: *(left|right|center);/i;this.mapJStoCSS={fontWeight:"font-weight",fontStyle:"font-style",textDecoration:"text-decoration",textAlign:"text-align",textIndent:"text-indent",fontSize:"font-size",fontFamily:"font-family",background:"background",backgroundColor:"background-color",backgroundImage:"background-image",color:"color",border:"border",borderTop:"border-top",borderLeft:"border-left",borderRight:"border-right",borderBottom:"border-bottom",whiteSpace:"white-space",verticalAlign:"vertical-align",direction:"direction"};this.mapCSStoJS={"font-weight":"fontWeight","font-style":"fontStyle","text-decoration":"textDecoration","text-align":"textAlign","text-indent":"textIndent","font-size":"fontSize","font-family":"fontFamily",background:"background","background-color":"backgroundColor","background-image":"backgroundImage",color:"color",border:"border","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","white-space":"whiteSpace","vertical-align":"verticalAlign",direction:"direction"};this.fonts=[["Arial","Arial,sans-serif"],["Arial Black","Arial Black,sans-serif"],["Comic Sans MS","Comic Sans MS,cursive"],["Courier New","Courier New,monospace"],["Garamond","Garamond,serif"],["Georgia","Georgia,serif"],["Lucida Console","Lucida Console,monospace"],["Lucida Sans","Lucida Sans,monospace"],["Palantino Linotype","Palantino Linotype,serif"],["Tahoma","Tahoma,sans-serif"],["Times New Roman","Times New Roman,serif"],["Trebuchet MS","Trebuchet MS,sans-serif"],["Verdana","Verdana,sans-serif"]];this.fontCSSMap={"Arial,sans-serif":0,"Arial Black,sans-serif":1,"Comic Sans MS,cursive":2,"Courier New,monospace":3,"Garamond,serif":4,"Georgia,serif":5,"Lucida Console,monospace":6,"Lucida Sans,monospace":7,"Palantino Linotype,serif":8,"Tahoma,sans-serif":9,"Times New Roman,serif":10,"Trebuchet MS,sans-serif":11,"Verdana,sans-serif":12};this.fontSizes=[["8"],["9"],["10"],["11"],["12"],["14"],["16"],["18"],["20"],["22"],["24"],["26"],["28"],["36"],["48"],["72"]];this.colorPalettes={main:["FFFFFF","000000","EEECE1","1F497D","4F81BD","C0504D","9BBB59","8064A2","4BACC6","F79646","F2F2F2","7F7F7F","DDD9C3","6CD9F0","DBE5E1","F2DCDB","EBF1DD","E5E0EC","DBEEF3","FDEADA","D8D8D8","595959","C4BD97","8DB3E2","B8CCE4","E5B9B7","D7E3BC","CCC1D9","B7DDE8","FBD5B5","BFBFBF","3F3F3F","938953","548DD4","95B3D7","D99694","C3D69B","B2A2C7","92CDDC","FAC08F","A5A5A5","262626","494429","17365D","366092","953734","76923C","5F497A","31859B","E36C09","7F7F7F","0C0C0C","1D1B10","0F243E","244061","632423","4F6128","3F3151","205867","974806","C00000","FF0000","FFC000","FFFF00","92D050","00B050","00B0F0","0070C0","002060","7030A0"],extjs:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","969696","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"]};this.defTextAlign={e:"",n:"",s:"left",b:"center",h:"left"};this.borderType={NONE:0,TOP:1,BOTTOM:2,LEFT:4,RIGHT:8,OUT:1|2|4|8,INS_HORIZ:16,INS_VERT:32,INS:16|32,ALL:1|2|4|8|16|32};this.hyperlinkStyle="text-decoration:underline;color:#0000ff;font-style:normal;";this.delHyperlinkStyle="text-decoration:none;color:#000000;";this.convJStoCSS=function(style){if(!(style instanceof Object)||"length" in style){return""}var attr,attrCSS,styleCSS="";for(attr in style){if((attrCSS=that.mapJStoCSS[attr])!==undefined){styleCSS=styleCSS.concat(attrCSS,":",style[attr],";")}}return styleCSS};this.convCSStoJS=function(style){if(style===""){return null}var pair,attrJS,styleJS={},i=-1;style=style.split(";");while((pair=style[++i])!==undefined){pair=pair.split(":");if((attrJS=that.mapCSStoJS[pair[0]])!==undefined){styleJS[attrJS]=pair[1]}}return styleJS};this.set=function(style){var env=Jedox.wss.app.environment,activeSheet=Jedox.wss.app.activeSheet,activePane=activeSheet._aPane,cellCoords=env.selectedCellCoords,defSel=env.defaultSelection,styleCSS=that.convJStoCSS(style),cmdData=[],contentHeight;if(styleCSS==""){return}_conn.createBatch();if(defSel.isSingleCell()){var mi=activePane.getMergeInfo(cellCoords[0],cellCoords[1]);if(mi&&mi[0]){var rangeCoords=[cellCoords[0],cellCoords[1],cellCoords[0]+mi[1]-1,cellCoords[1]+mi[2]-1];activePane.setRangeStyle(rangeCoords,style);cmdData.push([rangeCoords[0],rangeCoords[1],rangeCoords[2],rangeCoords[3],{s:styleCSS}])}else{activePane.setCellStyle(cellCoords[0],cellCoords[1],style);cmdData.push([cellCoords[0],cellCoords[1],cellCoords[0],cellCoords[1],{s:styleCSS}]);if(contentHeight=style.fontSize||style.fontFamily?that.getContentHeight(env.selectedCell):0){activeSheet.adjustRowHeights(cellCoords[1],cellCoords[1],contentHeight)}}}else{for(var corners,rangeCoords,areas=defSel.getRanges(),i=areas.length-1;i>=0;--i){corners=areas[i].getCorners();rangeCoords=[corners[0].getX(),corners[0].getY(),corners[1].getX(),corners[1].getY()];activePane.setRangeStyle(rangeCoords,style);cmdData.push([rangeCoords[0],rangeCoords[1],rangeCoords[2],rangeCoords[3],{s:styleCSS}]);if(contentHeight||(contentHeight==undefined&&(contentHeight=style.fontSize||style.fontFamily?that.getContentHeight(env.selectedCell):0))){activeSheet.adjustRowHeights(rangeCoords[1],rangeCoords[3],contentHeight)}}}if(cmdData.length){_conn.cmd(null,_conn.cmdHdr,cmdData)}_conn.sendBatch(_conn.dummy_cb)};this.setFromBar=function(code,val){var env=Jedox.wss.app.environment,activePane=Jedox.wss.app.activePane,cellStyle=env.selectedCell.style,cellCoords=env.selectedCellCoords,setDefTextAlign=false,style={},textAlign;if(code>=4&&code<=6){if((textAlign=activePane.getCellStyle(cellCoords[0],cellCoords[1]))!=undefined){textAlign=(textAlign=textAlign.match(_re_textAlign))!=null?textAlign[1]:""}else{textAlign=cellStyle.textAlign}}switch(code){case 1:style.fontWeight=cellStyle.fontWeight!="bold"?"bold":"";break;case 2:style.fontStyle=cellStyle.fontStyle!="italic"?"italic":"";break;case 3:style.textDecoration=cellStyle.textDecoration!="underline"?"underline":"";break;case 4:style.textAlign=textAlign!="left"?"left":(setDefTextAlign="");Jedox.wss.app.performItemToggle=false;Jedox.wss.app.toolbar.alignCenter.toggle(false);Jedox.wss.app.toolbar.alignRight.toggle(false);Jedox.wss.app.performItemToggle=true;break;case 5:style.textAlign=textAlign!="center"?"center":(setDefTextAlign="");Jedox.wss.app.performItemToggle=false;Jedox.wss.app.toolbar.alignLeft.toggle(false);Jedox.wss.app.toolbar.alignRight.toggle(false);Jedox.wss.app.performItemToggle=true;break;case 6:style.textAlign=textAlign!="right"?"right":(setDefTextAlign="");Jedox.wss.app.performItemToggle=false;Jedox.wss.app.toolbar.alignLeft.toggle(false);Jedox.wss.app.toolbar.alignCenter.toggle(false);Jedox.wss.app.performItemToggle=true;break;case 7:style.fontSize=val.concat("pt");break;case 8:style.fontFamily=val;break;case 9:style.backgroundColor=val=="transparent"?"":"#".concat(val);break;case 10:style.color="#".concat(val);break;default:return}that.set(style);if(setDefTextAlign===""){env.selectedCell.style.textAlign=that.defTextAlign[activePane.getCellType(cellCoords[0],cellCoords[1])]}that.cellTransfer(env.cursorField)};this.syncBar=function(){var env=Jedox.wss.app.environment;if(env.viewMode==Jedox.wss.grid.viewMode.USER){return}var app=Jedox.wss.app,activeBook=app.activeBook,fTbar=app.toolbar,cellStyle=env.selectedCell.style,fontSize=cellStyle.fontSize.split("pt"),cellCoords=env.selectedCellCoords,textAlign,cellLocked,fontId;if(activeBook!=undefined){if((textAlign=activeBook.getCellStyle(cellCoords[0],cellCoords[1]))!=undefined){textAlign=textAlign.match(_re_textAlign);if(textAlign!=null){textAlign=textAlign[1]}}cellLocked=activeBook.isCellLocked(cellCoords[0],cellCoords[1])}else{textAlign=cellStyle.textAlign,cellLocked=true}app.performItemToggle=false;fTbar.bold.toggle(cellStyle.fontWeight=="bold");fTbar.italic.toggle(cellStyle.fontStyle=="italic");fTbar.underline.toggle(cellStyle.textDecoration=="underline");fTbar.alignLeft.toggle(textAlign=="left");fTbar.alignCenter.toggle(textAlign=="center");fTbar.alignRight.toggle(textAlign=="right");fTbar.lock.toggle(cellLocked);app.performItemToggle=true;fTbar.fontSizes.setValue(fontSize.length==2?fontSize[0]:app.cnfDefaultFontSize);fTbar.fonts.setValue((fontId=that.fontCSSMap[cellStyle.fontFamily])!=undefined?that.fonts[fontId][0]:app.cnfDefaultFont)};this.cellTransfer=function(dstCell,srcCell){var env=Jedox.wss.app.environment,srcCellCoords=env.selectedCellCoords;if(!srcCell){srcCell=env.selectedCell?env.selectedCell:Jedox.wss.app.activeBook.getCellByCoords(srcCellCoords[0],srcCellCoords[1])}if(!srcCell||!srcCell.style){return}dstCell.style.fontWeight=srcCell.style.fontWeight;dstCell.style.fontStyle=srcCell.style.fontStyle;dstCell.style.fontSize=srcCell.style.fontSize;dstCell.style.fontFamily=srcCell.style.fontFamily;dstCell.style.textDecoration=srcCell.style.textDecoration;dstCell.style.color=srcCell.style.color;dstCell.style.whiteSpace=srcCell.style.whiteSpace;dstCell.style.textIndent=srcCell.style.textIndent;dstCell.style.textAlign=srcCell.style.textAlign;dstCell.style.verticalAlign=srcCell.style.verticalAlign;dstCell.style.direction=srcCell.style.direction;dstCell.style.backgroundColor=srcCell.style.backgroundColor;dstCell.style.backgroundImage=srcCell.style.backgroundImage};this.borderStyle2CSS=function(edata){if(!(edata instanceof Object)||"length" in edata||edata.type=="none"){return""}var css=("width" in edata?edata.width:"thin").concat(" ",("type" in edata?edata.type:"solid")," ",("color" in edata?edata.color:"#000000"));return css.replace(/ /g,"")!=""?css:""};this.setBorder=function(bdata){var activeBook=Jedox.wss.app.activeBook,ranges=Jedox.wss.app.environment.defaultSelection.getRanges();_conn.createBatch();for(var mi,range,i=ranges.length-1;i>=0;--i){range=ranges[i].getCoords();if(range[0]==range[2]&&range[1]==range[3]&&(mi=activeBook._aPane.getMergeInfo(range[0],range[1]))&&mi[0]){range[2]+=mi[1]-1,range[3]+=mi[2]-1}if("all" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.ALL,that.borderStyle2CSS(bdata.all)])}if("out" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.OUT,that.borderStyle2CSS(bdata.out)])}if("ins" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.INS,that.borderStyle2CSS(bdata.ins)])}if("top" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.TOP,that.borderStyle2CSS(bdata.top)])}if("bottom" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.BOTTOM,that.borderStyle2CSS(bdata.bottom)])}if("left" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.LEFT,that.borderStyle2CSS(bdata.left)])}if("right" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.RIGHT,that.borderStyle2CSS(bdata.right)])}if("ins_horiz" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.INS_HORIZ,that.borderStyle2CSS(bdata.ins_horiz)])}if("ins_vert" in bdata){_conn.cmd(null,["sbrd"],[range,that.borderType.INS_VERT,that.borderStyle2CSS(bdata.ins_vert)])}}_conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange(),false,false,_conn.Q_STYLE)};this.getBorder=function(){var ranges=Jedox.wss.app.environment.defaultSelection.getRanges(),types=["top","bottom","left","right","ins_horiz","ins_vert"],bdata={},ccmd=[],indices={0:true,1:true,2:true,3:true,4:true,5:true},i,idx,css,len;for(var len=ranges.length,i=0;i<len;++i){ccmd.push(["gbrd",ranges[i].getCoords()])}var res=Jedox.wss.backend.conn.ccmd_s(ccmd);if(!res[0][1].length){return{}}for(i=res.length-1;i>=1;--i){if(!res[i][1].length){indices={};break}for(idx in indices){if(res[i][1][idx]!=res[0][1][idx]){delete indices[idx]}}}res=res[0][1];for(idx in indices){if((css=res[idx])!=""&&(css=css.split(" ")).length==3){bdata[types[idx]]={width:css[0],type:css[1],color:css[2]}}}return bdata};this.getContentHeight=function(div){var old_height=div.style.height,empty_div=false;if(div.innerHTML==""){empty_div=true,div.innerHTML="_"}div.style.height="auto";var height=div.offsetHeight-2;div.style.height=old_height;if(empty_div){div.innerHTML=""}return height}};Jedox.wss.sheet=new function(){var that=this,_json=Ext.util.JSON;this.insDelMode={SHIFT_VER:1,SHIFT_HOR:2,ENTIRE_COL:3,ENTIRE_ROW:4};this.undo=function(){var env=Jedox.wss.app.environment;var gridMode=Jedox.wss.grid.GridMode;if(env.inputMode==gridMode.EDIT||env.inputMode==gridMode.INPUT){env.redoValue=env.inputField.value;env.inputField.value=Jedox.wss.app.currFormula.value=env.undoValue;Jedox.wss.app.updateUndoState([0,1],false);Jedox.wss.app.lastInputField.focus()}else{Jedox.wss.app.activeBook.undo(1)}};this.redo=function(){var env=Jedox.wss.app.environment;var gridMode=Jedox.wss.grid.GridMode;if(env.inputMode==gridMode.EDIT||env.inputMode==gridMode.INPUT){env.inputField.value=Jedox.wss.app.currFormula.value=env.redoValue;Jedox.wss.app.updateUndoState([1,0],false);Jedox.wss.app.lastInputField.focus()}else{Jedox.wss.app.activeBook.redo(1)}};this.freeze=function(crosshairs){var jwgrid=Jedox.wss.grid,activeSheet=Jedox.wss.app.activeSheet,noCH=!(crosshairs instanceof Array);if(noCH&&activeSheet._numPanes>1){var ccmd='[["wdel","",["'.concat(activeSheet._paneConfUid,'"]]]'),menuItemTxt="Freeze Panes".localize()}else{var selCellCoords=Jedox.wss.app.environment.selectedCellCoords,leftTop=activeSheet._aPane._lastDoneDestCell;++leftTop[0];++leftTop[1];if(noCH){if(selCellCoords[0]==1&&selCellCoords[1]==1){return false}crosshairs=[selCellCoords[0]-leftTop[0],selCellCoords[1]-leftTop[1]]}if(crosshairs[0]==0&&crosshairs[1]==0){return false}if(crosshairs[0]&&crosshairs[1]){var panes=[{range:[leftTop[0],leftTop[1],selCellCoords[0]-1,selCellCoords[1]-1],hscroll:false,vscroll:false},{range:[selCellCoords[0],leftTop[1],jwgrid.defMaxCoords[0],selCellCoords[1]-1],hscroll:true,vscroll:false},{range:[leftTop[0],selCellCoords[1],selCellCoords[0]-1,jwgrid.defMaxCoords[1]],hscroll:false,vscroll:true},{range:[selCellCoords[0],selCellCoords[1],jwgrid.defMaxCoords[0],jwgrid.defMaxCoords[1]],hscroll:true,vscroll:true}]}else{if(crosshairs[0]){var panes=[{range:[leftTop[0],1,selCellCoords[1]-1,jwgrid.defMaxCoords[0]],hscroll:false,vscroll:true},{range:[selCellCoords[0],1,jwgrid.defMaxCoords[0],jwgrid.defMaxCoords[1]],hscroll:true,vscroll:true}]}else{if(crosshairs[1]){var panes=[{range:[1,leftTop[1],jwgrid.defMaxCoords[0],selCellCoords[1]-1],hscroll:true,vscroll:false},{range:[1,selCellCoords[1],jwgrid.defMaxCoords[0],jwgrid.defMaxCoords[1]],hscroll:true,vscroll:true}]}}}var conf='{"crosshairs":['.concat(crosshairs[0],",",crosshairs[1],'],"panes":',_json.encode(panes)),ccmd=activeSheet._paneConfUid?'[["wupd","",{"'.concat(activeSheet._paneConfUid,'":',conf,"}}]]"):'[["wadd","",'.concat(conf,',"e_type":"panescnf"}]]'),menuItemTxt="Unfreeze Panes".localize()}var conn=Jedox.wss.backend.conn;conn.setCcmd(ccmd);conn.sendBatch([that,_freeze_post,activeSheet])};function _freeze_post(res,sheet){sheet._book._showSheet(null,sheet._uid,true)}this.select=function(cb,wsId,wbId,selSheet){var book=wbId?Jedox.wss.book.getBookByUid(wbId):Jedox.wss.app.activeBook;if(!book){return}var sheetSel=book._sheetSelector,cbShowSheet=function(){book._showSheet(cb,wsId)};sheetSel.enable(false);sheetSel.freeze(false);sheetSel.selectById(wsId,!selSheet);sheetSel.enable(true);if(selSheet){Jedox.wss.backend.conn.cmd([this,cbShowSheet],["osel"],[2,wsId])}else{cbShowSheet()}};this.ins=function(mode){var activeBook=Jedox.wss.app.activeBook,defRanges=Jedox.wss.app.environment.defaultSelection.getRanges(),ranges=[];for(var mi,range,i=defRanges.length-1;i>=0;--i){range=defRanges[i].getCoords();if(range[0]==range[2]&&range[1]==range[3]&&(mi=activeBook._aPane.getMergeInfo(range[0],range[1]))&&mi[0]){range[2]+=mi[1]-1,range[3]+=mi[2]-1}range.push(mode);ranges.unshift(range)}Jedox.wss.backend.conn.cmd([activeBook,activeBook.exec],["icel"],ranges,activeBook.getRealGridRange())};this.del=function(mode){var activeBook=Jedox.wss.app.activeBook,defRanges=Jedox.wss.app.environment.defaultSelection.getRanges(),ranges=[];for(var mi,range,i=defRanges.length-1;i>=0;--i){range=defRanges[i].getCoords();if(range[0]==range[2]&&range[1]==range[3]&&(mi=activeBook._aPane.getMergeInfo(range[0],range[1]))&&mi[0]){range[2]+=mi[1]-1,range[3]+=mi[2]-1}range.push(mode);ranges.unshift(range)}Jedox.wss.backend.conn.cmd([activeBook,activeBook.exec],["dcel"],ranges,activeBook.getRealGridRange())};this.getMergeState=function(){return Jedox.wss.app.activePane.getMergeState(Jedox.wss.app.environment.defaultSelection.getActiveRange().getCoords())};this.merge=function(){Jedox.wss.app.activePane.merge(Jedox.wss.app.environment.defaultSelection.getActiveRange().getCoords())};this.unMerge=function(){Jedox.wss.app.activePane.merge(Jedox.wss.app.environment.defaultSelection.getActiveRange().getCoords(),true)}};Jedox.wss.book=new function(){var that=this;this.spawn=function(cb,uid,name,ghn){var app=Jedox.wss.app,win=Jedox.wss.workspace.createWindow(name),winId=win.initialConfig._winId;app.books[winId]=app.activeBook=new Jedox.wss.grid.Book(cb,win,uid,ghn);Jedox.wss.action.adjustToACL()};this.create=function(cb){var res=Jedox.wss.backend.ha.loadWorkbook(null);if(!res[0]){Jedox.wss.general.showMsg("Application Error".localize(),"errLoadWB_intro".localize().concat(" ",res[1].localize()),Ext.MessageBox.ERROR);return false}that.spawn(cb,res[1].wbid,res[1].name,null);return true};this.load=function(cb,wb,group,hierarchy,ext,pc){Jedox.wss.general.chkState();if(!ext){ext={appmode:Jedox.wss.app.appMode}}else{ext.appmode=Jedox.wss.app.appMode}var workspace=Jedox.wss.workspace,res=Jedox.wss.backend.ha.loadWorkbook(wb,group,hierarchy,ext);if(!res[0]){if(!res[1].search(/^follHL*/i)){throw res[1]}if(!res[1].search(/^recovery*/i)){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.recover,[res[2],arguments])}else{Jedox.wss.general.showMsg("Application Error".localize(),"errLoadWB_intro".localize().concat(" ",res[1].localize()),Ext.MessageBox.ERROR,[this,Jedox.wss.workspace.notifyCloseByMeta,{ghn:{g:group,h:hierarchy,n:wb},name:null}])}return false}if(pc){pc.params.unshift(res[1][pc.tag]);pc.func.apply(pc.scope,pc.params)}if(res[1].imp&&workspace.chkWinByWbId(res[1].wbid)){if(res[1].wsid){Jedox.wss.sheet.select(cb,res[1].wsid,res[1].wbid)}else{if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}}workspace.showWinByWbId(res[1].wbid)}else{that.spawn(cb,res[1].wbid,res[1].name,(group==undefined||hierarchy==undefined)?null:{g:group,h:hierarchy,n:wb,p:res[1].perm})}return true};this.loadRecent=function(item){var ghn=item.initialConfig.ghn;try{for(var triggers=Jedox.wss.events.triggers.openWorkbook_before,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_before"].call(parent,triggers[i][1],{g:ghn.g,h:ghn.h,n:ghn.n},ghn.nm,false)}Jedox.wss.book.load(null,ghn.n,ghn.g,ghn.h,{vars:true});for(var triggers=Jedox.wss.events.triggers.openWorkbook_after,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_after"].call(parent,triggers[i][1],{g:ghn.g,h:ghn.h,n:ghn.n},ghn.nm)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}};this.save=function(cb){var ghn=Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId())["ghn"];if(ghn==null){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.open,["save",cb]);return}var res=Jedox.wss.backend.ha.saveWorkbook(ghn.g,ghn.h,ghn.n);if(!res[0]){Ext.MessageBox.show({title:"Save".localize(),msg:res[1].localize(res[2]),modal:true,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING,fn:Ext.emptyFn,minWidth:300})}if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}};this.destroy=function(id){var app=Jedox.wss.app;if(app.activeBook==app.books[id]){app.activeBook=undefined}app.books[id]=undefined;Jedox.wss.workspace.cleanupWinClose(id)};this.getBookByUid=function(uid){for(var books=Jedox.wss.app.books,i=books.length-1;i>=0;--i){if(!books[i]){continue}if(books[i]._wbId==uid){return books[i]}}return undefined};this.autoRefresh=function(secs){var activeBook=Jedox.wss.app.activeBook;if(activeBook._autoRefresh){clearTimeout(activeBook._tid_autoRefresh)}activeBook._autoRefresh=secs|=0;if(secs){that.startRefresh(activeBook)}if(activeBook._conf==null){activeBook._conf={e_type:"conf",autoRefresh:secs};var ccmd='[["badd","",{"e_type":"conf","autoRefresh":'.concat(secs,"}]]"),post=[that,function(res){if(res[0][0]){activeBook._conf.e_id=res[0][1][0]}}]}else{activeBook._conf.autoRefresh=secs;var e_id=activeBook._conf.e_id;delete activeBook._conf.e_id;var ccmd='[["bupd","",{"'.concat(e_id,'":',Ext.util.JSON.encode(activeBook._conf),"}]]"),post=null;activeBook._conf.e_id=e_id}var conn=Jedox.wss.backend.conn;conn.setCcmd(ccmd);conn.sendBatch(post)};this.startRefresh=function(book,ms){if(!book._autoRefresh){return}if(typeof ms!="number"){ms=book._autoRefresh*1000}book._tid_autoRefresh=setTimeout(function(){book._aSheet.recalc([that,that.startRefresh,book,ms])},ms)};this.recover=function(win,args){win._execClose=false;win.close();this.load.apply(this,args)};this.goTo=function(ref){ref=Jedox.wss.formula.parse(ref);if(ref.length!=1){return}ref=ref[0];var activeBook=Jedox.wss.app.activeBook,defSel=Jedox.wss.app.environment.defaultSelection;if(ref.sheet.length&&ref.sheet!=activeBook._sheetUids[activeBook._aSheetUid]){return}activeBook.scrollTo(defSel?[defSel,defSel.jumpTo,ref.rng]:null,ref.rng[0],ref.rng[1],true,false)}};Jedox.wss.cndfmt=new function(){var that=this,_borderTypes=["top","bottom","left","right"];this.SCOPE_CURR_SEL=0;this.SCOPE_CURR_WKS=1;this.SCOPE_RULE_IDS=2;this.set=function(rules){var defSel=Jedox.wss.app.environment.defaultSelection,conn=Jedox.wss.backend.conn,fParser=Jedox.wss.formula,jwstyle=Jedox.wss.style,activeBook=Jedox.wss.app.activeBook,rule,style,borders,btype,border,ranges,key,rng,rngs,sets=[],set,j,i=-1;while((rule=rules[++i])!==undefined){set={rule:rule.type.concat("(",rule.operator,rule.sit?";1;)":";0;)")};if("format" in rule&&typeof rule.format=="string"&&rule.format!=""){set.format=rule.format}if("style" in rule&&(style=jwstyle.convJStoCSS(rule.style))!=""){set.style=style}if("lock" in rule&&typeof rule.lock=="boolean"){set.lock=rule.lock}if("borders" in rule&&rule.borders instanceof Object&&!("length" in rule.borders)){borders={};for(btype in rule.borders){if(_borderTypes.indexOf(btype)!=-1&&(border=jwstyle.borderStyle2CSS(rule.borders[btype]))!=""){borders[btype]=border}}for(btype in borders){set.border=borders;break}}if("operands" in rule&&rule.operands instanceof Array&&rule.operands.length){set.operands=rule.operands}ranges=[];if("applies_to" in rule){if("id" in rule){set.id=rule.id}rngs=fParser.parse(rule.applies_to);j=-1;while((rng=rngs[++j])!==undefined){ranges.push(rng.rng)}}else{if("id" in rule){continue}rngs=defSel.getRanges(),j=-1;while((rng=rngs[++j])!==undefined){ranges.push(rng.getCoords())}}if(!ranges.length){continue}set.ranges=ranges;sets.push(set)}if(sets.length){conn.cmd([activeBook,activeBook.exec],["cfset"],defSel.getActiveRange().getActiveCell().getCoords().concat(sets),activeBook.getRealGridRange(),false,false,conn.Q_STYLE|conn.Q_FMT_VAL|conn.Q_FMT|conn.Q_LOCK)}};this.get=function(scope){var defSel=Jedox.wss.app.environment.defaultSelection,conn=Jedox.wss.backend.conn,jwstyle=Jedox.wss.style,params=[],i=-1,rule,rules,ruletmp,css;switch(scope){case that.SCOPE_CURR_SEL:case undefined:var rngs=defSel.getRanges(),ranges=[],rng;while((rng=rngs[++i])!==undefined){ranges.push(rng.getCoords())}if(ranges.length){params.push("",ranges)}break;case that.SCOPE_CURR_WKS:break;default:if(typeof scope=="string"){params.push(scope)}break}rules=conn.cmd(null,["cfget"],params);if(rules[0][0]!==true||!(rules[0][1] instanceof Array)){return[]}rules=rules[0][1];i=-1;while((rule=rules[++i])!==undefined){ruletmp=rule.rule.split("(");delete rule.rule;rule.type=ruletmp[0];ruletmp=ruletmp[1].split(";");rule.operator=ruletmp[0];rule.sit=ruletmp[1]=="1"?true:false;if(typeof rule.style=="string"){rule.style=jwstyle.convCSStoJS(rule.style)}if(rule.format===""){rule.format=null}if(!("border" in rule)){continue}for(btype in rule.border){if((css=rule.border[btype])!=""&&(css=css.split(" ")).length==3){rule.border[btype]={width:css[0],type:css[1],color:css[2]}}else{delete rule.border[btype]}}for(btype in rule.border){rule.borders=rule.border;break}delete rule.border}return rules};this.remove=function(scope,ids){var defSel=Jedox.wss.app.environment.defaultSelection,conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook,params=[];switch(scope){case that.SCOPE_CURR_SEL:case undefined:var rngs=defSel.getRanges(),ranges=[],i=-1,rng;while((rng=rngs[++i])!==undefined){ranges.push(rng.getCoords())}if(ranges.length){params.push("",ranges)}break;case that.SCOPE_CURR_WKS:break;case that.SCOPE_RULE_IDS:if(ids instanceof Array){params.push("",[],ids)}break;default:if(typeof scope=="string"){params.push(scope)}break}conn.cmd([activeBook,activeBook.exec],["cfdel"],params,activeBook.getRealGridRange(),false,false,conn.Q_STYLE|conn.Q_FMT_VAL|conn.Q_FMT|conn.Q_LOCK)}};Jedox.wss.action.copy=function(copyToClp){var env=Jedox.wss.app.environment;if(env.inputMode==Jedox.wss.grid.GridMode.READY){var viewMode=Jedox.wss.grid.viewMode;switch(env.viewMode){case viewMode.DESIGNER:env.defaultSelection.copy(copyToClp);break;case viewMode.USER:if(!env.selectedCellCoords.length){return}var highlightedCell=document.getElementById(Jedox.wss.app.activePane.getDomId().concat("_cursorField"));highlightedCell.style.border="2px solid #F5B800";var cursorValue=Jedox.wss.app.activeBook.getCellValue(env.selectedCellCoords[0],env.selectedCellCoords[1]);if(cursorValue==undefined){cursorValue=""}Jedox.wss.app.clipboard={id:null,op:Jedox.wss.grid.gridOperation.COPY,value:cursorValue};var _highlightBackToNormalCell=function(){highlightedCell.style.border="2px solid #7EADD9"};setTimeout(_highlightBackToNormalCell,300);if(copyToClp){Jedox.wss.general.setSysClipboard(cursorValue)}}}else{var selText=Jedox.util.getSelected(env.inputField);if(selText!=null){Jedox.wss.app.clipboard={id:null,op:Jedox.wss.grid.gridOperation.COPY,value:selText}}}Jedox.wss.action.togglePaste(true)};Jedox.wss.action.cut=function(copyToClp){var env=Jedox.wss.app.environment;if(env.inputMode==Jedox.wss.grid.GridMode.READY){var viewMode=Jedox.wss.grid.viewMode;switch(env.viewMode){case viewMode.DESIGNER:env.defaultSelection.cut(copyToClp);break;case viewMode.USER:var selCellCoords=env.selectedCellCoords;if(selCellCoords.length==0){return}var activeBook=Jedox.wss.app.activeBook,cursorFld=env.cursorField,cursorValue=activeBook.getCellValue(selCellCoords[0],selCellCoords[1]);if(cursorValue==undefined){cursorValue=""}Jedox.wss.app.clipboard={id:null,op:Jedox.wss.grid.gridOperation.CUT,value:cursorValue};if(copyToClp){Jedox.wss.general.setSysClipboard(cursorValue)}Jedox.util.setText(cursorFld,"");activeBook.clrRange([selCellCoords[0],selCellCoords[1],selCellCoords[0],selCellCoords[1]])}}else{var selText=Jedox.util.getSelected(env.inputField);if(selText!=null){Jedox.wss.app.clipboard={id:null,op:Jedox.wss.grid.gridOperation.CUT,value:selText}}}Jedox.wss.action.togglePaste(true)};Jedox.wss.action.paste=function(pasteWhat){var env=Jedox.wss.app.environment;if(env.inputMode==Jedox.wss.grid.GridMode.READY){var viewMode=Jedox.wss.grid.viewMode,chkPasteWhat=function(pW){var contType=Jedox.wss.range.ContentType,defCType=contType.ALL_PASTE;if(!pW){return defCType}for(var cT in contType){if(contType[cT]==pW){return pW}}return defCType};switch(env.viewMode){case viewMode.DESIGNER:env.defaultSelection.paste(chkPasteWhat(pasteWhat));break;case viewMode.USER:var clipboard=Jedox.wss.app.clipboard,clpVal;if(clipboard==null){clpVal=Jedox.wss.general.getSysClipboard()}else{clpVal=clipboard.value}var selCellCoords=env.selectedCellCoords;if(selCellCoords.length==0){return}var activeBook=Jedox.wss.app.activeBook,cursorFld=env.cursorField;activeBook.setCellValue(selCellCoords[0],selCellCoords[1],clpVal)}}};Jedox.wss.action.togglePaste=function(enabled){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){return}var act=enabled?"enable":"disable",menubar=Jedox.wss.app.menubar,toolbar=Jedox.wss.app.toolbar,tbarLayouts=Jedox.wss.app.toolbarLayouts;switch(Jedox.wss.app.toolbarLayout){case tbarLayouts.TOOLBAR:menubar.paste[act]();menubar.pasteSpec[act]();break;case tbarLayouts.RIBBON:toolbar.pasteSpec[act]();break}toolbar.paste[act]()};Jedox.wss.action.closeWindow=function(){if(Jedox.wss.app.environment&&Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER&&Jedox.wss.app.activeBook.isClone()){Jedox.wss.backend.ha.removeCloneWorksheet()}window.onbeforeunload=function(){};window.close()};Jedox.wss.action.refreshWindow=function(){window.onbeforeunload=function(){};window.location.href=window.location.href};Jedox.wss.action.exportToPDF=function(){window.open("/spreadsheet/root/cc/export.php/".concat(escape(Jedox.wss.workspace.activeWin.title),".pdf?format=pdf&wam=",Jedox.wss.app.appModeS),"exp2pdf","directories=no,menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=no")};Jedox.wss.action.exportToHTML=function(){window.open("/spreadsheet/root/cc/export.php/".concat(escape(Jedox.wss.workspace.activeWin.title),".html?format=html&wam=",Jedox.wss.app.appModeS),"exp2html","directories=no,menubar=yes,toolbar=yes,location=no,status=yes,resizable=yes,scrollbars=yes")};Jedox.wss.action.exportToXLSX=function(){var frameID="tmpExportIFrame";var frame=Ext.get("tmpExportIFrame");if(!frame){frame=document.createElement("iframe");frame.id=frameID;frame.name=frameID;frame.className="x-hidden";if(Ext.isIE){frame.src=Ext.SSL_SECURE_URL}document.body.appendChild(frame);if(Ext.isIE){document.frames[frameID].name=frameID}}else{frame=frame.dom}frame.contentWindow.location.href="/spreadsheet/root/cc/export.php/".concat(escape(Jedox.wss.workspace.activeWin.title),".xlsx?format=xlsx&wam=",Jedox.wss.app.appModeS)};Jedox.wss.action.insDelRowCol=function(action,type){var activeBook=Jedox.wss.app.activeBook,env=Jedox.wss.app.environment,selStartCoord=env.lastRangeStartCoord,selEndCoord=env.lastRangeEndCoord,handler;if(action=="ins"){handler=(type=="col")?activeBook.insertCol:activeBook.insertRow}else{handler=(type=="col")?activeBook.deleteCol:activeBook.deleteRow}if(selStartCoord[0]==selEndCoord[0]&&selStartCoord[0]==selEndCoord[0]){var mrgInfo=activeBook.getMergeInfo(selStartCoord[0],selStartCoord[1]);if(mrgInfo&&mrgInfo[0]){selEndCoord=[selStartCoord[0]+mrgInfo[1]-1,selStartCoord[1]+mrgInfo[2]-1]}}var pos=(type=="col")?selStartCoord[0]:selStartCoord[1],cnt=(type=="col")?selEndCoord[0]-selStartCoord[0]+1:selEndCoord[1]-selStartCoord[1]+1;handler.call(activeBook,pos,cnt);env.copySelection.removeAll();Jedox.wss.app.clipboard=null;Jedox.wss.action.togglePaste(false)};Jedox.wss.action.resizeRowCol=function(type,size){var env=Jedox.wss.app.environment,selStartCoord=env.lastRangeStartCoord,selEndCoord=env.lastRangeEndCoord;if(typeof size=="number"&&size>=0){Jedox.wss.app.activeBook.resizeColRow(type,[[selStartCoord[type],selEndCoord[type]]],size)}else{Jedox.wss.app.activeBook.autofitColRow(type,[[selStartCoord[type],selEndCoord[type]]])}};Jedox.wss.action.switchTheme=function(btn,state){if(!state){return}Ext.util.CSS.swapStyleSheet("theme","../lib/ext/resources/css/x".concat(btn.id,".css"));function uncheck(item,index,length){if(item.id!=btn.id){item.setChecked(false)}}Jedox.wss.app[Jedox.wss.app.menubar?"menubar":"toolbar"].themeMenu.items.each(uncheck)};Jedox.wss.action.mergeCells=function(unmerge){var defSelActRng=Jedox.wss.app.environment.defaultSelection.getActiveRange(),defSelCoords=defSelActRng.getCorners();Jedox.wss.app.activeBook.merge([defSelCoords[0].getX(),defSelCoords[0].getY(),defSelCoords[1].getX(),defSelCoords[1].getY()],unmerge)};Jedox.wss.action.clear=function(type){var defSelActRng=Jedox.wss.app.environment.defaultSelection.getActiveRange(),defSelCoords=defSelActRng.getCorners();Jedox.wss.app.activeBook.clrRange([defSelCoords[0].getX(),defSelCoords[0].getY(),defSelCoords[1].getX(),defSelCoords[1].getY()],type)};Jedox.wss.action.newWorkbook=function(){try{for(var triggers=Jedox.wss.events.triggers.newWorkbook_before,i=triggers.length-1;i>=0;i--){triggers[i][0]["newWorkbook_before"].call(parent,triggers[i][1])}Jedox.wss.book.create();for(var triggers=Jedox.wss.events.triggers.newWorkbook_after,i=triggers.length-1,wbMeta=Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId());i>=0;i--){triggers[i][0]["newWorkbook_after"].call(parent,triggers[i][1],wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}};Jedox.wss.action.adjustToACL=function(){if(Jedox.wss.app.appMode==Jedox.wss.grid.viewMode.USER){return}var perms=Jedox.wss.grid.permission,perm=perms.PERM_NONE,menubar=Jedox.wss.app.menubar,toolbar=Jedox.wss.app.toolbar,tbarLayouts=Jedox.wss.app.toolbarLayouts;if(Jedox.wss.app.activeBook!=undefined){var metaData=Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId());perm=metaData.ghn==null?perms.PERM_DELETE:metaData.ghn.p}var act=perm>=perms.PERM_WRITE?"enable":"disable";switch(Jedox.wss.app.toolbarLayout){case tbarLayouts.TOOLBAR:if(menubar.saveItem){menubar.saveItem[act]()}menubar.saveAsItem[act]();break;case tbarLayouts.RIBBON:toolbar.saveAsItem[act]();break}toolbar.saveItem[act]()};Jedox.wss.hb=new function(){var that=this;this.HBMode={DESIGNER:0,QUICKVIEW:1,USER:2};this.addDynarange=function(item,ev){function genHBName(){var env=Jedox.wss.app.environment,cnt=that.getHBCount()+1;while(env.dynaranges["DynaRange".concat(cnt)]!=undefined&&cnt<1000){cnt++}return"DynaRange".concat(cnt)}var dir=item.getId().indexOf("newHBVert")==0?0:1,hbdata={id:genHBName(),dir:dir,drill:true,level:2,border:"1px solid #000000",indent:dir==0};Jedox.wss.palo.utils.openSubsetEditor({mode:1,dynarange:hbdata})};this.delDynarange=function(hbid){var env=Jedox.wss.app.environment,hbs=env.dynaranges;hbs[hbid].remove(true);delete hbs[hbid];env.defaultSelection.show();if(!that.getHBCount()){that.enaDisHBQuickView("disable")}};this.setAllNormal=function(exceptId,redraw){var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook;if(env.HBMode!=that.HBMode.DESIGNER||activeBook==undefined||activeBook.isClone()){return}var hbs=env.dynaranges;for(var hbid in hbs){if(hbid==exceptId){continue}if(redraw){hbs[hbid].redraw()}else{hbs[hbid].show()}}};this.hideAll=function(){var env=Jedox.wss.app.environment;if(env.HBMode!=that.HBMode.QUICKVIEW){return}var hbs=env.dynaranges;for(var hbid in hbs){hbs[hbid].hide()}};this.loadAll=function(){function _load(res){if(!(res instanceof Array)||res[0]!==true){return}res=res[1];var jwgrid=Jedox.wss.grid,activeBook=Jedox.wss.app.activeBook;for(var elem,hbdata,i=res.length-1;i>=0;i--){elem=res[i];hbdata=elem.hbdata;hbdata.wselid=elem.e_id;hbdata.id=elem.id;hbdata._gendata=elem._gendata;hbs[hbdata.id]=new jwgrid.DynarangeSelection(activeBook,hbdata);if(activeBook.isClone()){hbs[hbdata.id].hide();that.syncCntrl(true);that.enaDisHBAdd("disable")}else{hbs[hbdata.id].show();that.syncCntrl(false);that.enaDisHBAdd("enable")}}}var env=Jedox.wss.app.environment,viewMode=Jedox.wss.grid.viewMode,hbs=(env.dynaranges={});switch(env.viewMode){case viewMode.DESIGNER:Jedox.wss.backend.conn.cmd([that,_load],["wget"],["",[],["e_id","id","hbdata","_gendata"],{e_type:"hb"}]);break;case viewMode.USER:env.HBMode=that.HBMode.USER;break}};this.unloadAll=function(){var hbs=Jedox.wss.app.environment.dynaranges;for(var hbid in hbs){hbs[hbid].remove(false)}hbs={}};this.move=function(id,pos){if(Jedox.wss.app.environment.HBMode!=that.HBMode.DESIGNER){return}var hbs=Jedox.wss.app.environment.dynaranges;for(var hbid in hbs){if(hbs[hbid].getProps().wselid==id){hbs[hbid].move(pos);hbs[hbid].redraw();break}}};this.subsetDlgCB=function(hbdata){var env=Jedox.wss.app.environment;if(env.dynaranges[hbdata.id]!=undefined){env.dynaranges[hbdata.id].setProps(hbdata);return}env.defaultSelection.hide();var ulCoord=env.lastRangeStartCoord,lrCoord=env.lastRangeEndCoord;hbdata.src=[ulCoord[0],ulCoord[1],lrCoord[0],lrCoord[1]];env.dynaranges[hbdata.id]=new Jedox.wss.grid.DynarangeSelection(Jedox.wss.app.activeBook,hbdata);that.enaDisHBQuickView("enable")};this.propDlgCB=function(hbdata){Jedox.wss.app.environment.dynaranges[hbdata.id].setProps(hbdata)};this.getHBCount=function(){var cnt=0;for(var fld in Jedox.wss.app.environment.dynaranges){++cnt}return cnt};this.enaDisHBAdd=function(cmd){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){return}var menubar=Jedox.wss.app.menubar,toolbar=Jedox.wss.app.toolbar;if(menubar){menubar.newHBVert[cmd]();menubar.newHBHoriz[cmd]();menubar.userModeView[cmd]()}toolbar.newHBVert[cmd]();toolbar.newHBHoriz[cmd]();toolbar.userModeView[cmd]();that.enaDisHBQuickView(that.getHBCount()?"enable":"disable")};this.enaDisHBQuickView=function(cmd){var menubar=Jedox.wss.app.menubar;if(menubar){menubar.hbQuickView[cmd]()}Jedox.wss.app.toolbar.hbQuickView[cmd]()};this.syncCntrl=function(press){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){return}Jedox.wss.app.performItemToggle=false;var menubar=Jedox.wss.app.menubar;if(menubar){menubar.hbQuickView.setChecked(press,true)}Jedox.wss.app.toolbar.hbQuickView.toggle(press);Jedox.wss.app.performItemToggle=true};this.run=function(btn,state){if(!Jedox.wss.app.performItemToggle||that.getHBCount()<=0){return}var env=Jedox.wss.app.environment,activeBook=Jedox.wss.app.activeBook,HBMode=env.HBMode;if(state){try{env.HBMode=that.HBMode.QUICKVIEW;var hbs=env.dynaranges,hasHbs=false;for(var hbid in hbs){hasHbs=true;break}if(hasHbs){var clnRes=Jedox.wss.backend.ha.addCloneWorksheet();if(clnRes!==false){activeBook.setClone(clnRes)}that.hideAll();activeBook.cb("hb_run",[HBMode==that.HBMode.USER?null:3],[true,false,Jedox.wss.backend.conn.Q_ALL])}that.syncCntrl(true);that.enaDisHBAdd("disable");Jedox.wss.app.statusBar.setWorkingMode("QuickView".localize())}catch(e){env.HBMode=HBMode}}else{try{env.HBMode=that.HBMode.DESIGNER;var sheetSelector=activeBook.getSheetSelector();sheetSelector.action=sheetSelector.actionTypes.UNCLONED;activeBook._actOnSheetSel();that.setAllNormal();that.syncCntrl(false);that.enaDisHBAdd("enable");Jedox.wss.app.statusBar.setWorkingMode("Designer".localize())}catch(e){env.HBMode=HBMode}}};this.regECHandlers=function(){Jedox.wss.grid.cbReg("hb_ec",[that,that.expandCollapse])};this.expandCollapse=function(eventData,hbId,idxPath){var activeBook=Jedox.wss.app.activeBook;activeBook.cb("hb_ec",[hbId,[eventData.c,eventData.r],idxPath],[true,false,Jedox.wss.backend.conn.Q_ALL]);return false}};Jedox.wss.hl=new function(){var that=this;this.hlTag={begin:'<span class="hl" onmouseover="Jedox.wss.hl.toolTip(event, true);" onmouseout="Jedox.wss.hl.toolTip(event, false);">',end:"</span>",oldBegin:'<span class="hl">'};var _dData={dyn:true,link:["abc.wss","abc.wss hl"],text:["Some hyperlink text","Some hyperlink text"],tip:["D3","Some tip"],trans:[{src:["A2:B4",[2,3,4,5]],dst:"A2:B4"},{src:["@var1",50],dst:"A5"},{src:["Sheet1!aaa",50],dst:"Sheet1!A5"},{src:["['value1', 'value2', 'value3']","['value1', 'value2', 'value3']"],dst:"Some const"}]},_sData={dyn:false,link:{type:"obj",value:{type:"local",target:{path:"/Jedox/Financials/DeveLabs-praznici-odmori.pdf",ghnt:{g:"fgrp1",h:"h1",n:"n36",t:"pdf"},sheet:null,range:null}}},text:{type:"ref",value:"D1"},tip:{type:"string",value:"Some tip"},trans:[{src:{type:"range",value:"B7"},dst:{type:"nrange",value:"testnr"}},{src:{type:"range",value:"A2"},dst:{type:"range",value:"Sheet1!A2:B3"}}]};function _sDataToFunc(data){var loc,txt,tip,trans="";function convStrRef(val){var isString=val.type=="string";return(isString?'"':"").concat(val.value,isString?'"':"")}function convSrcDst(type,val){var res="",isDst=type=="dst";switch(val.type){case"range":case"nrange":var rngElems=val.value.split("!",2);if(rngElems.length>1){res=(rngElems[0].indexOf(" ")>=0?"'".concat(rngElems[0],"'"):rngElems[0]).concat("!",rngElems[1])}else{res=val.value}break;case"var":res=(val.value.indexOf("@")?"@":"").concat(val.value);break;case"cval":return'"'.concat(val.value,'"');case"clist":return"\"['".concat(val.value.join("','"),"']\"")}return(isDst?'"':"").concat(res,isDst?'"':"")}if(data.link.type=="ref"){loc=data.link.value}else{switch(data.link.value.type){case"local":switch(data.link.value.target.ghnt.t){case"workbook":var sheetExists=data.link.value.target.sheet!=null,rangeExists=data.link.value.target.range!=null;loc='"'.concat(sheetExists||rangeExists?"[":"",data.link.value.target.path,sheetExists||rangeExists?"]":"",sheetExists?(data.link.value.target.sheet.indexOf(" ")>=0?"'".concat(data.link.value.target.sheet,"'"):data.link.value.target.sheet).concat("!"):"",rangeExists?data.link.value.target.range:"",'"');break;default:loc='"'.concat(data.link.value.target.path,'"');break}break;case"url":loc='"'.concat(data.link.value.target,'"');break}}txt=convStrRef(data.text);tip=convStrRef(data.tip);var sep=Jedox.wss.i18n.separators[2];for(var i=0,trns=data.trans,trnsLen=trns.length;i<trnsLen;i++){if(!trns[i].src||!trns[i].dst){continue}trans=trans.concat(sep,convSrcDst("src",trns[i].src),sep,convSrcDst("dst",trns[i].dst))}return"=HYPERLINK(".concat(loc,sep,txt,sep,tip,trans,")")}function _convertSDataLink(link){var re_inSquareBracket=/^\[[\w\W]*\]/,wbType=link.match(re_inSquareBracket),path=wbType==null?link:wbType[0].substring(1,wbType[0].length-1),isSelf=!path.search(/^[\w\W]*.wss$/)||path.toUpperCase()=="SELF",isLocal=wbType!=null||!path.search(/^\/[\w]*/)||isSelf,locTarget=!isLocal?path:{path:path,ghnt:isSelf?null:Jedox.wss.backend.ha.resolveNodePath(path)};if(isLocal&&!isSelf&&locTarget.ghnt==null){throw"follHLInvalidWB"}if(!isLocal&&!locTarget.length){throw"follHLInvalidURL"}loc={type:"obj",value:{type:isLocal?"local":"url",target:locTarget}};if(isLocal&&(isSelf||loc.value.target.ghnt.t=="workbook")){var selStr=wbType==null?"":link.substr(wbType[0].length);if(selStr.length){var selArr=selStr.split("!");if(selArr.length>1){loc.value.target.sheet=!selArr[0].search(/^'[^']*'$/)?selArr[0].substring(1,selArr[0].length-1):selArr[0];loc.value.target.range=selArr[1]}else{loc.value.target.sheet=null;loc.value.target.range=selArr[0]}}else{loc.value.target.sheet=null;loc.value.target.range=null}}return loc}function _dDataToSData(attr,incTrans){var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;function resolveRef(refStr){if(!refStr.indexOf("@")){var wbVar=conn.cmd(0,["gvar"],[refStr.substr(1)]);if(!wbVar[0][0]||!wbVar[0][1].length){throw"badRef"}return wbVar[0][1]}else{var ref=Jedox.wss.formula.parse(refStr);if(!ref.length){throw"badRef"}ref=ref[0];return activeBook.getCellValue(ref.rng[0],ref.rng[1])}}function getPairVal(val){try{return val[0]==val[1]?val[0]:resolveRef(val[0])}catch(e){return val[0]}}function parseType(val){if(val[0]==val[1]){return"cval"}else{if(!val[0].search(/^\{[\w\W]*\}/)){return"clist"}else{return !val[0].search(/^@/)?"var":(formula.parse(val[0]).length?"range":"nrange")}}}var re_inSquareBracket=/^\[[\w\W]*\]/,loc=attr.link[0]==attr.link[1]?_convertSDataLink(getPairVal(attr.link)):{type:"ref",value:attr.link[0]};var txt=attr.text[0]==attr.text[1]?{type:"string",value:getPairVal(attr.text)}:{type:"ref",value:attr.text[0]};var tip=attr.tip[0]==attr.tip[1]?{type:"string",value:getPairVal(attr.tip)}:{type:"ref",value:attr.tip[0]};var trans=[];if(incTrans===true){for(var i=0,trns=attr.trans,trnsLen=trns.length,inSqareBrack,trnsPair={},formula=Jedox.wss.formula;i<trnsLen;i++,trnsPair={}){if(!trns[i].src||!trns[i].dst||trns[i].src.length<=1||!trns[i].src[0].length){continue}trnsPair.src={type:parseType(trns[i].src),value:trns[i].src[0],rvalue:trns[i].src[1]};trnsPair.dst={type:parseType(trns[i].dst),value:trns[i].dst[0],rvalue:trns[i].dst[1]};trans.push(trnsPair)}}return{dyn:false,link:loc,text:txt,tip:tip,trans:trans}}function _resolveFormula(frm){var activeBook=Jedox.wss.app.activeBook,conn=activeBook._conn,actSheet=activeBook.getSheetSelector().getActiveSheetName(),tmpName="tmp_".concat(Math.ceil(Math.random()*10000000000)),res=conn.cmd(0,["nadd"],[[1,1,{name:tmpName,refers_to:(!frm.search(/^=/)?"":"=").concat(frm),scope:actSheet,comment:"Temporary Named Range"}]]);if(res[0][0]){conn.cmd(0,["ndel"],[res[0][1][0].uuid])}return res[0][0]?[res[0][0],res[0][1][0].uuid,res[0][1][0].value]:res[0]}function _resolveSData(data,incTrans){var resTarget=[],resData=[];if(data.link.type=="ref"){resTarget.push([data.link,"rvalue"]),resData.push(data.link.value)}if(data.text.type=="ref"){resTarget.push([data.text,"rvalue"]),resData.push(data.text.value)}if(data.tip.type=="ref"){resTarget.push([data.tip,"rvalue"]),resData.push(data.tip.value)}if(incTrans===true){for(var i=0,trns=data.trans,trnsLen=trns.length,resTypes="range,nrange,var",parseDst=data.link.type=="obj"&&data.link.value.type=="url",resT=resTarget,resD=resData;i<trnsLen;i++){if(!trns[i].src||!trns[i].dst){continue}if(resTypes.search(trns[i].src.type)>=0){resT.push([trns[i].src,"rvalue"]),resD.push(trns[i].src.value)}if(parseDst&&resTypes.search(trns[i].dst.type)>=0){resT.push([trns[i].dst,"rvalue"]),resD.push(trns[i].dst.value)}}}if(resData.length){var rslVal=_resolveFormula("=RESOLVE(".concat(resData.join(Jedox.wss.i18n.separators[2]),")"));if(!rslVal[0]){throw"resolveError"}for(var j=0,rT=resTarget,rVals=Ext.util.JSON.decode(rslVal[2]),rTLen=resT.length;j<rTLen;j++){rT[j][0][rT[j][1]]=rVals[j]}}if(data.link.type=="ref"){data.link.rvalue=_convertSDataLink(data.link.rvalue)["value"]}return rslVal?rslVal[1]:null}this.set=function(range,hdata){var activeBook=Jedox.wss.app.activeBook,general=Jedox.wss.general,conn=activeBook._conn,cell=activeBook._aPane.getCell(range[0],range[1]),txt="Hyperlink",rslVal=[false];if(hdata.text.type=="string"){txt=hdata.text.value}else{rslVal=_resolveFormula(hdata.text.value);if(rslVal[0]){txt=rslVal[2]}}hdata=["hl",hdata];var rngUpd={a:{mousedown:hdata}};if(cell==undefined||(!cell.t&&(cell.m||cell.s))||"s,h,e".search(cell.t)>=0){rngUpd.v=this.hlTag.begin.concat(txt,this.hlTag.end)}rngUpd.s=Jedox.wss.style.hyperlinkStyle;range.push(rngUpd);conn.createBatch();if(rslVal[0]){conn.cmd(null,["ndel"],[rslVal[1]])}conn.cmd(null,["cdrn",{cm:true}],[range]);conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange(),false,false,conn.Q_VALUE|conn.Q_STYLE|conn.Q_ATTRS);Jedox.wss.app.environment.selectedCellValue=this.hlTag.begin.concat(txt,this.hlTag.end)};this.get=function(range){var cell=Jedox.wss.app.activePane.getCell(range[0],range[1]);if(typeof cell=="object"&&("a" in cell)&&("mousedown" in cell.a)&&cell.a.mousedown[0]=="hl"){return cell.a.mousedown[1]}return undefined};this.remove=function(range){var activeBook=Jedox.wss.app.activeBook,general=Jedox.wss.general,conn=activeBook._conn,cell=activeBook._aPane.getCell(range[0],range[1]);if(!cell){return}var txt=Jedox.wss.general.filterHLTags(range[0],range[1],activeBook.getCellValue(range[0],range[1]),false),rngUpd={s:Jedox.wss.style.delHyperlinkStyle};if(cell.t=="h"){rngUpd.v=txt}range.push(rngUpd);conn.createBatch();conn.cmd(null,["clat"],[[range[0],range[1],range[0],range[1]]]);conn.cmd(null,["cdrn",{cm:true}],[range]);conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange(),false,false,conn.Q_VALUE|conn.Q_FORMULA|conn.Q_STYLE|conn.Q_ATTRS)};this.updateText=function(range,txt){if(Jedox.wss.app.activeBook.getCellType(range[0],range[1])=="h"){var hdata=this.get(range);if(hdata==undefined){return}hdata.text.type="string";hdata.text.value=txt;range.push({a:{mousedown:["hl",hdata]}});Jedox.wss.backend.conn.cmd(0,["cdrn",{cm:true}],[range])}};this.followURL=function(data,target){if(!data.link.value.target.search(/^mailto:*/i)){window.location=data.link.value.target;return false}function getSDVals(val){var resTypes="range,nrange,var,clist",res=val[resTypes.search(val.type)>=0?"rvalue":"value"];return Ext.isArray(res)?res:[res]}var transData={};for(var i=0,trns=data.trans,trnsLen=trns.length,dest;i<trnsLen;i++){if(!trns[i].src||!trns[i].dst||!(dest=getSDVals(trns[i].dst)).length){continue}for(var j=0,k=0,tData=transData,src=getSDVals(trns[i].src),dst=dest,srcLen=src.length;j<srcLen;j++,k++){tData[src[j]]=!dst[k]?dst[k=0]:dst[k]}}transData=Ext.urlEncode(transData);var url=(data.link.value.target.search(/:\/\//)<0?"http://".concat(data.link.value.target):data.link.value.target).replace(/\/$/,"").concat(transData.length?"?".concat(transData):"");if(Jedox.wss.app.standalone){window.open(url,"winURL","directories=yes,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes")}else{try{for(var triggers=Jedox.wss.events.triggers.openURL,i=triggers.length-1,hlURL=url;i>=0;i--){triggers[i][0]["openURL"].call(parent,triggers[i][1],hlURL,target,data.text[data.text.type=="string"?"value":"rvalue"],true)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.localize(),Ext.MessageBox.WARNING)}}return false};this.followOther=function(link,target){if(Jedox.wss.app.standalone){Jedox.wss.general.showMsg("follHLInvalidRef".localize(),"follHLNotSuppInStandalone".localize(),Ext.MessageBox.WARNING)}else{try{for(var triggers=Jedox.wss.events.triggers.openOther,i=triggers.length-1,ghnt=link.target.ghnt;i>=0;i--){triggers[i][0]["openOther"].call(parent,triggers[i][1],ghnt,target,true)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.localize(),Ext.MessageBox.WARNING)}}return false};this.followWb=function(data){var activeBook=Jedox.wss.app.activeBook,showMsg=Jedox.wss.general.showMsg,linkVal=data.link.type=="ref"?data.link.rvalue:data.link.value,rng=[],ext={cbkey:"hl",appmode:Jedox.wss.app.appMode},srcWsId=Jedox.wss.app.activeSheet.getUid();if(linkVal.target.sheet!=null){if(Jedox.wss.app.UPRestrictMode&&linkVal.target.sheet!=activeBook._sheetSelector.getActiveSheetName()){showMsg("follHLTmpDisabledRef".localize(),"follHLTmpDisabledWS".localize(),Ext.MessageBox.WARNING);return false}ext.sheet_name=linkVal.target.sheet}if(linkVal.target.range==null){rng=[1,1,1,1]}else{var rngParsed=Jedox.wss.formula.parse(linkVal.target.range);if(!rngParsed.length){ext.nrange=linkVal.target.range}else{if(rngParsed.length>1){showMsg("follHLInvalidRef".localize(),"follHLInvalidRng".localize(),Ext.MessageBox.WARNING);return false}rng=rngParsed[0].rng}}var transExec=function(params,cb){var conn=Jedox.wss.backend.conn;if(!params[linkVal.target.range]){if(!rng.length){rng=[1,1,1,1]}}else{var paramsNR=!params[linkVal.target.range].search(/^=/)?params[linkVal.target.range].substr(1):params[linkVal.target.range],rngP=Jedox.wss.formula.parse(paramsNR);rng=rngP.length?rngP[0].rng:[1,1,1,1]}if(!data.trans.length){if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}return}var sheetPool={},namedRangePool=[],sheets={},sheetList=Jedox.wss.backend.ha.getSheets(),actSheetId=sheetList[1],actSheetName;for(var i=0,sheetListLen=sheetList[0].length;i<sheetListLen;i+=2){sheets[sheetList[0][i+1]]=sheetList[0][i];if(sheetList[0][i]==sheetList[1]){actSheetName=sheetList[0][i+1]}}var resolveRange=function(range){var refs=Jedox.wss.formula.parse(range);return refs.length==1?refs:false},genSrcData=function(src,len,plVal){var srcVal=src.type=="cval"||src.type=="clist"?src.value:src.rvalue;srcVal=srcVal==null?"":srcVal;srcVal=Ext.isArray(srcVal)?srcVal:[srcVal];var srcObjs=[],res=[];for(var i=0,sArr=srcVal,srcLen=sArr.length;i<srcLen;i++){srcObjs.push(plVal?(sArr[i]==null?"":sArr[i]):{v:sArr[i]==null?"":sArr[i]})}while(res.length<len){res=res.concat(srcObjs)}return res.slice(0,len)},splitRange=function(fullRng){var rngElems=fullRng.split("!",2);return rngElems.length>1?{sheet:rngElems[0],range:rngElems[1]}:{sheet:actSheetName,range:rngElems[0]}},appendRange=function(dstRng,src){dstRng=!dstRng.search(/^=/)?dstRng.substr(1):dstRng;var rngElems=splitRange(dstRng);if(!sheets[rngElems.sheet]){return}var parsedDstRng=resolveRange(rngElems.range);if(!parsedDstRng){return}var dataArr=parsedDstRng[0].rng;dataArr=dataArr.concat(genSrcData(src,(dataArr[2]-dataArr[0]+1)*(dataArr[3]-dataArr[1]+1),false));if(sheetPool[sheets[rngElems.sheet]]){sheetPool[sheets[rngElems.sheet]].rngs.push(dataArr)}else{sheetPool[sheets[rngElems.sheet]]={rngs:[dataArr],vars:[]}}};for(var i=0,trns=data.trans,trnsLen=trns.length,shts=sheets,splitRng=splitRange,sPool=sheetPool,nPool=namedRangePool,genSData=genSrcData,actSId=actSheetId,parsedDstRng,dataArr,rngElems;i<trnsLen;i++){if(!trns[i].src||!trns[i].dst){continue}switch(trns[i].dst.type){case"cval":if(srcWsId!=Jedox.wss.app.activeSheet.getUid()){break}case"range":appendRange(trns[i].dst.value,trns[i].src);break;case"nrange":rngElems=splitRng(trns[i].dst.value);nPool.push({name:rngElems.range,uuid:shts[rngElems.sheet],src:trns[i].src});break;case"var":dataArr=[!trns[i].dst.value.search(/^@/)?trns[i].dst.value.substr(1):trns[i].dst.value,genSData(trns[i].src,1,true)[0]];if(sPool[actSId]){sPool[actSId].vars.push(dataArr)}else{sPool[actSId]={rngs:[],vars:[dataArr]}}break}}if(namedRangePool.length){conn.createBatch();for(var i=0,nrPool=namedRangePool,nrPoolLen=nrPool.length;i<nrPoolLen;i++){conn.cmd(0,["nget"],[[1,1,nrPool[i].name,nrPool[i].uuid==undefined?"":nrPool[i].uuid,true]]);conn.cmd(0,["nget"],[[1,1,nrPool[i].name,"",true]])}for(var i=0,nrRes=conn.sendBatch(),nrResLen=nrRes.length,nrPool=namedRangePool,refTo,refToElems;i<nrResLen;i+=2){if(!nrRes[i][0]&&!nrRes[i+1][0]){continue}try{refTo=nrRes[nrRes[i][0]?i:i+1][1][0].refers_to;appendRange(refTo,nrPool[i/2].src)}catch(e){}}}var execTrans=false;for(var sPoolLen in sheetPool){execTrans=true;break}if(execTrans){conn.createBatch();if(sheetPool[actSheetId]){for(var rngs=sheetPool[actSheetId].rngs,i=rngs.length-1;i>=0;i--){conn.cmd(0,["cdrn",{cm:true}],[rngs[i]])}for(var vars=sheetPool[actSheetId].vars,i=vars.length-1;i>=0;i--){conn.cmd(0,["svar"],vars[i])}delete (sheetPool[actSheetId])}var sheetChanged=false;for(var oSheet in sheetPool){conn.cmd(0,["osel"],[2,oSheet]);sheetChanged=true;for(var rngs=sheetPool[oSheet].rngs,i=rngs.length-1;i>=0;i--){conn.cmd(0,["cdrn",{cm:true}],[rngs[i]])}}if(sheetChanged){conn.cmd(0,["osel"],[2,actSheetId])}if(srcWsId==actSheetId){conn.sendBatch([activeBook,activeBook.exec,cb],activeBook.getRealGridRange(),true,true,conn.Q_VALUE|conn.Q_FORMULA|conn.Q_STYLE|conn.Q_ATTRS)}else{conn.sendBatch(cb)}}};function makeSelection(cb){var env=Jedox.wss.app.environment;if(env.viewMode==Jedox.wss.grid.viewMode.DESIGNER){var defSel=env.defaultSelection;defSel.set(new Jedox.wss.cls.Point(rng[0],rng[1]),new Jedox.wss.cls.Point(rng[2],rng[3]));defSel.draw()}if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}}try{var ghnt=linkVal.target.ghnt;if(ghnt==null){var sheetSelector=activeBook.getSheetSelector(),path=linkVal.target.path,sheetId;if(!path.search(/^[\w\W]*.wss$/)&&path!=Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId()).name){throw"follHLInvalidWB"}var cbTransExec=function(){if(ext.nrange){var conn=Jedox.wss.backend.conn,targSheetId=ext.sheet_name?sheetSelector.getIdByName(ext.sheet_name):sheetSelector.getActiveSheetId();if(!targSheetId){throw"follHLInvalidSheet"}conn.createBatch();conn.cmd(0,["nget"],[[1,1,ext.nrange,targSheetId,true]]);conn.cmd(0,["nget"],[[1,1,ext.nrange,"",true]]);var ngetRes=conn.sendBatch();if(!ngetRes[0][0]&&!ngetRes[1][0]){throw"follHLInvTrgNRange"}var nrRef=ngetRes[ngetRes[0][0]?0:1][1][0].refers_to;if(!nrRef.search(/^=/)){nrRef=nrRef.substr(1)}var nrRefSplit=(!nrRef.search(/^=/)?nrRef.substr(1):nrRef).split("!",2);if(nrRefSplit.length>1){sheetId=sheetSelector.getIdByName(nrRefSplit[0]);nrRefRng=nrRefSplit[1]}else{nrRefRng=nrRefSplit[0]}rngParsed=Jedox.wss.formula.parse(nrRefRng);if(!rngParsed.length){throw"follHLInvTrgNRange"}else{if(rngParsed.length>1){throw"follHLInvTrgNRange"}rng=rngParsed[0].rng}if(nrRefSplit.length>1&&sheetSelector.getActiveSheetId()!=sheetId){if(!sheetId){throw"follHLInvalidSheet"}Jedox.wss.sheet.select([this,makeSelection],sheetId,activeBook._wbId,true)}else{makeSelection()}}else{if(ext.sheet_name){sheetId=sheetSelector.getIdByName(ext.sheet_name);if(!sheetId){throw"follHLInvalidSheet"}if(sheetSelector.getActiveSheetId()!=sheetId){Jedox.wss.sheet.select([this,makeSelection],sheetId,activeBook._wbId,true)}else{makeSelection()}}else{makeSelection()}}};transExec({},[this,cbTransExec])}else{if(Jedox.wss.app.UPRestrictMode){var actBookMetaData=Jedox.wss.workspace.getMetaByWinId(activeBook._winId).ghn;if(actBookMetaData.n!=ghnt.n||actBookMetaData.h!=ghnt.h||actBookMetaData.g!=ghnt.g){showMsg("follHLTmpDisabledRef".localize(),"follHLTmpDisabledWB".localize(),Ext.MessageBox.WARNING);return false}}for(var triggers=Jedox.wss.events.triggers.openWorkbook_before,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_before"].call(parent,triggers[i][1],ghnt,"",true)}function afterWbOpen(){for(var triggers=Jedox.wss.events.triggers.openWorkbook_after,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_after"].call(parent,triggers[i][1],ghnt,Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId()).name)}}if(!Jedox.wss.book.load([this,makeSelection,[this,afterWbOpen]],ghnt.n,ghnt.g,ghnt.h,ext,{tag:"hl",func:transExec,scope:this,params:[]})){return false}}}catch(e){showMsg("follHLInvalidRef".localize(),e.localize(),Ext.MessageBox.WARNING);return false}};this.follow=function(ev,data){if(ev.button==2||(Ext.isMac&&ev.button==0&&Jedox.wss.app.ctrlKeyPressed)){return true}var targEl=(Ext.isGecko2)?ev.explicitOriginalTarget.parentNode:document.elementFromPoint(ev.clientX,ev.clientY);if(targEl==undefined||targEl.tagName.toUpperCase()!="SPAN"||targEl.className!="hl"){return true}try{if(data.dyn){data=_dDataToSData(data,true)}else{var tmpNRId=_resolveSData(data,true)}}catch(e){Jedox.wss.general.showMsg("follHLInvalidRef".localize(),e.localize(),Ext.MessageBox.WARNING);return false}var linkVal=data.link.type=="ref"?data.link.rvalue:data.link.value;if(linkVal.type=="url"){return Jedox.wss.hl.followURL(data,"tab")}if(linkVal.type=="local"){return linkVal.target.ghnt==null||linkVal.target.ghnt.t=="workbook"?Jedox.wss.hl.followWb(data):Jedox.wss.hl.followOther(linkVal,"tab")}return false};this.rangeContextMenu=function(ev){var env=Jedox.wss.app.environment,selStartCoord=env.lastRangeStartCoord,data=this.get([selStartCoord[0],selStartCoord[1]]),dynData=data!=undefined&&data.dyn,insEditCapt=data?"Edit Hyperlink":"Hyperlink",targEl=(Ext.isGecko2)?ev.explicitOriginalTarget.parentNode:document.elementFromPoint(ev.clientX,ev.clientY),isTargHL=!(targEl==undefined||targEl.tagName.toUpperCase()!="SPAN"||targEl.className!="hl"),cntx=["-"];if(data&&isTargHL){if(dynData){data=_dDataToSData(data)}else{var tmpNRId=_resolveSData(data)}var linkVal=data.link.type=="ref"?data.link.rvalue:data.link.value;if(linkVal.type=="url"){if(!Jedox.wss.app.standalone){cntx.push({text:"HLCntxNewTab".localize(),iconCls:"ico_hl_target_tab",handler:function(){Jedox.wss.hl.followURL(data,"tab")}})}cntx.push({text:"HLCntxNewWin".localize(),iconCls:"ico_hl_target_win",handler:function(){Jedox.wss.hl.followURL(data,"win")}})}if(linkVal.type=="local"){if(linkVal.target.ghnt==null||linkVal.target.ghnt.t=="workbook"){cntx.push({text:"Open".localize(),iconCls:"ico_hl_open",handler:function(){Jedox.wss.hl.followWb(data)}})}else{if(!Jedox.wss.app.standalone){if(Jedox.wss.app.fileTypesReg[linkVal.target.ghnt.t]||linkVal.target.ghnt.t=="hyperlink"){cntx.push({text:"HLCntxNewTab".localize(),iconCls:"ico_hl_target_tab",handler:function(){Jedox.wss.hl.followOther(linkVal,"tab")}});cntx.push({text:"HLCntxNewWin".localize(),iconCls:"ico_hl_target_win",handler:function(){Jedox.wss.hl.followOther(linkVal,"win")}})}if("hyperlink,ahview".search(linkVal.target.ghnt.t)<0){cntx.push({text:"Export".localize().concat("..."),handler:function(){Jedox.wss.hl.followOther(linkVal,"export")}})}}}}}if(env.viewMode!=Jedox.wss.grid.viewMode.USER){if(!dynData){cntx.push({text:insEditCapt.localize().concat("..."),iconCls:"ico_hl_insert",handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.openHL)}})}if(data){cntx.push({text:"HLCntxRemove".localize(),iconCls:"ico_hl_remove",handler:function(){Jedox.wss.hl.remove([selStartCoord[0],selStartCoord[1],selStartCoord[0],selStartCoord[1]])}})}}return cntx};this.toolTip=function(ev,show){if(document.all){ev=window.event}var el=document.all?ev.srcElement:ev.target;if(show){var activeBook=Jedox.wss.app.activeBook,elParent=el.parentNode,rng=elParent.id.search(/_cursorField$/)>=0?Jedox.wss.app.environment.selectedCellCoords:activeBook.getCoordsByCell(elParent),data=this.get(rng),tipTitle,tipText;if(!data){return}try{if(data.dyn){data=_dDataToSData(data)}else{var tmpNRId=_resolveSData(data)}tipTitle=data.tip[data.tip.type=="ref"?"rvalue":"value"];if(!tipTitle){tipTitle=data.text[data.text.type=="ref"?"rvalue":"value"]}var linkSrc=data.link.type=="ref"?"rvalue":"value";if(data.link[linkSrc].type=="local"){tipText=!data.link[linkSrc].target.path?"Place in This Document".localize().concat(" - ",!data.link[linkSrc].target.sheet?activeBook.getSheetSelector().getActiveSheetName():data.link[linkSrc].target.sheet):data.link[linkSrc].target.path}else{tipText=data.link[linkSrc].target}}catch(e){tipTitle=tipTitle?tipTitle:"follHLInvalidRef".localize();tipText="HLInvalidRefNotice".localize()}el.tooltip=new Ext.ToolTip({target:el,renderTo:Jedox.wss.app.activePane._domId.concat("_IC"),title:tipTitle,html:tipText,anchor:"left",trackMouse:true,autoDestroy:true,dismissDelay:10000});el.tooltip.anchorEl.hide();el.tooltip.showAt([ev.clientX,ev.clientY])}else{if(el.tooltip){el.tooltip.destroy()}}}};Jedox.wss.wsel={type:{COMBO_BOX:"ComboBox",CHECK_BOX:"CheckBox",BUTTON:"Button"},contIdSrc:"activeSheet",moveRegistry:[],add:function(conf){try{var el=new Jedox.wss.wsel[conf.type](conf)}catch(e){return[false].concat(e)}return[true]},update:function(conf){var elem=Ext.getCmp(Jedox.wss.app[this.contIdSrc]._domId.concat("_",conf.type,"_",conf.id));if(elem){try{elem.wsel.update(conf)}catch(e){return[false].concat(e)}}else{return[false,"formel_no_el",{}]}return[true]},loadAll:function(){function _load(res){if(!(res instanceof Array)||res[0]!==true){return}function setUpdObj(updObj,formEl){if(!formEl.n_target_ref){updObj[formEl.e_id]={n_target_ref:"=".concat(formEl.data.trange.length?formEl.data.trange:formEl.data.tnamedrange)};var loc=formEl.n_location.split(",",2);if(loc.length>1){updObj[formEl.e_id]["n_location"]=loc[0]}}if(formEl.data.tvar==undefined){formEl.data.tvar="";if(updObj[formEl.e_id]){updObj[formEl.e_id]["data"]=formEl.data}else{updObj[formEl.e_id]={data:formEl.data}}}}function fixDims(type,conf){var minDims=Jedox.wss.wsel[type]["minDims"];if(conf.width<minDims.w){conf.width=minDims.w}if(conf.height<minDims.h){conf.height=minDims.h}}res=res[1];for(var formEl,rng,tlXY,lrXY,offsets,updObj={},i=res.length-1,activeBook=Jedox.wss.app.activeBook,windowId=activeBook.getWinId(),conf;i>=0;i--){formEl=res[i];conf={id:formEl.e_id,type:formEl.formel_type,name:formEl.formel_name,winId:windowId};switch(formEl.formel_type){case this.type.COMBO_BOX:conf.src=formEl.n_refers_to;conf.treeVal=formEl.n_get_val;conf.targetVal=formEl.n_target_val!=undefined?(formEl.n_target_val instanceof Array?formEl.n_target_val[0]:formEl.n_target_val):null;conf.trange=formEl.data.trange;conf.tnamedrange=formEl.data.tnamedrange;conf.selval=formEl.data.selval;conf.selpath=formEl.data.selpath;conf.formulaEnabled=formEl.n_use_locale;setUpdObj(updObj,formEl);conf.tvar=formEl.data.tvar;break;case this.type.CHECK_BOX:conf.targetVal=formEl.n_target_val!=undefined?formEl.n_target_val:null;conf.trange=formEl.data.trange;conf.tnamedrange=formEl.data.tnamedrange;conf.state=formEl.data.selval;conf.label=formEl.data.label;setUpdObj(updObj,formEl);conf.tvar=formEl.data.tvar;break;case this.type.BUTTON:conf.label=formEl.data.label;break}conf.macros=formEl.macros?formEl.macros:{};rng=this.getRngFromNLoc(formEl.n_location);tlXY=activeBook.getPixelsByCoords(rng[0],rng[1]);lrXY=activeBook.getPixelsByCoords(rng[2],rng[3]);offsets=formEl.pos_offsets;conf.top=tlXY[1]+offsets[1];conf.left=tlXY[0]+offsets[0];conf.height=lrXY[1]+offsets[3]-(tlXY[1]+offsets[1]);conf.width=lrXY[0]+offsets[2]-(tlXY[0]+offsets[0]);fixDims(formEl.formel_type,conf);this.add(conf)}for(var updItem in updObj){Jedox.wss.backend.conn.cmd(null,["wupd"],["",updObj]);break}}Jedox.wss.backend.conn.cmd([this,_load],["wget"],["",[],["e_id","formel_type","formel_name","n_refers_to","n_get_val","n_target_ref","n_target_val","n_location","n_use_locale","pos_offsets","macros","data"],{e_type:"formel"}])},unloadAll:function(){var res=Jedox.wss.backend.conn.cmd(0,["wget"],["",[],["e_id","formel_type","formel_name"],{e_type:"formel"}])[0];if(!res[0]){return}for(var elems=res[1],i=elems.length-1,elem;i>=0;i--){elem=Ext.getCmp(elems[i].formel_type.concat("_",elems[i].e_id));if(elem){elem.wsel.unload()}}},refreshAll:function(data){for(var elems=data,i=elems.length-1,elem;i>=0;i--){elem=Ext.getCmp(Jedox.wss.app[this.contIdSrc]._domId.concat("_",elems[i].type,"_",elems[i].id));if(elem){try{elem.wsel.refresh(elems[i].val)}catch(e){}}}},updateTarget:function(data){for(var elems=data,i=elems.length-1,elem;i>=0;i--){elem=Ext.getCmp(Jedox.wss.app[this.contIdSrc]._domId.concat("_",elems[i].formel_type,"_",elems[i].e_id));if(elem){try{elem.wsel.updateTarget(elems[i])}catch(e){}}}},formelMoveTo:function(wsel){var elem=Ext.getCmp(Jedox.wss.app[this.contIdSrc]._domId.concat("_",wsel.formel_type,"_",wsel.id));if(elem){try{elem.wsel.move(wsel)}catch(e){}}},countEl:function(elType){return Jedox.wss.backend.conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_type:elType}])[0][1].length},getNLoc:function(x,y,w,h){var n2l=Jedox.wss.app.numberToLetter,activeBook=Jedox.wss.app.activeBook,tlCellCords=activeBook.getNeighByOffset(1,1,x,y),tlOffsetXY=activeBook.getPixelsByCoords(tlCellCords[0],tlCellCords[1]),lrCellCoords=activeBook.getNeighByOffset(1,1,x+w,y+h),lrOffsetXY=activeBook.getPixelsByCoords(lrCellCoords[0],lrCellCoords[1]);return{pos_offsets:[x-tlOffsetXY[0],y-tlOffsetXY[1],x+w-lrOffsetXY[0],y+h-lrOffsetXY[1]],n_location:"=$".concat(n2l[tlCellCords[0]],"$",tlCellCords[1],":$",n2l[lrCellCoords[0]],"$",lrCellCoords[1])}},getTLSize:function(pos,offsets){var activeBook=Jedox.wss.app.activeBook,offsetsAdjusted=false;var tlXY=activeBook.getPixelsByCoords(pos[0],pos[1]),brXY=activeBook.getPixelsByCoords(pos[2],pos[3]);var cellDims=activeBook.getCellDims(pos[0],pos[1]);if(offsets[0]<0||offsets[0]>cellDims[0]){offsetsAdjusted=true;offsets[0]=0}if(offsets[1]<0||offsets[1]>cellDims[1]){offsetsAdjusted=true;offsets[1]=0}cellDims=activeBook.getCellDims(pos[2],pos[3]);if(offsets[2]<0||offsets[2]>cellDims[0]){offsetsAdjusted=true;offsets[0]=cellDims[0]}if(offsets[3]<0||offsets[3]>cellDims[1]){offsetsAdjusted=true;offsets[1]=cellDims[1]}var w=brXY[0]+offsets[2]-(tlXY[0]+offsets[0]),h=brXY[1]+offsets[3]-(tlXY[1]+offsets[1]);return{tl:[tlXY[0]+offsets[0],tlXY[1]+offsets[1]],size:[w,h],_error:offsetsAdjusted}},getRngFromNLoc:function(n_loc){var refs=Jedox.wss.formula.parse(n_loc);if(!refs.length){return undefined}var rng=refs[0].rng;if(refs.length>1&&n_loc.indexOf(":")==-1){rng[2]=refs[1].rng[2];rng[3]=refs[1].rng[3]}return rng},moveTo:function(wrapId,pos,offsets){var tlOffsetXY=Jedox.wss.app.activeBook.getPixelsByCoords(pos[0],pos[1]),newX=tlOffsetXY[0]+offsets[0],newY=tlOffsetXY[1]+offsets[1],wrapElem=Ext.get(wrapId);wrapElem.dom.style.left="".concat(newX,"px");wrapElem.dom.style.top="".concat(newY,"px")},moveSave:function(){for(var moveReg=this.moveRegistry,i=moveReg.length-1;i>=0;i--){moveReg[i][1].call(moveReg[i][0],moveReg[i][2])}this.moveRegistry=[]},assignMacro:function(data){var elem=Ext.getCmp(Jedox.wss.app[this.contIdSrc]._domId.concat("_",data.type,"_",data.id));if(elem){try{elem.wsel.assignMacro(data.macros)}catch(e){return[false].concat(e)}}else{return[false,"formel_no_el",{}]}return[true]}};Jedox.wss.wsel.Base=(function(){return function(conf){var that=this;this.conf=conf;this.elConstr={up:0,down:0,left:0,right:0,vportPos:[],lrCornerPx:[]};this.handleElementMove=false;this.isUserMode=(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER);this.gContId=Jedox.wss.app.activeSheet._domId}})();Jedox.wss.wsel.Base.prototype={calcConstraints:function(){var activeBook=Jedox.wss.app.activeBook,defMaxCoords=Jedox.wss.grid.defMaxCoords;this.elConstr.vportPos=activeBook.getViewportPos();if(this.conf.left<0||this.conf.top<0){this.elConstr.left=parseInt(this.elConstr.vportPos[0][0]+(this.elConstr.vportPos[1][0]-this.elConstr.vportPos[0][0]-this.conf.width)/2);this.elConstr.up=parseInt(this.elConstr.vportPos[0][1]+(this.elConstr.vportPos[1][1]-this.elConstr.vportPos[0][1]-this.conf.height)/2);this.conf.left=this.elConstr.left;this.conf.top=this.elConstr.up}else{this.elConstr.left=this.conf.left;this.elConstr.up=this.conf.top}this.elConstr.lrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);this.elConstr.right=this.elConstr.lrCornerPx[0]-this.elConstr.left-this.conf.width;this.elConstr.down=this.elConstr.lrCornerPx[1]-this.elConstr.up-this.conf.height},beforeShowCtxMenu:function(){},onFormelMouseDown:function(e){var activeBook=Jedox.wss.app.activeBook,defMaxCoords=Jedox.wss.grid.defMaxCoords,env=Jedox.wss.app.environment;if(activeBook!=this.conf.winId){Jedox.wss.workspace.showWin(this.conf.winId)}if(e.button==2||(Ext.isMac&&e.button==0&&Jedox.wss.app.ctrlKeyPressed)||(Ext.isWebKit&&e.button==1)){this.beforeShowCtxMenu();this.handleElementMove=false;this.showContextMenu(e);e.stopEvent()}else{Jedox.wss.app.mouseMovementObserver.subscribe(this.onFormelMouseMove,this);var bEv=e.browserEvent;var el=(document.all)?bEv.srcElement:bEv.target;var newVportPos=activeBook.getViewportPos();var newLrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);if(env.winStateMax){var vportDiff={h:newVportPos[0][0]-this.elConstr.vportPos[0][0],v:newVportPos[0][1]-this.elConstr.vportPos[0][1]};var lrCornerPxDiff={h:newLrCornerPx[0]-this.elConstr.lrCornerPx[0],v:newLrCornerPx[1]-this.elConstr.lrCornerPx[1]};this.formelWrapper.setXConstraint(this.elConstr.left+vportDiff.h,(this.elConstr.right-vportDiff.h)+lrCornerPxDiff.h);this.formelWrapper.setYConstraint(this.elConstr.up+vportDiff.v,(this.elConstr.down-vportDiff.v)+lrCornerPxDiff.v)}else{var leftConstr=this.elConstr.left-((bEv.clientX-(el.parentNode.offsetLeft+((document.all)?bEv.offsetX:bEv.layerX)-newVportPos[0][0]))-env.gridScreenCoordsMax[0])+newVportPos[0][0];this.formelWrapper.setXConstraint(leftConstr,newLrCornerPx[0]-leftConstr-this.conf.width);var topConstr=this.elConstr.up-((bEv.clientY-(el.parentNode.offsetTop+((document.all)?bEv.offsetY:bEv.layerY)-newVportPos[0][1]))-env.gridScreenCoordsMax[1])+newVportPos[0][1];this.formelWrapper.setYConstraint(topConstr,newLrCornerPx[1]-topConstr-this.conf.height)}Jedox.wss.wsel.moveRegistry.push([this,this.onFormelMouseUp,el]);this.handleElementMove=true}},onFormelMouseUp:function(el){Jedox.wss.app.mouseMovementObserver.unsubscribe(this.onFormelMouseMove);if(!this.handleElementMove){return}var targetId=this.gContId.concat("_formel_cont_",this.conf.id,"-rzwrap");while(el.id!=targetId){el=el.parentNode}var newLeft=el.offsetLeft,newTop=el.offsetTop,elWidth=el.offsetWidth,elHeight=el.offsetHeight,conf=this.conf,elem=this.elem;if(newLeft!=this.conf.left||newTop!=this.conf.top){elem.disable();try{elem.enable();elem.collapse()}catch(e){}conf.left=newLeft;conf.top=newTop;var nLoc=Jedox.wss.wsel.getNLoc(newLeft,newTop,elWidth,elHeight),formelData={};if(conf.trange&&conf.trange.length){nLoc.n_location=nLoc.n_location.concat(",",conf.trange)}formelData[conf.id]=nLoc;var conn=Jedox.wss.backend.conn;conn.cmd(conn.dummy_cb,["wupd"],["",formelData])}this.handleElementMove=false},onFormelMouseMove:function(){try{this.elem.collapse()}catch(e){}Jedox.wss.app.mouseMovementObserver.unsubscribe(this.onFormelMouseMove)},afterFormelResize:function(wrapper,newWidth,newHeight,e){var wrapperEl=wrapper.getEl(),elLeft=wrapperEl.getLeft(true),elTop=wrapperEl.getTop(true);if(this.conf.width!=newWidth){this.elConstr.right+=this.conf.width-newWidth}if(this.conf.height!=newHeight){this.elConstr.down+=this.conf.height-newHeight}this.setCmpSize(newWidth,newHeight);wrapper.dynamic=!this.isUserMode;var formelData={};formelData[this.conf.id]=Jedox.wss.wsel.getNLoc(elLeft,elTop,newWidth,newHeight);var conn=Jedox.wss.backend.conn;conn.cmd(conn.dummy_cb,["wupd"],["",formelData])},beforeFormelResize:function(wrapper,e){wrapper.dynamic=false},refresh:function(data){return}};Jedox.wss.wsel.FormBase=(function(){return function(conf){Jedox.wss.wsel.FormBase.parent.constructor.call(this,conf)}})();Jedox.util.extend(Jedox.wss.wsel.FormBase,Jedox.wss.wsel.Base);Jedox.wss.wsel.FormBase.trgTypes={RNG:"trange",NRNG:"tnamedrange",VAR:"tvar"};clsRef=Jedox.wss.wsel.FormBase;clsRef.prototype.updateDependencies=function(){var activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,env=Jedox.wss.app.environment;if(this.conf.trange.length>0){var destRng=Jedox.wss.formula.parse(this.conf.trange)[0];if(destRng.sheet.length&&destRng.sheet!=activeBook._sheetSelector.getActiveSheetName()){var actSheetId=Jedox.wss.app.activeSheet._uid,tSheetId=activeBook._sheetSelector.getIdByName(destRng.sheet);conn.cmd(0,["osel"],[2,tSheetId])}conn.cmd(0,["cdrn"],[{cm:true},destRng.rng.concat({v:this.conf.selval})]);if(tSheetId){conn.cmd(0,["osel"],[2,actSheetId])}}if(this.conf.tnamedrange.length>0){var actCellCoords=(env.viewMode==Jedox.wss.grid.viewMode.USER)?[1,1]:env.selectedCellCoords;conn.cmd(0,["nupd"],[[[this.conf.tnamedrange,Jedox.wss.app.activeSheet.getUid()],actCellCoords[0],actCellCoords[1],{refers_to:"=".concat(typeof this.conf.selval=="string"?Ext.util.JSON.encode(this.conf.selval):this.conf.selval)}]])}if(this.conf.tvar.length>0){conn.cmd(null,["svar"],[this.conf.tvar,this.conf.selval])}};clsRef.prototype._getMacroData=function(){return{id:this.conf.id,type:this.conf.type,name:this.conf.name,macros:this.conf.macros}};clsRef.prototype.showContextMenu=function(e){var that=this,contextMenu=new Ext.menu.Menu({id:"formelContextMenu",enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}},items:[{text:"formel_edit".localize({type:this.conf.type}).concat("..."),iconCls:"icon_edit",handler:function(){that.edit.call(that)}},{text:"formel_delete".localize({type:this.conf.type}),iconCls:"icon_delete",handler:function(){that.remove.call(that)}},"-",{text:"Assign Macro".localize().concat("..."),iconCls:"icon_macro",handler:function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.insertMacro,[that._getMacroData.call(that)])}}]});var coords=e.getXY();contextMenu.showAt([coords[0],coords[1]])};clsRef.prototype.edit=function(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.formatControl,[this.conf])};clsRef.prototype.remove=function(){var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;this.elem.destroy();this.formelWrapperEl.remove();if(this.conf.tnamedrange.length>0){var ngetRes=conn.cmd(0,["nget"],[[1,1,this.conf.tnamedrange,Jedox.wss.app.activeSheet.getUid()]])[0]}conn.createBatch();if(this.conf.tnamedrange.length>0&&ngetRes[0]){conn.cmd(0,["ndel"],[ngetRes[1][0].uuid])}conn.cmd(0,["wdel"],["",[this.conf.id]]);conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())};clsRef.prototype.unload=function(){var env=Jedox.wss.app.environment,viewMode=Jedox.wss.grid.viewMode,gridIC=Jedox.wss.app.activeBook.getBookIC();try{if(env.viewMode==viewMode.DESIGNER||env.viewMode==viewMode.PREVIEW){this.elem.destroy();gridIC.removeChild(document.getElementById(this.gContId.concat("_formel_cont_",this.conf.id,"-rzwrap")));gridIC.removeChild(document.getElementById(this.gContId.concat("_formel_cont_",this.conf.id,"-rzwrap-rzproxy")))}else{gridIC.removeChild(document.getElementById(this.gContId.concat("_formel_cont_",this.conf.id)))}}catch(e){}};clsRef.prototype.assignMacro=function(macros){var updObj={};updObj[this.conf.id]={macros:macros};if(!Jedox.wss.backend.conn.cmd(0,["wupd"],["",updObj])){throw ["formel_assign_macro_err",{}]}this.conf.macros=macros};clsRef.prototype.isCmpMoved=function(comp){if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.USER){return false}var targetEl=comp.getEl().dom,targetId=this.gContId.concat("_formel_cont_",this.conf.id,"-rzwrap");while(targetEl.id!=targetId){targetEl=targetEl.parentNode}return targetEl.offsetTop!=this.conf.top||targetEl.offsetLeft!=this.conf.left};clsRef.prototype.move=function(data){var tlOffsetXY=Jedox.wss.app.activeBook.getPixelsByCoords(data.pos[0],data.pos[1]),newX=tlOffsetXY[0]+data.offsets[0],newY=tlOffsetXY[1]+data.offsets[1],style=this.formelWrapperEl.dom.style;style.left="".concat(newX,"px");style.top="".concat(newY,"px");this.conf.left=newX;this.conf.top=newY};clsRef.prototype.getTargetType=function(){return this.conf.trange.length?"trange":(this.conf.tnamedrange.length?"tnamedrange":"tvar")};clsRef=null;Jedox.wss.wsel.ComboBox=(function(){var type="ComboBox",defDims={w:150,h:22};return function(conf){Jedox.wss.wsel.ComboBox.parent.constructor.call(this,conf);var activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,env=Jedox.wss.app.environment,actCellCoords=env.selectedCellCoords,formulaParser=Jedox.wss.formula,trgTypes=Jedox.wss.wsel.FormBase.trgTypes,trgType=this.getTargetType(),that=this;this.preselectType={LOAD:0,REFR:1,UTRG:2};if(!this.conf.id){if(this.conf==undefined){this.conf={type:type,src:'=PALO.SUBSET("localhost/Demo","Years",1,,,,,,,PALO.SORT(0,0,,0,,0,1))',trange:"",tnamedrange:"",tvar:"ComboBox"}}if(this.conf.name==undefined){this.conf.name=this.conf.type.concat(Jedox.wss.wsel.countEl(this.conf.type)+1)}if(this.conf.top==undefined){this.conf.top=env.selectedCell.parentNode.offsetTop}if(this.conf.left==undefined){this.conf.left=env.selectedCell.offsetLeft}if(this.conf.width==undefined){this.conf.width=defDims.w}if(this.conf.height==undefined){this.conf.height=defDims.h}if(this.conf.tvar==undefined){this.conf.tvar=""}if(!this.conf.macros){this.conf.macros={}}this.conf.winId=activeBook.getWinId();if(this.conf.trange.length>0){if(!this.conf.trange.search(/^=/)){this.conf.trange=this.conf.trange.substr(1)}var destRng=formulaParser.parse(this.conf.trange);if(!destRng.length){throw ["formel_inv_target",{}]}destRng=destRng[0];if(destRng.sheet.length&&!activeBook._sheetSelector.getIdByName(destRng.sheet)){throw ["formel_inv_target_sheet",{name:destRng.sheet}]}}conn.createBatch();conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:this.conf.name}]);if(this.conf.tnamedrange.length>0){conn.cmd(0,["nexs"],[[this.conf.tnamedrange,Jedox.wss.app.activeSheet.getUid()]])}var chkRes=conn.sendBatch();if(chkRes[0][1].length>0){throw ["formel_exists",{name:conf.name}]}if(this.conf.tnamedrange.length>0&&chkRes[1][1][0]){throw ["formel_nrange_exists",{name:conf.tnamedrange}]}var posConf=Jedox.wss.wsel.getNLoc(this.conf.left,this.conf.top,this.conf.width,this.conf.height);var res=conn.cmd(0,["wadd"],["",{e_type:"formel",n_refers_to:this.conf.src,n_target_ref:"=".concat(trgType==trgTypes.VAR?"@":"",this.conf[trgType]),n_location:posConf.n_location,pos_offsets:posConf.pos_offsets,n_use_locale:this.conf.formulaEnabled,formel_name:this.conf.name,formel_type:this.conf.type,macros:this.conf.macros}])[0];if(res[0]&&res[1].length>0){this.conf.id=res[1][0]}else{throw ["formel_add_wsel_err",{}]}var wselData=conn.cmd(0,["wget"],["",[],["n_refers_to","n_get_val"],{e_id:this.conf.id}])[0][1][0];this.conf.src=wselData.n_refers_to;this.conf.treeVal=Jedox.util.cols2Tree(wselData.n_get_val instanceof Array?wselData.n_get_val:[wselData.n_get_val],true);this.conf.selval=this.conf.treeVal[0]["val"],this.conf.selpath="/root/".concat(this.conf.selval);var updObj={};updObj[this.conf.id]={data:{trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.selval,selpath:this.conf.selpath}};conn.createBatch();conn.cmd(null,["wupd"],["",updObj]);if(this.conf.trange.length>0){if(destRng.sheet.length&&destRng.sheet!=activeBook._sheetSelector.getActiveSheetName()){var actSheetId=Jedox.wss.app.activeSheet._uid,tSheetId=activeBook._sheetSelector.getIdByName(destRng.sheet);conn.cmd(null,["osel"],[2,tSheetId])}conn.cmd(null,["cdrn"],[{cm:true},destRng.rng.concat({v:this.conf.selval})]);if(tSheetId){conn.cmd(null,["osel"],[2,actSheetId])}}if(this.conf.tnamedrange.length>0){conn.cmd(null,["nadd"],[[actCellCoords[0],actCellCoords[1],{name:this.conf.tnamedrange,refers_to:"=".concat(typeof this.conf.selval=="string"?Ext.util.JSON.encode(this.conf.selval):this.conf.selval),scope:activeBook.getSheetSelector().getActiveSheetName(),comment:"Managed by form element ".concat(this.conf.name)}]])}if(this.conf.tvar.length>0){conn.cmd(null,["svar"],[this.conf.tvar,this.conf.selval])}conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())}else{this.conf.treeVal=Jedox.util.cols2Tree(this.conf.treeVal instanceof Array?this.conf.treeVal:[this.conf.treeVal],true)}var currDate=new Date(),gridDivId=activeBook.getDomId()+"_IC",formelContId=this.gContId.concat("_formel_cont_",this.conf.id);this.calcConstraints();Ext.DomHelper.append(Ext.DomQuery.selectNode("div[id="+gridDivId+"]"),{tag:"div",id:formelContId,width:this.conf.width,height:this.conf.height,cls:"ws_element",style:"z-index: 50; position: absolute; left:".concat(this.conf.left,"px; top:",this.conf.top,"px;")},false);this.elem=new Ext.form.ComboBox({id:this.gContId.concat("_ComboBox_",this.conf.id),renderTo:formelContId,disabled:false,store:new Ext.data.SimpleStore({fields:[],data:[[]]}),hideLabel:true,editable:false,triggerAction:"all",mode:"local",shadow:false,maxHeight:200,tpl:'<tpl for="."><div style="height:200px"><div class="cmbTreeList" id="'.concat(this.gContId,"_cmbTreeList_",this.conf.id,'"></div></div></tpl>'),selectedClass:"",onSelect:Ext.emptyFn,value:this.conf.targetVal==null?this.conf.selval:this.conf.targetVal,width:this.conf.width,allowBlank:true,selectOnFocus:false,resizable:false,validateOnBlur:false,preventMark:true,listeners:{expand:{fn:this.onExpandComboBox,scope:this}}});var treeNodeProvider=new Ext.tree.TreeNodeProvider({getNodes:function(){return this.data}});this.myTreeLoader=new Ext.tree.MyTreeLoader({treeNodeProvider:treeNodeProvider});this.myTreeLoader.updateTreeNodeProvider(this.conf.treeVal);this.cmbTreeList=new Ext.tree.TreePanel({id:this.gContId.concat("_cmbTreePanel_",this.conf.id),border:false,cls:"x-tree-noicon",autoScroll:true,animate:true,enableDD:false,containerScroll:true,loader:this.myTreeLoader,rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:"[All Elements]".localize(),draggable:false,val:"root"}),listeners:{click:{fn:this.onSelComboBox,scope:this}},initConf:this.conf});if(!this.isUserMode){Ext.ResizableConstrained=function(el,config){Ext.ResizableConstrained.superclass.constructor.call(this,el,config)};Ext.extend(Ext.ResizableConstrained,Ext.Resizable,{setXConstraint:function(left,right){this.dd.setXConstraint(left,right)},setYConstraint:function(up,down){this.dd.setYConstraint(up,down)}});var minDims=Jedox.wss.wsel.ComboBox.minDims;this.formelWrapper=new Ext.ResizableConstrained(formelContId,{wrap:!this.isUserMode,dynamic:!this.isUserMode,pinned:false,width:this.conf.width,height:this.conf.height,minWidth:minDims.w,maxWidth:700,minHeight:minDims.h,maxHeight:700,preserveRatio:false,transparent:true,handles:!this.isUserMode?"e w":"nw",draggable:!this.isUserMode,enabled:!this.isUserMode,style:"background-color: white;",resizeRegion:Ext.get(gridDivId).getRegion()});this.formelWrapper.on({resize:{fn:this.afterFormelResize,scope:this},beforeresize:{fn:this.beforeFormelResize,scope:this}});this.formelWrapper.dd.maintainOffset=true;this.formelWrapper.setXConstraint(this.elConstr.left,this.elConstr.right);this.formelWrapper.setYConstraint(this.elConstr.up,this.elConstr.down);this.formelWrapperEl=this.formelWrapper.getEl();this.formelWrapperEl.dom.style.backgroundColor="#FFFFFF";this.formelWrapperEl.on({mousedown:{fn:this.onFormelMouseDown,scope:this}})}this.elem.wsel=this;if(this.conf.targetVal!=null){this.preselect(this.conf.targetVal,this.preselectType.LOAD)}}})();Jedox.util.extend(Jedox.wss.wsel.ComboBox,Jedox.wss.wsel.FormBase);Jedox.wss.wsel.ComboBox.events=[{name:"select",funcname:"Select"}];Jedox.wss.wsel.ComboBox.minDims={w:80,h:22};clsRef=Jedox.wss.wsel.ComboBox;clsRef.prototype.updateWSElData=function(){var conn=Jedox.wss.backend.conn,updObj={};updObj[this.conf.id]={data:{trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.selval,selpath:this.conf.selpath}};conn.cmd(conn.dummy_cb,["wupd"],["",updObj])};clsRef.prototype.beforeShowCtxMenu=function(){this.elem.collapse()};clsRef.prototype.onSelComboBox=function(node,e){this.elem.setValue(node.text);this.elem.collapse();if(node.getPath("val")==this.conf.selpath){return}this.conf.selval=node.attributes.val;this.conf.selpath=node.getPath("val");var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;conn.createBatch();this.updateDependencies();this.updateWSElData();if(this.conf.macros.select){var jwmacro=Jedox.wss.macro;conn.cmd([jwmacro,jwmacro.ui_exec],["em"],["php","em.php","em",[this.conf.macros.select,this.conf.selval],activeBook._gmode_edit?activeBook._aPane._defaultSelection.getActiveRange().getValue():"A1"])}conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())};clsRef.prototype.onExpandComboBox=function(combo){if(!this.cmbTreeList.rendered){this.cmbTreeList.render(this.gContId.concat("_cmbTreeList_",this.conf.id));this.cmbTreeList.getRootNode().reload();var that=this;setTimeout(function(){that.cmbTreeList.selectPath(that.conf.selpath,"val")},0)}};clsRef.prototype.refresh=function(data){this.myTreeLoader.updateTreeNodeProvider(Jedox.util.cols2Tree(data,true));this.preselect(data[0],this.preselectType.REFR)};clsRef.prototype.getSelPath=function(data,selVal,path){function getPath(data,selVal,path){if(data.val==selVal){return path.concat("/",selVal)}if(data.leaf){return""}else{path=path.concat("/",data.val);var subpath="";for(var child in data.children){subpath=getPath(data.children[child],selVal,path);if(subpath.length){return subpath}}return subpath}}for(var i=0,dataLen=data.length,path;i<dataLen;i++){path=getPath(data[i],selVal,"");if(path.length){return path}}return""};clsRef.prototype.preselect=function(selVal,type){var data=this.cmbTreeList.loader.getTreeNodeProvider().getData(),pSelType=this.preselectType;if(!data.length){return}if(!this.cmbTreeList.rendered){switch(type){case pSelType.LOAD:if(selVal==null||this.conf.selval==selVal){return}var selPath=this.getSelPath(data,selVal);if(selPath.length){this.conf.selval=selVal;this.conf.selpath="/root".concat(selPath)}else{this.conf.selval=data[0].val;this.conf.selpath="/root/".concat(data[0].val)}break;case pSelType.REFR:var selPath=this.getSelPath(data,this.conf.selval);if(selPath.length){return}else{this.conf.selval=data[0].val;this.conf.selpath="/root/".concat(data[0].val)}break;case pSelType.UTRG:if(selVal==null||this.conf.selval==selVal){return}var selPath=this.getSelPath(data,selVal);if(selPath.length){this.conf.selval=selVal;this.conf.selpath="/root".concat(selPath)}else{return}break}var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;conn.createBatch();if(type<=this.preselectType.REFR){this.updateDependencies()}this.updateWSElData();conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange());this.elem.setValue(this.conf.selval)}else{if(type==this.preselectType.REFR){var selNode=this.cmbTreeList.getSelectionModel().getSelectedNode(),selPath=selNode==null?"abc":selNode.getPath("val"),that=this,cbSelectPathHandler=function(bSuccess,oSelNode,tree,iterator){if(!bSuccess){tree.selectPath("/root/".concat(data[0].val),"val");var selNode=tree.getSelectionModel().getSelectedNode();tree.fireEvent("click",selNode,null)}},cbSelectPath=function(bSuccess,oSelNode){cbSelectPathHandler(bSuccess,oSelNode,that.cmbTreeList)};this.cmbTreeList.getRootNode().reload();this.cmbTreeList.selectPath(selPath,"val",cbSelectPath)}else{var selPath=this.getSelPath(data,selVal),that=this;if(selPath.length){selPath="/root".concat(selPath)}else{return}var cbSelectPathHandler=function(bSuccess,oSelNode,wsel){if(bSuccess){wsel.conf.selval=selVal;wsel.conf.selpath=selPath;wsel.elem.setValue(selVal);wsel.updateWSElData()}},cbSelectPath=function(bSuccess,oSelNode){cbSelectPathHandler(bSuccess,oSelNode,that)};this.cmbTreeList.selectPath(selPath,"val",cbSelectPath)}}};clsRef.prototype.update=function(editConf){var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook,actCellCoords=Jedox.wss.app.environment.selectedCellCoords,wsel={},updObj={},chkNameAndRng=chkNRng=false,batchStarted=updWsel=updData=updDep=updSrc=false;if(editConf.tvar==undefined){editConf.tvar=""}function startBatch(){if(!batchStarted){conn.createBatch();batchStarted=true}}if(editConf.trange.length&&editConf.trange!=this.conf.trange){if(!editConf.trange.search(/^=/)){editConf.trange=editConf.trange.substr(1)}var destRng=Jedox.wss.formula.parse(editConf.trange);if(!destRng.length){throw ["formel_inv_target",{}]}destRng=destRng[0];if(destRng.sheet.length&&!activeBook._sheetSelector.getIdByName(destRng.sheet)){throw ["formel_inv_target_sheet",{name:destRng.sheet}]}}if(editConf.name!=this.conf.name||editConf.trange!=this.conf.trange){startBatch();conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:editConf.name}]);chkNameAndRng=true}if(editConf.tnamedrange.length&&editConf.tnamedrange!=this.conf.tnamedrange){startBatch();conn.cmd(0,["nexs"],[[editConf.tnamedrange,Jedox.wss.app.activeSheet.getUid()]]);chkNRng=true}if(chkNameAndRng||chkNRng){var chkRes=conn.sendBatch();if(chkNameAndRng&&chkRes[0][1].length&&chkRes[0][1][0]["e_id"]!=this.conf.id){throw ["formel_exists",{name:editConf.name}]}batchStarted=false}if(editConf.formulaEnabled!=this.conf.formulaEnabled){this.conf.formulaEnabled=editConf.formulaEnabled;wsel.n_use_locale=this.conf.formulaEnabled}if(editConf.name!=this.conf.name){this.conf.name=editConf.name;wsel.formel_name=this.conf.name}if(editConf.src!=this.conf.src){this.conf.src=editConf.src;wsel.n_refers_to=this.conf.src;updSrc=true}if(editConf.trange!=this.conf.trange){if(editConf.trange.length){wsel.n_target_ref="=".concat(editConf.trange)}this.conf.trange=editConf.trange;updData=updDep=true}if(editConf.tnamedrange!=this.conf.tnamedrange){if(editConf.tnamedrange.length){wsel.n_target_ref="=".concat(editConf.tnamedrange)}this.conf.tnamedrange=editConf.tnamedrange;if(this.conf.tnamedrange.length&&!chkRes[chkNameAndRng?1:0][1][0]){startBatch();conn.cmd(0,["nadd"],[[actCellCoords[0],actCellCoords[1],{name:this.conf.tnamedrange,refers_to:"=TRUE",scope:activeBook.getSheetSelector().getActiveSheetName(),comment:"Managed by form element ".concat(this.conf.name)}]])}updData=updDep=true}if(editConf.tvar!=this.conf.tvar){if(editConf.tvar.length){wsel.n_target_ref="=@".concat(editConf.tvar)}this.conf.tvar=editConf.tvar;updData=updDep=true}for(var fld in wsel){updWsel=true;break}if(updSrc){updObj[this.conf.id]=wsel;startBatch();conn.cmd(0,["wupd"],["",updObj]);conn.cmd(0,["wget"],["",[],["n_get_val","n_refers_to"],{e_id:this.conf.id}]);var updRes=conn.sendBatch(),nVal=updRes[updRes.length-1][1][0].n_get_val;batchStarted=false;this.conf.src=updRes[updRes.length-1][1][0].n_refers_to;this.refresh(Ext.isArray(nVal)?nVal:[nVal])}else{if(updWsel||updData){if(updData){wsel.data={trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.selval,selpath:this.conf.selpath}}updObj[this.conf.id]=wsel;startBatch();conn.cmd(null,["wupd"],["",updObj]);if(updDep){this.updateDependencies()}}}if(batchStarted){conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())}};clsRef.prototype.setCmpSize=function(w,h){this.elem.setSize(w,h)};clsRef.prototype.updateTarget=function(data){var trgType=this.getTargetType(),updVal=data.n_target_val instanceof Array?data.n_target_val[0]:data.n_target_val,tRefIdx=data.n_target_ref.search(/^=/)+1,updData=false;if(!data.n_target_ref.search(/^=@/)){tRefIdx++}data.n_target_ref=data.n_target_ref.substr(tRefIdx);if(this.conf[trgType]!=data.n_target_ref){this.conf[trgType]=data.n_target_ref;updData=true}if(this.conf.selval!=updVal){this.preselect(updVal,this.preselectType.UTRG)}else{if(updData){this.updateWSElData()}}};clsRef=null;Jedox.wss.wsel.CheckBox=(function(){var type="CheckBox",defDims={w:150,h:22};return function(conf){Jedox.wss.wsel.CheckBox.parent.constructor.call(this,conf);this.states={unchecked:{g:false,c:false},checked:{g:true,c:true},mixed:{g:"#N/A",c:null}};var activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,env=Jedox.wss.app.environment,actCellCoords=env.selectedCellCoords,formulaParser=Jedox.wss.formula,trgTypes=Jedox.wss.wsel.FormBase.trgTypes,trgType=this.getTargetType(),that=this;if(this.states[this.conf.state]){this.conf.selval=this.states[this.conf.state].g}else{throw ["checkbox_inv_state",{}]}if(!this.conf.id){if(this.conf==undefined){this.conf={type:type,label:"CheckBoxN",trange:"",tnamedrange:"",tvar:"ComboBox",state:"unchecked"}}if(this.conf.name==undefined){this.conf.name=this.conf.type.concat(Jedox.wss.wsel.countEl(this.conf.type)+1)}if(this.conf.top==undefined){this.conf.top=env.selectedCell.parentNode.offsetTop}if(this.conf.left==undefined){this.conf.left=env.selectedCell.offsetLeft}if(this.conf.height==undefined){this.conf.height=defDims.h}if(this.conf.tvar==undefined){this.conf.tvar=""}if(!this.conf.macros){this.conf.macros={}}this.conf.winId=activeBook.getWinId();if(this.conf.trange.length>0){if(!this.conf.trange.search(/^=/)){this.conf.trange=this.conf.trange.substr(1)}var destRng=formulaParser.parse(this.conf.trange);if(!destRng.length){throw ["formel_inv_target",{}]}destRng=destRng[0];if(destRng.sheet.length&&!activeBook._sheetSelector.getIdByName(destRng.sheet)){throw ["formel_inv_target_sheet",{name:destRng.sheet}]}}conn.createBatch();conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:this.conf.name}]);if(this.conf.tnamedrange.length>0){conn.cmd(0,["nexs"],[[this.conf.tnamedrange,Jedox.wss.app.activeSheet.getUid()]])}var chkRes=conn.sendBatch();if(chkRes[0][1].length>0){throw ["formel_exists",{name:conf.name}]}if(this.conf.tnamedrange.length>0&&chkRes[1][1][0]){throw ["formel_nrange_exists",{name:conf.tnamedrange}]}var res=conn.cmd(0,["wadd"],["",{e_type:"formel",n_target_ref:"=".concat(trgType==trgTypes.VAR?"@":"",this.conf[trgType]),formel_name:this.conf.name,formel_type:this.conf.type,macros:this.conf.macros,data:{trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.state,label:this.conf.label}}])[0];if(res[0]&&res[1].length>0){this.conf.id=res[1][0]}else{throw ["formel_add_wsel_err",{}]}if(this.conf.trange.length>0){conn.createBatch();if(destRng.sheet.length&&destRng.sheet!=activeBook._sheetSelector.getActiveSheetName()){var actSheetId=Jedox.wss.app.activeSheet._uid,tSheetId=activeBook._sheetSelector.getIdByName(destRng.sheet);conn.cmd(null,["osel"],[2,tSheetId])}conn.cmd(null,["cdrn"],[{cm:true},destRng.rng.concat({v:Ext.decode(this.conf.selval)})]);if(tSheetId){conn.cmd(null,["osel"],[2,actSheetId])}conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())}if(this.conf.tnamedrange.length>0){conn.cmd([activeBook,activeBook.exec],["nadd"],[[actCellCoords[0],actCellCoords[1],{name:this.conf.tnamedrange,refers_to:"=".concat(typeof this.conf.selval=="string"?Ext.util.JSON.encode(this.conf.selval):this.conf.selval),scope:activeBook.getSheetSelector().getActiveSheetName(),comment:"Managed by form element ".concat(this.conf.name)}]],activeBook.getRealGridRange(),false,false)}if(this.conf.tvar.length>0){conn.cmd(null,["svar"],[this.conf.tvar,this.conf.selval])}}else{if(this.conf.targetVal!=null){this.preselect(this.conf.targetVal,false)}}var currDate=new Date(),gridDivId=activeBook.getDomId()+"_IC",formelContId=this.gContId.concat("_formel_cont_",this.conf.id);this.calcConstraints();Ext.DomHelper.append(Ext.DomQuery.selectNode("div[id="+gridDivId+"]"),{tag:"div",id:formelContId,width:this.conf.width,height:this.conf.height,cls:"ws_element",style:"z-index: 50; position: absolute; left:".concat(this.conf.left,"px; top:",this.conf.top,"px;")},false);this.elem=new Ext.form.Checkbox({id:this.gContId.concat("_CheckBox_",this.conf.id),renderTo:formelContId,fieldLabel:"",labelSeparator:"",boxLabel:this.conf.label,checked:this.states[this.conf.state].c,width:this.conf.width?this.conf.width:"auto",listeners:{check:{fn:this.onCheck,scope:this}}});if(this.conf.width==undefined){this.conf.width=this.elem.wrap.dom.offsetWidth;var posConf=Jedox.wss.wsel.getNLoc(this.conf.left,this.conf.top,this.conf.width,this.conf.height);var updObj={};updObj[this.conf.id]={n_location:posConf.n_location,pos_offsets:posConf.pos_offsets};conn.cmd(conn.dummy_cb,["wupd"],["",updObj])}if(!this.isUserMode){Ext.ResizableConstrained=function(el,config){Ext.ResizableConstrained.superclass.constructor.call(this,el,config)};Ext.extend(Ext.ResizableConstrained,Ext.Resizable,{setXConstraint:function(left,right){this.dd.setXConstraint(left,right)},setYConstraint:function(up,down){this.dd.setYConstraint(up,down)}});var minDims=Jedox.wss.wsel.ComboBox.minDims;this.formelWrapper=new Ext.ResizableConstrained(formelContId,{wrap:!this.isUserMode,dynamic:!this.isUserMode,pinned:false,width:this.conf.width,height:this.conf.height,minWidth:minDims.w,maxWidth:700,minHeight:minDims.h,maxHeight:700,preserveRatio:false,transparent:true,handles:!this.isUserMode?"e w":"nw",draggable:!this.isUserMode,enabled:!this.isUserMode,style:"background-color: white;",resizeRegion:Ext.get(gridDivId).getRegion()});this.formelWrapper.on({resize:{fn:this.afterFormelResize,scope:this},beforeresize:{fn:this.beforeFormelResize,scope:this}});this.formelWrapper.dd.maintainOffset=true;this.formelWrapper.setXConstraint(this.elConstr.left,this.elConstr.right);this.formelWrapper.setYConstraint(this.elConstr.up,this.elConstr.down);this.formelWrapperEl=this.formelWrapper.getEl();this.formelWrapperEl.dom.style.backgroundColor="#FFFFFF";this.formelWrapperEl.on({mousedown:{fn:this.onFormelMouseDown,scope:this}})}this.elem.wsel=this}})();Jedox.util.extend(Jedox.wss.wsel.CheckBox,Jedox.wss.wsel.FormBase);Jedox.wss.wsel.CheckBox.events=[{name:"check",funcname:"Check"}];Jedox.wss.wsel.CheckBox.minDims={w:40,h:22};clsRef=Jedox.wss.wsel.CheckBox;clsRef.prototype.updateWSElData=function(){var conn=Jedox.wss.backend.conn,updObj={};updObj[this.conf.id]={data:{trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.state,label:this.conf.label}};conn.cmd(conn.dummy_cb,["wupd"],["",updObj])};clsRef.prototype._resState=function(val){for(var state in this.states){if(this.states[state].c==val){return state}}return false};clsRef.prototype.onCheck=function(comp,checked){if(this.isCmpMoved(comp)){this.elem.suspendEvents();this.elem.setValue(!checked);this.elem.resumeEvents();return}var selState=this._resState(checked),conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;if(!selState||selState==this.conf.state){return}this.conf.state=selState;this.conf.selval=this.states[selState].g;conn.createBatch();this.updateDependencies();this.updateWSElData();if(this.conf.macros.check){var jwmacro=Jedox.wss.macro;conn.cmd([jwmacro,jwmacro.ui_exec],["em"],["php","em.php","em",[this.conf.macros.check,this.states[selState].c],activeBook._gmode_edit?activeBook._aPane._defaultSelection.getActiveRange().getValue():"A1"])}conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())};clsRef.prototype.update=function(editConf){var conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook,actCellCoords=Jedox.wss.app.environment.selectedCellCoords,wsel={},updObj={},chkNameAndRng=chkNRng=false,batchStarted=updWsel=updData=updDep=false;if(editConf.tvar==undefined){editConf.tvar=""}function startBatch(){if(!batchStarted){conn.createBatch();batchStarted=true}}if(editConf.trange.length&&editConf.trange!=this.conf.trange){if(!editConf.trange.search(/^=/)){editConf.trange=editConf.trange.substr(1)}var destRng=Jedox.wss.formula.parse(editConf.trange);if(!destRng.length){throw ["formel_inv_target",{}]}destRng=destRng[0];if(destRng.sheet.length&&!activeBook._sheetSelector.getIdByName(destRng.sheet)){throw ["formel_inv_target_sheet",{name:destRng.sheet}]}}if(editConf.name!=this.conf.name||editConf.trange!=this.conf.trange){startBatch();conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:editConf.name}]);chkNameAndRng=true}if(editConf.tnamedrange.length&&editConf.tnamedrange!=this.conf.tnamedrange){startBatch();conn.cmd(0,["nexs"],[[editConf.tnamedrange,Jedox.wss.app.activeSheet.getUid()]]);chkNRng=true}if(chkNameAndRng||chkNRng){var chkRes=conn.sendBatch();if(chkNameAndRng&&chkRes[0][1].length&&chkRes[0][1][0]["e_id"]!=this.conf.id){throw ["formel_exists",{name:editConf.name}]}batchStarted=false}if(editConf.name!=this.conf.name){this.conf.name=editConf.name;wsel.formel_name=this.conf.name}if(editConf.label!=this.conf.label){startBatch();this.elem.wrap.child(".x-form-cb-label").update(editConf.label);this.formelWrapper.resizeTo(editConf.label.length*20+50,this.conf.height);this.conf.width=this.elem.wrap.dom.offsetWidth;this.formelWrapper.resizeTo(this.conf.width,this.conf.height);this.conf.label=editConf.label;updData=true}if(editConf.state!=this.conf.state){this.conf.state=editConf.state;this.conf.selval=this.states[this.conf.state].g;this.elem.suspendEvents();this.elem.setValue(this.states[this.conf.state].c);this.elem.resumeEvents();updData=updDep=true;if(this.conf.macros.check){startBatch();var jwmacro=Jedox.wss.macro;conn.cmd([jwmacro,jwmacro.ui_exec],["em"],["php","em.php","em",[this.conf.macros.check,this.states[this.conf.state].c],activeBook._gmode_edit?activeBook._aPane._defaultSelection.getActiveRange().getValue():"A1"])}}if(editConf.trange!=this.conf.trange){if(editConf.trange.length){wsel.n_target_ref="=".concat(editConf.trange)}this.conf.trange=editConf.trange;updData=updDep=true}if(editConf.tnamedrange!=this.conf.tnamedrange){this.conf.tnamedrange=editConf.tnamedrange;if(this.conf.tnamedrange.length){if(!chkRes[chkNameAndRng?1:0][1][0]){startBatch();conn.cmd(null,["nadd"],[[actCellCoords[0],actCellCoords[1],{name:this.conf.tnamedrange,refers_to:"=TRUE",scope:activeBook.getSheetSelector().getActiveSheetName(),comment:"Managed by form element ".concat(this.conf.name)}]])}wsel.n_target_ref="=".concat(this.conf.tnamedrange)}updData=updDep=true}if(editConf.tvar!=this.conf.tvar){if(editConf.tvar.length){wsel.n_target_ref="=@".concat(editConf.tvar)}this.conf.tvar=editConf.tvar;updData=updDep=true}for(var fld in wsel){updWsel=true;break}if(updWsel||updData){if(updData){wsel.data={trange:this.conf.trange,tnamedrange:this.conf.tnamedrange,tvar:this.conf.tvar,selval:this.conf.state,label:this.conf.label}}updObj[this.conf.id]=wsel;startBatch();conn.cmd(null,["wupd"],["",updObj])}if(updDep){startBatch();this.updateDependencies()}if(batchStarted){conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())}};clsRef.prototype.setCmpSize=function(w,h){this.elem.setSize(w,h)};clsRef.prototype.preselect=function(tVal,updEl){var selState=this._resState(tVal instanceof Array?tVal[0]:tVal);if(!selState||selState==this.conf.state){return false}this.conf.state=selState;this.conf.selval=this.states[selState].g;if(updEl){this.elem.setValue(this.states[selState].c)}this.updateWSElData();return true};clsRef.prototype.updateTarget=function(data){var trgType=this.getTargetType(),selState=this._resState(data.n_target_val instanceof Array?data.n_target_val[0]:data.n_target_val),tRefIdx=data.n_target_ref.search(/^=/)+1,updData=false;if(!data.n_target_ref.search(/^=@/)){tRefIdx++}data.n_target_ref=data.n_target_ref.substr(tRefIdx);if(this.conf[trgType]!=data.n_target_ref){this.conf[trgType]=data.n_target_ref;updData=true}if(!this.preselect(data.n_target_val,true)&&updData){this.updateWSElData()}};clsRef=null;Jedox.wss.wsel.Button=(function(){var type="Button",defDims={w:70,h:35};return function(conf){Jedox.wss.wsel.Button.parent.constructor.call(this,conf);var activeBook=Jedox.wss.app.activeBook,conn=Jedox.wss.backend.conn,env=Jedox.wss.app.environment;if(!this.conf.id){var isNew=true;if(this.conf==undefined){this.conf={type:type,name:"ButtonN",label:"ButtonN"}}if(this.conf.name==undefined){this.conf.name=this.conf.type.concat(Jedox.wss.wsel.countEl(this.conf.type)+1)}if(this.conf.top==undefined){this.conf.top=env.selectedCell.parentNode.offsetTop}if(this.conf.left==undefined){this.conf.left=env.selectedCell.offsetLeft}if(this.conf.width==undefined){this.conf.width=defDims.w}if(this.conf.height==undefined){this.conf.height=defDims.h}if(!this.conf.macros){this.conf.macros={}}this.conf.winId=activeBook.getWinId();if(conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:this.conf.name}])[0][1].length>0){throw ["formel_exists",{name:conf.name}]}var res=conn.cmd(0,["wadd"],["",{e_type:"formel",n_refers_to:"",formel_name:this.conf.name,formel_type:this.conf.type,macros:this.conf.macros,data:{label:this.conf.label}}])[0];if(res[0]&&res[1].length>0){this.conf.id=res[1][0]}else{throw ["formel_add_wsel_err",{}]}}else{var isNew=false}var currDate=new Date(),gridDivId=activeBook.getDomId()+"_IC",formelContId=this.gContId.concat("_formel_cont_",this.conf.id);this.calcConstraints();Ext.DomHelper.append(Ext.DomQuery.selectNode("div[id="+gridDivId+"]"),{tag:"div",id:formelContId,width:this.conf.width,height:this.conf.height,cls:"ws_element",style:"z-index: 50; position: absolute; left:".concat(this.conf.left,"px; top:",this.conf.top,"px;")},false);this.elem=new Ext.Button({id:this.gContId.concat("_Button_",this.conf.id),renderTo:formelContId,text:this.conf.label,listeners:{click:{fn:this.onClick,scope:this}}});if(this.conf.width!=defDims.w){this.setCmpSize(this.conf.width)}this.conf.width=this.elem.getEl().dom.offsetWidth;this.conf.height=this.elem.getEl().dom.offsetHeight;if(isNew){var posConf=Jedox.wss.wsel.getNLoc(this.conf.left,this.conf.top,this.conf.width,this.conf.height);var updObj={};updObj[this.conf.id]={n_location:posConf.n_location,pos_offsets:posConf.pos_offsets};conn.cmd(conn.dummy_cb,["wupd"],["",updObj])}if(!this.isUserMode){Ext.ResizableConstrained=function(el,config){Ext.ResizableConstrained.superclass.constructor.call(this,el,config)};Ext.extend(Ext.ResizableConstrained,Ext.Resizable,{setXConstraint:function(left,right){this.dd.setXConstraint(left,right)},setYConstraint:function(up,down){this.dd.setYConstraint(up,down)}});this.formelWrapper=new Ext.ResizableConstrained(formelContId,{wrap:!this.isUserMode,dynamic:!this.isUserMode,pinned:false,width:this.conf.width,height:this.conf.height,minWidth:this.conf.width,maxWidth:700,minHeight:this.conf.height,maxHeight:700,preserveRatio:false,transparent:true,handles:!this.isUserMode?"e w":"nw",draggable:!this.isUserMode,enabled:!this.isUserMode,style:"background-color: white;",resizeRegion:Ext.get(gridDivId).getRegion()});this.formelWrapper.on({resize:{fn:this.afterFormelResize,scope:this},beforeresize:{fn:this.beforeFormelResize,scope:this}});this.formelWrapper.dd.maintainOffset=true;this.formelWrapper.setXConstraint(this.elConstr.left,this.elConstr.right);this.formelWrapper.setYConstraint(this.elConstr.up,this.elConstr.down);this.formelWrapperEl=this.formelWrapper.getEl();this.formelWrapperEl.dom.style.backgroundColor="#FFFFFF";this.formelWrapperEl.on({mousedown:{fn:this.onFormelMouseDown,scope:this}})}this.elem.wsel=this}})();Jedox.util.extend(Jedox.wss.wsel.Button,Jedox.wss.wsel.FormBase);Jedox.wss.wsel.Button.events=[{name:"click",funcname:"Click"}];Jedox.wss.wsel.Button.minDims={w:20,h:35};clsRef=Jedox.wss.wsel.Button;clsRef.prototype.onClick=function(comp,e){if(this.isCmpMoved(comp)||!this.conf.macros.click){return}var jwmacro=Jedox.wss.macro,conn=Jedox.wss.backend.conn,activeBook=Jedox.wss.app.activeBook;conn.createBatch();conn.cmd([jwmacro,jwmacro.ui_exec],["em"],["php","em.php","em",[this.conf.macros.click],activeBook._gmode_edit?activeBook._aPane._defaultSelection.getActiveRange().getValue():"A1"]);conn.sendBatch([activeBook,activeBook.exec],activeBook.getRealGridRange())};clsRef.prototype.remove=function(){this.elem.destroy();this.formelWrapperEl.remove();var conn=Jedox.wss.backend.conn;conn.cmd(conn.dummy_cb,["wdel"],["",[this.conf.id]])};clsRef.prototype.update=function(editConf){var conn=Jedox.wss.backend.conn,wsel={},updObj={},batchStarted=updWsel=updData=false;function startBatch(){if(!batchStarted){conn.createBatch();batchStarted=true}}if(editConf.name!=this.conf.name){if(conn.cmd(0,["wget"],["",[],["e_id"],{e_type:"formel",formel_name:editConf.name}])[0][1].length){throw ["formel_exists",{name:editConf.name}]}else{this.conf.name=editConf.name;wsel.formel_name=this.conf.name}}if(editConf.label!=this.conf.label){startBatch();this.elem.setText(editConf.label);var elDom=this.elem.getEl().dom;this.formelWrapper.resizeTo(elDom.offsetWidth,elDom.offsetHeight);this.conf.width=elDom.offsetWidth;this.conf.height=elDom.offsetHeight;this.formelWrapper.minWidth=this.conf.width;this.formelWrapper.minHeight=this.conf.height;this.conf.label=editConf.label;updData=true}for(var fld in wsel){updWsel=true;break}if(updWsel||updData){if(updData){wsel.data={label:this.conf.label}}updObj[this.conf.id]=wsel;startBatch();conn.cmd(0,["wupd"],["",updObj])}if(batchStarted){conn.sendBatch()}};clsRef.prototype.setCmpSize=function(w,h){this.elem.getEl().dom.style.width="".concat(w,"px")};clsRef=null;Jedox.wss.events={WSSPlugin:new Jedox.util.Interface("WSSPlugin",["openWorkbook_before","openWorkbook_after","closeWorkbook_before","closeWorkbook_after","switchWorkbook_before","switchWorkbook_after","saveAsWorkbook_before","saveAsWorkbook_after","newWorkbook_before","newWorkbook_after","hideWorkbook_before","hideWorkbook_after","unhideWorkbook_before","unhideWorkbook_after","importWorkbook_before","importWorkbook_after","openURL","openOther"]),triggers:{openWorkbook_before:[],openWorkbook_after:[],closeWorkbook_before:[],closeWorkbook_after:[],switchWorkbook_before:[],switchWorkbook_after:[],saveAsWorkbook_before:[],saveAsWorkbook_after:[],newWorkbook_before:[],newWorkbook_after:[],hideWorkbook_before:[],hideWorkbook_after:[],unhideWorkbook_before:[],unhideWorkbook_after:[],importWorkbook_before:[],importWorkbook_after:[],openURL:[],openOther:[]},registerPlugin:function(plugin){try{Jedox.util.Interface.ensureImplements(plugin,this.WSSPlugin);var events=plugin.getTriggerInfo();for(var event in events){if(this.triggers[event]!=undefined){this.triggers[event].push([plugin,events[event]])}}return true}catch(e){console.log(e);return false}}};Jedox.wss.formula=new function(){var _MAX_COL=Jedox.wss.grid.defMaxCoords[0],_MAX_ROW=Jedox.wss.grid.defMaxCoords[1],_re_dquoted=/"[^"]*"/g,_re_squoted=/'[^']*'(?!!)/g,_re_dollar=/\$/g,_re_tokenize=/(?:^|[^\w����:\$!])((?:[a-z����][\w����]+!)|(?:'[^']+'!))?(\$?[A-Z]+\$?[0-9]+)(:\$?[A-Z]+\$?[0-9]+)?(?![\w����:\$!])/ig,_re_separate=/^([A-Z]+)([0-9]+)$/i;function _lettersToNumber(ltrs){var num=0;for(var f=1,i=(ltrs=ltrs.toUpperCase()).length-1;i>=0;--i,f*=26){num+=(ltrs.charCodeAt(i)-64)*f}return num}function _parse_cellref(refstr){if((refstr=refstr.replace(_re_dollar,"").match(_re_separate))==null){return undefined}var col=_lettersToNumber(refstr[1]),row=parseInt(refstr[2]);if(col<1||col>_MAX_COL||row<1||row>_MAX_ROW){return undefined}return[refstr.input,col,row]}function _gen_padding(str){return Array(str.length+1).join(" ")}this.parse=function(fstr,nfs){var refs=[];refs.sgn="";refs.tbl={};if(!fstr){return refs}fstr=fstr.replace(_re_dquoted,_gen_padding).replace(_re_squoted,_gen_padding);nf_off={next:null};if(nfs instanceof Array&&nfs.length){var names=[],vals={};for(var nf,i=nfs.length-1;i>=0;--i){nf=nfs[i];names.push(nf[0]);vals[nf[0]]=nf[1].substr(1)}var re_names=new RegExp(names.join("|"),"g"),off=nf_off,corr=0;fstr=fstr.replace(re_names,function(name,start){var val=vals[name],len=val.length;off=off.next={name:name,start:start+=corr,end:start+len,corr:corr+=len-name.length,next:null};return val})}nf_off=nf_off.next;var cnt=-1,sgn="",tbl={};for(var res,ul,lr,tok,key,sheet,tmp,corr_s=0,corr_e=0,off={};(res=_re_tokenize.exec(fstr))!=null;){if((ul=_parse_cellref(res[2]))==undefined){continue}if(!res[1]){sheet=""}else{if(res[1].charAt(0)=="'"){sheet=res[1].substr(1,res[1].length-3)}else{sheet=res[1].substr(0,res[1].length-1)}}tok={sheet:sheet,ul:ul.shift(),start:_re_tokenize.lastIndex-res[0].length+1,end:_re_tokenize.lastIndex};if(nf_off&&tok.start>=nf_off.end){corr_s=corr_e=nf_off.corr;nf_off=nf_off.next}if(nf_off){if(tok.start<nf_off.start){tok.id=++cnt,off={}}else{if(tok.end>nf_off.end){tok.id=++cnt,off={},corr_s=corr_e=nf_off.corr}else{tok.nf=true;tok.id=off.name==nf_off.name&&off.start==nf_off.start?cnt:++cnt;off=nf_off;if(tok.start>nf_off.start){corr_s=nf_off.corr}corr_e=nf_off.corr}}}else{tok.id=++cnt}tok.start-=corr_s;tok.end-=corr_e;if(res[3]){if((lr=_parse_cellref(res[3].substr(1)))==undefined){continue}tok.lr=lr.shift(),tok.rng=ul.concat(lr),key=sheet.length?sheet.concat("!",tok.ul,":",tok.lr):tok.ul.concat(":",tok.lr);if(tok.rng[2]<tok.rng[0]){tmp=tok.rng[0];tok.rng[0]=tok.rng[2];tok.rng[2]=tmp}if(tok.rng[3]<tok.rng[1]){tmp=tok.rng[1];tok.rng[1]=tok.rng[3];tok.rng[3]=tmp}}else{tok.lr=tok.ul,tok.rng=ul.concat(ul),key=sheet.length?sheet.concat("!",tok.ul):tok.ul}tok.key=key;if(tbl[key]){tbl[key].push(tok),tok.id=tbl[key][0].id}else{tbl[key]=[tok]}tok.idx=refs.push(tok)-1;sgn=sgn.concat(key,"@",tok.start)}refs.sgn=sgn;refs.tbl=tbl;return refs}};Jedox.wss.macro=new function(){var that=this,_json=Ext.util.JSON,_conn=Jedox.wss.backend.conn,_re_findfunc=/function[ \t]+(\w+)[ \t]?\(/ig,msgIcons={info:"ext-mb-info",warn:"ext-mb-warning",err:"ext-mb-error"};this.listFmt={FLAT:0,TREE:1};this.list=function(cb,format){if(!(cb instanceof Array)||cb.length<2){return false}_conn.setCcmd('[["bget","",[],["e_id","name","funclist"],{"e_type":"macromdl"}]]');_conn.sendBatch([that,_list_post,cb,format])};function _list_post(res,cb,format){if(res[0][0]!==true||!(res[0][1] instanceof Array)){return false}res=res[0][1];switch(format){case that.listFmt.FLAT:var list=[];for(var i=res.length-1;i>=0;--i){for(var mdl=res[i],j=mdl.funclist.length-1;j>=0;--j){list.unshift(mdl.name.concat(".",mdl.funclist[j]))}}break;case that.listFmt.TREE:for(var mdl,i=res.length-1;i>=0;--i){mdl=res[i];for(var func,j=mdl.funclist.length-1;j>=0;--j){func=mdl.funclist[j];mdl.funclist[j]={id:mdl.name.concat(".",func),text:func,leaf:true,iconCls:"wss_macro_func"}}mdl.uid=mdl.e_id;delete mdl.e_id;mdl.id=mdl.name;mdl.text=mdl.name;delete mdl.name;mdl.leaf=false;mdl.iconCls="wss_macro_mdl";mdl.children=mdl.funclist;delete mdl.funclist}var list=res;break;default:var list=false}cb[1].apply(cb[0],[list].concat(cb.slice(2)))}this.add=function(cb,mdlName){if(!(cb instanceof Array)||cb.length<2){return false}_conn.setCcmd('[["badd","",{"e_type":"macromdl","name":"'.concat(mdlName,'","funclist":[],"src":"\\n"}]]'));_conn.sendBatch([that,_add_post,cb])};function _add_post(res,cb){res=res[0];if(res[0]!==true||!(res[1] instanceof Array)||res[1].length!=1){return false}cb[1].apply(cb[0],[res[1][0]].concat(cb.slice(2)))}this.rename=function(cb,mdlUid,newMdlName){if(!(cb instanceof Array)||cb.length<2){return false}_conn.setCcmd('[["bupd","",{"'.concat(mdlUid,'":{"name":',_json.encode(newMdlName),"}}]]"));_conn.sendBatch([that,_rename_post,cb])};function _rename_post(res,cb){cb[1].apply(cb[0],[res[0][0]].concat(cb.slice(2)))}this.del=function(cb,mdlUid){if(!(cb instanceof Array)||cb.length<2){return false}_conn.setCcmd('[["bdel","",["'.concat(mdlUid,'"]]]'));_conn.sendBatch([that,_del_post,cb])};function _del_post(res,cb){cb[1].apply(cb[0],[res[0][0]].concat(cb.slice(2)))}this.load=function(cb,mdlUid){if(!(cb instanceof Array)||cb.length<2){return false}_conn.setCcmd('[["bget","",["'.concat(mdlUid,'"],["src"],{}]]'));_conn.sendBatch([that,_load_post,cb])};function _load_post(res,cb){res=res[0];if(res[0]!==true||typeof res[1][0]!="object"){return false}cb[1].apply(cb[0],[res[1][0].src].concat(cb.slice(2)))}this.save=function(cb,mdlUid,src){if(!(cb instanceof Array)||cb.length<2){return false}var funclist=[];for(var res;(res=_re_findfunc.exec(src))!=null;){funclist.push(res[1])}_conn.setCcmd('[["bupd","",{"'.concat(mdlUid,'":{"src":',_json.encode(src),',"funclist":',_json.encode(funclist),"}}]]"));_conn.sendBatch([that,_save_post,cb])};function _save_post(res,cb){cb[1].apply(cb[0],[res[0][0]].concat(cb.slice(2)))}this.exprt=function(cb){if(!(cb instanceof Array)||cb.length<2){return false}_conn.rpc([that,_exprt_post,cb],"WSS","exportMacros",[])};function _exprt_post(res,cb){cb[1].apply(cb[0],[res].concat(cb.slice(2)))}this.ui_exec=function(ccmd){if(ccmd[0]!==true){return false}ccmd=ccmd[1];if(typeof ccmd=="string"&&ccmd.length){return eval(ccmd)}if(!(ccmd instanceof Array)){return false}for(var cmd,cmdid,c=-1;(cmd=ccmd[++c])!=undefined;){switch(cmdid=cmd.shift()){case"eval":eval(cmd[0]);break;case"actn":var actions=Jedox.wss.action,name=cmd.shift();if(name in actions){actions[name].apply(cmd)}break;case"msg":var icon=cmd[0];icon=icon in msgIcons?msgIcons[icon]:msgIcons.info;Ext.MessageBox.show({icon:icon,title:cmd[1],msg:cmd[2],buttons:Ext.MessageBox.OK});break}}}};Jedox.wss.wsel.chart={type_sizeDefs:{xlColumnClustered:"defHor",xlColumnStacked:"defHor",xlColumnStacked100:"defHor",xl3DColumnClustered:"defHor",xl3DColumnStacked:"defHor",xl3DColumnStacked100:"defHor",xlCylinderColClustered:"defHor",xlCylinderColStacked:"defHor",xlCylinderColStacked100:"defHor",xlLine:"defHor",xlLineStacked:"defHor",xlLineStacked100:"defHor",xlLineRotated:"defVer",xlLineMarkers:"defHor",xlLineMarkersStacked:"defHor",xlLineMarkersStacked100:"defHor",xlLineMarkersRotated:"defVer",xl3DLine:"defHor",xlPie:"defHor",xl3DPie:"defHor",xlPieExploded:"defHor",xl3DPieExploded:"defHor",xlBarClustered:"defHor",xlBarStacked:"defHor",xlBarStacked100:"defHor",xl3DBarClustered:"defHor",xl3DBarStacked:"defHor",xl3DBarStacked100:"defHor",xlCylinderBarClustered:"defHor",xlCylinderBarStacked:"defHor",xlCylinderBarStacked100:"defHor",xlArea:"defHor",xlAreaStacked:"defHor",xlAreaStacked100:"defHor",xl3DArea:"defHor",xl3DAreaStacked:"defHor",xl3DAreaStacked100:"defHor",xlXYScatter:"defHor",xlXYScatterSmooth:"defHor",xlXYScatterSmoothNoMarkers:"defHor",xlXYScatterLines:"defHor",xlXYScatterLinesNoMarkers:"defHor",xlStockHLC:"defHor",xlStockOHLC:"defHor",xlDoughnut:"defHor",xlDoughnutExploded:"defHor",xlBubble:"defHor",xlBubble3DEffect:"defHor",xlRadar:"defHor",xlRadarMarkers:"defHor",xlRadarFilled:"defHor",xlMeterOdoFull:"equal",xlMeterOdoFull100:"equal",xlMeterOdoHalf:"odoHalf",xlMeterOdoHalf100:"odoHalf",xlMeterAngularWide:"angulWide",xlMeterLineHorizontal:"lineHor",xlMeterLineVertical:"lineVer"},min_sizeFactor:100,min_whRatio:{defHor:[2.5,1],defVer:[1,2.5],equal:[1.5,1.5],odoHalf:[1.5,1],angulWide:[1.5,0.7],lineHor:[2,0.7],lineVer:[0.8,2]},max_width:700,max_height:700,whRatio:{defHor:[4,3],defVer:[3,4],equal:[2,2],odoHalf:[2,1.5],angulWide:[2.5,0.9],lineHor:[3,0.8],lineVer:[1,3]}};Jedox.wss.wsel.chart.reMovize=function(chartId,pos,offsets){var activeBook=Jedox.wss.app.activeBook;var winId=activeBook.getDomId();var tlSize=Jedox.wss.wsel.getTLSize(pos,offsets);var w=tlSize.size[0],h=tlSize.size[1];var wrapElem=Ext.get("".concat(winId,"_ws_element_",chartId,(document.all||Jedox.wss.app.appMode!=Jedox.wss.grid.viewMode.USER)?"-rzwrap":""));wrapElem.dom.style.left="".concat(tlSize.tl[0],"px");wrapElem.dom.style.top="".concat(tlSize.tl[1],"px");var whRatio=Jedox.wss.wsel.chart.min_whRatio[Jedox.wss.wsel.chart.type_sizeDefs[Ext.get("".concat(winId,"_ws_element_",chartId)).elemSubtype]];w=(whRatio[0]*Jedox.wss.wsel.chart.min_sizeFactor>w)?whRatio[0]*Jedox.wss.wsel.chart.min_sizeFactor:((Jedox.wss.wsel.chart.max_width<w)?Jedox.wss.wsel.chart.max_width:w);h=(whRatio[1]*Jedox.wss.wsel.chart.min_sizeFactor>h)?whRatio[1]*Jedox.wss.wsel.chart.min_sizeFactor:((Jedox.wss.wsel.chart.max_height<h)?Jedox.wss.wsel.chart.max_height:h);if(tlSize._error||(w!=tlSize.size[0])||(h!=tlSize.size[1])){Ext.Msg.show({title:"Incorect Chart Size".localize(),msg:"".concat("infoChart_wrongSize".localize(),"."),buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});tlSize._error=true}if((wrapElem.dom.offsetWidth!=w)||(wrapElem.dom.offsetHeight!=h)||(pos[0]==pos[2])||(pos[1]==pos[3])){if(tlSize._error){var chartData=Jedox.wss.wsel.getNLoc(tlSize.tl[0],tlSize.tl[1],w,h);var res=Jedox.wss.backend.ha.wsel("resize_chart",{id:chartId,n_location:chartData.n_location,pos_offsets:chartData.pos_offsets,size:[w,h]})}Ext.get("".concat(winId,"_ws_element_",chartId)).setSize(w,h);wrapElem.setSize(w,h);var currDate=new Date();document.getElementById("".concat(winId,"_ws_element_",chartId)).src="/spreadsheet/root/cc/gen_element.php?wam=".concat(Jedox.wss.app.appModeS,"&id=",chartId,"&w=",w,"&h=",h,"&ts=",currDate.getTime())}};Jedox.wss.dialog.chart.createChart=function(setWbWsID,winID,chartID,n_location,pos_offsets,size,chartType){if(chartID==null){Ext.MessageBox.show({title:"Operation Error".localize(),msg:"chartDlg_genError".localize(),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var chartTypesSizeDefs=Jedox.wss.wsel.chart.type_sizeDefs,chartMinSizeFactor=Jedox.wss.wsel.chart.min_sizeFactor,chartsMinWidthHeightRatio=Jedox.wss.wsel.chart.min_whRatio;var activeBook=Jedox.wss.app.activeBook,env=Jedox.wss.app.environment;var handleElementMove=false,isUserMode=(env.viewMode==Jedox.wss.grid.viewMode.USER),defMaxCoords=Jedox.wss.grid.defMaxCoords,elConstr={up:0,down:0,left:0,right:0,vportPos:[],lrCornerPx:[]},chartWrapperEl=null;var tlSize=Jedox.wss.wsel.getTLSize(Jedox.wss.wsel.getRngFromNLoc(n_location),pos_offsets);var elWidth=tlSize.size[0],elHeight=tlSize.size[1],elLeft=tlSize.tl[0],elTop=tlSize.tl[1];var whRatio=Jedox.wss.wsel.chart.min_whRatio[Jedox.wss.wsel.chart.type_sizeDefs[chartType]];elWidth=(whRatio[0]*Jedox.wss.wsel.chart.min_sizeFactor>elWidth)?whRatio[0]*Jedox.wss.wsel.chart.min_sizeFactor:((Jedox.wss.wsel.chart.max_width<elWidth)?Jedox.wss.wsel.chart.max_width:elWidth);elHeight=(whRatio[1]*Jedox.wss.wsel.chart.min_sizeFactor>elHeight)?whRatio[1]*Jedox.wss.wsel.chart.min_sizeFactor:((Jedox.wss.wsel.chart.max_height<elHeight)?Jedox.wss.wsel.chart.max_height:elHeight);if(tlSize._error||(elWidth!=tlSize.size[0])||(elHeight!=tlSize.size[1])){Ext.Msg.show({title:"Incorect Chart Size".localize(),msg:"".concat("infoChart_wrongSize2".localize(),"."),buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});var chartData=Jedox.wss.wsel.getNLoc(tlSize.tl[0],tlSize.tl[1],elWidth,elHeight);var res=Jedox.wss.backend.ha.wsel("resize_chart",{id:chartID,n_location:chartData.n_location,pos_offsets:chartData.pos_offsets,size:[elWidth,elHeight]})}var calcConstraints=function(){elConstr.vportPos=activeBook.getViewportPos();if(elLeft<0||elTop<0){elConstr.left=parseInt(elConstr.vportPos[0][0]+(elConstr.vportPos[1][0]-elConstr.vportPos[0][0]-elWidth)/2);elConstr.up=parseInt(elConstr.vportPos[0][1]+(elConstr.vportPos[1][1]-elConstr.vportPos[0][1]-elHeight)/2);elLeft=elConstr.left;elTop=elConstr.up}else{elConstr.left=elLeft;elConstr.up=elTop}elConstr.lrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);elConstr.right=elConstr.lrCornerPx[0]-elConstr.left-elWidth;elConstr.down=elConstr.lrCornerPx[1]-elConstr.up-elHeight};var onChartMouseDown=function(e){if(e.button==2||(Ext.isMac&&e.button==0&&Jedox.wss.app.ctrlKeyPressed)||(Ext.isWebKit&&e.button==1)){handleElementMove=false;showContextMenu(e);e.stopEvent()}else{var bEv=e.browserEvent;var el=(document.all)?bEv.srcElement:bEv.target;el.className="ws_element_move";var newVportPos=Jedox.wss.app.activeBook.getViewportPos();var newLrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);if(env.winStateMax){var vportDiff={h:newVportPos[0][0]-elConstr.vportPos[0][0],v:newVportPos[0][1]-elConstr.vportPos[0][1]};var lrCornerPxDiff={h:newLrCornerPx[0]-elConstr.lrCornerPx[0],v:newLrCornerPx[1]-elConstr.lrCornerPx[1]};chartWrapper.setXConstraint(elConstr.left+vportDiff.h,(elConstr.right-vportDiff.h)+lrCornerPxDiff.h);chartWrapper.setYConstraint(elConstr.up+vportDiff.v,(elConstr.down-vportDiff.v)+lrCornerPxDiff.v)}else{var leftConstr=elConstr.left-((bEv.clientX-(el.parentNode.offsetLeft+((document.all)?bEv.offsetX:bEv.layerX)-newVportPos[0][0]))-env.gridScreenCoordsMax[0])+newVportPos[0][0];chartWrapper.setXConstraint(leftConstr,newLrCornerPx[0]-leftConstr-elWidth);var topConstr=elConstr.up-((bEv.clientY-(el.parentNode.offsetTop+((document.all)?bEv.offsetY:bEv.layerY)-newVportPos[0][1]))-env.gridScreenCoordsMax[1])+newVportPos[0][1];chartWrapper.setYConstraint(topConstr,newLrCornerPx[1]-topConstr-elHeight)}Jedox.wss.wsel.moveRegistry.push([this,onChartMouseUp,el]);handleElementMove=true}};var onChartMouseUp=function(el){if(handleElementMove){el.className="ws_element";var newLeft=el.parentNode.offsetLeft,newTop=el.parentNode.offsetTop,elWidth=el.parentNode.offsetWidth,elHeight=el.parentNode.offsetHeight;if((newLeft!=elLeft)||(newTop!=elTop)){setTimeout(function(){elLeft=newLeft;elTop=newTop;var chartData={};chartData[chartID]=Jedox.wss.wsel.getNLoc(newLeft,newTop,elWidth,elHeight);Jedox.wss.backend.conn.cmd(0,["wupd"],["",chartData])},0)}handleElementMove=false}};var beforeResizeChart=function(wrapper,e){var resizeChild=wrapper.getResizeChild();var whRatio=chartsMinWidthHeightRatio[chartTypesSizeDefs[resizeChild.elemSubtype]];wrapper.minWidth=whRatio[0]*chartMinSizeFactor;wrapper.minHeight=whRatio[1]*chartMinSizeFactor};var afterResizeChart=function(wrapper,newWidth,newHeight,e){var wrapperEl=wrapper.getEl();elLeft=wrapperEl.getLeft(true);elTop=wrapperEl.getTop(true);if(elWidth!=newWidth){elConstr.right+=elWidth-newWidth}if(elHeight!=newHeight){elConstr.down+=elHeight-newHeight}var chartData=Jedox.wss.wsel.getNLoc(elLeft,elTop,newWidth,newHeight);var res=Jedox.wss.backend.ha.wsel("resize_chart",{id:chartID,n_location:chartData.n_location,pos_offsets:chartData.pos_offsets,size:[newWidth,newHeight]});var currDate=new Date();document.getElementById("".concat(winID,"_ws_element_",chartID)).src="/spreadsheet/root/cc/gen_element.php?wam=".concat(Jedox.wss.app.appModeS,"&id=",chartID,"&w=",newWidth,"&h=",newHeight,"&ts=",currDate.getTime())};var showContextMenu=function(e){var contextMenu=new Ext.menu.Menu({id:"chartContextMenu",cls:"default-format-window",enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}},items:[{text:"Change Chart Type".localize().concat("..."),iconCls:"icon_insert_chart",handler:editChartType},{text:"Select Source Data".localize().concat("..."),iconCls:"chart_source_data",handler:editSourceData},{text:"Format Chart Properties".localize().concat("..."),iconCls:"icon_edit",handler:editChart},{text:"Delete Chart".localize(),iconCls:"icon_delete",handler:deleteChart}]});var coords=e.getXY();contextMenu.showAt([coords[0],coords[1]])};function editChart(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.editChart,["edit",chartID])}function editChartType(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.editChartType,["edit",chartID])}function editSourceData(){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.editSourceData,["edit",chartID])}function deleteChart(){if(Jedox.wss.backend.ha.wsel("delete_element",chartID)){chartWrapperEl.remove()}else{Ext.MessageBox.show({title:"Operation Error".localize(),msg:"chartDlg_deleteError".localize(),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}var currDate=new Date();var gridDivId=activeBook.getDomId()+"_IC";calcConstraints();Ext.DomHelper.insertFirst(Ext.DomQuery.selectNode("div[id="+gridDivId+"]"),{tag:"img",id:"".concat(winID,"_ws_element_",chartID),src:"/spreadsheet/root/cc/gen_element.php?wam=".concat(Jedox.wss.app.appModeS,"&id=",chartID,"&w=",elWidth,"&h=",elHeight,"&ts=",currDate.getTime(),((setWbWsID)?"".concat("&wbid=",activeBook.getWbId(),"&wsid=",activeBook.getWsId()):"")),width:elWidth,height:elHeight,cls:"ws_element",style:"".concat("z-index: 50; position: absolute; left:",elLeft,"px; top:",elTop,"px;")},false);Ext.ResizableConstrained=function(el,config){Ext.ResizableConstrained.superclass.constructor.call(this,el,config)};Ext.extend(Ext.ResizableConstrained,Ext.Resizable,{setXConstraint:function(left,right){this.dd.setXConstraint(left,right)},setYConstraint:function(up,down){this.dd.setYConstraint(up,down)}});var chartWrapper=new Ext.ResizableConstrained("".concat(winID,"_ws_element_",chartID),{wrap:document.all||!isUserMode,dynamic:!isUserMode,pinned:false,width:elWidth,height:elHeight,minWidth:250,maxWidth:Jedox.wss.wsel.chart.max_width,minHeight:100,maxHeight:Jedox.wss.wsel.chart.max_height,preserveRatio:false,transparent:false,handles:(document.all&&isUserMode)?"none":"all",draggable:!isUserMode,enabled:!isUserMode,style:"background-color: white;",resizeRegion:Ext.get(gridDivId).getRegion()});Ext.get("".concat(winID,"_ws_element_",chartID)).elemSubtype=chartType;if(!isUserMode){chartWrapper.on({resize:{fn:afterResizeChart,scope:this},beforeresize:{fn:beforeResizeChart,scope:this}});chartWrapper.dd.maintainOffset=true;chartWrapper.setXConstraint(elConstr.left,elConstr.right);chartWrapper.setYConstraint(elConstr.up,elConstr.down);chartWrapperEl=chartWrapper.getEl();chartWrapperEl.dom.style.backgroundColor="#FFFFFF";chartWrapperEl.on({mousedown:{fn:onChartMouseDown,scope:this},dblclick:{fn:editChart,scope:this}})}};Jedox.wss.dialog.Browse=function(OSHflag,closeWinFnc,preselectMode){var that=this;var title;var btn;var typeCmb;var hyperlink={removeTlbBtn:false,newFolderTlbBtn:false,fileTypesCmb:false};that.closeFnc=closeWinFnc;that.activeHierarchy={};that._isHyperlink=false;that._preselectMode=preselectMode?true:false;that._selectAfterDump_cb=false;that._nodeClick_cb=false;that.gStore=new Ext.data.SimpleStore({fields:["id","name"]});that.fStore=new Ext.data.SimpleStore({fields:[{name:"id",type:"string"},{name:"text",type:"string"},{name:"leaf"},{name:"qtip",type:"string"},{name:"iconCls",type:"string"},{name:"img_src",type:"string"}],sortInfo:{field:"iconCls",direction:"ASC"}});var folderTypeData=[["My Workbook Documents".localize(),"my_workbook_documents"]];var folderTypeNavigationStore=new Ext.data.SimpleStore({fields:["label","icon"],data:folderTypeData});var fileTypes=[["0","Work Sheet Files".localize()],["1","All Files".localize()]];var fileTypesStore=new Ext.data.SimpleStore({fields:["code","option"],data:fileTypes});var saveTypes=[["0","Work Sheet Files (*.wss)".localize()]];var saveTypesStore=new Ext.data.SimpleStore({fields:["code","option"],data:saveTypes});var fileNameData=[[""]];var fileNameStore=new Ext.data.SimpleStore({fields:["fileName"],data:fileNameData});var pathTxf=new Ext.form.TextField({fieldLabel:"Path".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",allowBlank:false,width:200});that.gCmb=new Ext.form.ComboBox({store:that.gStore,displayField:"name",valueField:"id",fieldLabel:"Look in".localize(),readOnly:false,editable:false,lazyRender:true,typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,width:330,listeners:{select:function(cmb,record,index){if(that.activeGroup!=record.data){var wssStudioHandler={treeSetGroup:function(result){if(!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());return false}that.activeGroup=record.data;that.hierarchyTP.root.setText(record.data.name);that.initHierarchies(that.activeGroup.id)}};var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeSetGroup("wss",record.data.id)}}}});var root=new Ext.tree.TreeNode({text:"root",draggable:false,editable:false,id:"root",iconCls:"w3s_group",expanded:true});that.hierarchyTP=new Ext.tree.TreePanel({border:false,lines:true,heigth:100,containerScroll:true,ddScroll:true,autoScroll:true,collapseFirst:false,root:root,collapseFirst:true,listeners:{click:function(node,e){if(!that._nodeClick_cb){var wssStudioHandler={treeSetHierarchy:function(result){if(!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());return false}that.hierarchyTP.fireEvent("click",node)}};if(node.id!="root"){if(node.attributes.type){if(that.activeHierarchy.id!=node.attributes.id){var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeSetHierarchy("wss",node.attributes.id);_nodeClick_cb=true;that.activeHierarchy.id=node.attributes.id;return false}}else{if(that.activeHierarchy.id!=node.attributes.h_uid){var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeSetHierarchy("wss",node.attributes.h_uid);_nodeClick_cb=true;that.activeHierarchy.id=node.attributes.h_uid;return false}}}}else{that._nodeClick_cb=false}node.expand()},select:function(id){var node=this.getNodeById(id);this.fireEvent("click",node)},up:function(sn){if(sn){var parentNode=sn.parentNode;if(parentNode){this.fireEvent("click",parentNode)}}}}});that.hierarchyTP.on("click",function(n){var sn=that.hierarchyTP.getSelectionModel().getSelectedNode()||{};if(n.id!=sn.id&&n.id!="root"){if(n.attributes.type){initFilesData(n.attributes.type)}else{initFilesData(n.attributes.n_uid)}}else{if(n.id=="root"){clear()}}});var mainListView=new Ext.DataView({id:"main-list-view",store:that.fStore,tpl:new Ext.XTemplate('<div class="main-list-view"><tpl for=".">','<div class="thumb-wrap">','<div class="thumb" style="padding: 0px; text-align: left;">','<div style="width: 16px; height: 16px; display: inline;">','<img class="{img_src}" src="../lib/ext/resources/images/default/s.gif" width="16" height="16"></div>','<span class="x-editable">&nbsp;{text}</span></div></div>',"</tpl></div>"),autoWidth:true,multiSelect:false,autoScroll:true,singleSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:"",plugins:[new Ext.DataView.DragSelector()],listeners:{dblclick:function(dataView,index,node,e){onDblClick(dataView.store.getAt(index).get("id"),dataView.store.getAt(index).get("iconCls"))},click:function(dataView,index,node,e){var value="";if(that.fStore.getAt(index).get("iconCls")!="w3s_folder"){value=that.fStore.getAt(index).get("text");that.selectionId=that.fStore.getAt(index).get("id");if(!isClicked(value)){fileNameData.unshift(new Array());fileNameData[0].push(value);fileNameStore.loadData(fileNameData)}}that.fileNameCmb.setValue(value)}}});var mainDetailsView=new Ext.grid.GridPanel({id:"main-details-view",colModel:new Ext.grid.ColumnModel([{id:"folder-name",header:"Name",width:30,sortable:true,dataIndex:"text",renderer:formatTitle,editor:new Ext.form.TextField({allowBlank:false})},{header:"Size",width:20,sortable:true,dataIndex:""},{header:"Type",width:20,sortable:true,dataIndex:""},{header:"Last Modified",width:20,sortable:true,dataIndex:""}]),store:that.fStore,viewConfig:{forceFit:true},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),border:false,iconCls:"icon-grid",listeners:{rowdblclick:function(gridView,index,e){onDblClick(gridView.store.getAt(index).get("id"),gridView.store.getAt(index).get("iconCls"))},rowclick:function(gridView,index,e){var value="";if(that.fStore.getAt(index).get("iconCls")!="w3s_folder"){value=that.fStore.getAt(index).get("text");that.selectionId=that.fStore.getAt(index).get("id");if(!isClicked(value)){fileNameData.unshift(new Array());fileNameData[0].push(value);fileNameStore.loadData(fileNameData)}}that.fileNameCmb.setValue(value)}}});var mainThumbnailsView=new Ext.DataView({id:"main-thumbnails-view",store:that.fStore,tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{text}">','<div class="thumb"><div class="{img_src}32"><img src="../lib/ext/resources/images/default/s.gif" title="{text}"></div></div>','<span class="x-editable">{shortName}</span></div>',"</tpl>",'<div class="x-clear"></div>'),autoWidth:true,multiSelect:false,singleSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:"",plugins:[new Ext.DataView.DragSelector()],prepareData:function(data){data.shortName=Ext.util.Format.ellipsis(data.text,11);return data},listeners:{dblclick:function(dataView,index,node,e){onDblClick(dataView.store.getAt(index).get("id"),dataView.store.getAt(index).get("iconCls"))},click:function(dataView,index,node,e){var value="";if(that.fStore.getAt(index).get("iconCls")!="w3s_folder"){value=that.fStore.getAt(index).get("text");that.selectionId=that.fStore.getAt(index).get("id");if(!isClicked(value)){fileNameData.unshift(new Array());fileNameData[0].push(value);fileNameStore.loadData(fileNameData)}}that.fileNameCmb.setValue(value)}}});that.fileNameCmb=new Ext.form.ComboBox({store:fileNameStore,displayField:"fileName",fieldLabel:"File name".localize(),typeAhead:true,mode:"local",triggerAction:"all",width:400});var fileTypesCmb=new Ext.form.ComboBox({fieldLabel:"Files of type".localize(),width:400,store:fileTypesStore,displayField:"option",valueField:"code",typeAhead:true,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true,listeners:{select:function(cmb,record,index){if(cmb.getValue()==0){that.fStore.filterBy(filterFunc)}else{that.fStore.clearFilter(false)}}}});var saveTypesCmb=new Ext.form.ComboBox({fieldLabel:"Save as type".localize(),width:400,store:saveTypesStore,displayField:"option",valueField:"code",typeAhead:true,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true});function isClicked(value){var flag=false;for(var i=0;i<fileNameData.length;i++){if(value===fileNameData[i][0]){flag=true;break}}return flag}function onContainerClick(dView,e){e.stopEvent();return false}function setView(m,pressed){if(!m){var viewMenu=Ext.menu.MenuMgr.get("view-menu");viewMenu.render();var items=viewMenu.items.items;var b=items[0],r=items[1],h=items[2];if(b.checked){r.setChecked(true)}else{if(r.checked){h.setChecked(true)}else{if(h.checked){b.setChecked(true)}}}return}if(pressed){var mvp=Ext.getCmp("main-view-panel");switch(m.text){case"List".localize():mvp.layout.setActiveItem("main-list-view");mvp.ownerCt.doLayout();break;case"Thumbnails".localize():mvp.layout.setActiveItem("main-thumbnails-view");mvp.ownerCt.doLayout();break;case"Details".localize():mvp.layout.setActiveItem("main-details-view");mvp.ownerCt.doLayout();break}}}function initInterface(){if(OSHflag==="open"){title="Open".localize();typeCmb=fileTypesCmb}else{if(OSHflag==="hyperlink"){typeCmb={html:"",baseCls:"x-plain"};hyperlink.removeTlbBtn=hyperlink.newFolderTlbBtn=true;that._isHyperlink=true}else{title="Save As".localize();typeCmb=saveTypesCmb}}}initInterface();function init(){function initGroups_cb(result){if(result){function selectGroup_cb(result){if(result){that.initHierarchies()}}that.selectGroup(getDefaultGroupIndex(),selectGroup_cb)}}that.initGroups(initGroups_cb)}function getDefaultGroupIndex(){var index=that.gStore.find("id",Jedox.wss.app.defaultFiles.group);return index!=-1?index:0}function initFilesData(node){var wssStudioHandler={treeMngNode:function(result){if(!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());return false}var fData=[];for(var i=0;i<result.length;i++){fData.push([result[i].id,result[i].text,result[i].leaf,result[i].qtip,result[i].iconCls,img_src(result[i].iconCls)])}that.fStore.loadData(fData);filterStore();clearFileNames();if(that._selectAfterDump_cb){that._selectAfterDump_cb();_selectAfterDump_cb=false}}};var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeMngNode("wss",node,"dump",0)}function filterStore(){if(fileTypesCmb.getValue()==0){that.fStore.filterBy(filterFunc)}}function clearFileNames(){if(OSHflag==="save"||OSHflag==="saveqp"){return false}fileNameData=[[""]];fileNameStore.removeAll();that.fileNameCmb.setValue("")}function img_src(iconCls){return iconCls}function onDblClick(id,iconCls){if(iconCls==="w3s_folder"){propagateSelection(id)}else{if(!that._isHyperlink){that.openWB(id)}}}function propagateSelection(n_uid){var id=that.hierarchyTP.getNodeById(n_uid)?n_uid:that.activeHierarchy.id+"_"+n_uid;that.hierarchyTP.fireEvent("select",id)}function formatTitle(value,p,record){return String.format('<div class="topic"><img src="{0}"/>&nbsp;&nbsp;{1}</div>',record.data.img_src,value)}function filterFunc(record,id){return record.get("iconCls")==="w3s_workbook"||record.get("iconCls")==="w3s_folder"?true:false}function clearFilter(record,id){return record.get("iconCls")!=="w3s_workbook"?true:false}function onUp(){var sn=that.hierarchyTP.selModel.getSelectedNode();that.hierarchyTP.fireEvent("up",sn)}function clear(){that.fStore.removeAll();filterStore();clearFileNames()}function addFolder(){}function remove(){var parentId=that.getParentId();Jedox.wss.backend.studio.treeMngNode("file",parentId,"removeNode",that.selectionId);initFilesData(parentId)}Jedox.wss.dialog.Browse.superclass.constructor.call(this,{id:"open-save-dlg-browse-panel",layout:"absolute",baseCls:"x-plain",border:false,items:[{layout:"column",border:false,baseCls:"x-plain",width:600,height:40,x:0,y:0,items:[{layout:"form",border:false,baseCls:"top-left-bottom-panel",width:460,items:that.gCmb},{border:false,baseCls:"toolbar-panel",width:130,height:30,tbar:[{tooltip:{title:"Up".localize(),text:"Go Up one level".localize()},iconCls:"folder-up-icon",handler:onUp,scope:this},"-",{tooltip:{title:"Delete".localize(),text:"Delete".localize().concat("...")},iconCls:"delete-icon",handler:remove,hidden:hyperlink.removeTlbBtn,scope:this},{tooltip:{title:"New Folder".localize(),text:"Adds New folder to the list".localize()},iconCls:"new-folder-icon",hidden:hyperlink.newFolderTlbBtn,scope:this,disabled:true},{split:true,tooltip:{title:"View".localize(),text:"View".localize().concat("...")},iconCls:"view-menu-icon",handler:setView.createDelegate(this,[]),menu:{id:"view-menu",cls:"view-menu",width:110,items:[{text:"List".localize(),checked:true,group:"rp-view",checkHandler:setView,scope:this,iconCls:"view-list-icon"},{text:"Thumbnails".localize(),checked:false,group:"rp-view",checkHandler:setView,scope:this,iconCls:"view-thumbnails-icon"},{text:"Details".localize(),checked:false,group:"rp-view",checkHandler:setView,scope:this,iconCls:"view-details-icon"}]}}]}]},{baseCls:"left-panel",layout:"fit",border:false,width:200,height:220,x:5,y:40,items:that.hierarchyTP},{id:"main-view-panel",layout:"card",autoScroll:true,defaults:{bodyStyle:"padding:0px"},width:370,height:220,x:210,y:40,items:[mainListView,mainThumbnailsView,mainDetailsView],activeItem:0},{layout:"form",border:false,baseCls:"top-left-bottom-panel",width:600,height:100,x:0,y:260,items:[that.fileNameCmb,typeCmb]}]});if(!that._preselectMode){init()}fileTypesCmb.setValue(that._isHyperlink?"1":"0");saveTypesCmb.setValue("0")};Ext.extend(Jedox.wss.dialog.Browse,Ext.Panel,{initComponent:function(){var that=this;Jedox.wss.dialog.Browse.superclass.initComponent.call(this);this.onOpen=function(){var name=that.fileNameCmb.getValue();var id=that.getIdByName(name);that.openWB(id)};this.onSave=function(cb){var parentId=that.getParentId();var group=that.gCmb.getValue();var hierarchy=that.activeHierarchy.id;if(!parentId){return false}var fileName=that.trim(that.fileNameCmb.getValue());var s=fileName.toLowerCase().indexOf(".wss");if(s>0&&s===fileName.length-4){fileName=that.trim(fileName.slice(0,length-4))}if(that.validateName(fileName)){that.closeFnc();var oldMeta=Jedox.wss.workspace.getMetaByWinId(Jedox.wss.app.activeBook.getWinId());try{for(var triggers=Jedox.wss.events.triggers.saveAsWorkbook_before,i=triggers.length-1,wbMeta=oldMeta;i>=0;i--){triggers[i][0]["saveAsWorkbook_before"].call(parent,triggers[i][1],wbMeta.ghn,wbMeta.name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR);return}var saveRes=Jedox.wss.backend.ha.saveWorkbook(group,hierarchy,fileName,parentId);if(!saveRes[0]){Ext.MessageBox.show({title:"Save As".localize(),msg:saveRes[1].localize(saveRes[2]),modal:true,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING,fn:Ext.emptyFn,minWidth:300})}else{var activeBook=Jedox.wss.app.activeBook,newWbMeta={g:saveRes[1].group,h:saveRes[1].hierarchy,n:saveRes[1].node,p:saveRes[1].perm};activeBook.setWinCaption(fileName);Jedox.wss.workspace.updateMeta(activeBook.getWinId(),fileName,newWbMeta);activeBook.setWbId(saveRes[1].wbid);Jedox.wss.action.adjustToACL();try{for(var triggers=Jedox.wss.events.triggers.saveAsWorkbook_after,i=triggers.length-1,wbMeta=newWbMeta;i>=0;i--){triggers[i][0]["saveAsWorkbook_after"].call(parent,triggers[i][1],{g:wbMeta.g,h:wbMeta.h,n:wbMeta.n},oldMeta.name,fileName)}}catch(e){Jedox.wss.general.showMsg("Application Error",e.message,Ext.MessageBox.ERROR)}if(cb instanceof Array&&cb.length>1){cb[1].call(cb[0])}}}else{Ext.MessageBox.show({title:"Save As".localize(),msg:"save_as_err_msg".localize({fileName:fileName}),modal:true,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING,fn:Ext.emptyFn,minWidth:300})}};this.onInsertHyperlink=function(){var g=that.activeGroup.id;var h=that.activeHierarchy.id;var n=that.selectionId;if(g&&h&&n){var result=Jedox.wss.backend.studio.getNodeHyperlinkPropertiesData(g,h,n);if(result){return result}else{return false}}else{var title="Insert Hyperlink".localize();var message="_hl_no_selected_file".localize();that.showMessageALERT(title,message)}};this.preselectPath=function(ghn){that.initGroups(function(result){if(result){for(var i=0,count=that.gStore.getCount();i<count;i++){if(that.gStore.getAt(i).get("id")==ghn.g){break}}that.selectGroup(i,function(result){if(result){that.initHierarchies(ghn.g,function(){var hNode=that.hierarchyTP.getNodeById(ghn.h);if(hNode){hNode.expand(false,false,function(hNode){var wssStudioHandler={getElementPath:function(result){if(!result[0]){that.showMessageERROR("Hyperlink Error".localize(),"_hl_missing_target_node".localize());return false}var path="/root/"+result[1];that.hierarchyTP.expandPath(path,false,function(bSuccess,oLastNode){if(bSuccess&&oLastNode){if(result.length==2&&result[1]){var id=result[1].split("/")[result[1].split("/").length-1];var node=that.hierarchyTP.getNodeById(id);if(node){that._selectAfterDump_cb=function(){that.selectNode(ghn.n)};that.hierarchyTP.fireEvent("click",node)}}}})}};var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.getElementPath(ghn.g,ghn.h,ghn.n)})}})}})}})}},showMessageERROR:function(title,message){Ext.Msg.show({title:title,msg:message,buttons:Ext.Msg.OK,animEl:"elId",icon:Ext.MessageBox.ERROR})},showMessageALERT:function(title,message){Ext.Msg.show({title:title,msg:message,buttons:Ext.Msg.OK,animEl:"elId",icon:Ext.MessageBox.WARNING})},getRelativePath:function(id){var parent=this.hierarchyTP.getNodeById(this.activeHierarchy.id+"_"+this.getParentId()).getPath("text");var fileName=this.getFileName(this.fileNameCmb.getValue());return parent.concat("/",fileName).slice(1)},getFileName:function(name){var extension;var iconCls;for(var i=0;i<this.fStore.getCount();i++){if(this.fStore.getAt(i).data.text===name){iconCls=this.fStore.getAt(i).data.iconCls;break}}switch(iconCls){case"w3s_workbook":extension=".wss";break;case"w3s_jpg":extension=".jpg";break;case"w3s_png":extension=".png";break;case"w3s_gif":extension=".gif";break;case"w3s_txt":extension=".txt";break;case"w3s_rtf":extension=".rtf";break;case"w3s_pdf":extension=".pdf";break;case"w3s_zip":extension=".zip";break;case"w3s_rar":extension=".rar";break;case"w3s_doc":extension=".doc";break;case"w3s_csv":extension=".csv";break;case"w3s_pps":extension=".pps";break;case"w3s_ppt":extension=".ppt";break;case"w3s_xls":extension=".xls";break;case"w3s_xlsx":extension=".xlsx";break;case"w3s_hyperlink":extension=".hyperlink";break;case"w3s_html":extension=".html";break;default:extension=".unknown";break}return name.concat(extension)},openWB:function(id){var that=this;var group=this.gCmb.getValue();var hierarchy=this.activeHierarchy.id;var name=this.fileNameCmb.getValue();try{that.closeFnc();for(var triggers=Jedox.wss.events.triggers.openWorkbook_before,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_before"].call(parent,triggers[i][1],{g:group,h:hierarchy,n:id},name,false)}Jedox.wss.book.load(null,id,group,hierarchy,{vars:true});for(var triggers=Jedox.wss.events.triggers.openWorkbook_after,i=triggers.length-1;i>=0;i--){triggers[i][0]["openWorkbook_after"].call(parent,triggers[i][1],{g:group,h:hierarchy,n:id},name)}}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}},getParentId:function(){var sn=this.hierarchyTP.selModel.getSelectedNode();if(sn){if(sn.attributes.type){return sn.attributes.type}else{if(sn.id==="root"){return null}else{return sn.attributes.n_uid}}}},getIdByName:function(name){for(var i=0;i<this.fStore.getCount();i++){if(name===this.fStore.getAt(i).get("text")){return this.fStore.getAt(i).get("id")}}},trim:function(s){return s.replace(/^\s+|\s+$/g,"")},validateName:function(name){var that=this;function validateInput(){return true}if(!validateInput()){return false}name=that.trim(name).toLowerCase();for(var i=0;i<that.fStore.getCount();i++){if(name===that.fStore.getAt(i).get("text").toLowerCase()&&that.fStore.getAt(i).get("iconCls")=="w3s_workbook"){return false}}return true},initGroups:function(cb){var that=this;var wssStudioHandler={treeMngGroup:function(result){if(!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());if(cb){cb(false)}return false}var gData=[];for(var i in result){gData.push([i,result[i].name])}that.gStore.loadData(gData);if(cb){cb(true)}}};var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeMngGroup("listGroups",["file"])},selectGroup:function(index,cb){var that=this;var wssStudioHandler={treeSetGroup:function(result){if(!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());if(cb){cb(false)}return false}that.activeGroup=record.data;that.gCmb.setValue(record.data.id);that.hierarchyTP.root.setText(record.data.name);that.hierarchyTP.root.g_id=record.data.id;if(cb){cb(true)}}};if(that.gStore.getCount()>0){var record=that.gStore.getAt(index);var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeSetGroup("wss",record.data.id)}else{that.activeGroup=null;that.gCmb.disable();if(cb){cb(false)}return false}},initHierarchies:function(group,cb){var that=this;var nodes=[];this.hierarchyTP.root.eachChild(function(node){nodes.push(node)},[this.hierarchyTP]);for(var i=0;i<nodes.length;i++){nodes[i].remove()}if(!group){group=this.activeGroup.id}var hData=[];var wssStudioHandler={treeMngHierarchy:function(result){if(result!=null&&!result){that.showMessageERROR("Database read error".localize(),"read_data_err".localize());return false}for(var i in result){that.hierarchyTP.root.appendChild(new Ext.tree.AsyncTreeNode({id:i,text:result[i].name,draggable:false,editable:false,iconCls:"w3s_hierarchy",type:"root",loader:new Ext.tree.TreeLoader({dataUrl:Jedox.wss.backend.studio.dispatcher.serverUrl.concat("&wam=",Jedox.wss.app.appModeS,"&c=",Jedox.wss.backend.studio.className,"&m=treeDump"),baseParams:{type:"wss",hierarchy:i,filter:"folder",multi_h:true}})}))}that.hierarchyTP.root.expand(false,false,function(gNode){if(cb){cb();return}if(that.hierarchyTP.root.hasChildNodes()){var hNode;if(that.hierarchyTP.root.hasChildNodes()){hNode=that.hierarchyTP.getNodeById(Jedox.wss.app.defaultFiles.hierarchy)||that.hierarchyTP.getNodeById(that.hierarchyTP.root.firstChild.attributes.id)}else{hNode=that.hierarchyTP.getNodeById(that.hierarchyTP.root.attributes.id)}if(hNode){hNode.expand(false,false,function(hNode){that.hierarchyTP.fireEvent("click",hNode)})}}})}};var wssStudioStub=new Studio(wssStudioHandler);wssStudioStub.treeMngHierarchy("wss","listHierarchies")},selectNode:function(n){for(var i=0;i<this.fStore.getCount();i++){if(this.fStore.getAt(i).get("id")==n){break}}Ext.getCmp("main-list-view").select(i);Ext.getCmp("main-thumbnails-view").select(i);Ext.getCmp("main-details-view").getSelectionModel().selectRow(i);this.selectionId=this.fStore.getAt(i).get("id");this.fileNameCmb.setValue(this.fStore.getAt(i).get("text"))}});var ConstListEditor=Ext.extend(Ext.Panel,{imgPath:"/spreadsheet/root/ui/studio/res/img/rt/",cmnImgPath:"/spreadsheet/root/ui/common/res/img/palo/",width:350,height:255,border:"1px solid",initComponent:function(){var that=this;Ext.apply(this,{layout:"absolute"});ConstListEditor.superclass.initComponent.call(this);var ConstListDataViewClass=Ext.extend(Ext.DataView,{focusedClass:"x-view-focused",focusEl:true,afterRender:function(){ConstListDataViewClass.superclass.afterRender.call(this);var that=this;if(this.singleSelect||this.multiSelect){if(this.focusEl===true){this.focusEl=this.el.parent().parent().createChild({tag:"a",href:"#",cls:"x-view-focus",tabIndex:"-1"});this.focusEl.insertBefore(this.el.parent());this.focusEl.swallowEvent("click",true);this.renderedFocusEl=true}else{if(this.focusEl){this.focusEl=Ext.get(this.focusEl)}}if(this.focusEl){this.keyNav=new Ext.KeyNav(this.focusEl,{enter:function(){if(that.events.onkeyenter){that.events.onkeyenter.fire()}},scope:this,forceKeyDown:true})}}},onClick:function(e){var item=e.getTarget(this.itemSelector,this.el);if(item){var index=this.indexOf(item);if(this.onItemClick(item,index,e)!==false){this.fireEvent("click",this,index,item,e);this.retainFocus()}}else{if(this.fireEvent("containerclick",this,e)!==false){this.clearSelections();this.retainFocus()}}},retainFocus:function(){if(this.focusEl){this.focusEl.focus()}},doRetainFocus:function(){this.focusEl.focus()}});var ConstInlineEditor=function(cfg,field){ConstInlineEditor.superclass.constructor.call(this,field||new Ext.form.TextField({allowBlank:true,growMin:290,growMax:290,grow:true,selectOnFocus:true}),cfg)};Ext.extend(ConstInlineEditor,Ext.Editor,{alignment:"tl-tl",hideEl:false,cls:"x-small-editor",shim:false,completeOnEnter:true,cancelOnEsc:true,init:function(view){this.view=view;view.on("render",this.initEditor,this)},initEditor:function(){this.view.getEl().on("dblclick",this.onDblClick,this,{delegate:this.labelSelector})},onDblClick:function(e,target){if(!this.disabled&&!e.ctrlKey&&!e.shiftKey){var item=this.view.findItemFromChild(target);e.stopEvent();var record=this.view.store.getAt(this.view.indexOf(item));this.startEdit(target,record.data[this.dataIndex]);this.activeRecord=record}else{e.preventDefault()}}});var ConstRecord=new Ext.data.Record.create([{name:"name"}]);var storeConsts=new Ext.data.SimpleStore({fields:[{name:"name"}]});this.setList=function(list){storeConsts.removeAll();if(list&&(list.constructor.toString().indexOf("Array")!=-1)){var listSize=list.length;for(var i=0;i<listSize;i++){storeConsts.add(new ConstRecord({name:this.list[i]}))}}};this.getList=function(){var retList=[];var storeSize=storeConsts.getCount();for(var i=0;i<storeSize;i++){retList.push(storeConsts.getAt(i).get("name"))}return retList};if(this.list){this.setList(this.list)}var ciePlugin=new ConstInlineEditor({dataIndex:"name",labelSelector:"div.row-const-list-selector",listeners:{beforecomplete:function(thisEd,value,startValue){if(value&&(value!="")){thisEd.activeRecord.set(thisEd.dataIndex,value)}else{if(value==""){thisEd.activeRecord.store.remove(thisEd.activeRecord)}}},complete:function(){viewConsts.retainFocus()},canceledit:function(thisEd,value,startValue){if(startValue=="New Constant".localize()){thisEd.activeRecord.store.remove(thisEd.activeRecord)}}}});var viewConsts=new ConstListDataViewClass({itemSelector:"div.row-const-list-selector",style:"overflow:auto;",multiSelect:true,store:storeConsts,cls:"cleDataViewSelect",plugins:[ciePlugin],tpl:new Ext.XTemplate('<tpl for=".">','<div class="row-const-list-selector" style="cursor:pointer;line-height:18px;">',"<span>&#160;{name}</span>","</div>","</tpl>")});var panel_viewConsts=new Ext.Panel({layout:"fit",style:"border:1px solid;",bodyStyle:"background-color:white;",items:[viewConsts]});var topBtnHandler=function(){var storeSize=storeConsts.getCount();var numOfSelectedConsts=viewConsts.getSelectionCount();for(var tmpRec,i=0,j=0;i<storeSize;i++){if(viewConsts.isSelected(viewConsts.getNode(i))){tmpRec=storeConsts.getAt(i);storeConsts.remove(tmpRec);storeConsts.insert(j,tmpRec);j++}}if(numOfSelectedConsts>0){var selIndexes=[];for(var i=0;i<numOfSelectedConsts;i++){selIndexes.push(i)}viewConsts.select(selIndexes);var firstNode=viewConsts.getNode(0);firstNode.scrollIntoView(viewConsts.body,false)}};var upBtnHandler=function(){var tmpElem;var tmpSelectedIds=viewConsts.getSelectedIndexes();var storeSize=storeConsts.getCount();for(var i=1;i<storeSize;i++){if(viewConsts.isSelected(viewConsts.getNode(i))){if(!viewConsts.isSelected(viewConsts.getNode(i-1))){tmpElem=storeConsts.getAt(i);storeConsts.remove(tmpElem);storeConsts.insert(i-1,tmpElem);for(var j=0;j<tmpSelectedIds.length;j++){if(tmpSelectedIds[j]==i){tmpSelectedIds[j]=i-1;break}}viewConsts.select(tmpSelectedIds)}}}for(var tmpNode,i=0;i<storeSize;i++){tmpNode=viewConsts.getNode(i);if(viewConsts.isSelected(tmpNode)){tmpNode.scrollIntoView(viewConsts.body,false);break}}};var downBtnHandler=function(){var tmpSelectedIds=viewConsts.getSelectedIndexes();var storeSize=storeConsts.getCount();for(var tmpElem,i=(storeSize-2);i>=0;i--){if(viewConsts.isSelected(viewConsts.getNode(i))){if(!viewConsts.isSelected(viewConsts.getNode(i+1))){tmpElem=storeConsts.getAt(i);storeConsts.remove(tmpElem);storeConsts.insert(i+1,tmpElem);for(var j=0;j<tmpSelectedIds.length;j++){if(tmpSelectedIds[j]==i){tmpSelectedIds[j]=i+1;break}}viewConsts.select(tmpSelectedIds)}}}for(var tmpNode,i=storeSize;i>0;i--){tmpNode=viewConsts.getNode(i-1);if(viewConsts.isSelected(tmpNode)){tmpNode.scrollIntoView(viewConsts.body,false);break}}};var bottomBtnHandler=function(){var storeSize=storeConsts.getCount();var numOfSelectedConsts=viewConsts.getSelectionCount();for(var tmpRec,i=0;i<storeSize;i++){if(viewConsts.isSelected(viewConsts.getNode(i))){var tmpRec=storeConsts.getAt(i);storeConsts.remove(tmpRec);storeConsts.add(tmpRec);i--}}if(numOfSelectedConsts>0){var selIndexes=[];var storeSize=storeConsts.getCount();for(var i=0;i<numOfSelectedConsts;i++){selIndexes.push(storeSize-i-1)}viewConsts.select(selIndexes);var lastNode=viewConsts.getNode(storeSize-1);lastNode.scrollIntoView(viewConsts.body,false)}};var btnAcctions={top:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_toup",handler:topBtnHandler}),up:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_up",handler:upBtnHandler}),down:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_down",handler:downBtnHandler}),bottom:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_todown",handler:bottomBtnHandler})};var panel_btnAcctions=new Ext.Panel({border:false,bodyStyle:"background-color:transparent;vertical-align:middle;",layout:"form",width:31,autoHeight:true,items:[btnAcctions.top,btnAcctions.up,btnAcctions.down,btnAcctions.bottom]});var addConst=function(){var newIndex=storeConsts.getCount();storeConsts.add(new ConstRecord({name:"New Constant".localize()}));viewConsts.select(newIndex);var endIndex=storeConsts.getCount()-1;var newNode=viewConsts.getNode(endIndex);newNode.scrollIntoView(viewConsts.body,false);var newRec=viewConsts.getRecord(newNode);ciePlugin.activeRecord=newRec;ciePlugin.startEdit(newNode,newRec.data[ciePlugin.dataIndex])};var deleteConsts=function(btn){if(btn=="ok"){var delConsts=viewConsts.getSelectedRecords();var delConstsSize=delConsts.length;for(var i=0;i<delConstsSize;i++){storeConsts.remove(delConsts[i])}}};var btnOps={newB:new Ext.Button({style:"margin:2px;",iconCls:"palo_icon_cl_create",handler:addConst}),editB:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_cl_edit",handler:function(){var sIndexes=viewConsts.getSelectedIndexes();if(sIndexes.length>0){var firstNode=viewConsts.getNode(sIndexes[0]);var scrollToElem=Ext.get(firstNode);firstNode.scrollIntoView(viewConsts.body,false);var firstRec=viewConsts.getRecord(firstNode);ciePlugin.activeRecord=firstRec;ciePlugin.startEdit(firstNode,firstRec.data[ciePlugin.dataIndex])}}}),deleteB:new Ext.Button({disabled:true,style:"margin:2px;",iconCls:"palo_icon_cl_delete",handler:function(){if(viewConsts.getSelectedIndexes().length>0){Ext.MessageBox.show({title:"Delete Constants".localize(),msg:"_msg: Delete Constants".localize(),buttons:Ext.MessageBox.OKCANCEL,fn:deleteConsts,icon:Ext.MessageBox.QUESTION})}}})};var panel_btnOps=new Ext.Panel({border:false,bodyStyle:"background-color:transparent;vertical-align:middle;",layout:"form",width:31,autoHeight:true,items:[btnOps.newB,btnOps.editB,btnOps.deleteB]});this.add(panel_viewConsts);this.add(panel_btnOps);this.add(panel_btnAcctions);panel_viewConsts.setSize(that.width-50,that.height-5);panel_viewConsts.setPosition(0,5);panel_btnOps.setPosition(that.width-40,5);panel_btnAcctions.setPosition(that.width-40,that.height-105);viewConsts.on("onkeyenter",function(){var timer=setTimeout(function(){addConst()},0)});viewConsts.on("selectionchange",function(thisDv,selections){var selSize=selections.length;if(selSize>0){if(selSize==1){btnOps.editB.enable()}else{btnOps.editB.disable()}btnOps.deleteB.enable();btnAcctions.top.enable();btnAcctions.up.enable();btnAcctions.down.enable();btnAcctions.bottom.enable()}else{btnOps.editB.disable();btnOps.deleteB.disable();btnAcctions.top.disable();btnAcctions.up.disable();btnAcctions.down.disable();btnAcctions.bottom.disable()}})}});Jedox.wss.wsel.img={};Jedox.wss.wsel.img.moveTo=function(imgId,pos,offsets){Jedox.wss.wsel.moveTo("".concat(Jedox.wss.app.activeBook.getDomId(),"_ws_element_",imgId,Jedox.wss.app.appMode==Jedox.wss.grid.viewMode.USER?"":"-rzwrap"),pos,offsets)};Jedox.wss.wsel.img.showAlert=function(title,msg){Ext.Msg.alert(title.localize(),msg.localize())};Jedox.wss.wsel.img.loadAll=function(){function _load(res){if(!(res instanceof Array)||res[0]!==true){return}res=res[1];var jwwsel=Jedox.wss.wsel,activeBook=Jedox.wss.app.activeBook,winId=activeBook.getDomId();for(var imgData,i=res.length-1;i>=0;--i){imgData=res[i];var rng=jwwsel.getRngFromNLoc(imgData.n_location),tlXY=activeBook.getPixelsByCoords(rng[0],rng[1]);this.createImg(false,winId,imgData.e_id,tlXY[1]+imgData.pos_offsets[1],tlXY[0]+imgData.pos_offsets[0],imgData.size[0],imgData.size[1])}}Jedox.wss.backend.conn.cmd([this,_load],["wget"],["",[],["e_id","n_location","pos_offsets","size"],{e_type:"img"}])};Jedox.wss.wsel.img.createImg=function(setWbWsID,winID,imgID,elTop,elLeft,elWidth,elHeight,setLoc){if(imgID==null){Ext.MessageBox.show({title:"Operation Error".localize(),msg:"imgDlg_genError".localize(),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var activeBook=Jedox.wss.app.activeBook;var env=Jedox.wss.app.environment;var handleElementMove=false;var isUserMode=(env.viewMode==Jedox.wss.grid.viewMode.USER);var defMaxCoords=Jedox.wss.grid.defMaxCoords;var elConstr={up:0,down:0,left:0,right:0,vportPos:[],lrCornerPx:[]};var imgWrapperEl=null;var calcConstraints=function(){elConstr.vportPos=activeBook.getViewportPos();if(elLeft<0||elTop<0){elConstr.left=parseInt(elConstr.vportPos[0][0]+(elConstr.vportPos[1][0]-elConstr.vportPos[0][0]-elWidth)/2);elConstr.up=parseInt(elConstr.vportPos[0][1]+(elConstr.vportPos[1][1]-elConstr.vportPos[0][1]-elHeight)/2);elLeft=elConstr.left;elTop=elConstr.up}else{elConstr.left=elLeft;elConstr.up=elTop}elConstr.lrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);elConstr.right=elConstr.lrCornerPx[0]-elConstr.left-elWidth;elConstr.down=elConstr.lrCornerPx[1]-elConstr.up-elHeight};var onImgMouseDown=function(e){if(e.button==2||(Ext.isMac&&e.button==0&&Jedox.wss.app.ctrlKeyPressed)||(Ext.isWebKit&&e.button==1)){handleElementMove=false;showContextMenu(e);e.stopEvent()}else{var bEv=e.browserEvent;var el=(document.all)?bEv.srcElement:bEv.target;el.className="ws_element_move";var newVportPos=Jedox.wss.app.activeBook.getViewportPos();var newLrCornerPx=activeBook.getPixelsByCoords(defMaxCoords[0]+1,defMaxCoords[1]+1);if(env.winStateMax){var vportDiff={h:newVportPos[0][0]-elConstr.vportPos[0][0],v:newVportPos[0][1]-elConstr.vportPos[0][1]};var lrCornerPxDiff={h:newLrCornerPx[0]-elConstr.lrCornerPx[0],v:newLrCornerPx[1]-elConstr.lrCornerPx[1]};imgWrapper.setXConstraint(elConstr.left+vportDiff.h,(elConstr.right-vportDiff.h)+lrCornerPxDiff.h);imgWrapper.setYConstraint(elConstr.up+vportDiff.v,(elConstr.down-vportDiff.v)+lrCornerPxDiff.v)}else{var leftConstr=elConstr.left-((bEv.clientX-(el.parentNode.offsetLeft+((document.all)?bEv.offsetX:bEv.layerX)-newVportPos[0][0]))-env.gridScreenCoordsMax[0])+newVportPos[0][0];imgWrapper.setXConstraint(leftConstr,newLrCornerPx[0]-leftConstr-elWidth);var topConstr=elConstr.up-((bEv.clientY-(el.parentNode.offsetTop+((document.all)?bEv.offsetY:bEv.layerY)-newVportPos[0][1]))-env.gridScreenCoordsMax[1])+newVportPos[0][1];imgWrapper.setYConstraint(topConstr,newLrCornerPx[1]-topConstr-elHeight)}Jedox.wss.wsel.moveRegistry.push([this,onImgMouseUp,el]);handleElementMove=true}};var onImgMouseUp=function(el){if(!handleElementMove){return}el.className="ws_element";var newLeft=el.parentNode.offsetLeft,newTop=el.parentNode.offsetTop,elWidth=el.parentNode.offsetWidth,elHeight=el.parentNode.offsetHeight;if(newLeft!=elLeft||newTop!=elTop){elLeft=newLeft;elTop=newTop;var conn=Jedox.wss.backend.conn,imgData={};imgData[imgID]=Jedox.wss.wsel.getNLoc(newLeft,newTop,elWidth,elHeight);conn.cmd(conn.dummy_cb,["wupd"],["",imgData])}handleElementMove=false};var afterResizeImg=function(wrapper,newWidth,newHeight,e){var wrapperEl=wrapper.getEl(),elLeft=wrapperEl.getLeft(true),elTop=wrapperEl.getTop(true);if(elWidth!=newWidth){elConstr.right+=elWidth-newWidth}if(elHeight!=newHeight){elConstr.down+=elHeight-newHeight}var conn=Jedox.wss.backend.conn,imgData={};imgData[imgID]=Jedox.wss.wsel.getNLoc(elLeft,elTop,newWidth,newHeight);imgData[imgID].size=[newWidth,newHeight];conn.cmd(conn.dummy_cb,["wupd"],["",imgData])};var showContextMenu=function(e){var contextMenu=new Ext.menu.Menu({items:[{text:"Edit Picture".localize().concat("..."),iconCls:"icon_edit",handler:editImg},{text:"Delete Picture".localize(),iconCls:"icon_delete",handler:deleteImg}],enableScrolling:false,listeners:{hide:function(menu){menu.destroy()}}});var coords=e.getXY();contextMenu.showAt([coords[0],coords[1]])};function editImg(){Jedox.wss.dialog.openInsertPicture({id:imgID})}function deleteImg_cb(res){if(res instanceof Array&&(res=res[0]) instanceof Array&&res[0]===true){imgWrapperEl.remove()}else{Ext.MessageBox.show({title:"Operation Error".localize(),msg:"imgDlg_deleteError".localize(),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function deleteImg(){Jedox.wss.backend.conn.cmd([this,deleteImg_cb],["wdel"],["",[imgID]])}var currDate=new Date();var gridDivId=activeBook.getDomId()+"_IC";calcConstraints();Ext.DomHelper.insertFirst(Ext.DomQuery.selectNode("div[id="+gridDivId+"]"),{tag:"img",id:"".concat(winID,"_ws_element_",imgID),src:"/spreadsheet/root/cc/gen_element.php?wam=".concat(Jedox.wss.app.appModeS,"&t=img","&id=",imgID,"&ts=",currDate.getTime(),((setWbWsID)?"".concat("&wbid=",activeBook.getWbId(),"&wsid=",activeBook.getWsId()):"")),width:elWidth,height:elHeight,cls:"ws_element",style:"".concat("z-index: 50; position: absolute; left:",elLeft,"px; top:",elTop,"px;")},false);Ext.ResizableConstrained=function(el,config){Ext.ResizableConstrained.superclass.constructor.call(this,el,config)};Ext.extend(Ext.ResizableConstrained,Ext.Resizable,{setXConstraint:function(left,right){this.dd.setXConstraint(left,right)},setYConstraint:function(up,down){this.dd.setYConstraint(up,down)}});var imgWrapper=new Ext.ResizableConstrained("".concat(winID,"_ws_element_",imgID),{wrap:!isUserMode,dynamic:!isUserMode,pinned:false,width:elWidth,height:elHeight,minWidth:10,maxWidth:1600,minHeight:10,maxHeight:1050,preserveRatio:false,transparent:false,handles:"all",draggable:!isUserMode,enabled:!isUserMode,style:"background-color: white;",resizeRegion:Ext.get(gridDivId).getRegion()});if(!isUserMode){imgWrapper.on({resize:{fn:afterResizeImg,scope:this}});imgWrapper.dd.maintainOffset=true;imgWrapper.setXConstraint(elConstr.left,elConstr.right);imgWrapper.setYConstraint(elConstr.up,elConstr.down);imgWrapperEl=imgWrapper.getEl();imgWrapperEl.dom.style.backgroundColor="#FFFFFF";imgWrapperEl.on({mousedown:{fn:onImgMouseDown,scope:this},dblclick:{fn:editImg,scope:this}})}if(!setLoc){return}var conn=Jedox.wss.backend.conn,imgData={};imgData[imgID]=Jedox.wss.wsel.getNLoc(elLeft,elTop,elWidth,elHeight);conn.cmd(conn.dummy_cb,["wupd"],["",imgData])};Jedox.wss.wsel.img.removeImg=function(imgId){if(imgId){try{var activeBook=Jedox.wss.app.activeBook;var winId=activeBook.getDomId(),gridIC=activeBook.getBookIC();if(Jedox.wss.app.environment.viewMode==Jedox.wss.grid.viewMode.DESIGNER){gridIC.removeChild(document.getElementById("".concat(winId,"_ws_element_",imgId,"-rzwrap")));gridIC.removeChild(document.getElementById("".concat(winId,"_ws_element_",imgId,"-rzwrap-rzproxy")))}else{gridIC.removeChild(document.getElementById("".concat(winId,"_ws_element_",imgId)))}}catch(e){console.log("Unable to remove Worksheet Element (picture).")}}};Jedox.wss.dialog.openInsertPicture=function(editObj){Jedox.wss.app.lastInputModeDlg=Jedox.wss.app.environment.inputMode;Jedox.wss.general.setInputMode(Jedox.wss.grid.GridMode.DIALOG);var validateFile=function(fieldValue){var nameSize=fieldValue.length-4;fieldValue=fieldValue.toUpperCase();if((nameSize>0)&&((fieldValue.lastIndexOf(".PNG")==nameSize)||(fieldValue.lastIndexOf(".GIF")==nameSize)||(fieldValue.lastIndexOf(".JPG")==nameSize)||(fieldValue.lastIndexOf(".JPEG")==(nameSize-1)))){return true}else{return"impImg_msgWrongType".localize()}};var fileUpload=new Ext.ux.FileUploadField({emptyText:"Select a picture".localize(),fieldLabel:"_lbl: picToImport".localize(),defaultAutoCreate:{tag:"input",type:"text",size:"65",autocomplete:"off"},width:420,name:"img_filename",validator:validateFile});var formPanel=new Ext.form.FormPanel({layout:"form",border:false,baseCls:"x-plain",labelWidth:50,labelAlign:"top",width:450,defaults:{width:410},defaultType:"textfield",buttonAlign:"right",items:[fileUpload]});var mainPanel=new Ext.Panel({baseCls:"main-panel",border:false,items:formPanel});var win=new Ext.Window({defaults:{bodyStyle:"padding:10px 5px 5px 15px"},title:"Insert Picture".localize(),closable:true,closeAction:"close",cls:"default-format-window",autoDestroy:true,plain:true,constrain:true,modal:true,resizable:false,animCollapse:false,layout:"fit",width:450,height:140,items:mainPanel,listeners:{close:function(){Jedox.wss.general.setInputMode(Jedox.wss.app.lastInputModeDlg);Jedox.wss.app.lastInputMode=Jedox.wss.grid.GridMode.READY}},buttons:[{text:"Insert".localize(),handler:function(){if(formPanel.getForm().isValid()){var frameID="tmpImportIFrame";var frame=Ext.get(frameID);if(!frame){frame=document.createElement("iframe");frame.id=frameID;frame.name=frameID;frame.className="x-hidden";if(Ext.isIE){frame.src=Ext.SSL_SECURE_URL}document.body.appendChild(frame);if(Ext.isIE){document.frames[frameID].name=frameID}}if(editObj&&editObj.id){var imgWrapper=Ext.get("".concat(Jedox.wss.app.activeBook.getDomId(),"_ws_element_",editObj.id,"-rzwrap"));var elX=imgWrapper.dom.offsetLeft;var elY=imgWrapper.dom.offsetTop}else{var vportPos=Jedox.wss.app.activeBook.getViewportPos();var elX=parseInt((vportPos[1][0]-vportPos[0][0])/2);var elY=parseInt((vportPos[1][1]-vportPos[0][1])/2)}var form=Ext.getDom(formPanel.getForm().getEl());form.target=frameID;form.method="POST";form.action="/spreadsheet/root/cc/import.php?wam=designer&t=img&x_pos="+elX+"&y_pos="+elY+((editObj&&editObj.id)?"&img_id=".concat(editObj.id):"");form.enctype=form.encoding="multipart/form-data";try{form.submit();Ext.MessageBox.show({msg:"_msg: PaloImport Wait".localize(),progressText:"Importing".localize().concat("..."),width:300,wait:true,waitConfig:{interval:200}});win.close()}catch(e){Jedox.wss.general.showMsg("Application Error".localize(),e.message.localize(),Ext.MessageBox.ERROR)}}}},{text:"Close".localize(),handler:function(){win.close()}}]});win.show()};Jedox.wss.app.environment=null;Jedox.wss.app.numberToLetter=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR","BS","BT","BU","BV","BW","BX","BY","BZ","CA","CB","CC","CD","CE","CF","CG","CH","CI","CJ","CK","CL","CM","CN","CO","CP","CQ","CR","CS","CT","CU","CV","CW","CX","CY","CZ","DA","DB","DC","DD","DE","DF","DG","DH","DI","DJ","DK","DL","DM","DN","DO","DP","DQ","DR","DS","DT","DU","DV","DW","DX","DY","DZ","EA","EB","EC","ED","EE","EF","EG","EH","EI","EJ","EK","EL","EM","EN","EO","EP","EQ","ER","ES","ET","EU","EV","EW","EX","EY","EZ","FA","FB","FC","FD","FE","FF","FG","FH","FI","FJ","FK","FL","FM","FN","FO","FP","FQ","FR","FS","FT","FU","FV","FW","FX","FY","FZ","GA","GB","GC","GD","GE","GF","GG","GH","GI","GJ","GK","GL","GM","GN","GO","GP","GQ","GR","GS","GT","GU","GV","GW","GX","GY","GZ","HA","HB","HC","HD","HE","HF","HG","HH","HI","HJ","HK","HL","HM","HN","HO","HP","HQ","HR","HS","HT","HU","HV","HW","HX","HY","HZ","IA","IB","IC","ID","IE","IF","IG","IH","II","IJ","IK","IL","IM","IN","IO","IP","IQ","IR","IS","IT","IU","IV"];Jedox.wss.app.letterToNumber={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"10",K:"11",L:"12",M:"13",N:"14",O:"15",P:"16",Q:"17",R:"18",S:"19",T:"20",U:"21",V:"22",W:"23",X:"24",Y:"25",Z:"26",AA:"27",AB:"28",AC:"29",AD:"30",AE:"31",AF:"32",AG:"33",AH:"34",AI:"35",AJ:"36",AK:"37",AL:"38",AM:"39",AN:"40",AO:"41",AP:"42",AQ:"43",AR:"44",AS:"45",AT:"46",AU:"47",AV:"48",AW:"49",AX:"50",AY:"51",AZ:"52",BA:"53",BB:"54",BC:"55",BD:"56",BE:"57",BF:"58",BG:"59",BH:"60",BI:"61",BJ:"62",BK:"63",BL:"64",BM:"65",BN:"66",BO:"67",BP:"68",BQ:"69",BR:"70",BS:"71",BT:"72",BU:"73",BV:"74",BW:"75",BX:"76",BY:"77",BZ:"78",CA:"79",CB:"80",CC:"81",CD:"82",CE:"83",CF:"84",CG:"85",CH:"86",CI:"87",CJ:"88",CK:"89",CL:"90",CM:"91",CN:"92",CO:"93",CP:"94",CQ:"95",CR:"96",CS:"97",CT:"98",CU:"99",CV:"100",CW:"101",CX:"102",CY:"103",CZ:"104",DA:"105",DB:"106",DC:"107",DD:"108",DE:"109",DF:"110",DG:"111",DH:"112",DI:"113",DJ:"114",DK:"115",DL:"116",DM:"117",DN:"118",DO:"119",DP:"120",DQ:"121",DR:"122",DS:"123",DT:"124",DU:"125",DV:"126",DW:"127",DX:"128",DY:"129",DZ:"130",EA:"131",EB:"132",EC:"133",ED:"134",EE:"135",EF:"136",EG:"137",EH:"138",EI:"139",EJ:"140",EK:"141",EL:"142",EM:"143",EN:"144",EO:"145",EP:"146",EQ:"147",ER:"148",ES:"149",ET:"150",EU:"151",EV:"152",EW:"153",EX:"154",EY:"155",EZ:"156",FA:"157",FB:"158",FC:"159",FD:"160",FE:"161",FF:"162",FG:"163",FH:"164",FI:"165",FJ:"166",FK:"167",FL:"168",FM:"169",FN:"170",FO:"171",FP:"172",FQ:"173",FR:"174",FS:"175",FT:"176",FU:"177",FV:"178",FW:"179",FX:"180",FY:"181",FZ:"182",GA:"183",GB:"184",GC:"185",GD:"186",GE:"187",GF:"188",GG:"189",GH:"190",GI:"191",GJ:"192",GK:"193",GL:"194",GM:"195",GN:"196",GO:"197",GP:"198",GQ:"199",GR:"200",GS:"201",GT:"202",GU:"203",GV:"204",GW:"205",GX:"206",GY:"207",GZ:"208",HA:"209",HB:"210",HC:"211",HD:"212",HE:"213",HF:"214",HG:"215",HH:"216",HI:"217",HJ:"218",HK:"219",HL:"220",HM:"221",HN:"222",HO:"223",HP:"224",HQ:"225",HR:"226",HS:"227",HT:"228",HU:"229",HV:"230",HW:"231",HX:"232",HY:"233",HZ:"234",IA:"235",IB:"236",IC:"237",ID:"238",IE:"239",IF:"240",IG:"241",IH:"242",II:"243",IJ:"244",IK:"245",IL:"246",IM:"247",IN:"248",IO:"249",IP:"250",IQ:"251",IR:"252",IS:"253",IT:"254",IU:"255",IV:"256"};Jedox.wss.app.activeSheetName=1;Jedox.wss.app.lastInputMode=0;Jedox.wss.app.lastInputModeDlg=0;Jedox.wss.app.firstRow="A";Jedox.wss.app.firstRowNumeric=1;Jedox.wss.app.firstColumn=1;Jedox.wss.app.xPos=0;Jedox.wss.app.yPos=0;Jedox.wss.app.mouseButton1Down=false;Jedox.wss.app.mouseButton2Down=false;Jedox.wss.app.isIE=document.all?true:false;Jedox.wss.app.maybeDragging=false;Jedox.wss.app.cellAmount=[256,1024];Jedox.wss.app.defCellHeight=16;Jedox.wss.app.defCellWidth=80;Jedox.wss.app.workbookList=[];Jedox.wss.app.loaded=false;Jedox.wss.app.serverAvailable=true;Jedox.wss.app.autoCalc=true;Jedox.wss.app.xCellOffset=17;Jedox.wss.app.yCellOffset=108;Jedox.wss.app.selectedFormula="";Jedox.wss.app.currFormula=null;Jedox.wss.app.currCoord=null;Jedox.wss.app.statusBar=null;Jedox.wss.app.fromFormulaField=false;Jedox.wss.app.mouseMovementObserver=null;Jedox.wss.app.mouseUpObserver=null;Jedox.wss.app.mouseDownObserver=null;Jedox.wss.app.performItemToggle=true;Jedox.wss.app.cnfDefaultFont="Arial";Jedox.wss.app.cnfDefaultFontSize="10";Jedox.wss.app.activeColorPalette="main";Jedox.wss.app.cnfDefaultBgColor="FF0000";Jedox.wss.app.cnfDefaultTextColor="FFFF00";Jedox.wss.app.cnfDefaultBorder="brd-bottom-norm";Jedox.wss.app.lastKeyPressed=null;Jedox.wss.app.currentDialogControl=null;Jedox.wss.app.currentDialogControlItemsCnt=0;Jedox.wss.app.lastInputField=null;Jedox.wss.app.appMode=Jedox.wss.grid.viewMode.USER;Jedox.wss.app.copySelection=null;Jedox.wss.app.clipboard=null;Jedox.wss.app.ctrlKeyPressed=false;Jedox.wss.app.showBrowserCtx=false;Jedox.wss.general.switchSuspendModeAlert=null;Jedox.wss.app.browser="ff";Jedox.wss.app.mimicOvertracking=false;Jedox.wss.app.books=[];Jedox.wss.app.activeBook=undefined;Jedox.wss.app.activeSheet=undefined;Jedox.wss.app.activePane=undefined;Jedox.wss.app.standalone=window==parent;Jedox.wss.app.userPreview=false;Jedox.wss.app.UPRestrictMode=false;Jedox.wss.app.UPRestrictModeEnabled=true;Jedox.wss.app.toolbarLayouts={TOOLBAR:"toolbar",RIBBON:"ribbon"};Jedox.wss.app.toolbarLayout=Jedox.wss.app.toolbarLayouts.TOOLBAR;Jedox.wss.app.fopper=false;Jedox.wss.app.dynJSRegistry={formatCells:["Format.js",["dialog"],"formatCells",false,false,"base"],chart:["insertChart.js",["dialog","chart"],"openChartDialog",false,false,"base"],editChart:["editChart.js",["dialog","chart"],"editChartDialog",false,false,"base"],editChartType:["editChartType.js",["dialog","chart"],"editChartTypeDialog",false,false,"base"],editSourceData:["editSourceData.js",["dialog","chart"],"editSourceDataDialog",false,false,"base"],editMacro:["editMacro.js",["dialog"],"openEditMacro",false,false,"base"],insertMacro:["insertMacro.js",["dialog"],"openInsertMacro",false,false,"base"],find:["find.js",["dialog"],"openFindDialog",false,false,"base"],open:["open.js",["dialog"],"openOpenDialog",false,false,"base"],insertFunction:["InsertFunction.js",["dialog"],"openInsertFunctionDialog",false,false,"base"],conditionalFormatting:["ConditionalFormatting.js",["dialog"],"openConditionalFormatting",false,false,"base"],manageConditionalFormatting:["manageConditionalFmt.js",["dialog"],"manageConditionalFormatting",false,false,"base"],formatColRow:["formatColRow.js",["dialog"],"openFormatColRow",false,false,"base"],importFile:["import.js",["dialog"],"openImportDialog",false,false,"base"],microChart:["microchart.js",["dialog","chart"],"MicroChart",false,false,"base"],insertDynarange:["insertDynarange.js",["dialog"],"openDynarangeEditor",false,false,"base"],sheetMoveCopy:["sheetMoveCopy.js",["dialog"],"openSheetMoveCopy",false,false,"base"],nameManager:["nameManager.js",["dialog"],"openNameManager",false,false,"base"],newName:["newName.js",["dialog"],"openNewName",false,false,"base"],selectRange:["selectRange.js",["dialog"],"openSelectRangeDialog",false,false,"base"],renameSheet:["renameSheet.js",["dialog"],"openRenameSheet",false,false,"base"],pageSetup:["pageSetup.js",["dialog"],"openPageSetup",false,false,"base"],customHeaderFooter:["customHeaderFooter.js",["dialog"],"openCustomHeaderFooter",false,false,"base"],arrangeWindows:["arrangeWindows.js",["dialog"],"openArrangeWindows",false,false,"base"],unhideWindow:["unhideWindow.js",["dialog"],"openUnhideDialog",false,false,"base"],modeller:["modeller.js",["palo"],"openModellerDialog",false,false,"../common/base"],cubeWizard:["cubewizard.js",["palo"],"CubeWizard",false,false,"../common/base"],paloWizard:["palowizard.js",["palo"],"openPaloWizard",false,false,"../common/base"],subsetEditor:["subseteditor.js",["palo"],"openSubsetEditor",false,false,"../common/base"],ruleEditor:["ruleeditor.js",["palo"],"ruleEditor",false,false,"../common/base"],chooseElement:["chooseelement.js",["palo"],"ChooseElement",false,false,"../common/base"],pasteView:["pasteview.js",["palo"],"PasteView",false,false,"base"],selectElements:["selectelements.js",["palo"],"SelectElements",false,false,"base"],pasteDataFunctions:["pastefuncs.js",["palo"],"PasteDataFunctions",false,false,"base"],paloImport:["paloimport.js",["palo"],"openPaloImport",false,false,"base"],openHL:["insertHyperlink.js",["dialog"],"openHL",false,false,"base"],hlVarList:["hl_varList.js",["dialog"],"hlVarList",false,false,"base"],funcArgs:["funcArgs.js",["dialog"],"funcArgs",false,false,"base"],formatControl:["formatControl.js",["dialog"],"formatControl",false,false,"base"],pasteSpecial:["pasteSpecial.js",["dialog"],"openPasteSpecial",false,false,"base"],autoRefreshStart:["autoRefresh.js",["dialog"],"autoRefreshStart",false,false,"base"],quickPublish:["quickPublish.js",["dialog"],"quickPublish",false,false,"base"],recover:["recover.js",["dialog"],"openRecoverDialog",false,false,"base"],goTo:["goTo.js",["dialog"],"openGoTo",false,false,"base"],formatFont:["font.js",["dialog","format"],"font",false,false,"base"],formatNumber:["number.js",["dialog","format"],"number",false,false,"base"],formatAlignment:["alignment.js",["dialog","format"],"alignment",false,false,"base"],formatBorder:["border.js",["dialog","format"],"border",false,false,"base"],formatFill:["fill.js",["dialog","format"],"fill",false,false,"base"],formatProtection:["protection.js",["dialog","format"],"protection",false,false,"base"]};Jedox.wss.app.load=function(cmd,args){args=args||[0];function execFunc(){var func=Jedox.wss;for(path=cmd[1],i=0;i<path.length;i++){func=func[path[i]]}if(Jedox.wss.app.browser==="ie"){func[cmd[2]].apply(new Object(),args)}else{func[cmd[2]].apply(this,args)}}if(cmd[3]&&cmd[4]&&cmd[2].length>0){execFunc();return}var that=this,url=cmd[5];allScripts=document.getElementsByTagName("script");for(var path=cmd[1],i=0;i<path.length;i++){url=url.concat("/",path[i])}url=url.concat("/",cmd[0]);for(i=0;i<allScripts.length;i++){if(allScripts[i].src&&allScripts[i].src.indexOf(url)!=-1){cmd[4]=true;if(cmd[2].length>0){execFunc()}return}}var newJS=document.createElement("script");newJS.type="text/javascript";newJS.src=url;newJS.id=url;newJS.onload=newJS.onreadystatechange=function(){if(this.readyState&&this.readyState=="loading"){return}else{cmd[4]=true;if(cmd[2].length>0){execFunc()}}};newJS.onerror=function(){docBody.removeChild(newJS);cmd[4]=false;console.log("Loading error: ".concat(url))};var docBody=document.getElementsByTagName("body")[0];docBody.appendChild(newJS)};Jedox.wss.app.dynJSAutoload=function(){var dynJSReg=Jedox.wss.app.dynJSRegistry,docBody=document.getElementsByTagName("body")[0];for(var dynjs in dynJSReg){if(dynJSReg[dynjs][3]){for(var url=dynJSReg[dynjs][5],path=dynJSReg[dynjs][1],i=0;i<path.length;i++){url=url.concat("/",path[i])}url=url.concat("/",dynJSReg[dynjs][0]);var newJS=document.createElement("script");newJS.type="text/javascript";newJS.src=url;newJS.id=url;docBody.appendChild(newJS);dynJSReg[dynjs][4]=true}}};Jedox.wss.app.unload=function(cmd){if(cmd[3]||!cmd[4]){return}var url=cmd[5],allScripts=document.getElementsByTagName("script");for(var path=cmd[1],i=0;i<path.length;i++){url=url.concat("/",path[i])}url=url.concat("/",cmd[0]);for(var i=0;i<allScripts.length;i++){if(allScripts[i].id==url){document.getElementsByTagName("body")[0].removeChild(allScripts[i]);cmd[4]=false;return}}};Jedox.wss.app.initStatusBar=function(){var modes={designer:"Designer".localize(),user:"User".localize()};var itemInputMode=new Ext.Toolbar.TextItem({text:"Ready".localize(),cls:"statusBarStyle",style:"width:60px; padding:0px 8px 0px 5px;"});var itemWorkingMode=new Ext.Toolbar.TextItem({text:modes[Jedox.wss.app.appMode],cls:"statusBarStyle",style:"width:60px; padding:0px 8px 0px 5px;"});Jedox.wss.app.statusBar=new Ext.ux.StatusBar({renderTo:"statusBarContainer",items:[new Ext.Toolbar.TextItem({text:"Status".localize()+": ",cls:"wssStatusBar"}),itemInputMode," ",new Ext.Toolbar.TextItem({text:"Mode".localize()+": ",cls:"wssStatusBar"}),itemWorkingMode," "]});Ext.get("statusBarContainer").unselectable();Jedox.wss.app.statusBar.setInputMode=function(text){Ext.fly(itemInputMode.getEl()).update(text)};Jedox.wss.app.statusBar.setWorkingMode=function(text){Ext.fly(itemWorkingMode.getEl()).update(text)};Jedox.wss.app.statusBar.hideShow=function(state){if(state){Jedox.wss.app.showBar("statusBarContainer")}else{Jedox.wss.app.hideBar("statusBarContainer")}};Jedox.wss.app.statusBar.doLayout()};Jedox.wss.app.fileTypesReg={pdf:true,html:true,htm:true,jpg:true,jpeg:true,gif:true,png:true,txt:true,rtf:false,doc:false,docx:false,ppt:false,pps:false,csv:false,xls:false,xlsx:false,zip:false,rar:false,unknown:false};var CodeMirrorConfig=window.CodeMirrorConfig||{};var CodeMirror=(function(){function setDefaults(object,defaults){for(var option in defaults){if(!object.hasOwnProperty(option)){object[option]=defaults[option]}}}function forEach(array,action){for(var i=0;i<array.length;i++){action(array[i])}}setDefaults(CodeMirrorConfig,{stylesheet:"",path:"",parserfile:[],basefiles:["util.js","stringstream.js","select.js","undo.js","editor.js","tokenize.js"],iframeClass:null,passDelay:200,passTime:50,continuousScanning:false,saveFunction:null,onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:true,textWrapping:true,readOnly:false,width:"100%",height:"300px",autoMatchParens:false,parserConfig:null,tabMode:"indent",reindentOnLoad:false,activeTokens:null,cursorActivity:null,lineNumbers:false,indentUnit:2});function wrapLineNumberDiv(place){return function(node){var container=document.createElement("DIV"),nums=document.createElement("DIV"),scroller=document.createElement("DIV");container.style.position="relative";nums.style.position="absolute";nums.style.height="100%";if(nums.style.setExpression){try{nums.style.setExpression("height","this.previousSibling.offsetHeight + 'px'")}catch(e){}}nums.style.top="0px";nums.style.overflow="hidden";place(container);container.appendChild(node);container.appendChild(nums);scroller.className="CodeMirror-line-numbers";nums.appendChild(scroller)}}function applyLineNumbers(frame){var win=frame.contentWindow,doc=win.document,nums=frame.nextSibling,scroller=nums.firstChild;var nextNum=1,barWidth=null;function sizeBar(){if(nums.offsetWidth!=barWidth){barWidth=nums.offsetWidth;nums.style.left="-"+(frame.parentNode.style.marginLeft=barWidth+"px")}}function update(){var diff=20+Math.max(doc.body.offsetHeight,frame.offsetHeight)-scroller.offsetHeight;for(var n=Math.ceil(diff/10);n>0;n--){var div=document.createElement("DIV");div.appendChild(document.createTextNode(nextNum++));scroller.appendChild(div)}nums.scrollTop=doc.body.scrollTop||doc.documentElement.scrollTop||0}sizeBar();update();win.addEventHandler(win,"scroll",update);setInterval(sizeBar,500)}function CodeMirror(place,options){if(options.dumbTabs){options.tabMode="spaces"}else{if(options.normalTab){options.tabMode="default"}}this.options=options=options||{};setDefaults(options,CodeMirrorConfig);var frame=this.frame=document.createElement("IFRAME");if(options.iframeClass){frame.className=options.iframeClass}frame.frameBorder=0;frame.src="javascript:false;";frame.style.border="0";frame.style.width=options.width;frame.style.height=options.height;frame.style.display="block";if(place.appendChild){var node=place;place=function(n){node.appendChild(n)}}if(options.lineNumbers){place=wrapLineNumberDiv(place)}place(frame);frame.CodeMirror=this;this.win=frame.contentWindow;if(typeof options.parserfile=="string"){options.parserfile=[options.parserfile]}if(typeof options.stylesheet=="string"){options.stylesheet=[options.stylesheet]}var html=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>'];forEach(options.stylesheet,function(file){html.push('<link rel="stylesheet" type="text/css" href="'+file+'"/>')});forEach(options.basefiles.concat(options.parserfile),function(file){html.push('<script type="text/javascript" src="'+options.path+file+'"><\/script>')});html.push('</head><body style="border-width: 0;" class="editbox" spellcheck="'+(options.disableSpellcheck?"false":"true")+'"></body></html>');var doc=this.win.document;doc.open();doc.write(html.join(""));doc.close()}CodeMirror.prototype={init:function(){if(this.options.initCallback){this.options.initCallback(this)}if(this.options.lineNumbers){applyLineNumbers(this.frame)}if(this.options.reindentOnLoad){this.reindent()}},getCode:function(){return this.editor.getCode()},setCode:function(code){this.editor.importCode(code)},selection:function(){return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.editor.reindentSelection(null)},focus:function(){this.win.focus();if(this.editor.selectionSnapshot){this.win.select.selectCoords(this.win,this.editor.selectionSnapshot)}},replaceSelection:function(text){this.focus();this.editor.replaceSelection(text);return true},replaceChars:function(text,start,end){this.editor.replaceChars(text,start,end)},getSearchCursor:function(string,fromCursor){return this.editor.getSearchCursor(string,fromCursor)},undo:function(){this.editor.history.undo()},redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(callback,filter){this.editor.grabKeys(callback,filter)},ungrabKeys:function(){this.editor.ungrabKeys()},setParser:function(name){this.editor.setParser(name)},cursorPosition:function(start){if(this.win.select.ie_selection){this.focus()}return this.editor.cursorPosition(start)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(line){return this.editor.nextLine(line)},prevLine:function(line){return this.editor.prevLine(line)},lineContent:function(line){return this.editor.lineContent(line)},setLineContent:function(line,content){this.editor.setLineContent(line,content)},insertIntoLine:function(line,position,content){this.editor.insertIntoLine(line,position,content)},selectLines:function(startLine,startOffset,endLine,endOffset){this.win.focus();this.editor.selectLines(startLine,startOffset,endLine,endOffset)},nthLine:function(n){var line=this.firstLine();for(;n>1&&line!==false;n--){line=this.nextLine(line)}return line},lineNumber:function(line){var num=0;while(line!==false){num++;line=this.prevLine(line)}return num},jumpToLine:function(n){this.selectLines(this.nthLine(n),0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorPosition().line)}};CodeMirror.InvalidLineHandle={toString:function(){return"CodeMirror.InvalidLineHandle"}};CodeMirror.replace=function(element){if(typeof element=="string"){element=document.getElementById(element)}return function(newElement){element.parentNode.replaceChild(newElement,element)}};CodeMirror.fromTextArea=function(area,options){if(typeof area=="string"){area=document.getElementById(area)}options=options||{};if(area.style.width&&options.width==null){options.width=area.style.width}if(area.style.height&&options.height==null){options.height=area.style.height}if(options.content==null){options.content=area.value}if(area.form){function updateField(){area.value=mirror.getCode()}if(typeof area.form.addEventListener=="function"){area.form.addEventListener("submit",updateField,false)}else{area.form.attachEvent("onsubmit",updateField)}}function insert(frame){if(area.nextSibling){area.parentNode.insertBefore(frame,area.nextSibling)}else{area.parentNode.appendChild(frame)}}area.style.display="none";var mirror=new CodeMirror(insert,options);return mirror};CodeMirror.isProbablySupported=function(){var match;if(window.opera){return Number(window.opera.version())>=9.52}else{if(/Apple Computers, Inc/.test(navigator.vendor)&&(match=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./))){return Number(match[1])>=3}else{if(document.selection&&window.ActiveXObject&&(match=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/))){return Number(match[1])>=6}else{if(match=navigator.userAgent.match(/gecko\/(\d{8})/i)){return Number(match[1])>=20050901}else{if(match=navigator.userAgent.match(/AppleWebKit\/(\d+)/)){return Number(match[1])>=525}else{return null}}}}}};return CodeMirror})();Ext.ux.ImageButton=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.ux.ImageButton.superclass.initComponent.call(this)},render:function(container,position){Ext.ux.ImageButton.superclass.render.call(this,container,position);if(this.disabled==true){this.disable()}else{this.disabled=true;this.enable()}},disable:function(){Ext.ux.ImageButton.superclass.disable.call(this);this.getEl().dom.src=this.initialConfig.imgNormal;this.getEl().removeAllListeners()},enable:function(){if(this.disabled){Ext.ux.ImageButton.superclass.enable.call(this);var that=this;this.getEl().on("click",that.initialConfig.actionFn,this);this.getEl().on("mouseout",function(){that.getEl().dom.src=that.initialConfig.imgNormal});this.getEl().on("mouseover",function(){that.getEl().dom.src=that.initialConfig.imgOver});this.getEl().on("mousedown",function(){that.getEl().dom.src=that.initialConfig.imgClicked});this.getEl().on("mouseup",function(){that.getEl().dom.src=that.initialConfig.imgOver})}},setImages:function(imgNormalUrl,imgOverUrl,imgClickedUrl){var that=this;this.initialConfig.imgNormal=imgNormalUrl;this.initialConfig.imgOver=imgOverUrl;this.initialConfig.imgClicked=imgClickedUrl;if(this.disabled==true){this.getEl().dom.src=this.initialConfig.imgNormal}else{this.getEl().on("mouseout",function(){that.getEl().dom.src=that.initialConfig.imgNormal});this.getEl().on("mouseover",function(){that.getEl().dom.src=that.initialConfig.imgOver});this.getEl().on("mousedown",function(){that.getEl().dom.src=that.initialConfig.imgClicked});this.getEl().on("mouseup",function(){that.getEl().dom.src=that.initialConfig.imgOver})}},showImage:function(img){this.getEl().dom.src=img}});if(Jedox){if(Jedox.wss){if(Jedox.wss.palo){Jedox.wss.palo.NONE=0;Jedox.wss.palo.GRID=1;Jedox.wss.palo.STUDIO=2}else{Jedox.wss.palo={NONE:0,GRID:1,STUDIO:2}}if(Jedox.studio){Jedox.wss.palo.workIn=2}else{Jedox.wss.palo.workIn=1}}else{Jedox.wss={palo:{NONE:0,GRID:1,STUDIO:2,workIn:0}}}}else{Jedox={wss:{palo:{NONE:0,GRID:1,STUDIO:2,workIn:0}}}}Jedox.wss.palo.utils=new function(){if(Jedox.wss.palo.workIn==Jedox.wss.palo.GRID){var gridModes=Jedox.wss.grid.viewMode;this.registerHandlers=function(){switch(Jedox.wss.app.appMode){case gridModes.DESIGNER:Jedox.wss.grid.cbReg("hnd_dblCpvOpen",[this,Jedox.wss.palo.utils.handleOpenPasteViewDblclick]);case gridModes.USER:Jedox.wss.grid.cbReg("hnd_dblCpv",[this,Jedox.wss.palo.utils.handlePasteViewDblclick]);Jedox.wss.grid.cbReg("hnd_dblCceOpen",[this,Jedox.wss.palo.utils.handleOpenPasteViewChooseElement])}};this.handlePasteViewDblclick=function(inObj,relX,relY,pasteViewId,dimName,elemName){Jedox.wss.app.activeBook.cb("palo_handlerExpandCollapsePasteView",[[inObj,relX,relY,pasteViewId,dimName,elemName]]);return false};this.handleOpenPasteViewDblclick=function(inObj,pasteViewId,x,y){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.pasteView,[pasteViewId,x,y]);return false};this.handleOpenPasteViewChooseElement=function(inObj,confData){confData.dblclick_data=inObj;Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.chooseElement,[confData]);return false};this.openSubsetEditor=function(conf){Jedox.wss.app.load(Jedox.wss.app.dynJSRegistry.subsetEditor,[conf])}}this.OnEnterDataViewClass=Ext.extend(Ext.DataView,{focusedClass:"x-view-focused",focusEl:true,afterRender:function(){Jedox.wss.palo.utils.OnEnterDataViewClass.superclass.afterRender.call(this);var that=this;if(this.singleSelect||this.multiSelect){if(this.focusEl===true){this.focusEl=this.el.parent().parent().createChild({tag:"a",href:"#",cls:"x-view-focus",tabIndex:"-1"});this.focusEl.insertBefore(this.el.parent());this.focusEl.swallowEvent("click",true);this.renderedFocusEl=true}else{if(this.focusEl){this.focusEl=Ext.get(this.focusEl)}}if(this.focusEl){this.keyNav=new Ext.KeyNav(this.focusEl,{up:function(e){var selection=that.getSelectedIndexes();if(selection.length>0){var lastIndex=selection[selection.length-1];if(lastIndex<=selection[0]){if(lastIndex>0){if(that.multiSelect&&e.shiftKey){that.select(lastIndex-1,true,false)}else{that.select(lastIndex-1)}}}else{that.deselect(lastIndex)}}},down:function(e){var selection=that.getSelectedIndexes();if(selection.length>0){var lastIndex=selection[selection.length-1];if(lastIndex>=selection[0]){if(lastIndex<(that.getStore().getCount()-1)){if(that.multiSelect&&e.shiftKey){that.select(lastIndex+1,true,false)}else{that.select(lastIndex+1)}}}else{that.deselect(lastIndex)}}},enter:function(){if(that.events.onkeyenter){that.events.onkeyenter.fire()}},scope:this,forceKeyDown:true})}}},onClick:function(e){var item=e.getTarget(this.itemSelector,this.el);if(item){var index=this.indexOf(item);if(this.onItemClick(item,index,e)!==false){this.fireEvent("click",this,index,item,e);this.retainFocus()}}else{if(this.fireEvent("containerclick",this,e)!==false){this.clearSelections();this.retainFocus()}}},retainFocus:function(){var that=this;if(this.focusEl){setTimeout(function(){that.focusEl.focus()},0)}},doRetainFocus:function(){this.focusEl.focus()}});this.checkPaloName=function(name,type){switch(type){case"database":case"db":var res=name.match(/^[a-zA-Z0-9_-][a-zA-Z0-9\._-]*/);return((res!=null)&&(res==name));break;case"dimension":case"dim":case"cube":var res=name.match(/^[^\x00-\x1F\\*:|<>\/?\.\s][^\x00-\x1F\\*:|<>\/?]*/);if((res!=null)&&(res==name)){res=name.match(/[^\x00-\x1F\\*:|<>\/?]*[^\x00-\x1F\\*:|<>\/?\s]$/)}else{return false}return((res!=null)&&(res==name));break;case"element":case"elem":var res=name.match(/^[^\x00-\x1F\s][^\x00-\x1F]*/);if((res!=null)&&(res==name)){res=name.match(/[^\x00-\x1F]*[^\x00-\x1F\s]$/)}else{return false}return((res!=null)&&(res==name));break}return false}};Jedox.wss.palo.config={panelW:800,panelH:400,widthMidButtons:38,imgsPath:"/spreadsheet/root/ui/common/res/img/palo/",elementSize:18,numberOfElements:10000,cubeWizWinW:750,cubeWizWinH:432,pvWinW:750,pvWinH:500,fixWidth:12.57,ceWinW:350,ceWinH:450,seWinW:750,seWinH:500,pdfWinW:350,pdfWinH:450,paloWizWinW:750,paloWizWinH:432,sseWinW:900,sseWinH:550};
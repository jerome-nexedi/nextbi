Ext.namespace("Ext.ux");Ext.ux.ColorPicker=function(B,A){Ext.ux.ColorPicker.superclass.constructor.call(this,B,A);this.initialize(B,A)};Ext.extend(Ext.ux.ColorPicker,Ext.util.Observable,{HCHARS:"0123456789ABCDEF",initialize:function(B,A){this.events={};this.config=A;this.config.captions=this.config.captions?this.config.captions:{};this.config.pickerHotPoint=this.config.pickerHotPoint?this.config.pickerHotPoint:{x:3,y:3};this.dialog=null;this._HSV={h:0,s:100,v:100};this._RGB={r:255,g:255,b:255};this._HEX="000000";this.lastXYRgb={x:0,y:0};this.lastYHue=0;this.domElement=Ext.get(B);this.createDomObjects();if(this.config.hidePanel){this.formContainer.hide()}this.rgbPicker.on("mousedown",this.rgbPickerClick.createDelegate(this),this);this.huePicker.on("mousedown",this.huePickerClick.createDelegate(this),this);this.wsColorContainer.on("mousedown",this.setColorFromWebsafe.createDelegate(this),this);this.form.findField("redValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));this.form.findField("greenValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));this.form.findField("blueValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));this.form.findField("hueValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));this.form.findField("saturationValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));this.form.findField("brightnessValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));this.form.findField("colorValue"+this.domElement.id).on("change",this.changeHexaField.createDelegate(this));this.form.findField("redValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));this.form.findField("greenValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));this.form.findField("blueValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));this.form.findField("hueValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));this.form.findField("saturationValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));this.form.findField("brightnessValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));this.form.findField("colorValue"+this.domElement.id).on("specialkey",this.changeHexaField.createDelegate(this));this.checkConfig();this.addEvents({pickcolor:true,changergb:true,changehsv:true,changehexa:true})},createDomObjects:function(){this.rgbPicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-rgb-msk"},true);this.rgbPointer=Ext.DomHelper.append(this.rgbPicker,{tag:"div",cls:"x-cp-rgb-picker"},true);this.rgbPointer.setXY([this.rgbPicker.getLeft()-this.config.pickerHotPoint.x,this.rgbPicker.getTop()-this.config.pickerHotPoint.y]);this.huePicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-hue-msk"},true);this.huePointer=Ext.DomHelper.append(this.huePicker,{tag:"div",cls:"x-cp-hue-picker"},true);this.huePointer.setXY([this.huePicker.getLeft()+(this.huePointer.getWidth()/2)+1,this.huePicker.getTop()-this.config.pickerHotPoint.y]);this.container=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-control-container"},true);this.formContainer=Ext.DomHelper.append(this.container,{tag:"div",cls:"x-cp-rgb-container"},true);this.form=new Ext.form.Form({labelAlign:"top",labelWidth:30,labelSeparator:"",cls:"x-cp-form",id:"form"+this.domElement.id});this.form.column({width:22,labelSeparator:""},new Ext.form.NumberField({id:"redValue"+this.domElement.id,fieldLabel:(this.config.captions.red||"R"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:255,minLength:1,minValue:0,value:255,emptyText:"0"}),new Ext.form.NumberField({id:"greenValue"+this.domElement.id,fieldLabel:(this.config.captions.green||"G"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:255,minLength:1,minValue:0,value:255,emptyText:"0"}),new Ext.form.NumberField({id:"blueValue"+this.domElement.id,fieldLabel:(this.config.captions.blue||"B"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:255,minLength:1,minValue:0,value:255,emptyText:"0"}));this.form.column({width:22,labelSeparator:""},new Ext.form.NumberField({id:"hueValue"+this.domElement.id,fieldLabel:(this.config.captions.hue||"HÂ°"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:360,minLength:1,minValue:0,value:0,emptyText:"0"}),new Ext.form.NumberField({id:"saturationValue"+this.domElement.id,fieldLabel:(this.config.captions.saturation||"S%"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:100,minLength:1,minValue:0,value:100,emptyText:"0"}),new Ext.form.NumberField({id:"brightnessValue"+this.domElement.id,fieldLabel:(this.config.captions.brightness||"V%"),allowDecimals:false,allowNegative:false,maxLength:3,maxValue:100,minLength:1,minValue:0,value:100,emptyText:"0"}));this.form.column({width:42,height:30,cls:"x-cp-clear x-cp-hexa-panel",labelSeparator:""},new Ext.form.TextField({id:"colorValue"+this.domElement.id,fieldLabel:(this.config.captions.hexa||"Color"),maxLength:6,minLeght:6,width:42,value:"FFFFFF",emptyText:"000000"}));this.colorContainer=Ext.DomHelper.append(this.container,{tag:"div",cls:"x-cp-color-container"},true);Ext.DomHelper.append(this.container,{tag:"label",cls:"x-cp-control-container x-cp-clear",style:{display:"block","float":"none"}},true).update(this.config.captions.websafe||"Websafe");this.wsColorContainer=Ext.DomHelper.append(this.container,{tag:"div",cls:"x-cp-wscolor-container"},true);this.form.render(this.formContainer);Ext.DomHelper.append(this.domElement,{tag:"div",style:"height:0px;border:none;clear:both;font-size:1px;"})},realToDec:function(A){return Math.min(255,Math.round(A*256))},hsvToRgb:function(E,K,I){if(E instanceof Array){return this.hsvToRgb.call(this,E[0],E[1],E[2])}var A,F,H,D,G,C,B,J;D=Math.floor((E/60)%6);G=(E/60)-D;C=I*(1-K);B=I*(1-G*K);J=I*(1-(1-G)*K);switch(D){case 0:A=I;F=J;H=C;break;case 1:A=B;F=I;H=C;break;case 2:A=C;F=I;H=J;break;case 3:A=C;F=B;H=I;break;case 4:A=J;F=C;H=I;break;case 5:A=I;F=C;H=B;break}return[this.realToDec(A),this.realToDec(F),this.realToDec(H)]},rgbToHsv:function(A,D,E){if(A instanceof Array){return this.rgbToHsv.call(this,A[0],A[1],A[2])}A=A/255;D=D/255;E=E/255;var B,F,H,C,I,G;B=Math.min(Math.min(A,D),E);F=Math.max(Math.max(A,D),E);H=F-B;switch(F){case B:C=0;break;case A:C=60*(D-E)/H;if(D<E){C+=360}break;case D:C=(60*(E-A)/H)+120;break;case E:C=(60*(A-D)/H)+240;break}I=(F===0)?0:1-(B/F);return[Math.round(C),I,F]},rgbToHex:function(C,B,A){if(C instanceof Array){return this.rgbToHex.call(this,C[0],C[1],C[2])}return this.decToHex(C)+this.decToHex(B)+this.decToHex(A)},decToHex:function(A){A=parseInt(A,10);A=(!isNaN(A))?A:0;A=(A>255||A<0)?0:A;return this.HCHARS.charAt((A-A%16)/16)+this.HCHARS.charAt(A%16)},getHCharPos:function(A){return this.HCHARS.indexOf(A.toUpperCase())},hexToDec:function(B){var A=B.split("");return((this.getHCharPos(A[0])*16)+this.getHCharPos(A[1]))},hexToRgb:function(A){return[this.hexToDec(A.substr(0,2)),this.hexToDec(A.substr(2,2)),this.hexToDec(A.substr(4,2))]},checkSafeNumber:function(A){if(!isNaN(A)){A=Math.min(Math.max(0,A),255);var B,C;for(B=0;B<256;B=B+51){C=B+51;if(A>=B&&A<=C){return(A-B>25)?C:B}}}return A},websafe:function(C,B,A){if(C instanceof Array){return this.websafe.call(this,C[0],C[1],C[2])}return[this.checkSafeNumber(C),this.checkSafeNumber(B),this.checkSafeNumber(A)]},getHue:function(B){var A=Math.round(((this.huePicker.getHeight()-B)/this.huePicker.getHeight())*360);return A===360?0:A},getHPos:function(A){return this.huePicker.getHeight()-((A*this.huePicker.getHeight())/360)},getSaturation:function(A){return A/this.rgbPicker.getWidth()},getSPos:function(A){return A*this.rgbPicker.getWidth()},getValue:function(A){return(this.rgbPicker.getHeight()-A)/this.rgbPicker.getHeight()},getVPos:function(A){return this.rgbPicker.getHeight()-(A*this.rgbPicker.getHeight())},updateColorsFromRGBPicker:function(){this._HSV={h:this._HSV.h,s:this.getSaturation(this.lastXYRgb.x),v:this.getValue(this.lastXYRgb.y)}},updateColorsFromHUEPicker:function(){this._HSV.h=this.getHue(this.lastYHue);var A=this.hsvToRgb(this._HSV.h,1,1);A=this.rgbToHex(A[0],A[1],A[2]);this.rgbPicker.setStyle({backgroundColor:"#"+A})},updateColorsFromRGBFields:function(){var A=this.rgbToHsv(this.form.findField("redValue"+this.domElement.id).getValue(),this.form.findField("greenValue"+this.domElement.id).getValue(),this.form.findField("blueValue"+this.domElement.id).getValue());this._HSV={h:A[0],s:A[1],v:A[2]}},updateColorsFromHexaField:function(){var A=this.hexToRgb(this._HEX);this._RGB={r:A[0],g:A[1],b:A[2]};A=this.rgbToHsv(A[0],A[1],A[2]);this._HSV={h:A[0],s:A[1],v:A[2]}},updateColorsFromHSVFields:function(){var A=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:A[0],g:A[1],b:A[2]}},updateRGBFromHSV:function(){var A=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:A[0],g:A[1],b:A[2]}},updateInputFields:function(){this.form.findField("redValue"+this.domElement.id).setValue(this._RGB.r);this.form.findField("greenValue"+this.domElement.id).setValue(this._RGB.g);this.form.findField("blueValue"+this.domElement.id).setValue(this._RGB.b);this.form.findField("hueValue"+this.domElement.id).setValue(this._HSV.h);this.form.findField("saturationValue"+this.domElement.id).setValue(Math.round(this._HSV.s*100));this.form.findField("brightnessValue"+this.domElement.id).setValue(Math.round(this._HSV.v*100));this.form.findField("colorValue"+this.domElement.id).setValue(this._HEX)},updateColor:function(){this._HEX=this.rgbToHex(this._RGB.r,this._RGB.g,this._RGB.b);this.colorContainer.setStyle({backgroundColor:"#"+this._HEX});this.colorContainer.set({title:"#"+this._HEX});var A=this.rgbToHex(this.websafe(this._RGB.r,this._RGB.g,this._RGB.b));this.wsColorContainer.setStyle({backgroundColor:"#"+A});this.wsColorContainer.set({title:"#"+A});this.updateInputFields();this.fireEvent("pickcolor",this,this._HEX)},updatePickers:function(){this.lastXYRgb={x:this.getSPos(this._HSV.s),y:this.getVPos(this._HSV.v)};this.rgbPointer.setXY([this.lastXYRgb.x-this.config.pickerHotPoint.x+this.rgbPicker.getLeft(),this.lastXYRgb.y-this.config.pickerHotPoint.y+this.rgbPicker.getTop()],this.config.animate);this.lastYHue=this.getHPos(this._HSV.h);this.huePointer.setXY([this.huePicker.getLeft()+(this.huePointer.getWidth()/2)+1,this.lastYHue+this.huePicker.getTop()-this.config.pickerHotPoint.y],this.config.animate);var A=this.hsvToRgb(this._HSV.h,1,1);A=this.rgbToHex(A[0],A[1],A[2]);this.rgbPicker.setStyle({backgroundColor:"#"+A})},rgbPickerClick:function(A,B){this.lastXYRgb={x:A.getPageX()-this.rgbPicker.getLeft(),y:A.getPageY()-this.rgbPicker.getTop()};this.rgbPointer.setXY([A.getPageX()-this.config.pickerHotPoint.x,A.getPageY()-this.config.pickerHotPoint.y],this.config.animate);this.updateColorsFromRGBPicker();this.updateRGBFromHSV();this.updateColor()},huePickerClick:function(A,B){this.lastYHue=A.getPageY()-this.huePicker.getTop();this.huePointer.setY([A.getPageY()-3],this.config.animate);this.updateColorsFromHUEPicker();this.updateRGBFromHSV();this.updateColor()},changeRGBField:function(B,C,A){if(!(C instanceof String)){C=B.getValue()}if(C<0){C=0}if(C>255){C=255}if(B==this.form.findField("redValue"+this.domElement.id)){this._RGB.r=C}else{if(B==this.form.findField("greenValue"+this.domElement.id)){this._RGB.g=C}else{if(B==this.form.findField("blueValue"+this.domElement.id)){this._RGB.b=C}}}this.updateColorsFromRGBFields();this.updateColor();this.updatePickers();this.fireEvent("changergb",this,this._RGB)},changeHSVField:function(B,C,A){if(!(C instanceof String)){C=B.getValue()}if(B==this.form.findField("hueValue"+this.domElement.id)){if(C<0){C=0}if(C>360){C=360}this._HSV.h=C}else{if(C<0){C=0}if(C>100){C=100}if(B==this.form.findField("saturationValue"+this.domElement.id)){this._HSV.s=(C/100)}else{if(B==this.form.findField("brightnessValue"+this.domElement.id)){this._HSV.v=(C/100)}}}this.updateColorsFromHSVFields();this.updateColor();this.updatePickers();this.fireEvent("changehsv",this,this._HSV)},changeHexaField:function(B,C,A){if(!(C instanceof String)){C=B.getValue()}if(B==this.form.findField("colorValue"+this.domElement.id)){if(C.length>9){C=C.substr(0,5)}if(!C.match(/^[0-9a-f]{6}$/i)){C="000000"}this._HEX=C;this.updateColorsFromHexaField();this.updateColor();this.updatePickers();this.fireEvent("changehexa",this,this._HEX)}},setColorFromWebsafe:function(){this.setColor(this.wsColorContainer.getColor("backgroundColor","",""))},checkConfig:function(){if(this.config){if(this.config.color){this.setColor(this.config.color)}else{if(this.config.hsv){this.setHSV(this.config.hsv)}else{if(this.config.rgb){this.setRGB(this.config.rgb)}}}}},setColor:function(B){var A=this.hexToRgb(B);this._RGB={r:A[0],g:A[1],b:A[2]};var A=this.rgbToHsv(A);this._HSV={h:A[0],s:A[1],v:A[2]};this.updateColor();this.updatePickers()},setRGB:function(B){this._RGB=B;var A=this.rgbToHsv(B.r,B.g,B.b);this._HSV={h:A[0],s:A[1],v:A[2]};this.updateColor();this.updatePickers()},setHSV:function(B){this._HSV={h:B.h,s:(B.s/100),v:(B.v/100)};var A=this.hsvToRgb(B.h,(B.s/100),(B.v/100));this._RGB={r:A[0],g:A[1],b:A[2]};this.updateColor();this.updatePickers()},getColor:function(A){return(A?"":"#")+this._HEX},getRGB:function(){return this._RGB},getHSV:function(){return this._HSV},setPanelVisible:function(A,B){return this.formContainer.setVisible(A,B)},isPanelVisible:function(){return this.formContainer.isDisplayed()},show:function(){this.domElement.show()},hide:function(){this.domElement.hide()}});Ext.ux.ColorDialog=function(B,A){Ext.ux.ColorDialog.superclass.constructor.call(this,B,A);this.initialize(this.body,A);this.body.setStyle({padding:"5px"});this.setContentSize(266,218)};Ext.extend(Ext.ux.ColorDialog,Ext.BasicDialog);Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype);
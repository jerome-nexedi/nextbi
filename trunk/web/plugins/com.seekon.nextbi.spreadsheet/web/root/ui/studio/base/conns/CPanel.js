Jedox.studio.conns.CPanel=function(){var that=this;this.addFlag=false;this.connectionName="";this.initFlag=false;this.connectionTypesStore=new Ext.data.SimpleStore({fields:[{name:"value"},{name:"connectionName"},{name:"icon"}]});this.connectionTypeCmb=new Ext.form.ComboBox({fieldLabel:"Type".localize(),labelStyle:"font-size:11px;",store:this.connectionTypesStore,valueField:"value",displayField:"connectionName",width:200,triggerAction:"all",mode:"local"});this.connectionNameTxf=new Ext.form.TextField({fieldLabel:"Connection Name".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"connectionName",allowBlank:false,width:200});this.descriptionTxa=new Ext.form.TextArea({fieldLabel:"Description".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"description",width:200});this.hostTxf=new Ext.form.TextField({fieldLabel:"Host".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"host",width:200});this.splitLine={html:"<br><br>",baseCls:"split-line",width:315};this.portTxf=new Ext.form.TextField({fieldLabel:"Port".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"port",width:200,baseCls:"x-plain"});this.userNameTxf=new Ext.form.TextField({fieldLabel:"User Name".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"userName",width:200});this.passwordTxf=new Ext.form.TextField({fieldLabel:"Password".localize(),labelStyle:"font-size:11px;",cls:"preview-properties-panel",name:"password",width:200});this.useLoginCredChb=new Ext.form.Checkbox({fieldLabel:"Use login credentials".localize(),labelStyle:"font-size:11px;",handler:function(){if(this.getValue()){that.userNameTxf.disable();that.passwordTxf.disable()}else{that.userNameTxf.enable();that.passwordTxf.enable()}}});this.connectionActiveChb=new Ext.form.Checkbox({fieldLabel:"Connection active".localize(),labelStyle:"font-size:11px;"});var generalPanel=new Ext.Panel({layout:"form",bodyStyle:"padding:10px",border:false,items:[this.connectionNameTxf,this.descriptionTxa,this.connectionTypeCmb,this.splitLine,this.hostTxf,this.portTxf,this.splitLine,this.userNameTxf,this.passwordTxf,this.useLoginCredChb,this.splitLine,this.connectionActiveChb]});this.tabPanel=new Ext.TabPanel({activeTab:0,bodyStyle:"border-left:none; border-right:none; border-top:1; border-bottom:1;",enableTabScroll:true,plain:true,defaults:{autoScroll:true,layout:"form"},items:[{title:"General".localize(),items:[generalPanel]},{title:"Security".localize(),bodyStyle:"padding:10px",listeners:{render:function(){makeSecurityPanel(this)}}}],listeners:{beforetabchange:function(tabPanel,newTab,currentTab){return !that.addFlag}}});function makeSecurityPanel(container){that.s=new Jedox.studio.dialog.Security(false);that.s.setName(that.connectionName);container.add(that.s.getPanel());that.s.setInterfacePermission(that._perm)}var mainPanel={layout:"fit",bodyStyle:"padding:10px",border:false,items:[this.tabPanel],buttons:[{text:"Save".localize(),handler:this.onSave,scope:this},{text:"Cancel".localize(),handler:this.onCancel,scope:this}]};Jedox.studio.conns.CPanel.superclass.constructor.call(this,{id:"c-main-panel",title:"Connections".localize(),labelAlign:"right",cls:"preview-properties-panel",layout:"card",items:[{html:"",baseCls:"x-plain"},mainPanel],activeItem:0})};Ext.extend(Jedox.studio.conns.CPanel,Ext.Panel,{init:function(){if(this.initFlag){return false}this.initConnectionTypes()},initConnectionTypes:function(){var prop=["name","icon"];var result=Jedox.studio.backend.wssStudio.getConnectionTypes(prop);if(this.isError(result)){this.showMessage("Group data",result[1])}var connectionTypesData=[];var recordNmbr=result.length;var columnNmbr=prop.length+1;var rowNmbr=recordNmbr/columnNmbr;for(var i=0;i<rowNmbr;i++){connectionTypesData.push([]);for(var j=0;j<columnNmbr;j++){connectionTypesData[i].push(result[j*rowNmbr+i])}}this.connectionTypesStore.loadData(connectionTypesData);this.initFlag=true},initConnection:function(connectionName,perm){this._perm=perm;this.addFlag=false;this.connectionName=connectionName;this.layout.setActiveItem(1);var connectionData=Jedox.studio.backend.wssStudio.getConnection(connectionName);if(this.isError(connectionData)){this.showMessage("Connection data".localize(),connectionData[1])}this.connectionNameTxf.setValue(connectionData[0]);this.connectionTypeCmb.setValue(connectionData[1]);this.descriptionTxa.setValue(connectionData[2]);this.hostTxf.setValue(connectionData[3]);this.portTxf.setValue(connectionData[4]);this.userNameTxf.setValue(connectionData[5]);this.passwordTxf.setValue(connectionData[6]);this.useLoginCredChb.setValue(connectionData[7]);this.connectionActiveChb.setValue(connectionData[8]);this.setInterfacePermission(perm);if(this.s){this.s.reset(this.connectionName);this.s.setInterfacePermission(perm);this.s.setName(this.connectionName)}},addConnection:function(){var connectionName=this.connectionNameTxf.getValue();var connectionType=this.connectionTypeCmb.getValue();var description=this.descriptionTxa.getValue();var host=this.hostTxf.getValue();var port=this.portTxf.getValue();var userName=this.userNameTxf.getValue();var password=this.passwordTxf.getValue();var useLoginCred=this.useLoginCredChb.getValue()?1:0;var connectionActive=this.connectionActiveChb.getValue()?1:0;if(this.validateForm()){var result=Jedox.studio.backend.wssStudio.addConnection(connectionName,connectionType,description,host,port,userName,password,useLoginCred,connectionActive);if(this.isError(result)){Jedox.studio.app.showMessageERROR("Update connection",result[1]);return false}this.showFeedback("","Connection".localize()+" <b>"+connectionName+" </b> "+"added".localize());this.onCancel()}},updateConnection:function(){var connectionName=this.connectionNameTxf.getValue();var connectionType=this.connectionTypeCmb.getValue();var description=this.descriptionTxa.getValue();var host=this.hostTxf.getValue();var port=this.portTxf.getValue();var userName=this.userNameTxf.getValue();var password=this.passwordTxf.getValue();var useLoginCred=this.useLoginCredChb.getValue()?1:0;var connectionActive=this.connectionActiveChb.getValue()?1:0;if(this.validateForm()){var result=Jedox.studio.backend.wssStudio.updateConnection(this.connectionName,connectionName,connectionType,description,host,port,userName,password,useLoginCred,connectionActive);if(this.s){this.s.savePermission()}if(this.isError(result)){Jedox.studio.app.showMessageERROR("Update connection".localize(),result[1]);return false}this.showFeedback("","Connection".localize()+" <b>"+connectionName+" </b> "+"updated".localize());this.onCancel()}},newConnection:function(){this.layout.setActiveItem(1);this.clear();this.setInterfacePermission(Jedox.studio.access.permType.WRITE);this.tabPanel.setActiveTab(0);this.addFlag=true},setInterfacePermission:function(perm){var that=this;if(perm&Jedox.studio.access.permType.WRITE){setWRITEPermission()}else{setREADPermision()}function setREADPermision(){that.connectionNameTxf.disable();that.connectionTypeCmb.disable();that.descriptionTxa.disable();that.hostTxf.disable();that.portTxf.disable();that.userNameTxf.disable();that.passwordTxf.disable();that.useLoginCredChb.disable();that.connectionActiveChb.disable();var btns=that.items.items[1].buttons;btns[0].disable();btns[1].disable()}function setWRITEPermission(){that.connectionNameTxf.enable();that.connectionTypeCmb.enable();that.descriptionTxa.enable();that.hostTxf.enable();that.portTxf.enable();that.userNameTxf.enable();that.passwordTxf.enable();that.useLoginCredChb.enable();that.connectionActiveChb.enable();var btns=that.items.items[1].buttons;btns[0].enable();btns[1].enable()}},clear:function(){this.connectionNameTxf.reset();this.connectionTypeCmb.reset();this.descriptionTxa.reset();this.hostTxf.reset();this.portTxf.reset();this.userNameTxf.reset();this.passwordTxf.reset();this.useLoginCredChb.reset();this.connectionActiveChb.reset()},showFeedback:function(title,message){Jedox.studio.app.showTopMsg(title,message)},validateForm:function(){var that=this;var _return=true;function connectionName(){var msg="Connection name must start with a-z/A-Z character and cannot contain...".localize();var my_regexp=/^[a-zA-Z][a-zA-Z0-9_\-@\.\s]+$/;var value=that.connectionNameTxf.getValue();if(!my_regexp.test(value)){that.connectionNameTxf.markInvalid(msg);_return=false}}function host(){var msg="Host name must start with a-z/A-Z character and must contain more than one word...".localize();var my_regexp=/^[a-zA-Z0-9_\-@\.]+$/;var value=that.hostTxf.getValue();if(!my_regexp.test(value)){that.hostTxf.markInvalid(msg);_return=false}}function port(){var msg="Port name must be a number...".localize();var my_regexp=/^[0-9]+$/;var value=that.portTxf.getValue();if(!my_regexp.test(value)){that.portTxf.markInvalid(msg);_return=false}}function userName(){var msg="User name must start with a-z/A-Z character and cannot contain...".localize();var my_regexp=/^[a-zA-Z][a-zA-Z0-9_\-@\.]+$/;var value=that.userNameTxf.getValue();if(!my_regexp.test(value)){that.userNameTxf.markInvalid(msg);_return=false}}function password(){var msg="Password must start with a-z/A-Z character and must contain 5 char min...".localize();var my_regexp=/^[a-zA-Z]([a-zA-Z0-9#_-]{4,})$/;var value=that.passwordTxf.getValue();if(!my_regexp.test(value)){that.passwordTxf.markInvalid(msg);_return=false}}connectionName();host();port();if(!this.useLoginCredChb.getValue()){userName();password()}return _return},isError:function(result){if(result[0]==="!"&&result.length===2){return true}return false},onSave:function(){if(this.addFlag){this.addConnection()}else{this.updateConnection()}},onCancel:function(){Ext.getCmp("ps-c-tree").refreshConnectionList();this.layout.setActiveItem(0)}});
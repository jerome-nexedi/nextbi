Jedox.studio.conns.CTreePanel=function(){var that=this;this.initFlag=false;var newCTlbBtn={text:"New Connection".localize(),tooltip:{title:"New Connection".localize(),text:"Creates new connection".localize()},iconCls:"connection-icon",disabled:!(Jedox.studio.access.rules["dimension element"]&Jedox.studio.access.permType.DELETE),handler:this.addConnection,scope:this};var removeCTlbBtn={text:"Remove connection".localize(),tooltip:{title:"Remove".localize(),text:"Removes connection from list".localize()},id:"delete",iconCls:"delete-icon",disabled:false,handler:this.removeConnection,scope:this};this.cTlb=new Ext.Toolbar({items:[newCTlbBtn,removeCTlbBtn]});this.cTreePanel=new Ext.tree.TreePanel({id:"ps-c-tree",border:false,lines:true,autoHeight:true,autoScroll:true,root:new Ext.tree.TreeNode({id:"c-root-node",text:"Connections".localize(),iconCls:"connection-icon",expanded:true}),rootVisible:false});this.cTreePanel.on("click",function(n){var sn=that.cTreePanel.selModel.getSelectedNode()||{};if(n.id!=sn.id&&n.id!="c-root-node"){that.setInterfacePermission(n.attributes.perm);Ext.getCmp("c-main-panel").initConnection(n.text,n.attributes.perm)}else{that.unselect()}});Jedox.studio.conns.CTreePanel.superclass.constructor.call(this,{id:"ps-c-tree",border:false,tbar:this.cTlb,items:[this.cTreePanel]})};Ext.extend(Jedox.studio.conns.CTreePanel,Ext.Panel,{init:function(){if(this.initFlag){return false}this.initCData()},initCData:function(){var that=this;var nodes=[];this.cTreePanel.root.eachChild(function(node){nodes.push(node)},[this]);for(var i=0;i<nodes.length;i++){nodes[i].remove()}var prop=["name","type"];var result=Jedox.studio.backend.wssStudio.getAllConnections(prop);var CData=[];if(result[0]){var recordNmbr=result.length;var columnNmbr=prop.length+1;var rowNmbr=recordNmbr/columnNmbr;for(var i=0;i<rowNmbr;i++){CData.push({text:result[i],leaf:true,iconCls:result[i+rowNmbr],perm:result[i+2*rowNmbr]})}this.cTreePanel.root.appendChild(CData);this.cTreePanel.root.expand();this.initFlag=true}else{alert("Error!!!")}},addConnection:function(){this.cTreePanel.root.select();Ext.getCmp("c-main-panel").newConnection()},refreshConnectionList:function(){var nodes=[];this.cTreePanel.root.eachChild(function(node){nodes.push(node)},[this]);for(var i=0;i<nodes.length;i++){nodes[i].remove()}this.initCData();this.cTreePanel.root.expand();this.cTreePanel.root.select()},removeConnection:function(){var that=this;var sn=this.cTreePanel.selModel.getSelectedNode()||{};var title="Remove Connection".localize();var msg="remove_connection_warning_msg".localize({conn:sn.text});var fn=function(){var result=Jedox.studio.backend.wssStudio.removeConnection(sn.text);sn.remove();that.unselect()};Jedox.studio.app.showMessageQUESTION(title,msg,fn)},unselect:function(){Ext.getCmp("c-main-panel").layout.setActiveItem(0)},setInterfacePermission:function(perm){if(perm&Jedox.studio.access.permType.DELETE){this.cTlb.items.items[1].enable()}else{this.cTlb.items.items[1].disable()}},selectFirstNode:function(){var node=this.cTreePanel.getNodeById(this.cTreePanel.root.firstChild.attributes.id);this.cTreePanel.fireEvent("click",node)}});